# ุชุญุณูู ุงูุฑุจุท ุจูู ุงููุฎุงุจุฑ ูุงูุนูุงุฌุงุช ูุงูุฃุณูุงู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญุณูู ุงููุธุงู ูุชูููุฑ ุฑุจุท ุดุงูู ููุชูุงูู ุจูู ุงููุฎุงุจุฑ ูุงูุนูุงุฌุงุช ูุงูุฃุณูุงูุ ููุง ูููุฑ ุฅุฏุงุฑุฉ ุฃูุถู ูุทูุจุงุช ุงููุฎุชุจุฑ ูุฑุจุทูุง ุจุงูุนูุงุฌุงุช ูุงููุฑุถู.

## ๐ง ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุงูุญููู ุงูุฌุฏูุฏุฉ ูู ุฌุฏูู `lab_orders`:

```sql
-- ุญููู ุงูุฑุจุท ุงููุญุณูุฉ
appointment_id TEXT,           -- ุฑุจุท ูุน ุงูููุงุนูุฏ
tooth_treatment_id TEXT,       -- ุฑุจุท ูุน ุนูุงุฌุงุช ุงูุฃุณูุงู
tooth_number INTEGER,          -- ุฑูู ุงูุณู ุงููุจุงุดุฑ

-- ุญููู ุงูุชูุงุฑูุฎ ุงููุญุณูุฉ
expected_delivery_date TEXT,   -- ุชุงุฑูุฎ ุงูุชุณููู ุงููุชููุน
actual_delivery_date TEXT,     -- ุชุงุฑูุฎ ุงูุชุณููู ุงููุนูู

-- ุญููู ุฅุฏุงุฑูุฉ ุฌุฏูุฏุฉ
priority INTEGER DEFAULT 1,    -- ุฃููููุฉ ุงูุทูุจ (1=ุนุงููุฉุ 2=ูุชูุณุทุฉุ 3=ููุฎูุถุฉ)
lab_instructions TEXT,         -- ุชุนูููุงุช ุฎุงุตุฉ ูููุฎุชุจุฑ
material_type TEXT,           -- ููุน ุงููุงุฏุฉ ุงููุทููุจุฉ
color_shade TEXT,             -- ุฏุฑุฌุฉ ุงูููู ุงููุทููุจุฉ
```

#### ุงูุนูุงูุงุช ุงููุญุณูุฉ:

```sql
-- ุนูุงูุงุช CASCADE DELETE ูุญุณูุฉ
FOREIGN KEY (lab_id) REFERENCES labs(id) ON DELETE CASCADE,
FOREIGN KEY (patient_id) REFERENCES patients(id) ON DELETE SET NULL,
FOREIGN KEY (appointment_id) REFERENCES appointments(id) ON DELETE SET NULL,
FOREIGN KEY (tooth_treatment_id) REFERENCES tooth_treatments(id) ON DELETE CASCADE
```

### 2. ุงูููุงุฑุณ ุงููุญุณูุฉ

```sql
-- ููุงุฑุณ ุฌุฏูุฏุฉ ูุชุญุณูู ุงูุฃุฏุงุก
CREATE INDEX idx_lab_orders_treatment ON lab_orders(tooth_treatment_id);
CREATE INDEX idx_lab_orders_appointment ON lab_orders(appointment_id);
CREATE INDEX idx_lab_orders_tooth ON lab_orders(tooth_number);
CREATE INDEX idx_lab_orders_patient_tooth ON lab_orders(patient_id, tooth_number);
CREATE INDEX idx_lab_orders_priority ON lab_orders(priority);
```

### 3. Triggers ุงูุชููุงุฆูุฉ

```sql
-- ุชุญุฏูุซ ุฑูู ุงูุณู ุชููุงุฆูุงู ุนูุฏ ุฑุจุท ุงูุนูุงุฌ
CREATE TRIGGER update_lab_order_tooth_number
AFTER UPDATE OF tooth_treatment_id ON lab_orders
WHEN NEW.tooth_treatment_id IS NOT NULL AND NEW.tooth_number IS NULL
BEGIN
    UPDATE lab_orders 
    SET tooth_number = (
        SELECT tooth_number 
        FROM tooth_treatments 
        WHERE id = NEW.tooth_treatment_id
    )
    WHERE id = NEW.id;
END;
```

## ๐ฏ ุงูููุงุฆุฏ ุงูุฌุฏูุฏุฉ

### 1. ุฑุจุท ุดุงูู
- **ุฑุจุท ูุจุงุดุฑ**: ุทูุจุงุช ุงููุฎุชุจุฑ ูุฑุชุจุทุฉ ูุจุงุดุฑุฉ ุจุงูุฃุณูุงู ูุงูุนูุงุฌุงุช ูุงูููุงุนูุฏ
- **ุชุชุจุน ูุงูู**: ุฅููุงููุฉ ุชุชุจุน ุฌููุน ุทูุจุงุช ุงููุฎุชุจุฑ ููู ุณู ุฃู ุนูุงุฌ
- **ุญุฐู ูุชุณูุณู**: ุญุฐู ุงูุนูุงุฌ ูุญุฐู ุทูุจุงุช ุงููุฎุชุจุฑ ุงููุฑุชุจุทุฉ ุชููุงุฆูุงู

### 2. ุฅุฏุงุฑุฉ ูุญุณูุฉ
- **ุฃููููุงุช**: ุชุญุฏูุฏ ุฃููููุฉ ุทูุจุงุช ุงููุฎุชุจุฑ
- **ุชุนูููุงุช ููุตูุฉ**: ุฅุถุงูุฉ ุชุนูููุงุช ุฎุงุตุฉ ููู ุทูุจ
- **ููุงุตูุงุช ุงูููุงุฏ**: ุชุญุฏูุฏ ููุน ุงููุงุฏุฉ ูุฏุฑุฌุฉ ุงูููู
- **ุชูุงุฑูุฎ ุฏูููุฉ**: ุชุชุจุน ุชูุงุฑูุฎ ุงูุชุณููู ุงููุชููุนุฉ ูุงููุนููุฉ

### 3. ุฃุฏุงุก ูุญุณู
- **ููุงุฑุณ ุดุงููุฉ**: ุจุญุซ ุฃุณุฑุน ูุฃุฏุงุก ูุญุณู
- **ุงุณุชุนูุงูุงุช ูุญุณูุฉ**: ุงุณุชุนูุงูุงุช ุฃูุซุฑ ููุงุกุฉ ููุจูุงูุงุช ุงููุฑุชุจุทุฉ
- **ุชุญุฏูุซ ุชููุงุฆู**: ุชุญุฏูุซ ุงูุจูุงูุงุช ุชููุงุฆูุงู ุนุจุฑ ุงูู triggers

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช
- `src/database/schema.sql` - ุงูุจููุฉ ุงูุฃุณุงุณูุฉ ุงููุญุฏุซุฉ
- `src/database/migrations/fix_lab_orders_relationships.sql` - Migration ููุชุญุฏูุซ
- `scripts/fix_lab_orders_relationships.js` - ุณูุฑูุจุช ุงูุชุทุจูู
- `scripts/fix_lab_orders_relationships.bat` - ููู batch ููุชุดุบูู

### 2. ุงูุฎุฏูุงุช
- `src/services/databaseService.js` - ุฎุฏูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช JavaScript
- `src/services/databaseService.ts` - ุฎุฏูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช TypeScript

### 3. ุงูุฃููุงุน ูุงููุงุฌูุงุช
- `src/types/index.ts` - ุชุญุฏูุซ ูุงุฌูุฉ LabOrder

### 4. ููููุงุช ุงููุงุฌูุฉ
- `src/components/labs/AddLabOrderDialog.tsx` - ุญูุงุฑ ุฅุถุงูุฉ/ุชุนุฏูู ุทูุจุงุช ุงููุฎุชุจุฑ

## ๐ ููููุฉ ุงูุชุทุจูู

### ูููุดุงุฑูุน ุงูุฌุฏูุฏุฉ:
ุงูุชุญุณููุงุช ุณุชููู ูุชุงุญุฉ ุชููุงุฆูุงู ุนูุฏ ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ.

### ูููุดุงุฑูุน ุงูููุฌูุฏุฉ:

#### ุงูุทุฑููุฉ ุงูุฃููู - ุงุณุชุฎุฏุงู ุงูู batch file:
```bash
# ุชุดุบูู ูู ูุฌูุฏ ุงููุดุฑูุน
scripts\fix_lab_orders_relationships.bat
```

#### ุงูุทุฑููุฉ ุงูุซุงููุฉ - ุงุณุชุฎุฏุงู Node.js ูุจุงุดุฑุฉ:
```bash
node scripts/fix_lab_orders_relationships.js
```

#### ุงูุทุฑููุฉ ุงูุซุงูุซุฉ - ุชุทุจูู SQL ูุจุงุดุฑุฉ:
```bash
sqlite3 dental_clinic.db < src/database/migrations/fix_lab_orders_relationships.sql
```

## ๐ ุงูุชุญูู ูู ุงูุชุทุจูู

ุจุนุฏ ุชุทุจูู ุงูุชุญุฏูุซุงุชุ ูููู ุงูุชุญูู ูู ูุฌุงุญ ุงูุนูููุฉ:

```sql
-- ุงูุชุญูู ูู ุจููุฉ ุงูุฌุฏูู
.schema lab_orders

-- ุงูุชุญูู ูู ุงูููุงุฑุณ
SELECT name FROM sqlite_master WHERE type='index' AND tbl_name='lab_orders';

-- ุงูุชุญูู ูู ุงูู triggers
SELECT name FROM sqlite_master WHERE type='trigger' AND name LIKE '%lab_order%';

-- ุฅุญุตุงุฆูุงุช ุงูุจูุงูุงุช
SELECT 
    COUNT(*) as total_orders,
    COUNT(tooth_treatment_id) as orders_with_treatments,
    COUNT(tooth_number) as orders_with_tooth_numbers
FROM lab_orders;
```

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

- **ุชูุงูู ูุงูู** ุจูู ุงููุฎุงุจุฑ ูุงูุนูุงุฌุงุช ูุงูุฃุณูุงู
- **ุฅุฏุงุฑุฉ ูุญุณูุฉ** ูุทูุจุงุช ุงููุฎุชุจุฑ ูุน ุชูุงุตูู ุฃูุซุฑ
- **ุฃุฏุงุก ุฃูุถู** ูู ุงูุจุญุซ ูุงูุงุณุชุนูุงูุงุช
- **ููุซูููุฉ ุนุงููุฉ** ูู ุงูุจูุงูุงุช ูุน ุงูู triggers ุงูุชููุงุฆูุฉ
- **ุณูููุฉ ุงูุงุณุชุฎุฏุงู** ูุน ูุงุฌูุฉ ูุญุณูุฉ ุชุฏุนู ุฌููุน ุงูุญููู ุงูุฌุฏูุฏุฉ

## ๐ ุงูุฑุจุท ุงูุดุงูู

ุงููุธุงู ุงูุขู ูุฏุนู ุงูุฑุจุท ุงููุงูู ุจูู:

1. **ุงููุฎุงุจุฑ** โ **ุทูุจุงุช ุงููุฎุชุจุฑ**
2. **ุงููุฑุถู** โ **ุทูุจุงุช ุงููุฎุชุจุฑ**
3. **ุงูููุงุนูุฏ** โ **ุทูุจุงุช ุงููุฎุชุจุฑ**
4. **ุนูุงุฌุงุช ุงูุฃุณูุงู** โ **ุทูุจุงุช ุงููุฎุชุจุฑ**
5. **ุงูุฃุณูุงู (ุงูุฃุฑูุงู)** โ **ุทูุจุงุช ุงููุฎุชุจุฑ**

ูุฐุง ูููุฑ ูุธุงู ุฅุฏุงุฑุฉ ุดุงูู ููุชูุงูู ูุฌููุน ุฌูุงูุจ ุงูุนูู ูุน ุงููุฎุงุจุฑ ูู ุงูุนูุงุฏุฉ.
