# ميزة الفلترة الزمنية للإحصائيات

## نظرة عامة

تم إضافة ميزة الفلترة الزمنية الشاملة لجميع صفحات التطبيق التي تحتوي على كاردات إحصائية. هذه الميزة تسمح للمستخدمين بفلترة البيانات والإحصائيات حسب فترات زمنية مختلفة (اليوم، الأسبوع، الشهر، السنة، أو فترة مخصصة).

**ملاحظة مهمة**: الفلاتر مخفية بشكل افتراضي لتقليل التشتيت البصري، ويمكن إظهارها بالضغط على زر "فلترة زمنية".

## الصفحات المحدثة

### 1. صفحة Dashboard (لوحة التحكم)
- **المسار**: `src/pages/Dashboard.tsx`
- **الفلاتر المضافة**:
  - فلترة المرضى حسب تاريخ التسجيل
  - فلترة المواعيد حسب تاريخ الموعد
  - فلترة المدفوعات حسب تاريخ الدفع
- **الميزات**:
  - عرض مؤشرات الاتجاه (Trend) مقارنة بالفترة السابقة
  - تحديث الكاردات الإحصائية بناءً على الفلترة

### 2. صفحة المدفوعات (Payments)
- **المسار**: `src/pages/Payments.tsx`
- **الفلاتر المضافة**:
  - فلترة المدفوعات حسب تاريخ الدفع
- **الميزات**:
  - عرض إجمالي الإيرادات للفترة المحددة
  - مؤشرات الاتجاه للمدفوعات

### 3. صفحة المخزون (Inventory)
- **المسار**: `src/pages/Inventory.tsx`
- **الفلاتر المضافة**:
  - فلترة عناصر المخزون حسب تاريخ الإضافة
- **الميزات**:
  - عرض عدد العناصر المضافة في الفترة المحددة
  - مؤشرات الاتجاه للمخزون

### 4. صفحة المختبرات (Labs)
- **المسار**: `src/pages/Labs.tsx`
- **الفلاتر المضافة**:
  - فلترة طلبات المختبرات حسب تاريخ الطلب
- **الميزات**:
  - عرض إحصائيات الطلبات والتكاليف للفترة المحددة
  - مؤشرات الاتجاه للطلبات

### 5. صفحة الأدوية والوصفات (Medications)
- **المسار**: `src/pages/Medications.tsx`
- **الفلاتر المضافة**:
  - فلترة الوصفات الطبية حسب تاريخ الوصفة
- **الميزات**:
  - عرض عدد الوصفات في الفترة المحددة
  - مؤشرات الاتجاه للوصفات

## المكونات الجديدة

### 1. مكون TimeFilter
- **المسار**: `src/components/ui/time-filter.tsx`
- **الوظائف**:
  - اختيار فترات زمنية محددة مسبقاً (اليوم، الأسبوع، الشهر، السنة)
  - إدخال فترة زمنية مخصصة
  - عرض الفترة المحددة حالياً
  - إعادة تعيين الفلتر
  - **مخفي بشكل افتراضي** مع زر لإظهار/إخفاء المحتوى
  - تصميم مضغوط لتوفير المساحة

### 2. Hook useTimeFilteredStats
- **المسار**: `src/hooks/useTimeFilteredStats.ts`
- **الوظائف**:
  - فلترة البيانات حسب الفترة الزمنية المحددة
  - حساب الإحصائيات الأساسية
  - حساب الإحصائيات المالية (إذا كانت متوفرة)
  - حساب مؤشرات الاتجاه مقارنة بالفترة السابقة
  - تجميع البيانات حسب الفترات الزمنية

## خيارات الفلترة الزمنية

### الفترات المحددة مسبقاً:
1. **اليوم**: البيانات من بداية اليوم الحالي
2. **هذا الأسبوع**: من بداية الأسبوع الحالي
3. **هذا الشهر**: من بداية الشهر الحالي
4. **هذه السنة**: من بداية السنة الحالية
5. **فترة مخصصة**: تحديد تاريخ البداية والنهاية يدوياً

### مؤشرات الاتجاه (Trend Indicators):
- مقارنة البيانات الحالية مع نفس الفترة السابقة
- عرض النسبة المئوية للتغيير
- مؤشرات بصرية (أخضر للزيادة، أحمر للنقصان)

## كيفية الاستخدام

### للمطورين:

```typescript
// استخدام Hook الفلترة الزمنية
const stats = useTimeFilteredStats({
  data: yourData,
  dateField: 'created_at' // أو أي حقل تاريخ آخر
})

// استخدام مكون الفلتر
<TimeFilter
  value={stats.timeFilter}
  onChange={stats.handleFilterChange}
  onClear={stats.resetFilter}
  title="عنوان الفلتر"
/>
```

### للمستخدمين:
1. اضغط على زر "فلترة زمنية" لإظهار خيارات الفلترة
2. اختر الفترة الزمنية من القائمة المنسدلة
3. أو اختر "فترة مخصصة" وحدد التواريخ يدوياً
4. ستتحدث الإحصائيات تلقائياً
5. استخدم زر "إعادة تعيين" للعودة للإعدادات الافتراضية
6. اضغط على زر الفلترة مرة أخرى لإخفاء الخيارات وتقليل التشتيت

## الفوائد

1. **تحليل أفضل للبيانات**: إمكانية رؤية الأداء في فترات زمنية محددة
2. **مقارنة الاتجاهات**: مؤشرات الاتجاه تساعد في فهم نمو أو تراجع الأعمال
3. **مرونة في التحليل**: خيارات متنوعة للفترات الزمنية
4. **واجهة موحدة**: نفس التجربة عبر جميع الصفحات
5. **أداء محسن**: فلترة البيانات محلياً بدون استدعاءات إضافية للخادم
6. **تقليل التشتيت**: الفلاتر مخفية بشكل افتراضي لواجهة أكثر نظافة
7. **تصميم مضغوط**: استخدام أمثل للمساحة المتاحة

## التحسينات المستقبلية

1. إضافة المزيد من خيارات الفترات (آخر 7 أيام، آخر 30 يوم، إلخ)
2. حفظ تفضيلات المستخدم للفلترة
3. تصدير البيانات المفلترة
4. إضافة مخططات بيانية للاتجاهات
5. مقارنة فترات متعددة في نفس الوقت
