import{j as e,O as t,C as n,a,T as s,D as r,P as i,R as l,S as o,b as c,c as d,I as m,d as u,e as p,f as h,g as x,V as g,L as f,h as v,i as y,k as b,l as j,m as w,n as N,G as _,o as k,p as S,q as C,u as $,W as D,r as E,s as T,t as A,v as F,w as P,x as R,y as O,z as M,A as L,B as I,E as z,F as B,H as V,J as Y,K as q,M as U,N as H,Q as G,U as W,X as K,Y as Z,Z as Q,_ as X,$ as J,a0 as ee,a1 as te,a2 as ne,a3 as ae}from"./ui-25d86217.js";import{a as se,r as re,c as ie,g as le,b as oe,d as ce}from"./vendor-696af5bd.js";import{c as de}from"./utils-8ff0201e.js";import{c as me,R as ue,P as pe,a as he,C as xe,T as ge,B as fe,b as ve,X as ye,Y as be,d as je,A as we,e as Ne,L as _e,f as ke,g as Se,_ as Ce,h as $e,i as De,j as Ee,k as Te,l as Ae,m as Fe,t as Pe,n as Re,o as Oe,p as Me,q as Le,r as Ie,s as ze,u as Be,v as Ve,w as Ye,x as qe,y as Ue,z as He,D as Ge,E as We,F as Ke,G as Ze,H as Qe,I as Xe,J as Je,K as et,M as tt,N as nt}from"./charts-b4389b44.js";import{b as at,J as st}from"./qr-d6f50769.js";import{h as rt,E as it,_ as lt,a as ot}from"./pdf-26d284e9.js";import{E as ct}from"./excel-37615a09.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var dt={},mt=se;dt.createRoot=mt.createRoot,dt.hydrateRoot=mt.hydrateRoot;const ut=new Map,pt=e=>{const t=ut.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},ht=e=>{var t,n;if(!e)return;const a=e.split("\n"),s=a.findIndex(e=>e.includes("api.setState"));if(s<0)return;const r=(null==(t=a[s+1])?void 0:t.trim())||"";return null==(n=/.+ (.+) .+/.exec(r))?void 0:n[1]},xt=(e,t={})=>(n,a,s)=>{const{enabled:r,anonymousActionType:i,store:l,...o}=t;let c;try{c=null!=r&&r&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(x){}if(!c)return e(n,a,s);const{connection:d,...m}=((e,t,n)=>{if(void 0===e)return{type:"untracked",connection:t.connect(n)};const a=ut.get(n.name);if(a)return{type:"tracked",store:e,...a};const s={connection:t.connect(n),stores:{}};return ut.set(n.name,s),{type:"tracked",store:e,...s}})(l,c,o);let u=!0;s.setState=(e,t,r)=>{const c=n(e,t);if(!u)return c;const m=void 0===r?{type:i||ht((new Error).stack)||"anonymous"}:"string"==typeof r?{type:r}:r;return void 0===l?(null==d||d.send(m,a()),c):(null==d||d.send({...m,type:`${l}/${m.type}`},{...pt(o.name),[l]:s.getState()}),c)},s.devtools={cleanup:()=>{d&&"function"==typeof d.unsubscribe&&d.unsubscribe(),((e,t)=>{if(void 0===t)return;const n=ut.get(e);n&&(delete n.stores[t],0===Object.keys(n.stores).length&&ut.delete(e))})(o.name,l)}};const p=(...e)=>{const t=u;u=!1,n(...e),u=t},h=e(s.setState,a,s);if("untracked"===m.type?null==d||d.init(h):(m.stores[m.store]=s,null==d||d.init(Object.fromEntries(Object.entries(m.stores).map(([e,t])=>[e,e===m.store?h:t.getState()])))),s.dispatchFromDevtools&&"function"==typeof s.dispatch){const e=s.dispatch;s.dispatch=(...t)=>{e(...t)}}return d.subscribe(e=>{var t;switch(e.type){case"ACTION":return"string"!=typeof e.payload?void console.error("[zustand devtools middleware] Unsupported action format"):gt(e.payload,e=>{if("__setState"===e.type){if(void 0===l)return void p(e.state);1!==Object.keys(e.state).length&&console.error('\n                    [zustand devtools middleware] Unsupported __setState action format.\n                    When using \'store\' option in devtools(), the \'state\' should have only one key, which is a value of \'store\' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }\n                    ');const t=e.state[l];if(null==t)return;return void(JSON.stringify(s.getState())!==JSON.stringify(t)&&p(t))}s.dispatchFromDevtools&&"function"==typeof s.dispatch&&s.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":return p(h),void 0===l?null==d?void 0:d.init(s.getState()):null==d?void 0:d.init(pt(o.name));case"COMMIT":return void 0===l?void(null==d||d.init(s.getState())):null==d?void 0:d.init(pt(o.name));case"ROLLBACK":return gt(e.state,e=>{if(void 0===l)return p(e),void(null==d||d.init(s.getState()));p(e[l]),null==d||d.init(pt(o.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return gt(e.state,e=>{void 0!==l?JSON.stringify(s.getState())!==JSON.stringify(e[l])&&p(e[l]):p(e)});case"IMPORT_STATE":{const{nextLiftedState:n}=e.payload,a=null==(t=n.computedStates.slice(-1)[0])?void 0:t.state;if(!a)return;return p(void 0===l?a:a[l]),void(null==d||d.send(null,n))}case"PAUSE_RECORDING":return u=!u}return}}),h},gt=(e,t)=>{let n;try{n=JSON.parse(e)}catch(a){console.error("[zustand devtools middleware] Could not parse the received json",a)}void 0!==n&&t(n)};function ft(e,t){let n;try{n=e()}catch(s){return}const a={getItem:e=>{var a;const s=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),r=null!=(a=n.getItem(e))?a:null;return r instanceof Promise?r.then(s):s(r)},setItem:(e,a)=>n.setItem(e,JSON.stringify(a,null==t?void 0:t.replacer)),removeItem:e=>n.removeItem(e)};return a}const vt=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then:e=>vt(e)(n),catch(e){return this}}}catch(n){return{then(e){return this},catch:e=>vt(e)(n)}}},yt=(e,t)=>(n,a,s)=>{let r={storage:ft(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1;const l=new Set,o=new Set;let c=r.storage;if(!c)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),n(...e)},a,s);const d=()=>{const e=r.partialize({...a()});return c.setItem(r.name,{state:e,version:r.version})},m=s.setState;s.setState=(e,t)=>{m(e,t),d()};const u=e((...e)=>{n(...e),d()},a,s);let p;s.getInitialState=()=>u;const h=()=>{var e,t;if(!c)return;i=!1,l.forEach(e=>{var t;return e(null!=(t=a())?t:u)});const s=(null==(t=r.onRehydrateStorage)?void 0:t.call(r,null!=(e=a())?e:u))||void 0;return vt(c.getItem.bind(c))(r.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===r.version)return[!1,e.state];if(r.migrate){const t=r.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;const[s,i]=e;if(p=r.merge(i,null!=(t=a())?t:u),n(p,!0),s)return d()}).then(()=>{null==s||s(p,void 0),p=a(),i=!0,o.forEach(e=>e(p))}).catch(e=>{null==s||s(void 0,e)})};return s.persist={setOptions:e=>{r={...r,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>h(),hasHydrated:()=>i,onHydrate:e=>(l.add(e),()=>{l.delete(e)}),onFinishHydration:e=>(o.add(e),()=>{o.delete(e)})},r.skipHydration||h(),p||u},bt=de()(xt((e,t)=>({patients:[],selectedPatient:null,isLoading:!1,error:null,searchQuery:"",filteredPatients:[],loadPatients:async()=>{e({isLoading:!0,error:null});try{const t=await(window.electronAPI?.patients?.getAll())||[];e({patients:t,filteredPatients:t,isLoading:!1})}catch(t){console.error("Error loading patients:",t),e({error:t instanceof Error?t.message:"Failed to load patients",isLoading:!1})}},createPatient:async n=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.patients.create(n),{patients:s}=t(),r=[...s,a];e({patients:r,isLoading:!1}),t().filterPatients(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("patient-added",{detail:{patientId:a.id,patientName:a.full_name||"New Patient"}})),window.dispatchEvent(new CustomEvent("patient-changed",{detail:{type:"created",patientId:a.id,patientName:a.full_name||"New Patient"}})))}catch(a){e({error:a instanceof Error?a.message:"Failed to create patient",isLoading:!1})}},updatePatient:async(n,a)=>{e({isLoading:!0,error:null});try{const s=await window.electronAPI.patients.update(n,a),{patients:r,selectedPatient:i}=t(),l=r.map(e=>e.id===n?s:e);e({patients:l,selectedPatient:i?.id===n?s:i,isLoading:!1}),t().filterPatients(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("patient-updated",{detail:{patientId:n,patientName:s.full_name||"Updated Patient"}})),window.dispatchEvent(new CustomEvent("patient-changed",{detail:{type:"updated",patientId:n,patientName:s.full_name||"Updated Patient"}})))}catch(s){e({error:s instanceof Error?s.message:"Failed to update patient",isLoading:!1})}},deletePatient:async n=>{e({isLoading:!0,error:null});try{const{patients:a,selectedPatient:s}=t(),r=a.find(e=>e.id===n);if(await window.electronAPI.patients.delete(n)){const i=a.filter(e=>e.id!==n);return e({patients:i,selectedPatient:s?.id===n?null:s,isLoading:!1}),t().filterPatients(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("patient-deleted",{detail:{patientId:n,patientName:r?r.full_name:"Unknown Patient"}})),{success:!0,patientName:r?r.full_name:"Unknown Patient"}}throw new Error("Failed to delete patient")}catch(a){throw e({error:a instanceof Error?a.message:"Failed to delete patient",isLoading:!1}),a}},setSelectedPatient:t=>{e({selectedPatient:t})},setSearchQuery:n=>{e({searchQuery:n}),t().filterPatients()},clearError:()=>{e({error:null})},searchPatients:async n=>{e({isLoading:!0,error:null});try{if(""===n.trim()){const{patients:a}=t();e({filteredPatients:a,searchQuery:n,isLoading:!1})}else{const t=await window.electronAPI.patients.search(n);e({filteredPatients:t,searchQuery:n,isLoading:!1})}}catch(a){e({error:a instanceof Error?a.message:"Search failed",isLoading:!1})}},filterPatients:()=>{const{patients:n,searchQuery:a}=t();if(""===a.trim())return void e({filteredPatients:n});const s=a.toLowerCase(),r=n.filter(e=>e.full_name.toLowerCase().includes(s)||e.phone?.toLowerCase().includes(s)||e.email?.toLowerCase().includes(s)||e.serial_number?.toLowerCase().includes(s)||e.patient_number&&e.patient_number.toString().includes(s));e({filteredPatients:r})},getPatientAppointments:async e=>{try{return await(window.electronAPI?.appointments?.getByPatient?.(e))||[]}catch(t){return console.error("Error fetching patient appointments:",t),[]}},getPatientPayments:async e=>{try{return await(window.electronAPI?.payments?.getByPatient?.(e))||[]}catch(t){return console.error("Error fetching patient payments:",t),[]}},getPatientStats:async e=>{try{const[a,s]=await Promise.all([t().getPatientAppointments(e),t().getPatientPayments(e)]),r=Math.max(0,a.length),i=Math.max(0,a.filter(e=>"completed"===e.status).length),l=Math.max(0,s.length),o=s.filter(e=>"completed"===e.status).reduce((e,t)=>e+("number"==typeof t.amount?t.amount:0),0);let c,d;if(a.length>0)try{const e=a.filter(e=>e.start_time&&!isNaN(new Date(e.start_time).getTime())).sort((e,t)=>new Date(t.start_time).getTime()-new Date(e.start_time).getTime());c=e.length>0?e[0].start_time:void 0}catch(n){console.warn("Error sorting appointments by date:",n)}if(s.length>0)try{const e=s.filter(e=>e.payment_date&&!isNaN(new Date(e.payment_date).getTime())).sort((e,t)=>new Date(t.payment_date).getTime()-new Date(e.payment_date).getTime());d=e.length>0?e[0].payment_date:void 0}catch(n){console.warn("Error sorting payments by date:",n)}return{totalAppointments:r,completedAppointments:i,totalPayments:l,totalAmountPaid:Math.round(100*o)/100,lastAppointment:c,lastPayment:d}}catch(n){return console.error("Error calculating patient stats:",n),{totalAppointments:0,completedAppointments:0,totalPayments:0,totalAmountPaid:0}}}}),{name:"patient-store"})),jt=e=>{const t=kt(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:e=>{const n=e.split("-");return""===n[0]&&1!==n.length&&n.shift(),wt(n,t)||_t(e)},getConflictingClassGroupIds:(e,t)=>{const s=n[e]||[];return t&&a[e]?[...s,...a[e]]:s}}},wt=(e,t)=>{if(0===e.length)return t.classGroupId;const n=e[0],a=t.nextPart.get(n),s=a?wt(e.slice(1),a):void 0;if(s)return s;if(0===t.validators.length)return;const r=e.join("-");return t.validators.find(({validator:e})=>e(r))?.classGroupId},Nt=/^\[(.+)\]$/,_t=e=>{if(Nt.test(e)){const t=Nt.exec(e)[1],n=t?.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},kt=e=>{const{theme:t,classGroups:n}=e,a={nextPart:new Map,validators:[]};for(const s in n)St(n[s],a,s,t);return a},St=(e,t,n,a)=>{e.forEach(e=>{if("string"==typeof e){return void((""===e?t:Ct(t,e)).classGroupId=n)}if("function"==typeof e)return $t(e)?void St(e(a),t,n,a):void t.validators.push({validator:e,classGroupId:n});Object.entries(e).forEach(([e,s])=>{St(s,Ct(t,e),n,a)})})},Ct=(e,t)=>{let n=e;return t.split("-").forEach(e=>{n.nextPart.has(e)||n.nextPart.set(e,{nextPart:new Map,validators:[]}),n=n.nextPart.get(e)}),n},$t=e=>e.isThemeGetter,Dt=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,a=new Map;const s=(s,r)=>{n.set(s,r),t++,t>e&&(t=0,a=n,n=new Map)};return{get(e){let t=n.get(e);return void 0!==t?t:void 0!==(t=a.get(e))?(s(e,t),t):void 0},set(e,t){n.has(e)?n.set(e,t):s(e,t)}}},Et=e=>{const{prefix:t,experimentalParseClassName:n}=e;let a=e=>{const t=[];let n,a=0,s=0,r=0;for(let o=0;o<e.length;o++){let i=e[o];if(0===a&&0===s){if(":"===i){t.push(e.slice(r,o)),r=o+1;continue}if("/"===i){n=o;continue}}"["===i?a++:"]"===i?a--:"("===i?s++:")"===i&&s--}const i=0===t.length?e:e.substring(r),l=Tt(i);return{modifiers:t,hasImportantModifier:l!==i,baseClassName:l,maybePostfixModifierPosition:n&&n>r?n-r:void 0}};if(t){const e=t+":",n=a;a=t=>t.startsWith(e)?n(t.substring(e.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:t,maybePostfixModifierPosition:void 0}}if(n){const e=a;a=t=>n({className:t,parseClassName:e})}return a},Tt=e=>e.endsWith("!")?e.substring(0,e.length-1):e.startsWith("!")?e.substring(1):e,At=e=>{const t=Object.fromEntries(e.orderSensitiveModifiers.map(e=>[e,!0]));return e=>{if(e.length<=1)return e;const n=[];let a=[];return e.forEach(e=>{"["===e[0]||t[e]?(n.push(...a.sort(),e),a=[]):a.push(e)}),n.push(...a.sort()),n}},Ft=/\s+/;function Pt(){let e,t,n=0,a="";for(;n<arguments.length;)(e=arguments[n++])&&(t=Rt(e))&&(a&&(a+=" "),a+=t);return a}const Rt=e=>{if("string"==typeof e)return e;let t,n="";for(let a=0;a<e.length;a++)e[a]&&(t=Rt(e[a]))&&(n&&(n+=" "),n+=t);return n};function Ot(e,...t){let n,a,s,r=function(l){const o=t.reduce((e,t)=>t(e),e());return n=(e=>({cache:Dt(e.cacheSize),parseClassName:Et(e),sortModifiers:At(e),...jt(e)}))(o),a=n.cache.get,s=n.cache.set,r=i,i(l)};function i(e){const t=a(e);if(t)return t;const r=((e,t)=>{const{parseClassName:n,getClassGroupId:a,getConflictingClassGroupIds:s,sortModifiers:r}=t,i=[],l=e.trim().split(Ft);let o="";for(let c=l.length-1;c>=0;c-=1){const e=l[c],{isExternal:t,modifiers:d,hasImportantModifier:m,baseClassName:u,maybePostfixModifierPosition:p}=n(e);if(t){o=e+(o.length>0?" "+o:o);continue}let h=!!p,x=a(h?u.substring(0,p):u);if(!x){if(!h){o=e+(o.length>0?" "+o:o);continue}if(x=a(u),!x){o=e+(o.length>0?" "+o:o);continue}h=!1}const g=r(d).join(":"),f=m?g+"!":g,v=f+x;if(i.includes(v))continue;i.push(v);const y=s(x,h);for(let n=0;n<y.length;++n){const e=y[n];i.push(f+e)}o=e+(o.length>0?" "+o:o)}return o})(e,n);return s(e,r),r}return function(){return r(Pt.apply(null,arguments))}}const Mt=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},Lt=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,It=/^\((?:(\w[\w-]*):)?(.+)\)$/i,zt=/^\d+\/\d+$/,Bt=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Vt=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Yt=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,qt=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Ut=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ht=e=>zt.test(e),Gt=e=>!!e&&!Number.isNaN(Number(e)),Wt=e=>!!e&&Number.isInteger(Number(e)),Kt=e=>e.endsWith("%")&&Gt(e.slice(0,-1)),Zt=e=>Bt.test(e),Qt=()=>!0,Xt=e=>Vt.test(e)&&!Yt.test(e),Jt=()=>!1,en=e=>qt.test(e),tn=e=>Ut.test(e),nn=e=>!sn(e)&&!mn(e),an=e=>vn(e,wn,Jt),sn=e=>Lt.test(e),rn=e=>vn(e,Nn,Xt),ln=e=>vn(e,_n,Gt),on=e=>vn(e,bn,Jt),cn=e=>vn(e,jn,tn),dn=e=>vn(e,Sn,en),mn=e=>It.test(e),un=e=>yn(e,Nn),pn=e=>yn(e,kn),hn=e=>yn(e,bn),xn=e=>yn(e,wn),gn=e=>yn(e,jn),fn=e=>yn(e,Sn,!0),vn=(e,t,n)=>{const a=Lt.exec(e);return!!a&&(a[1]?t(a[1]):n(a[2]))},yn=(e,t,n=!1)=>{const a=It.exec(e);return!!a&&(a[1]?t(a[1]):n)},bn=e=>"position"===e||"percentage"===e,jn=e=>"image"===e||"url"===e,wn=e=>"length"===e||"size"===e||"bg-size"===e,Nn=e=>"length"===e,_n=e=>"number"===e,kn=e=>"family-name"===e,Sn=e=>"shadow"===e,Cn=Ot(()=>{const e=Mt("color"),t=Mt("font"),n=Mt("text"),a=Mt("font-weight"),s=Mt("tracking"),r=Mt("leading"),i=Mt("breakpoint"),l=Mt("container"),o=Mt("spacing"),c=Mt("radius"),d=Mt("shadow"),m=Mt("inset-shadow"),u=Mt("text-shadow"),p=Mt("drop-shadow"),h=Mt("blur"),x=Mt("perspective"),g=Mt("aspect"),f=Mt("ease"),v=Mt("animate"),y=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",mn,sn],b=()=>[mn,sn,o],j=()=>[Ht,"full","auto",...b()],w=()=>[Wt,"none","subgrid",mn,sn],N=()=>["auto",{span:["full",Wt,mn,sn]},Wt,mn,sn],_=()=>[Wt,"auto",mn,sn],k=()=>["auto","min","max","fr",mn,sn],S=()=>["auto",...b()],C=()=>[Ht,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...b()],$=()=>[e,mn,sn],D=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom",hn,on,{position:[mn,sn]}],E=()=>["auto","cover","contain",xn,an,{size:[mn,sn]}],T=()=>[Kt,un,rn],A=()=>["","none","full",c,mn,sn],F=()=>["",Gt,un,rn],P=()=>[Gt,Kt,hn,on],R=()=>["","none",h,mn,sn],O=()=>["none",Gt,mn,sn],M=()=>["none",Gt,mn,sn],L=()=>[Gt,mn,sn],I=()=>[Ht,"full",...b()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Zt],breakpoint:[Zt],color:[Qt],container:[Zt],"drop-shadow":[Zt],ease:["in","out","in-out"],font:[nn],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Zt],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Zt],shadow:[Zt],spacing:["px",Gt],text:[Zt],"text-shadow":[Zt],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Ht,sn,mn,g]}],container:["container"],columns:[{columns:[Gt,sn,mn,l]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:y()}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:j()}],"inset-x":[{"inset-x":j()}],"inset-y":[{"inset-y":j()}],start:[{start:j()}],end:[{end:j()}],top:[{top:j()}],right:[{right:j()}],bottom:[{bottom:j()}],left:[{left:j()}],visibility:["visible","invisible","collapse"],z:[{z:[Wt,"auto",mn,sn]}],basis:[{basis:[Ht,"full","auto",l,...b()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Gt,Ht,"auto","initial","none",sn]}],grow:[{grow:["",Gt,mn,sn]}],shrink:[{shrink:["",Gt,mn,sn]}],order:[{order:[Wt,"first","last","none",mn,sn]}],"grid-cols":[{"grid-cols":w()}],"col-start-end":[{col:N()}],"col-start":[{"col-start":_()}],"col-end":[{"col-end":_()}],"grid-rows":[{"grid-rows":w()}],"row-start-end":[{row:N()}],"row-start":[{"row-start":_()}],"row-end":[{"row-end":_()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":k()}],"auto-rows":[{"auto-rows":k()}],gap:[{gap:b()}],"gap-x":[{"gap-x":b()}],"gap-y":[{"gap-y":b()}],"justify-content":[{justify:["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe","normal"]}],"justify-items":[{"justify-items":["start","end","center","stretch","center-safe","end-safe","normal"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"align-items":[{items:["start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"align-self":[{self:["auto","start","end","center","stretch","center-safe","end-safe",{baseline:["","last"]}]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"]}],"place-items":[{"place-items":["start","end","center","stretch","center-safe","end-safe","baseline"]}],"place-self":[{"place-self":["auto","start","end","center","stretch","center-safe","end-safe"]}],p:[{p:b()}],px:[{px:b()}],py:[{py:b()}],ps:[{ps:b()}],pe:[{pe:b()}],pt:[{pt:b()}],pr:[{pr:b()}],pb:[{pb:b()}],pl:[{pl:b()}],m:[{m:S()}],mx:[{mx:S()}],my:[{my:S()}],ms:[{ms:S()}],me:[{me:S()}],mt:[{mt:S()}],mr:[{mr:S()}],mb:[{mb:S()}],ml:[{ml:S()}],"space-x":[{"space-x":b()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":b()}],"space-y-reverse":["space-y-reverse"],size:[{size:C()}],w:[{w:[l,"screen",...C()]}],"min-w":[{"min-w":[l,"screen","none",...C()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[i]},...C()]}],h:[{h:["screen","lh",...C()]}],"min-h":[{"min-h":["screen","lh","none",...C()]}],"max-h":[{"max-h":["screen","lh",...C()]}],"font-size":[{text:["base",n,un,rn]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[a,mn,ln]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Kt,sn]}],"font-family":[{font:[pn,sn,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,mn,sn]}],"line-clamp":[{"line-clamp":[Gt,"none",mn,ln]}],leading:[{leading:[r,...b()]}],"list-image":[{"list-image":["none",mn,sn]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",mn,sn]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:$()}],"text-color":[{text:$()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","wavy"]}],"text-decoration-thickness":[{decoration:[Gt,"from-font","auto",mn,rn]}],"text-decoration-color":[{decoration:$()}],"underline-offset":[{"underline-offset":[Gt,"auto",mn,sn]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:b()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",mn,sn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",mn,sn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:D()}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:E()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Wt,mn,sn],radial:["",mn,sn],conic:[Wt,mn,sn]},gn,cn]}],"bg-color":[{bg:$()}],"gradient-from-pos":[{from:T()}],"gradient-via-pos":[{via:T()}],"gradient-to-pos":[{to:T()}],"gradient-from":[{from:$()}],"gradient-via":[{via:$()}],"gradient-to":[{to:$()}],rounded:[{rounded:A()}],"rounded-s":[{"rounded-s":A()}],"rounded-e":[{"rounded-e":A()}],"rounded-t":[{"rounded-t":A()}],"rounded-r":[{"rounded-r":A()}],"rounded-b":[{"rounded-b":A()}],"rounded-l":[{"rounded-l":A()}],"rounded-ss":[{"rounded-ss":A()}],"rounded-se":[{"rounded-se":A()}],"rounded-ee":[{"rounded-ee":A()}],"rounded-es":[{"rounded-es":A()}],"rounded-tl":[{"rounded-tl":A()}],"rounded-tr":[{"rounded-tr":A()}],"rounded-br":[{"rounded-br":A()}],"rounded-bl":[{"rounded-bl":A()}],"border-w":[{border:F()}],"border-w-x":[{"border-x":F()}],"border-w-y":[{"border-y":F()}],"border-w-s":[{"border-s":F()}],"border-w-e":[{"border-e":F()}],"border-w-t":[{"border-t":F()}],"border-w-r":[{"border-r":F()}],"border-w-b":[{"border-b":F()}],"border-w-l":[{"border-l":F()}],"divide-x":[{"divide-x":F()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":F()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:["solid","dashed","dotted","double","hidden","none"]}],"divide-style":[{divide:["solid","dashed","dotted","double","hidden","none"]}],"border-color":[{border:$()}],"border-color-x":[{"border-x":$()}],"border-color-y":[{"border-y":$()}],"border-color-s":[{"border-s":$()}],"border-color-e":[{"border-e":$()}],"border-color-t":[{"border-t":$()}],"border-color-r":[{"border-r":$()}],"border-color-b":[{"border-b":$()}],"border-color-l":[{"border-l":$()}],"divide-color":[{divide:$()}],"outline-style":[{outline:["solid","dashed","dotted","double","none","hidden"]}],"outline-offset":[{"outline-offset":[Gt,mn,sn]}],"outline-w":[{outline:["",Gt,un,rn]}],"outline-color":[{outline:$()}],shadow:[{shadow:["","none",d,fn,dn]}],"shadow-color":[{shadow:$()}],"inset-shadow":[{"inset-shadow":["none",m,fn,dn]}],"inset-shadow-color":[{"inset-shadow":$()}],"ring-w":[{ring:F()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:$()}],"ring-offset-w":[{"ring-offset":[Gt,rn]}],"ring-offset-color":[{"ring-offset":$()}],"inset-ring-w":[{"inset-ring":F()}],"inset-ring-color":[{"inset-ring":$()}],"text-shadow":[{"text-shadow":["none",u,fn,dn]}],"text-shadow-color":[{"text-shadow":$()}],opacity:[{opacity:[Gt,mn,sn]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Gt]}],"mask-image-linear-from-pos":[{"mask-linear-from":P()}],"mask-image-linear-to-pos":[{"mask-linear-to":P()}],"mask-image-linear-from-color":[{"mask-linear-from":$()}],"mask-image-linear-to-color":[{"mask-linear-to":$()}],"mask-image-t-from-pos":[{"mask-t-from":P()}],"mask-image-t-to-pos":[{"mask-t-to":P()}],"mask-image-t-from-color":[{"mask-t-from":$()}],"mask-image-t-to-color":[{"mask-t-to":$()}],"mask-image-r-from-pos":[{"mask-r-from":P()}],"mask-image-r-to-pos":[{"mask-r-to":P()}],"mask-image-r-from-color":[{"mask-r-from":$()}],"mask-image-r-to-color":[{"mask-r-to":$()}],"mask-image-b-from-pos":[{"mask-b-from":P()}],"mask-image-b-to-pos":[{"mask-b-to":P()}],"mask-image-b-from-color":[{"mask-b-from":$()}],"mask-image-b-to-color":[{"mask-b-to":$()}],"mask-image-l-from-pos":[{"mask-l-from":P()}],"mask-image-l-to-pos":[{"mask-l-to":P()}],"mask-image-l-from-color":[{"mask-l-from":$()}],"mask-image-l-to-color":[{"mask-l-to":$()}],"mask-image-x-from-pos":[{"mask-x-from":P()}],"mask-image-x-to-pos":[{"mask-x-to":P()}],"mask-image-x-from-color":[{"mask-x-from":$()}],"mask-image-x-to-color":[{"mask-x-to":$()}],"mask-image-y-from-pos":[{"mask-y-from":P()}],"mask-image-y-to-pos":[{"mask-y-to":P()}],"mask-image-y-from-color":[{"mask-y-from":$()}],"mask-image-y-to-color":[{"mask-y-to":$()}],"mask-image-radial":[{"mask-radial":[mn,sn]}],"mask-image-radial-from-pos":[{"mask-radial-from":P()}],"mask-image-radial-to-pos":[{"mask-radial-to":P()}],"mask-image-radial-from-color":[{"mask-radial-from":$()}],"mask-image-radial-to-color":[{"mask-radial-to":$()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"]}],"mask-image-conic-pos":[{"mask-conic":[Gt]}],"mask-image-conic-from-pos":[{"mask-conic-from":P()}],"mask-image-conic-to-pos":[{"mask-conic-to":P()}],"mask-image-conic-from-color":[{"mask-conic-from":$()}],"mask-image-conic-to-color":[{"mask-conic-to":$()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:D()}],"mask-repeat":[{mask:["no-repeat",{repeat:["","x","y","space","round"]}]}],"mask-size":[{mask:E()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",mn,sn]}],filter:[{filter:["","none",mn,sn]}],blur:[{blur:R()}],brightness:[{brightness:[Gt,mn,sn]}],contrast:[{contrast:[Gt,mn,sn]}],"drop-shadow":[{"drop-shadow":["","none",p,fn,dn]}],"drop-shadow-color":[{"drop-shadow":$()}],grayscale:[{grayscale:["",Gt,mn,sn]}],"hue-rotate":[{"hue-rotate":[Gt,mn,sn]}],invert:[{invert:["",Gt,mn,sn]}],saturate:[{saturate:[Gt,mn,sn]}],sepia:[{sepia:["",Gt,mn,sn]}],"backdrop-filter":[{"backdrop-filter":["","none",mn,sn]}],"backdrop-blur":[{"backdrop-blur":R()}],"backdrop-brightness":[{"backdrop-brightness":[Gt,mn,sn]}],"backdrop-contrast":[{"backdrop-contrast":[Gt,mn,sn]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Gt,mn,sn]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Gt,mn,sn]}],"backdrop-invert":[{"backdrop-invert":["",Gt,mn,sn]}],"backdrop-opacity":[{"backdrop-opacity":[Gt,mn,sn]}],"backdrop-saturate":[{"backdrop-saturate":[Gt,mn,sn]}],"backdrop-sepia":[{"backdrop-sepia":["",Gt,mn,sn]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":b()}],"border-spacing-x":[{"border-spacing-x":b()}],"border-spacing-y":[{"border-spacing-y":b()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",mn,sn]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Gt,"initial",mn,sn]}],ease:[{ease:["linear","initial",f,mn,sn]}],delay:[{delay:[Gt,mn,sn]}],animate:[{animate:["none",v,mn,sn]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[x,mn,sn]}],"perspective-origin":[{"perspective-origin":y()}],rotate:[{rotate:O()}],"rotate-x":[{"rotate-x":O()}],"rotate-y":[{"rotate-y":O()}],"rotate-z":[{"rotate-z":O()}],scale:[{scale:M()}],"scale-x":[{"scale-x":M()}],"scale-y":[{"scale-y":M()}],"scale-z":[{"scale-z":M()}],"scale-3d":["scale-3d"],skew:[{skew:L()}],"skew-x":[{"skew-x":L()}],"skew-y":[{"skew-y":L()}],transform:[{transform:[mn,sn,"","none","gpu","cpu"]}],"transform-origin":[{origin:y()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:I()}],"translate-x":[{"translate-x":I()}],"translate-y":[{"translate-y":I()}],"translate-z":[{"translate-z":I()}],"translate-none":["translate-none"],accent:[{accent:$()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:$()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",mn,sn]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":b()}],"scroll-mx":[{"scroll-mx":b()}],"scroll-my":[{"scroll-my":b()}],"scroll-ms":[{"scroll-ms":b()}],"scroll-me":[{"scroll-me":b()}],"scroll-mt":[{"scroll-mt":b()}],"scroll-mr":[{"scroll-mr":b()}],"scroll-mb":[{"scroll-mb":b()}],"scroll-ml":[{"scroll-ml":b()}],"scroll-p":[{"scroll-p":b()}],"scroll-px":[{"scroll-px":b()}],"scroll-py":[{"scroll-py":b()}],"scroll-ps":[{"scroll-ps":b()}],"scroll-pe":[{"scroll-pe":b()}],"scroll-pt":[{"scroll-pt":b()}],"scroll-pr":[{"scroll-pr":b()}],"scroll-pb":[{"scroll-pb":b()}],"scroll-pl":[{"scroll-pl":b()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",mn,sn]}],fill:[{fill:["none",...$()]}],"stroke-w":[{stroke:[Gt,un,rn,ln]}],stroke:[{stroke:["none",...$()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}}),$n=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"];const Dn={calendar:{lastDay:"[أمس في] LT",sameDay:"[اليوم في] LT",nextDay:"[غداً في] LT",lastWeek:"dddd [الماضي في] LT",nextWeek:"dddd [في] LT",sameElse:"L"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},months:$n,monthsShort:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],weekdays:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"],weekdaysShort:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],weekdaysMin:["ح","ن","ث","ر","خ","ج","س"],week:{dow:6,doy:12}};function En(...e){return Cn(me(e))}const Tn={USD:{code:"USD",symbol:"$",name:"US Dollar",nameAr:"دولار أمريكي",decimals:2,locale:"en-US",position:"before"},SAR:{code:"SAR",symbol:"ر.س",name:"Saudi Riyal",nameAr:"ريال سعودي",decimals:2,locale:"ar-SA",position:"after"},AED:{code:"AED",symbol:"د.إ",name:"UAE Dirham",nameAr:"درهم إماراتي",decimals:2,locale:"ar-AE",position:"after"},KWD:{code:"KWD",symbol:"د.ك",name:"Kuwaiti Dinar",nameAr:"دينار كويتي",decimals:3,locale:"ar-KW",position:"after"},EUR:{code:"EUR",symbol:"€",name:"Euro",nameAr:"يورو",decimals:2,locale:"en-EU",position:"before"},EGP:{code:"EGP",symbol:"ج.م",name:"Egyptian Pound",nameAr:"جنيه مصري",decimals:2,locale:"ar-EG",position:"after"},GBP:{code:"GBP",symbol:"£",name:"British Pound",nameAr:"جنيه إسترليني",decimals:2,locale:"en-GB",position:"before"},QAR:{code:"QAR",symbol:"ر.ق",name:"Qatari Riyal",nameAr:"ريال قطري",decimals:2,locale:"ar-QA",position:"after"},BHD:{code:"BHD",symbol:"د.ب",name:"Bahraini Dinar",nameAr:"دينار بحريني",decimals:3,locale:"ar-BH",position:"after"},OMR:{code:"OMR",symbol:"ر.ع",name:"Omani Rial",nameAr:"ريال عماني",decimals:3,locale:"ar-OM",position:"after"},SYP:{code:"SYP",symbol:"ل.س",name:"Syrian Pound",nameAr:"ليرة سورية",decimals:2,locale:"ar-SY",position:"after"},TRY:{code:"TRY",symbol:"₺",name:"Turkish Lira",nameAr:"ليرة تركية",decimals:2,locale:"tr-TR",position:"after"}},An={$:"USD","$ أمريكي":"USD","ريال":"SAR","ريال سعودي":"SAR","درهم":"AED","درهم إماراتي":"AED","دينار":"KWD","دينار كويتي":"KWD","دولار":"USD","دولار أمريكي":"USD","يورو":"EUR","جنيه":"EGP","جنيه مصري":"EGP",SAR:"SAR",AED:"AED",KWD:"KWD",USD:"USD",EUR:"EUR",EGP:"EGP",GBP:"GBP",QAR:"QAR",BHD:"BHD",OMR:"OMR","ليرة":"SYP","ليرة سورية":"SYP",SYP:"SYP","ليرة تركية":"TRY","تركية":"TRY",TRY:"TRY"};function Fn(e){return Tn[An[e]||e]||Tn.USD}let Pn="USD";function Rn(e){Pn=e}function On(){return Pn}function Mn(e,t){const n=Number(e);if(isNaN(n)||!isFinite(n)){console.warn("Invalid amount for currency formatting:",e);return Ln(0,Fn(t||On()))}return Ln(n,Fn(t||On()))}function Ln(e,t){const n=Number(e);if(isNaN(n)||!isFinite(n))return`${t.symbol}0.${"0".repeat(t.decimals)}`;try{return new Intl.NumberFormat(t.locale,{style:"currency",currency:t.code,minimumFractionDigits:t.decimals,maximumFractionDigits:t.decimals}).format(n)}catch(a){console.warn(`Error formatting currency ${t.code}, using manual formatting`);try{const e=new Intl.NumberFormat("en-US",{minimumFractionDigits:t.decimals,maximumFractionDigits:t.decimals}).format(n);return"before"===t.position?`${t.symbol}${e}`:`${e} ${t.symbol}`}catch(s){const e=n.toFixed(t.decimals);return"before"===t.position?`${t.symbol}${e}`:`${e} ${t.symbol}`}}}function In(e,t){if(!e)return"--";try{const t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"--";const n=t.getDate(),a=t.getMonth()+1,s=t.getFullYear(),r=n.toString().padStart(2,"0");return`${r}/${a.toString().padStart(2,"0")}/${s}`}catch(n){return console.warn("Error formatting date:",n,"Input:",e),"--"}}function zn(e){if(!e)return"--";try{const t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"--";const n=t.getDate(),a=t.getMonth()+1,s=t.getFullYear(),r=n.toString().padStart(2,"0"),i=`${r}/${a.toString().padStart(2,"0")}/${s}`;return`${i} - ${t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!0})}`}catch(t){return console.warn("Error formatting date time:",t,"Input:",e),"--"}}function Bn(e){if(!e)return"--";try{const t=new Date(e);return isNaN(t.getTime())?"--":t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return console.warn("Error formatting time:",t,"Input:",e),"--"}}function Vn(e=new Date){const t=new Date(e),n=t.getDay();return t.setDate(e.getDate()-n),t.setHours(0,0,0,0),t}function Yn(e,t){return function(e,t){return t<0||t>11?(console.warn("Invalid month index:",t),`${e}`):`${$n[t]} ${e}`}(e,t)}function qn(e){switch(e){case"scheduled":return"bg-primary/10 text-primary border-primary/20";case"completed":return"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800";case"cancelled":return"bg-destructive/10 text-destructive border-destructive/20";default:return"bg-muted text-muted-foreground border-border"}}const Un={primary:["#0ea5e9","#06b6d4","#3b82f6","#1e40af","#0284c7","#0369a1","#075985","#0c4a6e"],medical:["#10b981","#059669","#047857","#065f46","#064e3b","#22c55e","#16a34a","#15803d"],status:["#10b981","#f59e0b","#ef4444","#6b7280","#8b5cf6","#06b6d4","#f97316","#ec4899"],financial:["#059669","#dc2626","#d97706","#7c3aed","#0891b2","#be185d","#ea580c","#4338ca"],categorical:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#f97316","#ec4899","#84cc16","#6366f1"],gradients:{blue:["#dbeafe","#3b82f6"],green:["#dcfce7","#10b981"],purple:["#f3e8ff","#8b5cf6"],orange:["#fed7aa","#f97316"],red:["#fecaca","#ef4444"],cyan:["#cffafe","#06b6d4"]},inventory:["#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#f97316","#ec4899","#6b7280"],demographics:["#3b82f6","#ec4899","#10b981","#f59e0b","#8b5cf6","#06b6d4","#f97316","#6b7280"],treatments:["#10b981","#3b82f6","#8b5cf6","#f59e0b","#ef4444","#06b6d4","#f97316","#ec4899"]};function Hn(e="primary",t=!1){const n=Un[e];return t?n.map(e=>{const t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16),s=Math.min(255,Math.round(1.2*t)),r=Math.min(255,Math.round(1.2*n)),i=Math.min(255,Math.round(1.2*a));return`#${s.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`}):n}const Gn={responsive:{mobile:{width:"100%",height:280},tablet:{width:"100%",height:320},desktop:{width:"100%",height:380},large:{width:"100%",height:420}},grid:{strokeDasharray:"3 3",stroke:"#e5e7eb",strokeOpacity:.5},darkGrid:{strokeDasharray:"3 3",stroke:"#374151",strokeOpacity:.7},axis:{light:{tick:{fontSize:12,fill:"#6b7280",fontFamily:"Inter, sans-serif"},axisLine:{stroke:"#d1d5db",strokeWidth:1},tickLine:{stroke:"#d1d5db",strokeWidth:1}},dark:{tick:{fontSize:12,fill:"#9ca3af",fontFamily:"Inter, sans-serif"},axisLine:{stroke:"#4b5563",strokeWidth:1},tickLine:{stroke:"#4b5563",strokeWidth:1}}},tooltip:{contentStyle:{backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",fontSize:"14px",fontWeight:"500",fontFamily:"Inter, sans-serif",direction:"rtl",textAlign:"right"},darkContentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.3)",fontSize:"14px",fontWeight:"500",color:"#f9fafb",fontFamily:"Inter, sans-serif",direction:"rtl",textAlign:"right"}},animation:{duration:800,easing:"ease-in-out",delay:0},pie:{outerRadius:120,innerRadius:50,paddingAngle:2,strokeWidth:2},bar:{radius:[4,4,0,0],minPointSize:5,maxBarSize:100,barCategoryGap:"20%"},line:{strokeWidth:3,dot:{strokeWidth:2,r:4},activeDot:{r:6,strokeWidth:2}},area:{strokeWidth:3,fillOpacity:.3}};function Wn(e=!1){return{...Gn,grid:e?Gn.darkGrid:Gn.grid,tooltip:e?Gn.tooltip.darkContentStyle:Gn.tooltip.contentStyle,axis:e?Gn.axis.dark:Gn.axis.light}}function Kn(e="primary",t=!1,n=1){const a=Hn(e,t);if(n>a.length){const e=[];for(let t=0;t<n;t++)e.push(a[t%a.length]);return e}return a.slice(0,n)}function Zn(e,t="number",n){const a=Number(e);if(isNaN(a)||!isFinite(a))switch(console.warn("Invalid value for chart formatting:",e),t){case"currency":const e=Fn(n||On());return`${e.symbol}0.${"0".repeat(e.decimals)}`;case"percentage":return"0%";default:return"0"}try{switch(t){case"currency":return Mn(a,n||On());case"percentage":const e=Math.round(10*a)/10;return`${isNaN(e)?0:e}%`;default:try{return a.toLocaleString("ar-SA",{maximumFractionDigits:2})}catch(s){return a.toFixed(2)}}}catch(r){return console.warn("Error formatting chart value:",r),a.toString()}}class Qn{static listeners=new Map;static isInitialized=!1;static init(){this.isInitialized||(console.log("🔔 AlertsEventSystem: Initializing..."),this.isInitialized=!0,setInterval(()=>{this.cleanupListeners()},6e4))}static addEventListener(e,t){this.init(),this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),console.log(`🔔 AlertsEventSystem: Added listener for '${e}' (total: ${this.listeners.get(e).size})`)}static removeEventListener(e,t){this.listeners.has(e)&&(this.listeners.get(e).delete(t),console.log(`🔔 AlertsEventSystem: Removed listener for '${e}' (remaining: ${this.listeners.get(e).size})`),0===this.listeners.get(e).size&&this.listeners.delete(e))}static emit(e,t){if(console.log(`🔔 AlertsEventSystem: Emitting event '${e}'`,t?"with data:":"without data",t),this.listeners.has(e)){const n=Array.from(this.listeners.get(e));console.log(`🔔 AlertsEventSystem: Notifying ${n.length} listeners for '${e}'`),n.forEach((n,a)=>{try{console.log(`🔔 AlertsEventSystem: Calling listener ${a} for '${e}'`),n(t),console.log(`✅ AlertsEventSystem: Listener ${a} for '${e}' completed`)}catch(s){console.error(`❌ Error in event listener ${a} for '${e}':`,s)}})}else console.log(`🔔 AlertsEventSystem: No listeners for event '${e}'`);console.log(`🔔 AlertsEventSystem: Emitting window event for '${e}'`),this.emitWindowEvent(e,t)}static emitWindowEvent(e,t){if("undefined"!=typeof window)try{window.dispatchEvent(new CustomEvent(`alerts:${e}`,{detail:t}));[`alert:${e}`,`smart-alert:${e}`,e].forEach(e=>{try{window.dispatchEvent(new CustomEvent(e,{detail:t}))}catch(n){console.warn(`Could not dispatch compat event '${e}':`,n)}})}catch(n){console.warn("Could not dispatch window events:",n)}}static cleanupListeners(){let e=0;this.listeners.forEach((t,n)=>{e+=t.size}),e>100&&console.warn(`🔔 AlertsEventSystem: High listener count detected (${e}). Consider cleanup.`)}static removeAllListeners(){console.log("🔔 AlertsEventSystem: Removing all listeners"),this.listeners.clear()}static getListenerCount(e){return this.listeners.get(e)?.size||0}static getAllListenerCounts(){const e={};return this.listeners.forEach((t,n)=>{e[n]=t.size}),e}}class Xn{static formatAmount(e){try{let n=On();try{const e=window.electronAPI?.settings?.getCurrency?.();e&&(n=e)}catch(t){}return Mn(e,n)}catch(n){return console.warn("Error formatting currency in alerts:",n),Mn(e,On())}}static async getAllAlerts(){const e=Date.now();try{console.log("🔄 Starting to load all alerts...");let n=[];try{n=await(window.electronAPI?.smartAlerts?.getAll?.())||[],console.log("📋 Loaded saved alerts from database:",n.length)}catch(t){console.error("❌ Error loading saved alerts:",t)}try{await this.cleanupOutdatedAlerts()}catch(t){console.error("❌ Error during cleanup:",t)}let a=[];try{a=await this.generateSmartAlerts(),console.log("🔄 Generated new alerts from real data:",a.length)}catch(t){console.error("❌ Error generating alerts:",t)}const s=a.filter(e=>{const t=n.find(t=>t.id===e.id);return!t||(console.log("📋 Alert already exists, skipping generation:",e.id,"isRead:",t.isRead),!1)});console.log(`📊 Filtered alerts: ${a.length} generated, ${s.length} new to save`);for(const e of s)try{if(!e.id){console.warn("⚠️ Alert missing ID, skipping:",e.title);continue}await(window.electronAPI?.smartAlerts?.create?.(e))?console.log("💾 Saved new alert to database:",e.id,e.title):console.log("⚠️ Alert creation skipped (duplicate found):",e.title)}catch(t){console.error("Error saving alert to database:",t)}const r=[...n,...s],i=this.removeDuplicateAlerts(r);console.log(`📊 Final merge: ${n.length} saved + ${s.length} new = ${i.length} total`);try{await this.clearExpiredSnoozedAlerts()}catch(t){console.error("❌ Error clearing expired snoozed alerts:",t)}const l=this.sortAlertsByPriority(i),o=Date.now()-e;return console.log("✅ Final alerts count:",l.length),console.log("📊 Alert breakdown:",{total:l.length,unread:l.filter(e=>!e.isRead).length,undismissed:l.filter(e=>!e.isDismissed).length,actionRequired:l.filter(e=>e.actionRequired).length,byPriority:{high:l.filter(e=>"high"===e.priority).length,medium:l.filter(e=>"medium"===e.priority).length,low:l.filter(e=>"low"===e.priority).length},byType:l.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{})}),console.log(`⏱️ Alert loading completed in ${o}ms`),l}catch(t){const n=Date.now()-e;return console.error(`❌ Error getting all alerts (${n}ms):`,t),[]}}static async generateSmartAlerts(){const e=[];try{console.log("🔄 Generating alerts from real data...");const t=await this.generateAppointmentAlerts();console.log("📅 Generated appointment alerts:",t.length),e.push(...t);const n=await this.generatePaymentAlerts();console.log("💰 Generated payment alerts:",n.length),e.push(...n);const a=await this.generateTreatmentAlerts();console.log("🦷 Generated treatment alerts:",a.length),e.push(...a);const s=await this.generatePrescriptionAlerts();console.log("💊 Generated prescription alerts:",s.length),e.push(...s);const r=await this.generateFollowUpAlerts();console.log("👤 Generated follow-up alerts:",r.length),e.push(...r);const i=await this.generateInventoryAlerts();console.log("📦 Generated inventory alerts:",i.length),e.push(...i);const l=await this.generateLabOrderAlerts();console.log("🧪 Generated lab order alerts:",l.length),e.push(...l);const o=await this.generateClinicNeedsAlerts();console.log("🏥 Generated clinic needs alerts:",o.length),e.push(...o),console.log("✅ Total generated alerts:",e.length)}catch(t){console.error("❌ Error generating smart alerts:",t)}return e}static async generateAppointmentAlerts(){const e=[];try{const t=await(window.electronAPI?.appointments?.getAll?.())||[];console.log("📅 Checking appointments for alerts:",t.length);const n=new Date,a=new Date(n);a.setDate(a.getDate()+1),t.forEach(t=>{if(!t.id)return void console.warn("Appointment missing ID, skipping");if(!t.start_time)return void console.warn("Appointment missing start_time:",t.id);const s=new Date(t.start_time);if(isNaN(s.getTime()))console.warn("Invalid appointment date:",t.start_time,"for appointment:",t.id);else{if(this.isSameDay(s,n)&&"scheduled"===t.status){const n=t.patient?.full_name||"مريض غير محدد",a=t.patient_id||null;e.push({id:`appointment_today_${t.id}`,type:"appointment",priority:"high",title:`موعد اليوم - ${n}`,description:`موعد مجدول اليوم في ${this.formatTime(t.start_time)} - ${t.title||"موعد"}`,patientId:a,patientName:"مريض غير محدد"!==n?n:null,relatedData:{appointmentId:t.id},actionRequired:!0,dueDate:t.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(this.isSameDay(s,a)&&"scheduled"===t.status){const n=t.patient?.full_name||"مريض غير محدد",a=t.patient_id||null;e.push({id:`appointment_tomorrow_${t.id}`,type:"appointment",priority:"medium",title:`موعد غداً - ${n}`,description:`موعد مجدول غداً في ${this.formatTime(t.start_time)} - ${t.title||"موعد"}`,patientId:a,patientName:"مريض غير محدد"!==n?n:null,relatedData:{appointmentId:t.id},actionRequired:!1,dueDate:t.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(s<n&&"scheduled"===t.status){const a=`appointment_overdue_${t.id}`,r=Math.floor((n.getTime()-s.getTime())/864e5),i=t.patient?.full_name||"مريض غير محدد",l=t.patient_id||null;e.push({id:a,type:"appointment",priority:"high",title:`موعد متأخر - ${i}`,description:`موعد متأخر منذ ${r} يوم - ${t.title||"موعد"}`,patientId:l,patientName:"مريض غير محدد"!==i?i:null,relatedData:{appointmentId:t.id},actionRequired:!0,dueDate:t.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(("confirmed"===t.status||"scheduled"===t.status)&&this.isSameDay(s,n)){const n=new Date(t.start_time),a=new Date,s=(n.getTime()-a.getTime())/36e5;if(s<=6&&s>=2){const n=t.patient?.full_name||"مريض غير محدد",a=t.patient_id||null;e.push({id:`appointment_reminder_${t.id}`,type:"appointment",priority:"medium",title:`تذكير موعد - ${n}`,description:`موعد خلال ${Math.round(s)} ساعة - ${t.title||"موعد"}`,patientId:a,patientName:"مريض غير محدد"!==n?n:null,relatedData:{appointmentId:t.id},actionRequired:!1,dueDate:t.start_time,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}}}})}catch(t){console.error("Error generating appointment alerts:",t)}return e}static async generatePaymentAlerts(){const e=[];try{const t=await(window.electronAPI?.payments?.getAll?.())||[],n=new Date;t.forEach(t=>{if("pending"===t.status&&t.remaining_balance&&t.remaining_balance>0){if(!t.payment_date)return void console.warn("Payment missing payment_date:",t.id);const a=new Date(t.payment_date);if(isNaN(a.getTime()))return void console.warn("Invalid payment date:",t.payment_date,"for payment:",t.id);const s=Math.floor((n.getTime()-a.getTime())/864e5);if(s>0){const n=t.patient?.full_name||"مريض غير محدد",a=t.patient_id||null;e.push({id:`payment_overdue_${t.id}`,type:"payment",priority:s>7?"high":"medium",title:`دفعة معلقة - ${n}`,description:`دفعة معلقة منذ ${s} يوم - المبلغ: ${this.formatAmount(t.remaining_balance)}`,patientId:a,patientName:"مريض غير محدد"!==n?n:null,relatedData:{paymentId:t.id,appointmentId:t.appointment_id||null},actionRequired:!0,dueDate:t.payment_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}}if("partial"===t.status&&t.remaining_balance&&t.remaining_balance>0){const n=t.patient?.full_name||"مريض غير محدد",a=t.patient_id||null;e.push({id:`payment_partial_${t.id}`,type:"payment",priority:"medium",title:`دفعة جزئية - ${n}`,description:`تم دفع ${this.formatAmount(t.amount)} من أصل ${this.formatAmount(t.amount+t.remaining_balance)} - المتبقي: ${this.formatAmount(t.remaining_balance)}`,patientId:a,patientName:"مريض غير محدد"!==n?n:null,relatedData:{paymentId:t.id,appointmentId:t.appointment_id||null},actionRequired:!0,dueDate:t.payment_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if("failed"===t.status||"rejected"===t.status){const n=t.patient?.full_name||"مريض غير محدد",a=t.patient_id||null;e.push({id:`payment_failed_${t.id}`,type:"payment",priority:"high",title:`دفعة مرفوضة - ${n}`,description:`دفعة بقيمة ${t.amount}$ تم رفضها - ${t.notes||"بحاجة لمراجعة"}`,patientId:a,patientName:"مريض غير محدد"!==n?n:null,relatedData:{paymentId:t.id,appointmentId:t.appointment_id||null},actionRequired:!0,dueDate:t.payment_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(t){console.error("Error generating payment alerts:",t)}return e}static async generateTreatmentAlerts(){const e=[];try{const t=await(window.electronAPI?.toothTreatments?.getAll?.())||[],n=new Date;t.forEach(t=>{if("planned"===t.treatment_status||"in_progress"===t.treatment_status){const a=new Date(t.created_at),s=Math.floor((n.getTime()-a.getTime())/864e5);s>14&&e.push({id:`treatment_pending_${t.id}`,type:"treatment",priority:s>30?"high":"medium",title:`علاج معلق - ${t.patient?.full_name||"مريض غير محدد"}`,description:`علاج ${t.treatment_type} للسن ${t.tooth_number} معلق منذ ${s} يوم`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{treatmentId:t.id,appointmentId:t.appointment_id},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if("completed"===t.treatment_status&&t.notes&&t.notes.includes("متابعة")){const a=new Date(t.updated_at||t.created_at);Math.floor((n.getTime()-a.getTime())/864e5)>7&&e.push({id:`treatment_followup_${t.id}`,type:"treatment",priority:"medium",title:`متابعة علاج - ${t.patient?.full_name||"مريض غير محدد"}`,description:`علاج ${t.treatment_type} للسن ${t.tooth_number} يحتاج متابعة`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{treatmentId:t.id,appointmentId:t.appointment_id},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.treatment_type&&["تقويم","زراعة","علاج عصب","تركيب"].some(e=>t.treatment_type.includes(e))){const a=new Date(t.created_at),s=Math.floor((n.getTime()-a.getTime())/864e5);s>21&&"completed"!==t.treatment_status&&e.push({id:`treatment_complex_${t.id}`,type:"treatment",priority:"medium",title:`علاج معقد - ${t.patient?.full_name||"مريض غير محدد"}`,description:`علاج ${t.treatment_type} للسن ${t.tooth_number} قيد التنفيذ منذ ${s} يوم`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{treatmentId:t.id,appointmentId:t.appointment_id},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(t){console.error("Error generating treatment alerts:",t)}return e}static async generatePrescriptionAlerts(){const e=[];try{const t=await(window.electronAPI?.prescriptions?.getAll?.())||[],n=new Date;t.forEach(t=>{const a=new Date(t.prescription_date),s=Math.floor((n.getTime()-a.getTime())/864e5);if(s>30){const n=t.patient?.full_name||"مريض غير محدد",a=t.patient_id||null;e.push({id:`prescription_old_${t.id}`,type:"prescription",priority:"medium",title:`وصفة قديمة - ${n}`,description:`وصفة صادرة منذ ${s} يوم - قد تحتاج تجديد`,patientId:a,patientName:"مريض غير محدد"!==n?n:null,relatedData:{prescriptionId:t.id,appointmentId:t.appointment_id||null,treatmentId:t.tooth_treatment_id||null},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.notes&&t.notes.includes("متابعة")&&s>7){const n=t.patient?.full_name||"مريض غير محدد",a=t.patient_id||null;e.push({id:`prescription_followup_${t.id}`,type:"prescription",priority:"medium",title:`متابعة وصفة - ${n}`,description:`وصفة تحتاج متابعة منذ ${s} يوم - ${t.notes}`,patientId:a,patientName:"مريض غير محدد"!==n?n:null,relatedData:{prescriptionId:t.id,appointmentId:t.appointment_id||null,treatmentId:t.tooth_treatment_id||null,daysSince:s},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.notes&&(t.notes.includes("مضاد حيوي")||t.notes.includes("مسكن قوي"))&&s>14){const n=t.patient?.full_name||"مريض غير محدد",a=t.patient_id||null;e.push({id:`prescription_important_med_${t.id}`,type:"prescription",priority:"medium",title:`وصفة أدوية مهمة - ${n}`,description:`وصفة تحتوي على أدوية مهمة منذ ${s} يوم - تحتاج متابعة`,patientId:a,patientName:"مريض غير محدد"!==n?n:null,relatedData:{prescriptionId:t.id,appointmentId:t.appointment_id||null,treatmentId:t.tooth_treatment_id||null,medicationType:"important"},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(!t.notes||""===t.notes.trim()){const n=t.patient?.full_name||"مريض غير محدد",a=t.patient_id||null;e.push({id:`prescription_no_notes_${t.id}`,type:"prescription",priority:"low",title:`وصفة بدون ملاحظات - ${n}`,description:`وصفة صادرة منذ ${s} يوم بدون ملاحظات - قد تحتاج توضيح`,patientId:a,patientName:"مريض غير محدد"!==n?n:null,relatedData:{prescriptionId:t.id,appointmentId:t.appointment_id||null,treatmentId:t.tooth_treatment_id||null},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}});(await(window.electronAPI?.medications?.getAll?.())||[]).forEach(t=>{if(t.expiry_date){const a=new Date(t.expiry_date),s=Math.floor((a.getTime()-n.getTime())/864e5);s<=30&&s>=0&&e.push({id:`medication_expiry_warning_${t.id}`,type:"prescription",priority:s<=7?"high":"medium",title:`دواء قريب الانتهاء - ${t.name}`,description:`ينتهي خلال ${s} يوم - قد يؤثر على الوصفات الجديدة`,relatedData:{medicationId:t.id,medicationName:t.name,expiryDate:t.expiry_date,daysUntilExpiry:s},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}t.quantity<=(t.min_quantity||10)&&e.push({id:`medication_low_stock_${t.id}`,type:"prescription",priority:0===t.quantity?"high":"medium",title:`دواء منخفض في المخزون - ${t.name}`,description:`الكمية المتبقية: ${t.quantity} - قد يؤثر على الوصفات`,relatedData:{medicationId:t.id,medicationName:t.name,currentQuantity:t.quantity,minimumQuantity:t.min_quantity||10},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})})}catch(t){console.error("Error generating prescription alerts:",t)}return e}static async generateFollowUpAlerts(){const e=[];try{const n=await(window.electronAPI?.appointments?.getAll?.())||[],a=new Date,s={};n.forEach(e=>{if("completed"===e.status&&e.patient_id){const t=new Date(e.start_time);(!s[e.patient_id]||t>s[e.patient_id])&&(s[e.patient_id]=t)}});for(const[r,i]of Object.entries(s)){const n=Math.floor((a.getTime()-i.getTime())/864e5);if(n>90)try{const t=await(window.electronAPI?.patients?.getById?.(r));t&&e.push({id:`follow_up_${r}`,type:"follow_up",priority:"low",title:`متابعة مطلوبة - ${t.full_name}`,description:`لم يزر المريض العيادة منذ ${n} يوم - قد يحتاج متابعة`,patientId:t.id,patientName:t.full_name,relatedData:{},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}catch(t){console.error("Error getting patient data for follow-up alert:",t)}}}catch(t){console.error("Error generating follow-up alerts:",t)}return e}static async createAlert(e){const t={...e,id:`custom_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:(new Date).toISOString()};try{return await(window.electronAPI?.smartAlerts?.create?.(t))?(Qn.emit("alert:created",{alert:t}),Qn.emit("alerts:changed"),t):(console.log("⚠️ Alert creation skipped (duplicate found):",t.title),t)}catch(n){throw console.error("Error creating alert:",n),n}}static async deleteAppointmentAlerts(e){try{console.log("🗑️ Deleting alerts for appointment:",e);const t=await(window.electronAPI?.smartAlerts?.deleteByRelatedData?.("appointmentId",e))||0;console.log(`🗑️ Deleted ${t} alerts for appointment ${e}`),Qn.emit("alert:deleted",{type:"appointment",relatedId:e,count:t}),Qn.emit("alerts:changed")}catch(t){console.error("Error deleting appointment alerts:",t)}}static async deletePaymentAlerts(e){try{console.log("🗑️ Deleting alerts for payment:",e);const t=await(window.electronAPI?.smartAlerts?.deleteByRelatedData?.("paymentId",e))||0;console.log(`🗑️ Deleted ${t} alerts for payment ${e}`),Qn.emit("alert:deleted",{type:"payment",relatedId:e,count:t}),Qn.emit("alerts:changed")}catch(t){console.error("Error deleting payment alerts:",t)}}static async deletePatientAlerts(e){try{console.log("🗑️ Deleting alerts for patient:",e);const t=await(window.electronAPI?.smartAlerts?.deleteByPatient?.(e))||0;console.log(`🗑️ Deleted ${t} alerts for patient ${e}`),Qn.emit("alert:deleted",{type:"patient",relatedId:e,count:t}),Qn.emit("alerts:changed")}catch(t){console.error("Error deleting patient alerts:",t)}}static async deleteAlertsByType(e,t){try{console.log("🗑️ Deleting alerts by type:",e,"for patient:",t);const n=await(window.electronAPI?.smartAlerts?.deleteByType?.(e,t))||0;console.log(`🗑️ Deleted ${n} alerts of type ${e}${t?` for patient ${t}`:""}`),Qn.emit("alert:deleted",{type:e,patientId:t,count:n}),Qn.emit("alerts:changed")}catch(n){console.error("Error deleting alerts by type:",n)}}static async updateAlert(e,t){try{console.log("🔄 SmartAlertsService: updateAlert called",{alertId:e,updates:t});const n=await(window.electronAPI?.smartAlerts?.update?.(e,t));console.log("✅ Alert updated in database:",e,t,"Result:",n),console.log("📡 Emitting alert:updated event..."),Qn.emit("alert:updated",{alertId:e,updates:t}),console.log("📡 Emitting alerts:changed event..."),Qn.emit("alerts:changed"),console.log("✅ All events emitted successfully")}catch(n){throw console.error("❌ Error updating alert:",n),n}}static async deleteAlert(e){try{await(window.electronAPI?.smartAlerts?.delete?.(e)),console.log("✅ Alert deleted from database:",e),Qn.emit("alert:deleted",{alertId:e}),Qn.emit("alerts:changed")}catch(t){throw console.error("Error deleting alert:",t),t}}static addEventListener(e,t){Qn.addEventListener(e,t)}static removeEventListener(e,t){Qn.removeEventListener(e,t)}static emitEvent(e,t){Qn.emit(e,t)}static clearAllEventListeners(){Qn.removeAllListeners()}static async generateInventoryAlerts(){const e=[];try{const t=await(window.electronAPI?.inventory?.getAll?.())||[],n=new Date;t.forEach(t=>{if(t.expiry_date){const a=new Date(t.expiry_date),s=Math.floor((a.getTime()-n.getTime())/864e5);s<=30&&s>=0?e.push({id:`inventory_expiry_${t.id}`,type:"inventory",priority:s<=7?"high":"medium",title:`انتهاء صلاحية قريب - ${t.name}`,description:`ينتهي في ${s} يوم - الكمية: ${t.quantity}`,relatedData:{inventoryId:t.id},actionRequired:!0,dueDate:t.expiry_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1}):s<0&&e.push({id:`inventory_expired_${t.id}`,type:"inventory",priority:"high",title:`منتهي الصلاحية - ${t.name}`,description:`انتهت الصلاحية منذ ${Math.abs(s)} يوم - الكمية: ${t.quantity}`,relatedData:{inventoryId:t.id},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.quantity<=(t.min_quantity||5)&&e.push({id:`inventory_low_${t.id}`,type:"inventory",priority:0===t.quantity?"high":"medium",title:`مخزون منخفض - ${t.name}`,description:`الكمية المتبقية: ${t.quantity} - الحد الأدنى: ${t.min_quantity||5}`,relatedData:{inventoryId:t.id,currentQuantity:t.quantity,minimumQuantity:t.min_quantity||5},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1}),t.usage_rate&&t.usage_rate>0){const n=Math.floor(t.quantity/t.usage_rate);n<=7&&n>0&&e.push({id:`inventory_high_usage_${t.id}`,type:"inventory",priority:n<=3?"high":"medium",title:`استخدام مفرط - ${t.name}`,description:`سينفد خلال ${n} يوم بمعدل الاستخدام الحالي (${t.usage_rate}/يوم)`,relatedData:{inventoryId:t.id,usageRate:t.usage_rate,daysUntilEmpty:n,currentQuantity:t.quantity},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.last_used_date){const a=new Date(t.last_used_date),s=Math.floor((n.getTime()-a.getTime())/864e5);s>90&&e.push({id:`inventory_unused_${t.id}`,type:"inventory",priority:"low",title:`عنصر غير مستخدم - ${t.name}`,description:`لم يستخدم منذ ${s} يوم - الكمية: ${t.quantity}`,relatedData:{inventoryId:t.id,lastUsedDate:t.last_used_date,daysSinceLastUse:s,currentQuantity:t.quantity},actionRequired:!1,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(t){console.error("Error generating inventory alerts:",t)}return e}static async clearExpiredSnoozedAlerts(){try{await(window.electronAPI?.smartAlerts?.clearExpiredSnoozed?.()),console.log("✅ Cleared expired snoozed alerts")}catch(e){console.error("Error clearing expired snoozed alerts:",e)}}static async clearDismissedAlerts(){try{await(window.electronAPI?.smartAlerts?.clearDismissed?.()),console.log("✅ Cleared dismissed alerts")}catch(e){console.error("Error clearing dismissed alerts:",e)}}static async cleanupOutdatedAlerts(){try{console.log("🧹 Cleaning up outdated alerts...");const t=await(window.electronAPI?.smartAlerts?.getAll?.())||[],n=new Date,a=new Date(n.getTime()-2592e5);let s=0;for(const r of t){let t=!1;if(r.isDismissed&&new Date(r.createdAt)<a&&(t=!0),"appointment"===r.type&&r.relatedData?.appointmentId)try{const e=(await(window.electronAPI?.appointments?.getAll?.())||[]).find(e=>e.id===r.relatedData?.appointmentId);if(!e||"completed"!==e.status&&"cancelled"!==e.status||(t=!0),e&&e.start_time){const a=new Date(e.start_time);n>new Date(a.getTime()+6048e5)&&(t=!0)}}catch(e){console.warn("Error checking appointment for alert cleanup:",e)}if("payment"===r.type&&r.relatedData?.paymentId)try{const e=(await(window.electronAPI?.payments?.getAll?.())||[]).find(e=>e.id===r.relatedData?.paymentId);e&&("completed"===e.status||e.remaining_balance<=0)&&(t=!0)}catch(e){console.warn("Error checking payment for alert cleanup:",e)}if(t)try{await(window.electronAPI?.smartAlerts?.delete?.(r.id)),s++}catch(e){console.warn("Error deleting outdated alert:",r.id,e)}}console.log(`🧹 Cleaned up ${s} outdated alerts`)}catch(e){console.error("Error during alert cleanup:",e)}}static removeDuplicateAlerts(e){const t=new Map,n=new Map;return e.forEach(e=>{const a=t.get(e.id);if(a){if(this.isAlertMoreComplete(e,a)){t.set(e.id,e);const a=this.generateContentKey(e);n.set(a,e)}}else{const a=this.generateContentKey(e),s=n.get(a);if(s){const r=new Date(s.createdAt).getTime();(new Date(e.createdAt).getTime()>r||this.isAlertMoreComplete(e,s))&&(t.delete(s.id),t.set(e.id,e),n.set(a,e))}else t.set(e.id,e),n.set(a,e)}}),Array.from(t.values())}static generateContentKey(e){return[e.type,e.patientId||"no-patient",e.title.replace(/\s+/g,"").toLowerCase(),e.relatedData?JSON.stringify(e.relatedData):"no-data"].join("|")}static isAlertMoreComplete(e,t){const n=new Date(e.createdAt).getTime(),a=new Date(t.createdAt).getTime();if(n>a)return!0;if(n<a)return!1;return this.calculateCompletenessScore(e)>this.calculateCompletenessScore(t)}static calculateCompletenessScore(e){let t=0;return e.patientId&&(t+=2),e.patientName&&(t+=1),e.relatedData&&Object.keys(e.relatedData).length>0&&(t+=3),e.dueDate&&(t+=1),e.actionRequired&&(t+=1),void 0!==e.isRead&&(t+=1),void 0!==e.isDismissed&&(t+=1),t}static sortAlertsByPriority(e){const t={high:1,medium:2,low:3};return e.sort((e,n)=>{if(e.isRead!==n.isRead)return e.isRead?1:-1;if(e.actionRequired!==n.actionRequired)return e.actionRequired?-1:1;const a=t[e.priority]-t[n.priority];if(0!==a)return a;if(e.dueDate&&n.dueDate){const t=new Date(e.dueDate).getTime()-new Date(n.dueDate).getTime();if(0!==t)return t}else{if(e.dueDate&&!n.dueDate)return-1;if(!e.dueDate&&n.dueDate)return 1}return new Date(n.createdAt).getTime()-new Date(e.createdAt).getTime()})}static isSameDay(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}static async generateLabOrderAlerts(){const e=[];try{const t=await(window.electronAPI?.labOrders?.getAll?.())||[],n=new Date;t.forEach(t=>{if(t.expected_delivery_date&&"معلق"===t.status){const a=new Date(t.expected_delivery_date),s=Math.floor((n.getTime()-a.getTime())/864e5);s>0&&e.push({id:`lab_order_overdue_${t.id}`,type:"lab_order",priority:s>7?"high":"medium",title:`طلب مختبر متأخر - ${t.service_name}`,description:`متأخر ${s} يوم عن الموعد المتوقع${t.patient?.full_name?` - ${t.patient.full_name}`:""}`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{labOrderId:t.id,labId:t.lab_id,expectedDate:t.expected_delivery_date},actionRequired:!0,dueDate:t.expected_delivery_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if(t.remaining_balance>0&&e.push({id:`lab_order_payment_${t.id}`,type:"payment",priority:"medium",title:`دفعة مختبر معلقة - ${t.service_name}`,description:`المبلغ المتبقي: ${this.formatAmount(t.remaining_balance)}${t.patient?.full_name?` - ${t.patient.full_name}`:""}`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{labOrderId:t.id,labId:t.lab_id,remainingBalance:t.remaining_balance},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1}),t.expected_delivery_date&&"معلق"===t.status){const a=new Date(t.expected_delivery_date),s=Math.floor((a.getTime()-n.getTime())/864e5);s<=2&&s>=0&&e.push({id:`lab_order_due_soon_${t.id}`,type:"lab_order",priority:"low",title:`طلب مختبر قريب التسليم - ${t.service_name}`,description:`متوقع التسليم خلال ${s} يوم${t.patient?.full_name?` - ${t.patient.full_name}`:""}`,patientId:t.patient_id,patientName:t.patient?.full_name,relatedData:{labOrderId:t.id,labId:t.lab_id,expectedDate:t.expected_delivery_date},actionRequired:!1,dueDate:t.expected_delivery_date,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}})}catch(t){console.error("Error generating lab order alerts:",t)}return e}static async generateClinicNeedsAlerts(){const e=[];try{const t=await(window.electronAPI?.clinicNeeds?.getAll?.())||[],n=new Date;t.forEach(t=>{if("urgent"===t.priority&&"pending"===t.status){const a=new Date(t.created_at),s=Math.floor((n.getTime()-a.getTime())/864e5);e.push({id:`clinic_need_urgent_${t.id}`,type:"inventory",priority:"high",title:`احتياج عاجل معلق - ${t.need_name}`,description:`معلق منذ ${s} يوم - الكمية: ${t.quantity}`,relatedData:{clinicNeedId:t.id,needName:t.need_name,quantity:t.quantity,priority:t.priority},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}if("ordered"===t.status){const a=new Date(t.created_at),s=Math.floor((n.getTime()-a.getTime())/864e5);s>14&&e.push({id:`clinic_need_delayed_${t.id}`,type:"inventory",priority:"urgent"===t.priority?"high":"medium",title:`احتياج متأخر - ${t.need_name}`,description:`مطلوب منذ ${s} يوم - الكمية: ${t.quantity}`,relatedData:{clinicNeedId:t.id,needName:t.need_name,quantity:t.quantity,supplier:t.supplier},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})}t.price>1e3&&"pending"===t.status&&e.push({id:`clinic_need_expensive_${t.id}`,type:"inventory",priority:"medium",title:`احتياج عالي التكلفة - ${t.need_name}`,description:`التكلفة: $${t.price} - يحتاج موافقة`,relatedData:{clinicNeedId:t.id,needName:t.need_name,price:t.price,quantity:t.quantity},actionRequired:!0,createdAt:(new Date).toISOString(),isRead:!1,isDismissed:!1})})}catch(t){console.error("Error generating clinic needs alerts:",t)}return e}static formatTime(e){try{if(!e)return"--";const t=new Date(e);return isNaN(t.getTime())?"--":t.toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return console.error("Error formatting time:",t),"--"}}}const Jn=de()(xt((e,t)=>("undefined"!=typeof window&&window.addEventListener("patient-deleted",n=>{const{patientId:a}=n.detail,{appointments:s,selectedAppointment:r}=t(),i=s.filter(e=>e.patient_id!==a);e({appointments:i,selectedAppointment:r?.patient_id===a?null:r}),t().convertToCalendarEvents(),console.log(`🗑️ Removed ${s.length-i.length} appointments for deleted patient ${a}`)}),{appointments:[],selectedAppointment:null,isLoading:!1,error:null,calendarView:"month",selectedDate:new Date,calendarEvents:[],loadAppointments:async()=>{e({isLoading:!0,error:null});try{const n=await window.electronAPI.appointments.getAll();console.log("🏪 Store: Loaded appointments:",n.length),n.length>0&&(console.log("🏪 Store: First appointment sample:",n[0]),n.forEach((e,t)=>{t<3&&console.log(`🏪 Store: Appointment ${t+1} patient data:`,{id:e.id,patient_id:e.patient_id,patient:e.patient,patient_name:e.patient_name||e.patient_name})})),e({appointments:n,isLoading:!1}),t().convertToCalendarEvents()}catch(n){console.error("🏪 Store: Failed to load appointments:",n),e({error:n instanceof Error?n.message:"Failed to load appointments",isLoading:!1})}},createAppointment:async n=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.appointments.create(n),{appointments:s}=t(),r=[...s,a];e({appointments:r,isLoading:!1}),t().convertToCalendarEvents(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("appointment-added",{detail:{type:"created",appointmentId:a.id,appointment:a}})),window.dispatchEvent(new CustomEvent("appointment-changed",{detail:{type:"created",appointmentId:a.id,appointment:a}})))}catch(a){e({error:a instanceof Error?a.message:"Failed to create appointment",isLoading:!1})}},updateAppointment:async(n,a)=>{e({isLoading:!0,error:null});try{console.log("🏪 Store: Updating appointment:",{id:n,appointmentData:a});try{await Xn.deleteAppointmentAlerts(n)}catch(s){console.warn("Could not delete old appointment alerts:",s)}const r=await window.electronAPI.appointments.update(n,a);console.log("🏪 Store: Received updated appointment:",r);const{appointments:i,selectedAppointment:l}=t(),o=i.map(e=>e.id===n?r:e);console.log("🏪 Store: Updated appointments array, found:",o.filter(e=>e.id===n).length),e({appointments:o,selectedAppointment:l?.id===n?r:l,isLoading:!1}),t().convertToCalendarEvents(),console.log("🏪 Store: Update completed successfully"),await t().loadAppointments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("appointment-updated",{detail:{type:"updated",appointmentId:n,appointment:r}})),window.dispatchEvent(new CustomEvent("appointment-changed",{detail:{type:"updated",appointmentId:n,appointment:r}})))}catch(s){throw console.error("🏪 Store: Update failed:",s),e({error:s instanceof Error?s.message:"Failed to update appointment",isLoading:!1}),s}},deleteAppointment:async n=>{e({isLoading:!0,error:null});try{if(!(await window.electronAPI.appointments.delete(n)))throw new Error("Failed to delete appointment");{const{appointments:a,selectedAppointment:s}=t(),r=a.filter(e=>e.id!==n);e({appointments:r,selectedAppointment:s?.id===n?null:s,isLoading:!1}),t().convertToCalendarEvents(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("appointment-deleted",{detail:{type:"deleted",appointmentId:n}})),window.dispatchEvent(new CustomEvent("appointment-changed",{detail:{type:"deleted",appointmentId:n}})))}}catch(a){e({error:a instanceof Error?a.message:"Failed to delete appointment",isLoading:!1})}},setSelectedAppointment:t=>{e({selectedAppointment:t})},setCalendarView:t=>{e({calendarView:t})},setSelectedDate:t=>{e({selectedDate:t})},clearError:()=>{e({error:null})},convertToCalendarEvents:()=>{const{appointments:n}=t(),a=n.map(e=>{const t=e.patient?.full_name||e.patient_name||e.patient_name||"مريض غير معروف";"مريض غير معروف"===t&&console.log("🗓️ Calendar: Missing patient data for appointment:",{id:e.id,patient_id:e.patient_id,patient:e.patient,patient_name:e.patient_name});const n=`${t} - ${new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})}`;return{id:e.id,title:n,start:new Date(e.start_time),end:new Date(e.end_time),resource:e}});e({calendarEvents:a})},getAppointmentsForDate:e=>{const{appointments:n}=t(),a=e.toISOString().split("T")[0];return n.filter(e=>new Date(e.start_time).toISOString().split("T")[0]===a)},getAppointmentsForDateRange:(e,n)=>{const{appointments:a}=t();return a.filter(t=>{const a=new Date(t.start_time);return a>=e&&a<=n})},markAsCompleted:async e=>{await t().updateAppointment(e,{status:"completed"})},markAsCancelled:async e=>{await t().updateAppointment(e,{status:"cancelled"})},markAsNoShow:async e=>{await t().updateAppointment(e,{status:"no_show"})}}),{name:"appointment-store"})),ea=e=>{if(e&&e.clinic_name&&"عيادة الأسنان"!==e.clinic_name)try{const t={clinic_name:e.clinic_name,doctor_name:e.doctor_name,clinic_logo:e.clinic_logo,clinic_phone:e.clinic_phone,clinic_email:e.clinic_email,clinic_address:e.clinic_address,timestamp:Date.now()};localStorage.setItem("dental-clinic-settings-backup",JSON.stringify(t)),console.log("Settings backup saved to localStorage")}catch(t){console.warn("Failed to save settings backup:",t)}},ta=de()(xt(yt((e,t)=>({settings:null,isLoading:!1,error:null,isDarkMode:!1,language:"en",currency:"USD",loadSettings:async()=>{e({isLoading:!0,error:null});try{const t=await window.electronAPI.settings.get();if(!t||!t.clinic_name||"عيادة الأسنان"===t.clinic_name){const n=(()=>{try{const e=localStorage.getItem("dental-clinic-settings-backup");if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<2592e6&&t.clinic_name&&"عيادة الأسنان"!==t.clinic_name)return console.log("Restoring settings from localStorage backup"),t}}catch(e){console.warn("Failed to restore settings backup:",e)}return null})();if(n){const a={...t,...n};return await window.electronAPI.settings.update(n),e({settings:a,language:t?.language||"ar",currency:t?.currency||"USD",isLoading:!1}),void ea(a)}}e({settings:t,language:t?.language||"ar",currency:t?.currency||"USD",isLoading:!1}),ea(t)}catch(t){e({error:t instanceof Error?t.message:"Failed to load settings",isLoading:!1})}},updateSettings:async n=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.settings.update(n);e({settings:a,language:a.language,currency:a.currency,isLoading:!1}),ea(a),setTimeout(()=>{const n=t();n.settings&&e({settings:n.settings})},10)}catch(a){e({error:a instanceof Error?a.message:"Failed to update settings",isLoading:!1})}},toggleDarkMode:()=>{const{isDarkMode:n,settings:a}=t(),s=!n,r=a;if(e({isDarkMode:s,settings:r}),s?(document.documentElement.classList.add("dark"),localStorage.setItem("dental-clinic-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("dental-clinic-theme","light")),r)try{localStorage.setItem("dental-clinic-settings-backup",JSON.stringify({clinic_name:r.clinic_name,doctor_name:r.doctor_name,clinic_logo:r.clinic_logo,clinic_phone:r.clinic_phone,clinic_email:r.clinic_email,clinic_address:r.clinic_address,backup_timestamp:Date.now()}))}catch(i){console.warn("Failed to save settings backup:",i)}try{t().updateSettings({theme:s?"dark":"light"})}catch(i){console.warn("Failed to save theme preference to database:",i)}},initializeDarkMode:()=>{const n=localStorage.getItem("dental-clinic-theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches,s=t();let r=!1;n?r="dark"===n:(r=a,localStorage.setItem("dental-clinic-theme",r?"dark":"light"));const i=s.settings;r!==s.isDarkMode&&(e({isDarkMode:r,settings:i}),r?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")),i||t().loadSettings()},setLanguage:n=>{e({language:n}),t().updateSettings({language:n})},setCurrency:n=>{e({currency:n}),t().updateSettings({currency:n})},clearError:()=>{e({error:null})},getWorkingDays:()=>{const{settings:e}=t();return e?.working_days?e.working_days.split(",").map(e=>e.trim()):["monday","tuesday","wednesday","thursday","friday"]},isWorkingDay:e=>{const n=t().getWorkingDays(),a=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][e.getDay()];return n.includes(a)},getWorkingHours:()=>{const{settings:e}=t();return{start:e?.working_hours_start||"09:00",end:e?.working_hours_end||"17:00"}},isWithinWorkingHours:e=>{const{start:n,end:a}=t().getWorkingHours();return e>=n&&e<=a}}),{name:"settings-store",partialize:e=>({language:e.language,currency:e.currency,isDarkMode:e.isDarkMode,clinicSettingsBackup:e.settings?{clinic_name:e.settings.clinic_name,doctor_name:e.settings.doctor_name,clinic_logo:e.settings.clinic_logo,clinic_phone:e.settings.clinic_phone,clinic_email:e.settings.clinic_email,clinic_address:e.settings.clinic_address,backup_timestamp:Date.now()}:null}),storage:{getItem:e=>{const t=localStorage.getItem(e);return t?JSON.parse(t):null},setItem:(e,t)=>{localStorage.setItem(e,JSON.stringify(t)),t.state?.clinicSettingsBackup&&localStorage.setItem("dental-clinic-settings-backup",JSON.stringify(t.state.clinicSettingsBackup))},removeItem:e=>localStorage.removeItem(e)}}),{name:"settings-store"})),na=re.createContext(void 0);function aa({children:t}){const{isDarkMode:n,toggleDarkMode:a,initializeDarkMode:s,loadSettings:r,settings:i}=ta();re.useEffect(()=>{s();const e=localStorage.getItem("dental-clinic-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;let n=!1;n=e?"dark"===e:t,n?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),i||r()},[s]),re.useEffect(()=>{n?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[n]);const l={isDarkMode:n,toggleDarkMode:()=>{a()},setDarkMode:e=>{e!==n&&a()}};return e.jsx(na.Provider,{value:l,children:t})}function sa(){const e=re.useContext(na);if(void 0===e)throw new Error("useTheme must be used within a ThemeProvider");return e}function ra(){const{isDarkMode:e}=sa();return{bgPrimary:"bg-background",bgSecondary:"bg-card",bgTertiary:"bg-muted",bgElevated:e?"bg-card shadow-lg shadow-black/10":"bg-card shadow-sm",textPrimary:"text-foreground",textSecondary:"text-muted-foreground",textMuted:"text-muted-foreground",textHighContrast:"text-foreground",textMediumContrast:"text-muted-foreground",border:"border-border",borderLight:"border-input",borderFocus:"border-ring",card:e?"bg-card border-border text-card-foreground shadow-lg shadow-black/10 hover:shadow-xl":"bg-card border-border text-card-foreground shadow-sm hover:shadow-md",buttonPrimary:e?"bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg shadow-primary/20 active:scale-[0.98]":"bg-primary hover:bg-primary/90 text-primary-foreground shadow-md active:scale-[0.98]",buttonSecondary:e?"bg-secondary hover:bg-secondary/80 text-secondary-foreground border-border shadow-lg shadow-secondary/20 active:scale-[0.98]":"bg-secondary hover:bg-secondary/80 text-secondary-foreground border-border shadow-md active:scale-[0.98]",buttonGhost:"hover:bg-accent hover:text-accent-foreground active:scale-[0.98] transition-colors",buttonOutline:e?"border-2 border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-ring/50 active:scale-[0.98] shadow-md":"border-2 border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-ring/50 active:scale-[0.98] shadow-sm",input:e?"bg-background border-input text-foreground placeholder-muted-foreground focus:border-ring shadow-md":"bg-background border-input text-foreground placeholder-muted-foreground focus:border-ring shadow-sm",statusScheduled:e?"bg-primary/20 text-primary border border-primary/30 rounded-full px-2 py-1 text-xs font-medium":"bg-primary/10 text-primary border border-primary/20 rounded-full px-2 py-1 text-xs font-medium",statusCompleted:e?"bg-green-900/20 text-green-400 border border-green-800 rounded-full px-2 py-1 text-xs font-medium":"bg-green-100 text-green-800 border border-green-200 rounded-full px-2 py-1 text-xs font-medium",statusCancelled:e?"bg-destructive/20 text-destructive border border-destructive/30 rounded-full px-2 py-1 text-xs font-medium":"bg-destructive/10 text-destructive border border-destructive/20 rounded-full px-2 py-1 text-xs font-medium",statusNoShow:"bg-muted text-muted-foreground border border-border rounded-full px-2 py-1 text-xs font-medium",statusInProgress:e?"bg-amber-900/20 text-amber-400 border border-amber-800 rounded-full px-2 py-1 text-xs font-medium":"bg-amber-100 text-amber-800 border border-amber-200 rounded-full px-2 py-1 text-xs font-medium",nav:"bg-background border-border shadow-sm",navItem:"text-muted-foreground hover:text-foreground hover:bg-accent transition-colors rounded-md px-3 py-2",navItemActive:"text-primary bg-accent border-l-2 border-primary font-medium",table:e?"bg-card border-border shadow-lg shadow-black/10":"bg-background border-border shadow-sm",tableHeader:"bg-muted text-foreground font-semibold",tableRow:"hover:bg-accent/50 transition-colors",tableCell:"text-foreground border-border",dialog:e?"bg-card border-border shadow-xl shadow-black/20":"bg-background border-border shadow-lg",dialogHeader:"text-foreground font-semibold",dialogContent:"text-muted-foreground",notificationSuccess:e?"bg-green-900/20 text-green-400 border border-green-800 shadow-lg":"bg-green-50 text-green-800 border border-green-200 shadow-md",notificationError:e?"bg-red-900/20 text-red-400 border border-red-800 shadow-lg":"bg-red-50 text-red-800 border border-red-200 shadow-md",notificationWarning:e?"bg-amber-900/20 text-amber-400 border border-amber-800 shadow-lg":"bg-amber-50 text-amber-800 border border-amber-200 shadow-md",notificationInfo:e?"bg-blue-900/20 text-blue-400 border border-blue-800 shadow-lg":"bg-blue-50 text-blue-800 border border-blue-200 shadow-md",alertError:e?"bg-destructive/20 border-destructive/30":"bg-destructive/10 border-destructive/20",alertWarning:e?"bg-amber-900/20 border-amber-800/50":"bg-amber-50 border-amber-200",alertSuccess:e?"bg-green-900/20 border-green-800/50":"bg-green-50 border-green-200",alertInfo:e?"bg-blue-900/20 border-blue-800/50":"bg-blue-50 border-blue-200"}}const ia=re.createContext(void 0);function la({children:t}){const{currency:n,setCurrency:a,settings:s,loadSettings:r}=ta();re.useEffect(()=>{s||r()},[s,r]);const i=n||s?.currency||"USD",l=Fn(i);re.useEffect(()=>{Rn(i)},[i]);const o={currentCurrency:i,currencyConfig:l,setCurrency:e=>{Tn[e]?(a(e),Rn(e)):console.warn(`Unsupported currency: ${e}`)},getSupportedCurrencies:()=>Tn,formatAmount:(e,t)=>Mn(e,t||i),formatAmountSymbol:(e,t)=>function(e,t){const n=Fn(t||On()),a=Number(e);if(isNaN(a)||!isFinite(a))return n.symbol;try{const e=new Intl.NumberFormat(n.locale,{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(a));return"before"===n.position?`${n.symbol}${e}`:`${e} ${n.symbol}`}catch(s){const e=Math.round(a).toString();return"before"===n.position?`${n.symbol}${e}`:`${e} ${n.symbol}`}}(e,t||i),formatAmountWithConfig:(e,t)=>Ln(e,t||l),getCurrencySymbol:e=>Fn(e||i).symbol,getCurrencyName:(e,t=!1)=>{const n=Fn(e||i);return t?n.nameAr:n.name},getCurrencyDecimals:e=>Fn(e||i).decimals};return e.jsx(ia.Provider,{value:o,children:t})}function oa(){const e=re.useContext(ia);if(void 0===e)throw new Error("useCurrency must be used within a CurrencyProvider");return e}const ca=de()(xt((e,t)=>("undefined"!=typeof window&&window.addEventListener("patient-deleted",n=>{const{patientId:a}=n.detail,{payments:s,selectedPayment:r}=t(),i=s.filter(e=>e.patient_id!==a);e({payments:i,selectedPayment:r?.patient_id===a?null:r}),t(),window.addEventListener("treatment-payments-deleted",n=>{const{treatmentId:a}=n.detail,{payments:s,selectedPayment:r}=t(),i=s.filter(e=>e.tooth_treatment_id!==a);e({payments:i,selectedPayment:r?.tooth_treatment_id===a?null:r})}).calculateTotalRevenue(),t().calculatePendingAmount(),t().calculateTotalRemainingBalance(),t().calculatePartialPaymentsCount(),t().calculatePendingPaymentsCount(),t().calculateMonthlyRevenue(),t().calculatePaymentMethodStats(),t().filterPayments(),console.log(`💰 Removed ${s.length-i.length} payments for deleted patient ${a}`)}),{payments:[],filteredPayments:[],selectedPayment:null,isLoading:!1,error:null,searchQuery:"",statusFilter:"all",paymentMethodFilter:"all",totalRevenue:0,pendingAmount:0,totalRemainingBalance:0,partialPaymentsCount:0,pendingPaymentsCount:0,monthlyRevenue:{},paymentMethodStats:{},loadPayments:async()=>{e({isLoading:!0,error:null});try{const n=await window.electronAPI.payments.getAll();e({payments:n,filteredPayments:n,isLoading:!1}),t().calculateTotalRevenue(),t().calculatePendingAmount(),t().calculateTotalRemainingBalance(),t().calculatePartialPaymentsCount(),t().calculatePendingPaymentsCount(),t().calculateMonthlyRevenue(),t().calculatePaymentMethodStats(),t().filterPayments()}catch(n){e({error:n instanceof Error?n.message:"Failed to load payments",isLoading:!1})}},createPayment:async n=>{e({isLoading:!0,error:null});try{console.log("💰 Creating payment in store:",n);const e=await window.electronAPI.payments.create(n);return console.log("✅ Payment created successfully in store:",e),await t().loadPayments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("payment-changed",{detail:{type:"created",paymentId:e.id,payment:e}})),window.dispatchEvent(new CustomEvent("payment-added",{detail:{type:"created",paymentId:e.id,payment:e}}))),e}catch(a){throw console.error("❌ Failed to create payment in store:",a),e({error:a instanceof Error?a.message:"Failed to create payment",isLoading:!1}),a}},updatePayment:async(n,a)=>{e({isLoading:!0,error:null});try{console.log("🔄 Updating payment in store:",{id:n,paymentData:a});try{await Xn.deletePaymentAlerts(n)}catch(s){console.warn("Could not delete old payment alerts:",s)}const e=await window.electronAPI.payments.update(n,a);return console.log("✅ Payment updated successfully in store:",e),await t().loadPayments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("payment-changed",{detail:{type:"updated",paymentId:n,payment:e}})),window.dispatchEvent(new CustomEvent("payment-updated",{detail:{type:"updated",paymentId:n,payment:e}}))),e}catch(s){throw console.error("❌ Failed to update payment in store:",s),e({error:s instanceof Error?s.message:"Failed to update payment",isLoading:!1}),s}},deletePayment:async n=>{e({isLoading:!0,error:null});try{await window.electronAPI.payments.delete(n);const{payments:a,selectedPayment:s}=t(),r=a.filter(e=>e.id!==n);e({payments:r,selectedPayment:s?.id===n?null:s,isLoading:!1}),t().calculateTotalRevenue(),t().calculatePendingAmount(),t().calculateTotalRemainingBalance(),t().calculatePartialPaymentsCount(),t().calculatePendingPaymentsCount(),t().calculateMonthlyRevenue(),t().calculatePaymentMethodStats(),t().filterPayments(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("payment-changed",{detail:{type:"deleted",paymentId:n}})),window.dispatchEvent(new CustomEvent("payment-deleted",{detail:{type:"deleted",paymentId:n}})))}catch(a){e({error:a instanceof Error?a.message:"Failed to delete payment",isLoading:!1})}},searchPayments:n=>{e({searchQuery:n}),t().filterPayments()},setSelectedPayment:t=>{e({selectedPayment:t})},setSearchQuery:n=>{e({searchQuery:n}),t().filterPayments()},setStatusFilter:n=>{e({statusFilter:n}),t().filterPayments()},setPaymentMethodFilter:n=>{e({paymentMethodFilter:n}),t().filterPayments()},filterPayments:()=>{const{payments:n,searchQuery:a,statusFilter:s,paymentMethodFilter:r}=t();let i=n;a&&(i=i.filter(e=>{const t=e.patient?`${e.patient.first_name} ${e.patient.last_name}`:"";return e.receipt_number?.toLowerCase().includes(a.toLowerCase())||e.description?.toLowerCase().includes(a.toLowerCase())||t.toLowerCase().includes(a.toLowerCase())||e.amount.toString().includes(a)||e.payment_method.toLowerCase().includes(a.toLowerCase())||e.status.toLowerCase().includes(a.toLowerCase())})),"all"!==s&&(i=i.filter(e=>e.status===s)),"all"!==r&&(i=i.filter(e=>e.payment_method===r)),e({filteredPayments:i})},clearError:()=>{e({error:null})},calculateTotalRevenue:()=>{const{payments:n}=t(),a=n.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>{const n=Number(t.amount);return isNaN(n)||!isFinite(n)?(console.warn("Invalid payment amount:",t.amount,"for payment:",t.id),e):e+n},0),s=isNaN(a)||!isFinite(a)?0:Math.round(100*a)/100;e({totalRevenue:s})},calculatePendingAmount:()=>{const{payments:n}=t(),a=n.filter(e=>"pending"===e.status).reduce((e,t)=>{const n=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},a=n(t.amount),s=n(t.total_amount_due);let r=a;if(t.tooth_treatment_id){r=n(t.treatment_total_cost)||s}else if(s>0)r=s;else{const e=n(t.remaining_balance);e>0&&(r=e)}return e+r},0),s=isNaN(a)||!isFinite(a)?0:Math.round(100*a)/100;e({pendingAmount:s})},calculateTotalRemainingBalance:()=>{const{payments:n}=t();let a=0;const s=n.filter(e=>e.tooth_treatment_id&&"partial"===e.status),r={};s.forEach(e=>{r[e.tooth_treatment_id]||(r[e.tooth_treatment_id]=[]),r[e.tooth_treatment_id].push(e)}),Object.keys(r).forEach(e=>{const t=r[e],n=t[t.length-1];void 0!==n.treatment_remaining_balance&&(a+=n.treatment_remaining_balance)});const i=n.filter(e=>e.appointment_id&&!e.tooth_treatment_id&&"partial"===e.status),l={};i.forEach(e=>{l[e.appointment_id]||(l[e.appointment_id]=[]),l[e.appointment_id].push(e)}),Object.keys(l).forEach(e=>{const t=l[e],n=t[t.length-1];void 0!==n.remaining_balance&&(a+=n.remaining_balance)});n.filter(e=>!e.appointment_id&&!e.tooth_treatment_id&&"partial"===e.status).forEach(e=>{void 0!==e.remaining_balance&&e.remaining_balance>0&&(a+=e.remaining_balance)}),e({totalRemainingBalance:Math.round(100*a)/100})},calculatePartialPaymentsCount:()=>{const{payments:n}=t(),a=n.filter(e=>"partial"===e.status).length;e({partialPaymentsCount:a})},calculatePendingPaymentsCount:()=>{const{payments:n}=t(),a=n.filter(e=>"pending"===e.status).length;e({pendingPaymentsCount:a})},calculateMonthlyRevenue:()=>{const{payments:n}=t(),a={};n.filter(e=>"completed"===e.status||"partial"===e.status).forEach(e=>{try{const t=new Date(e.payment_date);if(isNaN(t.getTime()))return void console.warn("Invalid payment date:",e.payment_date);const n=t.toISOString().slice(0,7),s=Number(e.amount);if(isNaN(s)||!isFinite(s))return void console.warn("Invalid payment amount for monthly revenue:",e.amount,"for payment:",e.id);const r=(a[n]||0)+s;if(isNaN(r)||!isFinite(r))return void console.warn("Invalid monthly total calculation for month:",n);a[n]=Math.round(100*r)/100}catch(t){console.warn("Error processing payment date:",e.payment_date,t)}}),e({monthlyRevenue:a})},calculatePaymentMethodStats:()=>{const{payments:n}=t(),a={};n.filter(e=>"completed"===e.status||"partial"===e.status).forEach(e=>{const t=e.payment_method||"unknown",n="partial"===e.status&&void 0!==e.amount_paid?Number(e.amount_paid):Number(e.amount);if(isNaN(n)||!isFinite(n))return void console.warn("Invalid payment amount for method stats:",e.amount,"for payment:",e.id);const s=(a[t]||0)+n;!isNaN(s)&&isFinite(s)?a[t]=Math.round(100*s)/100:console.warn("Invalid method total calculation for method:",t)}),e({paymentMethodStats:a})},getPaymentsByPatient:e=>{const{payments:n}=t();return n.filter(t=>t.patient_id===e)},getPaymentsByAppointment:e=>{const{payments:n}=t();return n.filter(t=>t.appointment_id===e)},getPaymentsByToothTreatment:e=>{const{payments:n}=t();return n.filter(t=>t.tooth_treatment_id===e)},getPaymentsByDateRange:(e,n)=>{const{payments:a}=t();return a.filter(t=>{const a=t.payment_date;if(!a)return!1;const s=new Date(a);let r;return r=a.includes("T")||a.includes(" ")?s:new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0),r>=e&&r<=n})},getToothTreatmentPaymentSummary:async e=>{try{return await window.electronAPI.payments.getToothTreatmentSummary(e)}catch(t){throw console.error("Failed to get tooth treatment payment summary:",t),t}},markAsCompleted:async e=>{await t().updatePayment(e,{status:"completed"})},markAsPending:async e=>{await t().updatePayment(e,{status:"pending"})},markAsFailed:async e=>{await t().updatePayment(e,{status:"failed"})},markAsRefunded:async e=>{await t().updatePayment(e,{status:"refunded"})}}),{name:"payment-store"})),da=de()(xt((e,t)=>("undefined"!=typeof window&&window.addEventListener("patient-deleted",async e=>{console.log("📊 Dashboard: Patient deleted, refreshing stats..."),await t().refreshStats()}),{stats:{totalPatients:0,totalAppointments:0,totalRevenue:0,pendingPayments:0,todayAppointments:0,thisMonthRevenue:0,lowStockItems:0},isLoading:!1,error:null,lastUpdated:null,loadStats:async()=>{e({isLoading:!0,error:null});try{const t=await(window.electronAPI?.dashboard?.getStats())||{totalPatients:0,totalAppointments:0,totalRevenue:0,pendingPayments:0,todayAppointments:0,thisMonthRevenue:0,lowStockItems:0};e({stats:t,isLoading:!1,lastUpdated:new Date})}catch(t){console.error("Error loading dashboard stats:",t),e({error:t instanceof Error?t.message:"Failed to load dashboard stats",isLoading:!1})}},updateStats:n=>{const{stats:a}=t();e({stats:{...a,...n},lastUpdated:new Date})},clearError:()=>{e({error:null})},refreshStats:async()=>{try{const n=await(window.electronAPI?.dashboard?.getStats())||t().stats;e({stats:n,lastUpdated:new Date}),console.log("📊 Dashboard stats refreshed after patient deletion")}catch(n){console.error("Error refreshing dashboard stats:",n)}}}),{name:"dashboard-store"})),ma=de()(xt((e,t)=>({items:[],filteredItems:[],usage:[],selectedItem:null,isLoading:!1,error:null,searchQuery:"",filters:{},categories:[],suppliers:[],totalItems:0,totalValue:0,lowStockCount:0,expiredCount:0,expiringSoonCount:0,loadItems:async()=>{e({isLoading:!0,error:null});try{const n=await(window.electronAPI?.inventory?.getAll())||[];e({items:n,filteredItems:n,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems()}catch(n){console.error("Error loading inventory items:",n),e({error:n instanceof Error?n.message:"Failed to load inventory items",isLoading:!1})}},createItem:async n=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.inventory.create(n),{items:s}=t(),r=[...s,a];e({items:r,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("inventory-changed",{detail:{type:"created",itemId:a.id,item:a}})),window.dispatchEvent(new CustomEvent("inventory-added",{detail:{type:"created",itemId:a.id,item:a}})))}catch(a){console.error("Error creating inventory item:",a),e({error:a instanceof Error?a.message:"Failed to create inventory item",isLoading:!1})}},updateItem:async(n,a)=>{e({isLoading:!0,error:null});try{const s=await window.electronAPI.inventory.update(n,a),{items:r,selectedItem:i}=t(),l=r.map(e=>e.id===n?s:e);e({items:l,selectedItem:i?.id===n?s:i,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("inventory-changed",{detail:{type:"updated",itemId:n,item:s}})),window.dispatchEvent(new CustomEvent("inventory-updated",{detail:{type:"updated",itemId:n,item:s}})))}catch(s){console.error("Error updating inventory item:",s),e({error:s instanceof Error?s.message:"Failed to update inventory item",isLoading:!1})}},deleteItem:async n=>{e({isLoading:!0,error:null});try{if(!(await window.electronAPI.inventory.delete(n)))throw new Error("Failed to delete inventory item");{const{items:a,selectedItem:s}=t(),r=a.filter(e=>e.id!==n);e({items:r,selectedItem:s?.id===n?null:s,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterItems(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("inventory-changed",{detail:{type:"deleted",itemId:n}})),window.dispatchEvent(new CustomEvent("inventory-deleted",{detail:{type:"deleted",itemId:n}})))}}catch(a){console.error("Error deleting inventory item:",a),e({error:a instanceof Error?a.message:"Failed to delete inventory item",isLoading:!1})}},loadUsage:async()=>{try{const t=await(window.electronAPI?.inventoryUsage?.getAll())||[];e({usage:t})}catch(t){console.error("Error loading inventory usage:",t)}},recordUsage:async n=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.inventoryUsage.create(n),{usage:s,items:r}=t(),i=[...s,a],l=r.map(e=>e.id===n.inventory_id?{...e,quantity:Math.max(0,e.quantity-n.quantity_used)}:e);e({usage:i,items:l,isLoading:!1}),t().calculateAnalytics(),t().filterItems()}catch(a){console.error("Error recording inventory usage:",a),e({error:a instanceof Error?a.message:"Failed to record inventory usage",isLoading:!1})}},getUsageHistory:e=>{const{usage:n}=t();return n.filter(t=>t.inventory_id===e).sort((e,t)=>new Date(t.usage_date).getTime()-new Date(e.usage_date).getTime())},setSelectedItem:t=>{e({selectedItem:t})},setSearchQuery:n=>{e({searchQuery:n}),t().searchItems(n)},setFilters:n=>{e({filters:n}),t().filterItems()},clearError:()=>{e({error:null})},searchItems:n=>{e({searchQuery:n}),t().filterItems()},filterItems:()=>{const{items:n,searchQuery:a,filters:s}=t();let r=[...n];if(""!==a.trim()){const e=a.toLowerCase();r=r.filter(t=>t.name.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)||t.category?.toLowerCase().includes(e)||t.supplier?.toLowerCase().includes(e))}if(s.category&&"all"!==s.category&&(r=r.filter(e=>e.category===s.category)),s.supplier&&"all"!==s.supplier&&(r=r.filter(e=>e.supplier===s.supplier)),s.status&&"all"!==s.status){const e=new Date;r=r.filter(t=>{switch(s.status){case"in_stock":return t.quantity>t.minimum_stock;case"low_stock":return t.quantity<=t.minimum_stock&&t.quantity>0;case"out_of_stock":return 0===t.quantity;case"expired":return t.expiry_date&&new Date(t.expiry_date)<e;case"expiring_soon":if(!t.expiry_date)return!1;const n=new Date(t.expiry_date),a=Math.ceil((n.getTime()-e.getTime())/864e5);return a<=30&&a>0;default:return!0}})}e({filteredItems:r})},calculateAnalytics:()=>{const{items:n}=t(),a=new Date,s=n.length,r=n.reduce((e,t)=>e+("number"==typeof t.quantity?t.quantity:0)*("number"==typeof t.cost_per_unit?t.cost_per_unit:0),0),i=n.filter(e=>{const t="number"==typeof e.quantity?e.quantity:0;return t<=("number"==typeof e.minimum_stock?e.minimum_stock:0)&&t>0}).length,l=n.filter(e=>{if(!e.expiry_date)return!1;try{const t=new Date(e.expiry_date);return!isNaN(t.getTime())&&t<a}catch(t){return console.warn("Invalid expiry date:",e.expiry_date,t),!1}}).length,o=n.filter(e=>{if(!e.expiry_date)return!1;try{const t=new Date(e.expiry_date);if(isNaN(t.getTime()))return!1;const n=Math.ceil((t.getTime()-a.getTime())/864e5);return n<=30&&n>0}catch(t){return console.warn("Invalid expiry date:",e.expiry_date,t),!1}}).length;e({totalItems:s,totalValue:r,lowStockCount:i,expiredCount:l,expiringSoonCount:o})},getLowStockItems:()=>{const{items:e}=t();return e.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0)},getExpiredItems:()=>{const{items:e}=t(),n=new Date;return e.filter(e=>e.expiry_date&&new Date(e.expiry_date)<n)},getExpiringSoonItems:(e=30)=>{const{items:n}=t(),a=new Date;return n.filter(t=>{if(!t.expiry_date)return!1;const n=new Date(t.expiry_date),s=Math.ceil((n.getTime()-a.getTime())/864e5);return s<=e&&s>0})},updateCategories:()=>{const{items:n}=t(),a=[...new Set(n.map(e=>e.category).filter(Boolean))];e({categories:a})},updateSuppliers:()=>{const{items:n}=t(),a=[...new Set(n.map(e=>e.supplier).filter(Boolean))];e({suppliers:a})}}),{name:"inventory-store"})),ua=()=>{const e=bt(e=>e.loadPatients),t=Jn(e=>e.loadAppointments),n=ca(e=>e.loadPayments),a=da(e=>e.refreshStats),s=ma(e=>e.loadItems);return re.useEffect(()=>{const e=async e=>{const{patientId:t,patientName:n}=e.detail;console.log(`🔄 Real-time sync: Patient ${n} (${t}) deleted, updating all stores...`),setTimeout(async()=>{try{await a(),console.log("📊 Dashboard stats refreshed via real-time sync")}catch(e){console.error("Error refreshing dashboard stats:",e)}},200)},t=async e=>{const{type:t,appointmentId:n}=e.detail;console.log(`🔄 Real-time sync: Appointment ${t} (${n})`),setTimeout(async()=>{try{await a()}catch(e){console.error("Error refreshing dashboard stats after appointment change:",e)}},100)},n=async e=>{const{type:t,paymentId:n}=e.detail;console.log(`🔄 Real-time sync: Payment ${t} (${n})`),setTimeout(async()=>{try{await a()}catch(e){console.error("Error refreshing dashboard stats after payment change:",e)}},100)},s=async e=>{const{type:t,itemId:n}=e.detail;console.log(`🔄 Real-time sync: Inventory ${t} (${n})`),setTimeout(async()=>{try{await a()}catch(e){console.error("Error refreshing dashboard stats after inventory change:",e)}},100)};return window.addEventListener("patient-deleted",e),window.addEventListener("appointment-changed",t),window.addEventListener("payment-changed",n),window.addEventListener("inventory-changed",s),()=>{window.removeEventListener("patient-deleted",e),window.removeEventListener("appointment-changed",t),window.removeEventListener("payment-changed",n),window.removeEventListener("inventory-changed",s)}},[a]),{syncAll:async()=>{console.log("🔄 Manual sync: Refreshing all stores...");try{await Promise.all([e(),t(),n(),s(),a()]),console.log("✅ Manual sync completed successfully")}catch(r){console.error("❌ Manual sync failed:",r)}},syncAfterPatientDeletion:async(e,t)=>{console.log(`🔄 Sync after patient deletion: ${t} (${e})`),window.dispatchEvent(new CustomEvent("patient-deleted",{detail:{patientId:e,patientName:t}})),setTimeout(async()=>{try{await a()}catch(e){console.error("Error in backup sync after patient deletion:",e)}},300)}}},pa=de()(xt((e,t)=>({prescriptions:[],filteredPrescriptions:[],selectedPrescription:null,isLoading:!1,error:null,searchQuery:"",patientFilter:"all",dateRangeFilter:{start:"",end:""},totalPrescriptions:0,recentPrescriptions:0,loadPrescriptions:async()=>{e({isLoading:!0,error:null});try{const n=await(window.electronAPI?.prescriptions?.getAll())||[];e({prescriptions:n,filteredPrescriptions:n,isLoading:!1}),t().calculateStatistics(),t().filterPrescriptions()}catch(n){console.error("Error loading prescriptions:",n),e({error:n instanceof Error?n.message:"Failed to load prescriptions",isLoading:!1})}},createPrescription:async n=>{e({isLoading:!0,error:null});try{const e=await(window.electronAPI?.prescriptions?.create(n));e&&(await t().loadPrescriptions(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("prescription-added",{detail:{type:"created",prescriptionId:e.id,prescription:e}})),window.dispatchEvent(new CustomEvent("prescription-changed",{detail:{type:"created",prescriptionId:e.id,prescription:e}}))))}catch(a){throw console.error("Error creating prescription:",a),e({error:a instanceof Error?a.message:"Failed to create prescription",isLoading:!1}),a}},updatePrescription:async(n,a)=>{e({isLoading:!0,error:null});try{const e=await(window.electronAPI?.prescriptions?.update(n,a));e&&(await t().loadPrescriptions(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("prescription-updated",{detail:{type:"updated",prescriptionId:n,prescription:e}})),window.dispatchEvent(new CustomEvent("prescription-changed",{detail:{type:"updated",prescriptionId:n,prescription:e}}))))}catch(s){throw console.error("Error updating prescription:",s),e({error:s instanceof Error?s.message:"Failed to update prescription",isLoading:!1}),s}},deletePrescription:async n=>{e({isLoading:!0,error:null});try{if(await(window.electronAPI?.prescriptions?.delete(n))){const a=t().prescriptions.filter(e=>e.id!==n);e({prescriptions:a,filteredPrescriptions:a,selectedPrescription:t().selectedPrescription?.id===n?null:t().selectedPrescription,isLoading:!1}),t().calculateStatistics(),t().filterPrescriptions(),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("prescription-deleted",{detail:{type:"deleted",prescriptionId:n}})),window.dispatchEvent(new CustomEvent("prescription-changed",{detail:{type:"deleted",prescriptionId:n}})))}}catch(a){throw console.error("Error deleting prescription:",a),e({error:a instanceof Error?a.message:"Failed to delete prescription",isLoading:!1}),a}},setSearchQuery:n=>{e({searchQuery:n}),t().filterPrescriptions()},setPatientFilter:n=>{e({patientFilter:n}),t().filterPrescriptions()},setDateRangeFilter:n=>{e({dateRangeFilter:n}),t().filterPrescriptions()},clearFilters:()=>{e({searchQuery:"",patientFilter:"all",dateRangeFilter:{start:"",end:""}}),t().filterPrescriptions()},filterPrescriptions:()=>{const{prescriptions:n,searchQuery:a,patientFilter:s,dateRangeFilter:r}=t();let i=[...n];if(a.trim()&&(i=i.filter(e=>e.patient?.full_name?.toLowerCase().includes(a.toLowerCase())||e.appointment?.title?.toLowerCase().includes(a.toLowerCase())||e.notes?.toLowerCase().includes(a.toLowerCase())||e.medications?.some(e=>e.medication_name?.toLowerCase().includes(a.toLowerCase())))),"all"!==s&&(i=i.filter(e=>e.patient_id===s)),r.start&&r.end){const e=new Date(r.start),t=new Date(r.end);i=i.filter(n=>{const a=new Date(n.prescription_date);return a>=e&&a<=t})}e({filteredPrescriptions:i})},setSelectedPrescription:t=>{e({selectedPrescription:t})},clearError:()=>{e({error:null})},calculateStatistics:()=>{const{prescriptions:n}=t(),a=n.length,s=new Date;s.setDate(s.getDate()-30);const r=n.filter(e=>new Date(e.prescription_date)>=s).length;e({totalPrescriptions:a,recentPrescriptions:r})},getPrescriptionsByPatient:e=>t().prescriptions.filter(t=>t.patient_id===e),getPrescriptionsByDateRange:(e,n)=>t().prescriptions.filter(t=>{const a=new Date(t.prescription_date);return a>=e&&a<=n})}),{name:"prescription-store"}));function ha(){const{loadAppointments:e}=Jn(),{loadPayments:t}=ca(),{loadPatients:n}=bt(),{loadPrescriptions:a}=pa(),{loadInventoryItems:s}=ma(),r=re.useCallback(async()=>{console.log("🔄 Refreshing all tables...");try{await Promise.all([e(),t(),n(),a(),s()]),console.log("✅ All tables refreshed successfully")}catch(r){console.error("❌ Error refreshing tables:",r)}},[e,t,n,a,s]),i=re.useCallback(async r=>{console.log(`🔄 Refreshing ${r} table...`);try{switch(r){case"appointments":await e();break;case"payments":await t();break;case"patients":await n();break;case"prescriptions":await a();break;case"inventory":await s();break;default:console.warn("Unknown table type:",r)}console.log(`✅ ${r} table refreshed successfully`)}catch(i){console.error(`❌ Error refreshing ${r} table:`,i)}},[e,t,n,a,s]);return re.useEffect(()=>{console.log("🔔 Setting up real-time table sync listeners...");const e=async e=>{console.log("📅 Appointment changed, refreshing appointments table...",e.detail?.type),setTimeout(()=>i("appointments"),50)},t=async e=>{console.log("💰 Payment changed, refreshing payments table...",e.detail?.type),setTimeout(()=>i("payments"),50)},n=async e=>{console.log("👤 Patient changed, refreshing patients table...",e.detail?.type),setTimeout(()=>i("patients"),50),setTimeout(()=>{i("appointments"),i("payments")},100)},a=async e=>{console.log("💊 Prescription changed, refreshing prescriptions table...",e.detail?.type),setTimeout(()=>i("prescriptions"),50)},s=async e=>{console.log("📦 Inventory changed, refreshing inventory table...",e.detail?.type),setTimeout(()=>i("inventory"),50)},r=["appointment-added","appointment-updated","appointment-deleted","appointment-changed"],l=["payment-added","payment-updated","payment-deleted","payment-changed"],o=["patient-added","patient-updated","patient-deleted","patient-changed"],c=["prescription-added","prescription-updated","prescription-deleted","prescription-changed"],d=["inventory-added","inventory-updated","inventory-deleted","inventory-changed"];return r.forEach(t=>{window.addEventListener(t,e)}),l.forEach(e=>{window.addEventListener(e,t)}),o.forEach(e=>{window.addEventListener(e,n)}),c.forEach(e=>{window.addEventListener(e,a)}),d.forEach(e=>{window.addEventListener(e,s)}),()=>{console.log("🔔 Cleaning up real-time table sync listeners..."),r.forEach(t=>{window.removeEventListener(t,e)}),l.forEach(e=>{window.removeEventListener(e,t)}),o.forEach(e=>{window.removeEventListener(e,n)}),c.forEach(e=>{window.removeEventListener(e,a)}),d.forEach(e=>{window.removeEventListener(e,s)})}},[i]),{refreshAllTables:r,refreshTable:i}}function xa(){const[e,t]=re.useState({isAuthenticated:!1,isLoading:!0,passwordEnabled:!1});ta(),re.useEffect(()=>{n()},[]);const n=async()=>{try{console.log("🔐 Checking auth status...");const e=await window.electronAPI.settings.get();console.log("🔐 Current settings:",e);const n=1===e?.password_enabled,a=e?.app_password&&e.app_password.length>0;if(console.log("🔐 Password enabled:",n),console.log("🔐 Has password:",a),!n||!a)return console.log("🔐 No password protection, allowing access"),void t({isAuthenticated:!0,isLoading:!1,passwordEnabled:!1});const s="true"===sessionStorage.getItem("dental_clinic_auth");console.log("🔐 Has valid session:",s),s?(console.log("🔐 Valid session found, allowing access"),t({isAuthenticated:!0,isLoading:!1,passwordEnabled:!0})):(console.log("🔐 No valid session, requiring authentication"),t({isAuthenticated:!1,isLoading:!1,passwordEnabled:!0}))}catch(e){console.error("❌ Error checking auth status:",e),t({isAuthenticated:!1,isLoading:!1,passwordEnabled:!1})}};return{...e,login:async e=>{try{console.log("🔐 Attempting login...");const n=await window.electronAPI.settings.get();if(!n?.app_password)return console.log("❌ No password set in settings"),!1;const a=await ga(e);return console.log("🔐 Password hashed, comparing..."),a===n.app_password?(console.log("✅ Password correct, setting session"),sessionStorage.setItem("dental_clinic_auth","true"),t(e=>({...e,isAuthenticated:!0})),!0):(console.log("❌ Password incorrect"),!1)}catch(n){return console.error("❌ Login error:",n),!1}},logout:async()=>{sessionStorage.removeItem("dental_clinic_auth");try{window.electronAPI?.auth?.clearSession&&await window.electronAPI.auth.clearSession()}catch(e){console.log("Could not clear session via Electron:",e)}t(e=>({...e,isAuthenticated:!1}))},setPassword:async e=>{try{console.log("🔐 Setting password...");const n=await ga(e);console.log("🔐 Updating settings with hashed password...");const a=await fa(window.electronAPI.settings.update({app_password:n,password_enabled:1}),1e4);return console.log("🔐 Settings updated:",a),a?(t(e=>({...e,passwordEnabled:!0})),console.log("✅ Password set successfully"),!0):(console.log("❌ Failed to update settings"),!1)}catch(n){return console.error("❌ Error setting password:",n),!1}},removePassword:async()=>{try{console.log("🔐 Removing password...");const e=await fa(window.electronAPI.settings.update({app_password:null,password_enabled:0}),1e4);return console.log("🔐 Settings updated:",e),e?(t(e=>({...e,passwordEnabled:!1,isAuthenticated:!0})),console.log("✅ Password removed successfully"),!0):(console.log("❌ Failed to update settings"),!1)}catch(e){return console.error("❌ Error removing password:",e),!1}},changePassword:async(e,t)=>{try{console.log("🔐 Changing password...");const n=await window.electronAPI.settings.get();if(!n?.app_password)return console.log("❌ No existing password found"),!1;if(await ga(e)!==n.app_password)return console.log("❌ Old password is incorrect"),!1;const a=await ga(t);console.log("🔐 Updating with new password...");const s=await fa(window.electronAPI.settings.update({app_password:a}),1e4);return console.log("🔐 Settings updated:",s),s?(console.log("✅ Password changed successfully"),!0):(console.log("❌ Failed to update settings"),!1)}catch(n){return console.error("❌ Error changing password:",n),!1}},checkAuthStatus:n}}async function ga(e){try{const t=(new TextEncoder).encode(e+"dental_clinic_salt_2024"),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(t){throw console.error("Error hashing password:",t),t}}function fa(e,t){return Promise.race([e,new Promise((e,n)=>setTimeout(()=>n(new Error("Operation timed out")),t))])}const va=[{number:28,name:"Third Molar",arabicName:"ضرس العقل",position:"upper",side:"right",type:"molar"},{number:27,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"right",type:"molar"},{number:26,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"right",type:"molar"},{number:25,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"upper",side:"right",type:"premolar"},{number:24,name:"First Premolar",arabicName:"ضاحك أول",position:"upper",side:"right",type:"premolar"},{number:23,name:"Canine",arabicName:"ناب",position:"upper",side:"right",type:"canine"},{number:22,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"right",type:"incisor"},{number:21,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"right",type:"incisor"},{number:11,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"left",type:"incisor"},{number:12,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"left",type:"incisor"},{number:13,name:"Canine",arabicName:"ناب",position:"upper",side:"left",type:"canine"},{number:14,name:"First Premolar",arabicName:"ضاحك أول",position:"upper",side:"left",type:"premolar"},{number:15,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"upper",side:"left",type:"premolar"},{number:16,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"left",type:"molar"},{number:17,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"left",type:"molar"},{number:18,name:"Third Molar",arabicName:"ضرس العقل",position:"upper",side:"left",type:"molar"},{number:38,name:"Third Molar",arabicName:"ضرس العقل",position:"lower",side:"right",type:"molar"},{number:37,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"right",type:"molar"},{number:36,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"right",type:"molar"},{number:35,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"lower",side:"right",type:"premolar"},{number:34,name:"First Premolar",arabicName:"ضاحك أول",position:"lower",side:"right",type:"premolar"},{number:33,name:"Canine",arabicName:"ناب",position:"lower",side:"right",type:"canine"},{number:32,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"right",type:"incisor"},{number:31,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"right",type:"incisor"},{number:41,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"left",type:"incisor"},{number:42,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"left",type:"incisor"},{number:43,name:"Canine",arabicName:"ناب",position:"lower",side:"left",type:"canine"},{number:44,name:"First Premolar",arabicName:"ضاحك أول",position:"lower",side:"left",type:"premolar"},{number:45,name:"Second Premolar",arabicName:"ضاحك ثاني",position:"lower",side:"left",type:"premolar"},{number:46,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"left",type:"molar"},{number:47,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"left",type:"molar"},{number:48,name:"Third Molar",arabicName:"ضرس العقل",position:"lower",side:"left",type:"molar"}],ya=[{number:65,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"right",type:"molar"},{number:64,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"right",type:"molar"},{number:63,name:"Canine",arabicName:"ناب",position:"upper",side:"right",type:"canine"},{number:62,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"right",type:"incisor"},{number:61,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"right",type:"incisor"},{number:51,name:"Central Incisor",arabicName:"ثنية",position:"upper",side:"left",type:"incisor"},{number:52,name:"Lateral Incisor",arabicName:"رباعية",position:"upper",side:"left",type:"incisor"},{number:53,name:"Canine",arabicName:"ناب",position:"upper",side:"left",type:"canine"},{number:54,name:"First Molar",arabicName:"رحى أولى",position:"upper",side:"left",type:"molar"},{number:55,name:"Second Molar",arabicName:"رحى ثانية",position:"upper",side:"left",type:"molar"},{number:75,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"right",type:"molar"},{number:74,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"right",type:"molar"},{number:73,name:"Canine",arabicName:"ناب",position:"lower",side:"right",type:"canine"},{number:72,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"right",type:"incisor"},{number:71,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"right",type:"incisor"},{number:81,name:"Central Incisor",arabicName:"ثنية",position:"lower",side:"left",type:"incisor"},{number:82,name:"Lateral Incisor",arabicName:"رباعية",position:"lower",side:"left",type:"incisor"},{number:83,name:"Canine",arabicName:"ناب",position:"lower",side:"left",type:"canine"},{number:84,name:"First Molar",arabicName:"رحى أولى",position:"lower",side:"left",type:"molar"},{number:85,name:"Second Molar",arabicName:"رحى ثانية",position:"lower",side:"left",type:"molar"}],ba=(e,t=!1)=>(t?ya:va).find(t=>t.number===e),ja=[{value:"healthy",label:"سليم",color:"#22c55e",category:"العلاجات الوقائية"},{value:"cleaning",label:"تنظيف",color:"#06b6d4",category:"العلاجات الوقائية"},{value:"fluoride",label:"فلورايد",color:"#0ea5e9",category:"العلاجات الوقائية"},{value:"sealant",label:"حشو وقائي",color:"#14b8a6",category:"العلاجات الوقائية"},{value:"scaling",label:"تقليح",color:"#06b6d4",category:"العلاجات الوقائية"},{value:"filling_metal",label:"حشو معدني",color:"#64748b",category:"الترميمية (المحافظة)"},{value:"filling_cosmetic",label:"حشو تجميلي",color:"#f97316",category:"الترميمية (المحافظة)"},{value:"filling_glass_ionomer",label:"حشو زجاجي",color:"#fb7185",category:"الترميمية (المحافظة)"},{value:"inlay",label:"حشو داخلي",color:"#a855f7",category:"الترميمية (المحافظة)"},{value:"onlay",label:"حشو خارجي",color:"#8b5cf6",category:"الترميمية (المحافظة)"},{value:"pulp_therapy",label:"مداولة لبية",color:"#dc2626",category:"علاج العصب"},{value:"direct_pulp_cap",label:"تغطية مباشرة",color:"#f87171",category:"علاج العصب"},{value:"indirect_pulp_cap",label:"تغطية غير مباشرة",color:"#fca5a5",category:"علاج العصب"},{value:"retreatment",label:"إعادة معالجة",color:"#b91c1c",category:"علاج العصب"},{value:"deep_pulp_treatment",label:"معالجة لبية عفنة",color:"#991b1b",category:"علاج العصب"},{value:"extraction_simple",label:"قلع بسيط",color:"#6b7280",category:"العلاجات الجراحية"},{value:"extraction_surgical",label:"قلع جراحي",color:"#4b5563",category:"العلاجات الجراحية"},{value:"implant",label:"زراعة",color:"#10b981",category:"العلاجات الجراحية"},{value:"bone_graft",label:"ترقيع عظم",color:"#059669",category:"العلاجات الجراحية"},{value:"sinus_lift",label:"رفع الجيب الفكي",color:"#047857",category:"العلاجات الجراحية"},{value:"gum_surgery",label:"جراحة لثة",color:"#065f46",category:"العلاجات الجراحية"},{value:"apical_resection",label:"قطع ذروة",color:"#374151",category:"العلاجات الجراحية"},{value:"veneer_porcelain",label:"قشرة خزفية",color:"#ec4899",category:"العلاجات التجميلية"},{value:"veneer_composite",label:"قشرة مركبة",color:"#f472b6",category:"العلاجات التجميلية"},{value:"whitening",label:"تبييض",color:"#fbbf24",category:"العلاجات التجميلية"},{value:"bonding",label:"ربط تجميلي",color:"#f59e0b",category:"العلاجات التجميلية"},{value:"contouring",label:"تشكيل تجميلي",color:"#d97706",category:"العلاجات التجميلية"},{value:"polish",label:"بوليش",color:"#eab308",category:"العلاجات التجميلية"},{value:"orthodontic_metal",label:"تقويم معدني",color:"#6366f1",category:"علاجات التقويم"},{value:"orthodontic_ceramic",label:"تقويم خزفي",color:"#8b5cf6",category:"علاجات التقويم"},{value:"orthodontic_clear",label:"تقويم شفاف",color:"#a855f7",category:"علاجات التقويم"},{value:"retainer",label:"مثبت",color:"#7c3aed",category:"علاجات التقويم"},{value:"space_maintainer",label:"حافظ مسافة",color:"#5b21b6",category:"علاجات التقويم"},{value:"scaling_periodontal",label:"تقليح",color:"#0891b2",category:"علاجات اللثة"},{value:"subgingival_scaling",label:"تقليح تحت لثوي",color:"#0e7490",category:"علاجات اللثة"},{value:"deep_cleaning",label:"تنظيف عميق",color:"#0891b2",category:"علاجات اللثة"},{value:"root_planing",label:"تسوية الجذور",color:"#0e7490",category:"علاجات اللثة"},{value:"gum_graft",label:"ترقيع لثة",color:"#155e75",category:"علاجات اللثة"},{value:"pocket_reduction",label:"تقليل الجيوب",color:"#164e63",category:"علاجات اللثة"},{value:"pediatric_filling",label:"حشوة",color:"#f472b6",category:"علاجات الأطفال"},{value:"pulp_amputation",label:"بتر لب",color:"#ec4899",category:"علاجات الأطفال"},{value:"pediatric_pulp_treatment",label:"معالجة لبية",color:"#db2777",category:"علاجات الأطفال"},{value:"pulp_therapy_pediatric",label:"علاج عصب لبني",color:"#f472b6",category:"علاجات الأطفال"},{value:"stainless_crown",label:"تاج ستانلس",color:"#9ca3af",category:"علاجات الأطفال"},{value:"space_maintainer_fixed",label:"حافظ مسافة ثابت",color:"#6b7280",category:"علاجات الأطفال"},{value:"space_maintainer_removable",label:"حافظ مسافة متحرك",color:"#4b5563",category:"علاجات الأطفال"},{value:"crown_metal",label:"تاج معدني",color:"#6b7280",category:"التعويضات"},{value:"crown_ceramic",label:"تاج خزفي",color:"#8b5cf6",category:"التعويضات"},{value:"crown_zirconia",label:"تاج زيركونيا",color:"#a855f7",category:"التعويضات"},{value:"bridge",label:"جسر",color:"#f59e0b",category:"التعويضات"},{value:"complete_denture_acrylic",label:"جهاز متحرك كامل أكريل",color:"#94a3b8",category:"التعويضات"},{value:"partial_denture_acrylic",label:"جهاز متحرك جزئي أكريل",color:"#64748b",category:"التعويضات"},{value:"complete_denture_vitalium",label:"جهاز متحرك كامل فيتاليوم",color:"#475569",category:"التعويضات"},{value:"partial_denture_vitalium",label:"جهاز متحرك جزئي فيتاليوم",color:"#334155",category:"التعويضات"},{value:"complete_denture_flexible",label:"جهاز متحرك كامل مرن",color:"#e879f9",category:"التعويضات"},{value:"partial_denture_flexible",label:"جهاز متحرك جزئي مرن",color:"#d946ef",category:"التعويضات"},{value:"implant_crown_zirconia",label:"تعويض زركونيا فوق زرعة",color:"#a855f7",category:"التعويضات"},{value:"implant_crown_ceramic",label:"تعويض خزف فوق زرعة",color:"#8b5cf6",category:"التعويضات"},{value:"cast_post_core",label:"قلب ووتد مصبوب معدني",color:"#6b7280",category:"التعويضات"},{value:"zirconia_post_core",label:"قلب ووتد زركونيا",color:"#a855f7",category:"التعويضات"},{value:"veneer",label:"فينير",color:"#a855f7",category:"التعويضات"}],wa=[{value:"العلاجات الوقائية",label:"العلاجات الوقائية",color:"#22c55e",icon:"🛡️"},{value:"الترميمية (المحافظة)",label:"الترميمية (المحافظة)",color:"#f97316",icon:"🔧"},{value:"علاج العصب",label:"علاج العصب",color:"#ef4444",icon:"🦷"},{value:"العلاجات الجراحية",label:"العلاجات الجراحية",color:"#6b7280",icon:"⚔️"},{value:"العلاجات التجميلية",label:"العلاجات التجميلية",color:"#ec4899",icon:"✨"},{value:"علاجات التقويم",label:"علاجات التقويم",color:"#6366f1",icon:"📐"},{value:"علاجات اللثة",label:"علاجات اللثة",color:"#0891b2",icon:"🌿"},{value:"علاجات الأطفال",label:"علاجات الأطفال",color:"#f472b6",icon:"👶"},{value:"التعويضات",label:"التعويضات",color:"#8b5cf6",icon:"👑"}],Na=e=>ja.filter(t=>t.category===e),_a=e=>ja.find(t=>t.value===e),ka=e=>{const t=_a(e);return t?t.label:e},Sa=e=>{if(e&&(e.includes("العلاجات")||e.includes("علاج")||e.includes("التعويضات")))return e;return{preventive:"العلاجات الوقائية",restorative:"الترميمية (المحافظة)",endodontic:"علاج العصب",surgical:"العلاجات الجراحية",cosmetic:"العلاجات التجميلية",orthodontic:"علاجات التقويم",periodontal:"علاجات اللثة",pediatric:"علاجات الأطفال",prosthetic:"التعويضات"}[e]||e},Ca=[{value:"planned",label:"مخطط",color:"#3b82f6"},{value:"in_progress",label:"قيد التنفيذ",color:"#eab308"},{value:"completed",label:"مكتمل",color:"#22c55e"},{value:"cancelled",label:"ملغي",color:"#6b7280"}],$a=[{value:"before",label:"قبل العلاج",icon:"📷"},{value:"after",label:"بعد العلاج",icon:"✨"},{value:"xray",label:"أشعة سينية",icon:"🦴"},{value:"clinical",label:"صورة سريرية",icon:"🔬"}];let Da={},Ea=!1;const Ta=async()=>{if(!Ea){Ea=!0;try{if(window.electronAPI?.treatments?.getAll){const e=await window.electronAPI.treatments.getAll();e&&Array.isArray(e)&&e.forEach(e=>{e.id&&e.name&&(Da[e.id]=e.name)})}}catch(e){console.warn("خطأ في تحميل العلاجات المخصصة:",e)}finally{Ea=!1}}},Aa=async()=>{Da={},await Ta()},Fa=e=>{if(!e)return"غير محدد";const t=_a(e);return t?t.label:Da[n=e]?Da[n]:(Ea||0!==Object.keys(Da).length||Ta(),n);var n},Pa=e=>{if(!e)return"غير محدد";if(e&&(e.includes("العلاجات")||e.includes("علاج")||e.includes("التعويضات")))return e;return{preventive:"العلاجات الوقائية",restorative:"الترميمية (المحافظة)",endodontic:"علاج العصب",surgical:"العلاجات الجراحية",cosmetic:"العلاجات التجميلية",orthodontic:"علاجات التقويم",periodontal:"علاجات اللثة",pediatric:"علاجات الأطفال",prosthetic:"التعويضات"}[e]||e},Ra=e=>{if(!e)return"غير محدد";return{planned:"مخطط",in_progress:"قيد التنفيذ",completed:"مكتمل",cancelled:"ملغي",pending:"معلق",active:"نشط",inactive:"غير نشط"}[e]||e},Oa=e=>{if(!e)return"غير محدد";return{pending:"معلق",completed:"مكتمل",partial:"جزئي",cancelled:"ملغي",refunded:"مسترد"}[e]||e},Ma=()=>{const[e,t]=re.useState(!1);re.useEffect(()=>{(async()=>{t(!0);try{await Aa()}finally{t(!1)}})()},[]);return{updateTreatmentName:re.useCallback((e,t)=>{((e,t)=>{Da[e]=t})(e,t)},[]),refreshTreatmentNames:re.useCallback(async()=>{t(!0);try{await Aa()}finally{t(!1)}},[]),isLoading:e}},La={"ش":"a","س":"s","ي":"d","٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","ق":"r","ب":"f"};function Ia(e){const t=e.key;var n;return{originalKey:t,mappedKey:La[n=t]||n,isArabic:/[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/.test(t),ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,preventDefault:()=>e.preventDefault()}}
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */Object.fromEntries(Object.entries(La).map(([e,t])=>[t,e]));var za={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=(e,t)=>{const n=re.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:i="",children:l,...o},c)=>{return re.createElement("svg",{ref:c,...za,width:a,height:a,stroke:n,strokeWidth:r?24*Number(s)/Number(a):s,className:["lucide",`lucide-${d=e,d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,i].join(" "),...o},[...t.map(([e,t])=>re.createElement(e,t)),...Array.isArray(l)?l:[l]]);var d});return n.displayName=`${e}`,n},Va=Ba("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Ya=Ba("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),qa=Ba("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ua=Ba("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),Ha=Ba("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Ga=Ba("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),Wa=Ba("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),Ka=Ba("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),Za=Ba("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Qa=Ba("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),Xa=Ba("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),Ja=Ba("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),es=Ba("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),ts=Ba("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),ns=Ba("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),as=Ba("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),ss=Ba("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),rs=Ba("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),is=Ba("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),ls=Ba("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),os=Ba("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]),cs=Ba("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]),ds=Ba("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),ms=Ba("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),us=Ba("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),ps=Ba("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),hs=Ba("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),xs=Ba("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),gs=Ba("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),fs=Ba("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),vs=Ba("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),ys=Ba("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),bs=Ba("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),js=Ba("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),ws=Ba("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]),Ns=Ba("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),_s=Ba("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),ks=Ba("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ss=Ba("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Cs=Ba("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),$s=Ba("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),Ds=Ba("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]),Es=Ba("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),Ts=Ba("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),As=Ba("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Fs=Ba("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Ps=Ba("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Rs=Ba("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Os=Ba("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),Ms=Ba("Microscope",[["path",{d:"M6 18h8",key:"1borvv"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M14 22a7 7 0 1 0 0-14h-1",key:"1jwaiy"}],["path",{d:"M9 14h2",key:"197e7h"}],["path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z",key:"1bmzmy"}],["path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3",key:"1drr47"}]]),Ls=Ba("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Is=Ba("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),zs=Ba("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Bs=Ba("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),Vs=Ba("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),Ys=Ba("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"9",x2:"9",y1:"3",y2:"21",key:"13tij5"}]]),qs=Ba("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),Us=Ba("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),Hs=Ba("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Gs=Ba("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]),Ws=Ba("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]),Ks=Ba("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),Zs=Ba("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Qs=Ba("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),Xs=Ba("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),Js=Ba("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),er=Ba("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),tr=Ba("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),nr=Ba("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ar=Ba("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),sr=Ba("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),rr=Ba("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),ir=Ba("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),lr=Ba("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),or=Ba("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),cr=Ba("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),dr=Ba("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),mr=Ba("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),ur=Ba("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),pr=Ba("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),hr=Ba("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),xr=Ba("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),gr=Ba("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),fr=Ba("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]),vr=Ba("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),yr=Ba("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),br=Ba("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),jr=Ba("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),wr=Ba("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Nr=Ba("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),_r=Ba("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),kr=Ba("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Sr=l,Cr=i,$r=re.forwardRef(({className:n,...a},s)=>e.jsx(t,{ref:s,className:En("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...a}));$r.displayName=t.displayName;const Dr=re.forwardRef(({className:t,children:s,...r},i)=>e.jsxs(Cr,{children:[e.jsx($r,{}),e.jsxs(n,{ref:i,dir:"rtl",className:En("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border-2 border-border bg-background p-6 shadow-2xl duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[s,e.jsxs(a,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-all duration-200 hover:opacity-100 hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(_r,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"إغلاق"})]})]})]}));Dr.displayName=n.displayName;const Er=({className:t,...n})=>e.jsx("div",{className:En("flex flex-col space-y-1.5 text-center sm:text-right",t),...n});Er.displayName="DialogHeader";const Tr=({className:t,...n})=>e.jsx("div",{className:En("flex flex-col-reverse sm:flex-row sm:justify-start sm:space-x-reverse sm:space-x-2",t),...n});Tr.displayName="DialogFooter";const Ar=re.forwardRef(({className:t,...n},a)=>e.jsx(s,{ref:a,className:En("text-lg font-semibold leading-none tracking-tight",t),...n}));Ar.displayName=s.displayName;const Fr=re.forwardRef(({className:t,...n},a)=>e.jsx(r,{ref:a,className:En("text-sm text-muted-foreground",t),...n}));Fr.displayName=r.displayName;const Pr=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,Rr=me,Or=(e,t)=>n=>{var a;if(null==(null==t?void 0:t.variants))return Rr(e,null==n?void 0:n.class,null==n?void 0:n.className);const{variants:s,defaultVariants:r}=t,i=Object.keys(s).map(e=>{const t=null==n?void 0:n[e],a=null==r?void 0:r[e];if(null===t)return null;const i=Pr(t)||Pr(a);return s[e][i]}),l=n&&Object.entries(n).reduce((e,t)=>{let[n,a]=t;return void 0===a||(e[n]=a),e},{}),o=null==t||null===(a=t.compoundVariants)||void 0===a?void 0:a.reduce((e,t)=>{let{class:n,className:a,...s}=t;return Object.entries(s).every(e=>{let[t,n]=e;return Array.isArray(n)?n.includes({...r,...l}[t]):{...r,...l}[t]===n})?[...e,n,a]:e},[]);return Rr(e,i,o,null==n?void 0:n.class,null==n?void 0:n.className)},Mr=Or("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 relative overflow-hidden",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-md hover:bg-primary/90 hover:shadow-lg active:scale-[0.98] dark:shadow-lg dark:shadow-primary/20 before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/10 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity",destructive:"bg-destructive text-destructive-foreground shadow-md hover:bg-destructive/90 hover:shadow-lg active:scale-[0.98] dark:shadow-lg dark:shadow-destructive/20 before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/10 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity",outline:"border-2 border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground hover:border-ring/50 active:scale-[0.98] dark:border-border dark:hover:bg-accent/80 dark:shadow-md",secondary:"bg-secondary text-secondary-foreground shadow-md hover:bg-secondary/80 hover:shadow-lg active:scale-[0.98] dark:shadow-lg dark:shadow-secondary/20 before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/10 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity",ghost:"hover:bg-accent hover:text-accent-foreground active:scale-[0.98] dark:hover:bg-accent/80 transition-colors",link:"text-primary underline-offset-4 hover:underline active:scale-[0.98] dark:text-primary",success:"bg-green-600 text-white shadow-md hover:bg-green-700 hover:shadow-lg active:scale-[0.98] dark:bg-green-700 dark:hover:bg-green-600 dark:shadow-lg dark:shadow-green-700/20",warning:"bg-amber-600 text-white shadow-md hover:bg-amber-700 hover:shadow-lg active:scale-[0.98] dark:bg-amber-700 dark:hover:bg-amber-600 dark:shadow-lg dark:shadow-amber-700/20"},size:{default:"h-10 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-11 rounded-md px-8 text-base",icon:"h-10 w-10",xs:"h-6 rounded px-2 text-xs"}},defaultVariants:{variant:"default",size:"default"}}),Lr=re.forwardRef(({className:t,variant:n,size:a,asChild:s=!1,...r},i)=>{const l=s?o:"button";return e.jsx(l,{className:En(Mr({variant:n,size:a,className:t})),ref:i,...r})});Lr.displayName="Button";const Ir=re.forwardRef(({className:t,type:n,...a},s)=>e.jsx("input",{type:n,className:En("flex h-10 w-full rounded-md border-2 border-input bg-background px-3 py-2 text-sm shadow-sm transition-all duration-200 file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-ring hover:border-ring/50 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-background dark:border-input dark:text-foreground dark:placeholder:text-muted-foreground dark:focus-visible:ring-ring dark:hover:border-ring/50 dark:shadow-md",t),ref:s,...a}));Ir.displayName="Input";var zr=re.forwardRef((t,n)=>e.jsx(c.label,{...t,ref:n,onMouseDown:e=>{e.target.closest("button, input, select, textarea")||(t.onMouseDown?.(e),!e.defaultPrevented&&e.detail>1&&e.preventDefault())}}));zr.displayName="Label";var Br=zr;const Vr=Or("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-foreground dark:text-foreground"),Yr=re.forwardRef(({className:t,...n},a)=>e.jsx(Br,{ref:a,className:En(Vr(),t),...n}));Yr.displayName=Br.displayName;const qr=Or("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Ur=re.forwardRef(({className:t,variant:n,...a},s)=>e.jsx("div",{ref:s,role:"alert",className:En(qr({variant:n}),t),...a}));Ur.displayName="Alert";re.forwardRef(({className:t,...n},a)=>e.jsx("h5",{ref:a,className:En("mb-1 font-medium leading-none tracking-tight",t),...n})).displayName="AlertTitle";const Hr=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,className:En("text-sm [&_p]:leading-relaxed",t),...n}));async function Gr(e){try{const t=(new TextEncoder).encode(e+"dental_clinic_salt_2024"),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(t){throw console.error("Error hashing password:",t),t}}function Wr({open:t,onOpenChange:n,onPasswordReset:a}){const[s,r]=re.useState("question"),[i,l]=re.useState(""),[o,c]=re.useState(""),[d,m]=re.useState(""),[u,p]=re.useState(""),[h,x]=re.useState(!1),[g,f]=re.useState(!1),[v,y]=re.useState(!1),[b,j]=re.useState(""),[w,N]=re.useState("");ie.useEffect(()=>{t&&(_(),r("question"),c(""),m(""),p(""),j(""),N(""))},[t]);const _=async()=>{try{const e=await window.electronAPI.settings.get();e?.security_question?(l(e.security_question),r("answer")):j("لم يتم تعيين سؤال أمان. يرجى التواصل مع المسؤول.")}catch(e){console.error("Error loading security question:",e),j("حدث خطأ في تحميل سؤال الأمان")}},k=async()=>{if(o.trim()){y(!0),j("");try{const e=await window.electronAPI.settings.get();if(!e?.security_answer)return j("لم يتم تعيين إجابة سؤال الأمان"),void y(!1);await Gr(o.trim().toLowerCase())===e.security_answer?(r("newPassword"),j("")):j("إجابة سؤال الأمان غير صحيحة")}catch(e){console.error("Error verifying security answer:",e),j("حدث خطأ في التحقق من إجابة سؤال الأمان")}finally{y(!1)}}else j("يرجى إدخال إجابة سؤال الأمان")},S=async()=>{if(d&&u)if(d===u)if(d.length<4)j("كلمة المرور يجب أن تكون 4 أحرف على الأقل");else{y(!0),j("");try{const e=await Gr(d);await window.electronAPI.settings.update({app_password:e}),N("تم تغيير كلمة المرور بنجاح"),setTimeout(()=>{a(),n(!1)},2e3)}catch(e){console.error("Error resetting password:",e),j("حدث خطأ في تغيير كلمة المرور")}finally{y(!1)}}else j("كلمة المرور وتأكيدها غير متطابقتين");else j("يرجى إدخال كلمة المرور الجديدة وتأكيدها")},C=()=>{r("question"),c(""),m(""),p(""),j(""),N(""),n(!1)};return e.jsx(Sr,{open:t,onOpenChange:C,children:e.jsxs(Dr,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(Er,{children:e.jsxs(Ar,{className:"flex items-center gap-2 text-right",children:[e.jsx($s,{className:"w-5 h-5 text-primary"}),"استعادة كلمة المرور"]})}),e.jsxs("div",{className:"space-y-6",children:["question"===s&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"جاري تحميل سؤال الأمان..."})]}),"answer"===s&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ks,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-1",children:"سؤال الأمان"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300",children:i})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"answer",children:"الإجابة"}),e.jsx(Ir,{id:"answer",type:"text",value:o,onChange:e=>c(e.target.value),placeholder:"أدخل إجابة سؤال الأمان",className:"text-right",onKeyDown:e=>"Enter"===e.key&&k()})]}),e.jsx(Lr,{onClick:k,disabled:v||!o.trim(),className:"w-full",children:v?"جاري التحقق...":"تحقق من الإجابة"})]}),"newPassword"===s&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsx("p",{className:"text-green-800 dark:text-green-200 font-medium",children:"تم التحقق بنجاح! يمكنك الآن تعيين كلمة مرور جديدة"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"newPassword",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ir,{id:"newPassword",type:h?"text":"password",value:d,onChange:e=>m(e.target.value),placeholder:"أدخل كلمة المرور الجديدة",className:"text-right pr-10"}),e.jsx("button",{type:"button",onClick:()=>x(!h),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:h?e.jsx(vs,{className:"w-4 h-4"}):e.jsx(ys,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"confirmPassword",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ir,{id:"confirmPassword",type:g?"text":"password",value:u,onChange:e=>p(e.target.value),placeholder:"أعد إدخال كلمة المرور",className:"text-right pr-10",onKeyDown:e=>"Enter"===e.key&&S()}),e.jsx("button",{type:"button",onClick:()=>f(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:g?e.jsx(vs,{className:"w-4 h-4"}):e.jsx(ys,{className:"w-4 h-4"})})]})]}),e.jsx(Lr,{onClick:S,disabled:v||!d||!u,className:"w-full",children:v?"جاري التغيير...":"تغيير كلمة المرور"})]}),b&&e.jsxs(Ur,{variant:"destructive",children:[e.jsx(Ya,{className:"h-4 w-4"}),e.jsx(Hr,{children:b})]}),w&&e.jsxs(Ur,{className:"border-green-200 bg-green-50 text-green-800 dark:border-green-800 dark:bg-green-900/20 dark:text-green-200",children:[e.jsx(ns,{className:"h-4 w-4"}),e.jsx(Hr,{children:w})]}),"question"!==s&&!w&&e.jsx(Lr,{variant:"outline",onClick:C,className:"w-full",children:"إلغاء"})]})]})})}function Kr({onLogin:t,isLoading:n=!1}){const{isDarkMode:a,toggleDarkMode:s}=sa(),r=ra(),[i,l]=re.useState(""),[o,c]=re.useState(!1),[d,m]=re.useState(""),[u,p]=re.useState(0),[h,x]=re.useState(!1),[g,f]=re.useState(0),[v,y]=re.useState(!1);re.useEffect(()=>{let e;return h&&g>0&&(e=setInterval(()=>{f(e=>e<=1e3?(x(!1),p(0),m(""),0):e-1e3)},1e3)),()=>clearInterval(e)},[h,g]);return e.jsxs("div",{className:"min-h-screen login-gradient-bg flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/3 via-transparent to-secondary/3"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tl from-accent/5 via-transparent to-primary/3"}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-gradient-to-br from-primary/8 to-secondary/4 rounded-full login-floating-orb"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-80 h-80 bg-gradient-to-tl from-secondary/8 to-accent/4 rounded-full login-floating-orb",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/2 right-1/3 w-64 h-64 bg-gradient-to-r from-accent/8 to-primary/4 rounded-full login-floating-orb",style:{animationDelay:"4s"}}),e.jsx("button",{onClick:s,className:`absolute top-6 right-6 p-4 rounded-full ${r.card} backdrop-blur-md hover:scale-110 hover:rotate-12 transition-all duration-300 z-20 shadow-lg hover:shadow-xl border border-border/30`,title:a?"تبديل إلى الوضع الفاتح":"تبديل إلى الوضع المظلم",children:a?e.jsx(lr,{className:"w-6 h-6 text-yellow-400 drop-shadow-sm transition-transform duration-300"}):e.jsx(Is,{className:"w-6 h-6 text-primary drop-shadow-sm transition-transform duration-300"})}),e.jsxs("div",{className:"w-full max-w-md relative z-10",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("div",{className:"mx-auto w-28 h-28 bg-gradient-to-br from-primary/20 via-primary/15 to-secondary/20 rounded-full flex items-center justify-center mb-8 shadow-2xl backdrop-blur-sm border border-primary/20 hover:scale-105 hover:shadow-3xl transition-all duration-500 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/10 to-transparent rounded-full animate-pulse"}),e.jsx(ar,{className:"w-14 h-14 text-primary drop-shadow-lg relative z-10"})]}),e.jsx("h1",{className:`text-5xl font-bold ${r.textPrimary} arabic-enhanced mb-4 drop-shadow-lg`,children:"نظام إدارة العيادة"}),e.jsx("p",{className:`${r.textSecondary} arabic-enhanced text-xl font-medium opacity-90`,children:"يرجى إدخال كلمة المرور للدخول"})]}),e.jsxs("div",{className:`${r.card} backdrop-blur-xl rounded-3xl p-10 login-card-glow hover:scale-[1.02] transition-all duration-500 border border-border/50 relative overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-secondary/5 rounded-3xl"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),h)m(`تم حظر المحاولات لمدة ${Math.ceil(g/6e4)} دقيقة`);else if(i.trim()){m("");try{if(await t(i))p(0),l("");else{const e=u+1;p(e),e>=5?(x(!0),f(3e5),m("تم تجاوز عدد المحاولات المسموحة. تم حظر المحاولات لمدة 5 دقائق")):m("كلمة مرور خاطئة. المحاولات المتبقية: "+(5-e)),l("")}}catch(n){m("حدث خطأ أثناء التحقق من كلمة المرور"),console.error("Login error:",n)}}else m("يرجى إدخال كلمة المرور")},className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"password",className:`block text-lg font-semibold ${r.textPrimary} arabic-enhanced`,children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 pr-4 flex items-center",children:e.jsx(Fs,{className:"w-6 h-6 text-muted-foreground"})}),e.jsx("input",{type:o?"text":"password",id:"password",value:i,onChange:e=>l(e.target.value),disabled:n||h,className:`w-full pr-14 pl-14 py-4 border-2 ${r.input} rounded-xl focus:outline-none focus:ring-2 focus:ring-ring focus:border-ring disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 text-lg backdrop-blur-sm`,placeholder:"أدخل كلمة المرور",autoComplete:"current-password"}),e.jsx("button",{type:"button",onClick:()=>c(!o),disabled:n||h,className:"absolute inset-y-0 left-0 pl-4 flex items-center text-muted-foreground hover:text-foreground focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:o?e.jsx(vs,{className:"w-6 h-6"}):e.jsx(ys,{className:"w-6 h-6"})})]})]}),d&&e.jsxs("div",{className:`flex items-center space-x-3 space-x-reverse p-4 ${r.alertError} rounded-xl backdrop-blur-sm`,children:[e.jsx(Ya,{className:"w-6 h-6 text-destructive flex-shrink-0"}),e.jsx("span",{className:"text-base font-medium text-destructive arabic-enhanced",children:d})]}),h&&g>0&&e.jsx("div",{className:`text-center p-4 ${r.alertWarning} rounded-xl backdrop-blur-sm`,children:e.jsxs("p",{className:"text-base font-semibold arabic-enhanced",children:["الوقت المتبقي للحظر: ",(b=g,`${Math.floor(b/6e4)}:${Math.floor(b%6e4/1e3).toString().padStart(2,"0")}`)]})}),e.jsx("button",{type:"submit",disabled:n||h||!i.trim(),className:`w-full py-4 px-6 ${r.buttonPrimary} rounded-xl font-bold text-xl focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 arabic-enhanced`,children:n?e.jsxs("div",{className:"flex items-center justify-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"arabic-enhanced",children:"جاري التحقق..."})]}):h?e.jsx("span",{className:"arabic-enhanced",children:"محظور مؤقتاً"}):e.jsx("span",{className:"arabic-enhanced",children:"دخول"})}),u>0&&!h&&e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:`text-base ${r.textSecondary} font-medium arabic-enhanced`,children:["المحاولات المتبقية: ",5-u," من ",5]})}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{type:"button",onClick:()=>y(!0),className:`text-sm ${r.textSecondary} hover:text-primary transition-colors duration-200 arabic-enhanced flex items-center justify-center gap-2 mx-auto`,children:[e.jsx(ks,{className:"w-4 h-4"}),"نسيت كلمة المرور؟"]})})]})})]}),e.jsx(Wr,{open:v,onOpenChange:y,onPasswordReset:()=>{p(0),x(!1),f(0),m(""),l("")}}),e.jsx("div",{className:"text-center mt-12",children:e.jsxs("div",{className:`inline-flex items-center space-x-3 space-x-reverse px-8 py-4 ${r.card} backdrop-blur-md rounded-full shadow-lg hover:shadow-xl transition-all duration-300 border border-border/30`,children:[e.jsx(ar,{className:"w-5 h-5 text-primary"}),e.jsx("p",{className:`text-base ${r.textSecondary} font-semibold arabic-enhanced`,children:"نظام إدارة العيادة - AgorraCode"})]})})]})]});var b}function Zr({onActivate:t,isLoading:n=!1,machineInfo:a}){const{isDarkMode:s,toggleDarkMode:r}=sa(),i=ra(),[l,o]=re.useState(""),[c,d]=re.useState(""),[m,u]=re.useState(!1),[p,h]=re.useState(!1),x=e=>/^[A-Z0-9]{4,5}-[A-Z0-9]{4,5}-[A-Z0-9]{4,5}-[A-Z0-9]{4,5}$/.test(e),g=x(l),f=n||m||!g;return e.jsxs("div",{className:"min-h-screen login-gradient-bg flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/3 via-transparent to-secondary/3"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tl from-accent/5 via-transparent to-primary/3"}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-gradient-to-br from-primary/8 to-secondary/4 rounded-full login-floating-orb"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-80 h-80 bg-gradient-to-tl from-secondary/8 to-accent/4 rounded-full login-floating-orb",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/2 right-1/3 w-64 h-64 bg-gradient-to-r from-accent/8 to-primary/4 rounded-full login-floating-orb",style:{animationDelay:"4s"}}),e.jsx("button",{onClick:r,className:`absolute top-6 right-6 p-4 rounded-full ${i.card} backdrop-blur-md hover:scale-110 hover:rotate-12 transition-all duration-300 z-20 shadow-lg hover:shadow-xl border border-border/30`,title:s?"تبديل إلى الوضع الفاتح":"تبديل إلى الوضع المظلم",children:s?e.jsx(lr,{className:"w-6 h-6 text-yellow-400 drop-shadow-sm transition-transform duration-300"}):e.jsx(Is,{className:"w-6 h-6 text-primary drop-shadow-sm transition-transform duration-300"})}),a&&e.jsx("button",{onClick:()=>h(!p),className:`absolute top-6 left-6 p-4 rounded-full ${i.card} backdrop-blur-md hover:scale-110 transition-all duration-300 z-20 shadow-lg hover:shadow-xl border border-border/30`,title:"معلومات الجهاز",children:e.jsx(Cs,{className:"w-6 h-6 text-primary drop-shadow-sm transition-transform duration-300"})}),e.jsxs("div",{className:"w-full max-w-lg relative z-10",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("div",{className:"mx-auto w-16 h-16 bg-gradient-to-br from-primary/20 via-primary/15 to-secondary/20 rounded-full flex items-center justify-center mb-3 shadow-xl backdrop-blur-sm border border-primary/20 hover:scale-105 hover:shadow-2xl transition-all duration-500 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/10 to-transparent rounded-full animate-pulse"}),e.jsx($s,{className:"w-8 h-8 text-primary drop-shadow-lg relative z-10"})]}),e.jsx("h1",{className:`text-2xl font-bold ${i.textPrimary} arabic-enhanced mb-2 drop-shadow-lg`,children:"تفعيل الترخيص"}),e.jsx("p",{className:`${i.textSecondary} arabic-enhanced text-sm font-medium opacity-90 mb-1`,children:"يرجى إدخال مفتاح الترخيص لتفعيل النظام"}),e.jsx("p",{className:`${i.textSecondary} arabic-enhanced text-xs opacity-75`,children:"التنسيق المطلوب: XXXXX-XXXXX-XXXXX-XXXXX"})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:`${i.card} backdrop-blur-xl rounded-xl p-3 border border-border/50 relative overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-500/5 via-transparent to-blue-500/5 rounded-xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("h3",{className:`text-sm font-bold ${i.textPrimary} arabic-enhanced`,children:"تحتاج مساعدة في التفعيل؟"}),e.jsx("p",{className:`text-xs ${i.textSecondary} arabic-enhanced`,children:"فريق التطوير - AgorraCode"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center justify-center",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"p-1 bg-green-100 dark:bg-green-900/20 rounded",children:e.jsx(Os,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("div",{className:"text-center sm:text-right",children:e.jsx("p",{className:`text-xs font-medium ${i.textPrimary} arabic-enhanced`,children:"00963959669628"})})]}),e.jsxs("button",{type:"button",onClick:async()=>{const e="https://api.whatsapp.com/send/?phone=963959669628&text=مرحباً، أحتاج مساعدة في تفعيل ترخيص نظام إدارة العيادة السنية";try{if(window.electronAPI&&window.electronAPI.system&&window.electronAPI.system.openExternal)return void(await window.electronAPI.system.openExternal(e))}catch(t){console.log("Method 1 failed:",t)}try{if(window.electronAPI)return void(await(window.electronAPI.shell?.openExternal?.(e)))}catch(t){console.log("Method 2 failed:",t)}window.open(e,"_blank","noopener,noreferrer")},className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl flex items-center space-x-1 space-x-reverse",children:[e.jsx(Os,{className:"w-4 h-4"}),e.jsx("span",{className:"arabic-enhanced",children:"واتساب"})]})]})]})]})}),e.jsxs("div",{className:`${i.card} backdrop-blur-xl rounded-2xl p-4 login-card-glow hover:scale-[1.02] transition-all duration-500 border border-border/50 relative overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-secondary/5 rounded-2xl"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),l.trim())if(x(l)){d(""),u(!0);try{const e=await t(l);e.success||d(e.error||"فشل في تفعيل الترخيص")}catch(n){d("حدث خطأ أثناء تفعيل الترخيص"),console.error("License activation error:",n)}finally{u(!1)}}else d("تنسيق مفتاح الترخيص غير صحيح. يجب أن يكون بالشكل: XXXXX-XXXXX-XXXXX-XXXXX");else d("يرجى إدخال مفتاح الترخيص")},className:"space-y-3",dir:"rtl",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"licenseKey",className:`block text-sm font-semibold ${i.textPrimary} arabic-enhanced`,children:"مفتاح الترخيص"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx($s,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("input",{type:"text",id:"licenseKey",value:l,onChange:e=>{const t=(e=>{const t=e.replace(/[^A-Z0-9]/gi,"").toUpperCase(),n=[];for(let a=0;a<t.length;a+=5)n.push(t.slice(a,a+5));return n.slice(0,4).join("-")})(e.target.value);o(t),d("")},disabled:n||m,className:`w-full pr-10 pl-3 py-2 border-2 ${i.input} rounded-lg focus:outline-none focus:ring-2 focus:ring-ring focus:border-ring disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 text-sm backdrop-blur-sm font-mono tracking-wider text-center`,placeholder:"XXXXX-XXXXX-XXXXX-XXXXX",maxLength:23,autoComplete:"off",spellCheck:!1}),g&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center",children:e.jsx(ns,{className:"w-4 h-4 text-green-500"})})]}),e.jsx("p",{className:`text-xs ${i.textSecondary} arabic-enhanced`,children:"أدخل مفتاح الترخيص المكون من 20 حرف وأرقام مقسمة إلى 4 مجموعات"})]}),a&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:`text-xs font-medium ${i.textSecondary} arabic-enhanced`,children:"معرف الجهاز (أرسله للمطور)"}),e.jsx("button",{type:"button",onClick:()=>{a.hwid&&navigator.clipboard.writeText(a.hwid)},className:`text-xs px-2 py-1 rounded ${i.button} hover:opacity-80 transition-opacity`,title:"انقر للنسخ",children:"📋 نسخ"})]}),e.jsxs("div",{className:`p-2 ${i.cardSecondary} rounded border border-border/50 bg-muted/30`,children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(Cs,{className:"w-3 h-3 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-xs font-medium text-primary arabic-enhanced",children:"معرف جهازك الفريد"})]}),e.jsx("code",{className:"text-xs font-mono text-foreground break-all bg-background/50 p-1 rounded block",children:a.hwid}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 arabic-enhanced leading-relaxed",children:"💡 أرسل هذا المعرف للمطور عبر الواتساب للحصول على مفتاح ترخيص"})]})]}),c&&e.jsxs("div",{className:`flex items-center space-x-2 space-x-reverse p-2 ${i.alertError} rounded-lg backdrop-blur-sm`,children:[e.jsx(Ya,{className:"w-4 h-4 text-destructive flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-destructive arabic-enhanced",children:c})]}),e.jsx("button",{type:"submit",disabled:f,className:`w-full py-3 px-4 ${i.buttonPrimary} rounded-lg font-bold text-sm focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 arabic-enhanced`,children:n||m?e.jsxs("div",{className:"flex items-center justify-center space-x-2 space-x-reverse",children:[e.jsx(As,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"arabic-enhanced",children:"جاري التفعيل..."})]}):e.jsx("span",{className:"arabic-enhanced",children:"تفعيل الترخيص"})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:`text-xs ${i.textSecondary} font-medium arabic-enhanced`,children:l.length>0&&e.jsxs("span",{className:g?"text-green-500":"text-orange-500",children:[l.length,"/23 حرف ",g?"✓":""]})})})]})})]}),p&&a&&e.jsxs("div",{className:`mt-2 ${i.card} backdrop-blur-xl rounded-lg p-3 border border-border/50 relative overflow-hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/3 via-transparent to-secondary/3 rounded-lg"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("h3",{className:`text-sm font-semibold ${i.textPrimary} arabic-enhanced mb-2 flex items-center`,children:[e.jsx(ar,{className:"w-4 h-4 ml-1"}),"معلومات الجهاز"]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:`${i.textSecondary} arabic-enhanced`,children:[e.jsx("span",{className:"font-medium",children:"معرف الجهاز:"}),e.jsxs("span",{className:"font-mono ml-1 bg-muted px-1 py-0.5 rounded text-xs",children:[a.hwid.substring(0,8),"..."]})]}),e.jsxs("div",{className:`${i.textSecondary} arabic-enhanced`,children:[e.jsx("span",{className:"font-medium",children:"النظام:"}),e.jsx("span",{className:"ml-1",children:a.platform})]}),e.jsxs("div",{className:`${i.textSecondary} arabic-enhanced`,children:[e.jsx("span",{className:"font-medium",children:"المعمارية:"}),e.jsx("span",{className:"ml-1",children:a.arch})]})]})]})]}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("div",{className:`inline-flex items-center space-x-2 space-x-reverse px-4 py-2 ${i.card} backdrop-blur-md rounded-full shadow-lg hover:shadow-xl transition-all duration-300 border border-border/30`,children:[e.jsx(ar,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:`text-xs ${i.textSecondary} font-semibold arabic-enhanced`,children:"نظام إدارة العيادة - تفعيل الترخيص"})]})})]})]})}Hr.displayName="AlertDescription";var Qr=e=>"checkbox"===e.type,Xr=e=>e instanceof Date,Jr=e=>null==e;const ei=e=>"object"==typeof e;var ti=e=>!Jr(e)&&!Array.isArray(e)&&ei(e)&&!Xr(e),ni=e=>ti(e)&&e.target?Qr(e.target)?e.target.checked:e.target.value:e,ai=(e,t)=>e.has((e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e)(t)),si="undefined"!=typeof window&&void 0!==window.HTMLElement&&"undefined"!=typeof document;function ri(e){let t;const n=Array.isArray(e),a="undefined"!=typeof FileList&&e instanceof FileList;if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else{if(si&&(e instanceof Blob||a)||!n&&!ti(e))return e;if(t=n?[]:{},n||(e=>{const t=e.constructor&&e.constructor.prototype;return ti(t)&&t.hasOwnProperty("isPrototypeOf")})(e))for(const n in e)e.hasOwnProperty(n)&&(t[n]=ri(e[n]));else t=e}return t}var ii=e=>/^\w*$/.test(e),li=e=>void 0===e,oi=e=>Array.isArray(e)?e.filter(Boolean):[],ci=e=>oi(e.replace(/["|']|\]/g,"").split(/\.|\[/)),di=(e,t,n)=>{if(!t||!ti(e))return n;const a=(ii(t)?[t]:ci(t)).reduce((e,t)=>Jr(e)?e:e[t],e);return li(a)||a===e?li(e[t])?n:e[t]:a},mi=e=>"boolean"==typeof e,ui=(e,t,n)=>{let a=-1;const s=ii(t)?[t]:ci(t),r=s.length,i=r-1;for(;++a<r;){const t=s[a];let r=n;if(a!==i){const n=e[t];r=ti(n)||Array.isArray(n)?n:isNaN(+s[a+1])?{}:[]}if("__proto__"===t||"constructor"===t||"prototype"===t)return;e[t]=r,e=e[t]}};const pi="blur",hi="focusout",xi="change",gi="onBlur",fi="onChange",vi="onSubmit",yi="onTouched",bi="all",ji="max",wi="min",Ni="maxLength",_i="minLength",ki="pattern",Si="required",Ci="validate",$i=ie.createContext(null);$i.displayName="HookFormContext";const Di=()=>ie.useContext($i);var Ei=(e,t,n,a=!0)=>{const s={defaultValues:t._defaultValues};for(const r in e)Object.defineProperty(s,r,{get:()=>{const s=r;return t._proxyFormState[s]!==bi&&(t._proxyFormState[s]=!a||bi),n&&(n[s]=!0),e[s]}});return s};const Ti="undefined"!=typeof window?re.useLayoutEffect:re.useEffect;var Ai=e=>"string"==typeof e,Fi=(e,t,n,a,s)=>Ai(e)?(a&&t.watch.add(e),di(n,e,s)):Array.isArray(e)?e.map(e=>(a&&t.watch.add(e),di(n,e))):(a&&(t.watchAll=!0),n);function Pi(e){const t=Di(),{name:n,disabled:a,control:s=t.control,shouldUnregister:r}=e,i=ai(s._names.array,n),l=function(e){const t=Di(),{control:n=t.control,name:a,defaultValue:s,disabled:r,exact:i}=e||{},l=ie.useRef(s),[o,c]=ie.useState(n._getWatch(a,l.current));return Ti(()=>n._subscribe({name:a,formState:{values:!0},exact:i,callback:e=>!r&&c(Fi(a,n._names,e.values||n._formValues,!1,l.current))}),[a,n,r,i]),ie.useEffect(()=>n._removeUnmounted()),o}({control:s,name:n,defaultValue:di(s._formValues,n,di(s._defaultValues,n,e.defaultValue)),exact:!0}),o=function(e){const t=Di(),{control:n=t.control,disabled:a,name:s,exact:r}=e||{},[i,l]=ie.useState(n._formState),o=ie.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return Ti(()=>n._subscribe({name:s,formState:o.current,exact:r,callback:e=>{!a&&l({...n._formState,...e})}}),[s,a,r]),ie.useEffect(()=>{o.current.isValid&&n._setValid(!0)},[n]),ie.useMemo(()=>Ei(i,n,o.current,!1),[i,n])}({control:s,name:n,exact:!0}),c=ie.useRef(e),d=ie.useRef(s.register(n,{...e.rules,value:l,...mi(e.disabled)?{disabled:e.disabled}:{}})),m=ie.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!di(o.errors,n)},isDirty:{enumerable:!0,get:()=>!!di(o.dirtyFields,n)},isTouched:{enumerable:!0,get:()=>!!di(o.touchedFields,n)},isValidating:{enumerable:!0,get:()=>!!di(o.validatingFields,n)},error:{enumerable:!0,get:()=>di(o.errors,n)}}),[o,n]),u=ie.useCallback(e=>d.current.onChange({target:{value:ni(e),name:n},type:xi}),[n]),p=ie.useCallback(()=>d.current.onBlur({target:{value:di(s._formValues,n),name:n},type:pi}),[n,s._formValues]),h=ie.useCallback(e=>{const t=di(s._fields,n);t&&e&&(t._f.ref={focus:()=>e.focus&&e.focus(),select:()=>e.select&&e.select(),setCustomValidity:t=>e.setCustomValidity(t),reportValidity:()=>e.reportValidity()})},[s._fields,n]),x=ie.useMemo(()=>({name:n,value:l,...mi(a)||o.disabled?{disabled:o.disabled||a}:{},onChange:u,onBlur:p,ref:h}),[n,a,o.disabled,u,p,h,l]);return ie.useEffect(()=>{const e=s._options.shouldUnregister||r;s.register(n,{...c.current.rules,...mi(c.current.disabled)?{disabled:c.current.disabled}:{}});const t=(e,t)=>{const n=di(s._fields,e);n&&n._f&&(n._f.mount=t)};if(t(n,!0),e){const e=ri(di(s._options.defaultValues,n));ui(s._defaultValues,n,e),li(di(s._formValues,n))&&ui(s._formValues,n,e)}return!i&&s.register(n),()=>{(i?e&&!s._state.action:e)?s.unregister(n):t(n,!1)}},[n,s,i,r]),ie.useEffect(()=>{s._setDisabledField({disabled:a,name:n})},[a,n,s]),ie.useMemo(()=>({field:x,formState:o,fieldState:m}),[x,o,m])}const Ri=e=>e.render(Pi(e));var Oi=(e,t,n,a,s)=>t?{...n[e],types:{...n[e]&&n[e].types?n[e].types:{},[a]:s||!0}}:{},Mi=e=>Array.isArray(e)?e:[e],Li=()=>{let e=[];return{get observers(){return e},next:t=>{for(const n of e)n.next&&n.next(t)},subscribe:t=>(e.push(t),{unsubscribe:()=>{e=e.filter(e=>e!==t)}}),unsubscribe:()=>{e=[]}}},Ii=e=>Jr(e)||!ei(e);function zi(e,t,n=new WeakSet){if(Ii(e)||Ii(t))return e===t;if(Xr(e)&&Xr(t))return e.getTime()===t.getTime();const a=Object.keys(e),s=Object.keys(t);if(a.length!==s.length)return!1;if(n.has(e)||n.has(t))return!0;n.add(e),n.add(t);for(const r of a){const a=e[r];if(!s.includes(r))return!1;if("ref"!==r){const e=t[r];if(Xr(a)&&Xr(e)||ti(a)&&ti(e)||Array.isArray(a)&&Array.isArray(e)?!zi(a,e,n):a!==e)return!1}}return!0}var Bi=e=>ti(e)&&!Object.keys(e).length,Vi=e=>"file"===e.type,Yi=e=>"function"==typeof e,qi=e=>{if(!si)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},Ui=e=>"select-multiple"===e.type,Hi=e=>"radio"===e.type,Gi=e=>qi(e)&&e.isConnected;function Wi(e,t){const n=Array.isArray(t)?t:ii(t)?[t]:ci(t),a=1===n.length?e:function(e,t){const n=t.slice(0,-1).length;let a=0;for(;a<n;)e=li(e)?a++:e[t[a++]];return e}(e,n),s=n.length-1,r=n[s];return a&&delete a[r],0!==s&&(ti(a)&&Bi(a)||Array.isArray(a)&&function(e){for(const t in e)if(e.hasOwnProperty(t)&&!li(e[t]))return!1;return!0}(a))&&Wi(e,n.slice(0,-1)),e}var Ki=e=>{for(const t in e)if(Yi(e[t]))return!0;return!1};function Zi(e,t={}){const n=Array.isArray(e);if(ti(e)||n)for(const a in e)Array.isArray(e[a])||ti(e[a])&&!Ki(e[a])?(t[a]=Array.isArray(e[a])?[]:{},Zi(e[a],t[a])):Jr(e[a])||(t[a]=!0);return t}function Qi(e,t,n){const a=Array.isArray(e);if(ti(e)||a)for(const s in e)Array.isArray(e[s])||ti(e[s])&&!Ki(e[s])?li(t)||Ii(n[s])?n[s]=Array.isArray(e[s])?Zi(e[s],[]):{...Zi(e[s])}:Qi(e[s],Jr(t)?{}:t[s],n[s]):n[s]=!zi(e[s],t[s]);return n}var Xi=(e,t)=>Qi(e,t,Zi(t));const Ji={value:!1,isValid:!1},el={value:!0,isValid:!0};var tl=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(e=>e&&e.checked&&!e.disabled).map(e=>e.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!li(e[0].attributes.value)?li(e[0].value)||""===e[0].value?el:{value:e[0].value,isValid:!0}:el:Ji}return Ji},nl=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:a})=>li(e)?e:t?""===e?NaN:e?+e:e:n&&Ai(e)?new Date(e):a?a(e):e;const al={isValid:!1,value:null};var sl=e=>Array.isArray(e)?e.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,al):al;function rl(e){const t=e.ref;return Vi(t)?t.files:Hi(t)?sl(e.refs).value:Ui(t)?[...t.selectedOptions].map(({value:e})=>e):Qr(t)?tl(e.refs).value:nl(li(t.value)?e.ref.value:t.value,e)}var il=e=>e instanceof RegExp,ll=e=>li(e)?e:il(e)?e.source:ti(e)?il(e.value)?e.value.source:e.value:e,ol=e=>({isOnSubmit:!e||e===vi,isOnBlur:e===gi,isOnChange:e===fi,isOnAll:e===bi,isOnTouch:e===yi});const cl="AsyncFunction";var dl=e=>!!e&&!!e.validate&&!!(Yi(e.validate)&&e.validate.constructor.name===cl||ti(e.validate)&&Object.values(e.validate).find(e=>e.constructor.name===cl)),ml=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some(t=>e.startsWith(t)&&/^\.\w+/.test(e.slice(t.length))));const ul=(e,t,n,a)=>{for(const s of n||Object.keys(e)){const n=di(e,s);if(n){const{_f:e,...r}=n;if(e){if(e.refs&&e.refs[0]&&t(e.refs[0],s)&&!a)return!0;if(e.ref&&t(e.ref,e.name)&&!a)return!0;if(ul(r,t))break}else if(ti(r)&&ul(r,t))break}}};function pl(e,t,n){const a=di(e,n);if(a||ii(n))return{error:a,name:n};const s=n.split(".");for(;s.length;){const a=s.join("."),r=di(t,a),i=di(e,a);if(r&&!Array.isArray(r)&&n!==a)return{name:n};if(i&&i.type)return{name:a,error:i};if(i&&i.root&&i.root.type)return{name:`${a}.root`,error:i.root};s.pop()}return{name:n}}var hl=(e,t,n)=>{const a=Mi(di(e,n));return ui(a,"root",t[n]),ui(e,n,a),e},xl=e=>Ai(e);function gl(e,t,n="validate"){if(xl(e)||Array.isArray(e)&&e.every(xl)||mi(e)&&!e)return{type:n,message:xl(e)?e:"",ref:t}}var fl=e=>ti(e)&&!il(e)?e:{value:e,message:""},vl=async(e,t,n,a,s,r)=>{const{ref:i,refs:l,required:o,maxLength:c,minLength:d,min:m,max:u,pattern:p,validate:h,name:x,valueAsNumber:g,mount:f}=e._f,v=di(n,x);if(!f||t.has(x))return{};const y=l?l[0]:i,b=e=>{s&&y.reportValidity&&(y.setCustomValidity(mi(e)?"":e||""),y.reportValidity())},j={},w=Hi(i),N=Qr(i),_=w||N,k=(g||Vi(i))&&li(i.value)&&li(v)||qi(i)&&""===i.value||""===v||Array.isArray(v)&&!v.length,S=Oi.bind(null,x,a,j),C=(e,t,n,a=Ni,s=_i)=>{const r=e?t:n;j[x]={type:e?a:s,message:r,ref:i,...S(e?a:s,r)}};if(r?!Array.isArray(v)||!v.length:o&&(!_&&(k||Jr(v))||mi(v)&&!v||N&&!tl(l).isValid||w&&!sl(l).isValid)){const{value:e,message:t}=xl(o)?{value:!!o,message:o}:fl(o);if(e&&(j[x]={type:Si,message:t,ref:y,...S(Si,t)},!a))return b(t),j}if(!(k||Jr(m)&&Jr(u))){let e,t;const n=fl(u),s=fl(m);if(Jr(v)||isNaN(v)){const a=i.valueAsDate||new Date(v),r=e=>new Date((new Date).toDateString()+" "+e),l="time"==i.type,o="week"==i.type;Ai(n.value)&&v&&(e=l?r(v)>r(n.value):o?v>n.value:a>new Date(n.value)),Ai(s.value)&&v&&(t=l?r(v)<r(s.value):o?v<s.value:a<new Date(s.value))}else{const a=i.valueAsNumber||(v?+v:v);Jr(n.value)||(e=a>n.value),Jr(s.value)||(t=a<s.value)}if((e||t)&&(C(!!e,n.message,s.message,ji,wi),!a))return b(j[x].message),j}if((c||d)&&!k&&(Ai(v)||r&&Array.isArray(v))){const e=fl(c),t=fl(d),n=!Jr(e.value)&&v.length>+e.value,s=!Jr(t.value)&&v.length<+t.value;if((n||s)&&(C(n,e.message,t.message),!a))return b(j[x].message),j}if(p&&!k&&Ai(v)){const{value:e,message:t}=fl(p);if(il(e)&&!v.match(e)&&(j[x]={type:ki,message:t,ref:i,...S(ki,t)},!a))return b(t),j}if(h)if(Yi(h)){const e=gl(await h(v,n),y);if(e&&(j[x]={...e,...S(Ci,e.message)},!a))return b(e.message),j}else if(ti(h)){let e={};for(const t in h){if(!Bi(e)&&!a)break;const s=gl(await h[t](v,n),y,t);s&&(e={...s,...S(t,s.message)},b(s.message),a&&(j[x]=e))}if(!Bi(e)&&(j[x]={ref:y,...e},!a))return j}return b(!0),j};const yl={mode:vi,reValidateMode:fi,shouldFocusError:!0};function bl(e={}){let t={...yl,...e},n={submitCount:0,isDirty:!1,isReady:!1,isLoading:Yi(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1};const a={};let s,r=(ti(t.defaultValues)||ti(t.values))&&ri(t.defaultValues||t.values)||{},i=t.shouldUnregister?{}:ri(r),l={action:!1,mount:!1,watch:!1},o={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},c=0;const d={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let m={...d};const u={array:Li(),state:Li()},p=t.criteriaMode===bi,h=async e=>{if(!t.disabled&&(d.isValid||m.isValid||e)){const e=t.resolver?Bi((await y()).errors):await b(a,!0);e!==n.isValid&&u.state.next({isValid:e})}},x=(e,a)=>{!t.disabled&&(d.isValidating||d.validatingFields||m.isValidating||m.validatingFields)&&((e||Array.from(o.mount)).forEach(e=>{e&&(a?ui(n.validatingFields,e,a):Wi(n.validatingFields,e))}),u.state.next({validatingFields:n.validatingFields,isValidating:!Bi(n.validatingFields)}))},g=(e,t,n,s)=>{const o=di(a,e);if(o){const a=di(i,e,li(n)?di(r,e):n);li(a)||s&&s.defaultChecked||t?ui(i,e,t?a:rl(o._f)):N(e,a),l.mount&&h()}},f=(e,a,s,i,l)=>{let o=!1,c=!1;const p={name:e};if(!t.disabled){if(!s||i){(d.isDirty||m.isDirty)&&(c=n.isDirty,n.isDirty=p.isDirty=j(),o=c!==p.isDirty);const t=zi(di(r,e),a);c=!!di(n.dirtyFields,e),t?Wi(n.dirtyFields,e):ui(n.dirtyFields,e,!0),p.dirtyFields=n.dirtyFields,o=o||(d.dirtyFields||m.dirtyFields)&&c!==!t}if(s){const t=di(n.touchedFields,e);t||(ui(n.touchedFields,e,s),p.touchedFields=n.touchedFields,o=o||(d.touchedFields||m.touchedFields)&&t!==s)}o&&l&&u.state.next(p)}return o?p:{}},v=(e,a,r,i)=>{const l=di(n.errors,e),o=(d.isValid||m.isValid)&&mi(a)&&n.isValid!==a;var p;if(t.delayError&&r?(p=()=>((e,t)=>{ui(n.errors,e,t),u.state.next({errors:n.errors})})(e,r),s=e=>{clearTimeout(c),c=setTimeout(p,e)},s(t.delayError)):(clearTimeout(c),s=null,r?ui(n.errors,e,r):Wi(n.errors,e)),(r?!zi(l,r):l)||!Bi(i)||o){const t={...i,...o&&mi(a)?{isValid:a}:{},errors:n.errors,name:e};n={...n,...t},u.state.next(t)}},y=async e=>{x(e,!0);const n=await t.resolver(i,t.context,((e,t,n,a)=>{const s={};for(const r of e){const e=di(t,r);e&&ui(s,r,e._f)}return{criteriaMode:n,names:[...e],fields:s,shouldUseNativeValidation:a}})(e||o.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return x(e),n},b=async(e,a,s={valid:!0})=>{for(const r in e){const l=e[r];if(l){const{_f:e,...c}=l;if(e){const c=o.array.has(e.name),m=l._f&&dl(l._f);m&&d.validatingFields&&x([r],!0);const u=await vl(l,o.disabled,i,p,t.shouldUseNativeValidation&&!a,c);if(m&&d.validatingFields&&x([r]),u[e.name]&&(s.valid=!1,a))break;!a&&(di(u,e.name)?c?hl(n.errors,u,e.name):ui(n.errors,e.name,u[e.name]):Wi(n.errors,e.name))}!Bi(c)&&await b(c,a,s)}}return s.valid},j=(e,n)=>!t.disabled&&(e&&n&&ui(i,e,n),!zi(D(),r)),w=(e,t,n)=>Fi(e,o,{...l.mount?i:li(t)?r:Ai(e)?{[e]:t}:t},n,t),N=(e,t,n={})=>{const s=di(a,e);let r=t;if(s){const n=s._f;n&&(!n.disabled&&ui(i,e,nl(t,n)),r=qi(n.ref)&&Jr(t)?"":t,Ui(n.ref)?[...n.ref.options].forEach(e=>e.selected=r.includes(e.value)):n.refs?Qr(n.ref)?n.refs.forEach(e=>{e.defaultChecked&&e.disabled||(Array.isArray(r)?e.checked=!!r.find(t=>t===e.value):e.checked=r===e.value||!!r)}):n.refs.forEach(e=>e.checked=e.value===r):Vi(n.ref)?n.ref.value="":(n.ref.value=r,n.ref.type||u.state.next({name:e,values:ri(i)})))}(n.shouldDirty||n.shouldTouch)&&f(e,r,n.shouldTouch,n.shouldDirty,!0),n.shouldValidate&&$(e)},_=(e,t,n)=>{for(const s in t){if(!t.hasOwnProperty(s))return;const r=t[s],i=e+"."+s,l=di(a,i);(o.array.has(e)||ti(r)||l&&!l._f)&&!Xr(r)?_(i,r,n):N(i,r,n)}},k=(e,t,s={})=>{const c=di(a,e),p=o.array.has(e),h=ri(t);ui(i,e,h),p?(u.array.next({name:e,values:ri(i)}),(d.isDirty||d.dirtyFields||m.isDirty||m.dirtyFields)&&s.shouldDirty&&u.state.next({name:e,dirtyFields:Xi(r,i),isDirty:j(e,h)})):!c||c._f||Jr(h)?N(e,h,s):_(e,h,s),ml(e,o)&&u.state.next({...n}),u.state.next({name:l.mount?e:void 0,values:ri(i)})},S=async e=>{l.mount=!0;const r=e.target;let c=r.name,g=!0;const j=di(a,c),w=e=>{g=Number.isNaN(e)||Xr(e)&&isNaN(e.getTime())||zi(e,di(i,c,e))},N=ol(t.mode),_=ol(t.reValidateMode);if(j){let l,k;const S=r.type?rl(j._f):ni(e),C=e.type===pi||e.type===hi,D=!(e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate))(j._f)&&!t.resolver&&!di(n.errors,c)&&!j._f.deps||((e,t,n,a,s)=>!s.isOnAll&&(!n&&s.isOnTouch?!(t||e):(n?a.isOnBlur:s.isOnBlur)?!e:!(n?a.isOnChange:s.isOnChange)||e))(C,di(n.touchedFields,c),n.isSubmitted,_,N),E=ml(c,o,C);ui(i,c,S),C?(j._f.onBlur&&j._f.onBlur(e),s&&s(0)):j._f.onChange&&j._f.onChange(e);const T=f(c,S,C),A=!Bi(T)||E;if(!C&&u.state.next({name:c,type:e.type,values:ri(i)}),D)return(d.isValid||m.isValid)&&("onBlur"===t.mode?C&&h():C||h()),A&&u.state.next({name:c,...E?{}:T});if(!C&&E&&u.state.next({...n}),t.resolver){const{errors:e}=await y([c]);if(w(S),g){const t=pl(n.errors,a,c),s=pl(e,a,t.name||c);l=s.error,c=s.name,k=Bi(e)}}else x([c],!0),l=(await vl(j,o.disabled,i,p,t.shouldUseNativeValidation))[c],x([c]),w(S),g&&(l?k=!1:(d.isValid||m.isValid)&&(k=await b(a,!0)));g&&(j._f.deps&&$(j._f.deps),v(c,k,l,T))}},C=(e,t)=>{if(di(n.errors,t)&&e.focus)return e.focus(),1},$=async(e,s={})=>{let r,i;const l=Mi(e);if(t.resolver){const t=await(async e=>{const{errors:t}=await y(e);if(e)for(const a of e){const e=di(t,a);e?ui(n.errors,a,e):Wi(n.errors,a)}else n.errors=t;return t})(li(e)?e:l);r=Bi(t),i=e?!l.some(e=>di(t,e)):r}else e?(i=(await Promise.all(l.map(async e=>{const t=di(a,e);return await b(t&&t._f?{[e]:t}:t)}))).every(Boolean),(i||n.isValid)&&h()):i=r=await b(a);return u.state.next({...!Ai(e)||(d.isValid||m.isValid)&&r!==n.isValid?{}:{name:e},...t.resolver||!e?{isValid:r}:{},errors:n.errors}),s.shouldFocus&&!i&&ul(a,C,e?l:o.mount),i},D=e=>{const t={...l.mount?i:r};return li(e)?t:Ai(e)?di(t,e):e.map(e=>di(t,e))},E=(e,t)=>({invalid:!!di((t||n).errors,e),isDirty:!!di((t||n).dirtyFields,e),error:di((t||n).errors,e),isValidating:!!di(n.validatingFields,e),isTouched:!!di((t||n).touchedFields,e)}),T=(e,t,s)=>{const r=(di(a,e,{_f:{}})._f||{}).ref,i=di(n.errors,e)||{},{ref:l,message:o,type:c,...d}=i;ui(n.errors,e,{...d,...t,ref:r}),u.state.next({name:e,errors:n.errors,isValid:!1}),s&&s.shouldFocus&&r&&r.focus&&r.focus()},A=e=>u.state.subscribe({next:t=>{var a,s,r;a=e.name,s=t.name,r=e.exact,a&&s&&a!==s&&!Mi(a).some(e=>e&&(r?e===s:e.startsWith(s)||s.startsWith(e)))||!((e,t,n,a)=>{n(e);const{name:s,...r}=e;return Bi(r)||Object.keys(r).length>=Object.keys(t).length||Object.keys(r).find(e=>t[e]===(!a||bi))})(t,e.formState||d,z,e.reRenderRoot)||e.callback({values:{...i},...n,...t})}}).unsubscribe,F=(e,s={})=>{for(const l of e?Mi(e):o.mount)o.mount.delete(l),o.array.delete(l),s.keepValue||(Wi(a,l),Wi(i,l)),!s.keepError&&Wi(n.errors,l),!s.keepDirty&&Wi(n.dirtyFields,l),!s.keepTouched&&Wi(n.touchedFields,l),!s.keepIsValidating&&Wi(n.validatingFields,l),!t.shouldUnregister&&!s.keepDefaultValue&&Wi(r,l);u.state.next({values:ri(i)}),u.state.next({...n,...s.keepDirty?{isDirty:j()}:{}}),!s.keepIsValid&&h()},P=({disabled:e,name:t})=>{(mi(e)&&l.mount||e||o.disabled.has(t))&&(e?o.disabled.add(t):o.disabled.delete(t))},R=(e,n={})=>{let s=di(a,e);const i=mi(n.disabled)||mi(t.disabled);return ui(a,e,{...s||{},_f:{...s&&s._f?s._f:{ref:{name:e}},name:e,mount:!0,...n}}),o.mount.add(e),s?P({disabled:mi(n.disabled)?n.disabled:t.disabled,name:e}):g(e,!0,n.value),{...i?{disabled:n.disabled||t.disabled}:{},...t.progressive?{required:!!n.required,min:ll(n.min),max:ll(n.max),minLength:ll(n.minLength),maxLength:ll(n.maxLength),pattern:ll(n.pattern)}:{},name:e,onChange:S,onBlur:S,ref:i=>{if(i){R(e,n),s=di(a,e);const t=li(i.value)&&i.querySelectorAll&&i.querySelectorAll("input,select,textarea")[0]||i,l=(e=>Hi(e)||Qr(e))(t),o=s._f.refs||[];if(l?o.find(e=>e===t):t===s._f.ref)return;ui(a,e,{_f:{...s._f,...l?{refs:[...o.filter(Gi),t,...Array.isArray(di(r,e))?[{}]:[]],ref:{type:t.type,name:e}}:{ref:t}}}),g(e,!1,void 0,t)}else s=di(a,e,{}),s._f&&(s._f.mount=!1),(t.shouldUnregister||n.shouldUnregister)&&(!ai(o.array,e)||!l.action)&&o.unMount.add(e)}}},O=()=>t.shouldFocusError&&ul(a,C,o.mount),M=(e,s)=>async r=>{let l;r&&(r.preventDefault&&r.preventDefault(),r.persist&&r.persist());let c=ri(i);if(u.state.next({isSubmitting:!0}),t.resolver){const{errors:e,values:t}=await y();n.errors=e,c=ri(t)}else await b(a);if(o.disabled.size)for(const e of o.disabled)Wi(c,e);if(Wi(n.errors,"root"),Bi(n.errors)){u.state.next({errors:{}});try{await e(c,r)}catch(d){l=d}}else s&&await s({...n.errors},r),O(),setTimeout(O);if(u.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Bi(n.errors)&&!l,submitCount:n.submitCount+1,errors:n.errors}),l)throw l},L=(e,s={})=>{const c=e?ri(e):r,m=ri(c),p=Bi(e),h=p?r:m;if(s.keepDefaultValues||(r=c),!s.keepValues){if(s.keepDirtyValues){const e=new Set([...o.mount,...Object.keys(Xi(r,i))]);for(const t of Array.from(e))di(n.dirtyFields,t)?ui(h,t,di(i,t)):k(t,di(h,t))}else{if(si&&li(e))for(const e of o.mount){const t=di(a,e);if(t&&t._f){const e=Array.isArray(t._f.refs)?t._f.refs[0]:t._f.ref;if(qi(e)){const t=e.closest("form");if(t){t.reset();break}}}}for(const e of o.mount){const t=di(h,e,di(r,e));li(t)||(ui(h,e,t),k(e,di(h,e)))}}i=ri(h),u.array.next({values:{...h}}),u.state.next({values:{...h}})}o={mount:s.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},l.mount=!d.isValid||!!s.keepIsValid||!!s.keepDirtyValues,l.watch=!!t.shouldUnregister,u.state.next({submitCount:s.keepSubmitCount?n.submitCount:0,isDirty:!p&&(s.keepDirty?n.isDirty:!(!s.keepDefaultValues||zi(e,r))),isSubmitted:!!s.keepIsSubmitted&&n.isSubmitted,dirtyFields:p?{}:s.keepDirtyValues?s.keepDefaultValues&&i?Xi(r,i):n.dirtyFields:s.keepDefaultValues&&e?Xi(r,e):s.keepDirty?n.dirtyFields:{},touchedFields:s.keepTouched?n.touchedFields:{},errors:s.keepErrors?n.errors:{},isSubmitSuccessful:!!s.keepIsSubmitSuccessful&&n.isSubmitSuccessful,isSubmitting:!1})},I=(e,t)=>L(Yi(e)?e(i):e,t),z=e=>{n={...n,...e}},B={control:{register:R,unregister:F,getFieldState:E,handleSubmit:M,setError:T,_subscribe:A,_runSchema:y,_focusError:O,_getWatch:w,_getDirty:j,_setValid:h,_setFieldArray:(e,s=[],o,c,p=!0,h=!0)=>{if(c&&o&&!t.disabled){if(l.action=!0,h&&Array.isArray(di(a,e))){const t=o(di(a,e),c.argA,c.argB);p&&ui(a,e,t)}if(h&&Array.isArray(di(n.errors,e))){const t=o(di(n.errors,e),c.argA,c.argB);p&&ui(n.errors,e,t),((e,t)=>{!oi(di(e,t)).length&&Wi(e,t)})(n.errors,e)}if((d.touchedFields||m.touchedFields)&&h&&Array.isArray(di(n.touchedFields,e))){const t=o(di(n.touchedFields,e),c.argA,c.argB);p&&ui(n.touchedFields,e,t)}(d.dirtyFields||m.dirtyFields)&&(n.dirtyFields=Xi(r,i)),u.state.next({name:e,isDirty:j(e,s),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else ui(i,e,s)},_setDisabledField:P,_setErrors:e=>{n.errors=e,u.state.next({errors:n.errors,isValid:!1})},_getFieldArray:e=>oi(di(l.mount?i:r,e,t.shouldUnregister?di(r,e,[]):[])),_reset:L,_resetDefaultValues:()=>Yi(t.defaultValues)&&t.defaultValues().then(e=>{I(e,t.resetOptions),u.state.next({isLoading:!1})}),_removeUnmounted:()=>{for(const e of o.unMount){const t=di(a,e);t&&(t._f.refs?t._f.refs.every(e=>!Gi(e)):!Gi(t._f.ref))&&F(e)}o.unMount=new Set},_disableForm:e=>{mi(e)&&(u.state.next({disabled:e}),ul(a,(t,n)=>{const s=di(a,n);s&&(t.disabled=s._f.disabled||e,Array.isArray(s._f.refs)&&s._f.refs.forEach(t=>{t.disabled=s._f.disabled||e}))},0,!1))},_subjects:u,_proxyFormState:d,get _fields(){return a},get _formValues(){return i},get _state(){return l},set _state(e){l=e},get _defaultValues(){return r},get _names(){return o},set _names(e){o=e},get _formState(){return n},get _options(){return t},set _options(e){t={...t,...e}}},subscribe:e=>(l.mount=!0,m={...m,...e.formState},A({...e,formState:m})),trigger:$,register:R,handleSubmit:M,watch:(e,t)=>Yi(e)?u.state.subscribe({next:n=>e(w(void 0,t),n)}):w(e,t,!0),setValue:k,getValues:D,reset:I,resetField:(e,t={})=>{di(a,e)&&(li(t.defaultValue)?k(e,ri(di(r,e))):(k(e,t.defaultValue),ui(r,e,ri(t.defaultValue))),t.keepTouched||Wi(n.touchedFields,e),t.keepDirty||(Wi(n.dirtyFields,e),n.isDirty=t.defaultValue?j(e,ri(di(r,e))):j()),t.keepError||(Wi(n.errors,e),d.isValid&&h()),u.state.next({...n}))},clearErrors:e=>{e&&Mi(e).forEach(e=>Wi(n.errors,e)),u.state.next({errors:e?n.errors:{}})},unregister:F,setError:T,setFocus:(e,t={})=>{const n=di(a,e),s=n&&n._f;if(s){const e=s.refs?s.refs[0]:s.ref;e.focus&&(e.focus(),t.shouldSelect&&Yi(e.select)&&e.select())}},getFieldState:E};return{...B,formControl:B}}function jl(e={}){const t=ie.useRef(void 0),n=ie.useRef(void 0),[a,s]=ie.useState({isDirty:!1,isValidating:!1,isLoading:Yi(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:Yi(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:a},e.defaultValues&&!Yi(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:n,...s}=bl(e);t.current={...s,formState:a}}const r=t.current.control;return r._options=e,Ti(()=>{const e=r._subscribe({formState:r._proxyFormState,callback:()=>s({...r._formState}),reRenderRoot:!0});return s(e=>({...e,isReady:!0})),r._formState.isReady=!0,e},[r]),ie.useEffect(()=>r._disableForm(e.disabled),[r,e.disabled]),ie.useEffect(()=>{e.mode&&(r._options.mode=e.mode),e.reValidateMode&&(r._options.reValidateMode=e.reValidateMode)},[r,e.mode,e.reValidateMode]),ie.useEffect(()=>{e.errors&&(r._setErrors(e.errors),r._focusError())},[r,e.errors]),ie.useEffect(()=>{e.shouldUnregister&&r._subjects.state.next({values:r._getWatch()})},[r,e.shouldUnregister]),ie.useEffect(()=>{if(r._proxyFormState.isDirty){const e=r._getDirty();e!==a.isDirty&&r._subjects.state.next({isDirty:e})}},[r,a.isDirty]),ie.useEffect(()=>{e.values&&!zi(e.values,n.current)?(r._reset(e.values,r._options.resetOptions),n.current=e.values,s(e=>({...e}))):r._resetDefaultValues()},[r,e.values]),ie.useEffect(()=>{r._state.mount||(r._setValid(),r._state.mount=!0),r._state.watch&&(r._state.watch=!1,r._subjects.state.next({...r._formState})),r._removeUnmounted()}),t.current.formState=Ei(a,r),t.current}const wl=re.forwardRef(({className:t,...n},a)=>e.jsx("textarea",{className:En("flex min-h-[80px] w-full rounded-md border-2 border-input bg-background px-3 py-2 text-sm shadow-sm transition-all duration-200 placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-ring hover:border-ring/50 disabled:cursor-not-allowed disabled:opacity-50 resize-vertical",t),ref:a,...n}));wl.displayName="Textarea";const Nl=w,_l=_,kl=N,Sl=re.forwardRef(({className:t,children:n,...a},s)=>e.jsxs(d,{ref:s,className:En("flex h-10 w-full items-center justify-between whitespace-nowrap rounded-md border-2 border-input bg-background px-3 py-2 text-sm shadow-sm ring-offset-background transition-all duration-200 data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-ring hover:border-ring/50 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...a,children:[n,e.jsx(m,{asChild:!0,children:e.jsx(ss,{className:"h-4 w-4 opacity-50"})})]}));Sl.displayName=d.displayName;const Cl=re.forwardRef(({className:t,...n},a)=>e.jsx(u,{ref:a,className:En("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(ls,{className:"h-4 w-4"})}));Cl.displayName=u.displayName;const $l=re.forwardRef(({className:t,...n},a)=>e.jsx(p,{ref:a,className:En("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(ss,{className:"h-4 w-4"})}));$l.displayName=p.displayName;const Dl=re.forwardRef(({className:t,children:n,position:a="popper",...s},r)=>e.jsx(h,{children:e.jsxs(x,{ref:r,className:En("relative z-50 max-h-[min(var(--radix-select-content-available-height),20rem)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...s,children:[e.jsx(Cl,{}),e.jsx(g,{className:En("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),e.jsx($l,{})]})}));Dl.displayName=x.displayName;const El=re.forwardRef(({className:t,...n},a)=>e.jsx(f,{ref:a,className:En("px-2 py-1.5 text-sm font-semibold text-muted-foreground",t),...n}));El.displayName=f.displayName;const Tl=re.forwardRef(({className:t,...n},a)=>e.jsx(v,{ref:a,className:En("-mx-1 my-1 h-px bg-muted",t),...n}));Tl.displayName=v.displayName;const Al=re.forwardRef(({className:t,children:n,...a},s)=>e.jsxs(y,{ref:s,className:En("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(b,{children:e.jsx(as,{className:"h-4 w-4"})})}),e.jsx(j,{children:n})]}));Al.displayName=y.displayName;let Fl=0;const Pl=new Map,Rl=e=>{if(Pl.has(e))return;const t=setTimeout(()=>{Pl.delete(e),Il({type:"REMOVE_TOAST",toastId:e})},3e3);Pl.set(e,t)},Ol=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,3)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{const{toastId:n}=t;return n?Rl(n):e.toasts.forEach(e=>{Rl(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},Ml=[];let Ll={toasts:[]};function Il(e){Ll=Ol(Ll,e),Ml.forEach(e=>{e(Ll)})}function zl({...e}){const t=(Fl=(Fl+1)%Number.MAX_SAFE_INTEGER,Fl.toString()),n=()=>Il({type:"DISMISS_TOAST",toastId:t});return Il({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||n()}}}),{id:t,dismiss:n,update:e=>Il({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function Bl(){const[e,t]=re.useState(Ll);return re.useEffect(()=>(Ml.push(t),()=>{const e=Ml.indexOf(t);e>-1&&Ml.splice(e,1)}),[e]),{...e,toast:zl,dismiss:e=>Il({type:"DISMISS_TOAST",toastId:e})}}function Vl({open:t,onOpenChange:n}){const{createPatient:a,isLoading:s,patients:r}=bt(),{toast:i}=Bl(),[l,o]=re.useState(!1),{register:c,handleSubmit:d,reset:m,setValue:u,watch:p,formState:{errors:h}}=jl({defaultValues:{full_name:"",gender:void 0,age:void 0,patient_number:void 0,patient_condition:"",allergies:"",medical_conditions:"",email:"",address:"",notes:"",phone:"",date_added:(new Date).toISOString().slice(0,16)}}),x=()=>{m(),n(!1)};return e.jsx(Sr,{open:t,onOpenChange:x,children:e.jsxs(Dr,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsx(Ar,{children:"إضافة مريض جديد"}),e.jsx(Fr,{children:"أدخل معلومات المريض أدناه. الحقول المميزة بـ * مطلوبة."})]}),e.jsxs("form",{onSubmit:d(async e=>{if(e.gender){if(e.patient_number){const t=r.find(t=>t.patient_number===e.patient_number);if(t)return void i({title:"خطأ في رقم المريض",description:`يوجد مريض آخر برقم ${e.patient_number} (${t.full_name}). يرجى اختيار رقم مختلف.`,variant:"destructive"})}o(!0);try{const t=Date.now().toString().slice(-8)+Math.floor(100*Math.random()).toString().padStart(2,"0"),s={...e,serial_number:t,age:Number(e.age),date_added:e.date_added||(new Date).toISOString()};await a(s),i({title:"تم بنجاح",description:"تم إضافة المريض بنجاح"}),m(),n(!1)}catch(t){i({title:"خطأ",description:"فشل في إضافة المريض",variant:"destructive"})}finally{o(!1)}}else i({title:"خطأ",description:"يرجى اختيار الجنس",variant:"destructive"})}),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"الحقول المطلوبة"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الاسم الكامل *"}),e.jsx(Ir,{...c("full_name",{required:"الاسم الكامل مطلوب"}),placeholder:"أدخل الاسم الكامل"}),h.full_name&&e.jsx("p",{className:"text-sm text-destructive",children:h.full_name.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الجنس *"}),e.jsxs(Nl,{onValueChange:e=>u("gender",e),children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر الجنس",className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"male",children:"ذكر"}),e.jsx(Al,{value:"female",children:"أنثى"})]})]}),h.gender&&e.jsx("p",{className:"text-sm text-destructive",children:"الجنس مطلوب"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"العمر *"}),e.jsx(Ir,{type:"number",min:"1",max:"120",...c("age",{required:"العمر مطلوب",min:{value:1,message:"العمر يجب أن يكون أكبر من 0"},max:{value:120,message:"العمر يجب أن يكون أقل من 120"}}),placeholder:"أدخل العمر"}),h.age&&e.jsx("p",{className:"text-sm text-destructive",children:h.age.message})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"تاريخ الإضافة *"}),e.jsx(Ir,{type:"datetime-local",...c("date_added",{required:"تاريخ الإضافة مطلوب"})}),h.date_added&&e.jsx("p",{className:"text-sm text-destructive",children:h.date_added.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"رقم المريض"}),e.jsx(Ir,{type:"number",min:"1",...c("patient_number",{min:{value:1,message:"رقم المريض يجب أن يكون أكبر من 0"},valueAsNumber:!0}),placeholder:"أدخل رقم المريض"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"رقم تعريفي للمريض (اختياري، يقبل الأعداد الصحيحة الموجبة فقط)"}),h.patient_number&&e.jsx("p",{className:"text-sm text-destructive",children:h.patient_number.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"رقم الهاتف"}),e.jsx(Ir,{type:"tel",...c("phone",{pattern:{value:/^[0-9]{12}$/,message:"رقم الهاتف يجب أن يكون 12 رقم (مثل: 963987654321)"}}),placeholder:"963987654321"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"يرجى إدخال رقم الهاتف مع رمز الدولة بدون + أو 00 (مثل: 963987654321)"}),h.phone&&e.jsx("p",{className:"text-sm text-destructive",children:h.phone.message})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"الحقول الاختيارية"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"حالة المريض / التشخيص"}),e.jsx(wl,{...c("patient_condition"),placeholder:"أدخل وصف الحالة الطبية أو التشخيص",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الحساسية"}),e.jsx(Ir,{...c("allergies"),placeholder:"أدخل معلومات الحساسية المعروفة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الحالات الطبية / الأمراض"}),e.jsx(wl,{...c("medical_conditions"),placeholder:"أدخل الحالات الطبية أو الأمراض المزمنة",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"البريد الإلكتروني"}),e.jsx(Ir,{type:"email",...c("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"البريد الإلكتروني غير صحيح"}}),placeholder:"أدخل البريد الإلكتروني"}),h.email&&e.jsx("p",{className:"text-sm text-destructive",children:h.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"العنوان"}),e.jsx(Ir,{...c("address"),placeholder:"أدخل العنوان الكامل"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"ملاحظات / تعليقات"}),e.jsx(wl,{...c("notes"),placeholder:"أدخل أي ملاحظات أو تعليقات إضافية",rows:3})]})]}),e.jsxs(Tr,{className:"flex justify-end space-x-4 space-x-reverse",children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:x,disabled:l,children:"إلغاء"}),e.jsx(Lr,{type:"submit",disabled:l||s,children:l?"جاري الإضافة...":"حفظ المريض"})]})]})]})})}var Yl="AlertDialog",[ql,Ul]=k(Yl,[S]),Hl=S(),Gl=t=>{const{__scopeAlertDialog:n,...a}=t,s=Hl(n);return e.jsx(l,{...s,...a,modal:!0})};Gl.displayName=Yl;re.forwardRef((t,n)=>{const{__scopeAlertDialog:a,...s}=t,r=Hl(a);return e.jsx(C,{...r,...s,ref:n})}).displayName="AlertDialogTrigger";var Wl=t=>{const{__scopeAlertDialog:n,...a}=t,s=Hl(n);return e.jsx(i,{...s,...a})};Wl.displayName="AlertDialogPortal";var Kl=re.forwardRef((n,a)=>{const{__scopeAlertDialog:s,...r}=n,i=Hl(s);return e.jsx(t,{...i,...r,ref:a})});Kl.displayName="AlertDialogOverlay";var Zl="AlertDialogContent",[Ql,Xl]=ql(Zl),Jl=T("AlertDialogContent"),eo=re.forwardRef((t,a)=>{const{__scopeAlertDialog:s,children:r,...i}=t,l=Hl(s),o=re.useRef(null),c=$(a,o),d=re.useRef(null);return e.jsx(D,{contentName:Zl,titleName:to,docsSlug:"alert-dialog",children:e.jsx(Ql,{scope:s,cancelRef:d,children:e.jsxs(n,{role:"alertdialog",...l,...i,ref:c,onOpenAutoFocus:E(i.onOpenAutoFocus,e=>{e.preventDefault(),d.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[e.jsx(Jl,{children:r}),e.jsx(oo,{contentRef:o})]})})})});eo.displayName=Zl;var to="AlertDialogTitle",no=re.forwardRef((t,n)=>{const{__scopeAlertDialog:a,...r}=t,i=Hl(a);return e.jsx(s,{...i,...r,ref:n})});no.displayName=to;var ao="AlertDialogDescription",so=re.forwardRef((t,n)=>{const{__scopeAlertDialog:a,...s}=t,i=Hl(a);return e.jsx(r,{...i,...s,ref:n})});so.displayName=ao;var ro=re.forwardRef((t,n)=>{const{__scopeAlertDialog:s,...r}=t,i=Hl(s);return e.jsx(a,{...i,...r,ref:n})});ro.displayName="AlertDialogAction";var io="AlertDialogCancel",lo=re.forwardRef((t,n)=>{const{__scopeAlertDialog:s,...r}=t,{cancelRef:i}=Xl(io,s),l=Hl(s),o=$(n,i);return e.jsx(a,{...l,...r,ref:o})});lo.displayName=io;var oo=({contentRef:e})=>{const t=`\`${Zl}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${Zl}\` by passing a \`${ao}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Zl}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return re.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},co=Kl,mo=eo,uo=ro,po=lo,ho=no,xo=so;const go=Gl,fo=Wl,vo=re.forwardRef(({className:t,...n},a)=>e.jsx(co,{className:En("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n,ref:a}));vo.displayName=co.displayName;const yo=re.forwardRef(({className:t,...n},a)=>e.jsxs(fo,{children:[e.jsx(vo,{}),e.jsx(mo,{ref:a,dir:"rtl",className:En("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border-2 border-border bg-background p-6 shadow-2xl duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n})]}));yo.displayName=mo.displayName;const bo=({className:t,...n})=>e.jsx("div",{className:En("flex flex-col space-y-2 text-center sm:text-right",t),...n});bo.displayName="AlertDialogHeader";const jo=({className:t,...n})=>e.jsx("div",{className:En("flex flex-col-reverse sm:flex-row sm:justify-start sm:space-x-reverse sm:space-x-2",t),...n});jo.displayName="AlertDialogFooter";const wo=re.forwardRef(({className:t,...n},a)=>e.jsx(ho,{ref:a,className:En("text-lg font-semibold",t),...n}));wo.displayName=ho.displayName;const No=re.forwardRef(({className:t,...n},a)=>e.jsx(xo,{ref:a,className:En("text-sm text-muted-foreground",t),...n}));No.displayName=xo.displayName;const _o=re.forwardRef(({className:t,...n},a)=>e.jsx(uo,{ref:a,className:En(Mr(),t),...n}));_o.displayName=uo.displayName;const ko=re.forwardRef(({className:t,...n},a)=>e.jsx(po,{ref:a,className:En(Mr({variant:"outline"}),"mt-2 sm:mt-0",t),...n}));ko.displayName=po.displayName;var So={exports:{}},Co={},$o=re;var Do="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Eo=$o.useState,To=$o.useEffect,Ao=$o.useLayoutEffect,Fo=$o.useDebugValue;function Po(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Do(e,n)}catch(a){return!0}}var Ro="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),a=Eo({inst:{value:n,getSnapshot:t}}),s=a[0].inst,r=a[1];return Ao(function(){s.value=n,s.getSnapshot=t,Po(s)&&r({inst:s})},[e,n,t]),To(function(){return Po(s)&&r({inst:s}),e(function(){Po(s)&&r({inst:s})})},[e]),Fo(n),n};Co.useSyncExternalStore=void 0!==$o.useSyncExternalStore?$o.useSyncExternalStore:Ro,So.exports=Co;var Oo=So.exports;function Mo(){return()=>{}}var Lo="Avatar",[Io,zo]=k(Lo),[Bo,Vo]=Io(Lo),Yo=re.forwardRef((t,n)=>{const{__scopeAvatar:a,...s}=t,[r,i]=re.useState("idle");return e.jsx(Bo,{scope:a,imageLoadingStatus:r,onImageLoadingStatusChange:i,children:e.jsx(c.span,{...s,ref:n})})});Yo.displayName=Lo;var qo="AvatarImage",Uo=re.forwardRef((t,n)=>{const{__scopeAvatar:a,src:s,onLoadingStatusChange:r=()=>{},...i}=t,l=Vo(qo,a),o=function(e,{referrerPolicy:t,crossOrigin:n}){const a=Oo.useSyncExternalStore(Mo,()=>!0,()=>!1),s=re.useRef(null),r=a?(s.current||(s.current=new window.Image),s.current):null,[i,l]=re.useState(()=>Wo(r,e));return F(()=>{l(Wo(r,e))},[r,e]),F(()=>{const e=e=>()=>{l(e)};if(!r)return;const a=e("loaded"),s=e("error");return r.addEventListener("load",a),r.addEventListener("error",s),t&&(r.referrerPolicy=t),"string"==typeof n&&(r.crossOrigin=n),()=>{r.removeEventListener("load",a),r.removeEventListener("error",s)}},[r,n,t]),i}(s,i),d=A(e=>{r(e),l.onImageLoadingStatusChange(e)});return F(()=>{"idle"!==o&&d(o)},[o,d]),"loaded"===o?e.jsx(c.img,{...i,ref:n,src:s}):null});Uo.displayName=qo;var Ho="AvatarFallback",Go=re.forwardRef((t,n)=>{const{__scopeAvatar:a,delayMs:s,...r}=t,i=Vo(Ho,a),[l,o]=re.useState(void 0===s);return re.useEffect(()=>{if(void 0!==s){const e=window.setTimeout(()=>o(!0),s);return()=>window.clearTimeout(e)}},[s]),l&&"loaded"!==i.imageLoadingStatus?e.jsx(c.span,{...r,ref:n}):null});function Wo(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}Go.displayName=Ho;var Ko=Yo,Zo=Uo,Qo=Go;const Xo=re.forwardRef(({className:t,...n},a)=>e.jsx(Ko,{ref:a,className:En("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...n}));Xo.displayName=Ko.displayName;re.forwardRef(({className:t,...n},a)=>e.jsx(Zo,{ref:a,className:En("aspect-square h-full w-full",t),...n})).displayName=Zo.displayName;const Jo=re.forwardRef(({className:t,...n},a)=>e.jsx(Qo,{ref:a,className:En("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...n}));function ec({isOpen:t,patient:n,appointment:a,onClose:s,onConfirm:r,isLoading:i=!1,deletionProgress:l}){if(!n&&!a)return null;const o=!!n;return e.jsx(go,{open:t,onOpenChange:s,children:e.jsxs(yo,{className:"max-w-md",dir:"rtl",children:[e.jsx(bo,{children:e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(qa,{className:"w-8 h-8 text-destructive"})}),e.jsxs("div",{children:[e.jsx(wo,{children:o?"هل أنت متأكد من حذف هذا المريض؟":"هل أنت متأكد من حذف هذا الموعد؟"}),e.jsx(No,{children:"هذا الإجراء لا يمكن التراجع عنه"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-muted/50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx(Xo,{className:"w-10 h-10",children:e.jsx(Jo,{className:"bg-primary/10 text-primary",children:o?`${n.first_name.charAt(0)}${n.last_name.charAt(0)}`:"📅"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:o?`${n.first_name} ${n.last_name}`:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o?n.phone||"لا يوجد رقم هاتف":new Date(a.start_time).toLocaleString("ar-SA")})]})]})}),o&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(qa,{className:"w-5 h-5 text-destructive mt-0.5 ml-2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-destructive",children:"تحذير مهم"}),e.jsx("p",{className:"text-sm text-destructive/80 mt-1",children:"سيتم حذف جميع البيانات المرتبطة بهذا المريض بما في ذلك:"}),e.jsxs("ul",{className:"text-sm text-destructive/80 mt-2 list-disc list-inside",children:[e.jsx("li",{children:"جميع المواعيد المجدولة"}),e.jsx("li",{children:"سجل المدفوعات"}),e.jsx("li",{children:"التاريخ الطبي والملاحظات"}),e.jsx("li",{children:"الصور الطبية والأشعة"}),e.jsx("li",{children:"سجل استخدام المخزون"})]})]})]})}),i&&l&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"جاري المعالجة..."}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:l})]})]})})]}),e.jsxs(jo,{className:"flex justify-end space-x-3 space-x-reverse",children:[e.jsx(ko,{disabled:i,children:"إلغاء"}),e.jsx(_o,{onClick:r,disabled:i,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:i?e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:l||"جاري الحذف..."})]}):"تأكيد الحذف"})]})]})})}function tc({isOpen:t,onClose:n,onSave:a,patients:s,treatments:r,selectedDate:i,selectedTime:l,initialData:o,preSelectedPatientId:c}){const[d,m]=re.useState({patient_id:"",gender:"",description:"",start_time:"",end_time:"",status:"scheduled",notes:""}),{toast:u}=Bl();re.useEffect(()=>{if(t)if(o){const e=s.find(e=>e.id===o.patient_id),t=new Date(o.start_time),n=new Date(o.end_time),a=e=>{if(isNaN(e.getTime()))return"";return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`};m({patient_id:o.patient_id||"",gender:"male"===e?.gender?"ذكر":"female"===e?.gender?"أنثى":"",description:o.description||"",start_time:a(t),end_time:a(n),status:o.status||"scheduled",notes:o.notes||""})}else if(i){const e=new Date(i);if(l){const[t,n]=l.split(":");e.setHours(parseInt(t),parseInt(n),0,0)}const t=new Date(e);t.setHours(e.getHours()+1);const n=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;m(a=>({...a,start_time:n(e),end_time:n(t)}))}else{const e=new Date,t=new Date(e.getTime()+36e5),n=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;m({patient_id:"",gender:"",description:"",start_time:n(e),end_time:n(t),status:"scheduled",notes:""})}},[i,l,o,t]),re.useEffect(()=>{if(t&&c&&s.length>0){const e=s.find(e=>e.id===c);m(t=>({...t,patient_id:c,gender:"male"===e?.gender?"ذكر":"female"===e?.gender?"أنثى":""}))}},[t,c,s.length]);const p=e=>{const{name:t,value:n}=e.target;if("start_time"===t){const e=new Date(n);if(isNaN(e.getTime()))m(e=>({...e,[t]:n}));else{const a=new Date(e.getTime()+36e5),s=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;m(e=>({...e,[t]:n,end_time:s(a)}))}}else m(e=>({...e,[t]:n}))};return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsx(Ar,{className:"text-xl font-semibold",children:o?"تعديل الموعد":"إضافة موعد جديد"}),e.jsx(Fr,{children:o?"تعديل بيانات الموعد المحدد":"إضافة موعد جديد للمريض"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!d.patient_id||!d.start_time)return void u({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});const t=new Date(d.start_time);if(isNaN(t.getTime()))return void u({title:"خطأ",description:"يرجى إدخال تاريخ ووقت بداية صحيح",variant:"destructive"});let n;if(d.end_time?(n=new Date(d.end_time),isNaN(n.getTime())&&(n=new Date(t.getTime()+36e5))):n=new Date(t.getTime()+36e5),n<=t)return void u({title:"خطأ",description:"يجب أن يكون وقت النهاية بعد وقت البداية",variant:"destructive"});try{if(await window.electronAPI.appointments.checkConflict(t.toISOString(),n.toISOString(),o?.id))return void u({title:"تعارض في المواعيد",description:"يوجد موعد آخر في نفس الوقت المحدد. يرجى اختيار وقت آخر.",variant:"destructive"})}catch(g){console.error("Error checking appointment conflict:",g)}const r=s.find(e=>e.id===d.patient_id),i=new Date(d.start_time),l=`${i.getDate().toString().padStart(2,"0")}/${(i.getMonth()+1).toString().padStart(2,"0")}/${i.getFullYear()}`,c=i.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}),m=r?`موعد ${r.full_name} - ${l} ${c}`:`موعد جديد - ${l} ${c}`,{gender:p,...h}=d,x={...h,title:m,start_time:t.toISOString(),end_time:n.toISOString()};console.log("📝 Submitting appointment data:",{isEdit:!!o,appointmentId:o?.id,appointmentData:x}),a(x)},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium border-b pb-2",children:"الحقول المطلوبة"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"flex items-center",children:[e.jsx(yr,{className:"w-4 h-4 ml-1"}),"المريض *"]}),e.jsxs(Nl,{value:d.patient_id,onValueChange:e=>{m(t=>({...t,patient_id:e}));const t=s.find(t=>t.id===e);t&&m(n=>({...n,patient_id:e,gender:"male"===t.gender?"ذكر":"female"===t.gender?"أنثى":""}))},children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر المريض",className:"text-muted-foreground"})}),e.jsx(Dl,{children:s.map(t=>e.jsx(Al,{value:t.id,children:t.full_name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"الجنس"}),e.jsx(Ir,{value:d.gender,readOnly:!0,className:"bg-muted cursor-not-allowed",placeholder:"سيتم ملؤه تلقائياً"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"flex items-center",children:[e.jsx(es,{className:"w-4 h-4 ml-1"}),"تاريخ ووقت البداية *"]}),e.jsx(Ir,{type:"datetime-local",name:"start_time",value:d.start_time,onChange:p,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"flex items-center",children:[e.jsx(us,{className:"w-4 h-4 ml-1"}),"وقت النهاية"]}),e.jsx(Ir,{type:"datetime-local",name:"end_time",value:d.end_time,onChange:p,placeholder:"سيتم حساب الوقت تلقائياً (ساعة واحدة)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"اتركه فارغاً لحساب ساعة واحدة تلقائياً من وقت البداية"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"حالة الموعد *"}),e.jsxs(Nl,{value:d.status,onValueChange:e=>m(t=>({...t,status:e})),children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر حالة الموعد"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"scheduled",children:"مجدول"}),e.jsx(Al,{value:"cancelled",children:"ملغي"}),e.jsx(Al,{value:"completed",children:"مكتمل"}),e.jsx(Al,{value:"no_show",children:"لم يحضر"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium border-b pb-2",children:"الحقول الاختيارية"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"وصف الموعد"}),e.jsx(wl,{name:"description",value:d.description,onChange:p,rows:3,placeholder:"أدخل وصف الموعد"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"ملاحظات إضافية"}),e.jsx(wl,{name:"notes",value:d.notes,onChange:p,rows:2,placeholder:"أي ملاحظات إضافية"})]})]}),e.jsxs(Tr,{className:"flex justify-end space-x-4 space-x-reverse",children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:n,children:"إلغاء"}),e.jsx(Lr,{type:"submit",children:"حفظ الموعد"})]})]})]})})}Jo.displayName=Qo.displayName;const nc=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,className:En("rounded-xl border bg-card text-card-foreground shadow-sm hover:shadow-md transition-all duration-200 dark:bg-card dark:border-border dark:shadow-lg dark:shadow-black/10 dark:hover:shadow-xl",t),...n}));nc.displayName="Card";const ac=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,className:En("flex flex-col space-y-1.5 p-6 dark:text-card-foreground",t),...n}));ac.displayName="CardHeader";const sc=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,className:En("font-semibold leading-none tracking-tight dark:text-card-foreground",t),...n}));sc.displayName="CardTitle";const rc=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,className:En("text-sm text-muted-foreground dark:text-muted-foreground",t),...n}));rc.displayName="CardDescription";const ic=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,className:En("p-6 pt-0 dark:text-card-foreground",t),...n}));ic.displayName="CardContent";re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,className:En("flex items-center p-6 pt-0 dark:text-card-foreground",t),...n})).displayName="CardFooter";const lc=Or("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80 dark:shadow-lg dark:shadow-primary/20",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80 dark:shadow-lg dark:shadow-secondary/20",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80 dark:shadow-lg dark:shadow-destructive/20",success:"border-transparent bg-green-600 text-white shadow hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 dark:shadow-lg dark:shadow-green-700/20",warning:"border-transparent bg-amber-600 text-white shadow hover:bg-amber-700 dark:bg-amber-700 dark:hover:bg-amber-600 dark:shadow-lg dark:shadow-amber-700/20",info:"border-transparent bg-blue-600 text-white shadow hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 dark:shadow-lg dark:shadow-blue-700/20",outline:"text-foreground border-border hover:bg-accent hover:text-accent-foreground dark:border-border dark:hover:bg-accent/80",ghost:"border-transparent hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/80"}},defaultVariants:{variant:"default"}});function oc({className:t,variant:n,...a}){return e.jsx("div",{className:En(lc({variant:n}),t),...a})}const cc=de((e,t)=>({toothTreatments:[],images:[],toothTreatmentImages:[],isLoading:!1,error:null,selectedPatientId:null,selectedToothNumber:null,loadToothTreatments:async()=>{e({isLoading:!0,error:null});try{const t=await window.electronAPI.toothTreatments.getAll();e({toothTreatments:t,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to load tooth treatments",isLoading:!1})}},loadToothTreatmentsByPatient:async t=>{e({isLoading:!0,error:null});try{console.log("🦷 Loading treatments for patient:",t);const n=await window.electronAPI.toothTreatments.getByPatient(t);console.log("🦷 Loaded treatments:",n.length,"treatments"),e({toothTreatments:n,isLoading:!1,selectedPatientId:t}),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("treatments-loaded",{detail:{patientId:t,treatmentsCount:n.length}}))}catch(n){console.error("🦷 Error loading treatments:",n),e({error:n instanceof Error?n.message:"Failed to load patient tooth treatments",isLoading:!1})}},loadToothTreatmentsByTooth:async(t,n)=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.toothTreatments.getByTooth(t,n);e({toothTreatments:a,isLoading:!1,selectedPatientId:t,selectedToothNumber:n})}catch(a){e({error:a instanceof Error?a.message:"Failed to load tooth treatments",isLoading:!1})}},createToothTreatment:async n=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.toothTreatments.create(n),{toothTreatments:s,selectedPatientId:r}=t();if(e({toothTreatments:[...s,a],isLoading:!1}),r){const t=await window.electronAPI.toothTreatments.getByPatient(r);e({toothTreatments:t})}return"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("treatment-added",{detail:{type:"created",treatmentId:a.id,treatment:a}})),window.dispatchEvent(new CustomEvent("treatment-changed",{detail:{type:"created",treatmentId:a.id,treatment:a}}))),a}catch(a){throw e({error:a instanceof Error?a.message:"Failed to create tooth treatment",isLoading:!1}),a}},updateToothTreatment:async(n,a)=>{e({isLoading:!0,error:null});try{console.log("🦷 Store: Updating treatment in database:",n,a),await window.electronAPI.toothTreatments.update(n,a),console.log("🦷 Store: Database update successful");const{toothTreatments:r,selectedPatientId:i}=t(),l=r.map(e=>e.id===n?{...e,...a,updated_at:(new Date).toISOString()}:e);if(e({toothTreatments:l,isLoading:!1}),i)try{const t=await window.electronAPI.toothTreatments.getByPatient(i);e({toothTreatments:t}),console.log("🦷 Store: Refreshed treatments from database")}catch(s){console.warn("🦷 Store: Failed to refresh treatments, but update was successful:",s)}"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("treatment-updated",{detail:{type:"updated",treatmentId:n,updates:a}})),window.dispatchEvent(new CustomEvent("treatment-changed",{detail:{type:"updated",treatmentId:n,updates:a}})),window.dispatchEvent(new CustomEvent("tooth-color-update",{detail:{type:"status-changed",treatmentId:n,updates:a,timestamp:Date.now()}}))),console.log("🦷 Store: Treatment update completed successfully")}catch(r){console.error("🦷 Store: Error updating treatment:",r),e({error:r instanceof Error?r.message:"Failed to update tooth treatment",isLoading:!1})}},deleteToothTreatment:async n=>{e({isLoading:!0,error:null});try{await window.electronAPI.toothTreatments.delete(n);const{toothTreatments:a}=t();e({toothTreatments:a.filter(e=>e.id!==n),isLoading:!1}),"undefined"!=typeof window&&window.dispatchEvent&&(window.dispatchEvent(new CustomEvent("treatment-deleted",{detail:{type:"deleted",treatmentId:n}})),window.dispatchEvent(new CustomEvent("treatment-changed",{detail:{type:"deleted",treatmentId:n}})),window.dispatchEvent(new CustomEvent("treatment-payments-deleted",{detail:{treatmentId:n}})))}catch(a){throw e({error:a instanceof Error?a.message:"Failed to delete tooth treatment",isLoading:!1}),a}},reorderToothTreatments:async(n,a,s)=>{e({isLoading:!0,error:null});try{await window.electronAPI.toothTreatments.reorder(n,a,s);const r=await window.electronAPI.toothTreatments.getByTooth(n,a),{toothTreatments:i}=t(),l=i.map(e=>{if(e.patient_id===n&&e.tooth_number===a){return r.find(t=>t.id===e.id)||e}return e});e({toothTreatments:l,isLoading:!1})}catch(r){throw e({error:r instanceof Error?r.message:"Failed to reorder tooth treatments",isLoading:!1}),r}},loadImages:async()=>{e({isLoading:!0,error:null});try{const t=await window.electronAPI.dentalTreatmentImages.getAll();e({images:t,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to load images",isLoading:!1})}},loadImagesByTreatment:async t=>{e({isLoading:!0,error:null});try{const n=await window.electronAPI.dentalTreatmentImages.getByTreatment(t);e({images:n,isLoading:!1})}catch(n){e({error:n instanceof Error?n.message:"Failed to load treatment images",isLoading:!1})}},createImage:async n=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.dentalTreatmentImages.create(n),{images:s}=t();return e({images:[...s,a],isLoading:!1}),a}catch(a){throw e({error:a instanceof Error?a.message:"Failed to create image",isLoading:!1}),a}},deleteImage:async n=>{e({isLoading:!0,error:null});try{await window.electronAPI.dentalTreatmentImages.delete(n);const{images:a}=t(),s=a.filter(e=>e.id!==n);e({images:s,isLoading:!1})}catch(a){e({error:a instanceof Error?a.message:"Failed to delete image",isLoading:!1})}},refreshAllImages:async()=>{e({isLoading:!0,error:null});try{const t=await window.electronAPI.dentalTreatmentImages.getAll();e({images:t,isLoading:!1}),console.log("✅ All images refreshed after backup restore")}catch(t){e({error:t instanceof Error?t.message:"Failed to refresh images",isLoading:!1})}},clearImages:()=>{e({images:[]})},setSelectedPatient:t=>{e({selectedPatientId:t})},setSelectedTooth:t=>{e({selectedToothNumber:t})},clearError:()=>{e({error:null})},loadAllToothTreatmentImages:async()=>{e({isLoading:!0,error:null});try{const t=await window.electronAPI.toothTreatmentImages.getAll();e({toothTreatmentImages:t,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to load all tooth treatment images",isLoading:!1})}},loadToothTreatmentImagesByTreatment:async t=>{e({isLoading:!0,error:null});try{const n=await window.electronAPI.toothTreatmentImages.getByTreatment(t);e({toothTreatmentImages:n,isLoading:!1})}catch(n){e({error:n instanceof Error?n.message:"Failed to load tooth treatment images",isLoading:!1})}},loadToothTreatmentImagesByTooth:async(n,a)=>{e({isLoading:!0,error:null});try{const s=await window.electronAPI.toothTreatmentImages.getByTooth(n,a),{toothTreatmentImages:r}=t(),i=r.filter(e=>!(e.tooth_number===a&&e.patient_id===n));e({toothTreatmentImages:[...i,...s],isLoading:!1})}catch(s){e({error:s instanceof Error?s.message:"Failed to load tooth treatment images",isLoading:!1})}},createToothTreatmentImage:async n=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.toothTreatmentImages.create(n),{toothTreatmentImages:s}=t();return e({toothTreatmentImages:[...s,a],isLoading:!1}),a}catch(a){throw e({error:a instanceof Error?a.message:"Failed to create tooth treatment image",isLoading:!1}),a}},deleteToothTreatmentImage:async n=>{e({isLoading:!0,error:null});try{await window.electronAPI.toothTreatmentImages.delete(n);const{toothTreatmentImages:a}=t();e({toothTreatmentImages:a.filter(e=>e.id!==n),isLoading:!1})}catch(a){throw e({error:a instanceof Error?a.message:"Failed to delete tooth treatment image",isLoading:!1}),a}},clearToothTreatmentImages:()=>{e({toothTreatmentImages:[]})},loadAllToothTreatmentImagesByPatient:async t=>{e({isLoading:!0,error:null});try{const n=(await window.electronAPI.toothTreatmentImages.getAll()).filter(e=>e.patient_id===t);e({toothTreatmentImages:n,isLoading:!1})}catch(n){e({error:n instanceof Error?n.message:"Failed to load all tooth treatment images",isLoading:!1})}}}));function dc({open:t,onOpenChange:n,preSelectedPatientId:a}){const{toast:s}=Bl(),{createPayment:r,updatePayment:i,isLoading:l,getPaymentsByPatient:o,getPaymentsByAppointment:c,getPaymentsByToothTreatment:d}=ca(),{patients:m}=bt(),{appointments:u}=Jn(),{toothTreatments:p,loadToothTreatmentsByPatient:h}=cc(),{formatAmount:x}=oa(),[g,f]=re.useState({patient_id:"",tooth_treatment_id:"none",appointment_id:"none",amount:"",payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:"",receipt_number:"",status:"completed",notes:"",discount_amount:"",tax_amount:"",total_amount_due:"",amount_paid:""}),[v,y]=re.useState({}),[b,j]=re.useState({previousPayments:0,suggestedReceiptNumber:"",isCalculating:!1}),w=()=>{const e=new Date;return`RCP-${e.getFullYear().toString().slice(-2)}${(e.getMonth()+1).toString().padStart(2,"0")}${e.getDate().toString().padStart(2,"0")}-${e.getTime().toString().slice(-4)}`},N=()=>parseFloat(g.total_amount_due)||0,_=()=>{const e=parseFloat(g.amount)||0;return b.previousPayments+e},k=()=>{const e=parseFloat(g.total_amount_due)||0,t=_();return Math.max(0,e-t)},S=()=>{const e=g.amount?parseFloat(g.amount):0,t=g.total_amount_due?parseFloat(g.total_amount_due):0;if(t>0){if(g.tooth_treatment_id&&"none"!==g.tooth_treatment_id){const n=b.previousPayments+e;return n>=t?"completed":n>0?"partial":"pending"}if(g.appointment_id&&"none"!==g.appointment_id){const n=b.previousPayments+e;return n>=t?"completed":n>0?"partial":"pending"}{const e=_();return e>=t?"completed":e>0?"partial":"pending"}}return e>0?"completed":"pending"};re.useEffect(()=>{if(g.tooth_treatment_id&&"none"!==g.tooth_treatment_id){j(e=>({...e,isCalculating:!0}));const t=p.find(e=>e.id===g.tooth_treatment_id),n=t?.cost||0,a=(e=g.tooth_treatment_id)&&"none"!==e?d(e).reduce((e,t)=>e+t.amount,0):0,s=w();j({previousPayments:a,suggestedReceiptNumber:s,isCalculating:!1}),f(e=>({...e,total_amount_due:n.toString(),amount:Math.max(0,n-a).toString(),receipt_number:e.receipt_number||s}))}var e},[g.tooth_treatment_id,p,d]),re.useEffect(()=>{if(g.appointment_id&&"none"!==g.appointment_id){j(e=>({...e,isCalculating:!0}));const t=(e=g.appointment_id)&&"none"!==e?c(e).reduce((e,t)=>e+t.amount,0):0,n=w(),a=c(g.appointment_id),s=a.find(e=>e.total_amount_due)?.total_amount_due;j({previousPayments:t,suggestedReceiptNumber:n,isCalculating:!1}),g.receipt_number||f(e=>({...e,receipt_number:n})),!g.total_amount_due&&s&&f(e=>({...e,total_amount_due:s.toString()}))}else j(e=>({...e,previousPayments:0,suggestedReceiptNumber:w()}));var e},[g.appointment_id]),re.useEffect(()=>{if(g.amount&&b.previousPayments>=0){const e=_();f(t=>({...t,amount_paid:e.toString()}))}},[g.amount,b.previousPayments]),re.useEffect(()=>{t||(f({patient_id:"",tooth_treatment_id:"none",appointment_id:"none",amount:"",payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:"",receipt_number:"",status:"completed",notes:"",discount_amount:"",tax_amount:"",total_amount_due:"",amount_paid:""}),y({}),j({previousPayments:0,suggestedReceiptNumber:"",isCalculating:!1}))},[t]),re.useEffect(()=>{t&&a&&f(e=>({...e,patient_id:a}))},[t,a]),re.useEffect(()=>{g.patient_id&&""!==g.patient_id&&h(g.patient_id)},[g.patient_id,h]),re.useEffect(()=>{const e=g.amount?parseFloat(g.amount):0;if((g.total_amount_due?parseFloat(g.total_amount_due):0)>0||e>0){const e=S();f(t=>({...t,status:e}))}},[g.amount,g.total_amount_due,g.tooth_treatment_id,g.appointment_id,b.previousPayments]);const C=u.filter(e=>e.patient_id===g.patient_id),$=p.filter(e=>{if(e.patient_id!==g.patient_id)return!1;const t=d(e.id),n=e.cost||0;if(0===t.length)return!0;return t.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+t.amount,0)<n});return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-background border-border shadow-2xl",dir:"rtl",children:[e.jsxs(Er,{className:"border-b border-border pb-4",children:[e.jsxs(Ar,{className:"flex items-center text-xl font-semibold text-foreground",children:[e.jsx(hs,{className:"w-5 h-5 ml-2 text-primary"}),"تسجيل دفعة جديدة"]}),e.jsx(Fr,{className:"text-muted-foreground",children:"أدخل تفاصيل الدفعة الجديدة وتتبع المدفوعات"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),console.log("🚀 Starting form submission..."),console.log("📝 Current form data:",g),(()=>{const e={};g.patient_id||(e.patient_id="يرجى اختيار المريض");const t=g.amount?parseFloat(g.amount):0,n=g.total_amount_due?parseFloat(g.total_amount_due):0;if(t<0?e.amount="المبلغ لا يمكن أن يكون سالباً":0===t&&0===n&&(e.amount="يرجى إدخال مبلغ صحيح أو مبلغ إجمالي مطلوب"),g.payment_date||(e.payment_date="يرجى اختيار تاريخ الدفع"),g.total_amount_due&&parseFloat(g.total_amount_due)<=0&&(e.total_amount_due="المبلغ الإجمالي المطلوب يجب أن يكون أكبر من صفر"),console.log("🔍 Validation check:",{total_amount_due:g.total_amount_due,amount:g.amount,patient_id:g.patient_id,payment_method:g.payment_method,errors:e}),g.tooth_treatment_id&&"none"!==g.tooth_treatment_id){const a=n-b.previousPayments;n>0&&t>a&&(e.amount=`مبلغ هذه الدفعة لا يمكن أن يكون أكبر من المبلغ المتبقي (${x(a)})`),t<=0&&n>0&&(e.amount="يجب أن يكون مبلغ الدفعة أكبر من صفر")}else if(g.appointment_id&&"none"!==g.appointment_id){const a=n-b.previousPayments;n>0&&t>a&&(e.amount=`مبلغ هذه الدفعة لا يمكن أن يكون أكبر من المبلغ المتبقي (${a.toFixed(2)} $)`)}else{const t=_();n>0&&t>n&&(e.amount="إجمالي المدفوعات لا يمكن أن يتجاوز المبلغ الإجمالي المطلوب")}return y(e),0===Object.keys(e).length})()){console.log("✅ Form validation passed");try{const e=g.amount?parseFloat(g.amount):0,t=g.discount_amount?parseFloat(g.discount_amount):0,l=g.tax_amount?parseFloat(g.tax_amount):0,o=e+l-t,c=g.status,m={patient_id:g.patient_id,appointment_id:g.appointment_id&&"none"!==g.appointment_id?g.appointment_id:void 0,amount:e,payment_method:g.payment_method,payment_date:g.payment_date,description:g.description||void 0,receipt_number:g.receipt_number||b.suggestedReceiptNumber,status:c,notes:g.notes||void 0,discount_amount:t>0?t:void 0,tax_amount:l>0?l:void 0,total_amount:o},u=g.total_amount_due?parseFloat(g.total_amount_due):o;if(m.total_amount_due=u,g.tooth_treatment_id&&"none"!==g.tooth_treatment_id){m.tooth_treatment_id=g.tooth_treatment_id,m.treatment_total_cost=u;const e=_(),t=u-e;m.treatment_total_paid=e,m.treatment_remaining_balance=t}else if(g.appointment_id&&"none"!==g.appointment_id){m.appointment_total_cost=u;const e=_(),t=u-e;m.amount_paid=e,m.remaining_balance=t}else{const e=_(),t=u-e;m.amount_paid=e,m.remaining_balance=t}let p;if(console.log("💰 Submitting payment data:",m),console.log("📊 Form data before submit:",g),console.log("🔍 Total amount due being sent:",u),console.log("🔍 Payment data total_amount_due:",m.total_amount_due),g.tooth_treatment_id&&"none"!==g.tooth_treatment_id){const n=d(g.tooth_treatment_id);if(n.length>0){const a=n.find(e=>"pending"===e.status)||n[0],s=a.amount+e;let r;r=s>=u?"completed":s>0?"partial":"pending";const o={amount:s,payment_method:g.payment_method,payment_date:g.payment_date,description:g.description||a.description,receipt_number:g.receipt_number||b.suggestedReceiptNumber||a.receipt_number,status:r,notes:g.notes||a.notes,discount_amount:t>0?t:a.discount_amount,tax_amount:l>0?l:a.tax_amount,total_amount:s+(l||0)-(t||0),total_amount_due:u,treatment_total_cost:u,treatment_total_paid:s,treatment_remaining_balance:Math.max(0,u-s)};console.log("🔄 Updating existing payment for treatment:",a.id,o),p=await i(a.id,o),console.log("✅ Payment updated successfully:",p)}else p=await r(m),console.log("✅ Payment created successfully:",p)}else p=await r(m),console.log("✅ Payment created successfully:",p);const h=g.tooth_treatment_id&&"none"!==g.tooth_treatment_id&&d(g.tooth_treatment_id).length>0;s({title:"تم بنجاح",description:h?"تم تحديث الدفعة الموجودة بنجاح":"تم تسجيل الدفعة بنجاح"}),f({patient_id:a||"",tooth_treatment_id:"none",appointment_id:"none",amount:"",payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:"",receipt_number:"",status:"completed",notes:"",discount_amount:"",tax_amount:"",total_amount_due:"",amount_paid:""}),n(!1)}catch(t){console.error("❌ Failed to submit payment:",t),s({title:"خطأ",description:t instanceof Error?t.message:"فشل في تسجيل الدفعة",variant:"destructive"})}}else console.log("❌ Form validation failed")},className:"space-y-6",children:[e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(Xs,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات المريض"]})}),e.jsx(ic,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-foreground font-medium",children:"المريض *"}),e.jsxs(Nl,{value:g.patient_id,onValueChange:e=>f(t=>({...t,patient_id:e,appointment_id:"none"})),children:[e.jsx(Sl,{className:v.patient_id?"border-destructive bg-background text-foreground":"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر المريض",className:"text-muted-foreground"})}),e.jsx(Dl,{children:m.map(t=>e.jsx(Al,{value:t.id,children:t.full_name},t.id))})]}),v.patient_id&&e.jsx("p",{className:"text-sm text-destructive",children:v.patient_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-foreground font-medium",children:"العلاج *"}),e.jsxs(Nl,{value:g.tooth_treatment_id,onValueChange:e=>f(t=>({...t,tooth_treatment_id:e,appointment_id:"none"})),disabled:!g.patient_id,children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر العلاج",className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"none",children:"بدون علاج محدد"}),$.map(t=>{const n=d(t.id),a=t.cost||0,s=a-n.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+t.amount,0);return e.jsx(Al,{value:t.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:`السن ${t.tooth_number} - ${Fa(t.treatment_type)}`}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{children:["التكلفة: ",x(a)]}),s>0&&s<a&&e.jsxs("span",{className:"text-orange-600 font-medium",children:[" • متبقي: ",x(s)]})]})]})},t.id)})]})]})]}),e.jsxs("div",{className:"space-y-2 hidden",children:[e.jsx(Yr,{className:"text-foreground font-medium",children:"الموعد (اختياري)"}),e.jsxs(Nl,{value:g.appointment_id,onValueChange:e=>f(t=>({...t,appointment_id:e,tooth_treatment_id:"none"!==e?"none":t.tooth_treatment_id})),disabled:!g.patient_id,children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر الموعد",className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"none",children:"بدون موعد محدد"}),C.map(t=>e.jsxs(Al,{value:t.id,children:[t.title," - ",In(t.start_time)]},t.id))]})]})]})]})})]}),e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(gs,{className:"w-4 h-4 ml-2 text-primary"}),"تفاصيل المبالغ"]})}),e.jsx(ic,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-foreground font-medium",children:"المبلغ *"}),e.jsx(Ir,{type:"number",step:"0.1",min:"0",placeholder:"0.00",value:g.amount,onChange:e=>f(t=>({...t,amount:e.target.value})),onBlur:e=>{const t=parseFloat(e.target.value)||0;f(e=>({...e,amount:t.toString()}))},onKeyDown:e=>{e.stopPropagation()},"data-prevent-shortcuts":"true",className:v.amount?"border-destructive bg-background text-foreground":"bg-background border-input text-foreground"}),v.amount&&e.jsx("p",{className:"text-sm text-destructive",children:v.amount})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-foreground font-medium",children:"مبلغ الخصم"}),e.jsx(Ir,{type:"number",step:"0.1",min:"0",placeholder:"0.00",value:g.discount_amount,onChange:e=>f(t=>({...t,discount_amount:e.target.value})),onBlur:e=>{const t=parseFloat(e.target.value)||0;f(e=>({...e,discount_amount:t.toString()}))},className:"bg-background border-input text-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-foreground font-medium",children:"مبلغ الضريبة"}),e.jsx(Ir,{type:"number",step:"0.1",min:"0",placeholder:"0.00",value:g.tax_amount,onChange:e=>f(t=>({...t,tax_amount:e.target.value})),onBlur:e=>{const t=parseFloat(e.target.value)||0;f(e=>({...e,tax_amount:t.toString()}))},className:"bg-background border-input text-foreground"})]})]})})]}),e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(hs,{className:"w-4 h-4 ml-2 text-primary"}),"تفاصيل الدفع"]})}),e.jsx(ic,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-foreground font-medium",children:"طريقة الدفع"}),e.jsxs(Nl,{value:g.payment_method,onValueChange:e=>f(t=>({...t,payment_method:e})),children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر طريقة الدفع",className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"cash",children:"نقداً"}),e.jsx(Al,{value:"bank_transfer",children:"تحويل بنكي"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-foreground font-medium",children:"تاريخ الدفع *"}),e.jsx(Ir,{type:"date",value:g.payment_date,onChange:e=>f(t=>({...t,payment_date:e.target.value})),className:v.payment_date?"border-destructive bg-background text-foreground":"bg-background border-input text-foreground"}),v.payment_date&&e.jsx("p",{className:"text-sm text-destructive",children:v.payment_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"text-foreground font-medium",children:["الحالة",g.amount&&parseFloat(g.amount)>0&&e.jsxs("span",{className:"text-xs text-muted-foreground mr-2",children:["(مقترح: ","completed"===S()?"مكتمل":"partial"===S()?"جزئي":"معلق",")"]})]}),e.jsxs(Nl,{value:g.status,onValueChange:e=>f(t=>({...t,status:e})),children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر الحالة",className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"completed",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"مكتمل"}),"completed"===S()&&e.jsx("span",{className:"text-xs text-green-600",children:"✓ مقترح"})]})}),e.jsx(Al,{value:"partial",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"جزئي"}),"partial"===S()&&e.jsx("span",{className:"text-xs text-orange-600",children:"✓ مقترح"})]})}),e.jsx(Al,{value:"pending",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"معلق"}),"pending"===S()&&e.jsx("span",{className:"text-xs text-blue-600",children:"✓ مقترح"})]})})]})]})]})]})})]}),e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(rr,{className:"w-4 h-4 ml-2 text-primary"}),"تتبع المدفوعات للموعد"]}),e.jsx(rc,{className:"text-muted-foreground",children:"تتبع دقيق للمدفوعات والرصيد المتبقي لكل موعد على حدة"})]}),e.jsxs(ic,{className:"space-y-4",children:[g.appointment_id&&"none"!==g.appointment_id&&e.jsx(nc,{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/50 dark:to-blue-900/30 border-blue-200 dark:border-blue-800 shadow-sm transition-all duration-200",children:e.jsxs(ic,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(rr,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:"ملخص مدفوعات الموعد"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المبلغ الإجمالي المطلوب:"}),e.jsxs("span",{className:"font-medium text-foreground",children:[N().toFixed(2)," $"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المدفوع سابقاً:"}),e.jsxs("span",{className:"font-medium text-foreground",children:[b.previousPayments.toFixed(2)," $"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المتبقي قبل هذه الدفعة:"}),e.jsxs("span",{className:"font-medium text-emerald-600 dark:text-emerald-400",children:[(N()-b.previousPayments).toFixed(2)," $"]})]})]}),g.amount&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200 dark:border-blue-700",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"المتبقي بعد هذه الدفعة:"}),e.jsxs("span",{className:"font-bold text-lg text-emerald-600 dark:text-emerald-400",children:[k().toFixed(2)," $"]})]})})]})}),"none"===g.appointment_id&&e.jsx(nc,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-950/50 dark:to-yellow-900/30 border-yellow-200 dark:border-yellow-800 shadow-sm transition-all duration-200",children:e.jsxs(ic,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ya,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"دفعة عامة غير مرتبطة بموعد"})]}),e.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"هذه دفعة عامة غير مرتبطة بموعد محدد، يمكنك تحديد المبلغ المطلوب يدوياً"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"flex items-center gap-2 text-foreground font-medium",children:["المبلغ الإجمالي المطلوب",e.jsx(oc,{variant:"secondary",className:"text-xs",children:"اختياري"})]}),e.jsx(Ir,{type:"number",step:"0.1",placeholder:"أدخل المبلغ الإجمالي المطلوب (اختياري)",value:g.total_amount_due,onChange:e=>f(t=>({...t,total_amount_due:e.target.value})),onBlur:e=>{const t=parseFloat(e.target.value)||0;f(e=>({...e,total_amount_due:t.toString()}))},className:"bg-background border-input text-foreground "+(v.total_amount_due?"border-destructive":"")}),v.total_amount_due&&e.jsx("p",{className:"text-sm text-destructive",children:v.total_amount_due}),!v.total_amount_due&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"💡 إدخال المبلغ الإجمالي يساعد في تتبع المدفوعات الجزئية"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"flex items-center gap-2 text-foreground font-medium",children:["إجمالي المبلغ المدفوع",e.jsxs(oc,{variant:"secondary",className:"text-xs",children:[e.jsx(rr,{className:"w-3 h-3 ml-1"}),"محسوب تلقائياً"]})]}),e.jsx(Ir,{type:"number",step:"0.1",placeholder:"0.00",value:g.amount_paid,readOnly:!0,className:"bg-muted cursor-not-allowed border-input text-foreground font-medium"}),e.jsxs("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium",children:["✓ محسوب تلقائياً: المدفوعات السابقة (",x(b.previousPayments),") + هذه الدفعة (",x(parseFloat(g.amount)||0),")"]})]})]}),g.total_amount_due&&e.jsx(nc,{className:"shadow-sm transition-all duration-200 "+(k()>0?"bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-950/50 dark:to-orange-900/30 border-orange-200 dark:border-orange-800":"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950/50 dark:to-green-900/30 border-green-200 dark:border-green-800"),children:e.jsxs(ic,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"المبلغ المتبقي:"}),e.jsxs(oc,{variant:k()>0?"destructive":"default",className:"text-lg px-3 py-1",children:["$",k().toFixed(2)]})]}),0===k()&&e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium mt-2",children:"✓ تم سداد المبلغ بالكامل"})]})}),e.jsxs(nc,{className:"bg-gradient-to-r from-muted/30 to-muted/50 border-border",children:[e.jsx(ac,{children:e.jsx(sc,{className:"text-sm text-card-foreground",children:"ملخص هذه الدفعة"})}),e.jsxs(ic,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المبلغ الأساسي:"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",(parseFloat(g.amount)||0).toFixed(2)]})]}),g.tax_amount&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"الضريبة:"}),e.jsxs("span",{className:"text-orange-600 dark:text-orange-400 font-medium",children:["+$",(parseFloat(g.tax_amount)||0).toFixed(2)]})]}),g.discount_amount&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"الخصم:"}),e.jsxs("span",{className:"text-emerald-600 dark:text-emerald-400 font-medium",children:["-$",(parseFloat(g.discount_amount)||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-medium border-t border-border pt-2",children:[e.jsx("span",{className:"text-foreground",children:"إجمالي هذه الدفعة:"}),e.jsxs(oc,{variant:"outline",className:"text-base",children:["$",((parseFloat(g.amount)||0)+(parseFloat(g.tax_amount)||0)-(parseFloat(g.discount_amount)||0)).toFixed(2)]})]})]})]})]})]}),e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{children:e.jsx(sc,{className:"text-lg text-card-foreground",children:"معلومات إضافية"})}),e.jsxs(ic,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"flex items-center gap-2 text-foreground",children:["رقم الإيصال",e.jsxs(oc,{variant:"secondary",className:"text-xs",children:[e.jsx(rr,{className:"w-3 h-3 ml-1"}),"مولد تلقائياً"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ir,{type:"text",placeholder:"رقم الإيصال",value:g.receipt_number,onChange:e=>f(t=>({...t,receipt_number:e.target.value})),className:"flex-1 bg-background border-input text-foreground"}),e.jsx(Lr,{type:"button",variant:"outline",size:"sm",onClick:()=>f(e=>({...e,receipt_number:w()})),className:"px-3",children:e.jsx(rr,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium",children:"✓ تم توليد رقم إيصال فريد تلقائياً"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-foreground",children:"الوصف"}),e.jsx(wl,{placeholder:"وصف الدفعة (اختياري)",value:g.description,onChange:e=>f(t=>({...t,description:e.target.value})),rows:2,className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-foreground",children:"ملاحظات"}),e.jsx(wl,{placeholder:"ملاحظات إضافية (اختياري)",value:g.notes,onChange:e=>f(t=>({...t,notes:e.target.value})),rows:2,className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})]})]})]}),e.jsxs(Tr,{className:"flex justify-end space-x-2 space-x-reverse border-t border-border pt-4",children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:l,children:"إلغاء"}),e.jsx(Lr,{type:"submit",disabled:l,className:"bg-primary hover:bg-primary/90 text-primary-foreground",children:l?"جاري الحفظ...":"حفظ الدفعة"})]})]})]})})}const mc=[{key:"F1",description:"الإعدادات"},{key:"A/ش",description:"مريض جديد"},{key:"S/س",description:"موعد جديد"},{key:"D/ي",description:"دفعة جديدة"},{key:"R/ق",description:"تحديث"},{key:"F/ب",description:"بحث"},{key:"0-9",description:"تنقل سريع"}];function uc({className:t}){const{isDarkMode:n}=sa(),[a,s]=re.useState(0),[r,i]=re.useState(!0),[l,o]=re.useState(!1);if(re.useEffect(()=>{if(!r||l)return;const e=setInterval(()=>{s(e=>(e+1)%mc.length)},3e3);return()=>clearInterval(e)},[r,l]),!r)return null;const c=mc[a];return e.jsxs("div",{className:En("flex items-center gap-2 px-3 py-1.5 rounded-lg border transition-all duration-300",n?"bg-gradient-to-r from-blue-950/30 to-indigo-950/30 border-blue-800/50 shadow-lg shadow-blue-900/20":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200 shadow-sm",t),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[e.jsx(Ds,{className:"w-3 h-3 "+(n?"text-blue-400":"text-blue-600")}),e.jsx("span",{className:"text-xs font-medium "+(n?"text-blue-300":"text-blue-700"),children:"نصيحة:"}),e.jsx(oc,{variant:"secondary",className:En("text-xs px-1.5 py-0.5 font-mono",n?"bg-blue-900/50 text-blue-200 border-blue-700/50":"bg-blue-100 text-blue-800 border-blue-300"),children:c.key}),e.jsx("span",{className:"text-xs "+(n?"text-blue-300":"text-blue-700"),children:c.description}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>i(!1),className:En("h-4 w-4 p-0 ml-1 transition-colors",n?"text-blue-400 hover:text-blue-200 hover:bg-blue-900/30":"text-blue-500 hover:text-blue-700 hover:bg-blue-100"),children:e.jsx(_r,{className:"w-3 h-3"})})]})}const pc=e=>{const t="transition-all duration-200 hover:shadow-lg border rounded-lg";switch(e){case"green":return`${t} card-green`;case"yellow":return`${t} card-yellow`;case"orange":return`${t} card-orange`;case"red":return`${t} card-red`;case"blue":return`${t} card-blue`;case"purple":return`${t} card-purple`;case"emerald":return`${t} card-emerald`;case"cyan":return`${t} card-cyan`;case"indigo":return`${t} card-indigo`;case"pink":return`${t} bg-pink-50 dark:bg-pink-950 border-pink-200 dark:border-pink-800`;case"slate":return`${t} bg-slate-50 dark:bg-slate-950 border-slate-200 dark:border-slate-800`;default:return`${t} card-gray`}},hc=e=>{switch(e){case"green":return"text-green-700 dark:text-green-300";case"yellow":return"text-yellow-700 dark:text-yellow-300";case"orange":return"text-orange-700 dark:text-orange-300";case"red":return"text-red-700 dark:text-red-300";case"blue":return"text-blue-700 dark:text-blue-300";case"purple":return"text-purple-700 dark:text-purple-300";case"emerald":return"text-emerald-700 dark:text-emerald-300";case"cyan":return"text-cyan-700 dark:text-cyan-300";case"indigo":return"text-indigo-700 dark:text-indigo-300";case"pink":return"text-pink-700 dark:text-pink-300";case"slate":return"text-slate-700 dark:text-slate-300";default:return"text-gray-700 dark:text-gray-300"}};var xc="Collapsible",[gc,fc]=k(xc),[vc,yc]=gc(xc),bc=re.forwardRef((t,n)=>{const{__scopeCollapsible:a,open:s,defaultOpen:r,disabled:i,onOpenChange:l,...o}=t,[d,m]=P({prop:s,defaultProp:r??!1,onChange:l,caller:xc});return e.jsx(vc,{scope:a,disabled:i,contentId:R(),open:d,onOpenToggle:re.useCallback(()=>m(e=>!e),[m]),children:e.jsx(c.div,{"data-state":Sc(d),"data-disabled":i?"":void 0,...o,ref:n})})});bc.displayName=xc;var jc="CollapsibleTrigger",wc=re.forwardRef((t,n)=>{const{__scopeCollapsible:a,...s}=t,r=yc(jc,a);return e.jsx(c.button,{type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":Sc(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled,...s,ref:n,onClick:E(t.onClick,r.onOpenToggle)})});wc.displayName=jc;var Nc="CollapsibleContent",_c=re.forwardRef((t,n)=>{const{forceMount:a,...s}=t,r=yc(Nc,t.__scopeCollapsible);return e.jsx(O,{present:a||r.open,children:({present:t})=>e.jsx(kc,{...s,ref:n,present:t})})});_c.displayName=Nc;var kc=re.forwardRef((t,n)=>{const{__scopeCollapsible:a,present:s,children:r,...i}=t,l=yc(Nc,a),[o,d]=re.useState(s),m=re.useRef(null),u=$(n,m),p=re.useRef(0),h=p.current,x=re.useRef(0),g=x.current,f=l.open||o,v=re.useRef(f),y=re.useRef(void 0);return re.useEffect(()=>{const e=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(e)},[]),F(()=>{const e=m.current;if(e){y.current=y.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";const t=e.getBoundingClientRect();p.current=t.height,x.current=t.width,v.current||(e.style.transitionDuration=y.current.transitionDuration,e.style.animationName=y.current.animationName),d(s)}},[l.open,s]),e.jsx(c.div,{"data-state":Sc(l.open),"data-disabled":l.disabled?"":void 0,id:l.contentId,hidden:!f,...i,ref:u,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":g?`${g}px`:void 0,...t.style},children:f&&r})});function Sc(e){return e?"open":"closed"}const Cc=bc,$c=wc,Dc=_c;function Ec({value:t,onChange:n,onClear:a,className:s="",showTitle:r=!0,title:i="فلترة زمنية",defaultOpen:l=!1}){const[o,c]=re.useState(l),d=t||{preset:"all",startDate:"",endDate:""},m=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,u=(e,t)=>{n({...d,[e]:t,preset:"custom"})};return e.jsx("div",{className:`${s}`,dir:"rtl",children:e.jsxs(Cc,{open:o,onOpenChange:c,children:[e.jsx($c,{asChild:!0,children:e.jsxs(Lr,{variant:"outline",className:"w-full justify-between text-sm h-9",size:"sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ja,{className:"w-4 h-4"}),e.jsx("span",{children:i})]}),e.jsx(ss,{className:"w-4 h-4 transition-transform "+(o?"rotate-180":"")})]})}),e.jsx(Dc,{className:"mt-3",children:e.jsx(nc,{className:"border-muted",dir:"rtl",children:e.jsxs(ic,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-right block text-muted-foreground",children:"اختر الفترة الزمنية للفلترة"}),e.jsxs(Nl,{value:d.preset,onValueChange:e=>{const t=new Date;let a="",s=m(t);switch(e){case"all":a="",s="";break;case"today":a=m(t);break;case"week":const e=Vn(t);a=m(e);break;case"month":const n=new Date(t.getFullYear(),t.getMonth(),1);a=m(n);break;case"year":const r=new Date(t.getFullYear(),0,1);a=m(r);break;case"custom":a=d.startDate||"",s=d.endDate||""}n({preset:e,startDate:a,endDate:s})},children:[e.jsx(Sl,{className:"text-right h-8 text-sm",dir:"rtl",children:e.jsx(kl,{placeholder:"اختر الفترة الزمنية"})}),e.jsxs(Dl,{dir:"rtl",children:[e.jsx(Al,{value:"all",children:"جميع البيانات"}),e.jsx(Al,{value:"today",children:"اليوم"}),e.jsx(Al,{value:"week",children:"هذا الأسبوع"}),e.jsx(Al,{value:"month",children:"هذا الشهر"}),e.jsx(Al,{value:"year",children:"هذه السنة"}),e.jsx(Al,{value:"custom",children:"فترة مخصصة"})]})]})]}),"custom"===d.preset&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-right block text-muted-foreground",children:"من تاريخ (بداية الفترة)"}),e.jsx(Ir,{type:"date",value:d.startDate||"",onChange:e=>u("startDate",e.target.value),className:"text-right h-8 text-sm",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-right block text-muted-foreground",children:"إلى تاريخ (نهاية الفترة)"}),e.jsx(Ir,{type:"date",value:d.endDate||"",onChange:e=>u("endDate",e.target.value),className:"text-right h-8 text-sm",dir:"rtl"})]})]}),e.jsxs("div",{className:"bg-muted/30 p-2 rounded text-right",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"الفترة المحددة:"}),e.jsxs("div",{className:"text-sm font-medium",children:[(e=>{switch(e){case"all":default:return"جميع البيانات";case"today":return"اليوم";case"week":return"هذا الأسبوع";case"month":return"هذا الشهر";case"year":return"هذه السنة";case"custom":return"فترة مخصصة"}})(d.preset),d.startDate&&d.endDate&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["من ",new Date(d.startDate).toLocaleDateString("en-GB"),"إلى ",new Date(d.endDate).toLocaleDateString("en-GB")]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(Lr,{variant:"outline",size:"sm",onClick:()=>{n({preset:"all",startDate:"",endDate:""}),a?.()},className:"h-7 text-xs",children:[e.jsx(_r,{className:"w-3 h-3 ml-1"}),"إعادة تعيين"]})})]})})})]})})}function Tc({data:e,dateField:t="created_at",initialFilter:n}){const[a,s]=re.useState(n||{preset:"all",startDate:"",endDate:""}),r=re.useMemo(()=>{if(!e||!Array.isArray(e))return[];if(!a.startDate||!a.endDate||""===a.startDate||""===a.endDate)return e;const n=new Date(a.startDate),s=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),r=new Date(a.endDate),i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);return e.filter(e=>{const n=e[t];if(!n)return!1;const a=n,r=new Date(a);let l;return l=a.includes("T")||a.includes(" ")?r:new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0),l>=s&&l<=i})},[e,a,t]),i=re.useMemo(()=>{const n=r.length;if(!e||!Array.isArray(e))return{total:0,filtered:0,today:0,week:0,month:0,year:0};const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate()),i=Vn(a),l=new Date(a.getFullYear(),a.getMonth(),1),o=new Date(a.getFullYear(),0,1),c=e.filter(e=>{const n=e[t];if(!n)return!1;return new Date(n)>=s}).length,d=e.filter(e=>{const n=e[t];if(!n)return!1;const s=new Date(n);return s>=i&&s<=a}).length,m=e.filter(e=>{const n=e[t];if(!n)return!1;return new Date(n)>=l}).length,u=e.filter(e=>{const n=e[t];if(!n)return!1;return new Date(n)>=o}).length;return{total:n,filtered:r.length,today:c,week:d,month:m,year:u}},[e,r,t]),l=re.useMemo(()=>{if(!r||0===r.length)return{totalRevenue:0,pendingAmount:0,overdueAmount:0,completedAmount:0};if(!r.some(e=>"amount"in e||"total_amount"in e||"cost"in e||"price"in e))return{totalRevenue:0,pendingAmount:0,overdueAmount:0,completedAmount:0};const e=r.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>{const n=t.amount||t.total_amount||t.cost||t.price||0;return e+("number"==typeof n?n:parseFloat(n)||0)},0),t=r.filter(e=>"pending"===e.status).reduce((e,t)=>{const n=t.amount||t.total_amount||t.cost||t.price||0,a=t.total_amount_due||0;let s=n;if(t.tooth_treatment_id){s=t.treatment_total_cost||a||0}else if(a>0)s=a;else{const e=t.remaining_balance||0;e>0&&(s=e)}return e+("number"==typeof s?s:parseFloat(s)||0)},0),n=r.filter(e=>{if("pending"!==e.status)return!1;const t=new Date(e.payment_date||e.date||e.created_at),n=new Date;return n.setDate(n.getDate()-30),t<n}).reduce((e,t)=>{const n=t.amount||t.total_amount||t.cost||t.price||0,a=t.total_amount_due||0,s=t.remaining_balance||0;let r=n;return a>0?r=a:s>0&&(r=s),e+("number"==typeof r?r:parseFloat(r)||0)},0),a=new Map,s=new Map;let i=0;r.forEach(e=>{if("partial"===e.status)if(e.tooth_treatment_id){const t=e.tooth_treatment_id,n=e.treatment_total_cost||e.total_amount_due||0,a=e.amount||0;s.has(t)||s.set(t,{totalDue:"number"==typeof n?n:parseFloat(n)||0,totalPaid:0});s.get(t).totalPaid+="number"==typeof a?a:parseFloat(a)||0}else if(e.appointment_id){const t=e.appointment_id,n=e.total_amount_due||e.appointment_total_cost||0,s=e.amount||0;a.has(t)||a.set(t,{totalDue:"number"==typeof n?n:parseFloat(n)||0,totalPaid:0});a.get(t).totalPaid+="number"==typeof s?s:parseFloat(s)||0}else{const t=e.total_amount_due||e.amount||0,n=e.amount_paid||e.amount||0,a="number"==typeof t?t:parseFloat(t)||0,s="number"==typeof n?n:parseFloat(n)||0;i+=Math.max(0,a-s)}});return{totalRevenue:e,pendingAmount:t,overdueAmount:n,completedAmount:e,totalRemainingBalance:Array.from(a.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0)+Array.from(s.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0)+i}},[r]),o=re.useMemo(()=>{const e={};return r.forEach(n=>{const s=new Date(n[t]);let r="";switch(a.preset){case"today":r=s.toLocaleTimeString("ar-SA",{hour:"2-digit"});break;case"week":r=s.toLocaleDateString("ar-SA",{weekday:"short"});break;case"month":r=s.getDate().toString();break;case"year":r=s.toLocaleDateString("ar-SA",{month:"short"});break;default:r=s.toLocaleDateString("ar-SA")}e[r]||(e[r]=[]),e[r].push(n)}),e},[r,a.preset,t]),c=re.useMemo(()=>{if(!(e&&Array.isArray(e)&&a.startDate&&a.endDate))return null;const n=new Date(a.startDate),s=new Date(a.endDate).getTime()-n.getTime(),i=new Date(n.getTime()-s),l=new Date(n.getTime()-1),o=e.filter(e=>{const n=new Date(e[t]);return n>=i&&n<=l}),c=r.length,d=o.length;if(0===d)return null;const m=(c-d)/d*100;return{current:c,previous:d,change:c-d,changePercent:Math.round(100*m)/100,isPositive:m>=0}},[e,r,a,t]);return{timeFilter:a,filteredData:r,stats:i,financialStats:l,groupedData:o,trend:c,handleFilterChange:e=>{s(e)},resetFilter:()=>{s({preset:"all",startDate:"",endDate:""})}}}function Ac({open:t,onOpenChange:n,payment:a}){const{toast:s}=Bl(),{updatePayment:r,isLoading:i,getPaymentsByPatient:l,getPaymentsByAppointment:o,getPaymentsByToothTreatment:c}=ca(),{patients:d}=bt(),{appointments:m}=Jn(),{toothTreatments:u,loadToothTreatmentsByPatient:p}=cc(),{formatAmount:h}=oa(),[x,g]=re.useState({patient_id:"",tooth_treatment_id:"none",appointment_id:"none",amount:"",payment_method:"cash",payment_date:"",description:"",receipt_number:"",status:"completed",notes:"",discount_amount:"",tax_amount:"",total_amount_due:"",amount_paid:""}),[f,v]=re.useState({previousPayments:0,originalAmount:0,isCalculating:!1}),y=()=>{const e=new Date;return`RCP-${e.getFullYear().toString().slice(-2)}${(e.getMonth()+1).toString().padStart(2,"0")}${e.getDate().toString().padStart(2,"0")}-${e.getTime().toString().slice(-4)}`},b=()=>{const e=parseFloat(x.amount)||0;return f.previousPayments+e},j=()=>{const e=parseFloat(x.total_amount_due)||0,t=b();return Math.max(0,e-t)};re.useEffect(()=>{if(x.appointment_id&&"none"!==x.appointment_id&&a){v(e=>({...e,isCalculating:!0}));const n=(e=x.appointment_id,t=a.id,e&&"none"!==e?o(e).filter(e=>e.id!==t).reduce((e,t)=>e+t.amount,0):0),s=a.amount;v({previousPayments:n,originalAmount:s,isCalculating:!1})}else a&&v({previousPayments:0,originalAmount:a.amount,isCalculating:!1});var e,t},[x.appointment_id,a]),re.useEffect(()=>{if(x.appointment_id&&"none"!==x.appointment_id){const e=(e=>{if(!e||"none"===e)return 0;const t=m.find(t=>t.id===e);return t?.cost||0})(x.appointment_id);e>0&&!x.total_amount_due&&g(t=>({...t,total_amount_due:e.toString()}))}},[x.appointment_id]),re.useEffect(()=>{if(x.tooth_treatment_id&&"none"!==x.tooth_treatment_id){const e=u.find(e=>e.id===x.tooth_treatment_id);e&&e.cost&&g(t=>({...t,total_amount_due:e.cost.toString()}))}},[x.tooth_treatment_id,u]),re.useEffect(()=>{if(x.amount&&f.previousPayments>=0){const e=b();g(t=>({...t,amount_paid:e.toString()}))}},[x.amount,f.previousPayments]),re.useEffect(()=>{a&&t&&(g({patient_id:a.patient_id||"",tooth_treatment_id:a.tooth_treatment_id||"none",appointment_id:a.appointment_id||"none",amount:a.amount.toString(),payment_method:a.payment_method,payment_date:a.payment_date.split("T")[0],description:a.description||"",receipt_number:a.receipt_number||"",status:a.status,notes:a.notes||"",discount_amount:a.discount_amount?.toString()||"",tax_amount:a.tax_amount?.toString()||"",total_amount_due:a.total_amount_due?.toString()||"",amount_paid:a.amount_paid?.toString()||""}),a.patient_id&&p(a.patient_id))},[a,t]);const w=(e,t)=>{g(n=>({...n,[e]:t}))},N=()=>{const e=x.amount?parseFloat(x.amount):0,t=x.total_amount_due?parseFloat(x.total_amount_due):0;if(t>0){if(x.appointment_id&&"none"!==x.appointment_id){const n=o(x.appointment_id).filter(e=>e.id!==a.id).reduce((e,t)=>e+t.amount,0)+e;return n>=t?"completed":n>0?"partial":"pending"}{const n=parseFloat(x.amount_paid)||e;return n>=t?"completed":n>0?"partial":"pending"}}return e>0?"completed":"pending"};re.useEffect(()=>{const e=x.amount?parseFloat(x.amount):0;if((x.total_amount_due?parseFloat(x.total_amount_due):0)>0||e>0){const e=N();g(t=>({...t,status:e}))}},[x.amount,x.total_amount_due,x.appointment_id]);const _=m.filter(e=>e.patient_id===x.patient_id),k=u.filter(e=>{if(e.patient_id!==x.patient_id)return!1;if(a.tooth_treatment_id===e.id)return!0;const t=c(e.id),n=e.cost||0;if(0===t.length)return!0;return t.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+t.amount,0)<n});return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-background border-border shadow-2xl",dir:"rtl",children:[e.jsxs(Er,{className:"border-b border-border pb-4",children:[e.jsxs(Ar,{className:"flex items-center text-xl font-semibold text-foreground",children:[e.jsx(Us,{className:"w-5 h-5 ml-2 text-primary"}),"تعديل الدفعة"]}),e.jsxs(Fr,{className:"text-muted-foreground",children:["تعديل بيانات الدفعة رقم ",a.receipt_number||a.id.slice(-6)]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),x.patient_id&&x.payment_date)try{const e=x.amount?parseFloat(x.amount):0,t=x.discount_amount?parseFloat(x.discount_amount):0,i=x.tax_amount?parseFloat(x.tax_amount):0,l=e+i-t,o=x.total_amount_due?parseFloat(x.total_amount_due):l,c=b(),d=o-c,m=a.tooth_treatment_id&&"none"!==a.tooth_treatment_id?a.tooth_treatment_id:x.tooth_treatment_id&&"none"!==x.tooth_treatment_id?x.tooth_treatment_id:void 0,u={patient_id:x.patient_id,tooth_treatment_id:m,appointment_id:x.appointment_id&&"none"!==x.appointment_id?x.appointment_id:void 0,amount:e,payment_method:x.payment_method,payment_date:x.payment_date,description:x.description,receipt_number:x.receipt_number||y(),status:x.status,notes:x.notes,discount_amount:t>0?t:void 0,tax_amount:i>0?i:void 0,total_amount:l,total_amount_due:o,amount_paid:c,remaining_balance:d};console.log("🔄 Submitting payment update:",u),await r(a.id,u),s({title:"تم بنجاح",description:"تم تحديث الدفعة بنجاح"}),n(!1)}catch(t){console.error("❌ Failed to update payment:",t),s({title:"خطأ",description:t instanceof Error?t.message:"فشل في تحديث الدفعة",variant:"destructive"})}else s({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"})},className:"space-y-6",children:["none"!==x.tooth_treatment_id&&e.jsx("div",{className:"bg-orange-50 dark:bg-orange-950/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ya,{className:"w-5 h-5 text-orange-600 dark:text-orange-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-orange-800 dark:text-orange-200",children:"دفعة مرتبطة بعلاج"}),e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:"هذه الدفعة مرتبطة بعلاج محدد. المبلغ الإجمالي المطلوب مرتبط بتكلفة العلاج ولا يمكن تعديله من هنا. لتعديل المبلغ، قم بتعديل تكلفة العلاج من قسم العلاجات."})]})]})}),e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(Xs,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات المريض"]})}),e.jsx(ic,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"patient_id",className:"text-foreground font-medium",children:"المريض *"}),e.jsxs(Nl,{value:x.patient_id,onValueChange:e=>w("patient_id",e),children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر المريض",className:"text-muted-foreground"})}),e.jsx(Dl,{children:d.map(t=>e.jsx(Al,{value:t.id,children:t.full_name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"tooth_treatment_id",className:"text-foreground font-medium",children:"العلاج"}),a.tooth_treatment_id&&"none"!==a.tooth_treatment_id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"p-3 bg-muted/50 border border-border rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex flex-col",children:(()=>{const t=u.find(e=>e.id===a.tooth_treatment_id);return t?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-medium text-foreground",children:["السن ",t.tooth_number," - ",Fa(t.treatment_type)]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["التكلفة: ",h(t.cost||0)]})]}):e.jsxs("span",{className:"text-muted-foreground",children:["العلاج المرتبط (معرف: ",a.tooth_treatment_id,")"]})})()}),e.jsx(oc,{variant:"secondary",className:"text-xs",children:"مرتبط"})]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"⚠️ لا يمكن تغيير العلاج للمدفوعات المرتبطة بعلاج محدد"}),e.jsx("input",{type:"hidden",value:a.tooth_treatment_id})]}):e.jsxs(Nl,{value:x.tooth_treatment_id,onValueChange:e=>w("tooth_treatment_id",e),children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر العلاج",className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"none",children:"بدون علاج محدد"}),k.map(t=>{const n=c(t.id),a=t.cost||0,s=a-n.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+t.amount,0);return e.jsx(Al,{value:t.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:`السن ${t.tooth_number} - ${Fa(t.treatment_type)}`}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{children:["التكلفة: ",h(a)]}),s>0&&s<a&&e.jsxs("span",{className:"text-orange-600 font-medium",children:[" • متبقي: ",h(s)]})]})]})},t.id)})]})]})]}),e.jsxs("div",{className:"space-y-2 hidden",children:[e.jsx(Yr,{htmlFor:"appointment_id",className:"text-foreground font-medium",children:"الموعد (اختياري)"}),e.jsxs(Nl,{value:x.appointment_id,onValueChange:e=>w("appointment_id",e),children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر الموعد",className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"none",children:"بدون موعد محدد"}),_.map(t=>e.jsxs(Al,{value:t.id,children:[t.title," - ",In(t.start_time)]},t.id))]})]})]})]})})]}),e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(gs,{className:"w-4 h-4 ml-2 text-primary"}),"تفاصيل المبالغ والدفع"]})}),e.jsxs(ic,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"amount",className:"text-foreground font-medium",children:"المبلغ"}),e.jsx(Ir,{id:"amount",type:"number",step:"0.1",value:x.amount,onChange:e=>w("amount",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;w("amount",t.toString())},placeholder:"0.00",className:"bg-background border-input text-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"payment_method",className:"text-foreground font-medium",children:"طريقة الدفع"}),e.jsxs(Nl,{value:x.payment_method,onValueChange:e=>w("payment_method",e),children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر طريقة الدفع",className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"cash",children:"نقداً"}),e.jsx(Al,{value:"bank_transfer",children:"تحويل بنكي"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"payment_date",className:"text-foreground font-medium",children:"تاريخ الدفع *"}),e.jsx(Ir,{id:"payment_date",type:"date",value:x.payment_date,onChange:e=>w("payment_date",e.target.value),required:!0,className:"bg-background border-input text-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"status",className:"text-foreground font-medium",children:["الحالة",x.amount&&parseFloat(x.amount)>0&&e.jsxs("span",{className:"text-xs text-muted-foreground mr-2",children:["(مقترح: ","completed"===N()?"مكتمل":"partial"===N()?"جزئي":"معلق",")"]})]}),e.jsxs(Nl,{value:x.status,onValueChange:e=>w("status",e),children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر الحالة",className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"completed",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"مكتمل"}),"completed"===N()&&e.jsx("span",{className:"text-xs text-green-600",children:"✓ مقترح"})]})}),e.jsx(Al,{value:"partial",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"جزئي"}),"partial"===N()&&e.jsx("span",{className:"text-xs text-orange-600",children:"✓ مقترح"})]})}),e.jsx(Al,{value:"pending",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"معلق"}),"pending"===N()&&e.jsx("span",{className:"text-xs text-blue-600",children:"✓ مقترح"})]})})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"discount_amount",className:"text-foreground font-medium",children:"مبلغ الخصم"}),e.jsx(Ir,{id:"discount_amount",type:"number",step:"0.1",value:x.discount_amount,onChange:e=>w("discount_amount",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;w("discount_amount",t.toString())},placeholder:"0.00",className:"bg-background border-input text-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"tax_amount",className:"text-foreground font-medium",children:"مبلغ الضريبة"}),e.jsx(Ir,{id:"tax_amount",type:"number",step:"0.1",value:x.tax_amount,onChange:e=>w("tax_amount",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;w("tax_amount",t.toString())},placeholder:"0.00",className:"bg-background border-input text-foreground"})]})]})]})]}),e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(rr,{className:"w-4 h-4 ml-2 text-primary"}),"تتبع المدفوعات التلقائي"]}),e.jsx(rc,{className:"text-muted-foreground",children:"تتبع المبالغ المطلوبة والمدفوعة والمتبقية مع الحسابات التلقائية"})]}),e.jsxs(ic,{className:"space-y-4",children:[x.appointment_id&&"none"!==x.appointment_id&&e.jsx(nc,{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/50 dark:to-blue-900/30 border-blue-200 dark:border-blue-800 shadow-sm transition-all duration-200",children:e.jsxs(ic,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(rr,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:"الحسابات التلقائية للموعد"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المدفوعات السابقة لهذا الموعد:"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",f.previousPayments.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المبلغ الأصلي لهذه الدفعة:"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",f.originalAmount.toFixed(2)]})]})]})]})}),"none"===x.appointment_id&&e.jsx(nc,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-950/50 dark:to-yellow-900/30 border-yellow-200 dark:border-yellow-800 shadow-sm transition-all duration-200",children:e.jsxs(ic,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ya,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"دفعة بدون موعد محدد"})]}),e.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"هذه الدفعة غير مرتبطة بموعد محدد، لذلك لا توجد مدفوعات سابقة مرتبطة بها"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"flex items-center gap-2 text-foreground font-medium",htmlFor:"total_amount_due",children:["المبلغ الإجمالي المطلوب","none"!==x.tooth_treatment_id&&e.jsx(oc,{variant:"outline",className:"text-xs text-orange-600 border-orange-600",children:"🔒 مرتبط بالعلاج"}),"none"!==x.appointment_id&&"none"===x.tooth_treatment_id&&e.jsxs(oc,{variant:"secondary",className:"text-xs",children:[e.jsx(rr,{className:"w-3 h-3 ml-1"}),"تلقائي"]})]}),e.jsx(Ir,{id:"total_amount_due",type:"number",step:"0.1",value:x.total_amount_due,onChange:e=>w("total_amount_due",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;w("total_amount_due",t.toString())},placeholder:"0.00",className:"bg-background border-input text-foreground "+("none"!==x.tooth_treatment_id?"opacity-60 cursor-not-allowed bg-muted":""),disabled:"none"!==x.tooth_treatment_id}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"none"!==x.tooth_treatment_id?"🔒 المبلغ مرتبط بتكلفة العلاج ولا يمكن تعديله هنا. لتعديل المبلغ، قم بتعديل تكلفة العلاج من قسم العلاجات.":"none"!==x.appointment_id?"تم جلب المبلغ من الموعد المحدد تلقائياً":"المبلغ الكامل المطلوب للعلاج أو الخدمة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"flex items-center gap-2 text-foreground font-medium",htmlFor:"amount_paid",children:["إجمالي المبلغ المدفوع",e.jsxs(oc,{variant:"secondary",className:"text-xs",children:[e.jsx(rr,{className:"w-3 h-3 ml-1"}),"محسوب تلقائياً"]})]}),e.jsx(Ir,{id:"amount_paid",type:"number",step:"0.1",value:x.amount_paid,readOnly:!0,className:"bg-muted cursor-not-allowed border-input text-foreground font-medium",placeholder:"0.00"}),e.jsxs("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium",children:["✓ محسوب تلقائياً: المدفوعات السابقة (",h(f.previousPayments),") + هذه الدفعة (",h(parseFloat(x.amount)||0),")"]})]})]}),x.total_amount_due&&e.jsx(nc,{className:"shadow-sm transition-all duration-200 "+(j()>0?"bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-950/50 dark:to-orange-900/30 border-orange-200 dark:border-orange-800":"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950/50 dark:to-green-900/30 border-green-200 dark:border-green-800"),children:e.jsxs(ic,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"المبلغ المتبقي:"}),e.jsxs(oc,{variant:j()>0?"destructive":"default",className:"text-lg px-3 py-1",children:["$",j().toFixed(2)]})]}),0===j()&&e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium mt-2",children:"✓ تم سداد المبلغ بالكامل"})]})}),e.jsxs(nc,{className:"bg-gradient-to-r from-muted/30 to-muted/50 border-border",children:[e.jsx(ac,{children:e.jsx(sc,{className:"text-sm text-card-foreground",children:"ملخص هذه الدفعة"})}),e.jsxs(ic,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"المبلغ الأساسي:"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",(parseFloat(x.amount)||0).toFixed(2)]})]}),x.tax_amount&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"الضريبة:"}),e.jsxs("span",{className:"text-orange-600 dark:text-orange-400 font-medium",children:["+$",(parseFloat(x.tax_amount)||0).toFixed(2)]})]}),x.discount_amount&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"الخصم:"}),e.jsxs("span",{className:"text-emerald-600 dark:text-emerald-400 font-medium",children:["-$",(parseFloat(x.discount_amount)||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-medium border-t border-border pt-2",children:[e.jsx("span",{className:"text-foreground",children:"إجمالي هذه الدفعة:"}),e.jsxs(oc,{variant:"outline",className:"text-base",children:["$",((parseFloat(x.amount)||0)+(parseFloat(x.tax_amount)||0)-(parseFloat(x.discount_amount)||0)).toFixed(2)]})]})]})]})]})]}),e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{children:e.jsx(sc,{className:"text-lg text-card-foreground",children:"معلومات إضافية"})}),e.jsxs(ic,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"flex items-center gap-2 text-foreground",htmlFor:"receipt_number",children:["رقم الإيصال",e.jsxs(oc,{variant:"secondary",className:"text-xs",children:[e.jsx(rr,{className:"w-3 h-3 ml-1"}),"مولد تلقائياً"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ir,{id:"receipt_number",value:x.receipt_number,onChange:e=>w("receipt_number",e.target.value),placeholder:"رقم الإيصال",className:"flex-1 bg-background border-input text-foreground"}),e.jsx(Lr,{type:"button",variant:"outline",size:"sm",onClick:()=>w("receipt_number",y()),className:"px-3",children:e.jsx(rr,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium",children:"✓ يمكن توليد رقم إيصال جديد تلقائياً"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"description",className:"text-foreground",children:"الوصف"}),e.jsx(wl,{id:"description",value:x.description,onChange:e=>w("description",e.target.value),placeholder:"وصف الدفعة",rows:3,className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"notes",className:"text-foreground",children:"ملاحظات"}),e.jsx(wl,{id:"notes",value:x.notes,onChange:e=>w("notes",e.target.value),placeholder:"ملاحظات إضافية",rows:3,className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})]})]})]}),e.jsxs(Tr,{className:"flex justify-end space-x-3 space-x-reverse border-t border-border pt-4",children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:i,children:"إلغاء"}),e.jsx(Lr,{type:"submit",disabled:i,className:"bg-primary hover:bg-primary/90 text-primary-foreground",children:i?"جاري الحفظ...":"حفظ التغييرات"})]})]})]})})}function Fc({open:t,onOpenChange:n,payment:a}){const{toast:s}=Bl(),{deletePayment:r,isLoading:i}=ca(),{patients:l}=bt();return e.jsx(go,{open:t,onOpenChange:n,children:e.jsxs(yo,{className:"max-w-lg",dir:"rtl",children:[e.jsx(bo,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-destructive/10",children:e.jsx(qa,{className:"h-6 w-6 text-destructive"})}),e.jsxs("div",{children:[e.jsx(wo,{className:"text-lg font-semibold text-destructive",children:"تأكيد حذف الدفعة"}),e.jsx(No,{children:"هذا الإجراء لا يمكن التراجع عنه"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(No,{children:"هل أنت متأكد من رغبتك في حذف هذه الدفعة؟ لا يمكن التراجع عن هذا الإجراء."}),e.jsx(nc,{children:e.jsxs(ic,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(hs,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"تفاصيل الدفعة"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"رقم الإيصال:"}),e.jsx("div",{className:"font-medium",children:a.receipt_number||`#${a.id.slice(-6)}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"المبلغ:"}),e.jsx(oc,{variant:"outline",className:"font-medium",children:Mn(a.amount)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(yr,{className:"w-3 h-3"}),"المريض:"]}),e.jsx("div",{className:"font-medium",children:(e=>{if(e.patient)return`${e.patient.first_name} ${e.patient.last_name}`;const t=l.find(t=>t.id===e.patient_id);return t?`${t.first_name} ${t.last_name}`:"غير محدد"})(a)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"طريقة الدفع:"}),e.jsx(oc,{variant:"secondary",children:(c=a.payment_method,{cash:"نقداً",bank_transfer:"تحويل بنكي"}[c]||c)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(oc,{variant:"outline",children:(o=a.status,{completed:"مكتمل",partial:"جزئي",pending:"معلق"}[o]||o)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(es,{className:"w-3 h-3"}),"تاريخ الدفع:"]}),e.jsx("div",{className:"font-medium",children:In(a.payment_date)})]})]}),a.description&&e.jsx("div",{className:"border-t pt-3 mt-3 space-y-2",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"الوصف:"}),e.jsx("p",{className:"text-sm",children:a.description})]})})]})})]}),e.jsxs(jo,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsx(ko,{disabled:i,children:"إلغاء"}),e.jsx(_o,{onClick:async()=>{try{await r(a.id),s({title:"تم بنجاح",description:"تم حذف الدفعة بنجاح"}),n(!1)}catch(e){s({title:"خطأ",description:"فشل في حذف الدفعة",variant:"destructive"})}},disabled:i,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:i?"جاري الحذف...":"حذف الدفعة"})]})]})});var o,c}function Pc(){const{settings:e,isLoading:t,loadSettings:n}=ta(),[a,s]=re.useState(null),r=re.useRef(null),i=re.useRef(!1);re.useEffect(()=>{if(e){r.current=e,s(e),i.current=!0;try{localStorage.setItem("dental-clinic-settings-backup",JSON.stringify({clinic_name:e.clinic_name||"",doctor_name:e.doctor_name||"",clinic_logo:e.clinic_logo||"",clinic_phone:e.clinic_phone||"",clinic_email:e.clinic_email||"",clinic_address:e.clinic_address||"",backup_timestamp:Date.now()}))}catch(n){console.warn("Failed to save settings backup:",n)}}else if(!i.current&&!t){try{const e=localStorage.getItem("dental-clinic-settings-backup");if(e){const t=JSON.parse(e);t.clinic_name&&(s(t),r.current=t)}}catch(n){console.warn("Failed to restore settings from backup:",n)}i.current=!0}},[e,t]),re.useEffect(()=>{e||t||a||n()},[e,t,a,n]);const l=a||r.current;return{settings:l,isLoading:t&&!l,hasValidSettings:Boolean(l),refreshSettings:n}}function Rc(){const{settings:e}=Pc();return e?.clinic_name||"عيادة الأسنان"}function Oc(){const{settings:e}=Pc();return e?.doctor_name||"د. محمد أحمد"}function Mc(){const{settings:e}=Pc();return e?.clinic_logo||""}function Lc(){const{settings:e}=Pc();return{phone:e?.clinic_phone||"",email:e?.clinic_email||"",address:e?.clinic_address||""}}function Ic({open:t,onOpenChange:n,payment:a}){const{settings:s,loadSettings:r}=ta(),{formatAmount:i}=oa(),l=Rc(),o=Oc(),c=Mc(),{phone:d,email:m,address:u}=Lc(),p=re.useRef(null);re.useEffect(()=>{t&&!s&&r()},[t,s,r]);const[h,x]=re.useState({printerType:"80mm",includeQR:!0,includeBarcode:!0,includeLogo:!0,colorMode:"color",qrType:"text"}),[g,f]=re.useState(!1),[v,y]=re.useState(""),[b,j]=re.useState("");re.useEffect(()=>{const e=async()=>{try{const e=(()=>{const e=a.receipt_number||`RCP-${a.id.slice(-6)}`,t=a.patient?.full_name||"غير محدد",n=In(a.payment_date),s=i(a.amount);let r="";if("partial"===a.status){let e=0;if(a.appointment_id){const t=a.total_amount_due||a.appointment_total_cost||0,n=a.amount_paid||a.amount||0;e=Math.max(0,t-n)}else{const t=a.total_amount_due||a.amount||0,n=a.amount_paid||a.amount||0;e=Math.max(0,t-n)}e>0&&(r=`⚠️ المبلغ المتبقي: ${i(e)}`)}return`🏥 ${l}\n${o?`👨‍⚕️ ${o}`:""}\n\n📋 إيصال دفع رقم: ${e}\n👤 المريض: ${t}\n💰 المبلغ المدفوع: ${s}\n📅 التاريخ: ${n}\n🔄 حالة الدفعة: ${k(a.status)}\n${a.appointment_id?"📅 مرتبطة بموعد: نعم":""}\n${r?`\n${r}`:""}\n\n✅ هذا إيصال رسمي معتمد\n🔒 معرف التحقق: ${a.id.slice(-12)}\n\n${d?`📞 للاستفسار: ${d}`:""}\n${u?`📍 العنوان: ${u}`:""}\n\nشكراً لثقتكم بنا 🙏`})(),t=await at.toDataURL(e,{width:200,margin:1,color:{dark:"#000000",light:"#FFFFFF"}});y(t)}catch(e){console.error("Error generating QR code:",e)}};t&&(h.includeQR&&e(),h.includeBarcode&&(()=>{try{const e=document.createElement("canvas"),t=w();st(e,t,{format:"CODE128",width:2,height:40,displayValue:!1,margin:0,background:"#ffffff",lineColor:"#000000"}),j(e.toDataURL())}catch(e){console.error("Error generating barcode:",e)}})())},[t,h.includeQR,h.includeBarcode,a,s]);const w=()=>`${new Date(a.payment_date).getTime().toString().slice(-8)}${a.patient_id.slice(-4)}${Math.floor(a.amount).toString().padStart(4,"0")}`,N=()=>{if(p.current){const e=window.open("","_blank");if(e){const t="color"===h.colorMode,n="a4"===h.printerType?"210mm":h.printerType;e.document.write(`\n          <html>\n            <head>\n              <title>إيصال دفع - ${a.receipt_number||a.id.slice(-6)}</title>\n              <style>\n                body {\n                  font-family: 'Arial', 'Tahoma', sans-serif;\n                  direction: rtl;\n                  margin: 0;\n                  padding: 0;\n                  font-size: ${"a4"===h.printerType?"14px":"12px"};\n                  line-height: 1.4;\n                  color: #000;\n                  background: white;\n                }\n\n                .receipt {\n                  width: ${"a4"===n?"100%":n};\n                  max-width: ${"a4"===n?"210mm":n};\n                  margin: 0 auto;\n                  background: white;\n                  font-size: ${"a4"===h.printerType?"12px":"11px"};\n                  padding: ${"a4"===h.printerType?"20px":"0"};\n                }\n\n                .header {\n                  text-align: center;\n                  padding: ${"a4"===h.printerType?"20px 10px":"8px 4px"};\n                  background: ${t?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"#f8f9fa"};\n                  color: ${t?"white":"#000"};\n                  border-bottom: 2px solid ${t?"#764ba2":"#000"};\n                  margin-bottom: 8px;\n                  border-radius: ${"a4"===h.printerType?"8px 8px 0 0":"0"};\n                }\n\n                .clinic-logo {\n                  width: ${"a4"===h.printerType?"60px":"45px"};\n                  height: ${"a4"===h.printerType?"60px":"45px"};\n                  margin: 0 auto 6px;\n                  border-radius: 50%;\n                  background: ${t?"rgba(255,255,255,0.15)":"#e9ecef"};\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  font-size: ${"a4"===h.printerType?"20px":"14px"};\n                  font-weight: bold;\n                  color: ${t?"white":"#495057"};\n                  border: 2px solid ${t?"rgba(255,255,255,0.3)":"#dee2e6"};\n                  box-shadow: ${t?"0 2px 8px rgba(0,0,0,0.15)":"0 1px 4px rgba(0,0,0,0.1)"};\n                  overflow: hidden;\n                  flex-shrink: 0;\n                }\n\n                .clinic-logo img {\n                  width: 100%;\n                  height: 100%;\n                  object-fit: cover;\n                  border-radius: 50%;\n                  max-width: ${"a4"===h.printerType?"60px":"45px"};\n                  max-height: ${"a4"===h.printerType?"60px":"45px"};\n                }\n\n                .clinic-name {\n                  font-size: ${"a4"===h.printerType?"20px":"16px"};\n                  font-weight: bold;\n                  margin-bottom: 4px;\n                  text-transform: uppercase;\n                  text-shadow: ${t?"0 1px 2px rgba(0,0,0,0.3)":"none"};\n                }\n\n                .doctor-name {\n                  font-size: ${"a4"===h.printerType?"16px":"13px"};\n                  font-weight: bold;\n                  margin-bottom: 3px;\n                  opacity: ${t?"0.95":"1"};\n                }\n\n                .clinic-info {\n                  font-size: ${"a4"===h.printerType?"12px":"10px"};\n                  margin: 1px 0;\n                  line-height: 1.2;\n                  opacity: ${t?"0.9":"1"};\n                }\n\n                .receipt-title {\n                  font-size: ${"a4"===h.printerType?"18px":"14px"};\n                  font-weight: bold;\n                  text-align: center;\n                  padding: ${"a4"===h.printerType?"12px 0":"6px 0"};\n                  margin: 8px 0;\n                  background: ${t?"linear-gradient(90deg, #f8f9fa, #e9ecef, #f8f9fa)":"#f8f9fa"};\n                  border-top: 1px dashed #000;\n                  border-bottom: 1px dashed #000;\n                  color: #495057;\n                }\n\n                .content {\n                  padding: ${"a4"===h.printerType?"10px":"4px"};\n                }\n\n                .section {\n                  margin-bottom: ${"a4"===h.printerType?"15px":"8px"};\n                }\n\n                .info-row {\n                  display: flex;\n                  justify-content: space-between;\n                  margin: ${"a4"===h.printerType?"6px 0":"3px 0"};\n                  padding: ${"a4"===h.printerType?"4px 0":"2px 0"};\n                  font-size: ${"a4"===h.printerType?"13px":"11px"};\n                  border-bottom: 1px solid #f1f3f4;\n                }\n\n                .label {\n                  font-weight: bold;\n                  flex: 1;\n                  text-align: right;\n                  color: ${t?"#495057":"#000"};\n                }\n\n                .value {\n                  flex: 1;\n                  text-align: left;\n                  font-weight: normal;\n                  color: ${t?"#212529":"#000"};\n                }\n\n                .amount-section {\n                  background: ${t?"linear-gradient(135deg, #f8f9fa, #e9ecef)":"#f8f9fa"};\n                  border: 1px solid ${t?"#dee2e6":"#000"};\n                  border-radius: ${"a4"===h.printerType?"8px":"4px"};\n                  padding: ${"a4"===h.printerType?"15px":"6px"};\n                  margin-top: 8px;\n                }\n\n                .amount-row {\n                  display: flex;\n                  justify-content: space-between;\n                  margin: ${"a4"===h.printerType?"6px 0":"3px 0"};\n                  font-size: ${"a4"===h.printerType?"13px":"11px"};\n                  font-weight: 500;\n                }\n\n                .total-amount {\n                  font-size: ${"a4"===h.printerType?"18px":"14px"};\n                  font-weight: bold;\n                  text-align: center;\n                  padding: ${"a4"===h.printerType?"12px":"6px"};\n                  margin: 6px 0;\n                  background: ${t?"linear-gradient(135deg, #28a745, #20c997)":"#f0f0f0"};\n                  color: ${t?"white":"#000"};\n                  border: 2px solid ${t?"#28a745":"#000"};\n                  border-radius: ${"a4"===h.printerType?"8px":"4px"};\n                  box-shadow: ${t?"0 2px 10px rgba(40, 167, 69, 0.3)":"none"};\n                }\n\n                .qr-section, .barcode-section {\n                  text-align: center;\n                  margin: ${"a4"===h.printerType?"15px 0":"8px 0"};\n                  padding: ${"a4"===h.printerType?"10px":"5px"};\n                  background: ${t?"#f8f9fa":"white"};\n                  border: 1px dashed ${t?"#dee2e6":"#000"};\n                  border-radius: ${"a4"===h.printerType?"6px":"3px"};\n                }\n\n                .qr-placeholder, .barcode-placeholder {\n                  width: ${"a4"===h.printerType?"80px":"60px"};\n                  height: ${"a4"===h.printerType?"80px":"60px"};\n                  margin: 0 auto 5px;\n                  background: ${t?"linear-gradient(45deg, #000, #333)":"#000"};\n                  border-radius: 4px;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  color: white;\n                  font-size: ${"a4"===h.printerType?"10px":"8px"};\n                  font-weight: bold;\n                }\n\n                .barcode-placeholder {\n                  height: ${"a4"===h.printerType?"30px":"20px"};\n                  width: ${"a4"===h.printerType?"120px":"100px"};\n                  border-radius: 2px;\n                }\n\n                .bottom-section {\n                  display: flex;\n                  justify-content: space-between;\n                  align-items: flex-start;\n                  margin: 12px 0;\n                  gap: 15px;\n                  flex-wrap: wrap;\n                }\n\n                .qr-section {\n                  text-align: center;\n                  flex: 1;\n                  min-width: 80px;\n                }\n\n                .signature-section {\n                  flex: 1;\n                  min-width: 120px;\n                  text-align: center;\n                }\n\n                .signature-box {\n                  margin-bottom: 8px;\n                }\n\n                .signature-line {\n                  width: ${"a4"===h.printerType?"100px":"80px"};\n                  height: 1px;\n                  border-bottom: 1px solid #333;\n                  margin: 0 auto 4px;\n                }\n\n                .signature-label {\n                  font-size: ${"a4"===h.printerType?"10px":"8px"};\n                  color: #666;\n                  margin-bottom: 6px;\n                }\n\n                .stamp-box {\n                  margin-top: 6px;\n                }\n\n                .stamp-area {\n                  width: ${"a4"===h.printerType?"80px":"60px"};\n                  height: ${"a4"===h.printerType?"60px":"45px"};\n                  border: 2px dashed #999;\n                  border-radius: 50%;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  margin: 0 auto;\n                  background: rgba(0,0,0,0.02);\n                }\n\n                .stamp-placeholder {\n                  font-size: ${"a4"===h.printerType?"9px":"7px"};\n                  color: #999;\n                  text-align: center;\n                  line-height: 1.2;\n                }\n\n                .footer {\n                  text-align: center;\n                  padding: ${"a4"===h.printerType?"15px 10px":"6px 4px"};\n                  background: ${t?"linear-gradient(135deg, #f8f9fa, #e9ecef)":"#f8f9fa"};\n                  border-top: 2px solid ${t?"#dee2e6":"#000"};\n                  margin-top: 8px;\n                  font-size: ${"a4"===h.printerType?"12px":"10px"};\n                  border-radius: ${"a4"===h.printerType?"0 0 8px 8px":"0"};\n                }\n\n                .thank-you {\n                  font-size: ${"a4"===h.printerType?"16px":"12px"};\n                  font-weight: bold;\n                  margin-bottom: 3px;\n                  color: ${t?"#495057":"#000"};\n                }\n\n                .date-created {\n                  font-size: ${"a4"===h.printerType?"11px":"9px"};\n                  color: ${t?"#6c757d":"#666"};\n                }\n\n                .separator {\n                  text-align: center;\n                  margin: 6px 0;\n                  font-size: 16px;\n                  letter-spacing: 2px;\n                  color: ${t?"#dee2e6":"#000"};\n                }\n\n                /* Print optimizations */\n                @media print {\n                  body {\n                    margin: 0 !important;\n                    padding: 0 !important;\n                    background: white !important;\n                  }\n\n                  .receipt {\n                    box-shadow: none !important;\n                    border: none !important;\n                    margin: 0 !important;\n                  }\n\n                  .no-print {\n                    display: none !important;\n                  }\n\n                  .info-row, .amount-row {\n                    page-break-inside: avoid;\n                  }\n\n                  ${t?"\n                    .header {\n                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;\n                      color: white !important;\n                      -webkit-print-color-adjust: exact;\n                    }\n                    .total-amount {\n                      background: linear-gradient(135deg, #28a745, #20c997) !important;\n                      color: white !important;\n                      -webkit-print-color-adjust: exact;\n                    }\n                  ":""}\n                }\n\n                /* Screen display styles */\n                @media screen {\n                  body {\n                    padding: 20px;\n                    background: #f5f5f5;\n                  }\n\n                  .receipt {\n                    max-width: ${"a4"===h.printerType?"600px":"320px"};\n                    box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n                    border-radius: 12px;\n                    overflow: hidden;\n                    background: white;\n                    margin: 0 auto;\n                  }\n                }\n              </style>\n            </head>\n            <body>\n              ${p.current.innerHTML}\n            </body>\n          </html>\n        `),e.document.close(),e.print()}}},_=e=>({cash:"نقداً",card:"بطاقة ائتمان",bank_transfer:"تحويل بنكي",check:"شيك",insurance:"تأمين"}[e]||e),k=e=>({completed:"مكتمل",pending:"معلق",partial:"جزئي",overdue:"متأخر",failed:"فاشل",refunded:"مسترد"}[e]||e);return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center text-xl font-semibold",children:[e.jsx(Xs,{className:"w-5 h-5 ml-2"}),"إيصال الدفع"]}),e.jsxs(Fr,{children:["إيصال رقم ",a.receipt_number||a.id.slice(-6)]})]}),e.jsxs("div",{ref:p,className:"receipt",children:[e.jsxs("div",{className:"header",children:[h.includeLogo&&e.jsx("div",{className:"clinic-logo",style:{width:"60px",height:"60px",margin:"0 auto 8px",borderRadius:"50%",overflow:"hidden",border:"2px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",background:"#f8f9fa"},children:c&&""!==c.trim()?e.jsx("img",{src:c,alt:"شعار العيادة",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%",maxWidth:"60px",maxHeight:"60px"},onError:e=>{console.log("Logo failed to load:",c),e.currentTarget.style.display="none"}}):e.jsx("span",{style:{fontSize:"20px",fontWeight:"bold",color:"#495057"},children:l.charAt(0)})}),e.jsx("div",{className:"clinic-name",children:l}),o&&e.jsx("div",{className:"doctor-name",children:o}),d&&e.jsxs("div",{className:"clinic-info",children:["📞 ",d]}),u&&e.jsxs("div",{className:"clinic-info",children:["📍 ",u]}),m&&e.jsxs("div",{className:"clinic-info",children:["✉️ ",m]})]}),e.jsx("div",{className:"separator",children:"═══════════════════"}),e.jsxs("div",{className:"receipt-title",children:["إيصال دفع رقم ",a.receipt_number||`RCP-${a.id.slice(-6)}`]}),e.jsxs("div",{className:"content",children:[e.jsxs("div",{className:"section",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"التاريخ:"}),e.jsx("span",{className:"value",children:In(a.payment_date)})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"الوقت:"}),e.jsx("span",{className:"value",children:new Date(a.payment_date).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!0})})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"المريض:"}),e.jsx("span",{className:"value",children:a.patient?a.patient.full_name||`${a.patient.first_name||""} ${a.patient.last_name||""}`.trim():"غير محدد"})]}),a.patient?.phone&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"الهاتف:"}),e.jsx("span",{className:"value",children:a.patient.phone})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"طريقة الدفع:"}),e.jsx("span",{className:"value",children:_(a.payment_method)})]}),a.description&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"الوصف:"}),e.jsx("span",{className:"value",children:a.description})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"حالة الدفعة:"}),e.jsx("span",{className:"value",children:k(a.status)})]}),a.appointment_id&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"مرتبطة بموعد:"}),e.jsx("span",{className:"value",children:"نعم"})]})]}),e.jsx("div",{className:"separator",children:"- - - - - - - - - - - - - - - -"}),e.jsxs("div",{className:"amount-section",children:[e.jsxs("div",{className:"amount-row",children:[e.jsx("span",{children:"المبلغ المدفوع في هذه الدفعة:"}),e.jsx("span",{children:i(a.amount)})]}),a.discount_amount&&a.discount_amount>0&&e.jsxs("div",{className:"amount-row",children:[e.jsx("span",{children:"الخصم:"}),e.jsxs("span",{children:["-",i(a.discount_amount)]})]}),a.tax_amount&&a.tax_amount>0&&e.jsxs("div",{className:"amount-row",children:[e.jsx("span",{children:"الضريبة:"}),e.jsxs("span",{children:["+",i(a.tax_amount)]})]}),"partial"===a.status&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"separator",children:"- - - - - - - - - - - - - - - -"}),(a.total_amount_due||a.appointment_total_cost)&&e.jsxs("div",{className:"amount-row",children:[e.jsx("span",{children:"إجمالي المبلغ المطلوب:"}),e.jsx("span",{children:i(a.total_amount_due||a.appointment_total_cost||0)})]}),a.amount_paid&&e.jsxs("div",{className:"amount-row",children:[e.jsx("span",{children:"إجمالي المبلغ المدفوع:"}),e.jsx("span",{children:i(a.amount_paid)})]}),(()=>{let t=0;if(a.appointment_id){const e=a.total_amount_due||a.appointment_total_cost||0,n=a.amount_paid||a.amount||0;t=Math.max(0,e-n)}else{const e=a.total_amount_due||a.amount||0,n=a.amount_paid||a.amount||0;t=Math.max(0,e-n)}return t>0?e.jsxs("div",{className:"amount-row",style:{color:"#dc3545",fontWeight:"bold"},children:[e.jsx("span",{children:"المبلغ المتبقي:"}),e.jsx("span",{children:i(t)})]}):null})()]}),e.jsx("div",{className:"separator",children:"═══════════════════"}),e.jsxs("div",{className:"total-amount",children:["المبلغ الإجمالي لهذه الدفعة: ",i(a.total_amount||a.amount+(a.tax_amount||0)-(a.discount_amount||0))]})]}),e.jsxs("div",{className:"bottom-section",children:[h.includeQR&&e.jsxs("div",{className:"qr-section",children:[v?e.jsx("img",{src:v,alt:"QR Code للتحقق من الإيصال",style:{width:"a4"===h.printerType?"80px":"60px",height:"a4"===h.printerType?"80px":"60px",margin:"0 auto"}}):e.jsx("div",{className:"qr-placeholder",children:"QR"}),e.jsx("div",{style:{fontSize:"8px",color:"#666",marginTop:"4px"},children:"امسح للتحقق من الإيصال"})]}),e.jsxs("div",{className:"signature-section",children:[e.jsxs("div",{className:"signature-box",children:[e.jsx("div",{className:"signature-line"}),e.jsx("div",{className:"signature-label",children:"توقيع الطبيب"})]}),e.jsx("div",{className:"stamp-box",children:e.jsx("div",{className:"stamp-area",children:e.jsx("div",{className:"stamp-placeholder",children:"ختم العيادة"})})})]})]}),h.includeBarcode&&e.jsxs("div",{className:"barcode-section",children:[b?e.jsx("img",{src:b,alt:"باركود الإيصال",style:{width:"a4"===h.printerType?"120px":"100px",height:"a4"===h.printerType?"30px":"20px",margin:"0 auto"}}):e.jsx("div",{className:"barcode-placeholder",children:w()}),e.jsx("div",{style:{fontSize:"8px",color:"#666",marginTop:"2px"},children:w()})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"separator",children:"- - - - - - - - - - - - - - - -"}),e.jsxs("div",{style:{fontSize:"9px",color:"#666",textAlign:"center",margin:"4px 0"},children:[e.jsxs("div",{children:["معرف الدفعة: ",a.id.slice(-8)]}),e.jsxs("div",{children:["طريقة الدفع: ",_(a.payment_method)]}),"partial"===a.status&&e.jsx("div",{style:{color:"#dc3545",fontWeight:"bold"},children:"⚠️ دفعة جزئية - يرجى الاحتفاظ بالإيصال"}),e.jsxs("div",{style:{marginTop:"4px"},children:["تاريخ الطباعة: ",(new Date).toLocaleDateString("ar-SA")," - ",(new Date).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})]})]})]})]}),e.jsxs("div",{className:"footer",children:[e.jsx("div",{className:"separator",children:"═══════════════════"}),e.jsx("div",{className:"thank-you",children:"شكراً لثقتكم بنا"}),e.jsxs("div",{className:"date-created",children:["تم الإنشاء: ",In((new Date).toISOString())]}),e.jsx("div",{className:"separator",children:"═══════════════════"})]})]}),e.jsxs("div",{className:"border-t bg-muted/30 p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center",children:[e.jsx(nr,{className:"w-4 h-4 ml-2"}),"إعدادات الطباعة"]}),e.jsxs(Lr,{variant:"ghost",size:"sm",onClick:()=>f(!g),className:"text-xs",children:[e.jsx(ys,{className:"w-3 h-3 ml-1"}),g?"إخفاء المعاينة":"معاينة"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"نوع الطابعة"}),e.jsxs(Nl,{value:h.printerType,onValueChange:e=>x(t=>({...t,printerType:e})),children:[e.jsx(Sl,{className:"h-8 text-xs",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"58mm",children:"حرارية 58mm"}),e.jsx(Al,{value:"80mm",children:"حرارية 80mm"}),e.jsx(Al,{value:"a4",children:"عادية A4"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"نمط الألوان"}),e.jsxs(Nl,{value:h.colorMode,onValueChange:e=>x(t=>({...t,colorMode:e})),children:[e.jsx(Sl,{className:"h-8 text-xs",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"color",children:"ملون"}),e.jsx(Al,{value:"bw",children:"أبيض وأسود"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("input",{type:"checkbox",id:"includeLogo",checked:h.includeLogo,onChange:e=>x(t=>({...t,includeLogo:e.target.checked})),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"includeLogo",className:"text-xs font-medium",children:"تضمين الشعار"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("input",{type:"checkbox",id:"includeQR",checked:h.includeQR,onChange:e=>x(t=>({...t,includeQR:e.target.checked})),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"includeQR",className:"text-xs font-medium",children:"QR Code"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("input",{type:"checkbox",id:"includeBarcode",checked:h.includeBarcode,onChange:e=>x(t=>({...t,includeBarcode:e.target.checked})),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"includeBarcode",className:"text-xs font-medium",children:"تضمين الباركود"})]})]}),e.jsxs(Tr,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsx(Lr,{variant:"outline",onClick:()=>n(!1),children:"إغلاق"}),e.jsxs(Lr,{variant:"outline",onClick:()=>{N()},children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تحميل PDF"]}),e.jsxs(Lr,{variant:"outline",onClick:()=>{if(p.current){const e=window.open("","_blank");e&&(e.document.write(`\n          <html>\n            <head>\n              <title>إيصال حراري - ${a.receipt_number||a.id.slice(-6)}</title>\n              <style>\n                @page {\n                  size: 80mm auto;\n                  margin: 0;\n                }\n                body {\n                  font-family: 'Courier New', monospace;\n                  direction: rtl;\n                  margin: 0;\n                  padding: 2mm;\n                  font-size: 10px;\n                  line-height: 1.2;\n                  color: #000;\n                  background: white;\n                  width: 76mm;\n                }\n                .receipt {\n                  width: 100%;\n                  font-size: 10px;\n                }\n                .header {\n                  text-align: center;\n                  margin-bottom: 4px;\n                  border-bottom: 1px solid #000;\n                  padding-bottom: 2px;\n                }\n                .clinic-name {\n                  font-size: 12px;\n                  font-weight: bold;\n                  margin-bottom: 1px;\n                }\n                .doctor-name {\n                  font-size: 10px;\n                  font-weight: bold;\n                }\n                .clinic-info {\n                  font-size: 8px;\n                  margin: 0;\n                }\n                .receipt-title {\n                  font-size: 11px;\n                  font-weight: bold;\n                  text-align: center;\n                  margin: 3px 0;\n                  border-top: 1px dashed #000;\n                  border-bottom: 1px dashed #000;\n                  padding: 2px 0;\n                }\n                .info-row, .amount-row {\n                  display: flex;\n                  justify-content: space-between;\n                  margin: 1px 0;\n                  font-size: 9px;\n                }\n                .separator {\n                  text-align: center;\n                  margin: 2px 0;\n                  font-size: 8px;\n                }\n                .total-amount {\n                  font-size: 11px;\n                  font-weight: bold;\n                  text-align: center;\n                  margin: 3px 0;\n                  border: 1px solid #000;\n                  padding: 2px;\n                }\n                .footer {\n                  text-align: center;\n                  margin-top: 4px;\n                  border-top: 1px solid #000;\n                  padding-top: 2px;\n                  font-size: 8px;\n                }\n                .thank-you {\n                  font-size: 9px;\n                  font-weight: bold;\n                }\n                .bottom-section {\n                  display: flex;\n                  justify-content: space-between;\n                  align-items: flex-start;\n                  margin: 4px 0;\n                  gap: 6px;\n                  flex-wrap: wrap;\n                }\n                .qr-section {\n                  text-align: center;\n                  flex: 1;\n                  min-width: 50px;\n                }\n                .signature-section {\n                  flex: 1;\n                  min-width: 70px;\n                  text-align: center;\n                }\n                .signature-line {\n                  width: 50px;\n                  height: 1px;\n                  border-bottom: 1px solid #000;\n                  margin: 0 auto 2px;\n                }\n                .signature-label {\n                  font-size: 6px;\n                  margin-bottom: 2px;\n                }\n                .stamp-area {\n                  width: 35px;\n                  height: 25px;\n                  border: 1px dashed #000;\n                  border-radius: 50%;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  margin: 0 auto;\n                  background: rgba(0,0,0,0.02);\n                }\n                .stamp-placeholder {\n                  font-size: 5px;\n                  text-align: center;\n                  line-height: 1.1;\n                }\n              </style>\n            </head>\n            <body>\n              ${p.current.innerHTML}\n            </body>\n          </html>\n        `),e.document.close(),e.print())}},className:"bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-200",children:[e.jsx(Qs,{className:"w-4 h-4 ml-2"}),"طباعة حرارية"]}),e.jsxs(Lr,{onClick:N,className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(Qs,{className:"w-4 h-4 ml-2"}),"طباعة ذكية"]})]})]})})}function zc({open:t,onOpenChange:n,payment:a,patients:s}){const{formatAmount:r}=oa();if(!a)return null;const i=s.find(e=>e.id===a.patient_id);return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-background border-border shadow-2xl",dir:"rtl",children:[e.jsxs(Er,{className:"border-b border-border pb-4",children:[e.jsxs(Ar,{className:"flex items-center text-xl font-semibold text-foreground",children:[e.jsx(ys,{className:"w-5 h-5 ml-2 text-primary"}),"تفاصيل الدفعة"]}),e.jsxs(Fr,{className:"text-muted-foreground",children:["عرض تفاصيل شاملة للدفعة رقم ",a.receipt_number||a.id.slice(-6)]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(yr,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات المريض"]})}),e.jsxs(ic,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"الاسم:"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:i?.full_name||"غير محدد"})]}),i?.phone&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"الهاتف:"}),e.jsx("span",{className:"text-sm text-foreground",children:i.phone})]}),i?.date_of_birth&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"تاريخ الميلاد:"}),e.jsx("span",{className:"text-sm text-foreground",children:In(i.date_of_birth)})]})]})]}),e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(hs,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات الدفعة"]})}),e.jsxs(ic,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"رقم الإيصال:"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:a.receipt_number||a.id.slice(-6)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"تاريخ الدفع:"}),e.jsx("span",{className:"text-sm text-foreground",children:In(a.payment_date)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"طريقة الدفع:"}),e.jsx(oc,{variant:"outline",className:"text-xs",children:(e=>{switch(e){case"cash":return"نقدي";case"bank_transfer":return"تحويل بنكي";default:return e}})(a.payment_method)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"الحالة:"}),(t=>{switch(t){case"completed":return e.jsxs(oc,{variant:"default",className:"bg-green-100 text-green-800 border-green-200",children:[e.jsx(ns,{className:"w-3 h-3 ml-1"}),"مكتملة"]});case"partial":return e.jsxs(oc,{variant:"default",className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:[e.jsx(Ya,{className:"w-3 h-3 ml-1"}),"جزئية"]});case"pending":return e.jsxs(oc,{variant:"default",className:"bg-orange-100 text-orange-800 border-orange-200",children:[e.jsx(us,{className:"w-3 h-3 ml-1"}),"معلقة"]});default:return e.jsx(oc,{variant:"outline",children:t})}})(a.status)]})]})]})]}),e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(gs,{className:"w-4 h-4 ml-2 text-primary"}),"التفاصيل المالية"]})}),e.jsx(ic,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:r(a.amount)}),e.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400 mt-1",children:"المبلغ المدفوع"})]}),a.discount_amount&&a.discount_amount>0&&e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-950/30 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:r(a.discount_amount)}),e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:"الخصم"})]}),a.tax_amount&&a.tax_amount>0&&e.jsxs("div",{className:"text-center p-4 bg-orange-50 dark:bg-orange-950/30 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:r(a.tax_amount)}),e.jsx("div",{className:"text-sm text-orange-600 dark:text-orange-400 mt-1",children:"الضريبة"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 dark:bg-purple-950/30 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:r(a.total_amount||a.amount+(a.tax_amount||0)-(a.discount_amount||0))}),e.jsx("div",{className:"text-sm text-purple-600 dark:text-purple-400 mt-1",children:"المبلغ الإجمالي"})]})]})})]}),a.tooth_treatment&&e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(Va,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات العلاج"]})}),e.jsxs(ic,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"نوع العلاج:"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:Fa(a.tooth_treatment.treatment_type)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"رقم السن:"}),e.jsx("span",{className:"text-sm text-foreground",children:a.tooth_treatment.tooth_number})]}),a.tooth_treatment.tooth_name&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"اسم السن:"}),e.jsx("span",{className:"text-sm text-foreground",children:a.tooth_treatment.tooth_name})]}),a.tooth_treatment.cost&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"تكلفة العلاج:"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:r(a.tooth_treatment.cost)})]})]})]}),a.appointment&&e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(es,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات الموعد"]})}),e.jsxs(ic,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"تاريخ الموعد:"}),e.jsx("span",{className:"text-sm text-foreground",children:In(a.appointment.appointment_date)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"الوقت:"}),e.jsx("span",{className:"text-sm text-foreground",children:a.appointment.appointment_time})]}),a.appointment.notes&&e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ملاحظات:"}),e.jsx("span",{className:"text-sm text-foreground text-right max-w-xs",children:a.appointment.notes})]})]})]}),(a.description||a.notes)&&e.jsxs(nc,{className:"border-border bg-card shadow-sm",children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(bs,{className:"w-4 h-4 ml-2 text-primary"}),"ملاحظات إضافية"]})}),e.jsxs(ic,{className:"space-y-3",children:[a.description&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground block mb-1",children:"الوصف:"}),e.jsx("p",{className:"text-sm text-foreground bg-muted/30 p-3 rounded border",children:a.description})]}),a.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground block mb-1",children:"ملاحظات:"}),e.jsx("p",{className:"text-sm text-foreground bg-muted/30 p-3 rounded border",children:a.notes})]})]})]}),e.jsxs(nc,{className:"border-border bg-muted/30 shadow-sm",children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"flex items-center text-lg text-card-foreground",children:[e.jsx(us,{className:"w-4 h-4 ml-2 text-primary"}),"معلومات النظام"]})}),e.jsxs(ic,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"تاريخ الإنشاء:"}),e.jsx("span",{className:"text-sm text-foreground",children:In(a.created_at)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"آخر تحديث:"}),e.jsx("span",{className:"text-sm text-foreground",children:In(a.updated_at)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"معرف الدفعة:"}),e.jsx("span",{className:"text-xs font-mono text-foreground bg-background px-2 py-1 rounded border",children:a.id})]})]})]})]})]})})}const Bc=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:En("w-full caption-bottom text-sm",t),...n})}));Bc.displayName="Table";const Vc=re.forwardRef(({className:t,...n},a)=>e.jsx("thead",{ref:a,className:En("[&_tr]:border-b",t),...n}));Vc.displayName="TableHeader";const Yc=re.forwardRef(({className:t,...n},a)=>e.jsx("tbody",{ref:a,className:En("[&_tr:last-child]:border-0",t),...n}));Yc.displayName="TableBody";re.forwardRef(({className:t,...n},a)=>e.jsx("tfoot",{ref:a,className:En("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...n})).displayName="TableFooter";const qc=re.forwardRef(({className:t,...n},a)=>e.jsx("tr",{ref:a,className:En("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...n}));qc.displayName="TableRow";const Uc=re.forwardRef(({className:t,...n},a)=>e.jsx("th",{ref:a,className:En("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n}));Uc.displayName="TableHead";const Hc=re.forwardRef(({className:t,...n},a)=>e.jsx("td",{ref:a,className:En("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n}));Hc.displayName="TableCell";function Gc({payments:t,patients:n,isLoading:a,onEdit:s,onDelete:r,onShowReceipt:i,onViewDetails:l}){const[o,c]=re.useState("payment_date"),[d,m]=re.useState("desc"),[u,p]=re.useState(1),[h,x]=re.useState(10),g=re.useMemo(()=>{const e=new Map;return n.forEach(t=>{e.set(t.id,t)}),e},[n]),f=e=>{if(e.patient?.full_name)return e.patient.full_name;if(e.patient?.first_name||e.patient?.last_name)return`${e.patient.first_name||""} ${e.patient.last_name||""}`.trim();const t=g.get(e.patient_id);return t?.full_name||"مريض غير معروف"},v=re.useMemo(()=>{let e=[...t];return e.sort((e,t)=>{let n,a;switch(o){case"patient_name":n=f(e),a=f(t);break;case"payment_date":n=new Date(e.payment_date),a=new Date(t.payment_date);break;case"amount":n=e.amount,a=t.amount;break;case"payment_method":n=e.payment_method,a=t.payment_method;break;case"status":n=e.status,a=t.status;break;case"receipt_number":n=e.receipt_number||"",a=t.receipt_number||"";break;default:return 0}return n<a?"asc"===d?-1:1:n>a?"asc"===d?1:-1:0}),e},[t,o,d,g]),y=Math.ceil(v.length/h),b=(u-1)*h,j=v.slice(b,b+h),w=({field:t,children:n})=>e.jsx(Uc,{className:"cursor-pointer hover:bg-muted/50 text-center",onClick:()=>(e=>{o===e?m("asc"===d?"desc":"asc"):(c(e),m("asc"))})(t),children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[n,o===t?"asc"===d?e.jsx(Wa,{className:"w-4 h-4"}):e.jsx(Ua,{className:"w-4 h-4"}):e.jsx(Ga,{className:"w-4 h-4 opacity-50"})]})}),N=t=>{const n={completed:{label:"مكتمل",variant:"default"},partial:{label:"جزئي",variant:"outline"},pending:{label:"معلق",variant:"secondary"}}[t]||{label:t,variant:"outline"};return e.jsx(oc,{variant:n.variant,children:n.label})};return a?e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Bc,{children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{children:"رقم الإيصال"}),e.jsx(Uc,{children:"المريض"}),e.jsx(Uc,{children:"المبلغ"}),e.jsx(Uc,{children:"طريقة الدفع"}),e.jsx(Uc,{children:"الحالة"}),e.jsx(Uc,{children:"تاريخ الدفع"}),e.jsx(Uc,{children:"الإجراءات"})]})}),e.jsx(Yc,{children:[...Array(5)].map((t,n)=>e.jsx(qc,{children:[...Array(7)].map((t,n)=>e.jsx(Hc,{children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded"})},n))},n))})]})}):0===v.length?e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-center",children:"#"}),e.jsx(w,{field:"patient_name",children:"المريض"}),e.jsx(Uc,{className:"text-center",children:"العلاج/الموعد"}),e.jsx(w,{field:"amount",children:"المبلغ والرصيد"}),e.jsx(w,{field:"payment_method",children:"طريقة الدفع"}),e.jsx(w,{field:"status",children:"الحالة"}),e.jsx(w,{field:"payment_date",children:"تاريخ الدفع"}),e.jsx(Uc,{className:"text-center",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الإجراءات"})})]})}),e.jsx(Yc,{children:e.jsx(qc,{children:e.jsx(Hc,{colSpan:8,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(gs,{className:"w-12 h-12 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"لم يتم تسجيل أي مدفوعات بعد"})]})})})})]})}):e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{className:"bg-muted/50",children:[e.jsx(Uc,{className:"text-center",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"#"})}),e.jsx(w,{field:"patient_name",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"المريض"})}),e.jsx(Uc,{className:"text-center",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"العلاج/الموعد"})}),e.jsx(w,{field:"amount",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"المبلغ والرصيد"})}),e.jsx(w,{field:"payment_method",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"طريقة الدفع"})}),e.jsx(w,{field:"status",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الحالة"})}),e.jsx(w,{field:"payment_date",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"تاريخ الدفع"})}),e.jsx(Uc,{className:"text-center",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الإجراءات"})})]})}),e.jsx(Yc,{children:j.map((t,n)=>{return e.jsxs(qc,{className:"hover:bg-muted/50",children:[e.jsx(Hc,{className:"font-medium text-center",children:b+n+1}),e.jsx(Hc,{className:"font-medium text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:f(t).charAt(0)}),e.jsx("span",{className:"arabic-enhanced",children:f(t)})]})}),e.jsx(Hc,{className:"text-center",children:t.tooth_treatment_id?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-sm font-medium arabic-enhanced text-blue-600 dark:text-blue-400",children:["السن ",t.tooth_treatment?.tooth_number]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Fa(t.tooth_treatment?.treatment_type||"")}),t.treatment_total_cost&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["تكلفة: ",Mn(t.treatment_total_cost)]}),void 0!==t.treatment_remaining_balance&&t.treatment_remaining_balance>0&&e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["متبقي: ",Mn(t.treatment_remaining_balance)]})]}):t.appointment_id?e.jsxs("div",{className:"space-y-1",children:[(()=>{const n=t.appointment?.start_time;if(n)try{const t=new Date(n);if(!isNaN(t.getTime()))return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium arabic-enhanced",children:t.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!0})})]})}catch(a){console.error("Error parsing appointment date:",a)}return e.jsx("div",{className:"text-sm font-medium arabic-enhanced",children:"موعد محدد"})})(),t.appointment_total_cost&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["تكلفة: ",Mn(t.appointment_total_cost)]}),void 0!==t.appointment_remaining_balance&&t.appointment_remaining_balance>0&&e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["متبقي: ",Mn(t.appointment_remaining_balance)]})]}):e.jsx("div",{className:"text-sm text-muted-foreground arabic-enhanced",children:"دفعة عامة"})}),e.jsx(Hc,{className:"text-center",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-lg",children:Mn(t.amount)}),t.tooth_treatment_id?e.jsxs(e.Fragment,{children:[t.treatment_total_cost&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["من أصل ",Mn(t.treatment_total_cost)]}),t.treatment_total_paid&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:["إجمالي مدفوع: ",Mn(t.treatment_total_paid)]}),t.treatment_remaining_balance&&t.treatment_remaining_balance>0&&e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["متبقي: ",Mn(t.treatment_remaining_balance)]})]}):t.appointment_id?e.jsxs(e.Fragment,{children:[t.total_amount_due&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["من أصل ",Mn(t.total_amount_due)]}),t.total_amount_due&&t.amount_paid&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:["إجمالي مدفوع: ",Mn(t.amount_paid)]}),t.remaining_balance&&t.remaining_balance>0&&e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["متبقي: ",Mn(t.remaining_balance)]})]}):e.jsxs(e.Fragment,{children:[t.total_amount_due&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["من أصل ",Mn(t.total_amount_due)]}),t.total_amount_due&&(()=>{const n=t.total_amount_due||0,a=t.amount||0,s=Math.max(0,n-a);return s>0&&e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["متبقي: ",Mn(s)]})})()]})]})}),e.jsx(Hc,{className:"text-center",children:e.jsx(oc,{variant:"outline",className:"arabic-enhanced",children:(a=t.payment_method,{cash:"نقداً",bank_transfer:"تحويل بنكي"}[a]||a)})}),e.jsx(Hc,{className:"text-center",children:N(t.status)}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"text-sm arabic-enhanced",children:In(t.payment_date)})}),e.jsx(Hc,{className:"min-w-[220px] text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-details text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>l(t),title:"عرض التفاصيل",children:[e.jsx(ys,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"تفاصيل"})]}),e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-receipt",onClick:()=>i(t),children:[e.jsx(Qs,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"إيصال"})]}),e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:()=>s(t),children:[e.jsx(Us,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:()=>r(t),children:[e.jsx(dr,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]})]})})]},t.id);var a})})]})})}),v.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:e.jsxs("p",{className:"text-sm text-muted-foreground arabic-enhanced",children:["عرض ",b+1," إلى ",Math.min(b+h,v.length)," من ",v.length," مدفوعة"]})}),e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(Nl,{value:`${h}`,onValueChange:e=>{x(Number(e)),p(1)},children:[e.jsx(Sl,{className:"h-8 w-[70px]",children:e.jsx(kl,{placeholder:h})}),e.jsx(Dl,{side:"top",children:[5,10,20,30,50].map(t=>e.jsx(Al,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",u," من ",y]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>p(1),disabled:1===u,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(cs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>p(u-1),disabled:1===u,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(is,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>p(u+1),disabled:u===y,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(rs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>p(y),disabled:u===y,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(os,{className:"h-4 w-4"})]})]})]})]})]})}re.forwardRef(({className:t,...n},a)=>e.jsx("caption",{ref:a,className:En("mt-4 text-sm text-muted-foreground",t),...n})).displayName="TableCaption";const Wc=new class{getIcon(t,n){if(n)switch(n){case"save":return e.jsx(er,{className:"w-4 h-4"});case"delete":return e.jsx(dr,{className:"w-4 h-4"});case"export":case"backup":return e.jsx(fs,{className:"w-4 h-4"});case"import":case"restore":return e.jsx(hr,{className:"w-4 h-4"});case"update":return e.jsx(Js,{className:"w-4 h-4"})}switch(t){case"success":return e.jsx(ns,{className:"w-4 h-4"});case"error":return e.jsx(Nr,{className:"w-4 h-4"});case"warning":return e.jsx(qa,{className:"w-4 h-4"});default:return e.jsx(Cs,{className:"w-4 h-4"})}}getDefaultTitle(e,t){if(t)switch(t){case"save":return"success"===e?"تم الحفظ بنجاح":"error"===e?"فشل في الحفظ":"جاري الحفظ...";case"delete":return"success"===e?"تم الحذف بنجاح":"error"===e?"فشل في الحذف":"جاري الحذف...";case"export":return"success"===e?"تم التصدير بنجاح":"error"===e?"فشل في التصدير":"جاري التصدير...";case"import":return"success"===e?"تم الاستيراد بنجاح":"error"===e?"فشل في الاستيراد":"جاري الاستيراد...";case"backup":return"success"===e?"تم إنشاء النسخة الاحتياطية":"error"===e?"فشل في إنشاء النسخة الاحتياطية":"جاري إنشاء النسخة الاحتياطية...";case"restore":return"success"===e?"تم استعادة النسخة الاحتياطية":"error"===e?"فشل في استعادة النسخة الاحتياطية":"جاري استعادة النسخة الاحتياطية...";case"update":return"success"===e?"تم التحديث بنجاح":"error"===e?"فشل في التحديث":"جاري التحديث...";case"create":return"success"===e?"تم الإنشاء بنجاح":"error"===e?"فشل في الإنشاء":"جاري الإنشاء..."}switch(e){case"success":return"نجح";case"error":return"خطأ";case"warning":return"تحذير";case"info":return"معلومات";case"loading":return"جاري التحميل...";default:return"إشعار"}}getVariant(e){return"error"===e?"destructive":"default"}show(t){const{title:n,description:a,type:s,action:r,duration:i=3e3,showIcon:l=!0,actionButton:o}=t,c=n||this.getDefaultTitle(s,r),d=l?this.getIcon(s,r):null;return zl({title:e.jsxs("div",{className:"flex items-center gap-2 text-right",dir:"rtl",children:[d,e.jsx("span",{children:c})]}),description:e.jsx("div",{className:"text-right mt-1",dir:"rtl",children:a}),variant:this.getVariant(s),duration:"loading"===s?0:i,action:o?e.jsx("button",{onClick:o.onClick,className:"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring",children:o.label}):void 0})}success(e,t,n){return this.show({description:e,type:"success",action:t,...n})}error(e,t,n){return this.show({description:e,type:"error",action:t,...n})}warning(e,t,n){return this.show({description:e,type:"warning",action:t,...n})}info(e,t,n){return this.show({description:e,type:"info",action:t,...n})}loading(e,t,n){return this.show({description:e,type:"loading",action:t,...n})}saveSuccess(e="تم حفظ البيانات بنجاح"){return this.success(e,"save")}saveError(e="فشل في حفظ البيانات"){return this.error(e,"save")}deleteSuccess(e="تم حذف العنصر بنجاح"){return this.success(e,"delete")}deleteError(e="فشل في حذف العنصر"){return this.error(e,"delete")}exportSuccess(e="تم تصدير البيانات بنجاح"){return this.success(e,"export")}exportError(e="فشل في تصدير البيانات"){return this.error(e,"export")}noDataToExport(e="لا توجد بيانات للتصدير"){return this.warning(e,"export")}backupSuccess(e="تم إنشاء النسخة الاحتياطية بنجاح"){return this.success(e,"backup")}backupError(e="فشل في إنشاء النسخة الاحتياطية"){return this.error(e,"backup")}restoreSuccess(e="تم استعادة النسخة الاحتياطية بنجاح"){return this.success(e,"restore")}restoreError(e="فشل في استعادة النسخة الاحتياطية"){return this.error(e,"restore")}testSuccess(e="نجح الاختبار بنجاح"){return this.success(e,"update")}testError(e="فشل الاختبار"){return this.error(e,"update")}},Kc=Wc;let Zc=class{static generateFileName(e,t,n){const a=new Date,s=`${a.getDate().toString().padStart(2,"0")}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getFullYear()}`,r=a.toTimeString().split(" ")[0].replace(/:/g,"-");let i=`${{patients:"تقرير_المرضى",appointments:"تقرير_المواعيد",financial:"التقرير_المالي",inventory:"تقرير_المخزون",analytics:"تقرير_التحليلات",overview:"التقرير_الشامل",comprehensive:"التقرير_الشامل_المفصل",treatments:"تقرير_العلاجات"}[e]||`تقرير_${e}`}_${s}`;return n?.includeTime&&(i+=`_${r}`),n?.customSuffix&&(i+=`_${n.customSuffix}`),`${i}.${t}`}static async exportReport(e,t,n){try{switch(n.format){case"pdf":return await this.exportToPDF(e,t,n);case"excel":return await this.exportToExcel(e,t,n);case"csv":return await this.exportToCSV(e,t,n);default:throw new Error("Unsupported export format")}}catch(a){throw console.error("Export error:",a),a}}static async exportToPDF(e,t,n){try{const a=this.createReportHTML(e,t,n),s=this.generateFileName(e,"pdf",{includeTime:!0});return await this.convertHTMLToPDF(a,s),s}catch(a){throw console.error("Error exporting to PDF:",a),new Error("فشل في تصدير التقرير إلى PDF")}}static async convertHTMLToPDF(e,t){try{const n=document.createElement("div");n.innerHTML=e,n.style.position="absolute",n.style.left="-9999px",n.style.top="-9999px",n.style.width="800px",n.style.fontFamily="Arial, sans-serif",n.style.direction="rtl",n.style.fontSize="14px",n.style.lineHeight="1.6",n.style.color="#000",n.style.background="#fff",n.style.padding="20px",document.body.appendChild(n),await new Promise(e=>setTimeout(e,100));const a=await rt(n,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:800,height:n.scrollHeight,scrollX:0,scrollY:0});document.body.removeChild(n);const s=a.toDataURL("image/png"),r=new it({orientation:"portrait",unit:"mm",format:"a4"}),i=r.internal.pageSize.getWidth(),l=r.internal.pageSize.getHeight(),o=i-20,c=a.height*o/a.width;let d=c,m=10;for(r.addImage(s,"PNG",10,m,o,c),d-=l-20;d>=0;)m=d-c+10,r.addPage(),r.addImage(s,"PNG",10,m,o,c),d-=l-20;r.save(t)}catch(n){throw console.error("Error converting HTML to PDF:",n),new Error("فشل في تحويل التقرير إلى PDF")}}static createReportHTML(e,t,n){const a={patients:"تقرير المرضى",appointments:"تقرير المواعيد",financial:"التقرير المالي",inventory:"تقرير المخزون",analytics:"تقرير التحليلات",overview:"التقرير الشامل"}[e]||"تقرير";return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>${a}</title>\n        <style>\n          body {\n            font-family: 'Arial', sans-serif;\n            direction: rtl;\n            margin: 0;\n            padding: 20px;\n            background: #fff;\n            color: #000;\n            line-height: 1.6;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 2px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-name {\n            font-size: 24px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .report-date {\n            font-size: 14px;\n            color: #64748b;\n          }\n          .summary-cards {\n            display: flex;\n            justify-content: space-around;\n            margin: 30px 0;\n            flex-wrap: wrap;\n          }\n          .summary-card {\n            background: #f8fafc;\n            padding: 20px;\n            border-radius: 8px;\n            text-align: center;\n            min-width: 150px;\n            margin: 5px;\n            border: 1px solid #e2e8f0;\n          }\n          .summary-card h3 {\n            margin: 0 0 10px 0;\n            font-size: 16px;\n            color: #1e293b;\n          }\n          .summary-card .number {\n            font-size: 24px;\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          .section {\n            margin: 30px 0;\n          }\n          .section-title {\n            font-size: 18px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 15px;\n            border-bottom: 1px solid #e2e8f0;\n            padding-bottom: 5px;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n          }\n          th, td {\n            padding: 12px;\n            text-align: center;\n            border: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n          }\n          .footer {\n            margin-top: 40px;\n            text-align: center;\n            font-size: 12px;\n            color: #64748b;\n            border-top: 1px solid #e2e8f0;\n            padding-top: 20px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">${a}</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        ${this.generateReportContent(e,t,n)}\n\n        <div class="footer">\n          تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة - ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}\n        </div>\n      </body>\n      </html>\n    `}static generateReportContent(e,t,n){switch(e){case"patients":return this.generatePatientReportContent(t,n);case"appointments":return this.generateAppointmentReportContent(t,n);case"financial":return this.generateFinancialReportContent(t,n);case"inventory":return this.generateInventoryReportContent(t,n);case"overview":return this.generateOverviewReportContent(t,n);default:return'<div class="section">لا توجد بيانات متاحة</div>'}}static generatePatientReportContent(e,t){return`\n      <div class="summary-cards">\n        <div class="summary-card">\n          <h3>إجمالي المرضى</h3>\n          <div class="number">${e.totalPatients||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المرضى الجدد</h3>\n          <div class="number">${e.newPatientsThisMonth||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المرضى النشطون</h3>\n          <div class="number">${e.activePatients||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>متوسط العمر</h3>\n          <div class="number">${e.averageAge||0} سنة</div>\n        </div>\n      </div>\n\n      ${e.ageDistribution&&e.ageDistribution.length>0?`\n      <div class="section">\n        <div class="section-title">توزيع الأعمار</div>\n        <table>\n          <thead>\n            <tr>\n              <th>الفئة العمرية</th>\n              <th>العدد</th>\n              <th>النسبة المئوية</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.ageDistribution.map(t=>`\n              <tr>\n                <td>${t.ageGroup||t.range}</td>\n                <td>${t.count}</td>\n                <td>${(t.count/e.totalPatients*100).toFixed(1)}%</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n\n      ${e.genderDistribution&&e.genderDistribution.length>0?`\n      <div class="section">\n        <div class="section-title">توزيع الجنس</div>\n        <table>\n          <thead>\n            <tr>\n              <th>الجنس</th>\n              <th>العدد</th>\n              <th>النسبة المئوية</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.genderDistribution.map(t=>`\n              <tr>\n                <td>${"male"===t.gender?"ذكر":"أنثى"}</td>\n                <td>${t.count}</td>\n                <td>${(t.count/e.totalPatients*100).toFixed(1)}%</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n\n      ${t.includeDetails&&e.patients&&e.patients.length>0?`\n      <div class="section">\n        <div class="section-title">تفاصيل المرضى</div>\n        <table>\n          <thead>\n            <tr>\n              <th>الاسم الكامل</th>\n              <th>الهاتف</th>\n              <th>العمر</th>\n              <th>الجنس</th>\n              <th>#</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.patients.slice(0,50).map(e=>`\n              <tr>\n                <td>${e.full_name||"غير محدد"}</td>\n                <td>${e.phone||"غير محدد"}</td>\n                <td>${e.age||"غير محدد"}</td>\n                <td>${"male"===e.gender?"ذكر":"أنثى"}</td>\n                <td>${e.serial_number||"غير محدد"}</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n    `}static generateAppointmentReportContent(e,t){return`\n      <div class="summary-cards">\n        <div class="summary-card">\n          <h3>إجمالي المواعيد</h3>\n          <div class="number">${e.totalAppointments||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المكتملة</h3>\n          <div class="number">${e.completedAppointments||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>الملغية</h3>\n          <div class="number">${e.cancelledAppointments||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>معدل الحضور</h3>\n          <div class="number">${e.attendanceRate?.toFixed(1)||0}%</div>\n        </div>\n      </div>\n\n      ${e.appointmentsByStatus&&e.appointmentsByStatus.length>0?`\n      <div class="section">\n        <div class="section-title">توزيع المواعيد حسب الحالة</div>\n        <table>\n          <thead>\n            <tr>\n              <th>الحالة</th>\n              <th>العدد</th>\n              <th>النسبة المئوية</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.appointmentsByStatus.map(e=>`\n              <tr>\n                <td>${this.translateStatus(e.status)}</td>\n                <td>${e.count}</td>\n                <td>${e.percentage?.toFixed(1)||0}%</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n    `}static generateFinancialReportContent(e,t){return`\n      <div class="summary-cards">\n        <div class="summary-card">\n          <h3>إجمالي الإيرادات</h3>\n          <div class="number">${Mn(e.totalRevenue||0)}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المدفوعات المكتملة</h3>\n          <div class="number">${Mn(e.completedPayments||0)}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المدفوعات المعلقة</h3>\n          <div class="number">${Mn(e.pendingPayments||0)}</div>\n        </div>\n        <div class="summary-card">\n          <h3>المدفوعات المتأخرة</h3>\n          <div class="number">${Mn(e.overduePayments||0)}</div>\n        </div>\n      </div>\n\n      ${e.paymentMethodStats&&e.paymentMethodStats.length>0?`\n      <div class="section">\n        <div class="section-title">إحصائيات طرق الدفع</div>\n        <table>\n          <thead>\n            <tr>\n              <th>طريقة الدفع</th>\n              <th>المبلغ</th>\n              <th>عدد المعاملات</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.paymentMethodStats.map(e=>`\n              <tr>\n                <td>${this.translatePaymentMethod(e.method)}</td>\n                <td>${Mn(e.amount)}</td>\n                <td>${e.count}</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n    `}static generateInventoryReportContent(e,t){return`\n      <div class="summary-cards">\n        <div class="summary-card">\n          <h3>إجمالي الأصناف</h3>\n          <div class="number">${e.totalItems||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>القيمة الإجمالية</h3>\n          <div class="number">${Mn(e.totalValue||0)}</div>\n        </div>\n        <div class="summary-card">\n          <h3>أصناف منخفضة المخزون</h3>\n          <div class="number" style="color: #f59e0b;">${e.lowStockItems||0}</div>\n        </div>\n        <div class="summary-card">\n          <h3>أصناف منتهية الصلاحية</h3>\n          <div class="number" style="color: #ef4444;">${e.expiredItems||0}</div>\n        </div>\n      </div>\n\n      ${e.itemsByCategory&&e.itemsByCategory.length>0?`\n      <div class="section">\n        <div class="section-title">توزيع الأصناف حسب الفئة</div>\n        <table>\n          <thead>\n            <tr>\n              <th>الفئة</th>\n              <th>عدد الأصناف</th>\n              <th>القيمة</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${e.itemsByCategory.map(e=>`\n              <tr>\n                <td>${e.category}</td>\n                <td>${e.count}</td>\n                <td>${Mn(e.value)} $</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n      </div>\n      `:""}\n    `}static generateOverviewReportContent(e,t){return`\n      <div class="section">\n        <div class="section-title">ملخص شامل للعيادة</div>\n        <div class="summary-cards">\n          ${e.patients?`\n          <div class="summary-card">\n            <h3>المرضى</h3>\n            <div class="number">${e.patients.totalPatients||0}</div>\n          </div>\n          `:""}\n          ${e.appointments?`\n          <div class="summary-card">\n            <h3>المواعيد</h3>\n            <div class="number">${e.appointments.totalAppointments||0}</div>\n          </div>\n          `:""}\n          ${e.financial?`\n          <div class="summary-card">\n            <h3>الإيرادات</h3>\n            <div class="number">${Mn(e.financial.totalRevenue||0)}</div>\n          </div>\n          `:""}\n          ${e.inventory?`\n          <div class="summary-card">\n            <h3>المخزون</h3>\n            <div class="number">${e.inventory.totalItems||0}</div>\n          </div>\n          `:""}\n        </div>\n      </div>\n\n      ${e.patients?this.generatePatientReportContent(e.patients,t):""}\n      ${e.appointments?this.generateAppointmentReportContent(e.appointments,t):""}\n      ${e.financial?this.generateFinancialReportContent(e.financial,t):""}\n      ${e.inventory?this.generateInventoryReportContent(e.inventory,t):""}\n    `}static translateStatus(e){return{scheduled:"مجدول",completed:"مكتمل",cancelled:"ملغي","no-show":"عدم حضور","in-progress":"قيد التنفيذ"}[e]||e}static translatePaymentMethod(e){return{cash:"نقدي",card:"بطاقة ائتمان",bank_transfer:"تحويل بنكي",insurance:"تأمين",installment:"تقسيط"}[e]||e}static getPaymentStatusInArabic(e){return{completed:"مكتمل",partial:"جزئي",pending:"معلق",overdue:"متأخر",cancelled:"ملغي"}[e]||e}static addPDFHeader(e,t,n){const a=e.internal.pageSize.getWidth();e.setFontSize(24),e.setFont("helvetica","bold"),e.text("عيادة الأسنان الحديثة",a/2,20,{align:"center"}),e.setFontSize(18),e.setFont("helvetica","normal");e.text({patients:"تقرير المرضى",appointments:"تقرير المواعيد",financial:"التقرير المالي",inventory:"تقرير المخزون",analytics:"تقرير التحليلات",overview:"التقرير الشامل"}[t]||"تقرير",a/2,35,{align:"center"}),e.setFontSize(12);const s=new Date,r=`${s.getDate().toString().padStart(2,"0")}/${(s.getMonth()+1).toString().padStart(2,"0")}/${s.getFullYear()}`;e.text(`تاريخ التقرير: ${r}`,a-20,45,{align:"right"}),e.setLineWidth(.5),e.line(20,48,a-20,48)}static addPDFFooter(e,t){const n=e.internal.pageSize.getWidth(),a=e.internal.pageSize.getHeight();e.setFontSize(10),e.setFont("helvetica","normal"),e.text("تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة",n/2,a-10,{align:"center"})}static async addPatientReportToPDF(e,t,n,a){const s=e.internal.pageSize.getWidth();return e.setFontSize(14),e.setFont("helvetica","bold"),e.text("ملخص إحصائيات المرضى",20,n),n+=15,e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`إجمالي المرضى: ${t.totalPatients||0}`,20,n),e.text(`المرضى الجدد هذا الشهر: ${t.newPatientsThisMonth||0}`,150,n),n+=10,e.text(`المرضى النشطون: ${t.activePatients||0}`,20,n),e.text(`متوسط العمر: ${t.averageAge||0} سنة`,150,n),n+=20,a.includeCharts&&t.ageDistribution&&(e.setFont("helvetica","bold"),e.text("توزيع الأعمار",20,n),n+=10,t.ageDistribution.forEach(t=>{e.setFont("helvetica","normal"),e.text(`${t.range}: ${t.count} مريض`,30,n),n+=8}),n+=10),a.includeDetails&&t.patients&&(e.setFont("helvetica","bold"),e.text("تفاصيل المرضى",20,n),n+=15,e.setFontSize(10),e.text("الاسم الكامل",20,n),e.text("الهاتف",80,n),e.text("العمر",130,n),e.text("الجنس",170,n),e.text("#",220,n),e.line(20,n+2,s-20,n+2),n+=10,e.setFont("helvetica","normal"),t.patients.slice(0,20).forEach(t=>{n>250&&(e.addPage(),n=30),e.text(t.full_name||"غير محدد",20,n),e.text(t.phone||"غير محدد",80,n),e.text(t.age?.toString()||"غير محدد",130,n),e.text("male"===t.gender?"ذكر":"أنثى",170,n),e.text(t.serial_number||"غير محدد",220,n),n+=8})),n+20}static async addAppointmentReportToPDF(e,t,n,a){return e.internal.pageSize.getWidth(),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("ملخص إحصائيات المواعيد",20,n),n+=15,e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`إجمالي المواعيد: ${t.totalAppointments||0}`,20,n),e.text(`المواعيد المكتملة: ${t.completedAppointments||0}`,150,n),n+=10,e.text(`المواعيد الملغية: ${t.cancelledAppointments||0}`,20,n),e.text(`معدل الحضور: ${t.attendanceRate||0}%`,150,n),n+=20,a.includeCharts&&t.appointmentsByStatus&&(e.setFont("helvetica","bold"),e.text("توزيع حالات المواعيد",20,n),n+=10,t.appointmentsByStatus.forEach(t=>{e.setFont("helvetica","normal"),e.text(`${t.status}: ${t.count} موعد`,30,n),n+=8}),n+=10),n+20}static async addFinancialReportToPDF(e,t,n,a){return e.internal.pageSize.getWidth(),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("ملخص الإحصائيات المالية",20,n),n+=15,e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`إجمالي الإيرادات: ${Mn(t.totalRevenue||0)}`,20,n),e.text(`المدفوعات المكتملة: ${Mn(t.completedPayments||0)}`,150,n),n+=10,e.text(`المدفوعات المعلقة: ${Mn(t.pendingPayments||0)}`,20,n),e.text(`المدفوعات المتأخرة: ${Mn(t.overduePayments||0)}`,150,n),n+=20,a.includeCharts&&t.paymentMethodStats&&(e.setFont("helvetica","bold"),e.text("توزيع طرق الدفع",20,n),n+=10,t.paymentMethodStats.forEach(t=>{e.setFont("helvetica","normal"),e.text(`${t.method}: ${Mn(t.amount)} (${t.count} معاملة)`,30,n),n+=8}),n+=10),a.includeCharts&&t.monthlyRevenue&&(e.setFont("helvetica","bold"),e.text("الإيرادات الشهرية",20,n),n+=10,t.monthlyRevenue.slice(-6).forEach(t=>{e.setFont("helvetica","normal"),e.text(`${t.month}: ${Mn(t.revenue)}`,30,n),n+=8}),n+=10),n+20}static async addInventoryReportToPDF(e,t,n,a){return e.internal.pageSize.getWidth(),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("ملخص إحصائيات المخزون",20,n),n+=15,e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`إجمالي العناصر: ${t.totalItems||0}`,20,n),e.text(`القيمة الإجمالية: ${Mn(t.totalValue||0)}`,150,n),n+=10,e.text(`عناصر منخفضة المخزون: ${t.lowStockItems||0}`,20,n),e.text(`عناصر منتهية الصلاحية: ${t.expiredItems||0}`,150,n),n+=10,e.text(`عناصر نفدت من المخزون: ${t.outOfStockItems||0}`,20,n),e.text(`معدل دوران المخزون: ${t.turnoverRate||0}%`,150,n),n+=20,a.includeCharts&&t.topCategories&&(e.setFont("helvetica","bold"),e.text("أعلى الفئات استهلاكاً",20,n),n+=10,t.topCategories.slice(0,5).forEach(t=>{e.setFont("helvetica","normal"),e.text(`${t.name}: ${t.count} عنصر`,30,n),n+=8}),n+=10),n+20}static async addOverviewReportToPDF(e,t,n,a){return t.patients&&(n=await this.addPatientReportToPDF(e,t.patients,n,a)),t.appointments&&(n>200&&(e.addPage(),n=30),n=await this.addAppointmentReportToPDF(e,t.appointments,n,a)),t.financial&&(n>200&&(e.addPage(),n=30),n=await this.addFinancialReportToPDF(e,t.financial,n,a)),t.inventory&&(n>200&&(e.addPage(),n=30),n=await this.addInventoryReportToPDF(e,t.inventory,n,a)),n}static async exportToExcel(e,t,n){const a=new ct.Workbook;switch(a.creator="نظام إدارة العيادة",a.created=new Date,a.modified=new Date,e){case"patients":await this.addPatientReportToExcel(a,t,n);break;case"appointments":await this.addAppointmentReportToExcel(a,t,n);break;case"financial":await this.addFinancialReportToExcel(a,t,n);break;case"inventory":await this.addInventoryReportToExcel(a,t,n);break;case"labs":await this.addLabReportToExcel(a,t,n);break;case"clinic-needs":await this.addClinicNeedsReportToExcel(a,t,n);break;case"clinic-expenses":await this.addClinicExpensesReportToExcel(a,t,n);break;case"profit-loss":await this.addProfitLossReportToExcel(a,t,n);break;case"overview":await this.addOverviewReportToExcel(a,t,n)}const s=this.generateFileName(e,"xlsx",{includeTime:!0}),r=await a.xlsx.writeBuffer(),i=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=document.createElement("a"),o=URL.createObjectURL(i);return l.setAttribute("href",o),l.setAttribute("download",`${s}.xlsx`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),s}static async addPatientReportToExcel(e,t,n){const a=e.addWorksheet("تقرير المرضى");a.mergeCells("A1:F1");const s=a.getCell("A1");if(s.value="تقرير المرضى - عيادة الأسنان الحديثة",s.font={size:16,bold:!0},s.alignment={horizontal:"center"},a.getCell("A3").value="ملخص الإحصائيات",a.getCell("A3").font={bold:!0},a.getCell("A4").value="إجمالي المرضى:",a.getCell("B4").value=t.totalPatients||0,a.getCell("A5").value="المرضى الجدد هذا الشهر:",a.getCell("B5").value=t.newPatientsThisMonth||0,a.getCell("A6").value="المرضى النشطون:",a.getCell("B6").value=t.activePatients||0,a.getCell("A7").value="متوسط العمر:",a.getCell("B7").value=`${t.averageAge||0} سنة`,n.includeDetails&&t.patients){let e=10;a.getCell(`A${e}`).value="تفاصيل المرضى",a.getCell(`A${e}`).font={bold:!0},e+=2;["#","الاسم الكامل","الجنس","العمر","الهاتف","البريد الإلكتروني","تاريخ التسجيل"].forEach((t,n)=>{const s=a.getCell(e,n+1);s.value=t,s.font={bold:!0},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),e++,t.patients.forEach(t=>{const n="male"===t.gender?"ذكر":"أنثى",s=t.created_at?new Date(t.created_at).toLocaleDateString("en-GB"):"";a.getCell(e,1).value=t.serial_number||"",a.getCell(e,2).value=t.full_name||"",a.getCell(e,3).value=n,a.getCell(e,4).value=t.age||"",a.getCell(e,5).value=t.phone||"",a.getCell(e,6).value=t.email||"",a.getCell(e,7).value=s,e++})}a.columns.forEach(e=>{e.width=15})}static async addFinancialReportToExcel(e,t,n){const a=e.addWorksheet("التقرير المالي");a.mergeCells("A1:H1");const s=a.getCell("A1");s.value="التقرير المالي الشامل - عيادة الأسنان الحديثة",s.font={size:16,bold:!0},s.alignment={horizontal:"center"},a.getCell("A3").value="ملخص الإحصائيات المالية",a.getCell("A3").font={bold:!0},a.getCell("A4").value="إجمالي الإيرادات:",a.getCell("B4").value=`${Mn(t.totalRevenue||0)}`,a.getCell("A5").value="المدفوعات المكتملة:",a.getCell("B5").value=`${Mn(t.completedPayments||0)}`,a.getCell("A6").value="المدفوعات المعلقة:",a.getCell("B6").value=`${Mn(t.pendingPayments||0)}`,a.getCell("A7").value="المدفوعات المتأخرة:",a.getCell("B7").value=`${Mn(t.overduePayments||0)}`,a.getCell("D4").value="إجمالي المصروفات:",a.getCell("E4").value=`${Mn(t.totalExpenses||0)}`,a.getCell("D5").value="صافي الربح:",a.getCell("E5").value=`${Mn(t.netProfit||0)}`,a.getCell("D6").value="هامش الربح:",a.getCell("E6").value=`${(t.profitMargin||0).toFixed(2)}%`,a.getCell("D7").value="حالة الربحية:",a.getCell("E7").value=(t.netProfit||0)>=0?"ربح":"خسارة";let r=10;t.paymentMethodStats&&(a.getCell(`A${r}`).value="توزيع طرق الدفع",a.getCell(`A${r}`).font={bold:!0},r+=2,a.getCell(r,1).value="طريقة الدفع",a.getCell(r,2).value="المبلغ",a.getCell(r,3).value="عدد المعاملات",a.getRow(r).font={bold:!0},r++,t.paymentMethodStats.forEach(e=>{a.getCell(r,1).value=e.method,a.getCell(r,2).value=`${Mn(e.amount)}`,a.getCell(r,3).value=e.count,r++}),r+=2),t.expensesByType&&t.expensesByType.length>0&&(a.getCell(`D${r}`).value="توزيع المصروفات حسب النوع",a.getCell(`D${r}`).font={bold:!0},r+=2,a.getCell(r,4).value="نوع المصروف",a.getCell(r,5).value="المبلغ",a.getCell(r,6).value="النسبة المئوية",a.getRow(r).font={bold:!0},r++,t.expensesByType.forEach(e=>{a.getCell(r,4).value=e.type,a.getCell(r,5).value=`${Mn(e.amount)}`,a.getCell(r,6).value=`${e.percentage.toFixed(2)}%`,r++}),r+=2),t.recentExpenses&&t.recentExpenses.length>0&&(a.getCell(`A${r}`).value="المصروفات الحديثة (آخر 10 مصروفات)",a.getCell(`A${r}`).font={bold:!0},r+=2,a.getCell(r,1).value="اسم المصروف",a.getCell(r,2).value="النوع",a.getCell(r,3).value="المبلغ",a.getCell(r,4).value="طريقة الدفع",a.getCell(r,5).value="تاريخ الدفع",a.getCell(r,6).value="المورد",a.getRow(r).font={bold:!0},r++,t.recentExpenses.slice(0,10).forEach(e=>{a.getCell(r,1).value=e.expense_name||"غير محدد",a.getCell(r,2).value={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"}[e.expense_type]||e.expense_type||"غير محدد",a.getCell(r,3).value=`${Mn(e.amount||0)}`,a.getCell(r,4).value={cash:"نقداً",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمان"}[e.payment_method]||e.payment_method||"غير محدد",a.getCell(r,5).value=e.payment_date?new Date(e.payment_date).toLocaleDateString("en-GB"):"غير محدد",a.getCell(r,6).value=e.vendor||"غير محدد",r++})),a.columns.forEach(e=>{e.width=20})}static async addClinicExpensesReportToExcel(e,t,n){const a=e.addWorksheet("مصروفات العيادة");a.views=[{rightToLeft:!0}];let s=1;a.mergeCells(s,1,s,7);const r=a.getCell(s,1);if(r.value="تقرير مصروفات العيادة",r.font={name:"Arial",size:18,bold:!0},r.alignment={horizontal:"center",vertical:"middle"},r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},r.font.color={argb:"FFFFFFFF"},a.getRow(s).height=30,s+=2,t.summary){a.mergeCells(s,1,s,7);const e=a.getCell(s,1);e.value="ملخص المصروفات",e.font={name:"Arial",size:14,bold:!0},e.alignment={horizontal:"center"},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE7E6E6"}},s++,Object.entries(t.summary).forEach(([e,t])=>{a.getCell(s,1).value=e,a.getCell(s,2).value=t,a.getCell(s,1).font={name:"Arial",size:11,bold:!0},a.getCell(s,2).font={name:"Arial",size:11},s++}),s++}if(["اسم المصروف","نوع المصروف","المبلغ","طريقة الدفع","تاريخ الدفع","المورد","الحالة"].forEach((e,t)=>{const n=a.getCell(s,t+1);n.value=e,n.font={name:"Arial",size:12,bold:!0},n.alignment={horizontal:"center",vertical:"middle"},n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFD9E1F2"}},n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),s++,t.expenses&&t.expenses.length>0){const e={salary:"راتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},n={cash:"نقدي",card:"بطاقة",bank_transfer:"تحويل بنكي",check:"شيك"},r={paid:"مدفوع",pending:"معلق",overdue:"متأخر"};t.expenses.forEach(t=>{a.getCell(s,1).value=t.expense_name||"غير محدد",a.getCell(s,2).value=e[t.expense_type]||t.expense_type||"غير محدد",a.getCell(s,3).value=`${Mn(t.amount||0)}`,a.getCell(s,4).value=n[t.payment_method]||t.payment_method||"غير محدد",a.getCell(s,5).value=t.payment_date?new Date(t.payment_date).toLocaleDateString("en-GB"):"غير محدد",a.getCell(s,6).value=t.vendor||"غير محدد",a.getCell(s,7).value=r[t.status]||t.status||"غير محدد";for(let e=1;e<=7;e++){const t=a.getCell(s,e);t.font={name:"Arial",size:10},t.alignment={horizontal:"center",vertical:"middle"},t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}s++})}a.columns.forEach(e=>{e.width=20})}static async addAppointmentReportToExcel(e,t,n){const a=e.addWorksheet("تقرير المواعيد");a.mergeCells("A1:F1");const s=a.getCell("A1");s.value="تقرير المواعيد - عيادة الأسنان الحديثة",s.font={size:16,bold:!0},s.alignment={horizontal:"center"},a.getCell("A3").value="ملخص إحصائيات المواعيد",a.getCell("A3").font={bold:!0},a.getCell("A4").value="إجمالي المواعيد:",a.getCell("B4").value=t.totalAppointments||0,a.getCell("A5").value="المواعيد المكتملة:",a.getCell("B5").value=t.completedAppointments||0,a.getCell("A6").value="المواعيد الملغية:",a.getCell("B6").value=t.cancelledAppointments||0,a.getCell("A7").value="معدل الحضور:",a.getCell("B7").value=`${t.attendanceRate||0}%`,a.columns.forEach(e=>{e.width=20})}static async addInventoryReportToExcel(e,t,n){const a=e.addWorksheet("تقرير المخزون");a.mergeCells("A1:F1");const s=a.getCell("A1");s.value="تقرير المخزون - عيادة الأسنان الحديثة",s.font={size:16,bold:!0},s.alignment={horizontal:"center"},a.getCell("A3").value="ملخص إحصائيات المخزون",a.getCell("A3").font={bold:!0};const r=t.summary||t;a.getCell("A4").value="إجمالي العناصر:",a.getCell("B4").value=r["إجمالي العناصر"]||t.totalItems||0,a.getCell("A5").value="القيمة الإجمالية:",a.getCell("B5").value=r["القيمة الإجمالية"]||Mn(t.totalValue||0),a.getCell("A6").value="عناصر منخفضة المخزون:",a.getCell("B6").value=r["عناصر منخفضة المخزون"]||t.lowStockItems||0,a.getCell("A7").value="عناصر منتهية الصلاحية:",a.getCell("B7").value=r["عناصر منتهية الصلاحية"]||t.expiredItems||0,void 0!==r["عناصر نفدت من المخزون"]&&(a.getCell("A8").value="عناصر نفدت من المخزون:",a.getCell("B8").value=r["عناصر نفدت من المخزون"]),void 0!==r["عناصر بدون أسعار"]&&(a.getCell("A9").value="عناصر بدون أسعار:",a.getCell("B9").value=r["عناصر بدون أسعار"]),r["تاريخ التقرير"]&&(a.getCell("A10").value="تاريخ التقرير:",a.getCell("B10").value=r["تاريخ التقرير"]),a.columns.forEach(e=>{e.width=20})}static async addLabReportToExcel(e,t,n){if(!t)return void console.error("No data provided to addLabReportToExcel");const a=e.addWorksheet("تقرير المختبرات");a.mergeCells("A1:F1");const s=a.getCell("A1");s.value="تقرير المختبرات - عيادة الأسنان الحديثة",s.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF2E8B57"}},s.alignment={horizontal:"center",vertical:"middle"},s.border={top:{style:"thick"},left:{style:"thick"},bottom:{style:"thick"},right:{style:"thick"}},a.getCell("A2").value=`تاريخ التقرير: ${(new Date).toLocaleDateString("ar-SA")}`,a.getCell("A2").font={size:12,italic:!0},a.getCell("A2").alignment={horizontal:"right"};let r=4;if(t&&t.summary&&"object"==typeof t.summary){a.getCell(`A${r}`).value="ملخص الإحصائيات",a.getCell(`A${r}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},r+=2;try{const e=Object.entries(t.summary);for(const[t,n]of e){a.getCell(`A${r}`).value=t,a.getCell(`B${r}`).value=n,a.getCell(`A${r}`).font={bold:!0},a.getCell(`B${r}`).font={size:11};const e=a.getCell(`A${r}`);e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}},e.alignment={horizontal:"right",vertical:"middle"};const s=a.getCell(`B${r}`);s.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}},s.alignment={horizontal:"right",vertical:"middle"},r++}}catch(i){console.error("Error processing summary data:",i)}r+=2}if(t.labs&&t.labs.length>0){a.getCell(`A${r}`).value="بيانات المختبرات",a.getCell(`A${r}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},r+=2;["اسم المختبر","معلومات الاتصال","العنوان","عدد الطلبات","تاريخ الإضافة"].forEach((e,t)=>{const n=a.getCell(r,t+1);n.value=e,n.font={bold:!0,size:12,color:{argb:"FFFFFFFF"}},n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},n.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}},n.alignment={horizontal:"center",vertical:"middle"}}),r++;try{t.labs.forEach((e,t)=>{[e.name,e.contact_info||"",e.address||"",e.ordersCount||0,new Date(e.created_at).toLocaleDateString("ar-SA")].forEach((e,n)=>{const s=a.getCell(r,n+1);s.value=e,s.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},s.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})}),r++})}catch(i){console.error("Error processing labs data:",i)}}if(t.labOrders&&t.labOrders.length>0){r+=2,a.getCell(`A${r}`).value="بيانات طلبات المختبرات",a.getCell(`A${r}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},r+=2;["رقم الطلب","اسم المختبر","اسم الخدمة","اسم المريض","التكلفة","المبلغ المدفوع","المبلغ المتبقي","تاريخ الطلب","الحالة","الملاحظات"].forEach((e,t)=>{const n=a.getCell(r,t+1);n.value=e,n.font={bold:!0,size:12,color:{argb:"FFFFFFFF"}},n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},n.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}},n.alignment={horizontal:"center",vertical:"middle"}}),r++;try{t.labOrders.forEach((e,t)=>{[t+1,e.lab?.name||"غير محدد",e.service_name,e.patient?.full_name||"غير محدد",`$${e.cost}`,`$${e.paid_amount||0}`,`$${e.remaining_balance||0}`,new Date(e.order_date).toLocaleDateString("en-GB"),e.status,e.notes||""].forEach((e,n)=>{const s=a.getCell(r,n+1);s.value=e,s.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},s.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),n>=4&&n<=6&&(s.font={bold:!0},s.fill||(s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}}))}),r++})}catch(i){console.error("Error processing lab orders data:",i)}}a.columns.forEach(e=>{e.width=15}),a.getColumn(1).width=20,a.getColumn(2).width=25,a.getColumn(3).width=30,a.getColumn(4).width=15,a.getColumn(5).width=20}static async addClinicNeedsReportToExcel(e,t,n){const a=e.addWorksheet("تقرير احتياجات العيادة");a.mergeCells("A1:H1");const s=a.getCell("A1");s.value="تقرير احتياجات العيادة - عيادة الأسنان الحديثة",s.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF2E8B57"}},s.alignment={horizontal:"center",vertical:"middle"},s.border={top:{style:"thick"},left:{style:"thick"},bottom:{style:"thick"},right:{style:"thick"}},a.getCell("A2").value=`تاريخ التقرير: ${(new Date).toLocaleDateString("en-GB")}`,a.getCell("A2").font={size:12,italic:!0},a.getCell("A2").alignment={horizontal:"right"};let r=4;if(t.summary&&(a.getCell(`A${r}`).value="ملخص الإحصائيات",a.getCell(`A${r}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},r+=2,Object.entries(t.summary).forEach(([e,t])=>{a.getCell(`A${r}`).value=e,a.getCell(`B${r}`).value=t,a.getCell(`A${r}`).font={bold:!0},a.getCell(`B${r}`).font={size:11}.B.forEach(e=>{const t=a.getCell(`${e}${r}`);t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}},t.alignment={horizontal:"right",vertical:"middle"}}),r++}),r+=2),t.needs&&t.needs.length>0){a.getCell(`A${r}`).value="بيانات احتياجات العيادة",a.getCell(`A${r}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},r+=2;["#","اسم العنصر","الكمية المطلوبة","الأولوية","الحالة","تاريخ الطلب","تاريخ الاستلام","الملاحظات"].forEach((e,t)=>{const n=a.getCell(r,t+1);n.value=e,n.font={bold:!0,size:12,color:{argb:"FFFFFFFF"}},n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},n.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}},n.alignment={horizontal:"center",vertical:"middle"}}),r++,t.needs.forEach((e,t)=>{[t+1,e.item_name,e.quantity_needed,{urgent:"عاجل",high:"عالي",medium:"متوسط",low:"منخفض"}[e.priority]||e.priority,{pending:"معلق",ordered:"تم الطلب",received:"تم الاستلام"}[e.status]||e.status,new Date(e.date_needed).toLocaleDateString("en-GB"),e.date_received?new Date(e.date_received).toLocaleDateString("en-GB"):"",e.notes||""].forEach((n,s)=>{const i=a.getCell(r,s+1);if(i.value=n,i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),3===s){let t="FFF8F9FA";switch(e.priority){case"urgent":t="FFFFE6E6";break;case"high":t="FFFFF2CC";break;case"medium":t="FFFFFFE6";break;case"low":t="FFE6F7FF"}i.fill={type:"pattern",pattern:"solid",fgColor:{argb:t}}}if(4===s){let t="FFF8F9FA";switch(e.status){case"pending":t="FFFFE6E6";break;case"ordered":t="FFFFF2CC";break;case"received":t="FFE6F7E6"}i.fill={type:"pattern",pattern:"solid",fgColor:{argb:t}}}}),r++})}a.columns.forEach(e=>{e.width=15}),a.getColumn(1).width=12,a.getColumn(2).width=25,a.getColumn(3).width=15,a.getColumn(4).width=12,a.getColumn(5).width=15,a.getColumn(6).width=18,a.getColumn(7).width=18,a.getColumn(8).width=30}static async addOverviewReportToExcel(e,t,n){t.patients&&await this.addPatientReportToExcel(e,t.patients,n),t.appointments&&await this.addAppointmentReportToExcel(e,t.appointments,n),t.financial&&await this.addFinancialReportToExcel(e,t.financial,n),t.inventory&&await this.addInventoryReportToExcel(e,t.inventory,n),t.labs&&await this.addLabReportToExcel(e,t.labs,n),t.clinicNeeds&&await this.addClinicNeedsReportToExcel(e,t.clinicNeeds,n)}static async addProfitLossReportToExcel(e,t,n){const a=e.addWorksheet("تقرير الأرباح والخسائر");a.mergeCells("A1:H1");const s=a.getCell("A1");s.value="التقرير الشامل للأرباح والخسائر - عيادة الأسنان",s.font={size:16,bold:!0},s.alignment={horizontal:"center"},a.getCell("A3").value="ملخص الأرباح والخسائر",a.getCell("A3").font={bold:!0,size:14};let r=5;if(t.summary&&(Object.entries(t.summary).forEach(([e,t])=>{a.getCell(r,1).value=e,a.getCell(r,2).value=t,a.getCell(r,1).font={bold:!0},r++}),r+=2),t.revenue&&(a.getCell(r,1).value="تفاصيل الإيرادات",a.getCell(r,1).font={bold:!0,size:12,color:{argb:"FF059669"}},a.getCell(r,1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE6F7E6"}},r+=2,a.getCell(r,1).value="المدفوعات المكتملة:",a.getCell(r,2).value=Mn(t.revenue.completedPayments||0),a.getCell(r,1).font={bold:!0},r++,a.getCell(r,1).value="المدفوعات الجزئية:",a.getCell(r,2).value=Mn(t.revenue.partialPayments||0),a.getCell(r,1).font={bold:!0},r++,a.getCell(r,1).value="المبالغ المعلقة:",a.getCell(r,2).value=Mn(t.revenue.pendingPayments||0),a.getCell(r,1).font={bold:!0},r++,a.getCell(r,1).value="المبالغ المتبقية من الجزئية:",a.getCell(r,2).value=Mn(t.revenue.remainingBalances||0),a.getCell(r,1).font={bold:!0},r++,a.getCell(r,1).value="إجمالي الإيرادات:",a.getCell(r,2).value=Mn(t.revenue.totalRevenue||0),a.getCell(r,1).font={bold:!0,color:{argb:"FF059669"}},a.getCell(r,2).font={bold:!0,color:{argb:"FF059669"}},a.getCell(r,1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}},a.getCell(r,2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}},r+=3),t.expenses){a.getCell(r,1).value="تفاصيل المصروفات",a.getCell(r,1).font={bold:!0,size:12},r+=2,a.getCell(r,1).value="مدفوعات المخابر:",a.getCell(r,2).value=Mn(t.expenses.labOrdersTotal||0),r++,a.getCell(r,1).value="متبقي المخابر:",a.getCell(r,2).value=Mn(t.expenses.labOrdersRemaining||0),r++,a.getCell(r,1).value="احتياجات العيادة:",a.getCell(r,2).value=Mn(t.expenses.clinicNeedsTotal||0),r++,a.getCell(r,1).value="متبقي الاحتياجات:",a.getCell(r,2).value=Mn(t.expenses.clinicNeedsRemaining||0),r++,a.getCell(r,1).value="قيمة المخزون:",a.getCell(r,2).value=Mn(t.expenses.inventoryExpenses||0),r++,a.getCell(r,1).value="مصروفات العيادة المباشرة:",a.getCell(r,2).value=Mn(t.expenses.clinicExpensesTotal||0),r++;const e=(t.expenses.labOrdersTotal||0)+(t.expenses.labOrdersRemaining||0)+(t.expenses.clinicNeedsTotal||0)+(t.expenses.clinicNeedsRemaining||0)+(t.expenses.inventoryExpenses||0)+(t.expenses.clinicExpensesTotal||0);a.getCell(r,1).value="إجمالي المصروفات:",a.getCell(r,2).value=Mn(e),a.getCell(r,1).font={bold:!0},a.getCell(r,2).font={bold:!0},r+=3}t.payments&&t.payments.length>0&&this.addPaymentsDetailSheet(e,t.payments),t.labOrders&&t.labOrders.length>0&&this.addLabOrdersDetailSheet(e,t.labOrders),t.clinicNeeds&&t.clinicNeeds.length>0&&this.addClinicNeedsDetailSheet(e,t.clinicNeeds),t.inventoryItems&&t.inventoryItems.length>0&&this.addInventoryDetailSheet(e,t.inventoryItems),t.clinicExpenses&&t.clinicExpenses.length>0&&this.addClinicExpensesDetailSheet(e,t.clinicExpenses),a.columns.forEach(e=>{e.width=25})}static addPaymentsDetailSheet(e,t){const n=e.addWorksheet("تفاصيل المدفوعات"),a=t.filter(e=>"pending"===e.status),s=t.filter(e=>"partial"===e.status),r=a.reduce((e,t)=>e+(t.treatment_total_cost||t.total_amount_due||0),0),i=s.reduce((e,t)=>{const n=t.total_amount_due||t.treatment_total_cost||0;if(n>0){const a=t.amount_paid||t.treatment_total_paid||t.amount||0;return e+Math.max(0,n-a)}return e+(t.treatment_remaining_balance||t.remaining_balance||0)},0);["اسم المريض","المبلغ المدفوع","المبلغ الإجمالي","المبلغ المتبقي","الحالة","طريقة الدفع","تاريخ الدفع","ملاحظات"].forEach((e,t)=>{const a=n.getCell(1,t+1);a.value=e,a.font={bold:!0},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),t.forEach((e,t)=>{const a=t+2,s=e.amount||0;let r=0,i=0;if("partial"===e.status)if(r=e.total_amount_due||e.treatment_total_cost||0,r>0){const t=e.amount_paid||e.treatment_total_paid||s;i=Math.max(0,r-t)}else i=e.remaining_balance||e.treatment_remaining_balance||0;else"pending"===e.status?(r=e.total_amount_due||e.treatment_total_cost||s,i=r):(r=s,i=0);n.getCell(a,1).value=e.patient_name||"",n.getCell(a,2).value=Mn(s),n.getCell(a,3).value=Mn(r),n.getCell(a,4).value=Mn(i),n.getCell(a,5).value="completed"===e.status?"مكتمل":"partial"===e.status?"جزئي":"معلق",n.getCell(a,6).value=e.payment_method||"",n.getCell(a,7).value=e.payment_date?new Date(e.payment_date).toLocaleDateString("en-GB"):"",n.getCell(a,8).value=e.notes||""});const l=t.length+4;n.getCell(l,1).value="ملخص المدفوعات المعلقة والمتبقية",n.getCell(l,1).font={bold:!0,size:14},n.mergeCells(l,1,l,8),n.getCell(l+2,1).value="إجمالي المدفوعات المعلقة:",n.getCell(l+2,2).value=Mn(r),n.getCell(l+2,1).font={bold:!0},n.getCell(l+2,2).font={bold:!0},n.getCell(l+3,1).value="إجمالي المبالغ المتبقية من الدفعات الجزئية:",n.getCell(l+3,2).value=Mn(i),n.getCell(l+3,1).font={bold:!0},n.getCell(l+3,2).font={bold:!0};const o=r+i;n.getCell(l+4,1).value="إجمالي المبالغ غير المدفوعة:",n.getCell(l+4,2).value=Mn(o),n.getCell(l+4,1).font={bold:!0,color:{argb:"FFDC2626"}},n.getCell(l+4,2).font={bold:!0,color:{argb:"FFDC2626"}};for(let c=l;c<=l+4;c++)for(let e=1;e<=2;e++){const t=n.getCell(c,e);t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},c===l?(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},t.font={bold:!0,size:14,color:{argb:"FFFFFFFF"}}):c>l+1&&(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})}n.columns.forEach(e=>{e.width=15})}static addLabOrdersDetailSheet(e,t){const n=e.addWorksheet("تفاصيل طلبات المخابر");["رقم الطلب","اسم المختبر","اسم المريض","التكلفة","المدفوع","المتبقي","الحالة","تاريخ الطلب"].forEach((e,t)=>{const a=n.getCell(1,t+1);a.value=e,a.font={bold:!0},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),t.forEach((e,t)=>{const a=t+2;n.getCell(a,1).value=e.id||"",n.getCell(a,2).value=e.lab?.name||"",n.getCell(a,3).value=e.patient?.full_name||"",n.getCell(a,4).value=Mn(e.cost||0),n.getCell(a,5).value=Mn(e.paid_amount||0),n.getCell(a,6).value=Mn((e.cost||0)-(e.paid_amount||0)),n.getCell(a,7).value="completed"===e.status?"مكتمل":"pending"===e.status?"معلق":"ملغي",n.getCell(a,8).value=e.order_date?new Date(e.order_date).toLocaleDateString("en-GB"):""}),n.columns.forEach(e=>{e.width=15})}static addClinicNeedsDetailSheet(e,t){const n=e.addWorksheet("تفاصيل احتياجات العيادة");["اسم العنصر","الكمية","سعر الوحدة","التكلفة الإجمالية","الأولوية","الحالة","التاريخ المطلوب","التاريخ المستلم","ملاحظات"].forEach((e,t)=>{const a=n.getCell(1,t+1);a.value=e,a.font={bold:!0},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),t.forEach((e,t)=>{const a=t+2,s=e.quantity||0,r=e.price||0,i=s*r;n.getCell(a,1).value=e.need_name||e.item_name||"",n.getCell(a,2).value=s,n.getCell(a,3).value=Mn(r),n.getCell(a,4).value=Mn(i),n.getCell(a,5).value="urgent"===e.priority?"عاجل":"high"===e.priority?"عالي":"medium"===e.priority?"متوسط":"منخفض",n.getCell(a,6).value="received"===e.status?"مستلم":"ordered"===e.status?"مطلوب":"معلق",n.getCell(a,7).value=e.date_needed?new Date(e.date_needed).toLocaleDateString("en-GB"):"",n.getCell(a,8).value=e.date_received?new Date(e.date_received).toLocaleDateString("en-GB"):"",n.getCell(a,9).value=e.notes||""});const a=t.reduce((e,t)=>e+(t.quantity||0)*(t.price||0),0),s=t.length+3;n.getCell(s,1).value="إجمالي تكلفة احتياجات العيادة:",n.getCell(s,4).value=Mn(a),n.getCell(s,1).font={bold:!0},n.getCell(s,4).font={bold:!0},n.columns.forEach(e=>{e.width=15})}static addInventoryDetailSheet(e,t){const n=e.addWorksheet("تفاصيل المخزون");["اسم العنصر","الكمية","سعر الوحدة","القيمة الإجمالية","الحد الأدنى","تاريخ الانتهاء","الفئة"].forEach((e,t)=>{const a=n.getCell(1,t+1);a.value=e,a.font={bold:!0},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),t.forEach((e,t)=>{const a=t+2,s=parseFloat(String(e.cost_per_unit||0))||0,r=parseFloat(String(e.unit_price||0))||0,i=s||r,l=parseFloat(String(e.quantity||0))||0,o=l*i;n.getCell(a,1).value=e.name||"",n.getCell(a,2).value=l,n.getCell(a,3).value=Mn(i),n.getCell(a,4).value=Mn(o),n.getCell(a,5).value=e.minimum_stock||0,n.getCell(a,6).value=e.expiry_date?new Date(e.expiry_date).toLocaleDateString("en-GB"):"",n.getCell(a,7).value=e.category||""}),n.columns.forEach(e=>{e.width=15})}static addClinicExpensesDetailSheet(e,t){const n=e.addWorksheet("تفاصيل مصروفات العيادة");["اسم المصروف","النوع","المبلغ","طريقة الدفع","تاريخ الدفع","المورد","ملاحظات"].forEach((e,t)=>{const a=n.getCell(1,t+1);a.value=e,a.font={bold:!0},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}}),t.forEach((e,t)=>{const a=t+2;n.getCell(a,1).value=e.expense_name||"",n.getCell(a,2).value=e.expense_type||"",n.getCell(a,3).value=Mn(e.amount||0),n.getCell(a,4).value=e.payment_method||"",n.getCell(a,5).value=e.payment_date?new Date(e.payment_date).toLocaleDateString("en-GB"):"",n.getCell(a,6).value=e.vendor||"",n.getCell(a,7).value=e.notes||""}),n.columns.forEach(e=>{e.width=15})}static async exportToCSV(e,t,n){let a="\ufeff";switch(e){case"patients":a+=this.generatePatientCSV(t,n);break;case"appointments":a+=this.generateAppointmentCSV(t,n);break;case"financial":a+=this.generateFinancialCSV(t,n);break;case"inventory":a+=this.generateInventoryCSV(t,n);break;case"profit-loss":a+=this.generateProfitLossCSV(t,n);break;case"overview":a+=this.generateOverviewCSV(t,n)}await this.convertCSVToExcel(a,e,n);return this.generateFileName(e,"xlsx",{includeTime:!0})}static isTableHeader(e,t){return e.includes("اسم المريض")||e.includes("نوع الموعد")||e.includes("نوع الدفع")||e.includes("تاريخ الدفع")||e.includes("اسم الصنف")||e.includes("التاريخ,الوقت")||e.includes("رقم الإيصال")||e.includes("#")||e.includes("اسم العلاج")||e.includes("اسم المنتج")||1===t&&e.includes(",")}static isFinancialData(e){return e.includes("إجمالي")||e.includes("صافي")||e.includes("الربح")||e.includes("الخسارة")||e.includes("المدفوعات")||e.includes("الإيرادات")||e.includes("المصروفات")||e.includes("القيمة الإجمالية")||e.includes("المبلغ الإجمالي")}static async convertCSVToExcel(e,t,n){try{const n=new ct.Workbook;n.creator="نظام إدارة العيادة",n.created=new Date,n.modified=new Date;const a=n.addWorksheet("التقرير"),s=e.replace("\ufeff","").split("\n").filter(e=>e.trim());let r=1;for(const e of s){if(e.includes(",")){this.parseCSVLine(e).forEach((n,s)=>{const i=a.getCell(r,s+1);i.value=n,this.isTableHeader(e,r)?(i.font={bold:!0,size:12,color:{argb:"FFFFFFFF"}},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"comprehensive"===t?"FF2E8B57":"FF4472C4"}},i.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}):this.isFinancialData(e)?(i.font={bold:!0,size:11},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}},i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}):(i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r%2==0&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})),i.alignment={horizontal:"right",vertical:"middle"}})}else{const t=a.getCell(r,1);t.value=e.trim(),e.includes("عيادة الأسنان")||e.includes("التقرير الشامل")||e.includes("التقرير المالي")?(t.font={bold:!0,size:18,color:{argb:"FF1F4E79"}},t.alignment={horizontal:"center",vertical:"middle"},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE7F3FF"}},a.mergeCells(r,1,r,12)):e.includes("===")||e.includes("تحليل")||e.includes("ملخص")?(t.font={bold:!0,size:14,color:{argb:"FF2E8B57"}},t.alignment={horizontal:"right",vertical:"middle"},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF0FFF0"}},a.mergeCells(r,1,r,8)):(t.font={bold:!0,size:12},t.alignment={horizontal:"right",vertical:"middle"})}r++}a.columns.forEach((e,t)=>{e.width=0===t?25:18}),s.length>0&&s[0].includes(",")&&(a.views=[{state:"frozen",ySplit:1}]),a.eachRow((e,t)=>{e.height=25,1===t&&(e.height=30)});const i=this.generateFileName(t,"xlsx",{includeTime:!0}),l=await n.xlsx.writeBuffer(),o=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=document.createElement("a"),d=URL.createObjectURL(o);c.setAttribute("href",d),c.setAttribute("download",`${i}.xlsx`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),console.log(`✅ تم تحويل CSV إلى Excel: ${i}.xlsx`)}catch(a){console.error("خطأ في تحويل CSV إلى Excel:",a)}}static parseCSVLine(e){const t=[];let n="",a=!1;for(let s=0;s<e.length;s++){const r=e[s];'"'===r?a=!a:","!==r||a?n+=r:(t.push(n.trim()),n="")}return t.push(n.trim()),t.map(e=>e.replace(/^"|"$/g,""))}static generatePatientCSV(e,t){let n="تقرير المرضى - عيادة الأسنان الحديثة\n\n";return n+="ملخص الإحصائيات\n",n+=`إجمالي المرضى,${e.totalPatients||0}\n`,n+=`المرضى الجدد هذا الشهر,${e.newPatientsThisMonth||0}\n`,n+=`المرضى النشطون,${e.activePatients||0}\n`,n+=`متوسط العمر,${e.averageAge||0} سنة\n\n`,e.ageDistribution&&e.ageDistribution.length>0&&(n+="توزيع الأعمار\n",n+="الفئة العمرية,العدد,النسبة المئوية\n",e.ageDistribution.forEach(t=>{const a=e.totalPatients>0?(t.count/e.totalPatients*100).toFixed(1):"0.0";n+=`"${t.ageGroup}",${t.count},${a}%\n`}),n+="\n"),e.genderDistribution&&e.genderDistribution.length>0&&(n+="توزيع الجنس\n",n+="الجنس,العدد,النسبة المئوية\n",e.genderDistribution.forEach(t=>{const a=e.totalPatients>0?(t.count/e.totalPatients*100).toFixed(1):"0.0",s="male"===t.gender||"ذكور"===t.gender?"ذكر":"أنثى";n+=`"${s}",${t.count},${a}%\n`}),n+="\n"),t.includeDetails&&e.patients&&(n+="تفاصيل المرضى\n",n+="#,الاسم الكامل,الجنس,العمر,الهاتف,البريد الإلكتروني,تاريخ التسجيل\n",e.patients.forEach(e=>{const t="male"===e.gender?"ذكر":"أنثى",a=e.created_at?new Date(e.created_at).toLocaleDateString("ar-SA"):"";n+=`"${e.serial_number||""}","${e.full_name||""}","${t}","${e.age||""}","${e.phone||""}","${e.email||""}","${a}"\n`})),n}static generateFinancialCSV(e,t){let n="التقرير المالي الشامل - عيادة الأسنان الحديثة\n\n";const a=new Date,s=`${a.getDate().toString().padStart(2,"0")}/${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getFullYear()}`,r=a.toLocaleTimeString("ar-SA");if(n+=`تاريخ التقرير,${s}\n`,n+=`وقت الإنشاء,${r}\n\n`,e.filterInfo&&(n+="معلومات الفلترة المطبقة\n",n+=`نطاق البيانات,"${e.filterInfo}"\n`,n+=`عدد المعاملات المصدرة,${e.dataCount||0}\n\n`),n+="ملخص الإحصائيات المالية\n",n+=`إجمالي الإيرادات,${Mn(e.totalRevenue||0)}\n`,n+=`المدفوعات المكتملة,${Mn(e.completedPayments||0)}\n`,n+=`المدفوعات المعلقة,${Mn(e.pendingPayments||0)}\n`,n+=`المدفوعات المتأخرة,${Mn(e.overduePayments||0)}\n`,n+=`إجمالي المصروفات,${Mn(e.totalExpenses||0)}\n`,n+=`صافي الربح,${Mn(e.netProfit||0)}\n`,n+=`هامش الربح,${(e.profitMargin||0).toFixed(2)}%\n`,n+=`حالة الربحية,${(e.netProfit||0)>=0?"ربح":"خسارة"}\n`,e.payments&&Array.isArray(e.payments)){const t=e.payments.filter(e=>"partial"===e.status).reduce((e,t)=>{const n=void 0!==t.remaining_balance?Number(t.remaining_balance):Number(t.total_amount_due||t.amount)-Number(t.amount_paid||t.amount);return e+Math.max(0,n)},0);t>0&&(n+=`المبالغ المتبقية من الدفعات الجزئية,${Mn(t)}\n`)}if(n+=`الرصيد المستحق الإجمالي,${Mn(e.outstandingBalance||0)}\n\n`,e.paymentMethodStats&&e.paymentMethodStats.length>0){n+="توزيع طرق الدفع\n",n+="طريقة الدفع,المبلغ,عدد المعاملات,النسبة المئوية\n";const t=e.paymentMethodStats.reduce((e,t)=>e+t.amount,0);e.paymentMethodStats.forEach(e=>{const a=t>0?(e.amount/t*100).toFixed(1):"0.0";n+=`"${e.method}","${Mn(e.amount)}","${e.count}","${a}%"\n`}),n+="\n"}if(t.includeDetails&&e.payments&&Array.isArray(e.payments)){const t=e.payments;n+="تفاصيل المعاملات المالية\n",n+="رقم الإيصال,تاريخ الدفع,اسم المريض,وصف العلاج,المبلغ الإجمالي,المبلغ المدفوع,الرصيد المتبقي,طريقة الدفع,الحالة,ملاحظات\n",t.forEach(e=>{const t=e.receipt_number||`#${e.id?.slice(-6)||""}`,a=e.payment_date?In(e.payment_date):"",s=e.patient_name||`${e.patient?.first_name||""} ${e.patient?.last_name||""}`.trim()||"غير محدد",r=e.description||e.treatment_type||"غير محدد";let i,l,o;"partial"===e.status?(i=Mn(Number(e.total_amount_due||e.amount)||0),l=Mn(Number(e.amount_paid||e.amount)||0),o=Mn(Number(e.remaining_balance||0))):e.appointment_id&&e.appointment_total_cost?(i=Mn(Number(e.appointment_total_cost)||0),l=Mn(Number(e.appointment_total_paid||e.amount)||0),o=Mn(Number(e.appointment_remaining_balance||0))):(i=Mn(Number(e.amount)||0),l=Mn(Number(e.amount)||0),o=Mn(0));const c=this.translatePaymentMethod(e.payment_method||"غير محدد"),d=this.getPaymentStatusInArabic(e.status),m=e.notes||"";n+=`"${t}","${a}","${s}","${r}","${i}","${l}","${o}","${c}","${d}","${m}"\n`}),n+="\n"}if(e.expensesByType&&e.expensesByType.length>0&&(n+="توزيع المصروفات حسب النوع\n",n+="نوع المصروف,المبلغ,النسبة المئوية\n",e.expensesByType.forEach(e=>{n+=`"${e.type}","${Mn(e.amount)}","${e.percentage.toFixed(2)}%"\n`}),n+="\n"),e.recentExpenses&&e.recentExpenses.length>0){n+="المصروفات الحديثة (آخر 10 مصروفات)\n",n+="اسم المصروف,النوع,المبلغ,طريقة الدفع,تاريخ الدفع,المورد,رقم الإيصال,ملاحظات\n";const t={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},a={cash:"نقداً",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمان"};e.recentExpenses.slice(0,10).forEach(e=>{const s=e.expense_name||"غير محدد",r=t[e.expense_type]||e.expense_type||"غير محدد",i=Mn(e.amount||0),l=a[e.payment_method]||e.payment_method||"غير محدد",o=e.payment_date?In(e.payment_date):"غير محدد",c=e.vendor||"غير محدد",d=e.receipt_number||"غير محدد",m=e.notes||"";n+=`"${s}","${r}","${i}","${l}","${o}","${c}","${d}","${m}"\n`}),n+="\n"}return n}static generateAppointmentCSV(e,t){let n="تقرير المواعيد - عيادة الأسنان الحديثة\n\n";return n+="ملخص إحصائيات المواعيد\n",n+=`إجمالي المواعيد,${e.totalAppointments||0}\n`,n+=`المواعيد المكتملة,${e.completedAppointments||0}\n`,n+=`المواعيد الملغية,${e.cancelledAppointments||0}\n`,n+=`المواعيد المجدولة,${e.scheduledAppointments||0}\n`,n+=`عدم الحضور,${e.noShowAppointments||0}\n`,n+=`معدل الحضور,${e.attendanceRate?.toFixed(1)||"0.0"}%\n`,n+=`معدل الإلغاء,${e.cancellationRate?.toFixed(1)||"0.0"}%\n\n`,e.appointmentsByStatus&&e.appointmentsByStatus.length>0&&(n+="توزيع حالات المواعيد\n",n+="الحالة,العدد,النسبة المئوية\n",e.appointmentsByStatus.forEach(e=>{const t=e.percentage?.toFixed(1)||"0.0";n+=`"${e.status}",${e.count},${t}%\n`}),n+="\n"),e.appointmentsByTreatment&&e.appointmentsByTreatment.length>0&&(n+="توزيع المواعيد حسب نوع العلاج\n",n+="نوع العلاج,عدد المواعيد\n",e.appointmentsByTreatment.forEach(e=>{n+=`"${e.treatment}",${e.count}\n`}),n+="\n"),e.filterInfo&&(n+="معلومات الفلترة\n",n+=`نطاق البيانات,"${e.filterInfo}"\n`,n+=`عدد المواعيد المصدرة,${e.dataCount||e.totalAppointments||0}\n`),n}static generateInventoryCSV(e,t){let n="تقرير المخزون - عيادة الأسنان الحديثة\n\n";return n+="ملخص إحصائيات المخزون\n",n+=`إجمالي العناصر,${e.totalItems||0}\n`,n+=`القيمة الإجمالية,${Mn(e.totalValue||0)}\n`,n+=`عناصر منخفضة المخزون,${e.lowStockItems||0}\n`,n+=`عناصر منتهية الصلاحية,${e.expiredItems||0}\n`,n}static generateOverviewCSV(e,t){let n="التقرير الشامل - عيادة الأسنان الحديثة\n\n";return e.patients&&(n+=this.generatePatientCSV(e.patients,t)+"\n\n"),e.appointments&&(n+=this.generateAppointmentCSV(e.appointments,t)+"\n\n"),e.financial&&(n+=this.generateFinancialCSV(e.financial,t)+"\n\n"),e.inventory&&(n+=this.generateInventoryCSV(e.inventory,t)),n}static async exportClinicNeedsToCSV(e,t="clinic-needs-report"){try{const n=e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return"--";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${n}/${a}/${t.getFullYear()}`}catch(t){return"--"}},a=[["#","اسم الاحتياج","الكمية","السعر","الإجمالي","الوصف","الفئة","الأولوية","الحالة","المورد","الملاحظات","تاريخ الإنشاء","تاريخ التحديث"],...e.map(e=>[e.serial_number||"",e.need_name||"",e.quantity?.toString()||"0",e.price?.toString()||"0",((e.price||0)*(e.quantity||0)).toString(),e.description||"",e.category||"",this.getPriorityLabel(e.priority||""),this.getStatusLabel(e.status||""),e.supplier||"",e.notes||"",e.created_at?n(e.created_at):"",e.updated_at?n(e.updated_at):""])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),s="\ufeff"+a;console.log(`✅ Clinic needs exported to Excel: ${t}.xlsx`);const r={format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"};await this.convertCSVToExcel(s,"clinic-needs",r)}catch(n){throw console.error("Error exporting clinic needs to CSV:",n),new Error("فشل في تصدير احتياجات العيادة إلى CSV")}}static getPriorityLabel(e){return{urgent:"عاجل",high:"عالي",medium:"متوسط",low:"منخفض"}[e]||e}static getStatusLabel(e){return{pending:"معلق",ordered:"مطلوب",received:"مستلم",cancelled:"ملغي"}[e]||e}static async exportPatientsToPDF(e,t="عيادة الأسنان الحديثة"){const n=new Date,a=new Date(n.getFullYear(),n.getMonth(),1),s=e.filter(e=>new Date(e.created_at)>=a).length,r={children:0,teens:0,adults:0,seniors:0},i={male:0,female:0};let l=0,o=0;e.forEach(e=>{if(e.age&&"number"==typeof e.age&&e.age>0){const t=e.age;l+=t,o++,t<13?r.children++:t<20?r.teens++:t<60?r.adults++:r.seniors++}"male"===e.gender?i.male++:"female"===e.gender&&i.female++});const c=o>0?Math.round(l/o):0,d={totalPatients:e.length,newPatientsThisMonth:s,activePatients:e.length,averageAge:c,patients:e,ageDistribution:[{ageGroup:"أطفال (0-12)",count:r.children},{ageGroup:"مراهقون (13-19)",count:r.teens},{ageGroup:"بالغون (20-59)",count:r.adults},{ageGroup:"كبار السن (60+)",count:r.seniors}],genderDistribution:[{gender:"ذكور",count:i.male},{gender:"إناث",count:i.female}],registrationTrend:[]};await this.exportToPDF("patients",d,{format:"pdf",includeCharts:!1,includeDetails:!0,language:"ar",orientation:"landscape",pageSize:"A4"})}static async exportAppointmentsToPDF(e,t="عيادة الأسنان الحديثة"){const n=e.length,a=e.filter(e=>"completed"===e.status).length,s=e.filter(e=>"cancelled"===e.status).length,r=e.filter(e=>"no-show"===e.status).length,i=e.filter(e=>"scheduled"===e.status).length,l=n>0?Math.round(a/n*100):0,o=n>0?Math.round(s/n*100):0,c={totalAppointments:n,completedAppointments:a,cancelledAppointments:s,noShowAppointments:r,scheduledAppointments:i,attendanceRate:l,cancellationRate:o,appointmentsByStatus:[{status:"مكتمل",count:a,percentage:l},{status:"ملغي",count:s,percentage:o},{status:"لم يحضر",count:r,percentage:n>0?Math.round(r/n*100):0},{status:"مجدول",count:i,percentage:n>0?Math.round(i/n*100):0}],appointmentsByTreatment:[],appointmentsByDay:[],appointmentsByHour:[],peakHours:[],appointmentTrend:[],filterInfo:`البيانات المصدرة: ${n} موعد`,dataCount:n};await this.exportToPDF("appointments",c,{format:"pdf",includeCharts:!1,includeDetails:!0,language:"ar",orientation:"landscape",pageSize:"A4"})}static async exportPaymentsToPDF(e,t="عيادة الأسنان الحديثة"){const n=e.reduce((e,t)=>e+Number(t.amount),0),a=e.filter(e=>"completed"===e.status).reduce((e,t)=>e+Number(t.amount),0),s=e.filter(e=>"partial"===e.status).reduce((e,t)=>e+Number(t.amount),0),r=e.filter(e=>"pending"===e.status).reduce((e,t)=>e+Number(t.amount),0),i=e.filter(e=>"overdue"===e.status).reduce((e,t)=>e+Number(t.amount),0),l=e.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>{const n=t.payment_method||"غير محدد";e[n]||(e[n]={count:0,amount:0}),e[n].count++;const a=Number(t.amount);return e[n].amount+=a,e},{}),o={totalRevenue:n,completedPayments:a+s,pendingPayments:r,overduePayments:i,paymentMethodStats:Object.entries(l).map(([e,t])=>({method:e,count:t.count,amount:t.amount})),monthlyRevenue:[],revenueTrend:[],topTreatments:[],outstandingBalance:r+i,filterInfo:`البيانات المصدرة: ${e.length} دفعة (مكتملة: ${e.filter(e=>"completed"===e.status).length}, جزئية: ${e.filter(e=>"partial"===e.status).length})`,dataCount:e.length};await this.exportToPDF("financial",o,{format:"pdf",includeCharts:!1,includeDetails:!0,language:"ar",orientation:"landscape",pageSize:"A4"})}static async exportPatientsToExcel(e){const t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1),a=e.filter(e=>new Date(e.created_at)>=n).length,s={children:0,teens:0,adults:0,seniors:0},r={male:0,female:0};let i=0,l=0;e.forEach(e=>{if(e.age&&"number"==typeof e.age&&e.age>0){const t=e.age;i+=t,l++,t<13?s.children++:t<20?s.teens++:t<60?s.adults++:s.seniors++}"male"===e.gender?r.male++:"female"===e.gender&&r.female++});const o=l>0?Math.round(i/l):0,c={totalPatients:e.length,newPatientsThisMonth:a,activePatients:e.length,averageAge:o,patients:e,ageDistribution:[{ageGroup:"أطفال (0-12)",count:s.children},{ageGroup:"مراهقون (13-19)",count:s.teens},{ageGroup:"بالغون (20-59)",count:s.adults},{ageGroup:"كبار السن (60+)",count:s.seniors}],genderDistribution:[{gender:"ذكور",count:r.male},{gender:"إناث",count:r.female}],registrationTrend:[]};await this.exportToExcel("patients",c,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})}static async exportAppointmentsToExcel(e){const t=e.length,n=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"cancelled"===e.status).length,s=e.filter(e=>"no-show"===e.status).length,r=e.filter(e=>"scheduled"===e.status).length,i=t>0?Math.round(n/t*100):0,l=t>0?Math.round(a/t*100):0,o={totalAppointments:t,completedAppointments:n,cancelledAppointments:a,noShowAppointments:s,scheduledAppointments:r,attendanceRate:i,cancellationRate:l,appointmentsByStatus:[{status:"مكتمل",count:n,percentage:i},{status:"ملغي",count:a,percentage:l},{status:"لم يحضر",count:s,percentage:t>0?Math.round(s/t*100):0},{status:"مجدول",count:r,percentage:t>0?Math.round(r/t*100):0}],appointmentsByTreatment:[],appointmentsByDay:[],appointmentsByHour:[],peakHours:[],appointmentTrend:[],filterInfo:`البيانات المصدرة: ${t} موعد`,dataCount:t};await this.exportToExcel("appointments",o,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})}static async exportTreatmentsToCSV(e){const t=[];t.push(["نوع العلاج","فئة العلاج","حالة العلاج","التكلفة","تاريخ البداية","تاريخ الإنجاز","اسم المريض","رقم السن","تاريخ الإنشاء"]),e.forEach(e=>{var n;t.push([ka(e.treatment_type||""),Sa(e.treatment_category||""),(n=e.treatment_status||"planned",{planned:"مخطط",in_progress:"قيد التنفيذ",completed:"مكتمل",cancelled:"ملغي"}[n]||n),e.cost||0,e.start_date||"",e.completion_date||"",e.patient_name||`مريض ${e.patient_id}`,e.tooth_number||"",e.created_at||""])});const n=e.length,a=e.filter(e=>"completed"===e.treatment_status).length,s=e.filter(e=>"planned"===e.treatment_status).length,r=e.filter(e=>"in_progress"===e.treatment_status).length,i=e.filter(e=>"cancelled"===e.treatment_status).length,l=e.filter(e=>"completed"===e.treatment_status).reduce((e,t)=>e+(e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100})(t.cost),0),o=n>0?Math.round(a/n*100):0;t.push([]),t.push(["ملخص الإحصائيات"]),t.push(["إجمالي العلاجات",n]),t.push(["العلاجات المكتملة",a]),t.push(["العلاجات المخططة",s]),t.push(["العلاجات قيد التنفيذ",r]),t.push(["العلاجات الملغية",i]),t.push(["إجمالي الإيرادات",l]),t.push(["معدل الإنجاز (%)",o]);const c="\ufeff"+t.map(e=>e.map(e=>`"${e}"`).join(",")).join("\n");await this.convertCSVToExcel(c,"treatments",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"})}static async exportPaymentsToExcel(e){const t=e.reduce((e,t)=>e+Number(t.amount),0),n=e.filter(e=>"completed"===e.status).reduce((e,t)=>e+Number(t.amount),0),a=e.filter(e=>"partial"===e.status).reduce((e,t)=>e+Number(t.amount),0),s=new Date;s.setDate(s.getDate()-30);const r=e.filter(e=>"pending"===e.status).filter(e=>new Date(e.payment_date||e.created_at)>=s).reduce((e,t)=>{const n=Number(t.amount)||0,a=Number(t.total_amount_due)||0;return e+(0===n&&a>0?a:n)},0),i=e.filter(e=>"pending"===e.status).filter(e=>new Date(e.payment_date||e.created_at)<s).reduce((e,t)=>{const n=Number(t.amount)||0,a=Number(t.total_amount_due)||0;return e+(0===n&&a>0?a:n)},0),l=e.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>{const n=t.payment_method||"غير محدد";e[n]||(e[n]={count:0,amount:0}),e[n].count++;const a=Number(t.amount);return e[n].amount+=a,e},{}),o=Object.entries(l).map(([e,t])=>({method:e,count:t.count,amount:t.amount})),c=new Map;let d=0;e.forEach(e=>{if("partial"===e.status)if(e.appointment_id){const t=e.appointment_id,n=Number(e.total_amount_due||e.appointment_total_cost||0),a=Number(e.amount||0);c.has(t)||c.set(t,{totalDue:n,totalPaid:0});c.get(t).totalPaid+=a}else{const t=Number(e.total_amount_due||e.amount||0),n=Number(e.amount_paid||e.amount||0);d+=Math.max(0,t-n)}});const m=Array.from(c.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0)+d,u={totalRevenue:t,completedPayments:n+a,pendingPayments:r,overduePayments:i,paymentMethodStats:o,monthlyRevenue:[],revenueTrend:[],topTreatments:[],outstandingBalance:r+i+m,filterInfo:`البيانات المصدرة: ${e.length} دفعة (مكتملة: ${e.filter(e=>"completed"===e.status).length}, جزئية: ${e.filter(e=>"partial"===e.status).length}, معلقة: ${e.filter(e=>"pending"===e.status).length}, متأخرة: ${i>0?e.filter(e=>"pending"===e.status&&new Date(e.payment_date||e.created_at)<s).length:0}, مبلغ متبقي من الجزئية: ${Mn(m)})`,dataCount:e.length};await this.exportToExcel("financial",u,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})}static async exportPaymentsToCSV(e){const t=e.reduce((e,t)=>e+Number(t.amount),0),n=e.filter(e=>"completed"===e.status).reduce((e,t)=>e+Number(t.amount),0),a=e.filter(e=>"partial"===e.status).reduce((e,t)=>e+Number(t.amount),0),s=new Date;s.setDate(s.getDate()-30);const r=e.filter(e=>"pending"===e.status).filter(e=>new Date(e.payment_date||e.created_at)>=s).reduce((e,t)=>{const n=Number(t.amount)||0,a=Number(t.total_amount_due)||0;return e+(0===n&&a>0?a:n)},0),i=e.filter(e=>"pending"===e.status).filter(e=>new Date(e.payment_date||e.created_at)<s).reduce((e,t)=>{const n=Number(t.amount)||0,a=Number(t.total_amount_due)||0;return e+(0===n&&a>0?a:n)},0),l=e.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>{const n=t.payment_method||"غير محدد";e[n]||(e[n]={count:0,amount:0}),e[n].count++;const a=Number(t.amount);return e[n].amount+=a,e},{}),o=Object.entries(l).map(([e,t])=>({method:e,count:t.count,amount:t.amount})),c=new Map;let d=0;e.forEach(e=>{if("partial"===e.status)if(e.appointment_id){const t=e.appointment_id,n=Number(e.total_amount_due||e.appointment_total_cost||0),a=Number(e.amount||0);c.has(t)||c.set(t,{totalDue:n,totalPaid:0});c.get(t).totalPaid+=a}else{const t=Number(e.total_amount_due||e.amount||0),n=Number(e.amount_paid||e.amount||0);d+=Math.max(0,t-n)}});const m=Array.from(c.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0)+d,u={totalRevenue:t,completedPayments:n+a,pendingPayments:r,overduePayments:i,paymentMethodStats:o,monthlyRevenue:[],revenueTrend:[],topTreatments:[],outstandingBalance:r+i+m,filterInfo:`البيانات المصدرة: ${e.length} دفعة (مكتملة: ${e.filter(e=>"completed"===e.status).length}, جزئية: ${e.filter(e=>"partial"===e.status).length}, معلقة: ${e.filter(e=>"pending"===e.status).length}, متأخرة: ${i>0?e.filter(e=>"pending"===e.status&&new Date(e.payment_date||e.created_at)<s).length:0}, مبلغ متبقي من الجزئية: ${Mn(m)})`,dataCount:e.length,payments:e};await this.exportToCSV("financial",u,{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"})}static async exportLabsToExcel(e,t){const n=e.length,a=t.length,s=t.reduce((e,t)=>e+Number(t.cost),0),r=t.reduce((e,t)=>e+Number(t.paid_amount||0),0),i=t.reduce((e,t)=>e+Number(t.remaining_balance||0),0),l={summary:{"إجمالي المختبرات":n,"إجمالي الطلبات":a,"إجمالي التكلفة":Mn(s),"إجمالي المدفوع":Mn(r),"إجمالي المتبقي":Mn(i),"تاريخ التقرير":In(new Date)},labs:e.map(e=>({...e,ordersCount:t.filter(t=>t.lab_id===e.id).length})),labOrders:t,filterInfo:`البيانات المصدرة: ${e.length} مختبر، ${t.length} طلب`,dataCount:e.length+t.length};await this.exportToExcel("labs",l,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})}static async exportClinicNeedsToExcel(e){const t={summary:{"إجمالي الاحتياجات":e.length,"احتياجات معلقة":e.filter(e=>"pending"===e.status).length,"احتياجات مطلوبة":e.filter(e=>"ordered"===e.status).length,"احتياجات مستلمة":e.filter(e=>"received"===e.status).length,"احتياجات عاجلة":e.filter(e=>"urgent"===e.priority).length,"احتياجات عالية الأولوية":e.filter(e=>"high"===e.priority).length,"تاريخ التقرير":In(new Date)},needs:e,filterInfo:`البيانات المصدرة: ${e.length} احتياج`,dataCount:e.length};await this.exportToExcel("clinic-needs",t,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})}static async exportInventoryToExcel(e){const t=e.length,n=e.filter(e=>{const t=parseFloat(String(e.cost_per_unit||0))||0,n=parseFloat(String(e.unit_price||0))||0;return 0===t&&0===n});n.length>0&&console.warn(`⚠️ ${n.length} عنصر لا يحتوي على سعر:`,n.map(e=>e.name));const a=e.reduce((e,t)=>{const n=parseFloat(String(t.quantity||0))||0,a=parseFloat(String(t.cost_per_unit||0))||0,s=parseFloat(String(t.unit_price||0))||0;return e+n*(a||s)},0),s=e.filter(e=>Number(e.quantity)<=Number(e.minimum_stock||0)).length,r=e.filter(e=>0===Number(e.quantity)).length,i=e.filter(e=>e.expiry_date&&new Date(e.expiry_date)<new Date).length,l={summary:{"إجمالي العناصر":t,"القيمة الإجمالية":Mn(a),"عناصر منخفضة المخزون":s,"عناصر نفدت من المخزون":r,"عناصر منتهية الصلاحية":i,"عناصر بدون أسعار":n.length,"تاريخ التقرير":In(new Date)},items:e,filterInfo:`البيانات المصدرة: ${e.length} عنصر${n.length>0?` (${n.length} بدون أسعار)`:""}`,dataCount:e.length};await this.exportToExcel("inventory",l,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})}static async exportClinicExpensesToExcel(e){if(!e||0===e.length)throw new Error("لا توجد بيانات مصروفات للتصدير");const t=e.reduce((e,t)=>e+(parseFloat(String(t.amount||0))||0),0),n=e.filter(e=>"paid"===e.status).reduce((e,t)=>e+(parseFloat(String(t.amount||0))||0),0),a=e.filter(e=>"pending"===e.status).reduce((e,t)=>e+(parseFloat(String(t.amount||0))||0),0),s=e.filter(e=>"overdue"===e.status).reduce((e,t)=>e+(parseFloat(String(t.amount||0))||0),0),r={summary:{"إجمالي المصروفات":e.length,"إجمالي المبلغ":Mn(t),"المبلغ المدفوع":Mn(n),"المبلغ المعلق":Mn(a),"المبلغ المتأخر":Mn(s),"تاريخ التقرير":In(new Date)},expenses:e,filterInfo:`البيانات المصدرة: ${e.length} مصروف`,dataCount:e.length};await this.exportToExcel("clinic-expenses",r,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})}static filterDataByDateRange(e,t,n){if(!t||!t.start||!t.end)return e;const a=new Date(t.start),s=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),r=new Date(t.end),i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);return e.filter(e=>{const t=e[n];if(!t)return!1;const a=new Date(t);let r;return r=t.includes("T")||t.includes(" ")?a:new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),r>=s&&r<=i})}static async exportProfitLossToExcel(e){const{reportData:t,payments:n,labOrders:a,clinicNeeds:s,inventoryItems:r,clinicExpenses:i,patients:l,appointments:o,filter:c,currency:d}=e,m=this.filterDataByDateRange(n,c,"payment_date"),u=this.filterDataByDateRange(a,c,"order_date"),p=this.filterDataByDateRange(s,c,"created_at"),h=this.filterDataByDateRange(o,c,"created_at"),x=this.filterDataByDateRange(r,c,"created_at"),g=i?this.filterDataByDateRange(i,c,"payment_date"):[],f={summary:{"إجمالي الإيرادات":Mn(t.revenue.totalRevenue),"إجمالي المصروفات":Mn(t.calculations.totalExpenses),"صافي الربح/الخسارة":Mn(t.calculations.isProfit?t.calculations.netProfit:-t.calculations.lossAmount),"نسبة الربح":`${t.calculations.profitMargin.toFixed(2)}%`,"حالة المالية":t.calculations.isProfit?"ربح":"خسارة","إجمالي المرضى":t.details.totalPatients,"إجمالي المواعيد":t.details.totalAppointments,"متوسط الإيرادات لكل مريض":Mn(t.details.averageRevenuePerPatient),"متوسط الإيرادات لكل موعد":Mn(t.details.averageRevenuePerAppointment),"الفترة الزمنية":t.filterInfo.dateRange,"تاريخ التقرير":In(new Date)},revenue:{completedPayments:t.revenue.completedPayments,partialPayments:t.revenue.partialPayments,remainingBalances:t.revenue.remainingBalances,pendingPayments:t.revenue.pendingAmount||0,totalRevenue:t.revenue.totalRevenue},expenses:{labOrdersTotal:t.expenses.labOrdersTotal,labOrdersRemaining:t.expenses.labOrdersRemaining,clinicNeedsTotal:t.expenses.clinicNeedsTotal,clinicNeedsRemaining:t.expenses.clinicNeedsRemaining,inventoryExpenses:t.expenses.inventoryExpenses,clinicExpensesTotal:t.expenses.clinicExpensesTotal||0},payments:m,labOrders:u,clinicNeeds:p,inventoryItems:x,clinicExpenses:g,patients:l,appointments:h,filterInfo:`تقرير الأرباح والخسائر - ${t.filterInfo.dateRange} - ${m.length} دفعة، ${u.length} طلب مختبر، ${p.length} احتياج، ${x.length} عنصر مخزون، ${g.length} مصروف`,dataCount:m.length+u.length+p.length+x.length+g.length};await this.exportToExcel("profit-loss",f,{format:"excel",includeCharts:!1,includeDetails:!0,language:"ar"})}static generateProfitLossCSV(e,t){let n="";return n+="التقرير الشامل للأرباح والخسائر\n",n+=`تاريخ التقرير,${In(new Date)}\n`,n+=`وقت التقرير,${(new Date).toLocaleTimeString("ar-SA")}\n\n`,e.summary&&(n+="ملخص الأرباح والخسائر\n",Object.entries(e.summary).forEach(([e,t])=>{n+=`${e},${t}\n`}),n+="\n"),e.revenue&&(n+="تفاصيل الإيرادات\n",n+=`المدفوعات المكتملة,${Mn(e.revenue.completedPayments||0)}\n`,n+=`المدفوعات الجزئية,${Mn(e.revenue.partialPayments||0)}\n`,n+=`المبالغ المتبقية,${Mn(e.revenue.remainingBalances||0)}\n`,n+=`إجمالي الإيرادات,${Mn(e.revenue.totalRevenue||0)}\n\n`),e.expenses&&(n+="تفاصيل المصروفات\n",n+=`مدفوعات المخابر,${Mn(e.expenses.labOrdersTotal||0)}\n`,n+=`متبقي المخابر,${Mn(e.expenses.labOrdersRemaining||0)}\n`,n+=`احتياجات العيادة,${Mn(e.expenses.clinicNeedsTotal||0)}\n`,n+=`متبقي الاحتياجات,${Mn(e.expenses.clinicNeedsRemaining||0)}\n`,n+=`قيمة المخزون,${Mn(e.expenses.inventoryExpenses||0)}\n`,n+=`مصروفات العيادة المباشرة,${Mn(e.expenses.clinicExpensesTotal||0)}\n\n`),e.payments&&e.payments.length>0&&(n+="تفاصيل المدفوعات\n",n+="رقم المريض,اسم المريض,المبلغ,الحالة,طريقة الدفع,تاريخ الدفع,ملاحظات\n",e.payments.forEach(e=>{const t="completed"===e.status?"مكتمل":"partial"===e.status?"جزئي":"معلق",a=e.payment_date?In(e.payment_date):"";n+=`${e.patient_id||""},${e.patient_name||""},${Mn(e.amount||0)},${t},${e.payment_method||""},${a},"${e.notes||""}"\n`}),n+="\n"),e.labOrders&&e.labOrders.length>0&&(n+="تفاصيل طلبات المخابر\n",n+="رقم الطلب,اسم المختبر,اسم المريض,التكلفة,المدفوع,المتبقي,الحالة,تاريخ الطلب\n",e.labOrders.forEach(e=>{const t="completed"===e.status?"مكتمل":"pending"===e.status?"معلق":"ملغي",a=e.order_date?In(e.order_date):"",s=(e.cost||0)-(e.paid_amount||0);n+=`${e.id||""},${e.lab?.name||""},${e.patient?.full_name||""},${Mn(e.cost||0)},${Mn(e.paid_amount||0)},${Mn(s)},${t},${a}\n`}),n+="\n"),e.clinicNeeds&&e.clinicNeeds.length>0&&(n+="تفاصيل احتياجات العيادة\n",n+="اسم العنصر,الكمية,الأولوية,الحالة,التاريخ المطلوب,التاريخ المستلم,ملاحظات\n",e.clinicNeeds.forEach(e=>{const t="urgent"===e.priority?"عاجل":"high"===e.priority?"عالي":"عادي",a="received"===e.status?"مستلم":"ordered"===e.status?"مطلوب":"معلق",s=e.date_needed?In(e.date_needed):"",r=e.date_received?In(e.date_received):"";n+=`${e.item_name||""},${e.quantity||0},${t},${a},${s},${r},"${e.notes||""}"\n`}),n+="\n"),e.inventoryItems&&e.inventoryItems.length>0&&(n+="تفاصيل المخزون\n",n+="اسم العنصر,الكمية,سعر الوحدة,القيمة الإجمالية,الحد الأدنى,تاريخ الانتهاء,الفئة\n",e.inventoryItems.forEach(e=>{const t=parseFloat(String(e.cost_per_unit||0))||0,a=parseFloat(String(e.unit_price||0))||0,s=t||a,r=parseFloat(String(e.quantity||0))||0,i=r*s,l=e.expiry_date?In(e.expiry_date):"";n+=`${e.name||""},${r},${Mn(s)},${Mn(i)},${e.minimum_stock||0},${l},${e.category||""}\n`}),n+="\n"),e.clinicExpenses&&e.clinicExpenses.length>0&&(n+="تفاصيل مصروفات العيادة\n",n+="اسم المصروف,النوع,المبلغ,طريقة الدفع,تاريخ الدفع,المورد,ملاحظات\n",e.clinicExpenses.forEach(e=>{const t=e.payment_date?In(e.payment_date):"";n+=`${e.expense_name||""},${e.expense_type||""},${Mn(e.amount||0)},${e.payment_method||""},${t},${e.vendor||""},"${e.notes||""}"\n`}),n+="\n"),n+="معلومات التقرير\n",n+=`${e.filterInfo||""}\n`,n+=`إجمالي السجلات,${e.dataCount||0}\n`,n}};function Qc(){ua(),ha();const{toast:t}=Bl(),[n,a]=re.useState(!1),[s,r]=re.useState(!1),[i,l]=re.useState(!1),[o,c]=re.useState(!1),[d,m]=re.useState(!1),[u,p]=re.useState(null),[h,x]=re.useState(void 0),{payments:g,filteredPayments:f,isLoading:v,error:y,searchQuery:b,statusFilter:j,paymentMethodFilter:w,totalRevenue:N,pendingAmount:_,totalRemainingBalance:k,partialPaymentsCount:S,pendingPaymentsCount:C,paymentMethodStats:$,loadPayments:D,deletePayment:E,clearError:T,setSearchQuery:A,setStatusFilter:F,setPaymentMethodFilter:P}=ca(),{loadPatients:R,patients:O}=bt(),M=Tc({data:g,dateField:"payment_date",initialFilter:{preset:"all",startDate:"",endDate:""}});re.useEffect(()=>{D(),R()},[D,R]),re.useEffect(()=>{(()=>{try{const e=localStorage.getItem("selectedPatientForPayment");if(e){const t=JSON.parse(e);console.log("Found pre-selected patient for payment:",t),x(t.selectedPatientId),t.openAddDialog&&a(!0),localStorage.removeItem("selectedPatientForPayment")}}catch(e){console.error("Error reading pre-selected patient for payment:",e)}})()},[]),re.useEffect(()=>{const e=localStorage.getItem("selectedPaymentForDetails");if(e)try{const{payment:t,openDetailsModal:n}=JSON.parse(e);n&&t&&(p(t),c(!0),localStorage.removeItem("selectedPaymentForDetails"))}catch(t){console.error("Error parsing search result data:",t),localStorage.removeItem("selectedPaymentForDetails")}},[]),re.useEffect(()=>{y&&(t({title:"خطأ",description:y,variant:"destructive"}),T())},[y,t,T]);const L=""!==b||"all"!==j||"all"!==w;return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-heading-1 text-foreground arabic-enhanced",children:"إدارة المدفوعات"}),e.jsx("p",{className:"text-body text-muted-foreground mt-2 arabic-enhanced",children:"تتبع المدفوعات والفواتير والسجلات المالية"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",onClick:async()=>{if(0!==g.length)try{const e=e=>{const t=O.find(t=>t.id===e.patient_id);return t?.full_name||"غير محدد"};let t=[...g];if(M.timeFilter.startDate&&M.timeFilter.endDate){const e=new Date(M.timeFilter.startDate),n=new Date(M.timeFilter.endDate);n.setHours(23,59,59,999),t=t.filter(t=>{const a=new Date(t.payment_date);return a>=e&&a<=n})}b&&(t=t.filter(t=>{const n=e(t);return t.receipt_number?.toLowerCase().includes(b.toLowerCase())||t.description?.toLowerCase().includes(b.toLowerCase())||n.toLowerCase().includes(b.toLowerCase())||t.amount.toString().includes(b)||t.payment_method.toLowerCase().includes(b.toLowerCase())||t.status.toLowerCase().includes(b.toLowerCase())})),"all"!==j&&(t=t.filter(e=>e.status===j)),"all"!==w&&(t=t.filter(e=>e.payment_method===w)),await Zc.exportPaymentsToExcel(t);let n=`تم تصدير ${t.length} دفعة بنجاح إلى ملف Excel!`;M.timeFilter.startDate&&M.timeFilter.endDate&&(n+=` (مفلترة من ${M.timeFilter.startDate} إلى ${M.timeFilter.endDate})`),("all"!==j||"all"!==w||b)&&(n+=" مع فلاتر مطبقة"),Kc.exportSuccess(n)}catch(e){console.error("Error exporting payments:",e),Kc.exportError("فشل في تصدير بيانات المدفوعات")}else Kc.noDataToExport("لا توجد بيانات مدفوعات للتصدير")},children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير"]}),e.jsxs(Lr,{onClick:()=>{console.log("Add payment clicked"),x(void 0),a(!0)},children:[e.jsx(Zs,{className:"w-4 h-4 ml-2"}),"تسجيل دفعة جديدة"]})]})]}),e.jsx(Ec,{value:M.timeFilter,onChange:M.handleFilterChange,onClear:M.resetFilter,title:"فلترة زمنية - المدفوعات",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(nc,{className:pc("green"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground",children:"all"===M.timeFilter.preset||!M.timeFilter.startDate&&!M.timeFilter.endDate?"إجمالي الإيرادات":"الإيرادات المفلترة"}),e.jsx(gs,{className:`h-4 w-4 ${hc("green")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===M.timeFilter.preset||!M.timeFilter.startDate&&!M.timeFilter.endDate?Mn(N):Mn(M.financialStats.totalRevenue)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===M.timeFilter.preset||!M.timeFilter.startDate&&!M.timeFilter.endDate?"من المدفوعات المكتملة والجزئية":"من المدفوعات المكتملة والجزئية في الفترة المحددة"}),M.trend&&e.jsxs("div",{className:"text-xs flex items-center mt-1 "+(M.trend.isPositive?"text-green-600":"text-red-600"),children:[e.jsx(ur,{className:"w-3 h-3 ml-1 "+(M.trend.isPositive?"":"rotate-180")}),e.jsxs("span",{children:[Math.abs(M.trend.changePercent),"% من الفترة السابقة"]})]})]})]}),e.jsxs(nc,{className:pc("red"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground",children:"all"===M.timeFilter.preset||!M.timeFilter.startDate&&!M.timeFilter.endDate?"المبالغ غير المدفوعة":"المبالغ غير المدفوعة المفلترة"}),e.jsx(qa,{className:`h-4 w-4 ${hc("red")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===M.timeFilter.preset||!M.timeFilter.startDate&&!M.timeFilter.endDate?Mn(_):Mn(M.financialStats.pendingAmount)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===M.timeFilter.preset||!M.timeFilter.startDate&&!M.timeFilter.endDate?"من العلاجات والمواعيد المعلقة":"من العلاجات والمواعيد المعلقة في الفترة المحددة"})]})]}),e.jsxs(nc,{className:pc("yellow"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground",children:"all"===M.timeFilter.preset||!M.timeFilter.startDate&&!M.timeFilter.endDate?"المبالغ المتبقية":"المبالغ المتبقية المفلترة"}),e.jsx(us,{className:`h-4 w-4 ${hc("yellow")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:(()=>{let e=[...g];if(M.timeFilter.startDate&&M.timeFilter.endDate){const t=new Date(M.timeFilter.startDate),n=new Date(M.timeFilter.endDate);n.setHours(23,59,59,999),e=e.filter(e=>{const a=new Date(e.payment_date);return a>=t&&a<=n})}b&&(e=e.filter(e=>{const t=O.find(t=>t.id===e.patient_id)?.full_name||"";return e.receipt_number?.toLowerCase().includes(b.toLowerCase())||e.description?.toLowerCase().includes(b.toLowerCase())||t.toLowerCase().includes(b.toLowerCase())||e.amount.toString().includes(b)||e.payment_method.toLowerCase().includes(b.toLowerCase())||e.status.toLowerCase().includes(b.toLowerCase())})),"all"!==j&&(e=e.filter(e=>e.status===j)),"all"!==w&&(e=e.filter(e=>e.payment_method===w));const t=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},n=new Map,a=new Map;let s=0;e.forEach(e=>{if("partial"===e.status)if(e.tooth_treatment_id){const a=e.tooth_treatment_id,s=t(e.treatment_total_cost||e.total_amount_due||0),r=t(e.amount);n.has(a)||n.set(a,{totalDue:s,totalPaid:0});n.get(a).totalPaid+=r}else if(e.appointment_id){const n=e.appointment_id,s=t(e.total_amount_due||0),r=t(e.amount);a.has(n)||a.set(n,{totalDue:s,totalPaid:0});a.get(n).totalPaid+=r}else{const n=t(e.total_amount_due||e.amount),a=t(e.amount_paid||e.amount);s+=Math.max(0,n-a)}});const r=Array.from(n.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0),i=Array.from(a.values()).reduce((e,t)=>e+Math.max(0,t.totalDue-t.totalPaid),0),l=t(r+i+s);return Mn(M.timeFilter.startDate&&M.timeFilter.endDate?l:k)})()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{let e=[...g];if(M.timeFilter.startDate&&M.timeFilter.endDate){const t=new Date(M.timeFilter.startDate),n=new Date(M.timeFilter.endDate);n.setHours(23,59,59,999),e=e.filter(e=>{const a=new Date(e.payment_date);return a>=t&&a<=n})}b&&(e=e.filter(e=>{const t=O.find(t=>t.id===e.patient_id)?.full_name||"";return e.receipt_number?.toLowerCase().includes(b.toLowerCase())||e.description?.toLowerCase().includes(b.toLowerCase())||t.toLowerCase().includes(b.toLowerCase())||e.amount.toString().includes(b)||e.payment_method.toLowerCase().includes(b.toLowerCase())||e.status.toLowerCase().includes(b.toLowerCase())})),"all"!==j&&(e=e.filter(e=>e.status===j)),"all"!==w&&(e=e.filter(e=>e.payment_method===w));const t=e.filter(e=>"partial"===e.status).length;return"all"===M.timeFilter.preset||!M.timeFilter.startDate&&!M.timeFilter.endDate?`من ${S} دفعة جزئية`:`من ${t} دفعة جزئية في الفترة المحددة`})()})]})]}),e.jsxs(nc,{className:pc("purple"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground",children:"all"===M.timeFilter.preset||!M.timeFilter.startDate&&!M.timeFilter.endDate?"معدل الإنجاز":"معدل الإنجاز المفلتر"}),e.jsx(ur,{className:`h-4 w-4 ${hc("purple")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:(()=>{let e=[...g];if(M.timeFilter.startDate&&M.timeFilter.endDate){const t=new Date(M.timeFilter.startDate),n=new Date(M.timeFilter.endDate);n.setHours(23,59,59,999),e=e.filter(e=>{const a=new Date(e.payment_date);return a>=t&&a<=n})}const t=e.length,n=e.filter(e=>"completed"===e.status).length;return`${t>0?(n/t*100).toFixed(1):"0.0"}%`})()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{let e=[...g];if(M.timeFilter.startDate&&M.timeFilter.endDate){const t=new Date(M.timeFilter.startDate),n=new Date(M.timeFilter.endDate);n.setHours(23,59,59,999),e=e.filter(e=>{const a=new Date(e.payment_date);return a>=t&&a<=n})}const t=e.filter(e=>"completed"===e.status).length,n=e.length;return"all"===M.timeFilter.preset||!M.timeFilter.startDate&&!M.timeFilter.endDate?`${t} مكتملة من ${n} إجمالي`:`${t} مكتملة من ${n} في الفترة المحددة`})()})]})]})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsx(sc,{className:"text-lg arabic-enhanced",children:"البحث والتصفية"})}),e.jsxs(ic,{children:[e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(tr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{placeholder:"البحث في المدفوعات...",value:b,onChange:e=>A(e.target.value),className:"pl-10 arabic-enhanced text-right"})]}),e.jsxs(Nl,{value:j,onValueChange:F,children:[e.jsxs(Sl,{className:"w-[180px]",children:[e.jsx(js,{className:"w-4 h-4 mr-2"}),e.jsx(kl,{placeholder:"تصفية حسب الحالة"})]}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الحالات"}),e.jsx(Al,{value:"completed",children:"مكتمل"}),e.jsx(Al,{value:"pending",children:"معلق"}),e.jsx(Al,{value:"partial",children:"جزئي"}),e.jsx(Al,{value:"overdue",children:"متأخر"}),e.jsx(Al,{value:"failed",children:"فاشل"}),e.jsx(Al,{value:"refunded",children:"مسترد"})]})]}),e.jsxs(Nl,{value:w,onValueChange:P,children:[e.jsxs(Sl,{className:"w-[180px]",children:[e.jsx(js,{className:"w-4 h-4 mr-2"}),e.jsx(kl,{placeholder:"تصفية حسب طريقة الدفع"})]}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع طرق الدفع"}),e.jsx(Al,{value:"cash",children:"نقداً"}),e.jsx(Al,{value:"card",children:"بطاقة ائتمان"}),e.jsx(Al,{value:"bank_transfer",children:"تحويل بنكي"}),e.jsx(Al,{value:"check",children:"شيك"}),e.jsx(Al,{value:"insurance",children:"تأمين"})]})]}),L&&e.jsxs(Lr,{variant:"outline",onClick:()=>{A(""),F("all"),P("all")},className:"flex items-center gap-2",children:[e.jsx(_r,{className:"w-4 h-4"}),"مسح الفلاتر"]})]})}),L&&e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground arabic-enhanced",children:["عرض ",f.length," من أصل ",g.length," مدفوعة"]})]})]}),e.jsx(Gc,{payments:f,patients:O,isLoading:v,onEdit:e=>{p(e),r(!0)},onDelete:e=>{p(e),l(!0)},onShowReceipt:e=>{p(e),c(!0)},onViewDetails:e=>{p(e),m(!0)}}),e.jsx(dc,{open:n,onOpenChange:e=>{a(e),e||x(void 0)},preSelectedPatientId:h}),u&&e.jsxs(e.Fragment,{children:[e.jsx(Ac,{open:s,onOpenChange:r,payment:u}),e.jsx(Fc,{open:i,onOpenChange:l,payment:u}),e.jsx(Ic,{open:o,onOpenChange:c,payment:u}),e.jsx(zc,{open:d,onOpenChange:m,payment:u,patients:O})]})]})}const Xc=de()(xt((e,t)=>({backups:[],isLoading:!1,error:null,isCreatingBackup:!1,isRestoringBackup:!1,lastBackupDate:null,autoBackupEnabled:!0,backupFrequency:"daily",loadBackups:async()=>{e({isLoading:!0,error:null});try{const[t,n]=await Promise.all([window.electronAPI.backup.list(),window.electronAPI.settings.get()]),a=Array.isArray(t)&&t.length>0&&"string"==typeof t[0]?t.map(e=>({name:e,path:e,size:0,created_at:(new Date).toISOString(),version:"1.0.0"})):t;e({backups:a,isLoading:!1,lastBackupDate:a.length>0?a[0].created_at:null,autoBackupEnabled:"disabled"!==n?.backup_frequency&&void 0!==n?.backup_frequency,backupFrequency:"disabled"===n?.backup_frequency||"hourly"===n?.backup_frequency?"daily":n?.backup_frequency||"daily"})}catch(t){e({error:t instanceof Error?t.message:"فشل في تحميل قائمة النسخ الاحتياطية",isLoading:!1})}},createBackup:async(n,a)=>{e({isCreatingBackup:!0,error:null});try{const s=await window.electronAPI.backup.create(n,a);return await t().loadBackups(),e({isCreatingBackup:!1}),s}catch(s){throw e({error:s instanceof Error?s.message:"فشل في إنشاء النسخة الاحتياطية",isCreatingBackup:!1}),s}},restoreBackup:async t=>{e({isRestoringBackup:!0,error:null});try{const n=await window.electronAPI.backup.restore(t);return e({isRestoringBackup:!1}),n}catch(n){throw e({error:n instanceof Error?n.message:"فشل في استعادة النسخة الاحتياطية",isRestoringBackup:!1}),n}},deleteBackup:async n=>{e({isLoading:!0,error:null});try{await window.electronAPI.backup.delete(n),await t().loadBackups()}catch(a){throw e({error:a instanceof Error?a.message:"فشل في حذف النسخة الاحتياطية",isLoading:!1}),a}},setAutoBackupEnabled:async n=>{e({autoBackupEnabled:n});try{const e=t().backupFrequency,a="monthly"===e?"weekly":e;await window.electronAPI.settings.update({backup_frequency:n?a:"disabled"})}catch(a){console.error("Failed to update backup settings:",a)}},setBackupFrequency:async n=>{e({backupFrequency:n});const{autoBackupEnabled:a}=t();if(a)try{const e="monthly"===n?"weekly":n;await window.electronAPI.settings.update({backup_frequency:e})}catch(s){console.error("Failed to update backup frequency:",s)}},selectBackupFile:async()=>{try{const e=await window.electronAPI.dialog.showOpenDialog({title:"اختر ملف النسخة الاحتياطية",filters:[{name:"نسخ احتياطية مع صور",extensions:["zip"]},{name:"ملفات قاعدة البيانات",extensions:["db","sqlite"]},{name:"ملفات النسخ الاحتياطية القديمة",extensions:["json"]},{name:"ملفات النسخ الاحتياطية الأخرى",extensions:["backup","bak"]},{name:"جميع الملفات",extensions:["*"]}],properties:["openFile"]});return e.canceled?null:e.filePaths[0]}catch(t){return e({error:t instanceof Error?t.message:"فشل في اختيار الملف"}),null}},runBackupTest:async()=>{e({isLoading:!0,error:null});try{const t=await window.electronAPI.backup.test();return e({isLoading:!1}),t}catch(t){return e({error:t instanceof Error?t.message:"فشل في تشغيل اختبار النسخ الاحتياطي",isLoading:!1}),{success:!1,results:[],error:t instanceof Error?t.message:"Unknown error"}}},clearError:()=>{e({error:null})},formatBackupSize:e=>{if(0===e)return"0 بايت";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["بايت","كيلوبايت","ميجابايت","جيجابايت"][t]},formatBackupDate:e=>{const t=new Date(e),n=t.getDate(),a=t.getMonth()+1,s=t.getFullYear(),r=t.getHours(),i=t.getMinutes();return`${n.toString().padStart(2,"0")}/${a.toString().padStart(2,"0")}/${s} في ${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},getBackupStatus:()=>{const{backups:e,backupFrequency:n,lastBackupDate:a}=t();let s=null;if(a){const e=new Date(a),t=new Date(e);switch(n){case"daily":t.setDate(t.getDate()+1);break;case"weekly":t.setDate(t.getDate()+7);break;case"monthly":t.setMonth(t.getMonth()+1)}const r=t.getDate(),i=t.getMonth()+1,l=t.getFullYear();s=`${r.toString().padStart(2,"0")}/${i.toString().padStart(2,"0")}/${l}`}return{totalBackups:e.length,lastBackup:a?t().formatBackupDate(a):null,nextScheduledBackup:s}}}),{name:"backup-store"})),Jc=["ما هو اسم أول مدرسة التحقت بها؟","ما هو اسم حيوانك الأليف الأول؟","في أي مدينة ولدت؟","ما هو اسم أفضل صديق لك في الطفولة؟","ما هو لقب والدتك؟","ما هو اسم الشارع الذي نشأت فيه؟","ما هو اسم مدرستك الثانوية؟","ما هو طعامك المفضل؟","ما هو اسم أول شركة عملت بها؟","ما هو رقمك المفضل؟"];function ed({open:t,onOpenChange:n,onSave:a,editMode:s=!1}){const[r,i]=re.useState("predefined"),[l,o]=re.useState(""),[c,d]=re.useState(""),[m,u]=re.useState(""),[p,h]=re.useState(!1),[x,g]=re.useState(""),[f,v]=re.useState(""),[y,b]=re.useState("");re.useEffect(()=>{t&&(j(),i("predefined"),o(""),d(""),u(""),g(""),v(""))},[t]);const j=async()=>{if(s)try{const e=await window.electronAPI.settings.get();e?.security_question&&b(e.security_question)}catch(e){console.error("Error loading current security question:",e)}},w=async()=>{const e="predefined"===r?l:c;if(e.trim())if(m.trim())if(m.trim().length<2)g("إجابة سؤال الأمان يجب أن تكون حرفين على الأقل");else{h(!0),g("");try{const t=await Gr(m.trim().toLowerCase());await window.electronAPI.settings.update({security_question:e.trim(),security_answer:t}),v(s?"تم تحديث سؤال الأمان بنجاح":"تم حفظ سؤال الأمان بنجاح"),setTimeout(()=>{a(),n(!1)},2e3)}catch(t){console.error("Error saving security question:",t),g("حدث خطأ في حفظ سؤال الأمان")}finally{h(!1)}}else g("يرجى إدخال إجابة سؤال الأمان");else g("يرجى اختيار أو إدخال سؤال الأمان")},N=()=>{i("predefined"),o(""),d(""),u(""),g(""),v(""),n(!1)};return e.jsx(Sr,{open:t,onOpenChange:N,children:e.jsxs(Dr,{className:"sm:max-w-lg",dir:"rtl",children:[e.jsx(Er,{children:e.jsxs(Ar,{className:"flex items-center gap-2 text-right",children:[e.jsx(ar,{className:"w-5 h-5 text-primary"}),s?"تحديث سؤال الأمان":"إعداد سؤال الأمان"]})}),e.jsxs("div",{className:"space-y-6",children:[s&&y&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Cs,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-1",children:"سؤال الأمان الحالي"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300",children:y})]})]})}),e.jsxs(Ur,{children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsx(Hr,{children:"سؤال الأمان يُستخدم لاستعادة كلمة المرور في حالة نسيانها. اختر سؤالاً تتذكر إجابته بسهولة ولا يمكن للآخرين تخمينها."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Yr,{children:"نوع السؤال"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 space-x-reverse cursor-pointer",children:[e.jsx("input",{type:"radio",name:"questionType",value:"predefined",checked:"predefined"===r,onChange:e=>i(e.target.value),className:"text-primary"}),e.jsx("span",{children:"اختيار من القائمة"})]}),e.jsxs("label",{className:"flex items-center space-x-2 space-x-reverse cursor-pointer",children:[e.jsx("input",{type:"radio",name:"questionType",value:"custom",checked:"custom"===r,onChange:e=>i(e.target.value),className:"text-primary"}),e.jsx("span",{children:"سؤال مخصص"})]})]})]}),"predefined"===r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"predefinedQuestion",children:"اختر سؤال الأمان"}),e.jsxs(Nl,{value:l,onValueChange:o,children:[e.jsx(Sl,{className:"text-right",children:e.jsx(kl,{placeholder:"اختر سؤالاً من القائمة"})}),e.jsx(Dl,{children:Jc.map((t,n)=>e.jsx(Al,{value:t,children:t},n))})]})]}),"custom"===r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"customQuestion",children:"سؤال الأمان المخصص"}),e.jsx(Ir,{id:"customQuestion",type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"أدخل سؤال الأمان الخاص بك",className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"answer",children:"إجابة سؤال الأمان"}),e.jsx(Ir,{id:"answer",type:"text",value:m,onChange:e=>u(e.target.value),placeholder:"أدخل إجابة سؤال الأمان",className:"text-right",onKeyDown:e=>"Enter"===e.key&&w()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ملاحظة: الإجابة حساسة لحالة الأحرف، تأكد من كتابتها بنفس الطريقة التي ستتذكرها بها"})]}),x&&e.jsxs(Ur,{variant:"destructive",children:[e.jsx(Ya,{className:"h-4 w-4"}),e.jsx(Hr,{children:x})]}),f&&e.jsxs(Ur,{className:"border-green-200 bg-green-50 text-green-800 dark:border-green-800 dark:bg-green-900/20 dark:text-green-200",children:[e.jsx(ns,{className:"h-4 w-4"}),e.jsx(Hr,{children:f})]}),!f&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Lr,{onClick:w,disabled:p||!l&&!c||!m,className:"flex-1",children:p?"جاري الحفظ...":s?"تحديث":"حفظ"}),e.jsx(Lr,{variant:"outline",onClick:N,className:"flex-1",children:"إلغاء"})]})]})]})})}function td({showNotification:t}){const{passwordEnabled:n,setPassword:a,removePassword:s,changePassword:r}=xa(),[i,l]=re.useState(!1),[o,c]=re.useState(!1),[d,m]=re.useState(!1),[u,p]=re.useState(!1),[h,x]=re.useState(!1),[g,f]=re.useState(""),[v,y]=re.useState(!1),[b,j]=re.useState(""),[w,N]=re.useState(""),[_,k]=re.useState(""),[S,C]=re.useState(""),[$,D]=re.useState({new:!1,confirm:!1,old:!1,remove:!1}),[E,T]=re.useState(!1);re.useEffect(()=>{A()},[]);const A=async()=>{try{const e=await window.electronAPI.settings.get();e?.security_question?(f(e.security_question),y(!0)):y(!1)}catch(e){console.error("Error loading security question:",e)}},F=e=>{D(t=>({...t,[e]:!t[e]}))};return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[e.jsxs("div",{className:"p-6 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"حماية التطبيق بكلمة مرور"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"تأمين التطبيق بكلمة مرور لمنع الوصول غير المصرح به"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"p-2 rounded-lg "+(n?"bg-green-100 dark:bg-green-900/20":"bg-gray-100 dark:bg-gray-900/20"),children:n?e.jsx(Fs,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(pr,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n?"كلمة المرور مفعلة":"كلمة المرور معطلة"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?"التطبيق محمي بكلمة مرور":"التطبيق غير محمي بكلمة مرور"})]})]}),e.jsx("div",{className:"px-3 py-1 rounded-full text-xs font-medium "+(n?"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200":"bg-gray-100 dark:bg-gray-900/20 text-gray-800 dark:text-gray-200"),children:n?"مفعل":"معطل"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center space-x-2 space-x-reverse px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx($s,{className:"w-4 h-4"}),e.jsx("span",{children:"تغيير كلمة المرور"})]}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center space-x-2 space-x-reverse px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(pr,{className:"w-4 h-4"}),e.jsx("span",{children:"إزالة كلمة المرور"})]})]}):e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center space-x-2 space-x-reverse px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors",children:[e.jsx($s,{className:"w-4 h-4"}),e.jsx("span",{children:"تعيين كلمة مرور"})]})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3 space-x-reverse",children:[e.jsx(Cs,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-2",children:"معلومات مهمة حول الأمان"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsx("li",{children:"• عند تفعيل كلمة المرور، ستحتاج لإدخالها في كل مرة تفتح فيها التطبيق"}),e.jsx("li",{children:"• يُنصح باستخدام كلمة مرور قوية تحتوي على أرقام وحروف"}),e.jsx("li",{children:"• احتفظ بكلمة المرور في مكان آمن"}),e.jsx("li",{children:"• في حالة نسيان كلمة المرور، يمكنك استخدام سؤال الأمان لاستعادتها"})]})]})]})})]})]}),e.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[e.jsxs("div",{className:"p-6 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"سؤال الأمان"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"إعداد سؤال أمان لاستعادة كلمة المرور في حالة نسيانها"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"p-2 rounded-lg "+(v?"bg-green-100 dark:bg-green-900/20":"bg-gray-100 dark:bg-gray-900/20"),children:v?e.jsx(ks,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(ks,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:v?"تم إعداد سؤال الأمان":"لم يتم إعداد سؤال أمان"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:v?"يمكنك استخدام سؤال الأمان لاستعادة كلمة المرور":"قم بإعداد سؤال أمان لاستعادة كلمة المرور"})]})]}),e.jsx("div",{className:"flex space-x-2 space-x-reverse",children:e.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors duration-200 flex items-center space-x-2 space-x-reverse",children:v?e.jsxs(e.Fragment,{children:[e.jsx(Us,{className:"w-4 h-4"}),e.jsx("span",{children:"تحديث"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ks,{className:"w-4 h-4"}),e.jsx("span",{children:"إعداد"})]})})})]}),v&&g&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3 space-x-reverse",children:[e.jsx(ks,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:"سؤال الأمان الحالي"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300",children:g})]})]})}),e.jsx("div",{className:"mt-6 p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3 space-x-reverse",children:[e.jsx(Cs,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-amber-800 dark:text-amber-200 mb-2",children:"نصائح مهمة لسؤال الأمان"}),e.jsxs("ul",{className:"text-sm text-amber-700 dark:text-amber-300 space-y-1",children:[e.jsx("li",{children:"• اختر سؤالاً تتذكر إجابته بسهولة"}),e.jsx("li",{children:"• تأكد من أن الإجابة لا يمكن للآخرين تخمينها"}),e.jsx("li",{children:"• تجنب الأسئلة التي قد تتغير إجابتها مع الوقت"}),e.jsx("li",{children:"• احتفظ بإجابة السؤال في مكان آمن"})]})]})]})})]})]}),i&&e.jsxs(ad,{title:"تعيين كلمة مرور جديدة",onSubmit:async e=>{if(e.preventDefault(),b.trim())if(b.length<4)t("كلمة المرور يجب أن تكون 4 أحرف على الأقل","error");else if(b===w){T(!0);try{console.log("🔐 SecuritySettings: Setting password...");const e=await a(b);console.log("🔐 SecuritySettings: Password set result:",e),e?(t("تم تعيين كلمة المرور بنجاح","success"),l(!1),j(""),N(""),D({new:!1,confirm:!1,old:!1})):t("فشل في تعيين كلمة المرور","error")}catch(n){console.error("❌ SecuritySettings: Error setting password:",n),t("حدث خطأ أثناء تعيين كلمة المرور","error")}finally{T(!1)}}else t("كلمة المرور وتأكيدها غير متطابقين","error");else t("يرجى إدخال كلمة مرور","error")},onCancel:()=>{l(!1),j(""),N("")},isLoading:E,children:[e.jsx(nd,{label:"كلمة المرور الجديدة",value:b,onChange:j,show:$.new,onToggleShow:()=>F("new"),placeholder:"أدخل كلمة مرور جديدة"}),e.jsx(nd,{label:"تأكيد كلمة المرور",value:w,onChange:N,show:$.confirm,onToggleShow:()=>F("confirm"),placeholder:"أعد إدخال كلمة المرور"})]}),o&&e.jsxs(ad,{title:"تغيير كلمة المرور",onSubmit:async e=>{if(e.preventDefault(),_.trim()&&b.trim())if(b.length<4)t("كلمة المرور الجديدة يجب أن تكون 4 أحرف على الأقل","error");else if(b===w){T(!0);try{console.log("🔐 SecuritySettings: Changing password...");const e=await r(_,b);console.log("🔐 SecuritySettings: Password change result:",e),e?(t("تم تغيير كلمة المرور بنجاح","success"),c(!1),k(""),j(""),N(""),D({new:!1,confirm:!1,old:!1})):t("كلمة المرور القديمة غير صحيحة","error")}catch(n){console.error("❌ SecuritySettings: Error changing password:",n),t("حدث خطأ أثناء تغيير كلمة المرور","error")}finally{T(!1)}}else t("كلمة المرور الجديدة وتأكيدها غير متطابقين","error");else t("يرجى ملء جميع الحقول","error")},onCancel:()=>{c(!1),k(""),j(""),N("")},isLoading:E,children:[e.jsx(nd,{label:"كلمة المرور الحالية",value:_,onChange:k,show:$.old,onToggleShow:()=>F("old"),placeholder:"أدخل كلمة المرور الحالية"}),e.jsx(nd,{label:"كلمة المرور الجديدة",value:b,onChange:j,show:$.new,onToggleShow:()=>F("new"),placeholder:"أدخل كلمة مرور جديدة"}),e.jsx(nd,{label:"تأكيد كلمة المرور الجديدة",value:w,onChange:N,show:$.confirm,onToggleShow:()=>F("confirm"),placeholder:"أعد إدخال كلمة المرور الجديدة"})]}),u&&e.jsxs(ad,{title:"إزالة كلمة المرور",onSubmit:async e=>{if(e.preventDefault(),S.trim()){T(!0);try{console.log("🔐 SecuritySettings: Verifying password for removal...");const e=await window.electronAPI.settings.get();if(!e?.app_password)return t("لا توجد كلمة مرور مُعيّنة","error"),void T(!1);if(await async function(e){try{const t=(new TextEncoder).encode(e+"dental_clinic_salt_2024"),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(t){throw console.error("Error hashing password:",t),t}}(S)!==e.app_password)return t("كلمة المرور غير صحيحة","error"),void T(!1);console.log("🔐 SecuritySettings: Password verified, removing...");const n=await s();console.log("🔐 SecuritySettings: Password removal result:",n),n?(t("تم إزالة كلمة المرور بنجاح","success"),p(!1),C(""),D(e=>({...e,remove:!1}))):t("فشل في إزالة كلمة المرور","error")}catch(n){console.error("❌ SecuritySettings: Error removing password:",n),t("حدث خطأ أثناء إزالة كلمة المرور","error")}finally{T(!1)}}else t("يرجى إدخال كلمة المرور الحالية","error")},onCancel:()=>{p(!1),C(""),D(e=>({...e,remove:!1}))},isLoading:E,children:[e.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3 space-x-reverse",children:[e.jsx(qa,{className:"w-5 h-5 text-red-600 dark:text-red-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:"تحذير: إزالة كلمة المرور ستجعل التطبيق غير محمي. يرجى إدخال كلمة المرور الحالية للتأكيد."})})]})}),e.jsx(nd,{label:"كلمة المرور الحالية",value:S,onChange:C,show:$.remove,onToggleShow:()=>F("remove"),placeholder:"أدخل كلمة المرور الحالية"})]}),d&&e.jsx(sd,{title:"إزالة كلمة المرور",message:"هل أنت متأكد من إزالة كلمة المرور؟ سيصبح التطبيق غير محمي.",onConfirm:async()=>{T(!0);try{console.log("🔐 SecuritySettings: Removing password...");const e=await s();console.log("🔐 SecuritySettings: Password removal result:",e),e?(t("تم إزالة كلمة المرور بنجاح","success"),m(!1)):t("فشل في إزالة كلمة المرور","error")}catch(e){console.error("❌ SecuritySettings: Error removing password:",e),t("حدث خطأ أثناء إزالة كلمة المرور","error")}finally{T(!1)}},onCancel:()=>m(!1),isLoading:E,confirmText:"إزالة",confirmClass:"bg-red-600 hover:bg-red-700"}),e.jsx(ed,{open:h,onOpenChange:x,onSave:()=>{A(),t("تم حفظ سؤال الأمان بنجاح","success")},editMode:v})]})}function nd({label:t,value:n,onChange:a,show:s,onToggleShow:r,placeholder:i}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-foreground",children:t}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:s?"text":"password",value:n,onChange:e=>a(e.target.value),className:"w-full pr-3 pl-10 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:i}),e.jsx("button",{type:"button",onClick:r,className:"absolute inset-y-0 left-0 pl-3 flex items-center text-muted-foreground hover:text-foreground",children:s?e.jsx(vs,{className:"w-4 h-4"}):e.jsx(ys,{className:"w-4 h-4"})})]})]})}function ad({title:t,children:n,onSubmit:a,onCancel:s,isLoading:r}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:s}),e.jsx("div",{className:"relative bg-card border border-border rounded-lg shadow-2xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:t}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[n,e.jsxs("div",{className:"flex justify-end space-x-3 space-x-reverse pt-4",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 border border-input bg-background text-foreground rounded-lg hover:bg-accent",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:r,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50",children:r?"جاري الحفظ...":"حفظ"})]})]})]})})]})}function sd({title:t,message:n,onConfirm:a,onCancel:s,isLoading:r,confirmText:i,confirmClass:l}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:s}),e.jsx("div",{className:"relative bg-card border border-border rounded-lg shadow-2xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center ml-3",children:e.jsx(qa,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:t}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 space-x-reverse",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 border border-input bg-background text-foreground rounded-lg hover:bg-accent",children:"إلغاء"}),e.jsx("button",{onClick:a,disabled:r,className:`px-4 py-2 text-white rounded-lg transition-colors disabled:opacity-50 ${l}`,children:r?"جاري التنفيذ...":i})]})]})})]})}const rd=[{key:"0",arabicKey:"٠",description:"لوحة التحكم",icon:e.jsx(nr,{className:"w-3 h-3"}),category:"تنقل"},{key:"1",arabicKey:"١",description:"المرضى",icon:e.jsx(br,{className:"w-3 h-3"}),category:"تنقل"},{key:"2",arabicKey:"٢",description:"المواعيد",icon:e.jsx(es,{className:"w-3 h-3"}),category:"تنقل"},{key:"3",arabicKey:"٣",description:"الدفعات",icon:e.jsx(gs,{className:"w-3 h-3"}),category:"تنقل"},{key:"4",arabicKey:"٤",description:"المخزون",icon:e.jsx(nr,{className:"w-3 h-3"}),category:"تنقل"},{key:"5",arabicKey:"٥",description:"المختبرات",icon:e.jsx(nr,{className:"w-3 h-3"}),category:"تنقل"},{key:"6",arabicKey:"٦",description:"الأدوية",icon:e.jsx(nr,{className:"w-3 h-3"}),category:"تنقل"},{key:"7",arabicKey:"٧",description:"العلاجات",icon:e.jsx(nr,{className:"w-3 h-3"}),category:"تنقل"},{key:"8",arabicKey:"٨",description:"احتياجات العيادة",icon:e.jsx(nr,{className:"w-3 h-3"}),category:"تنقل"},{key:"9",arabicKey:"٩",description:"التقارير",icon:e.jsx(nr,{className:"w-3 h-3"}),category:"تنقل"},{key:"A",arabicKey:"ش",description:"إضافة مريض جديد",icon:e.jsx(br,{className:"w-3 h-3"}),category:"إجراءات"},{key:"S",arabicKey:"س",description:"إضافة موعد جديد",icon:e.jsx(es,{className:"w-3 h-3"}),category:"إجراءات"},{key:"D",arabicKey:"ي",description:"إضافة دفعة جديدة",icon:e.jsx(gs,{className:"w-3 h-3"}),category:"إجراءات"},{key:"F1",arabicKey:"F1",description:"فتح الإعدادات",icon:e.jsx(nr,{className:"w-3 h-3"}),category:"عمليات"},{key:"R",arabicKey:"ق",description:"تحديث الصفحة",icon:e.jsx(Js,{className:"w-3 h-3"}),category:"عمليات"},{key:"F",arabicKey:"ب",description:"فتح البحث",icon:e.jsx(tr,{className:"w-3 h-3"}),category:"عمليات"},{key:"ESC",arabicKey:"ESC",description:"إغلاق النوافذ",icon:e.jsx(_r,{className:"w-3 h-3"}),category:"عمليات"}];function id({className:t,compact:n=!1}){const{isDarkMode:a}=sa(),[s,r]=re.useState(!1),[i,l]=re.useState(null),o=Array.from(new Set(rd.map(e=>e.category))),c=i?rd.filter(e=>e.category===i):rd;return n?e.jsx("div",{className:En("fixed bottom-4 right-4 z-50",t),children:e.jsx(nc,{className:En("shadow-xl border backdrop-blur-sm",a?"border-border/30 bg-gradient-to-br from-background/90 to-muted/90 shadow-2xl shadow-black/30":"border-border/50 bg-gradient-to-br from-background/95 to-muted/95 shadow-lg"),children:e.jsxs(ic,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:En("p-1.5 rounded-md",a?"bg-primary/20":"bg-primary/10"),children:e.jsx(Ds,{className:"w-4 h-4 text-primary"})}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"اختصارات سريعة"})]}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>r(!s),className:En("h-7 w-7 p-0 rounded-md transition-all duration-200",a?"text-muted-foreground hover:text-foreground hover:bg-muted/30":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:s?e.jsx(ls,{className:"w-3.5 h-3.5"}):e.jsx(ss,{className:"w-3.5 h-3.5"})})]}),s&&e.jsxs("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:[e.jsxs("div",{className:"flex gap-1.5 flex-wrap",children:[e.jsx(Lr,{variant:null===i?"default":"outline",size:"sm",onClick:()=>l(null),className:"h-7 text-xs px-3 rounded-full transition-all duration-200 hover:scale-105",children:"الكل"}),o.map(t=>e.jsx(Lr,{variant:i===t?"default":"outline",size:"sm",onClick:()=>l(t),className:"h-7 text-xs px-3 rounded-full transition-all duration-200 hover:scale-105",children:t},t))]}),e.jsx("div",{className:"space-y-1.5",children:c.map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between p-2.5 rounded-lg bg-card/50 border border-border/30 hover:bg-card/80 hover:border-border/60 transition-all duration-200 hover:shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"p-1 rounded-md bg-muted/50",children:t.icon}),e.jsx("span",{className:"text-xs text-foreground font-medium",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(oc,{variant:"secondary",className:"text-xs px-2 py-0.5 bg-primary/10 text-primary border-primary/20 font-mono font-semibold",children:t.key}),t.arabicKey!==t.key&&e.jsx(oc,{variant:"outline",className:"text-xs px-2 py-0.5 border-emerald-200 text-emerald-700 dark:border-emerald-800 dark:text-emerald-300 font-mono font-semibold",children:t.arabicKey})]})]},n))})]})]})})}):e.jsx(nc,{className:En("shadow-lg border border-border/50 bg-gradient-to-br from-background to-muted/30",t),children:e.jsxs(ic,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 dark:bg-primary/20",children:e.jsx(Ds,{className:"w-5 h-5 text-primary"})}),e.jsx("h3",{className:"font-semibold text-lg text-foreground",children:"اختصارات لوحة المفاتيح"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(t=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-sm text-primary border-b border-primary/20 pb-2 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"}),t]}),e.jsx("div",{className:"space-y-2",children:rd.filter(e=>e.category===t).map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-card border border-border/30 hover:bg-card/80 hover:border-border/60 hover:shadow-sm transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1.5 rounded-md bg-muted/50",children:t.icon}),e.jsx("span",{className:"text-sm text-foreground font-medium",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(oc,{variant:"secondary",className:"text-xs px-2 py-1 bg-primary/10 text-primary border-primary/20 font-mono font-semibold",children:t.key}),t.arabicKey!==t.key&&e.jsx(oc,{variant:"outline",className:"text-xs px-2 py-1 border-emerald-200 text-emerald-700 dark:border-emerald-800 dark:text-emerald-300 font-mono font-semibold",children:t.arabicKey})]})]},n))})]},t))})]})})}function ld(){const[t,n]=re.useState(null),[a,s]=re.useState(!1),r=async()=>{s(!0);try{if(!window.electronAPI?.database?.getStatus)throw new Error("Database API not available");const e=await window.electronAPI.database.getStatus();n(e),console.log("Database status:",e)}catch(e){console.error("Database status check failed:",e),n({connected:!1,error:e instanceof Error?e.message:"Unknown error"})}finally{s(!1)}};re.useEffect(()=>{r()},[]);return e.jsxs(nc,{className:"w-full max-w-2xl mx-auto",children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"h-5 w-5"}),"تشخيص قاعدة البيانات"]})}),e.jsxs(ic,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"حالة الاتصال:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[t?t.connected?e.jsx(ns,{className:"h-4 w-4 text-green-600 dark:text-green-400"}):e.jsx(Ya,{className:"h-4 w-4 text-red-600 dark:text-red-400"}):e.jsx(xs,{className:"h-4 w-4"}),e.jsx(oc,{variant:t?.connected?"default":"destructive",children:t?.connected?"متصل":"غير متصل"})]})]}),t?.dbPath&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"مسار قاعدة البيانات:"}),e.jsx("code",{className:"text-sm bg-gray-500 dark:bg-gray-700 dark:text-gray-100 px-2 py-1 rounded border dark:border-gray-600",children:t.dbPath})]}),void 0!==t?.tablesCount&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"عدد الجداول:"}),e.jsx(oc,{variant:"outline",children:t.tablesCount})]}),void 0!==t?.isOpen&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"حالة قاعدة البيانات:"}),e.jsx(oc,{variant:t.isOpen?"default":"secondary",children:t.isOpen?"مفتوحة":"مغلقة"})]}),t?.fileSize&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"حجم الملف:"}),e.jsx(oc,{variant:"outline",children:t.fileSize})]}),t?.lastModified&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"آخر تعديل:"}),e.jsx("code",{className:"text-xs bg-gray-500 dark:bg-gray-700 dark:text-gray-100 px-2 py-1 rounded border dark:border-gray-600",children:new Date(t.lastModified).toLocaleString("ar-EG")})]}),t?.tableNames&&t.tableNames.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"font-medium",children:"الجداول الموجودة:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.tableNames.map((t,n)=>e.jsx(oc,{variant:"secondary",className:"text-xs",children:t},n)),t.hasMoreTables&&e.jsx(oc,{variant:"outline",className:"text-xs",children:"+المزيد..."})]})]}),t?.error&&e.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-800 dark:text-red-400",children:[e.jsx(Ya,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"خطأ:"})]}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1 text-sm",children:t.error})]}),e.jsx(Lr,{onClick:r,disabled:a,className:"w-full",children:a?e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"h-4 w-4 mr-2 animate-spin"}),"جاري الفحص..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"إعادة فحص"]})})]})]})}function od(){const[t,n]=re.useState("backup"),[a,s]=re.useState(null),[r,i]=re.useState({message:"",type:"success",show:!1}),{backups:l,isLoading:o,error:c,isCreatingBackup:d,isRestoringBackup:m,autoBackupEnabled:u,backupFrequency:p,loadBackups:h,createBackup:x,restoreBackup:g,deleteBackup:f,setAutoBackupEnabled:v,setBackupFrequency:y,selectBackupFile:b,clearError:j,formatBackupSize:w,formatBackupDate:N,getBackupStatus:_}=Xc(),{settings:k,updateSettings:S,loadSettings:C}=ta(),{isDarkMode:$,toggleDarkMode:D}=sa(),{currentCurrency:E,setCurrency:T}=oa(),A=Mc(),{refreshAllImages:F}=cc(),[P,R]=re.useState("");re.useEffect(()=>{h(),C()},[h,C]),re.useEffect(()=>{R(A)},[A]),re.useEffect(()=>{c&&(O(c,"error"),j())},[c,j]),re.useEffect(()=>{a?console.log("🔍 Delete confirmation dialog opened for:",a):console.log("🔍 Delete confirmation dialog closed")},[a]),re.useEffect(()=>{const e=e=>{a&&"Escape"===e.key&&s(null)};return a?(document.addEventListener("keydown",e),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[a]);const O=(e,t="success")=>{i({message:e,type:t,show:!0}),setTimeout(()=>{i(e=>({...e,show:!1}))},3e3)},M=async(e=!1)=>{try{await x(null,e);O(e?"تم إنشاء النسخة الاحتياطية مع الصور بنجاح":"تم إنشاء النسخة الاحتياطية بنجاح","success")}catch(t){O("فشل في إنشاء النسخة الاحتياطية","error")}},L=async e=>{try{if(window.confirm("هل أنت متأكد من استعادة هذه النسخة الاحتياطية؟ سيتم استبدال جميع البيانات الحالية.")){await g(e);try{await F()}catch(t){console.warn("Could not refresh images after restore:",t)}O("تم استعادة النسخة الاحتياطية بنجاح","success"),window.location.reload()}}catch(t){O("فشل في استعادة النسخة الاحتياطية","error")}},I=async e=>{try{void 0!==e.clinic_logo&&R(e.clinic_logo),await S(e),await C(),O("تم حفظ إعدادات العيادة بنجاح","success")}catch(t){console.error("Error updating settings:",t),O("فشل في حفظ إعدادات العيادة","error")}},z=_();return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-heading-1 text-foreground arabic-enhanced",children:"الإعدادات"}),e.jsx("p",{className:"text-body text-muted-foreground mt-2 arabic-enhanced",children:"إدارة إعدادات العيادة والنسخ الاحتياطية"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs("button",{onClick:()=>h(),disabled:o,className:"flex items-center space-x-2 space-x-reverse px-4 py-2 border border-input bg-background text-foreground rounded-lg hover:bg-accent disabled:opacity-50",children:[e.jsx(Js,{className:"w-4 h-4 "+(o?"animate-spin":"")}),e.jsx("span",{children:"تحديث"})]}),e.jsxs("button",{onClick:async()=>{const e={"الوضع المظلم":$?"مفعل":"معطل","النسخ التلقائية":u?"مفعلة":"معطلة","تكرار النسخ":"daily"===p?"يومياً":"weekly"===p?"أسبوعياً":"شهرياً","إجمالي النسخ الاحتياطية":z.totalBackups,"آخر نسخة احتياطية":z.lastBackup||"لا توجد","تاريخ التصدير":In(new Date)},t="\ufeff"+["الإعداد,القيمة",...Object.entries(e).map(([e,t])=>`"${e}","${t}"`)].join("\n");await Zc.convertCSVToExcel(t,"settings",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"})},className:"flex items-center space-x-2 space-x-reverse px-4 py-2 border border-input bg-background text-foreground rounded-lg hover:bg-accent",children:[e.jsx(fs,{className:"w-4 h-4"}),e.jsx("span",{children:"تصدير الإعدادات"})]})]})]}),e.jsx("div",{className:"border-b border-border",children:e.jsx("nav",{className:"-mb-px flex space-x-8 space-x-reverse",children:[{id:"backup",name:"النسخ الاحتياطية",icon:xs},{id:"diagnostics",name:"تشخيص النظام",icon:qa},{id:"appearance",name:"المظهر",icon:Vs},{id:"shortcuts",name:"اختصارات لوحة المفاتيح",icon:Ds},{id:"security",name:"الأمان",icon:$s},{id:"clinic",name:"إعدادات العيادة",icon:nr},{id:"development",name:"فريق التطوير",icon:br}].map(a=>e.jsxs("button",{onClick:()=>n(a.id),className:"flex items-center space-x-2 space-x-reverse py-2 px-1 border-b-2 font-medium text-sm "+(t===a.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground hover:border-border"),children:[e.jsx(a.icon,{className:"w-4 h-4"}),e.jsx("span",{children:a.name})]},a.id))})}),"backup"===t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-card rounded-lg shadow border border-border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(Ns,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"إجمالي النسخ"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:z.totalBackups})]})]})}),e.jsx("div",{className:"bg-card rounded-lg shadow border border-border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/20 rounded-lg",children:e.jsx(us,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"آخر نسخة احتياطية"}),e.jsx("p",{className:"text-sm font-bold text-foreground",children:z.lastBackup||"لا توجد نسخ"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg shadow border border-border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/20 rounded-lg",children:e.jsx(es,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"النسخة التالية"}),e.jsx("p",{className:"text-sm font-bold text-foreground",children:z.nextScheduledBackup||"غير محدد"})]})]})})]}),e.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[e.jsxs("div",{className:"p-6 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"النسخ الاحتياطية اليدوية"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"إنشاء واستعادة النسخ الاحتياطية يدوياً (تنسيق SQLite)"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("button",{onClick:()=>M(!1),disabled:d,className:"flex items-center justify-center space-x-2 space-x-reverse px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(fs,{className:"w-5 h-5"}),e.jsx("span",{children:d?"جاري الإنشاء...":"إنشاء نسخة احتياطية"})]}),e.jsxs("button",{onClick:()=>M(!0),disabled:d,className:"flex items-center justify-center space-x-2 space-x-reverse px-6 py-3 bg-blue-600 dark:bg-blue-700 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ss,{className:"w-5 h-5"}),e.jsx("span",{children:d?"جاري الإنشاء...":"إنشاء نسخة احتياطية مع صور"})]}),e.jsxs("button",{onClick:async()=>{try{const t=await b();if(!t)return;if(window.confirm("هل أنت متأكد من استعادة هذه النسخة الاحتياطية؟ سيتم استبدال جميع البيانات الحالية.")){await g(t);try{await F()}catch(e){console.warn("Could not refresh images after restore:",e)}O("تم استعادة النسخة الاحتياطية بنجاح","success"),window.location.reload()}}catch(e){O("فشل في استعادة النسخة الاحتياطية","error")}},disabled:m,className:"flex items-center justify-center space-x-2 space-x-reverse px-6 py-3 bg-green-600 dark:bg-green-700 text-white rounded-lg hover:bg-green-700 dark:hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(hr,{className:"w-5 h-5"}),e.jsx("span",{children:m?"جاري الاستعادة...":"استعادة نسخة احتياطية"})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx(qa,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 ml-2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"تنبيه مهم"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"استعادة النسخة الاحتياطية ستستبدل جميع البيانات الحالية. تأكد من إنشاء نسخة احتياطية حديثة قبل الاستعادة."}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-2",children:e.jsx("strong",{children:"أنواع النسخ الاحتياطية:"})}),e.jsxs("ul",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1 mr-4",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"نسخة عادية (.db):"})," قاعدة البيانات فقط - سريعة وحجم صغير"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"نسخة مع صور (.zip):"})," قاعدة البيانات + جميع الصور - حماية شاملة"]})]})]})]})})]})]}),!1,e.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[e.jsxs("div",{className:"p-6 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"النسخ الاحتياطية المحفوظة"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"قائمة بجميع النسخ الاحتياطية المتاحة - اضغط على أي نسخة لاستعادتها"})]}),e.jsx("div",{className:"p-6",children:o?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Js,{className:"w-8 h-8 animate-spin mx-auto text-muted-foreground"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"جاري التحميل..."})]}):0===l.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xs,{className:"w-12 h-12 mx-auto text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-foreground",children:"لا توجد نسخ احتياطية"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"ابدأ بإنشاء أول نسخة احتياطية"})]}):e.jsx("div",{className:"space-y-3",children:l.map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg hover:bg-accent cursor-pointer",onClick:()=>L(t.path),children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(ar,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:t.name}),t.isSqliteOnly&&e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded-full",children:"SQLite"}),t.includesImages&&e.jsxs("span",{className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200 rounded-full flex items-center gap-1",children:[e.jsx(Ss,{className:"w-3 h-3"}),"مع صور"]}),t.isLegacy&&e.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-900/20 text-gray-800 dark:text-gray-200 rounded-full",children:"قديم"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse text-sm text-muted-foreground",children:[e.jsx("span",{children:N(t.created_at)}),e.jsx("span",{children:w(t.size)}),t.version&&e.jsxs("span",{children:["إصدار ",t.version]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),L(t.path)},className:"p-2 text-green-600 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/20 rounded-lg",title:"استعادة",children:e.jsx(hr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),console.log("🗑️ Delete button clicked for backup:",t.name),s(t.name)},className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"حذف",type:"button",children:e.jsx(dr,{className:"w-4 h-4"})})]})]},`${t.name}-${n}`))})})]})]}),"diagnostics"===t&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[e.jsxs("div",{className:"p-6 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"تشخيص النظام"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"فحص حالة قاعدة البيانات والنظام"})]}),e.jsx("div",{className:"p-6",children:e.jsx(ld,{})})]})}),"appearance"===t&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[e.jsxs("div",{className:"p-6 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"إعدادات المظهر"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"تخصيص مظهر التطبيق وفقاً لتفضيلاتك"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:$?e.jsx(Is,{className:"w-5 h-5 text-primary"}):e.jsx(lr,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"الوضع المظلم"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تبديل بين الوضع الفاتح والمظلم للتطبيق"})]})]}),e.jsx("button",{onClick:D,className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+($?"bg-primary":"bg-muted"),children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-background transition-transform "+($?"translate-x-6":"translate-x-1")})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"معاينة المظهر"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"p-4 border border-border rounded-lg bg-background",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h5",{className:"text-sm font-medium text-foreground",children:$?"الوضع المظلم":"الوضع الفاتح"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-2 bg-muted rounded"}),e.jsx("div",{className:"h-2 bg-muted rounded w-3/4"}),e.jsx("div",{className:"h-2 bg-muted rounded w-1/2"})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-8 h-6 bg-primary rounded text-xs"}),e.jsx("div",{className:"w-8 h-6 bg-secondary rounded text-xs"})]})]})}),e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-muted/50",children:[e.jsx("h5",{className:"text-sm font-medium text-foreground mb-2",children:"مميزات المظهر"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• تحسين قراءة النصوص العربية"}),e.jsx("li",{children:"• ألوان مناسبة للتطبيقات الطبية"}),e.jsx("li",{children:"• حفظ تلقائي للتفضيلات"}),e.jsx("li",{children:"• تباين عالي للوضوح"})]})]})]})]})]})]})}),"shortcuts"===t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[e.jsxs("div",{className:"p-6 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"اختصارات لوحة المفاتيح"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"تعرف على جميع اختصارات لوحة المفاتيح المتاحة لتسريع عملك"})]}),e.jsx("div",{className:"p-6",children:e.jsx(id,{})})]}),e.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[e.jsx("div",{className:"p-6 border-b border-border",children:e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"نصائح للاستخدام"})}),e.jsx("div",{className:"p-6 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-2",children:"الأحرف العربية"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"يمكنك استخدام الأحرف العربية أو الإنجليزية للاختصارات. مثلاً: A أو ش لإضافة مريض جديد."})]}),e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-2",children:"التنقل السريع"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"استخدم الأرقام 0-9 أو ٠-٩ للتنقل السريع بين الصفحات المختلفة."})]}),e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-purple-800 dark:text-purple-200 mb-2",children:"الإجراءات السريعة"}),e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300",children:"استخدم A/S/D أو ش/س/ي لإضافة مريض أو موعد أو دفعة بسرعة."})]}),e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-800 dark:text-orange-200 mb-2",children:"العمليات العامة"}),e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:"F1 للإعدادات، R/ق للتحديث، F/ب للبحث، ESC للإغلاق."})]})]})})]})]}),"security"===t&&e.jsx(td,{showNotification:O}),"clinic"===t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[e.jsxs("div",{className:"p-6 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"معلومات العيادة"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"إعدادات العيادة الأساسية والمعلومات التي تظهر في الإيصالات"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{className:"space-y-6",onSubmit:e=>{e.preventDefault();const t=new FormData(e.currentTarget),n={clinic_name:t.get("clinic_name"),doctor_name:t.get("doctor_name"),clinic_address:t.get("clinic_address"),clinic_phone:t.get("clinic_phone"),clinic_email:t.get("clinic_email"),currency:t.get("currency")};I(n)},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"clinic_name",className:"text-sm font-medium text-foreground",children:"اسم العيادة *"}),e.jsx("input",{type:"text",id:"clinic_name",name:"clinic_name",defaultValue:k?.clinic_name||"",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"doctor_name",className:"text-sm font-medium text-foreground",children:"اسم الدكتور *"}),e.jsx("input",{type:"text",id:"doctor_name",name:"doctor_name",defaultValue:k?.doctor_name||"",placeholder:"د. محمد أحمد",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"clinic_phone",className:"text-sm font-medium text-foreground",children:"رقم الهاتف"}),e.jsx("input",{type:"tel",id:"clinic_phone",name:"clinic_phone",defaultValue:k?.clinic_phone||"",placeholder:"+963 95 966 9628",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"clinic_email",className:"text-sm font-medium text-foreground",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",id:"clinic_email",name:"clinic_email",defaultValue:k?.clinic_email||"",placeholder:"clinic@example.com",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"clinic_address",className:"text-sm font-medium text-foreground",children:"عنوان العيادة"}),e.jsx("textarea",{id:"clinic_address",name:"clinic_address",defaultValue:k?.clinic_address||"",placeholder:"حلب، الجمهورية العربية السورية",rows:3,className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"currency",className:"text-sm font-medium text-foreground flex items-center gap-2",children:[e.jsx(gs,{className:"w-4 h-4"}),"العملة المستخدمة"]}),e.jsx("select",{id:"currency",name:"currency",defaultValue:k?.currency||E||"USD",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary",onChange:e=>{T(e.target.value)},children:Object.entries(Tn).map(([t,n])=>e.jsxs("option",{value:t,children:[n.nameAr," (",n.symbol,") - ",n.name]},t))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"العملة المختارة ستظهر في جميع أنحاء التطبيق (المدفوعات، التقارير، الإحصائيات)"})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"شعار العيادة"}),e.jsxs("div",{className:"flex items-start space-x-4 space-x-reverse",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-20 h-20 border-2 border-dashed border-border rounded-lg flex items-center justify-center bg-muted/50",children:P?e.jsx("img",{src:P,alt:"شعار العيادة",className:"w-full h-full object-cover rounded-lg"}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 mx-auto mb-1 text-muted-foreground",children:"📷"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"لا يوجد شعار"})]})})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("input",{type:"file",id:"clinic_logo",accept:"image/*",className:"hidden",onChange:async e=>{const t=e.target.files?.[0];if(t){const e=new FileReader;e.onload=async e=>{const t=e.target?.result;await I({clinic_logo:t})},e.readAsDataURL(t)}}}),e.jsx("button",{type:"button",onClick:()=>document.getElementById("clinic_logo")?.click(),className:"px-3 py-2 text-sm border border-input bg-background text-foreground rounded-md hover:bg-accent",children:"اختيار شعار"}),P&&e.jsx("button",{type:"button",onClick:()=>I({clinic_logo:""}),className:"px-3 py-2 text-sm border border-red-200 bg-red-50 text-red-700 rounded-md hover:bg-red-100",children:"حذف الشعار"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"يُفضل استخدام صورة مربعة بحجم 200x200 بكسل أو أكبر. الصيغ المدعومة: JPG, PNG, GIF"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"جاري الحفظ...":"حفظ الإعدادات"})})]})})]}),e.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[e.jsxs("div",{className:"p-6 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"إعدادات الفاتورة التقديرية"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"إعدادات خاصة بالفواتير التقديرية الخارجية"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{className:"space-y-6",onSubmit:e=>{e.preventDefault();const t=new FormData(e.currentTarget),n={estimate_default_validity_days:parseInt(t.get("estimate_default_validity_days"))||30,estimate_default_tax_rate:parseFloat(t.get("estimate_default_tax_rate"))||0,estimate_default_notes:t.get("estimate_default_notes")||"",estimate_show_clinic_stamp:"on"===t.get("estimate_show_clinic_stamp")};I(n)},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"estimate_default_validity_days",className:"text-sm font-medium text-foreground",children:"مدة صلاحية التقدير (بالأيام)"}),e.jsx("input",{type:"number",id:"estimate_default_validity_days",name:"estimate_default_validity_days",defaultValue:k?.estimate_default_validity_days||30,min:"1",max:"365",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"عدد الأيام التي يكون فيها التقدير صالحاً (افتراضي: 30 يوم)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"estimate_default_tax_rate",className:"text-sm font-medium text-foreground",children:"معدل الضريبة الافتراضي (%)"}),e.jsx("input",{type:"number",id:"estimate_default_tax_rate",name:"estimate_default_tax_rate",defaultValue:k?.estimate_default_tax_rate||0,min:"0",max:"100",step:"0.1",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"معدل الضريبة الذي سيتم تطبيقه افتراضياً على التقديرات"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"estimate_default_notes",className:"text-sm font-medium text-foreground",children:"الملاحظات الافتراضية"}),e.jsx("textarea",{id:"estimate_default_notes",name:"estimate_default_notes",defaultValue:k?.estimate_default_notes||"",placeholder:"ملاحظات تظهر في جميع التقديرات...",rows:3,className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-primary"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"نص افتراضي يظهر في قسم الملاحظات لجميع التقديرات الجديدة"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("input",{type:"checkbox",id:"estimate_show_clinic_stamp",name:"estimate_show_clinic_stamp",defaultChecked:!1!==k?.estimate_show_clinic_stamp,className:"w-4 h-4 text-primary bg-background border-input rounded focus:ring-primary focus:ring-2"}),e.jsx("label",{htmlFor:"estimate_show_clinic_stamp",className:"text-sm font-medium text-foreground",children:"إظهار منطقة ختم العيادة في التقديرات"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"جاري الحفظ...":"حفظ إعدادات التقدير"})})]})})]})]}),"development"===t&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-card rounded-lg shadow border border-border",children:[e.jsxs("div",{className:"p-6 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"معلومات فريق التطوير"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"تواصل مع فريق التطوير للدعم الفني والاستفسارات"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(br,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"اسم الفريق"}),e.jsx("p",{className:"text-lg font-bold text-foreground",children:"AgorraCode"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"فريق تطوير تطبيقات إدارة العيادات"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/20 rounded-lg",children:e.jsx(Hs,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"رقم التواصل"}),e.jsx("p",{className:"text-lg font-bold text-foreground",children:"00963959669628"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"متاح للدعم الفني من 9 صباحاً إلى 6 مساءً"})]}),e.jsx("button",{onClick:async()=>{const e="https://api.whatsapp.com/send/?phone=963959669628";try{if(window.electronAPI&&window.electronAPI.system&&window.electronAPI.system.openExternal)return void(await window.electronAPI.system.openExternal(e))}catch(t){console.log("Method 1 failed:",t)}try{if(window.electronAPI)return void(await(window.electronAPI.shell?.openExternal?.(e)))}catch(t){console.log("Method 2 failed:",t)}window.open(e,"_blank","noopener,noreferrer")},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"تواصل عبر واتساب"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/20 rounded-lg",children:e.jsx(Ps,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"البريد الإلكتروني"}),e.jsx("p",{className:"text-lg font-bold text-foreground",children:"AgorraCode@gmail.com"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"للاستفسارات والدعم الفني"})]}),e.jsx("button",{onClick:()=>window.open("mailto:AgorraCode@gmail.com","_blank"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"إرسال إيميل"})]}),e.jsx("div",{className:"p-4 bg-primary/5 border border-primary/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3 space-x-reverse",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(Cs,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-2",children:"معلومات إضافية"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• نقدم دعماً فنياً شاملاً لجميع مستخدمي التطبيق"}),e.jsx("li",{children:"• نستقبل اقتراحاتكم لتطوير وتحسين التطبيق"}),e.jsx("li",{children:"• نوفر تدريباً مجانياً على استخدام التطبيق"}),e.jsx("li",{children:"• نضمن الاستجابة السريعة لجميع الاستفسارات"})]})]})]})})]})]})}),a&&e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{zIndex:9999},children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>s(null),style:{zIndex:9998}}),e.jsx("div",{className:"relative bg-card border border-border rounded-lg shadow-2xl max-w-md w-full mx-4",style:{zIndex:1e4},dir:"rtl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center ml-3",children:e.jsx(qa,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"تأكيد الحذف"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"هل أنت متأكد من حذف هذه النسخة الاحتياطية؟"})]})]}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx(qa,{className:"w-4 h-4 text-red-600 dark:text-red-400 ml-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 font-medium",children:"تحذير: لا يمكن التراجع عن هذا الإجراء"}),e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:['سيتم حذف النسخة الاحتياطية "',a,'" نهائياً من النظام.']})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 space-x-reverse",children:[e.jsx("button",{onClick:()=>s(null),className:"px-4 py-2 border border-input bg-background text-foreground rounded-lg hover:bg-accent transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:()=>(async e=>{try{console.log("🗑️ Attempting to delete backup:",e),await f(e),O("تم حذف النسخة الاحتياطية بنجاح","success"),s(null),console.log("✅ Backup deleted successfully:",e)}catch(t){console.error("❌ Failed to delete backup:",t),O(`فشل في حذف النسخة الاحتياطية: ${t instanceof Error?t.message:"خطأ غير معروف"}`,"error"),s(null)}})(a),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:"تأكيد الحذف"})]})]})})]}),r.show&&e.jsx("div",{className:"fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 "+("success"===r.type?"bg-green-500 text-white":"error"===r.type?"bg-red-500 text-white":"bg-blue-500 text-white"),children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("span",{className:"text-lg",children:"success"===r.type?"✅":"error"===r.type?"❌":"ℹ️"}),e.jsx("span",{children:r.message})]})})]})}var cd="rovingFocusGroup.onEntryFocus",dd={bubbles:!1,cancelable:!0},md="RovingFocusGroup",[ud,pd,hd]=M(md),[xd,gd]=k(md,[hd]),[fd,vd]=xd(md),yd=re.forwardRef((t,n)=>e.jsx(ud.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(ud.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(bd,{...t,ref:n})})}));yd.displayName=md;var bd=re.forwardRef((t,n)=>{const{__scopeRovingFocusGroup:a,orientation:s,loop:r=!1,dir:i,currentTabStopId:l,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:d,onEntryFocus:m,preventScrollOnEntryFocus:u=!1,...p}=t,h=re.useRef(null),x=$(n,h),g=L(i),[f,v]=P({prop:l,defaultProp:o??null,onChange:d,caller:md}),[y,b]=re.useState(!1),j=A(m),w=pd(a),N=re.useRef(!1),[_,k]=re.useState(0);return re.useEffect(()=>{const e=h.current;if(e)return e.addEventListener(cd,j),()=>e.removeEventListener(cd,j)},[j]),e.jsx(fd,{scope:a,orientation:s,dir:g,loop:r,currentTabStopId:f,onItemFocus:re.useCallback(e=>v(e),[v]),onItemShiftTab:re.useCallback(()=>b(!0),[]),onFocusableItemAdd:re.useCallback(()=>k(e=>e+1),[]),onFocusableItemRemove:re.useCallback(()=>k(e=>e-1),[]),children:e.jsx(c.div,{tabIndex:y||0===_?-1:0,"data-orientation":s,...p,ref:x,style:{outline:"none",...t.style},onMouseDown:E(t.onMouseDown,()=>{N.current=!0}),onFocus:E(t.onFocus,e=>{const t=!N.current;if(e.target===e.currentTarget&&t&&!y){const t=new CustomEvent(cd,dd);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=w().filter(e=>e.focusable);_d([e.find(e=>e.active),e.find(e=>e.id===f),...e].filter(Boolean).map(e=>e.ref.current),u)}}N.current=!1}),onBlur:E(t.onBlur,()=>b(!1))})})}),jd="RovingFocusGroupItem",wd=re.forwardRef((t,n)=>{const{__scopeRovingFocusGroup:a,focusable:s=!0,active:r=!1,tabStopId:i,children:l,...o}=t,d=R(),m=i||d,u=vd(jd,a),p=u.currentTabStopId===m,h=pd(a),{onFocusableItemAdd:x,onFocusableItemRemove:g,currentTabStopId:f}=u;return re.useEffect(()=>{if(s)return x(),()=>g()},[s,x,g]),e.jsx(ud.ItemSlot,{scope:a,id:m,focusable:s,active:r,children:e.jsx(c.span,{tabIndex:p?0:-1,"data-orientation":u.orientation,...o,ref:n,onMouseDown:E(t.onMouseDown,e=>{s?u.onItemFocus(m):e.preventDefault()}),onFocus:E(t.onFocus,()=>u.onItemFocus(m)),onKeyDown:E(t.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void u.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,n){const a=function(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,n);return"vertical"===t&&["ArrowLeft","ArrowRight"].includes(a)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(a)?void 0:Nd[a]}(e,u.orientation,u.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let s=h().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)s.reverse();else if("prev"===t||"next"===t){"prev"===t&&s.reverse();const r=s.indexOf(e.currentTarget);s=u.loop?(a=r+1,(n=s).map((e,t)=>n[(a+t)%n.length])):s.slice(r+1)}setTimeout(()=>_d(s))}var n,a}),children:"function"==typeof l?l({isCurrentTabStop:p,hasTabStop:null!=f}):l})})});wd.displayName=jd;var Nd={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function _d(e,t=!1){const n=document.activeElement;for(const a of e){if(a===n)return;if(a.focus({preventScroll:t}),document.activeElement!==n)return}}var kd=yd,Sd=wd,Cd="Tabs",[$d,Dd]=k(Cd,[gd]),Ed=gd(),[Td,Ad]=$d(Cd),Fd=re.forwardRef((t,n)=>{const{__scopeTabs:a,value:s,onValueChange:r,defaultValue:i,orientation:l="horizontal",dir:o,activationMode:d="automatic",...m}=t,u=L(o),[p,h]=P({prop:s,onChange:r,defaultProp:i??"",caller:Cd});return e.jsx(Td,{scope:a,baseId:R(),value:p,onValueChange:h,orientation:l,dir:u,activationMode:d,children:e.jsx(c.div,{dir:u,"data-orientation":l,...m,ref:n})})});Fd.displayName=Cd;var Pd="TabsList",Rd=re.forwardRef((t,n)=>{const{__scopeTabs:a,loop:s=!0,...r}=t,i=Ad(Pd,a),l=Ed(a);return e.jsx(kd,{asChild:!0,...l,orientation:i.orientation,dir:i.dir,loop:s,children:e.jsx(c.div,{role:"tablist","aria-orientation":i.orientation,...r,ref:n})})});Rd.displayName=Pd;var Od="TabsTrigger",Md=re.forwardRef((t,n)=>{const{__scopeTabs:a,value:s,disabled:r=!1,...i}=t,l=Ad(Od,a),o=Ed(a),d=zd(l.baseId,s),m=Bd(l.baseId,s),u=s===l.value;return e.jsx(Sd,{asChild:!0,...o,focusable:!r,active:u,children:e.jsx(c.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":m,"data-state":u?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:d,...i,ref:n,onMouseDown:E(t.onMouseDown,e=>{r||0!==e.button||!1!==e.ctrlKey?e.preventDefault():l.onValueChange(s)}),onKeyDown:E(t.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&l.onValueChange(s)}),onFocus:E(t.onFocus,()=>{const e="manual"!==l.activationMode;u||r||!e||l.onValueChange(s)})})})});Md.displayName=Od;var Ld="TabsContent",Id=re.forwardRef((t,n)=>{const{__scopeTabs:a,value:s,forceMount:r,children:i,...l}=t,o=Ad(Ld,a),d=zd(o.baseId,s),m=Bd(o.baseId,s),u=s===o.value,p=re.useRef(u);return re.useEffect(()=>{const e=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(e)},[]),e.jsx(O,{present:r||u,children:({present:a})=>e.jsx(c.div,{"data-state":u?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":d,hidden:!a,id:m,tabIndex:0,...l,ref:n,style:{...t.style,animationDuration:p.current?"0s":void 0},children:a&&i})})});function zd(e,t){return`${e}-trigger-${t}`}function Bd(e,t){return`${e}-content-${t}`}Id.displayName=Ld;var Vd=Rd,Yd=Md,qd=Id;const Ud=Fd,Hd=re.forwardRef(({className:t,...n},a)=>e.jsx(Vd,{ref:a,className:En("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...n}));Hd.displayName=Vd.displayName;const Gd=re.forwardRef(({className:t,...n},a)=>e.jsx(Yd,{ref:a,className:En("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...n}));Gd.displayName=Yd.displayName;const Wd=re.forwardRef(({className:t,...n},a)=>e.jsx(qd,{ref:a,className:En("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...n}));Wd.displayName=qd.displayName;const Kd=(e,t,n)=>{if(e&&"reportValidity"in e){const a=di(n,t);e.setCustomValidity(a&&a.message||""),e.reportValidity()}},Zd=(e,t)=>{for(const n in t.fields){const a=t.fields[n];a&&a.ref&&"reportValidity"in a.ref?Kd(a.ref,n,e):a&&a.refs&&a.refs.forEach(t=>Kd(t,n,e))}},Qd=(e,t)=>{t.shouldUseNativeValidation&&Zd(e,t);const n={};for(const a in e){const s=di(t.fields,a),r=Object.assign(e[a]||{},{ref:s&&s.ref});if(Xd(t.names||Object.keys(e),a)){const e=Object.assign({},di(n,a));ui(e,"root",r),ui(n,a,e)}else ui(n,a,r)}return n},Xd=(e,t)=>{const n=Jd(t);return e.some(e=>Jd(e).match(`^${n}\\.\\d+`))};function Jd(e){return e.replace(/\]|\[/g,"")}function em(e,t,n){function a(n,a){var s;Object.defineProperty(n,"_zod",{value:n._zod??{},enumerable:!1}),(s=n._zod).traits??(s.traits=new Set),n._zod.traits.add(e),t(n,a);for(const e in i.prototype)e in n||Object.defineProperty(n,e,{value:i.prototype[e].bind(n)});n._zod.constr=i,n._zod.def=a}const s=n?.Parent??Object;class r extends s{}function i(e){var t;const s=n?.Parent?new r:this;a(s,e),(t=s._zod).deferred??(t.deferred=[]);for(const n of s._zod.deferred)n();return s}return Object.defineProperty(r,"name",{value:e}),Object.defineProperty(i,"init",{value:a}),Object.defineProperty(i,Symbol.hasInstance,{value:t=>!!(n?.Parent&&t instanceof n.Parent)||t?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}class tm extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const nm={};function am(e){return e&&Object.assign(nm,e),nm}function sm(e,t){return"bigint"==typeof t?t.toString():t}const rm=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function im(e){return"string"==typeof e?e:e?.message}function lm(e,t,n){const a={...e,path:e.path??[]};if(!e.message){const s=im(e.inst?._zod.def?.error?.(e))??im(t?.error?.(e))??im(n.customError?.(e))??im(n.localeError?.(e))??"Invalid input";a.message=s}return delete a.inst,delete a.continue,t?.reportInput||delete a.input,a}const om=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,sm,2),enumerable:!0})},cm=em("$ZodError",om),dm=em("$ZodError",om,{Parent:Error}),mm=e=>(t,n,a,s)=>{const r=a?Object.assign(a,{async:!1}):{async:!1},i=t._zod.run({value:n,issues:[]},r);if(i instanceof Promise)throw new tm;if(i.issues.length){const t=new(s?.Err??e)(i.issues.map(e=>lm(e,r,am())));throw rm(t,s?.callee),t}return i.value},um=mm(dm),pm=e=>async(t,n,a,s)=>{const r=a?Object.assign(a,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},r);if(i instanceof Promise&&(i=await i),i.issues.length){const t=new(s?.Err??e)(i.issues.map(e=>lm(e,r,am())));throw rm(t,s?.callee),t}return i.value},hm=pm(dm);function xm(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function gm(e,t){for(var n={};e.length;){var a=e[0],s=a.code,r=a.message,i=a.path.join(".");if(!n[i])if("unionErrors"in a){var l=a.unionErrors[0].errors[0];n[i]={message:l.message,type:l.code}}else n[i]={message:r,type:s};if("unionErrors"in a&&a.unionErrors.forEach(function(t){return t.errors.forEach(function(t){return e.push(t)})}),t){var o=n[i].types,c=o&&o[a.code];n[i]=Oi(i,t,n,s,c?[].concat(c,a.message):a.message)}e.shift()}return n}function fm(e,t){for(var n={};e.length;){var a=e[0],s=a.code,r=a.message,i=a.path.join(".");if(!n[i])if("invalid_union"===a.code){var l=a.errors[0][0];n[i]={message:l.message,type:l.code}}else n[i]={message:r,type:s};if("invalid_union"===a.code&&a.errors.forEach(function(t){return t.forEach(function(t){return e.push(t)})}),t){var o=n[i].types,c=o&&o[a.code];n[i]=Oi(i,t,n,s,c?[].concat(c,a.message):a.message)}e.shift()}return n}function vm(e,t,n){if(void 0===n&&(n={}),function(e){return"_def"in e&&"object"==typeof e._def&&"typeName"in e._def}(e))return function(a,s,r){try{return Promise.resolve(xm(function(){return Promise.resolve(e["sync"===n.mode?"parse":"parseAsync"](a,t)).then(function(e){return r.shouldUseNativeValidation&&Zd({},r),{errors:{},values:n.raw?Object.assign({},a):e}})},function(e){if(function(e){return Array.isArray(null==e?void 0:e.issues)}(e))return{values:{},errors:Qd(gm(e.errors,!r.shouldUseNativeValidation&&"all"===r.criteriaMode),r)};throw e}))}catch(zf){return Promise.reject(zf)}};if(function(e){return"_zod"in e&&"object"==typeof e._zod}(e))return function(a,s,r){try{return Promise.resolve(xm(function(){return Promise.resolve(("sync"===n.mode?um:hm)(e,a,t)).then(function(e){return r.shouldUseNativeValidation&&Zd({},r),{errors:{},values:n.raw?Object.assign({},a):e}})},function(e){if(function(e){return e instanceof cm}(e))return{values:{},errors:Qd(fm(e.issues,!r.shouldUseNativeValidation&&"all"===r.criteriaMode),r)};throw e}))}catch(zf){return Promise.reject(zf)}};throw new Error("Invalid input: not a Zod schema")}var ym,bm;!function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(const e of n)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(ym||(ym={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(bm||(bm={}));const jm=ym.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),wm=e=>{switch(typeof e){case"undefined":return jm.undefined;case"string":return jm.string;case"number":return Number.isNaN(e)?jm.nan:jm.number;case"boolean":return jm.boolean;case"function":return jm.function;case"bigint":return jm.bigint;case"symbol":return jm.symbol;case"object":return Array.isArray(e)?jm.array:null===e?jm.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?jm.promise:"undefined"!=typeof Map&&e instanceof Map?jm.map:"undefined"!=typeof Set&&e instanceof Set?jm.set:"undefined"!=typeof Date&&e instanceof Date?jm.date:jm.object;default:return jm.unknown}},Nm=ym.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class _m extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},n={_errors:[]},a=e=>{for(const s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(a);else if("invalid_return_type"===s.code)a(s.returnTypeError);else if("invalid_arguments"===s.code)a(s.argumentsError);else if(0===s.path.length)n._errors.push(t(s));else{let e=n,a=0;for(;a<s.path.length;){const n=s.path[a];a===s.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(s))):e[n]=e[n]||{_errors:[]},e=e[n],a++}}};return a(this),n}static assert(e){if(!(e instanceof _m))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ym.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},n=[];for(const a of this.issues)if(a.path.length>0){const n=a.path[0];t[n]=t[n]||[],t[n].push(e(a))}else n.push(e(a));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}_m.create=e=>new _m(e);const km=(e,t)=>{let n;switch(e.code){case Nm.invalid_type:n=e.received===jm.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Nm.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,ym.jsonStringifyReplacer)}`;break;case Nm.unrecognized_keys:n=`Unrecognized key(s) in object: ${ym.joinValues(e.keys,", ")}`;break;case Nm.invalid_union:n="Invalid input";break;case Nm.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${ym.joinValues(e.options)}`;break;case Nm.invalid_enum_value:n=`Invalid enum value. Expected ${ym.joinValues(e.options)}, received '${e.received}'`;break;case Nm.invalid_arguments:n="Invalid function arguments";break;case Nm.invalid_return_type:n="Invalid function return type";break;case Nm.invalid_date:n="Invalid date";break;case Nm.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:ym.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Nm.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Nm.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Nm.custom:n="Invalid input";break;case Nm.invalid_intersection_types:n="Intersection results could not be merged";break;case Nm.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case Nm.not_finite:n="Number must be finite";break;default:n=t.defaultError,ym.assertNever(e)}return{message:n}};let Sm=km;function Cm(e,t){const n=Sm,a=(e=>{const{data:t,path:n,errorMaps:a,issueData:s}=e,r=[...n,...s.path||[]],i={...s,path:r};if(void 0!==s.message)return{...s,path:r,message:s.message};let l="";const o=a.filter(e=>!!e).slice().reverse();for(const c of o)l=c(i,{data:t,defaultError:l}).message;return{...s,path:r,message:l}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===km?void 0:km].filter(e=>!!e)});e.common.issues.push(a)}class $m{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const a of t){if("aborted"===a.status)return Dm;"dirty"===a.status&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const a of t){const e=await a.key,t=await a.value;n.push({key:e,value:t})}return $m.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const a of t){const{key:t,value:s}=a;if("aborted"===t.status)return Dm;if("aborted"===s.status)return Dm;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),"__proto__"===t.value||void 0===s.value&&!a.alwaysSet||(n[t.value]=s.value)}return{status:e.value,value:n}}}const Dm=Object.freeze({status:"aborted"}),Em=e=>({status:"dirty",value:e}),Tm=e=>({status:"valid",value:e}),Am=e=>"aborted"===e.status,Fm=e=>"dirty"===e.status,Pm=e=>"valid"===e.status,Rm=e=>"undefined"!=typeof Promise&&e instanceof Promise;var Om;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(Om||(Om={}));class Mm{constructor(e,t,n,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Lm=(e,t)=>{if(Pm(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new _m(e.common.issues);return this._error=t,this._error}}};function Im(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:a,description:s}=e;if(t&&(n||a))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:s};return{errorMap:(t,s)=>{const{message:r}=e;return"invalid_enum_value"===t.code?{message:r??s.defaultError}:void 0===s.data?{message:r??a??s.defaultError}:"invalid_type"!==t.code?{message:s.defaultError}:{message:r??n??s.defaultError}},description:s}}class zm{get description(){return this._def.description}_getType(e){return wm(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:wm(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new $m,ctx:{common:e.parent.common,data:e.data,parsedType:wm(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Rm(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wm(e)},a=this._parseSync({data:e,path:n.path,parent:n});return Lm(n,a)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wm(e)};if(!this["~standard"].async)try{const n=this._parseSync({data:e,path:[],parent:t});return Pm(n)?{value:n.value}:{issues:t.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>Pm(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wm(e)},a=this._parse({data:e,path:n.path,parent:n}),s=await(Rm(a)?a:Promise.resolve(a));return Lm(n,s)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{const s=e(t),r=()=>a.addIssue({code:Nm.custom,...n(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(e=>!!e||(r(),!1)):!!s||(r(),!1)})}refinement(e,t){return this._refinement((n,a)=>!!e(n)||(a.addIssue("function"==typeof t?t(n,a):t),!1))}_refinement(e){return new Lu({schema:this,typeName:Gu.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Iu.create(this,this._def)}nullable(){return zu.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Nu.create(this)}promise(){return Mu.create(this,this._def)}or(e){return Su.create([this,e],this._def)}and(e){return $u.create(this,e,this._def)}transform(e){return new Lu({...Im(this._def),schema:this,typeName:Gu.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Bu({...Im(this._def),innerType:this,defaultValue:t,typeName:Gu.ZodDefault})}brand(){return new qu({typeName:Gu.ZodBranded,type:this,...Im(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Vu({...Im(this._def),innerType:this,catchValue:t,typeName:Gu.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Uu.create(this,e)}readonly(){return Hu.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Bm=/^c[^\s-]{8,}$/i,Vm=/^[0-9a-z]+$/,Ym=/^[0-9A-HJKMNP-TV-Z]{26}$/i,qm=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Um=/^[a-z0-9_-]{21}$/i,Hm=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Gm=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Wm=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Km;const Zm=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Qm=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Xm=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Jm=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,eu=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,tu=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nu="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",au=new RegExp(`^${nu}$`);function su(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function ru(e){return new RegExp(`^${su(e)}$`)}function iu(e){let t=`${nu}T${su(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function lu(e,t){return!("v4"!==t&&t||!Zm.test(e))||!("v6"!==t&&t||!Xm.test(e))}function ou(e,t){if(!Hm.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const a=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(a));return"object"==typeof s&&null!==s&&((!("typ"in s)||"JWT"===s?.typ)&&(!!s.alg&&(!t||s.alg===t)))}catch{return!1}}function cu(e,t){return!("v4"!==t&&t||!Qm.test(e))||!("v6"!==t&&t||!Jm.test(e))}class du extends zm{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==jm.string){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.string,received:t.parsedType}),Dm}const t=new $m;let n;for(const a of this._def.checks)if("min"===a.kind)e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),Cm(n,{code:Nm.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("max"===a.kind)e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),Cm(n,{code:Nm.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("length"===a.kind){const s=e.data.length>a.value,r=e.data.length<a.value;(s||r)&&(n=this._getOrReturnCtx(e,n),s?Cm(n,{code:Nm.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):r&&Cm(n,{code:Nm.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),t.dirty())}else if("email"===a.kind)Wm.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"email",code:Nm.invalid_string,message:a.message}),t.dirty());else if("emoji"===a.kind)Km||(Km=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Km.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"emoji",code:Nm.invalid_string,message:a.message}),t.dirty());else if("uuid"===a.kind)qm.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"uuid",code:Nm.invalid_string,message:a.message}),t.dirty());else if("nanoid"===a.kind)Um.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"nanoid",code:Nm.invalid_string,message:a.message}),t.dirty());else if("cuid"===a.kind)Bm.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"cuid",code:Nm.invalid_string,message:a.message}),t.dirty());else if("cuid2"===a.kind)Vm.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"cuid2",code:Nm.invalid_string,message:a.message}),t.dirty());else if("ulid"===a.kind)Ym.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"ulid",code:Nm.invalid_string,message:a.message}),t.dirty());else if("url"===a.kind)try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),Cm(n,{validation:"url",code:Nm.invalid_string,message:a.message}),t.dirty()}else if("regex"===a.kind){a.regex.lastIndex=0;a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"regex",code:Nm.invalid_string,message:a.message}),t.dirty())}else if("trim"===a.kind)e.data=e.data.trim();else if("includes"===a.kind)e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),Cm(n,{code:Nm.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),t.dirty());else if("toLowerCase"===a.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===a.kind)e.data=e.data.toUpperCase();else if("startsWith"===a.kind)e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),Cm(n,{code:Nm.invalid_string,validation:{startsWith:a.value},message:a.message}),t.dirty());else if("endsWith"===a.kind)e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),Cm(n,{code:Nm.invalid_string,validation:{endsWith:a.value},message:a.message}),t.dirty());else if("datetime"===a.kind){iu(a).test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{code:Nm.invalid_string,validation:"datetime",message:a.message}),t.dirty())}else if("date"===a.kind){au.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{code:Nm.invalid_string,validation:"date",message:a.message}),t.dirty())}else if("time"===a.kind){ru(a).test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{code:Nm.invalid_string,validation:"time",message:a.message}),t.dirty())}else"duration"===a.kind?Gm.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"duration",code:Nm.invalid_string,message:a.message}),t.dirty()):"ip"===a.kind?lu(e.data,a.version)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"ip",code:Nm.invalid_string,message:a.message}),t.dirty()):"jwt"===a.kind?ou(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"jwt",code:Nm.invalid_string,message:a.message}),t.dirty()):"cidr"===a.kind?cu(e.data,a.version)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"cidr",code:Nm.invalid_string,message:a.message}),t.dirty()):"base64"===a.kind?eu.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"base64",code:Nm.invalid_string,message:a.message}),t.dirty()):"base64url"===a.kind?tu.test(e.data)||(n=this._getOrReturnCtx(e,n),Cm(n,{validation:"base64url",code:Nm.invalid_string,message:a.message}),t.dirty()):ym.assertNever(a);return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement(t=>e.test(t),{validation:t,code:Nm.invalid_string,...Om.errToObj(n)})}_addCheck(e){return new du({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Om.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Om.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Om.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Om.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Om.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Om.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Om.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Om.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Om.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Om.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Om.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Om.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Om.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...Om.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...Om.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...Om.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Om.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...Om.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Om.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Om.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Om.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Om.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Om.errToObj(t)})}nonempty(e){return this.min(1,Om.errToObj(e))}trim(){return new du({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new du({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new du({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function mu(e,t){const n=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,s=n>a?n:a;return Number.parseInt(e.toFixed(s).replace(".",""))%Number.parseInt(t.toFixed(s).replace(".",""))/10**s}du.create=e=>new du({checks:[],typeName:Gu.ZodString,coerce:e?.coerce??!1,...Im(e)});class uu extends zm{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==jm.number){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.number,received:t.parsedType}),Dm}let t;const n=new $m;for(const a of this._def.checks)if("int"===a.kind)ym.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Cm(t,{code:Nm.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty());else if("min"===a.kind){(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),Cm(t,{code:Nm.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty())}else if("max"===a.kind){(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),Cm(t,{code:Nm.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty())}else"multipleOf"===a.kind?0!==mu(e.data,a.value)&&(t=this._getOrReturnCtx(e,t),Cm(t,{code:Nm.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Cm(t,{code:Nm.not_finite,message:a.message}),n.dirty()):ym.assertNever(a);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Om.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Om.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Om.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Om.toString(t))}setLimit(e,t,n,a){return new uu({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Om.toString(a)}]})}_addCheck(e){return new uu({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Om.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Om.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Om.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Om.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Om.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Om.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Om.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Om.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Om.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&ym.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}uu.create=e=>new uu({checks:[],typeName:Gu.ZodNumber,coerce:e?.coerce||!1,...Im(e)});class pu extends zm{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==jm.bigint)return this._getInvalidInput(e);let t;const n=new $m;for(const a of this._def.checks)if("min"===a.kind){(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),Cm(t,{code:Nm.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty())}else if("max"===a.kind){(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),Cm(t,{code:Nm.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty())}else"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Cm(t,{code:Nm.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):ym.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.bigint,received:t.parsedType}),Dm}gte(e,t){return this.setLimit("min",e,!0,Om.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Om.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Om.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Om.toString(t))}setLimit(e,t,n,a){return new pu({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Om.toString(a)}]})}_addCheck(e){return new pu({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Om.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Om.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Om.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Om.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Om.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}pu.create=e=>new pu({checks:[],typeName:Gu.ZodBigInt,coerce:e?.coerce??!1,...Im(e)});class hu extends zm{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==jm.boolean){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.boolean,received:t.parsedType}),Dm}return Tm(e.data)}}hu.create=e=>new hu({typeName:Gu.ZodBoolean,coerce:e?.coerce||!1,...Im(e)});class xu extends zm{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==jm.date){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.date,received:t.parsedType}),Dm}if(Number.isNaN(e.data.getTime())){return Cm(this._getOrReturnCtx(e),{code:Nm.invalid_date}),Dm}const t=new $m;let n;for(const a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),Cm(n,{code:Nm.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),t.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),Cm(n,{code:Nm.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),t.dirty()):ym.assertNever(a);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new xu({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Om.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Om.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}xu.create=e=>new xu({checks:[],coerce:e?.coerce||!1,typeName:Gu.ZodDate,...Im(e)});class gu extends zm{_parse(e){if(this._getType(e)!==jm.symbol){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.symbol,received:t.parsedType}),Dm}return Tm(e.data)}}gu.create=e=>new gu({typeName:Gu.ZodSymbol,...Im(e)});class fu extends zm{_parse(e){if(this._getType(e)!==jm.undefined){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.undefined,received:t.parsedType}),Dm}return Tm(e.data)}}fu.create=e=>new fu({typeName:Gu.ZodUndefined,...Im(e)});class vu extends zm{_parse(e){if(this._getType(e)!==jm.null){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.null,received:t.parsedType}),Dm}return Tm(e.data)}}vu.create=e=>new vu({typeName:Gu.ZodNull,...Im(e)});class yu extends zm{constructor(){super(...arguments),this._any=!0}_parse(e){return Tm(e.data)}}yu.create=e=>new yu({typeName:Gu.ZodAny,...Im(e)});class bu extends zm{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Tm(e.data)}}bu.create=e=>new bu({typeName:Gu.ZodUnknown,...Im(e)});class ju extends zm{_parse(e){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.never,received:t.parsedType}),Dm}}ju.create=e=>new ju({typeName:Gu.ZodNever,...Im(e)});class wu extends zm{_parse(e){if(this._getType(e)!==jm.undefined){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.void,received:t.parsedType}),Dm}return Tm(e.data)}}wu.create=e=>new wu({typeName:Gu.ZodVoid,...Im(e)});class Nu extends zm{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),a=this._def;if(t.parsedType!==jm.array)return Cm(t,{code:Nm.invalid_type,expected:jm.array,received:t.parsedType}),Dm;if(null!==a.exactLength){const e=t.data.length>a.exactLength.value,s=t.data.length<a.exactLength.value;(e||s)&&(Cm(t,{code:e?Nm.too_big:Nm.too_small,minimum:s?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(Cm(t,{code:Nm.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(Cm(t,{code:Nm.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>a.type._parseAsync(new Mm(t,e,t.path,n)))).then(e=>$m.mergeArray(n,e));const s=[...t.data].map((e,n)=>a.type._parseSync(new Mm(t,e,t.path,n)));return $m.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new Nu({...this._def,minLength:{value:e,message:Om.toString(t)}})}max(e,t){return new Nu({...this._def,maxLength:{value:e,message:Om.toString(t)}})}length(e,t){return new Nu({...this._def,exactLength:{value:e,message:Om.toString(t)}})}nonempty(e){return this.min(1,e)}}function _u(e){if(e instanceof ku){const t={};for(const n in e.shape){const a=e.shape[n];t[n]=Iu.create(_u(a))}return new ku({...e._def,shape:()=>t})}return e instanceof Nu?new Nu({...e._def,type:_u(e.element)}):e instanceof Iu?Iu.create(_u(e.unwrap())):e instanceof zu?zu.create(_u(e.unwrap())):e instanceof Du?Du.create(e.items.map(e=>_u(e))):e}Nu.create=(e,t)=>new Nu({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Gu.ZodArray,...Im(t)});class ku extends zm{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=ym.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==jm.object){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.object,received:t.parsedType}),Dm}const{status:t,ctx:n}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),r=[];if(!(this._def.catchall instanceof ju&&"strip"===this._def.unknownKeys))for(const l in n.data)s.includes(l)||r.push(l);const i=[];for(const l of s){const e=a[l],t=n.data[l];i.push({key:{status:"valid",value:l},value:e._parse(new Mm(n,t,n.path,l)),alwaysSet:l in n.data})}if(this._def.catchall instanceof ju){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of r)i.push({key:{status:"valid",value:t},value:{status:"valid",value:n.data[t]}});else if("strict"===e)r.length>0&&(Cm(n,{code:Nm.unrecognized_keys,keys:r}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of r){const a=n.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new Mm(n,a,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of i){const n=await t.key,a=await t.value;e.push({key:n,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>$m.mergeObjectSync(t,e)):$m.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return Om.errToObj,new ku({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{const a=this._def.errorMap?.(t,n).message??n.defaultError;return"unrecognized_keys"===t.code?{message:Om.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new ku({...this._def,unknownKeys:"strip"})}passthrough(){return new ku({...this._def,unknownKeys:"passthrough"})}extend(e){return new ku({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ku({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Gu.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ku({...this._def,catchall:e})}pick(e){const t={};for(const n of ym.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new ku({...this._def,shape:()=>t})}omit(e){const t={};for(const n of ym.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new ku({...this._def,shape:()=>t})}deepPartial(){return _u(this)}partial(e){const t={};for(const n of ym.objectKeys(this.shape)){const a=this.shape[n];e&&!e[n]?t[n]=a:t[n]=a.optional()}return new ku({...this._def,shape:()=>t})}required(e){const t={};for(const n of ym.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof Iu;)e=e._def.innerType;t[n]=e}return new ku({...this._def,shape:()=>t})}keyof(){return Pu(ym.objectKeys(this.shape))}}ku.create=(e,t)=>new ku({shape:()=>e,unknownKeys:"strip",catchall:ju.create(),typeName:Gu.ZodObject,...Im(t)}),ku.strictCreate=(e,t)=>new ku({shape:()=>e,unknownKeys:"strict",catchall:ju.create(),typeName:Gu.ZodObject,...Im(t)}),ku.lazycreate=(e,t)=>new ku({shape:e,unknownKeys:"strip",catchall:ju.create(),typeName:Gu.ZodObject,...Im(t)});class Su extends zm{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map(async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const a of e)if("dirty"===a.result.status)return t.common.issues.push(...a.ctx.common.issues),a.result;const n=e.map(e=>new _m(e.ctx.common.issues));return Cm(t,{code:Nm.invalid_union,unionErrors:n}),Dm});{let e;const a=[];for(const r of n){const n={...t,common:{...t.common,issues:[]},parent:null},s=r._parseSync({data:t.data,path:t.path,parent:n});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:n}),n.common.issues.length&&a.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const s=a.map(e=>new _m(e));return Cm(t,{code:Nm.invalid_union,unionErrors:s}),Dm}}get options(){return this._def.options}}function Cu(e,t){const n=wm(e),a=wm(t);if(e===t)return{valid:!0,data:e};if(n===jm.object&&a===jm.object){const n=ym.objectKeys(t),a=ym.objectKeys(e).filter(e=>-1!==n.indexOf(e)),s={...e,...t};for(const r of a){const n=Cu(e[r],t[r]);if(!n.valid)return{valid:!1};s[r]=n.data}return{valid:!0,data:s}}if(n===jm.array&&a===jm.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let a=0;a<e.length;a++){const s=Cu(e[a],t[a]);if(!s.valid)return{valid:!1};n.push(s.data)}return{valid:!0,data:n}}return n===jm.date&&a===jm.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}Su.create=(e,t)=>new Su({options:e,typeName:Gu.ZodUnion,...Im(t)});class $u extends zm{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=(e,a)=>{if(Am(e)||Am(a))return Dm;const s=Cu(e.value,a.value);return s.valid?((Fm(e)||Fm(a))&&t.dirty(),{status:t.value,value:s.data}):(Cm(n,{code:Nm.invalid_intersection_types}),Dm)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}$u.create=(e,t,n)=>new $u({left:e,right:t,typeName:Gu.ZodIntersection,...Im(n)});class Du extends zm{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==jm.array)return Cm(n,{code:Nm.invalid_type,expected:jm.array,received:n.parsedType}),Dm;if(n.data.length<this._def.items.length)return Cm(n,{code:Nm.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Dm;!this._def.rest&&n.data.length>this._def.items.length&&(Cm(n,{code:Nm.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((e,t)=>{const a=this._def.items[t]||this._def.rest;return a?a._parse(new Mm(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(a).then(e=>$m.mergeArray(t,e)):$m.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new Du({...this._def,rest:e})}}Du.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Du({items:e,typeName:Gu.ZodTuple,rest:null,...Im(t)})};class Eu extends zm{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==jm.map)return Cm(n,{code:Nm.invalid_type,expected:jm.map,received:n.parsedType}),Dm;const a=this._def.keyType,s=this._def.valueType,r=[...n.data.entries()].map(([e,t],r)=>({key:a._parse(new Mm(n,e,n.path,[r,"key"])),value:s._parse(new Mm(n,t,n.path,[r,"value"]))}));if(n.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const n of r){const a=await n.key,s=await n.value;if("aborted"===a.status||"aborted"===s.status)return Dm;"dirty"!==a.status&&"dirty"!==s.status||t.dirty(),e.set(a.value,s.value)}return{status:t.value,value:e}})}{const e=new Map;for(const n of r){const a=n.key,s=n.value;if("aborted"===a.status||"aborted"===s.status)return Dm;"dirty"!==a.status&&"dirty"!==s.status||t.dirty(),e.set(a.value,s.value)}return{status:t.value,value:e}}}}Eu.create=(e,t,n)=>new Eu({valueType:t,keyType:e,typeName:Gu.ZodMap,...Im(n)});class Tu extends zm{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==jm.set)return Cm(n,{code:Nm.invalid_type,expected:jm.set,received:n.parsedType}),Dm;const a=this._def;null!==a.minSize&&n.data.size<a.minSize.value&&(Cm(n,{code:Nm.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&n.data.size>a.maxSize.value&&(Cm(n,{code:Nm.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const s=this._def.valueType;function r(e){const n=new Set;for(const a of e){if("aborted"===a.status)return Dm;"dirty"===a.status&&t.dirty(),n.add(a.value)}return{status:t.value,value:n}}const i=[...n.data.values()].map((e,t)=>s._parse(new Mm(n,e,n.path,t)));return n.common.async?Promise.all(i).then(e=>r(e)):r(i)}min(e,t){return new Tu({...this._def,minSize:{value:e,message:Om.toString(t)}})}max(e,t){return new Tu({...this._def,maxSize:{value:e,message:Om.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Tu.create=(e,t)=>new Tu({valueType:e,minSize:null,maxSize:null,typeName:Gu.ZodSet,...Im(t)});class Au extends zm{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Au.create=(e,t)=>new Au({getter:e,typeName:Gu.ZodLazy,...Im(t)});class Fu extends zm{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Cm(t,{received:t.data,code:Nm.invalid_literal,expected:this._def.value}),Dm}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Pu(e,t){return new Ru({values:e,typeName:Gu.ZodEnum,...Im(t)})}Fu.create=(e,t)=>new Fu({value:e,typeName:Gu.ZodLiteral,...Im(t)});class Ru extends zm{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return Cm(t,{expected:ym.joinValues(n),received:t.parsedType,code:Nm.invalid_type}),Dm}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return Cm(t,{received:t.data,code:Nm.invalid_enum_value,options:n}),Dm}return Tm(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ru.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ru.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}Ru.create=Pu;class Ou extends zm{_parse(e){const t=ym.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==jm.string&&n.parsedType!==jm.number){const e=ym.objectValues(t);return Cm(n,{expected:ym.joinValues(e),received:n.parsedType,code:Nm.invalid_type}),Dm}if(this._cache||(this._cache=new Set(ym.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=ym.objectValues(t);return Cm(n,{received:n.data,code:Nm.invalid_enum_value,options:e}),Dm}return Tm(e.data)}get enum(){return this._def.values}}Ou.create=(e,t)=>new Ou({values:e,typeName:Gu.ZodNativeEnum,...Im(t)});class Mu extends zm{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==jm.promise&&!1===t.common.async)return Cm(t,{code:Nm.invalid_type,expected:jm.promise,received:t.parsedType}),Dm;const n=t.parsedType===jm.promise?t.data:Promise.resolve(t.data);return Tm(n.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Mu.create=(e,t)=>new Mu({type:e,typeName:Gu.ZodPromise,...Im(t)});class Lu extends zm{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Gu.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),a=this._def.effect||null,s={addIssue:e=>{Cm(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===a.type){const e=a.transform(n.data,s);if(n.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return Dm;const a=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===a.status?Dm:"dirty"===a.status||"dirty"===t.value?Em(a.value):a});{if("aborted"===t.value)return Dm;const a=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===a.status?Dm:"dirty"===a.status||"dirty"===t.value?Em(a.value):a}}if("refinement"===a.type){const e=e=>{const t=a.refinement(e,s);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===a.status?Dm:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>"aborted"===n.status?Dm:("dirty"===n.status&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if("transform"===a.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Pm(e))return Dm;const r=a.transform(e.value,s);if(r instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:r}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>Pm(e)?Promise.resolve(a.transform(e.value,s)).then(e=>({status:t.value,value:e})):Dm)}ym.assertNever(a)}}Lu.create=(e,t,n)=>new Lu({schema:e,typeName:Gu.ZodEffects,effect:t,...Im(n)}),Lu.createWithPreprocess=(e,t,n)=>new Lu({schema:t,effect:{type:"preprocess",transform:e},typeName:Gu.ZodEffects,...Im(n)});class Iu extends zm{_parse(e){return this._getType(e)===jm.undefined?Tm(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Iu.create=(e,t)=>new Iu({innerType:e,typeName:Gu.ZodOptional,...Im(t)});class zu extends zm{_parse(e){return this._getType(e)===jm.null?Tm(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}zu.create=(e,t)=>new zu({innerType:e,typeName:Gu.ZodNullable,...Im(t)});class Bu extends zm{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===jm.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Bu.create=(e,t)=>new Bu({innerType:e,typeName:Gu.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Im(t)});class Vu extends zm{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Rm(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new _m(n.common.issues)},input:n.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new _m(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Vu.create=(e,t)=>new Vu({innerType:e,typeName:Gu.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Im(t)});class Yu extends zm{_parse(e){if(this._getType(e)!==jm.nan){const t=this._getOrReturnCtx(e);return Cm(t,{code:Nm.invalid_type,expected:jm.nan,received:t.parsedType}),Dm}return{status:"valid",value:e.data}}}Yu.create=e=>new Yu({typeName:Gu.ZodNaN,...Im(e)});class qu extends zm{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Uu extends zm{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Dm:"dirty"===e.status?(t.dirty(),Em(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})()}{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Dm:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new Uu({in:e,out:t,typeName:Gu.ZodPipeline})}}class Hu extends zm{_parse(e){const t=this._def.innerType._parse(e),n=e=>(Pm(e)&&(e.value=Object.freeze(e.value)),e);return Rm(t)?t.then(e=>n(e)):n(t)}unwrap(){return this._def.innerType}}var Gu;Hu.create=(e,t)=>new Hu({innerType:e,typeName:Gu.ZodReadonly,...Im(t)}),ku.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Gu||(Gu={}));const Wu=du.create,Ku=uu.create;ju.create,Nu.create;const Zu=ku.create;ku.strictCreate,Su.create,$u.create,Du.create,Ru.create,Mu.create,Iu.create,zu.create;const Qu=e=>{const{children:t,...n}=e;return ie.createElement($i.Provider,{value:n},t)},Xu=re.createContext({}),Ju=({...t})=>e.jsx(Xu.Provider,{value:{name:t.name},children:e.jsx(Ri,{...t})}),ep=()=>{const e=re.useContext(Xu),t=re.useContext(tp),{getFieldState:n,formState:a}=Di(),s=n(e.name,a);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:r}=t;return{id:r,name:e.name,formItemId:`${r}-form-item`,formDescriptionId:`${r}-form-item-description`,formMessageId:`${r}-form-item-message`,...s}},tp=re.createContext({}),np=re.forwardRef(({className:t,...n},a)=>{const s=re.useId();return e.jsx(tp.Provider,{value:{id:s},children:e.jsx("div",{ref:a,className:En("space-y-2",t),...n})})});np.displayName="FormItem";const ap=re.forwardRef(({className:t,...n},a)=>{const{error:s,formItemId:r}=ep();return e.jsx(Yr,{ref:a,className:En(s&&"text-destructive",t),htmlFor:r,...n})});ap.displayName="FormLabel";const sp=re.forwardRef(({...t},n)=>{const{error:a,formItemId:s,formDescriptionId:r,formMessageId:i}=ep();return e.jsx(o,{ref:n,id:s,"aria-describedby":a?`${r} ${i}`:`${r}`,"aria-invalid":!!a,...t})});sp.displayName="FormControl";re.forwardRef(({className:t,...n},a)=>{const{formDescriptionId:s}=ep();return e.jsx("p",{ref:a,id:s,className:En("text-[0.8rem] text-muted-foreground",t),...n})}).displayName="FormDescription";const rp=re.forwardRef(({className:t,children:n,...a},s)=>{const{error:r,formMessageId:i}=ep(),l=r?String(r?.message??""):n;return l?e.jsx("p",{ref:s,id:i,className:En("text-[0.8rem] font-medium text-destructive",t),...a,children:l}):null});rp.displayName="FormMessage";const ip=Zu({name:Wu().min(1,"اسم العنصر مطلوب"),description:Wu().optional(),category:Wu().min(1,"الفئة مطلوبة"),quantity:Ku().min(0,"الكمية يجب أن تكون صفر أو أكثر"),unit:Wu().optional(),cost_per_unit:Ku().min(0,"التكلفة يجب أن تكون صفر أو أكثر").optional(),supplier:Wu().optional(),expiry_date:Wu().optional(),minimum_stock:Ku().min(0,"الحد الأدنى يجب أن يكون صفر أو أكثر")}),lp=["أدوات طبية","مواد استهلاكية","أدوية","مواد حشو","معدات تعقيم","مواد تجميل","أدوات جراحة","مواد تنظيف","معدات تشخيص","مواد وقاية"],op=["قطعة","علبة","زجاجة","أنبوب","كيس","لتر","مل","جرام","كيلو","متر"];function cp({isOpen:t,onClose:n,onSave:a,categories:s,suppliers:r}){const{toast:i}=Bl(),[l,o]=re.useState(!1),[c,d]=re.useState(""),[m,u]=re.useState(""),p=jl({resolver:vm(ip),defaultValues:{name:"",description:"",category:"",quantity:0,unit:"",cost_per_unit:0,supplier:"",expiry_date:"",minimum_stock:0}}),h=()=>{p.reset(),d(""),u(""),n()},x=[...new Set([...lp,...s])],g=[...new Set(r)];return e.jsx(Sr,{open:t,onOpenChange:h,children:e.jsxs(Dr,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsx(Ar,{className:"text-xl font-bold text-foreground",children:"إضافة عنصر مخزون جديد"}),e.jsx(Fr,{children:"أدخل تفاصيل العنصر الجديد في المخزون"})]}),e.jsx(Qu,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(async e=>{o(!0);try{const t={...e,category:c||e.category,supplier:m||e.supplier};await a(t),p.reset(),d(""),u(""),n(),i({title:"نجح",description:"تم إضافة العنصر بنجاح"})}catch(t){console.error("Error adding inventory item:",t),i({title:"خطأ",description:"فشل في إضافة العنصر. يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{o(!1)}}),className:"space-y-4",children:[e.jsx(Ju,{control:p.control,name:"name",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"اسم العنصر *"}),e.jsx(sp,{children:e.jsx(Ir,{placeholder:"مثال: قفازات طبية",...t,className:"text-right"})}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:p.control,name:"description",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"الوصف"}),e.jsx(sp,{children:e.jsx(wl,{placeholder:"وصف مختصر للعنصر...",...t,className:"text-right resize-none",rows:2})}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:p.control,name:"category",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"الفئة *"}),e.jsxs(Nl,{onValueChange:t.onChange,value:t.value,children:[e.jsx(sp,{children:e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر الفئة"})})}),e.jsxs(Dl,{children:[x.map(t=>e.jsx(Al,{value:t,children:t},t)),e.jsx(Al,{value:"custom",children:"فئة جديدة..."})]})]}),"custom"===t.value&&e.jsx(Ir,{placeholder:"أدخل اسم الفئة الجديدة",value:c,onChange:e=>d(e.target.value),className:"mt-2 text-right"}),e.jsx(rp,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Ju,{control:p.control,name:"quantity",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"الكمية *"}),e.jsx(sp,{children:e.jsx(Ir,{type:"number",min:"0",placeholder:"0",...t,onChange:e=>{const n=e.target.value;t.onChange(""===n?0:Number(n))},onBlur:e=>{const n=Number(e.target.value)||0;t.onChange(n)},className:"text-right"})}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:p.control,name:"unit",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"الوحدة"}),e.jsxs(Nl,{onValueChange:t.onChange,value:t.value,children:[e.jsx(sp,{children:e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر الوحدة"})})}),e.jsx(Dl,{children:op.map(t=>e.jsx(Al,{value:t,children:t},t))})]}),e.jsx(rp,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Ju,{control:p.control,name:"cost_per_unit",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"تكلفة الوحدة "}),e.jsx(sp,{children:e.jsx(Ir,{type:"number",min:"0",step:"0.1",placeholder:"0.00",...t,onChange:e=>{const n=e.target.value;t.onChange(""===n?0:Number(n))},onBlur:e=>{const n=Number(e.target.value)||0;t.onChange(n)},className:"text-right"})}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:p.control,name:"minimum_stock",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"الحد الأدنى *"}),e.jsx(sp,{children:e.jsx(Ir,{type:"number",min:"0",placeholder:"0",...t,onChange:e=>t.onChange(Number(e.target.value)),className:"text-right"})}),e.jsx(rp,{})]})})]}),e.jsx(Ju,{control:p.control,name:"supplier",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"المورد"}),e.jsxs(Nl,{onValueChange:t.onChange,value:t.value,children:[e.jsx(sp,{children:e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر المورد"})})}),e.jsxs(Dl,{children:[g.map(t=>e.jsx(Al,{value:t,children:t},t)),e.jsx(Al,{value:"custom",children:"مورد جديد..."})]})]}),"custom"===t.value&&e.jsx(Ir,{placeholder:"أدخل اسم المورد الجديد",value:m,onChange:e=>u(e.target.value),className:"mt-2 text-right"}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:p.control,name:"expiry_date",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"تاريخ انتهاء الصلاحية"}),e.jsx(sp,{children:e.jsx(Ir,{type:"date",...t,className:"text-right"})}),e.jsx(rp,{})]})}),e.jsxs(Tr,{className:"gap-2",children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:h,disabled:l,children:"إلغاء"}),e.jsxs(Lr,{type:"submit",disabled:l,children:[l&&e.jsx(As,{className:"mr-2 h-4 w-4 animate-spin"}),"إضافة العنصر"]})]})]})})]})})}const dp=Zu({name:Wu().min(1,"اسم العنصر مطلوب"),description:Wu().optional(),category:Wu().min(1,"الفئة مطلوبة"),quantity:Ku().min(0,"الكمية يجب أن تكون صفر أو أكثر"),unit:Wu().optional(),cost_per_unit:Ku().min(0,"التكلفة يجب أن تكون صفر أو أكثر").optional(),supplier:Wu().optional(),expiry_date:Wu().optional(),minimum_stock:Ku().min(0,"الحد الأدنى يجب أن يكون صفر أو أكثر")}),mp=["أدوات طبية","مواد استهلاكية","أدوية","مواد حشو","معدات تعقيم","مواد تجميل","أدوات جراحة","مواد تنظيف","معدات تشخيص","مواد وقاية"],up=["قطعة","علبة","زجاجة","أنبوب","كيس","لتر","مل","جرام","كيلو","متر"];function pp({isOpen:t,onClose:n,onSave:a,item:s,categories:r,suppliers:i}){const{toast:l}=Bl(),[o,c]=re.useState(!1),[d,m]=re.useState(""),[u,p]=re.useState(""),h=jl({resolver:vm(dp),defaultValues:{name:"",description:"",category:"",quantity:0,unit:"",cost_per_unit:0,supplier:"",expiry_date:"",minimum_stock:0}});re.useEffect(()=>{s&&t&&(h.reset({name:s.name||"",description:s.description||"",category:s.category||"",quantity:s.quantity||0,unit:s.unit||"",cost_per_unit:s.cost_per_unit||0,supplier:s.supplier||"",expiry_date:s.expiry_date||"",minimum_stock:s.minimum_stock||0}),m(""),p(""))},[s,t,h]);const x=()=>{h.reset(),m(""),p(""),n()},g=[...new Set([...mp,...r])],f=[...new Set(i)];return s?e.jsx(Sr,{open:t,onOpenChange:x,children:e.jsxs(Dr,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Er,{children:[e.jsx(Ar,{className:"text-xl font-bold text-foreground",children:"تعديل عنصر المخزون"}),e.jsxs(Fr,{children:["تعديل تفاصيل العنصر: ",s.name]})]}),e.jsx(Qu,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(async e=>{if(s){c(!0);try{const t={...e,category:d||e.category,supplier:u||e.supplier};await a(s.id,t),n(),l({title:"نجح",description:"تم تحديث العنصر بنجاح"})}catch(t){console.error("Error updating inventory item:",t),l({title:"خطأ",description:"فشل في تحديث العنصر. يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{c(!1)}}}),className:"space-y-4",children:[e.jsx(Ju,{control:h.control,name:"name",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"اسم العنصر *"}),e.jsx(sp,{children:e.jsx(Ir,{placeholder:"مثال: قفازات طبية",...t,className:"text-right"})}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:h.control,name:"description",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"الوصف"}),e.jsx(sp,{children:e.jsx(wl,{placeholder:"وصف مختصر للعنصر...",...t,className:"text-right resize-none",rows:2})}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:h.control,name:"category",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"الفئة *"}),e.jsxs(Nl,{onValueChange:t.onChange,value:t.value,children:[e.jsx(sp,{children:e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر الفئة"})})}),e.jsxs(Dl,{children:[g.map(t=>e.jsx(Al,{value:t,children:t},t)),e.jsx(Al,{value:"custom",children:"فئة جديدة..."})]})]}),"custom"===t.value&&e.jsx(Ir,{placeholder:"أدخل اسم الفئة الجديدة",value:d,onChange:e=>m(e.target.value),className:"mt-2 text-right"}),e.jsx(rp,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Ju,{control:h.control,name:"quantity",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"الكمية *"}),e.jsx(sp,{children:e.jsx(Ir,{type:"number",min:"0",placeholder:"0",...t,onChange:e=>{const n=e.target.value;t.onChange(""===n?0:Number(n))},onBlur:e=>{const n=Number(e.target.value)||0;t.onChange(n)},className:"text-right"})}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:h.control,name:"unit",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"الوحدة"}),e.jsxs(Nl,{onValueChange:t.onChange,value:t.value,children:[e.jsx(sp,{children:e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر الوحدة"})})}),e.jsx(Dl,{children:up.map(t=>e.jsx(Al,{value:t,children:t},t))})]}),e.jsx(rp,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Ju,{control:h.control,name:"cost_per_unit",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"تكلفة الوحدة"}),e.jsx(sp,{children:e.jsx(Ir,{type:"number",min:"0",step:"0.1",placeholder:"0.00",...t,onChange:e=>{const n=e.target.value;t.onChange(""===n?0:Number(n))},onBlur:e=>{const n=Number(e.target.value)||0;t.onChange(n)},className:"text-right"})}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:h.control,name:"minimum_stock",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"الحد الأدنى *"}),e.jsx(sp,{children:e.jsx(Ir,{type:"number",min:"0",placeholder:"0",...t,onChange:e=>t.onChange(Number(e.target.value)),className:"text-right"})}),e.jsx(rp,{})]})})]}),e.jsx(Ju,{control:h.control,name:"supplier",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"المورد"}),e.jsxs(Nl,{onValueChange:t.onChange,value:t.value,children:[e.jsx(sp,{children:e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر المورد"})})}),e.jsxs(Dl,{children:[f.map(t=>e.jsx(Al,{value:t,children:t},t)),e.jsx(Al,{value:"custom",children:"مورد جديد..."})]})]}),"custom"===t.value&&e.jsx(Ir,{placeholder:"أدخل اسم المورد الجديد",value:u,onChange:e=>p(e.target.value),className:"mt-2 text-right"}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:h.control,name:"expiry_date",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"تاريخ انتهاء الصلاحية"}),e.jsx(sp,{children:e.jsx(Ir,{type:"date",...t,className:"text-right"})}),e.jsx(rp,{})]})}),e.jsxs(Tr,{className:"gap-2",children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:x,disabled:o,children:"إلغاء"}),e.jsxs(Lr,{type:"submit",disabled:o,children:[o&&e.jsx(As,{className:"mr-2 h-4 w-4 animate-spin"}),"حفظ التغييرات"]})]})]})})]})}):null}function hp({isOpen:t,onClose:n,onConfirm:a,item:s,isLoading:r=!1}){const{toast:i}=Bl(),[l,o]=re.useState(!1);return s?e.jsx(go,{open:t,onOpenChange:n,children:e.jsxs(yo,{className:"sm:max-w-[425px]",dir:"rtl",children:[e.jsx(bo,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-destructive/10",children:e.jsx(qa,{className:"h-6 w-6 text-destructive"})}),e.jsx("div",{children:e.jsx(wo,{className:"text-lg font-semibold text-foreground",children:"تأكيد حذف العنصر"})})]})}),e.jsx(No,{className:"text-right text-muted-foreground",children:"هل أنت متأكد من حذف العنصر التالي من المخزون؟"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-foreground",children:s.name}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"الاسم:"})]}),s.category&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:s.category}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"الفئة:"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:[s.quantity," ",s.unit||"قطعة"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"الكمية:"})]}),s.supplier&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:s.supplier}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"المورد:"})]})]}),e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-destructive font-medium",children:"⚠️ تحذير: هذا الإجراء لا يمكن التراجع عنه"}),e.jsx("p",{className:"text-xs text-destructive/80 mt-1",children:"سيتم حذف العنصر وجميع سجلات الاستخدام المرتبطة به نهائياً"})]})]}),e.jsxs(jo,{className:"gap-2",children:[e.jsx(ko,{onClick:n,disabled:l||r,className:"flex-1",children:"إلغاء"}),e.jsxs(_o,{onClick:async()=>{if(s){o(!0);try{await a(s.id),n(),i({title:"نجح",description:"تم حذف العنصر بنجاح"})}catch(e){console.error("Error deleting inventory item:",e),i({title:"خطأ",description:"فشل في حذف العنصر. يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{o(!1)}}},disabled:l||r,className:"flex-1 bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[(l||r)&&e.jsx(As,{className:"mr-2 h-4 w-4 animate-spin"}),"حذف العنصر"]})]})]})}):null}const xp=Zu({quantity_used:Ku().min(1,"الكمية المستخدمة يجب أن تكون أكبر من صفر"),appointment_id:Wu().optional(),notes:Wu().optional(),usage_date:Wu().min(1,"تاريخ الاستخدام مطلوب")});function gp({isOpen:t,onClose:n,onSave:a,item:s,appointments:r}){const{toast:i}=Bl(),[l,o]=re.useState(!1),c=jl({resolver:vm(xp),defaultValues:{quantity_used:1,appointment_id:"",notes:"",usage_date:(new Date).toISOString().split("T")[0]}}),d=()=>{c.reset(),n()};if(!s)return null;const m=(new Date).toISOString().split("T")[0],u=r.filter(e=>e.start_time.startsWith(m)),p=s.quantity<=s.minimum_stock,h=0===s.quantity;return e.jsx(Sr,{open:t,onOpenChange:d,children:e.jsxs(Dr,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsx(Ar,{className:"text-xl font-bold text-foreground",children:"تسجيل استخدام المواد"}),e.jsxs(Fr,{children:["تسجيل استخدام: ",s.name]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-foreground",children:s.name}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"العنصر:"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:[s.quantity," ",s.unit||"قطعة"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"الكمية المتوفرة:"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:s.minimum_stock}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"الحد الأدنى:"})]})]}),h&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qa,{className:"h-4 w-4 text-destructive"}),e.jsx("p",{className:"text-sm text-destructive font-medium",children:"تحذير: نفد المخزون من هذا العنصر"})]})}),p&&!h&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qa,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-400"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 font-medium",children:"تحذير: المخزون منخفض (أقل من الحد الأدنى)"})]})}),e.jsx(Qu,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(async e=>{if(s)if(e.quantity_used>s.quantity)i({title:"خطأ",description:`الكمية المطلوبة (${e.quantity_used}) أكبر من الكمية المتوفرة (${s.quantity})`,variant:"destructive"});else{o(!0);try{const t={inventory_id:s.id,quantity_used:e.quantity_used,appointment_id:e.appointment_id||void 0,notes:e.notes||void 0,usage_date:e.usage_date};await a(t),c.reset({quantity_used:1,appointment_id:"",notes:"",usage_date:(new Date).toISOString().split("T")[0]}),n(),i({title:"نجح",description:"تم تسجيل الاستخدام بنجاح"})}catch(t){console.error("Error recording usage:",t),i({title:"خطأ",description:"فشل في تسجيل الاستخدام. يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{o(!1)}}}),className:"space-y-4",children:[e.jsx(Ju,{control:c.control,name:"quantity_used",render:({field:t})=>e.jsxs(np,{children:[e.jsxs(ap,{className:"text-sm font-medium",children:["الكمية المستخدمة * (",s.unit||"قطعة",")"]}),e.jsx(sp,{children:e.jsx(Ir,{type:"number",min:"1",max:s.quantity,placeholder:"1",...t,onChange:e=>{const n=e.target.value;t.onChange(""===n?1:Number(n))},onBlur:e=>{const n=Number(e.target.value)||1;t.onChange(n)},className:"text-right",disabled:h})}),e.jsx(rp,{}),t.value>s.quantity&&e.jsxs("p",{className:"text-sm text-destructive",children:["الكمية المطلوبة أكبر من المتوفر (",s.quantity,")"]})]})}),e.jsx(Ju,{control:c.control,name:"usage_date",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"تاريخ الاستخدام *"}),e.jsx(sp,{children:e.jsx(Ir,{type:"date",...t,className:"text-right"})}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:c.control,name:"appointment_id",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"الموعد المرتبط (اختياري)"}),e.jsxs(Nl,{onValueChange:t.onChange,value:t.value,children:[e.jsx(sp,{children:e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر الموعد"})})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"none",children:"بدون موعد محدد"}),u.map(t=>e.jsxs(Al,{value:t.id,children:[t.title," - ",t.patient?.first_name," ",t.patient?.last_name]},t.id)),r.filter(e=>!e.start_time.startsWith(m)).slice(0,10).map(t=>e.jsxs(Al,{value:t.id,children:[t.title," - ",t.patient?.first_name," ",t.patient?.last_name,e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",(()=>{const e=new Date(t.start_time);return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})(),")"]})]},t.id))]})]}),e.jsx(rp,{})]})}),e.jsx(Ju,{control:c.control,name:"notes",render:({field:t})=>e.jsxs(np,{children:[e.jsx(ap,{className:"text-sm font-medium",children:"ملاحظات"}),e.jsx(sp,{children:e.jsx(wl,{placeholder:"ملاحظات حول الاستخدام...",...t,className:"text-right resize-none",rows:3})}),e.jsx(rp,{})]})}),e.jsxs(Tr,{className:"gap-2",children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:d,disabled:l,children:"إلغاء"}),e.jsxs(Lr,{type:"submit",disabled:l||h||c.watch("quantity_used")>s.quantity,children:[l&&e.jsx(As,{className:"mr-2 h-4 w-4 animate-spin"}),"تسجيل الاستخدام"]})]})]})})]})})}function fp({items:t,onRefresh:n,onItemClick:a}){const[s,r]=re.useState(!0),[i,l]=re.useState(!0),[o,c]=re.useState(!0),d=new Date,m=t.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0),u=t.filter(e=>0===e.quantity),p=t.filter(e=>e.expiry_date&&new Date(e.expiry_date)<d),h=t.filter(e=>{if(!e.expiry_date)return!1;const t=new Date(e.expiry_date),n=Math.ceil((t.getTime()-d.getTime())/864e5);return n<=30&&n>0}),{formatAmount:x}=oa(),g=e=>{const t=new Date(e);return Math.ceil((t.getTime()-d.getTime())/864e5)},f=({title:t,items:n,icon:s,color:r,isVisible:i,onToggle:l,emptyMessage:o})=>e.jsx(nc,{className:`border-l-4 ${r}`,children:e.jsxs(Cc,{open:i,onOpenChange:l,children:[e.jsx(ac,{className:"pb-3",children:e.jsx($c,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s,e.jsxs("div",{children:[e.jsx(sc,{className:"text-lg font-semibold",children:t}),e.jsxs(rc,{children:[n.length," عنصر"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oc,{variant:"secondary",className:"text-sm",children:n.length}),i?e.jsx(vs,{className:"h-4 w-4"}):e.jsx(ys,{className:"h-4 w-4"})]})]})})}),e.jsx(Dc,{children:e.jsx(ic,{className:"pt-0",children:0===n.length?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:o}):e.jsx("div",{className:"space-y-3",children:n.map(t=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>a?.(t),children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-foreground",children:t.name}),e.jsx("div",{className:"text-left",children:t.category&&e.jsx(oc,{variant:"outline",className:"text-xs",children:t.category})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["الكمية: ",t.quantity," ",t.unit||"قطعة",t.minimum_stock>0&&e.jsxs("span",{className:"mr-2",children:["(الحد الأدنى: ",t.minimum_stock,")"]})]}),t.expiry_date&&e.jsx("div",{className:"text-left",children:p.includes(t)?e.jsx("span",{className:"text-destructive font-medium",children:"منتهي الصلاحية"}):h.includes(t)?e.jsxs("span",{className:"text-yellow-600 dark:text-yellow-400 font-medium",children:["ينتهي خلال ",g(t.expiry_date)," يوم"]}):e.jsxs("span",{children:["ينتهي: ",(()=>{const e=new Date(t.expiry_date);return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()]})})]}),t.cost_per_unit&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["القيمة الإجمالية: ",x(t.quantity*t.cost_per_unit)]})]})},t.id))})})})]})}),v=m.length+u.length+p.length+h.length;return 0===v?e.jsx(nc,{className:"border-green-200 dark:border-green-800",children:e.jsx(ic,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Bs,{className:"h-12 w-12 mx-auto mb-3 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-green-700 dark:text-green-400 mb-2",children:"لا توجد تنبيهات"}),e.jsx("p",{className:"text-green-600 dark:text-green-300",children:"جميع عناصر المخزون في حالة جيدة"}),n&&e.jsxs(Lr,{variant:"outline",size:"sm",onClick:n,className:"mt-3",children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"تحديث"]})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"تنبيهات المخزون"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v," تنبيه يتطلب انتباهك"]})]}),n&&e.jsxs(Lr,{variant:"outline",size:"sm",onClick:n,children:[e.jsx(Js,{className:"h-4 w-4 mr-2"}),"تحديث"]})]}),u.length>0&&e.jsx(f,{title:"نفد المخزون",items:u,icon:e.jsx(qa,{className:"h-5 w-5 text-destructive"}),color:"border-l-destructive",isVisible:i,onToggle:()=>l(!i),emptyMessage:"لا توجد عناصر نفد مخزونها"}),m.length>0&&e.jsx(f,{title:"مخزون منخفض",items:m,icon:e.jsx(Bs,{className:"h-5 w-5 text-yellow-600"}),color:"border-l-yellow-500",isVisible:s,onToggle:()=>r(!s),emptyMessage:"لا توجد عناصر بمخزون منخفض"}),p.length>0&&e.jsx(f,{title:"منتهية الصلاحية",items:p,icon:e.jsx(es,{className:"h-5 w-5 text-destructive"}),color:"border-l-destructive",isVisible:i,onToggle:()=>l(!i),emptyMessage:"لا توجد عناصر منتهية الصلاحية"}),h.length>0&&e.jsx(f,{title:"تنتهي صلاحيتها قريباً",items:h,icon:e.jsx(es,{className:"h-5 w-5 text-yellow-600"}),color:"border-l-yellow-500",isVisible:o,onToggle:()=>c(!o),emptyMessage:"لا توجد عناصر تنتهي صلاحيتها قريباً"})]})}var vp="ScrollArea",[yp,bp]=k(vp),[jp,wp]=yp(vp),Np=re.forwardRef((t,n)=>{const{__scopeScrollArea:a,type:s="hover",dir:r,scrollHideDelay:i=600,...l}=t,[o,d]=re.useState(null),[m,u]=re.useState(null),[p,h]=re.useState(null),[x,g]=re.useState(null),[f,v]=re.useState(null),[y,b]=re.useState(0),[j,w]=re.useState(0),[N,_]=re.useState(!1),[k,S]=re.useState(!1),C=$(n,e=>d(e)),D=L(r);return e.jsx(jp,{scope:a,type:s,dir:D,scrollHideDelay:i,scrollArea:o,viewport:m,onViewportChange:u,content:p,onContentChange:h,scrollbarX:x,onScrollbarXChange:g,scrollbarXEnabled:N,onScrollbarXEnabledChange:_,scrollbarY:f,onScrollbarYChange:v,scrollbarYEnabled:k,onScrollbarYEnabledChange:S,onCornerWidthChange:b,onCornerHeightChange:w,children:e.jsx(c.div,{dir:D,...l,ref:C,style:{position:"relative","--radix-scroll-area-corner-width":y+"px","--radix-scroll-area-corner-height":j+"px",...t.style}})})});Np.displayName=vp;var _p="ScrollAreaViewport",kp=re.forwardRef((t,n)=>{const{__scopeScrollArea:a,children:s,nonce:r,...i}=t,l=wp(_p,a),o=re.useRef(null),d=$(n,o,l.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),e.jsx(c.div,{"data-radix-scroll-area-viewport":"",...i,ref:d,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:s})})]})});kp.displayName=_p;var Sp="ScrollAreaScrollbar",Cp=re.forwardRef((t,n)=>{const{forceMount:a,...s}=t,r=wp(Sp,t.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:l}=r,o="horizontal"===t.orientation;return re.useEffect(()=>(o?i(!0):l(!0),()=>{o?i(!1):l(!1)}),[o,i,l]),"hover"===r.type?e.jsx($p,{...s,ref:n,forceMount:a}):"scroll"===r.type?e.jsx(Dp,{...s,ref:n,forceMount:a}):"auto"===r.type?e.jsx(Ep,{...s,ref:n,forceMount:a}):"always"===r.type?e.jsx(Tp,{...s,ref:n}):null});Cp.displayName=Sp;var $p=re.forwardRef((t,n)=>{const{forceMount:a,...s}=t,r=wp(Sp,t.__scopeScrollArea),[i,l]=re.useState(!1);return re.useEffect(()=>{const e=r.scrollArea;let t=0;if(e){const n=()=>{window.clearTimeout(t),l(!0)},a=()=>{t=window.setTimeout(()=>l(!1),r.scrollHideDelay)};return e.addEventListener("pointerenter",n),e.addEventListener("pointerleave",a),()=>{window.clearTimeout(t),e.removeEventListener("pointerenter",n),e.removeEventListener("pointerleave",a)}}},[r.scrollArea,r.scrollHideDelay]),e.jsx(O,{present:a||i,children:e.jsx(Ep,{"data-state":i?"visible":"hidden",...s,ref:n})})}),Dp=re.forwardRef((t,n)=>{const{forceMount:a,...s}=t,r=wp(Sp,t.__scopeScrollArea),i="horizontal"===t.orientation,l=Zp(()=>c("SCROLL_END"),100),[o,c]=(d="hidden",m={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},re.useReducer((e,t)=>m[e][t]??e,d));var d,m;return re.useEffect(()=>{if("idle"===o){const e=window.setTimeout(()=>c("HIDE"),r.scrollHideDelay);return()=>window.clearTimeout(e)}},[o,r.scrollHideDelay,c]),re.useEffect(()=>{const e=r.viewport,t=i?"scrollLeft":"scrollTop";if(e){let n=e[t];const a=()=>{const a=e[t];n!==a&&(c("SCROLL"),l()),n=a};return e.addEventListener("scroll",a),()=>e.removeEventListener("scroll",a)}},[r.viewport,i,c,l]),e.jsx(O,{present:a||"hidden"!==o,children:e.jsx(Tp,{"data-state":"hidden"===o?"hidden":"visible",...s,ref:n,onPointerEnter:E(t.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:E(t.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),Ep=re.forwardRef((t,n)=>{const a=wp(Sp,t.__scopeScrollArea),{forceMount:s,...r}=t,[i,l]=re.useState(!1),o="horizontal"===t.orientation,c=Zp(()=>{if(a.viewport){const e=a.viewport.offsetWidth<a.viewport.scrollWidth,t=a.viewport.offsetHeight<a.viewport.scrollHeight;l(o?e:t)}},10);return Qp(a.viewport,c),Qp(a.content,c),e.jsx(O,{present:s||i,children:e.jsx(Tp,{"data-state":i?"visible":"hidden",...r,ref:n})})}),Tp=re.forwardRef((t,n)=>{const{orientation:a="vertical",...s}=t,r=wp(Sp,t.__scopeScrollArea),i=re.useRef(null),l=re.useRef(0),[o,c]=re.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=qp(o.viewport,o.content),m={...s,sizes:o,onSizesChange:c,hasThumb:Boolean(d>0&&d<1),onThumbChange:e=>i.current=e,onThumbPointerUp:()=>l.current=0,onThumbPointerDown:e=>l.current=e};function u(e,t){return function(e,t,n,a="ltr"){const s=Up(n),r=s/2,i=t||r,l=s-i,o=n.scrollbar.paddingStart+i,c=n.scrollbar.size-n.scrollbar.paddingEnd-l,d=n.content-n.viewport,m="ltr"===a?[0,d]:[-1*d,0];return Gp([o,c],m)(e)}(e,l.current,o,t)}return"horizontal"===a?e.jsx(Ap,{...m,ref:n,onThumbPositionChange:()=>{if(r.viewport&&i.current){const e=Hp(r.viewport.scrollLeft,o,r.dir);i.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{r.viewport&&(r.viewport.scrollLeft=e)},onDragScroll:e=>{r.viewport&&(r.viewport.scrollLeft=u(e,r.dir))}}):"vertical"===a?e.jsx(Fp,{...m,ref:n,onThumbPositionChange:()=>{if(r.viewport&&i.current){const e=Hp(r.viewport.scrollTop,o);i.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{r.viewport&&(r.viewport.scrollTop=e)},onDragScroll:e=>{r.viewport&&(r.viewport.scrollTop=u(e))}}):null}),Ap=re.forwardRef((t,n)=>{const{sizes:a,onSizesChange:s,...r}=t,i=wp(Sp,t.__scopeScrollArea),[l,o]=re.useState(),c=re.useRef(null),d=$(n,c,i.onScrollbarXChange);return re.useEffect(()=>{c.current&&o(getComputedStyle(c.current))},[c]),e.jsx(Op,{"data-orientation":"horizontal",...r,ref:d,sizes:a,style:{bottom:0,left:"rtl"===i.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===i.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Up(a)+"px",...t.style},onThumbPointerDown:e=>t.onThumbPointerDown(e.x),onDragScroll:e=>t.onDragScroll(e.x),onWheelScroll:(e,n)=>{if(i.viewport){const a=i.viewport.scrollLeft+e.deltaX;t.onWheelScroll(a),Wp(a,n)&&e.preventDefault()}},onResize:()=>{c.current&&i.viewport&&l&&s({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:Yp(l.paddingLeft),paddingEnd:Yp(l.paddingRight)}})}})}),Fp=re.forwardRef((t,n)=>{const{sizes:a,onSizesChange:s,...r}=t,i=wp(Sp,t.__scopeScrollArea),[l,o]=re.useState(),c=re.useRef(null),d=$(n,c,i.onScrollbarYChange);return re.useEffect(()=>{c.current&&o(getComputedStyle(c.current))},[c]),e.jsx(Op,{"data-orientation":"vertical",...r,ref:d,sizes:a,style:{top:0,right:"ltr"===i.dir?0:void 0,left:"rtl"===i.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Up(a)+"px",...t.style},onThumbPointerDown:e=>t.onThumbPointerDown(e.y),onDragScroll:e=>t.onDragScroll(e.y),onWheelScroll:(e,n)=>{if(i.viewport){const a=i.viewport.scrollTop+e.deltaY;t.onWheelScroll(a),Wp(a,n)&&e.preventDefault()}},onResize:()=>{c.current&&i.viewport&&l&&s({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:Yp(l.paddingTop),paddingEnd:Yp(l.paddingBottom)}})}})}),[Pp,Rp]=yp(Sp),Op=re.forwardRef((t,n)=>{const{__scopeScrollArea:a,sizes:s,hasThumb:r,onThumbChange:i,onThumbPointerUp:l,onThumbPointerDown:o,onThumbPositionChange:d,onDragScroll:m,onWheelScroll:u,onResize:p,...h}=t,x=wp(Sp,a),[g,f]=re.useState(null),v=$(n,e=>f(e)),y=re.useRef(null),b=re.useRef(""),j=x.viewport,w=s.content-s.viewport,N=A(u),_=A(d),k=Zp(p,10);function S(e){if(y.current){const t=e.clientX-y.current.left,n=e.clientY-y.current.top;m({x:t,y:n})}}return re.useEffect(()=>{const e=e=>{const t=e.target,n=g?.contains(t);n&&N(e,w)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[j,g,w,N]),re.useEffect(_,[s,_]),Qp(g,k),Qp(x.content,k),e.jsx(Pp,{scope:a,scrollbar:g,hasThumb:r,onThumbChange:A(i),onThumbPointerUp:A(l),onThumbPositionChange:_,onThumbPointerDown:A(o),children:e.jsx(c.div,{...h,ref:v,style:{position:"absolute",...h.style},onPointerDown:E(t.onPointerDown,e=>{if(0===e.button){e.target.setPointerCapture(e.pointerId),y.current=g.getBoundingClientRect(),b.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),S(e)}}),onPointerMove:E(t.onPointerMove,S),onPointerUp:E(t.onPointerUp,e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=b.current,x.viewport&&(x.viewport.style.scrollBehavior=""),y.current=null})})})}),Mp="ScrollAreaThumb",Lp=re.forwardRef((t,n)=>{const{forceMount:a,...s}=t,r=Rp(Mp,t.__scopeScrollArea);return e.jsx(O,{present:a||r.hasThumb,children:e.jsx(Ip,{ref:n,...s})})}),Ip=re.forwardRef((t,n)=>{const{__scopeScrollArea:a,style:s,...r}=t,i=wp(Mp,a),l=Rp(Mp,a),{onThumbPositionChange:o}=l,d=$(n,e=>l.onThumbChange(e)),m=re.useRef(void 0),u=Zp(()=>{m.current&&(m.current(),m.current=void 0)},100);return re.useEffect(()=>{const e=i.viewport;if(e){const t=()=>{if(u(),!m.current){const t=Kp(e,o);m.current=t,o()}};return o(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}},[i.viewport,u,o]),e.jsx(c.div,{"data-state":l.hasThumb?"visible":"hidden",...r,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:E(t.onPointerDownCapture,e=>{const t=e.target.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top;l.onThumbPointerDown({x:n,y:a})}),onPointerUp:E(t.onPointerUp,l.onThumbPointerUp)})});Lp.displayName=Mp;var zp="ScrollAreaCorner",Bp=re.forwardRef((t,n)=>{const a=wp(zp,t.__scopeScrollArea),s=Boolean(a.scrollbarX&&a.scrollbarY);return"scroll"!==a.type&&s?e.jsx(Vp,{...t,ref:n}):null});Bp.displayName=zp;var Vp=re.forwardRef((t,n)=>{const{__scopeScrollArea:a,...s}=t,r=wp(zp,a),[i,l]=re.useState(0),[o,d]=re.useState(0),m=Boolean(i&&o);return Qp(r.scrollbarX,()=>{const e=r.scrollbarX?.offsetHeight||0;r.onCornerHeightChange(e),d(e)}),Qp(r.scrollbarY,()=>{const e=r.scrollbarY?.offsetWidth||0;r.onCornerWidthChange(e),l(e)}),m?e.jsx(c.div,{...s,ref:n,style:{width:i,height:o,position:"absolute",right:"ltr"===r.dir?0:void 0,left:"rtl"===r.dir?0:void 0,bottom:0,...t.style}}):null});function Yp(e){return e?parseInt(e,10):0}function qp(e,t){const n=e/t;return isNaN(n)?0:n}function Up(e){const t=qp(e.viewport,e.content),n=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=(e.scrollbar.size-n)*t;return Math.max(a,18)}function Hp(e,t,n="ltr"){const a=Up(t),s=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,r=t.scrollbar.size-s,i=t.content-t.viewport,l=r-a,o=I(e,"ltr"===n?[0,i]:[-1*i,0]);return Gp([0,i],[0,l])(o)}function Gp(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const a=(t[1]-t[0])/(e[1]-e[0]);return t[0]+a*(n-e[0])}}function Wp(e,t){return e>0&&e<t}var Kp=(e,t=()=>{})=>{let n={left:e.scrollLeft,top:e.scrollTop},a=0;return function s(){const r={left:e.scrollLeft,top:e.scrollTop},i=n.left!==r.left,l=n.top!==r.top;(i||l)&&t(),n=r,a=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(a)};function Zp(e,t){const n=A(e),a=re.useRef(0);return re.useEffect(()=>()=>window.clearTimeout(a.current),[]),re.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(n,t)},[n,t])}function Qp(e,t){const n=A(t);F(()=>{let t=0;if(e){const a=new ResizeObserver(()=>{cancelAnimationFrame(t),t=window.requestAnimationFrame(n)});return a.observe(e),()=>{window.cancelAnimationFrame(t),a.unobserve(e)}}},[e,n])}var Xp=Np,Jp=kp,eh=Bp;const th=re.forwardRef(({className:t,children:n,...a},s)=>e.jsxs(Xp,{ref:s,className:En("relative overflow-hidden",t),...a,children:[e.jsx(Jp,{className:"h-full w-full rounded-[inherit]",children:n}),e.jsx(nh,{}),e.jsx(eh,{})]}));th.displayName=Xp.displayName;const nh=re.forwardRef(({className:t,orientation:n="vertical",...a},s)=>e.jsx(Cp,{ref:s,orientation:n,className:En("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...a,children:e.jsx(Lp,{className:"relative flex-1 rounded-full bg-border"})}));function ah({isOpen:t,onClose:n,item:a}){const[s,r]=re.useState([]),[i,l]=re.useState(!1),{getUsageHistory:o}=ma();re.useEffect(()=>{a&&t&&c()},[a,t]);const c=async()=>{if(a){l(!0);try{const e=o(a.id);r(e)}catch(e){console.error("Error loading usage history:",e)}finally{l(!1)}}},d=e=>{const t=new Date(e),n=t.getDate(),a=t.getMonth()+1,s=t.getFullYear(),r=t.getHours(),i=t.getMinutes();return`${n.toString().padStart(2,"0")}/${a.toString().padStart(2,"0")}/${s} ${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},m=()=>s.reduce((e,t)=>e+t.quantity_used,0);return a?e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"sm:max-w-[700px] max-h-[80vh]",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"text-xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Va,{className:"h-5 w-5"}),"تاريخ الاستخدام"]}),e.jsxs(Fr,{children:["تاريخ استخدام: ",a.name]})]}),e.jsxs(nc,{children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"text-lg flex items-center gap-2",children:[e.jsx(Bs,{className:"h-4 w-4"}),"معلومات العنصر"]})}),e.jsx(ic,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"الكمية الحالية"}),e.jsxs("p",{className:"font-medium",children:[a.quantity," ",a.unit||"قطعة"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"إجمالي المستخدم"}),e.jsxs("p",{className:"font-medium",children:[m()," ",a.unit||"قطعة"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"عدد مرات الاستخدام"}),e.jsx("p",{className:"font-medium",children:s.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"الفئة"}),e.jsx("p",{className:"font-medium",children:a.category||"غير محدد"})]})]})})]}),e.jsxs(nc,{className:"flex-1",children:[e.jsxs(ac,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(sc,{className:"text-lg flex items-center gap-2",children:[e.jsx(es,{className:"h-4 w-4"}),"سجل الاستخدام"]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:c,disabled:i,children:[e.jsx(Js,{className:"h-4 w-4 mr-2 "+(i?"animate-spin":"")}),"تحديث"]})]}),e.jsxs(rc,{children:[s.length," سجل استخدام"]})]}),e.jsx(ic,{children:e.jsx(th,{className:"h-[300px] w-full",children:i?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"جاري التحميل..."})]}):0===s.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Va,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا يوجد سجل استخدام"}),e.jsx("p",{className:"text-muted-foreground",children:"لم يتم تسجيل أي استخدام لهذا العنصر بعد"})]}):e.jsx("div",{className:"space-y-3",children:s.map((t,n)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-muted/30 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Va,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(oc,{variant:"secondary",className:"text-xs",children:[t.quantity_used," ",a.unit||"قطعة"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:d(t.usage_date)})]})}),t.appointment_id&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mb-1",children:[e.jsx(yr,{className:"h-3 w-3"}),e.jsx("span",{children:"مرتبط بموعد"})]}),t.notes&&e.jsxs("div",{className:"flex items-start gap-1 text-sm",children:[e.jsx(bs,{className:"h-3 w-3 mt-0.5 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:t.notes})]})]})]},t.id||n))})})})]}),s.length>0&&e.jsx(nc,{children:e.jsx(ic,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:m()}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المستخدم"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:s.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"مرات الاستخدام"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:s.length>0?Math.round(m()/s.length*10)/10:0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"متوسط الاستخدام"})]})]})})})]})}):null}function sh({items:t,isLoading:n,onEdit:a,onDelete:s,onViewDetails:r}){Bl();const{formatAmount:i}=oa(),[l,o]=re.useState("name"),[c,d]=re.useState("asc"),[m,u]=re.useState(1),[p,h]=re.useState(10),[x,g]=re.useState(""),[f,v]=re.useState("all"),[y,b]=re.useState("all"),j=re.useMemo(()=>[...new Set(t.map(e=>e.category).filter(Boolean))].sort(),[t]),w=re.useMemo(()=>{const e=new Date;let n=t.map(t=>{const n=(t.quantity||0)*(t.cost_per_unit||0),a=t.quantity<=t.minimum_stock,s=t.expiry_date&&new Date(t.expiry_date)<e,r=t.expiry_date&&!s&&new Date(t.expiry_date)<=new Date(e.getTime()+2592e6);let i="normal";return 0===t.quantity?i="out_of_stock":s?i="expired":r?i="expiring_soon":a&&(i="low_stock"),{...t,total_value:n,status:i,isLowStock:a,isExpired:s,isExpiringSoon:r}});if(x.trim()){const e=x.toLowerCase();n=n.filter(t=>t.name.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)||t.category?.toLowerCase().includes(e)||t.supplier?.toLowerCase().includes(e))}return"all"!==f&&(n=n.filter(e=>e.category===f)),"all"!==y&&(n=n.filter(e=>e.status===y)),n},[t,x,f,y]),N=re.useMemo(()=>[...w].sort((e,t)=>{let n,a;switch(l){case"name":n=e.name.toLowerCase(),a=t.name.toLowerCase();break;case"category":n=e.category?.toLowerCase()||"",a=t.category?.toLowerCase()||"";break;case"quantity":n=e.quantity,a=t.quantity;break;case"cost_per_unit":n=e.cost_per_unit||0,a=t.cost_per_unit||0;break;case"total_value":n=e.total_value,a=t.total_value;break;case"expiry_date":n=e.expiry_date?new Date(e.expiry_date):new Date("9999-12-31"),a=t.expiry_date?new Date(t.expiry_date):new Date("9999-12-31");break;default:return 0}return n<a?"asc"===c?-1:1:n>a?"asc"===c?1:-1:0}),[w,l,c]),_=Math.ceil(N.length/p),k=(m-1)*p,S=N.slice(k,k+p),C=e=>{u(Math.max(1,Math.min(e,_)))};ie.useEffect(()=>{u(1)},[x,f,y]);const $=({field:t,children:n})=>e.jsx(Uc,{className:"cursor-pointer hover:bg-muted/50 select-none text-center",onClick:()=>(e=>{l===e?d("asc"===c?"desc":"asc"):(o(e),d("asc"))})(t),children:e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[n,l===t?"asc"===c?e.jsx(Wa,{className:"w-4 h-4"}):e.jsx(Ua,{className:"w-4 h-4"}):e.jsx(Ga,{className:"w-4 h-4 opacity-50"})]})}),D=t=>{switch(t.status){case"out_of_stock":return e.jsxs(oc,{variant:"destructive",className:"arabic-enhanced",children:[e.jsx(qa,{className:"w-3 h-3 mr-1"}),"نفد المخزون"]});case"expired":return e.jsxs(oc,{variant:"destructive",className:"arabic-enhanced",children:[e.jsx(us,{className:"w-3 h-3 mr-1"}),"منتهي الصلاحية"]});case"expiring_soon":return e.jsxs(oc,{variant:"secondary",className:"arabic-enhanced",children:[e.jsx(us,{className:"w-3 h-3 mr-1"}),"ينتهي قريباً"]});case"low_stock":return e.jsxs(oc,{variant:"outline",className:"arabic-enhanced border-yellow-500 text-yellow-700",children:[e.jsx(qa,{className:"w-3 h-3 mr-1"}),"مخزون منخفض"]});default:return e.jsxs(oc,{variant:"outline",className:"arabic-enhanced border-green-500 text-green-700",children:[e.jsx(ns,{className:"w-3 h-3 mr-1"}),"طبيعي"]})}};return n?e.jsx("div",{className:"border rounded-lg",dir:"rtl",children:e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{className:"bg-muted/50",children:[e.jsx(Uc,{className:"text-center",children:"#"}),e.jsx(Uc,{className:"text-center",children:"اسم العنصر"}),e.jsx(Uc,{className:"text-center",children:"الفئة"}),e.jsx(Uc,{className:"text-center",children:"الكمية"}),e.jsx(Uc,{className:"text-center",children:"سعر الوحدة"}),e.jsx(Uc,{className:"text-center",children:"القيمة الإجمالية"}),e.jsx(Uc,{className:"text-center",children:"الحالة"}),e.jsx(Uc,{className:"text-center",children:"الاجراءات"})]})}),e.jsx(Yc,{children:[...Array(5)].map((t,n)=>e.jsx(qc,{children:[...Array(8)].map((t,n)=>e.jsx(Hc,{children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded"})},n))},n))})]})}):0===t.length?e.jsx("div",{className:"border rounded-lg",dir:"rtl",children:e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{className:"bg-muted/50",children:[e.jsx(Uc,{className:"text-center",children:"#"}),e.jsx(Uc,{className:"text-center",children:"اسم العنصر"}),e.jsx(Uc,{className:"text-center",children:"الفئة"}),e.jsx(Uc,{className:"text-center",children:"الكمية"}),e.jsx(Uc,{className:"text-center",children:"سعر الوحدة"}),e.jsx(Uc,{className:"text-center",children:"القيمة الإجمالية"}),e.jsx(Uc,{className:"text-center",children:"الحالة"}),e.jsx(Uc,{className:"text-center",children:"الاجراءات"})]})}),e.jsx(Yc,{children:e.jsx(qc,{children:e.jsx(Hc,{colSpan:8,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(Bs,{className:"w-12 h-12 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground arabic-enhanced",children:"لا توجد عناصر مخزون"})]})})})})]})}):e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 flex-1 items-start sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm order-1",children:[e.jsx(tr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{placeholder:"البحث في المخزون...",value:x,onChange:e=>g(e.target.value),className:"pl-10 arabic-enhanced text-right border-2 focus:border-primary/50 transition-colors"})]}),e.jsxs(Nl,{value:y,onValueChange:b,children:[e.jsxs(Sl,{className:"w-[200px] order-2 border-2 focus:border-primary/50 transition-colors",children:[e.jsx(js,{className:"w-4 h-4 mr-2 text-orange-500"}),e.jsx(kl,{placeholder:"تصفية حسب الحالة"})]}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الحالات"}),e.jsx(Al,{value:"normal",children:"طبيعي"}),e.jsx(Al,{value:"low_stock",children:"مخزون منخفض"}),e.jsx(Al,{value:"out_of_stock",children:"نفد المخزون"}),e.jsx(Al,{value:"expiring_soon",children:"ينتهي قريباً"}),e.jsx(Al,{value:"expired",children:"منتهي الصلاحية"})]})]}),e.jsxs(Nl,{value:f,onValueChange:v,children:[e.jsxs(Sl,{className:"w-[200px] order-3 border-2 focus:border-primary/50 transition-colors",children:[e.jsx(js,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx(kl,{placeholder:"تصفية حسب الفئة"})]}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الفئات"}),j.map(t=>e.jsx(Al,{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground arabic-enhanced bg-muted/30 px-3 py-2 rounded-lg border",children:["إجمالي العناصر: ",e.jsx("span",{className:"font-semibold text-foreground",children:w.length})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{className:"bg-muted/50",children:[e.jsx(Uc,{className:"text-center",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"#"})}),e.jsx($,{field:"name",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"اسم العنصر"})}),e.jsx($,{field:"category",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الفئة"})}),e.jsx($,{field:"quantity",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الكمية"})}),e.jsx($,{field:"cost_per_unit",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"سعر الوحدة"})}),e.jsx($,{field:"total_value",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"القيمة الإجمالية"})}),e.jsx(Uc,{className:"text-center",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الحالة"})}),e.jsx(Uc,{className:"text-center",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الاجراءات"})})]})}),e.jsx(Yc,{children:S.map((t,n)=>e.jsxs(qc,{className:"hover:bg-muted/50",children:[e.jsx(Hc,{className:"font-medium text-center",children:k+n+1}),e.jsx(Hc,{className:"font-medium text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("span",{className:"arabic-enhanced",children:t.name}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.description})]})]})}),e.jsx(Hc,{className:"text-center",children:t.category?e.jsx(oc,{variant:"outline",className:"arabic-enhanced",children:t.category}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(Hc,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("span",{className:"font-medium",children:t.quantity}),e.jsx("span",{className:"text-muted-foreground text-sm",children:t.unit||"قطعة"})]})}),e.jsx(Hc,{className:"text-center",children:t.cost_per_unit?e.jsx("span",{className:"font-medium",children:i(t.cost_per_unit)}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(Hc,{className:"text-center",children:e.jsx("span",{className:"font-medium",children:i(t.total_value)})}),e.jsx(Hc,{className:"text-center",children:D(t)}),e.jsx(Hc,{className:"min-w-[200px] text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-view",onClick:e=>{e.preventDefault(),e.stopPropagation(),r(t)},children:[e.jsx(ys,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"عرض"})]}),e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:e=>{e.preventDefault(),e.stopPropagation(),a(t)},children:[e.jsx(Us,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:e=>{e.preventDefault(),e.stopPropagation(),s(t.id)},children:[e.jsx(dr,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]})]})})]},t.id))})]})})}),N.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:e.jsxs("p",{className:"text-sm text-muted-foreground arabic-enhanced",children:["عرض ",k+1," إلى ",Math.min(k+p,N.length)," من ",N.length," عنصر"]})}),e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(Nl,{value:`${p}`,onValueChange:e=>h(Number(e)),children:[e.jsx(Sl,{className:"h-8 w-[70px]",children:e.jsx(kl,{placeholder:p})}),e.jsx(Dl,{side:"top",children:[5,10,20,30,50].map(t=>e.jsx(Al,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",m," من ",_]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(1),disabled:1===m,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(cs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(m-1),disabled:1===m,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(is,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(m+1),disabled:m===_,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(rs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(_),disabled:m===_,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(os,{className:"h-4 w-4"})]})]})]})]})]})}function rh({amount:t,currency:n,className:a="",fallbackFormat:s=!0,showSymbolOnly:r=!1,useGlobalCurrency:i=!0}){const{currentCurrency:l,formatAmount:o,formatAmountSymbol:c}=oa(),d=i?n||l:n||"USD";try{const n=r?c(t,d):o(t,d);return e.jsx("span",{className:a,children:n})}catch(m){if(console.warn("Error formatting currency:",m),s){const n=Fn(d);try{const s=new Intl.NumberFormat("en-US",{minimumFractionDigits:r?0:n.decimals,maximumFractionDigits:r?0:n.decimals}).format(t),i="before"===n.position?`${n.symbol}${s}`:`${s} ${n.symbol}`;return e.jsx("span",{className:a,children:i})}catch(u){const n=Fn(d),s=r?Math.round(t).toString():t.toFixed(n.decimals),i="before"===n.position?`${n.symbol}${s}`:`${s} ${n.symbol}`;return e.jsx("span",{className:a,children:i})}}return e.jsxs("span",{className:a,children:[t," ",d]})}}function ih(){ua();const[t,n]=re.useState(!1),[a,s]=re.useState(!1),[r,i]=re.useState(!1),[l,o]=re.useState(!1),[c,d]=re.useState(!1),[m,u]=re.useState(null),[p,h]=re.useState("inventory"),{items:x,filteredItems:g,isLoading:f,error:v,categories:y,suppliers:b,totalValue:j,lowStockCount:w,expiredCount:N,expiringSoonCount:_,loadItems:k,createItem:S,updateItem:C,deleteItem:$,recordUsage:D,clearError:E}=ma(),{appointments:T,loadAppointments:A}=Jn();re.useEffect(()=>{k(),A()},[k,A]);const F=({title:t,value:n,icon:a,color:s="blue",trend:r})=>e.jsx(nc,{className:pc(s),children:e.jsx(ic,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:t}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:n}),r&&e.jsxs("div",{className:"flex items-center mt-1",children:[r>0?e.jsx(ur,{className:"w-4 h-4 text-green-500 mr-1"}):e.jsx(mr,{className:"w-4 h-4 text-red-500 mr-1"}),e.jsxs("span",{className:"text-xs "+(r>0?"text-green-500":"text-red-500"),children:[Math.abs(r),"%"]})]})]}),e.jsx("div",{className:`text-2xl ${hc(s)}`,children:a})]})})});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"إدارة المخزون"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"تتبع المواد والمعدات ومستويات المخزون"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",onClick:async()=>{if(0!==g.length)try{const e=g.filter(e=>{const t=parseFloat(String(e.cost_per_unit||0))||0,n=parseFloat(String(e.unit_price||0))||0;return 0===t&&0===n});await Zc.exportInventoryToExcel(g);let t=`تم تصدير ${g.length} عنصر مخزون بنجاح إلى ملف Excel مع التنسيق الجميل!`;e.length>0&&(t+=` (تنبيه: ${e.length} عنصر لا يحتوي على سعر - يمكنك تعديل العناصر لإضافة الأسعار)`),Kc.exportSuccess(t)}catch(e){console.error("Error exporting inventory:",e),Kc.exportError("فشل في تصدير بيانات المخزون")}else Kc.noDataToExport("لا توجد بيانات مخزون للتصدير")},children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير"]}),e.jsxs(Lr,{onClick:()=>n(!0),className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Zs,{className:"w-4 h-4"}),e.jsx("span",{children:"إضافة عنصر جديد"})]})]})]}),e.jsxs(Ud,{value:p,onValueChange:h,className:"w-full",children:[e.jsxs(Hd,{className:"grid w-full grid-cols-2",children:[e.jsxs(Gd,{value:"inventory",className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4"}),"المخزون"]}),e.jsxs(Gd,{value:"alerts",className:"flex items-center gap-2",children:[e.jsx(Za,{className:"w-4 h-4"}),"التنبيهات",w+N+_>0&&e.jsx(oc,{variant:"destructive",className:"ml-1 text-xs",children:w+N+_})]})]}),e.jsxs(Wd,{value:"inventory",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(F,{title:"إجمالي العناصر",value:x.length,icon:e.jsx(Bs,{}),color:"blue"}),e.jsx(F,{title:"قيمة المخزون",value:e.jsx(rh,{amount:j}),icon:e.jsx(gs,{}),color:"green"}),e.jsx(F,{title:"مخزون منخفض",value:w,icon:e.jsx(qa,{}),color:"yellow"}),e.jsx(F,{title:"منتهي الصلاحية",value:N+_,icon:e.jsx(es,{}),color:"red"})]}),v&&e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:[e.jsxs("p",{className:"text-destructive",children:["خطأ: ",v]}),e.jsx(Lr,{variant:"outline",size:"sm",onClick:E,className:"mt-2",children:"إغلاق"})]}),e.jsx(sh,{items:g,isLoading:f,onEdit:e=>{u(e),s(!0)},onDelete:e=>{const t=x.find(t=>t.id===e);t&&(u(t),i(!0))},onViewDetails:e=>{u(e),d(!0)}})]}),e.jsx(Wd,{value:"alerts",className:"space-y-6",children:e.jsx(fp,{items:x,onRefresh:k,onItemClick:e=>{u(e),s(!0)}})})]}),e.jsx(cp,{isOpen:t,onClose:()=>n(!1),onSave:async e=>{await S(e)},categories:y,suppliers:b}),e.jsx(pp,{isOpen:a,onClose:()=>s(!1),onSave:async(e,t)=>{await C(e,t)},item:m,categories:y,suppliers:b}),e.jsx(hp,{isOpen:r,onClose:()=>i(!1),onConfirm:async e=>{await $(e)},item:m,isLoading:f}),e.jsx(gp,{isOpen:l,onClose:()=>o(!1),onSave:async e=>{await D(e)},item:m,appointments:T}),e.jsx(ah,{isOpen:c,onClose:()=>d(!1),item:m})]})}nh.displayName=Cp.displayName;const lh=()=>{const e=new Date;return{dateRange:{start:new Date(e.getFullYear(),e.getMonth(),1).toISOString().split("T")[0],end:e.toISOString().split("T")[0],preset:"month"}}},oh=de()(xt((e,t)=>("undefined"!=typeof window&&(window.addEventListener("patient-deleted",async e=>{const{clearCache:n,generateReport:a}=t();n();try{await a("patients")}catch(s){console.error("Error refreshing reports after patient deletion:",s)}}),window.addEventListener("patient-added",async e=>{const{clearCache:n,generateReport:a}=t();n();try{await a("patients")}catch(s){console.error("Error refreshing reports after patient addition:",s)}}),window.addEventListener("patient-updated",async e=>{const{clearCache:n,generateReport:a}=t();n();try{await a("patients")}catch(s){console.error("Error refreshing reports after patient update:",s)}}),window.addEventListener("appointment-changed",async e=>{const{clearCache:n,generateReport:a}=t();n();try{await a("appointments")}catch(s){console.error("Error refreshing appointment reports:",s)}}),window.addEventListener("payment-changed",async e=>{const{clearCache:n,generateReport:a}=t();n();try{await a("financial")}catch(s){console.error("Error refreshing financial reports:",s)}}),window.addEventListener("inventory-changed",async e=>{const{clearCache:n,generateReport:a}=t();n();try{await a("inventory")}catch(s){console.error("Error refreshing inventory reports:",s)}}),window.addEventListener("clinic-needs-changed",async e=>{const{clearCache:n,generateReport:a}=t();n();try{await a("clinicNeeds")}catch(s){console.error("Error refreshing clinic needs reports:",s)}})),{reportData:null,patientReports:null,appointmentReports:null,financialReports:null,inventoryReports:null,analyticsReports:null,treatmentReports:null,clinicNeedsReports:null,isLoading:!1,isExporting:!1,error:null,activeReportType:"overview",currentFilter:lh(),savedFilters:[],cachedReports:new Map,cacheExpiry:3e5,autoRefreshInterval:null,generateReport:async(n,a)=>{const{currentFilter:s,getCachedReport:r,setCachedReport:i,cacheExpiry:l}=t(),o={...s,...a},c=((e,t)=>`${e}_${JSON.stringify(t)}`)(n,o),d=r(c);if(d)e({[`${n}Reports`]:d,isLoading:!1});else{e({isLoading:!0,error:null});try{let a=null;switch(n){case"patients":a=await(window.electronAPI?.reports?.generatePatientReport(o)),e({patientReports:a});break;case"appointments":a=await(window.electronAPI?.reports?.generateAppointmentReport(o)),console.log("✅ Appointment report generated:",a),e({appointmentReports:a});break;case"financial":a=await(window.electronAPI?.reports?.generateFinancialReport(o)),console.log("✅ Financial report generated:",a),e({financialReports:a});break;case"inventory":a=await(window.electronAPI?.reports?.generateInventoryReport(o)),console.log("✅ Inventory report generated:",a),e({inventoryReports:a});break;case"analytics":a=await(window.electronAPI?.reports?.generateAnalyticsReport(o)),console.log("✅ Analytics report generated:",a),e({analyticsReports:a});break;case"treatments":a=await(window.electronAPI?.reports?.generateTreatmentReport(o)),console.log("✅ Treatment report generated:",a),e({treatmentReports:a});break;case"clinicNeeds":a=await t().generateClinicNeedsReport(o),console.log("✅ Clinic needs report generated:",a),e({clinicNeedsReports:a});break;case"overview":a=await(window.electronAPI?.reports?.generateOverviewReport(o)),console.log("✅ Overview report generated:",a),e({reportData:a})}a&&(i(c,a),console.log(`💾 Report cached with key: ${c}`)),e({isLoading:!1})}catch(m){console.error(`❌ Error generating ${n} report:`,m),e({error:m instanceof Error?m.message:`Failed to generate ${n} report`,isLoading:!1})}}},generateAllReports:async n=>{const{generateReport:a}=t(),s=["patients","appointments","financial","inventory","analytics","treatments","clinicNeeds"];e({isLoading:!0,error:null});try{for(const e of s)await a(e,n);console.log("✅ All reports generated successfully"),e({isLoading:!1})}catch(r){console.error("❌ Error generating all reports:",r),e({error:r instanceof Error?r.message:"Failed to generate reports",isLoading:!1})}},refreshReports:async()=>{const{activeReportType:e,currentFilter:n,clearCache:a}=t();a(),await t().generateReport(e,n)},setFilter:n=>{e({currentFilter:{...t().currentFilter,...n}})},resetFilter:()=>{e({currentFilter:lh()})},saveFilter:n=>{const{currentFilter:a,savedFilters:s}=t(),r={name:n,filter:a},i=s.findIndex(e=>e.name===n);if(i>=0){const t=[...s];t[i]=r,e({savedFilters:t})}else e({savedFilters:[...s,r]})},loadFilter:n=>{const{savedFilters:a}=t(),s=a.find(e=>e.name===n);s&&e({currentFilter:s.filter})},deleteFilter:n=>{const{savedFilters:a}=t();e({savedFilters:a.filter(e=>e.name!==n)})},setActiveReportType:t=>{e({activeReportType:t})},clearError:()=>{e({error:null})},exportReport:async(n,a)=>{e({isExporting:!0,error:null});try{const{currentFilter:s}=t(),r=await(window.electronAPI?.reports?.exportReport(n,s,a));if(e({isExporting:!1}),!r?.success)throw new Error(r?.message||"فشل في تصدير التقرير");{const e=new CustomEvent("showToast",{detail:{title:"تم التصدير بنجاح",description:`تم حفظ التقرير في: ${r.filePath}`,type:"success"}});window.dispatchEvent(e)}return r}catch(s){console.error("Error exporting report:",s);const t=s instanceof Error?s.message:"Failed to export report";e({error:t,isExporting:!1});const n=new CustomEvent("showToast",{detail:{title:"خطأ في التصدير",description:t,type:"error"}});throw window.dispatchEvent(n),s}},clearCache:()=>{e({cachedReports:new Map})},startAutoRefresh:(n=5)=>{const{stopAutoRefresh:a}=t();a();const s=setInterval(async()=>{const{activeReportType:e,generateReport:n,generateAllReports:a}=t();try{"overview"===e?await a():await n(e),console.log("Auto-refresh completed successfully")}catch(s){console.error("Auto-refresh failed:",s)}},60*n*1e3);e({autoRefreshInterval:s})},stopAutoRefresh:()=>{const{autoRefreshInterval:n}=t();n&&(clearInterval(n),e({autoRefreshInterval:null}))},syncReportsData:async()=>{const{generateAllReports:e}=t();try{await e();const t=new CustomEvent("showToast",{detail:{title:"تم تحديث البيانات",description:"تم مزامنة جميع التقارير بنجاح",type:"success"}});window.dispatchEvent(t)}catch(n){console.error("Data sync failed:",n);const e=new CustomEvent("showToast",{detail:{title:"خطأ في المزامنة",description:"فشل في تحديث البيانات",type:"error"}});window.dispatchEvent(e)}},getCachedReport:e=>{const{cachedReports:n,cacheExpiry:a}=t(),s=n.get(e);return s&&Date.now()-s.timestamp<a?s.data:null},setCachedReport:(n,a)=>{const{cachedReports:s}=t(),r=new Map(s);r.set(n,{data:a,timestamp:Date.now()}),e({cachedReports:r})},generateClinicNeedsReport:async e=>{try{const t=await(window.electronAPI?.clinicNeeds?.getAll())||[];let n=t;if(e?.startDate&&e?.endDate){const a=new Date(e.startDate),s=new Date(e.endDate);n=t.filter(e=>{const t=new Date(e.created_at);return t>=a&&t<=s})}const a=n.length,s=n.reduce((e,t)=>e+t.price*t.quantity,0),r=a>0?s/a:0,i=n.filter(e=>"pending"===e.status).length,l=n.filter(e=>"ordered"===e.status).length,o=n.filter(e=>"received"===e.status).length,c=n.filter(e=>"cancelled"===e.status).length,d=n.filter(e=>"urgent"===e.priority).length,m=n.filter(e=>"high"===e.priority).length,u=n.filter(e=>"medium"===e.priority).length,p=n.filter(e=>"low"===e.priority).length,h=a>0?o/a*100:0,x=a>0?d/a*100:0,g=[{status:"pending",count:i,percentage:a>0?i/a*100:0,value:n.filter(e=>"pending"===e.status).reduce((e,t)=>e+t.price*t.quantity,0)},{status:"ordered",count:l,percentage:a>0?l/a*100:0,value:n.filter(e=>"ordered"===e.status).reduce((e,t)=>e+t.price*t.quantity,0)},{status:"received",count:o,percentage:a>0?o/a*100:0,value:n.filter(e=>"received"===e.status).reduce((e,t)=>e+t.price*t.quantity,0)},{status:"cancelled",count:c,percentage:a>0?c/a*100:0,value:n.filter(e=>"cancelled"===e.status).reduce((e,t)=>e+t.price*t.quantity,0)}],f=[{priority:"urgent",count:d,percentage:a>0?d/a*100:0,value:n.filter(e=>"urgent"===e.priority).reduce((e,t)=>e+t.price*t.quantity,0)},{priority:"high",count:m,percentage:a>0?m/a*100:0,value:n.filter(e=>"high"===e.priority).reduce((e,t)=>e+t.price*t.quantity,0)},{priority:"medium",count:u,percentage:a>0?u/a*100:0,value:n.filter(e=>"medium"===e.priority).reduce((e,t)=>e+t.price*t.quantity,0)},{priority:"low",count:p,percentage:a>0?p/a*100:0,value:n.filter(e=>"low"===e.priority).reduce((e,t)=>e+t.price*t.quantity,0)}],v=new Map;n.forEach(e=>{const t=e.category||"غير محدد",n=v.get(t)||{count:0,value:0};v.set(t,{count:n.count+1,value:n.value+e.price*e.quantity})});const y=Array.from(v.entries()).map(([e,t])=>({category:e,count:t.count,value:t.value})),b=new Map;n.forEach(e=>{const t=e.supplier||"غير محدد",n=b.get(t)||{count:0,value:0};b.set(t,{count:n.count+1,value:n.value+e.price*e.quantity})});const j=Array.from(b.entries()).map(([e,t])=>({supplier:e,count:t.count,value:t.value})),w=[];for(let e=5;e>=0;e--){const n=new Date;n.setMonth(n.getMonth()-e);const a=new Date(n.getFullYear(),n.getMonth(),1),s=new Date(n.getFullYear(),n.getMonth()+1,0),r=t.filter(e=>{const t=new Date(e.created_at);return t>=a&&t<=s});w.push({period:`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`,count:r.length,value:r.reduce((e,t)=>e+t.price*t.quantity,0)})}const N=n.map(e=>({need_name:e.need_name,value:e.price*e.quantity,quantity:e.quantity})).sort((e,t)=>t.value-e.value).slice(0,10),_=n.filter(e=>"pending"===e.status).slice(0,10),k=n.filter(e=>"urgent"===e.priority).slice(0,10),S=n.filter(e=>{const t=new Date(e.created_at),n=(Date.now()-t.getTime())/864e5;return"pending"===e.status&&n>30}).slice(0,10),C=n.filter(e=>"received"===e.status).sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime()).slice(0,10);return{totalNeeds:a,totalValue:s,pendingCount:i,orderedCount:l,receivedCount:o,cancelledCount:c,urgentCount:d,highPriorityCount:m,mediumPriorityCount:u,lowPriorityCount:p,averageNeedValue:r,completionRate:h,urgencyRate:x,needsByStatus:g,needsByPriority:f,needsByCategory:y,needsBySupplier:j,needsTrend:w,topExpensiveNeeds:N,pendingNeeds:_,urgentNeeds:k,overdueNeeds:S,recentlyReceived:C,needsList:n,filterInfo:e?`${e.startDate} - ${e.endDate}`:"جميع البيانات",dataCount:n.length}}catch(t){throw console.error("Error generating clinic needs report:",t),t}}})),{name:"reports-store"}),ch={status:"",expenseType:"",category:"",vendor:"",isRecurring:null,dateRange:{start:"",end:""}},dh={totalExpenses:0,totalAmount:0,paidAmount:0,pendingAmount:0,overdueAmount:0,recurringExpenses:0,expensesByType:{},expensesByStatus:{},monthlyExpenses:{}},mh=de((e,t)=>({expenses:[],filteredExpenses:[],selectedExpense:null,isLoading:!1,error:null,searchQuery:"",filters:ch,analytics:dh,categories:[],vendors:[],expenseTypes:["salary","utilities","rent","maintenance","supplies","insurance","other"],loadExpenses:async()=>{e({isLoading:!0,error:null});try{const n=await(window.electronAPI?.clinicExpenses?.getAll())||[];e({expenses:n,filteredExpenses:n,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateVendors(),t().filterExpenses()}catch(n){console.error("Error loading clinic expenses:",n),e({error:n instanceof Error?n.message:"Failed to load clinic expenses",isLoading:!1})}},createExpense:async n=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.clinicExpenses.create(n),{expenses:s}=t(),r=[...s,a];e({expenses:r,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateVendors(),t().filterExpenses(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-expenses-changed",{detail:{type:"created",expenseId:a.id,expense:a}}))}catch(a){throw console.error("Error creating clinic expense:",a),e({error:a instanceof Error?a.message:"Failed to create clinic expense",isLoading:!1}),a}},updateExpense:async(n,a)=>{e({isLoading:!0,error:null});try{const s=await window.electronAPI.clinicExpenses.update(n,a),{expenses:r}=t(),i=r.map(e=>e.id===n?s:e);e({expenses:i,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateVendors(),t().filterExpenses(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-expenses-changed",{detail:{type:"updated",expenseId:n,expense:s}}))}catch(s){throw console.error("Error updating clinic expense:",s),e({error:s instanceof Error?s.message:"Failed to update clinic expense",isLoading:!1}),s}},deleteExpense:async n=>{e({isLoading:!0,error:null});try{if(await window.electronAPI.clinicExpenses.delete(n)){const{expenses:a}=t(),s=a.filter(e=>e.id!==n);e({expenses:s,selectedExpense:null,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateVendors(),t().filterExpenses(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-expenses-changed",{detail:{type:"deleted",expenseId:n}}))}}catch(a){throw console.error("Error deleting clinic expense:",a),e({error:a instanceof Error?a.message:"Failed to delete clinic expense",isLoading:!1}),a}},setSelectedExpense:t=>e({selectedExpense:t}),setSearchQuery:n=>{e({searchQuery:n}),t().filterExpenses()},setFilters:n=>{e({filters:n}),t().filterExpenses()},clearError:()=>e({error:null}),filterExpenses:()=>{const{expenses:n,searchQuery:a,filters:s}=t();let r=[...n];if(a.trim()){const e=a.toLowerCase();r=r.filter(t=>t.expense_name.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)||t.vendor?.toLowerCase().includes(e)||t.notes?.toLowerCase().includes(e))}if(s.status&&(r=r.filter(e=>e.status===s.status)),s.expenseType&&(r=r.filter(e=>e.expense_type===s.expenseType)),s.category&&(r=r.filter(e=>e.category===s.category)),s.vendor&&(r=r.filter(e=>e.vendor===s.vendor)),null!==s.isRecurring&&(r=r.filter(e=>e.is_recurring===s.isRecurring)),s.dateRange.start&&s.dateRange.end){const e=new Date(s.dateRange.start),t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0),n=new Date(s.dateRange.end),a=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999);r=r.filter(e=>{const n=e.payment_date;if(!n)return!1;const s=new Date(n);let r;return r=n.includes("T")||n.includes(" ")?s:new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0),r>=t&&r<=a})}e({filteredExpenses:r})},calculateAnalytics:()=>{const{expenses:n}=t(),a=n.length,s=n.reduce((e,t)=>e+t.amount,0),r=n.filter(e=>"paid"===e.status).reduce((e,t)=>e+t.amount,0),i=n.filter(e=>"pending"===e.status).reduce((e,t)=>e+t.amount,0),l=n.filter(e=>"overdue"===e.status).reduce((e,t)=>e+t.amount,0),o=n.filter(e=>e.is_recurring).length,c=n.reduce((e,t)=>(e[t.expense_type]=(e[t.expense_type]||0)+t.amount,e),{}),d=n.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+t.amount,e),{}),m=n.reduce((e,t)=>{const n=new Date(t.payment_date).toISOString().slice(0,7);return e[n]=(e[n]||0)+t.amount,e},{});e({analytics:{totalExpenses:a,totalAmount:s,paidAmount:r,pendingAmount:i,overdueAmount:l,recurringExpenses:o,expensesByType:c,expensesByStatus:d,monthlyExpenses:m}})},getExpensesByType:e=>{const{expenses:n}=t();return n.filter(t=>t.expense_type===e)},getExpensesByStatus:e=>{const{expenses:n}=t();return n.filter(t=>t.status===e)},getRecurringExpenses:()=>{const{expenses:e}=t();return e.filter(e=>e.is_recurring)},updateCategories:()=>{const{expenses:n}=t(),a=[...new Set(n.map(e=>e.category).filter(Boolean))];e({categories:a})},updateVendors:()=>{const{expenses:n}=t(),a=[...new Set(n.map(e=>e.vendor).filter(Boolean))];e({vendors:a})},updateExpenseTypes:()=>{e({expenseTypes:["salary","utilities","rent","maintenance","supplies","insurance","other"]})}})),uh=de()(xt((e,t)=>({needs:[],filteredNeeds:[],selectedNeed:null,isLoading:!1,error:null,searchQuery:"",filters:{},categories:[],suppliers:[],totalNeeds:0,totalValue:0,pendingCount:0,orderedCount:0,receivedCount:0,urgentCount:0,loadNeeds:async()=>{e({isLoading:!0,error:null});try{const n=await(window.electronAPI?.clinicNeeds?.getAll())||[];e({needs:n,filteredNeeds:n,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterNeeds()}catch(n){console.error("Error loading clinic needs:",n),e({error:n instanceof Error?n.message:"Failed to load clinic needs",isLoading:!1})}},createNeed:async n=>{e({isLoading:!0,error:null});try{const a=await window.electronAPI.clinicNeeds.create(n),{needs:s}=t(),r=[...s,a];e({needs:r,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterNeeds(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-needs-changed",{detail:{type:"created",needId:a.id,need:a}}))}catch(a){console.error("Error creating clinic need:",a),e({error:a instanceof Error?a.message:"Failed to create clinic need",isLoading:!1})}},updateNeed:async(n,a)=>{e({isLoading:!0,error:null});try{const s=await window.electronAPI.clinicNeeds.update(n,a),{needs:r}=t(),i=r.map(e=>e.id===n?s:e);e({needs:i,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterNeeds(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-needs-changed",{detail:{type:"updated",needId:n,need:s}}))}catch(s){console.error("Error updating clinic need:",s),e({error:s instanceof Error?s.message:"Failed to update clinic need",isLoading:!1})}},deleteNeed:async n=>{e({isLoading:!0,error:null});try{await window.electronAPI.clinicNeeds.delete(n);const{needs:a}=t(),s=a.filter(e=>e.id!==n);e({needs:s,selectedNeed:null,isLoading:!1}),t().calculateAnalytics(),t().updateCategories(),t().updateSuppliers(),t().filterNeeds(),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("clinic-needs-changed",{detail:{type:"deleted",needId:n}}))}catch(a){console.error("Error deleting clinic need:",a),e({error:a instanceof Error?a.message:"Failed to delete clinic need",isLoading:!1})}},setSelectedNeed:t=>e({selectedNeed:t}),setSearchQuery:n=>{e({searchQuery:n}),t().filterNeeds()},setFilters:n=>{e({filters:n}),t().filterNeeds()},clearError:()=>e({error:null}),filterNeeds:()=>{const{needs:n,searchQuery:a,filters:s}=t();let r=n;if(a.trim()){const e=a.toLowerCase().trim();r=r.filter(t=>t.need_name.toLowerCase().includes(e)||t.serial_number.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)||t.category?.toLowerCase().includes(e)||t.supplier?.toLowerCase().includes(e))}s.category&&(r=r.filter(e=>e.category===s.category)),s.priority&&(r=r.filter(e=>e.priority===s.priority)),s.status&&(r=r.filter(e=>e.status===s.status)),e({filteredNeeds:r})},calculateAnalytics:()=>{const{needs:n}=t(),a=n.length,s=n.reduce((e,t)=>e+t.price*t.quantity,0),r=n.filter(e=>"pending"===e.status).length,i=n.filter(e=>"ordered"===e.status).length,l=n.filter(e=>"received"===e.status).length,o=n.filter(e=>"urgent"===e.priority).length;e({totalNeeds:a,totalValue:s,pendingCount:r,orderedCount:i,receivedCount:l,urgentCount:o})},getNeedsByStatus:e=>t().needs.filter(t=>t.status===e),getNeedsByPriority:e=>t().needs.filter(t=>t.priority===e),updateCategories:()=>{const{needs:n}=t(),a=[...new Set(n.map(e=>e.category).filter(Boolean))];e({categories:a})},updateSuppliers:()=>{const{needs:n}=t(),a=[...new Set(n.map(e=>e.supplier).filter(Boolean))];e({suppliers:a})},getNextSerialNumber:()=>{const{needs:e}=t();let n=0;return e.forEach(e=>{const t=e.serial_number;if(t.match(/^\d+$/)){const e=parseInt(t,10);e>n&&(n=e)}}),(n+1).toString()}}),{name:"clinic-needs-store"})),ph=de()(xt((e,t)=>({labOrders:[],filteredLabOrders:[],selectedLabOrder:null,isLoading:!1,error:null,searchQuery:"",statusFilter:"all",labFilter:"all",dateRangeFilter:{start:"",end:""},totalOrders:0,totalCost:0,totalPaid:0,totalRemaining:0,pendingOrders:0,completedOrders:0,cancelledOrders:0,loadLabOrders:async()=>{e({isLoading:!0,error:null});try{const n=await(window.electronAPI?.labOrders?.getAll())||[];e({labOrders:n,filteredLabOrders:n,isLoading:!1}),t().calculateStatistics(),t().filterLabOrders()}catch(n){console.error("❌ [DEBUG] Error loading lab orders:",n),e({error:n instanceof Error?n.message:"Failed to load lab orders",isLoading:!1})}},createLabOrder:async n=>{e({isLoading:!0,error:null});try{console.log("➕ [DEBUG] Creating lab order:",n);const a=n.cost-(n.paid_amount||0),s={...n,remaining_balance:a},r=await(window.electronAPI?.labOrders?.create(s));if(r){console.log("✅ [DEBUG] Lab order created successfully:",r);const{labOrders:n}=t(),a=[...n,r];e({labOrders:a,isLoading:!1}),t().calculateStatistics(),t().filterLabOrders()}}catch(a){throw console.error("❌ [DEBUG] Error creating lab order:",a),e({error:a instanceof Error?a.message:"Failed to create lab order",isLoading:!1}),a}},updateLabOrder:async(n,a)=>{e({isLoading:!0,error:null});try{console.log("🔄 [DEBUG] Updating lab order:",n,a);const e=t().labOrders.find(e=>e.id===n);if(e&&(void 0!==a.cost||void 0!==a.paid_amount)){const t=a.cost??e.cost,n=a.paid_amount??(e.paid_amount||0);a.remaining_balance=t-n}const s=await(window.electronAPI?.labOrders?.update(n,a));if(s){console.log("✅ [DEBUG] Lab order updated successfully:",s),console.log("🔄 [DEBUG] Force reloading lab orders after update..."),await t().loadLabOrders();const e=t().labOrders.find(e=>e.id===n);console.log("🔍 [DEBUG] Verification after update:",{orderId:n,found:!!e,tooth_treatment_id:e?.tooth_treatment_id,updatedData:a})}}catch(s){throw console.error("❌ [DEBUG] Error updating lab order:",s),e({error:s instanceof Error?s.message:"Failed to update lab order",isLoading:!1}),s}},deleteLabOrder:async n=>{e({isLoading:!0,error:null});try{if(await(window.electronAPI?.labOrders?.delete(n))){const{labOrders:a}=t(),s=a.filter(e=>e.id!==n);e({labOrders:s,selectedLabOrder:t().selectedLabOrder?.id===n?null:t().selectedLabOrder,isLoading:!1}),t().calculateStatistics(),t().filterLabOrders()}}catch(a){throw console.error("Error deleting lab order:",a),e({error:a instanceof Error?a.message:"Failed to delete lab order",isLoading:!1}),a}},setSelectedLabOrder:t=>e({selectedLabOrder:t}),setSearchQuery:n=>{e({searchQuery:n}),t().filterLabOrders()},setStatusFilter:n=>{e({statusFilter:n}),t().filterLabOrders()},setLabFilter:n=>{e({labFilter:n}),t().filterLabOrders()},setDateRangeFilter:n=>{e({dateRangeFilter:n}),t().filterLabOrders()},filterLabOrders:()=>{const{labOrders:n,searchQuery:a,statusFilter:s,labFilter:r,dateRangeFilter:i}=t();let l=[...n];if(a.trim()&&(l=l.filter(e=>e.service_name.toLowerCase().includes(a.toLowerCase())||e.lab?.name&&e.lab.name.toLowerCase().includes(a.toLowerCase())||e.patient?.full_name&&e.patient.full_name.toLowerCase().includes(a.toLowerCase())||e.notes&&e.notes.toLowerCase().includes(a.toLowerCase()))),s&&"all"!==s&&(l=l.filter(e=>e.status===s)),r&&"all"!==r&&(l=l.filter(e=>e.lab_id===r)),i.start&&i.end){const e=new Date(i.start),t=new Date(i.end);l=l.filter(n=>{const a=new Date(n.order_date);return a>=e&&a<=t})}e({filteredLabOrders:l})},clearFilters:()=>{e({searchQuery:"",statusFilter:"all",labFilter:"all",dateRangeFilter:{start:"",end:""}}),t().filterLabOrders()},clearError:()=>e({error:null}),calculateStatistics:()=>{const{labOrders:n}=t(),a=n.length,s=n.reduce((e,t)=>e+t.cost,0),r=n.reduce((e,t)=>e+(t.paid_amount||0),0),i=n.reduce((e,t)=>e+(t.remaining_balance||0),0),l=n.filter(e=>"معلق"===e.status).length,o=n.filter(e=>"مكتمل"===e.status).length,c=n.filter(e=>"ملغي"===e.status).length;e({totalOrders:a,totalCost:s,totalPaid:r,totalRemaining:i,pendingOrders:l,completedOrders:o,cancelledOrders:c})},getOrdersByLab:e=>t().labOrders.filter(t=>t.lab_id===e),getOrdersByPatient:e=>t().labOrders.filter(t=>t.patient_id===e),getOrdersByStatus:e=>t().labOrders.filter(t=>t.status===e),getOrdersByDateRange:(e,n)=>t().labOrders.filter(t=>{const a=new Date(t.order_date);return a>=e&&a<=n}),getLabOrdersByTreatment:e=>t().labOrders.filter(t=>t.tooth_treatment_id===e)}),{name:"lab-order-store"})),hh=(e=["overview"])=>{const{generateReport:t,generateAllReports:n,clearCache:a}=oh();return re.useEffect(()=>{const s=["patient-added","patient-updated","patient-deleted","patient-changed","appointment-added","appointment-updated","appointment-deleted","appointment-changed","payment-added","payment-updated","payment-deleted","payment-changed","inventory-added","inventory-updated","inventory-deleted","inventory-changed","clinic-needs-added","clinic-needs-updated","clinic-needs-deleted","clinic-needs-changed"].map(s=>({eventType:s,handler:()=>(async s=>{console.log(`🔄 Real-time Reports: ${s} detected, refreshing reports...`),a();try{e.includes("overview")||0===e.length?await n():await Promise.all(e.map(e=>t(e))),console.log("✅ Real-time Reports: Refresh completed successfully")}catch(r){console.error("❌ Real-time Reports: Refresh failed:",r)}})(s)}));return s.forEach(({eventType:e,handler:t})=>{window.addEventListener(e,t)}),()=>{s.forEach(({eventType:e,handler:t})=>{window.removeEventListener(e,t)})}},[t,n,a,e]),{refreshReports:async()=>{a(),e.includes("overview")||0===e.length?await n():await Promise.all(e.map(e=>t(e)))},refreshSpecificReport:async e=>{a(),await t(e)}}},xh=e=>{const{generateReport:t,clearCache:n}=oh();return re.useEffect(()=>{const a=async()=>{console.log(`🔄 Real-time ${e} Reports: Data changed, refreshing...`),n();try{await t(e),console.log(`✅ Real-time ${e} Reports: Refresh completed`)}catch(a){console.error(`❌ Real-time ${e} Reports: Refresh failed:`,a)}},s={patients:["patient-added","patient-updated","patient-deleted","patient-changed"],appointments:["appointment-added","appointment-updated","appointment-deleted","appointment-changed"],financial:["payment-added","payment-updated","payment-deleted","payment-changed"],inventory:["inventory-added","inventory-updated","inventory-deleted","inventory-changed"],clinicNeeds:["clinic-needs-added","clinic-needs-updated","clinic-needs-deleted","clinic-needs-changed"]}[e]||[];return s.forEach(e=>{window.addEventListener(e,a)}),()=>{s.forEach(e=>{window.removeEventListener(e,a)})}},[e,t,n]),{refreshReport:async()=>{n(),await t(e)}}};function gh(e){return e.filter(e=>e.count>0).map(e=>({...e,gender:e.gender||"غير محدد"}))}function fh(e){return e.filter(e=>e.count>0).map(e=>({...e,ageGroup:e.ageGroup||"غير محدد"}))}class vh{static createEnhancedAppointmentReportHTML(e,t){const n=yh.getEnhancedHeader("تقرير المواعيد",t,"تقرير شامل عن إحصائيات المواعيد والحضور"),a=yh.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المواعيد - ${t?.clinic_name||"عيادة الأسنان"}</title>\n        ${a}\n      </head>\n      <body>\n        ${n}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">📅</div>\n            <div class="card-content">\n              <h3>إجمالي المواعيد</h3>\n              <div class="number">${e.totalAppointments.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">✅</div>\n            <div class="card-content">\n              <h3>المواعيد المكتملة</h3>\n              <div class="number">${e.completedAppointments.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">❌</div>\n            <div class="card-content">\n              <h3>المواعيد الملغية</h3>\n              <div class="number warning">${e.cancelledAppointments.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card danger">\n            <div class="card-icon">⚠️</div>\n            <div class="card-content">\n              <h3>عدم الحضور</h3>\n              <div class="number danger">${e.noShowAppointments?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">📊</div>\n            <div class="card-content">\n              <h3>معدل الحضور</h3>\n              <div class="number">${e.attendanceRate?.toFixed(1)||"0"}%</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">📉</div>\n            <div class="card-content">\n              <h3>معدل الإلغاء</h3>\n              <div class="number warning">${e.cancellationRate?.toFixed(1)||"0"}%</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Appointments List Section --\x3e\n        ${e.appointmentsList&&e.appointmentsList.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📋</span>\n            قائمة المواعيد\n          </div>\n          <div class="section-content">\n            <div class="appointments-grid">\n              ${e.appointmentsList.slice(0,50).map((e,t)=>{const n=e.start_time?(()=>{try{const t=new Date(e.start_time);if(isNaN(t.getTime()))return"غير محدد";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear();return`${n}/${a}/${s} - ${t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})}`}catch(t){return"غير محدد"}})():"غير محدد",a=(e=>{switch(e){case"completed":return{text:"مكتمل",class:"status-completed"};case"cancelled":return{text:"ملغي",class:"status-cancelled"};case"no_show":return{text:"لم يحضر",class:"status-no-show"};case"scheduled":return{text:"مجدول",class:"status-scheduled"};default:return{text:"غير محدد",class:"status-unknown"}}})(e.status);return`\n                  <div class="appointment-card">\n                    <div class="appointment-header">\n                      <div class="appointment-avatar">\n                        ${(e.patient_name||"م").charAt(0)}\n                      </div>\n                      <div class="appointment-info">\n                        <h4 class="appointment-patient">${e.patient_name||"غير محدد"}</h4>\n                        <span class="appointment-serial">#${e.id||(t+1).toString().padStart(3,"0")}</span>\n                      </div>\n                    </div>\n                    <div class="appointment-details">\n                      <div class="detail-item">\n                        <span class="detail-label">التاريخ والوقت:</span>\n                        <span class="detail-value">${n}</span>\n                      </div>\n                      <div class="detail-item">\n                        <span class="detail-label">نوع العلاج:</span>\n                        <span class="detail-value">${e.treatment_name?ka(e.treatment_name):"غير محدد"}</span>\n                      </div>\n                      <div class="detail-item">\n                        <span class="detail-label">المدة:</span>\n                        <span class="detail-value">${e.duration||30} دقيقة</span>\n                      </div>\n                      <div class="detail-item">\n                        <span class="detail-label">الحالة:</span>\n                        <span class="detail-value ${a.class}">${a.text}</span>\n                      </div>\n                      ${e.notes?`\n                      <div class="detail-item">\n                        <span class="detail-label">ملاحظات:</span>\n                        <span class="detail-value">${e.notes}</span>\n                      </div>\n                      `:""}\n                    </div>\n                  </div>\n                `}).join("")}\n            </div>\n            ${e.appointmentsList.length>50?`\n            <div class="pagination-info">\n              <p>عرض أول 50 موعد من إجمالي ${e.appointmentsList.length.toLocaleString()} موعد</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📊</span>\n            توزيع المواعيد حسب الحالة\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الحالة</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.appointmentsByStatus?.map(e=>{const t=parseFloat(e.percentage?.toFixed(1)||"0"),n=Math.max(5,t);return`\n                      <tr>\n                        <td class="category-cell">${e.status}</td>\n                        <td class="number-cell">${e.count.toLocaleString()}</td>\n                        <td class="percentage-cell">${t}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${n}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")||'<tr><td colspan="4" class="no-data">لا توجد بيانات</td></tr>'}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        ${e.appointmentsByTreatment&&e.appointmentsByTreatment.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">🦷</span>\n            توزيع المواعيد حسب نوع العلاج\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>نوع العلاج</th>\n                    <th>عدد المواعيد</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.appointmentsByTreatment.slice(0,10).map(t=>{const n=Math.max(...e.appointmentsByTreatment.map(e=>e.count)),a=n>0?t.count/n*100:0,s=Math.max(5,a);return`\n                      <tr>\n                        <td class="category-cell">${ka(t.treatment)}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${s}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        ${e.appointmentsByDay&&e.appointmentsByDay.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📅</span>\n            توزيع المواعيد حسب أيام الأسبوع\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>اليوم</th>\n                    <th>عدد المواعيد</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.appointmentsByDay.map(t=>{const n=Math.max(...e.appointmentsByDay.map(e=>e.count)),a=n>0?t.count/n*100:0,s=Math.max(5,a);return`\n                      <tr>\n                        <td class="category-cell">${t.day}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${s}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        ${e.peakHours&&e.peakHours.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">⏰</span>\n            أوقات الذروة\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الوقت</th>\n                    <th>عدد المواعيد</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.peakHours.map(t=>{const n=Math.max(...e.peakHours.map(e=>e.count)),a=n>0?t.count/n*100:0,s=Math.max(5,a);return`\n                      <tr>\n                        <td class="category-cell">${t.hour}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${s}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        <div class="report-footer">\n          <p>تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة</p>\n          <p class="generated-info">تاريخ الإنشاء: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${t?.clinic_name||"عيادة الأسنان"}</p>\n        </div>\n      </body>\n      </html>\n    `}static createEnhancedFinancialReportHTML(e,t){const n=yh.getEnhancedHeader("التقرير المالي",t,"تقرير شامل عن الإيرادات والمدفوعات"),a=yh.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>التقرير المالي - ${t?.clinic_name||"عيادة الأسنان"}</title>\n        ${a}\n      </head>\n      <body>\n        ${n}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">💰</div>\n            <div class="card-content">\n              <h3>إجمالي الإيرادات</h3>\n              <div class="number">$${e.totalRevenue?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">✅</div>\n            <div class="card-content">\n              <h3>المدفوعات المكتملة</h3>\n              <div class="number">${e.completedPayments?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">🔄</div>\n            <div class="card-content">\n              <h3>المدفوعات الجزئية</h3>\n              <div class="number">${e.partialPayments?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">⏳</div>\n            <div class="card-content">\n              <h3>المدفوعات المعلقة</h3>\n              <div class="number">${e.pendingPayments?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card danger">\n            <div class="card-icon">⚠️</div>\n            <div class="card-content">\n              <h3>المدفوعات المتأخرة</h3>\n              <div class="number">${e.overduePayments?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Payment Methods Analysis --\x3e\n        ${e.revenueByPaymentMethod&&e.revenueByPaymentMethod.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">💳</span>\n            الإيرادات حسب طريقة الدفع\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>طريقة الدفع</th>\n                    <th>المبلغ</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.revenueByPaymentMethod.map(e=>{const t=e.percentage||0,n=Math.max(5,t);return`\n                      <tr>\n                        <td class="category-cell">${"نقدي"===e.method?"💵":"بطاقة"===e.method?"💳":"تحويل بنكي"===e.method?"🏦":"💰"} ${e.method}</td>\n                        <td class="number-cell">$${e.amount?.toLocaleString()||"0"}</td>\n                        <td class="percentage-cell">${t.toFixed(1)}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${n}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n\n\n        ${e.revenueByTreatment&&e.revenueByTreatment.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">🦷</span>\n            الإيرادات حسب نوع العلاج\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>نوع العلاج</th>\n                    <th>إجمالي الإيرادات</th>\n                    <th>عدد المعاملات</th>\n                    <th>متوسط المبلغ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.revenueByTreatment.slice(0,10).map(e=>`\n                    <tr>\n                      <td class="category-cell">${ka(e.treatment)}</td>\n                      <td class="number-cell">$${e.amount?.toLocaleString()||"0"}</td>\n                      <td class="number-cell">${e.count?.toLocaleString()||"0"}</td>\n                      <td class="number-cell">$${e.avgAmount?.toLocaleString()||"0"}</td>\n                    </tr>\n                  `).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Payment Status Analysis --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📈</span>\n            تحليل حالات المدفوعات\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>حالة الدفع</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${(()=>{const t=e.dataCount||0;return[{status:"مكتمل",count:e.completedPayments||0,icon:"✅",color:"success"},{status:"جزئي",count:e.partialPayments||0,icon:"🔄",color:"info"},{status:"معلق",count:e.pendingPayments||0,icon:"⏳",color:"warning"},{status:"متأخر",count:e.overduePayments||0,icon:"⚠️",color:"danger"},{status:"فاشل",count:e.failedPayments||0,icon:"❌",color:"danger"}].map(e=>{const n=t>0?e.count/t*100:0,a=Math.max(5,n);return`\n                        <tr>\n                          <td class="category-cell">${e.icon} ${e.status}</td>\n                          <td class="number-cell">${e.count.toLocaleString()}</td>\n                          <td class="percentage-cell">${n.toFixed(1)}%</td>\n                          <td class="chart-cell">\n                            <div class="progress-bar">\n                              <div class="progress-fill ${e.color}" style="width: ${a}%"></div>\n                            </div>\n                          </td>\n                        </tr>\n                      `}).join("")})()}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Payment Status Analysis Summary --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📊</span>\n            تحليل إحصائي لحالات المدفوعات\n          </div>\n          <div class="section-content">\n            <div class="analysis-cards">\n              ${(()=>{const t=e.dataCount||0;return[{status:"مكتمل",count:e.completedPayments||0,icon:"✅",color:"#065f46",bgColor:"#d1fae5"},{status:"جزئي",count:e.partialPayments||0,icon:"🔄",color:"#1e40af",bgColor:"#dbeafe"},{status:"معلق",count:e.pendingPayments||0,icon:"⏳",color:"#92400e",bgColor:"#fef3c7"},{status:"متأخر",count:e.overduePayments||0,icon:"⚠️",color:"#991b1b",bgColor:"#fee2e2"}].map(e=>{const n=t>0?e.count/t*100:0;return`\n                    <div class="analysis-card" style="border-left-color: ${e.color}; border-left-width: 6px;">\n                      <div class="analysis-icon" style="background: ${e.bgColor}; color: ${e.color}; border: 2px solid ${e.color};">\n                        ${e.icon}\n                      </div>\n                      <div class="analysis-content">\n                        <h3 style="color: ${e.color};">${e.status}</h3>\n                        <div class="analysis-stats">\n                          <div class="stat">\n                            <span class="stat-label">العدد:</span>\n                            <span class="stat-value" style="color: ${e.color};">${e.count.toLocaleString()}</span>\n                          </div>\n                          <div class="stat">\n                            <span class="stat-label">النسبة:</span>\n                            <span class="stat-value" style="color: ${e.color};">${n.toFixed(1)}%</span>\n                          </div>\n                          <div class="stat">\n                            <span class="stat-label">من إجمالي:</span>\n                            <span class="stat-value">${t.toLocaleString()}</span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  `}).join("")})()}\n            </div>\n          </div>\n        </div>\n\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة</p>\n              <p class="generated-info">تاريخ الإنشاء: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${t?.clinic_name||"عيادة الأسنان"}</p>\n              ${e.filterInfo?`<p class="filter-info">📊 ${e.filterInfo}</p>`:""}\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">💰 ${(()=>{try{const{getCurrencyConfig:n,formatCurrencyWithConfig:a,getDefaultCurrency:s}=require("@/lib/utils"),r=n(t?.currency||s());return a(e.totalRevenue||0,r)}catch(n){return new Intl.NumberFormat("en-US",{style:"currency",currency:t?.currency||"USD"}).format(e.totalRevenue||0)}})()} إجمالي</span>\n                <span class="stat-item">✅ ${e.completedPayments?.toLocaleString()||"0"} مكتمل</span>\n                <span class="stat-item">🔄 ${e.partialPayments?.toLocaleString()||"0"} جزئي</span>\n                <span class="stat-item">📊 ${e.dataCount?.toLocaleString()||"0"} معاملة</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static createEnhancedInventoryReportHTML(e,t){const n=yh.getEnhancedHeader("تقرير المخزون",t,"تقرير شامل عن حالة المخزون والتنبيهات"),a=yh.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المخزون - ${t?.clinic_name||"عيادة الأسنان"}</title>\n        ${a}\n      </head>\n      <body>\n        ${n}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">📦</div>\n            <div class="card-content">\n              <h3>إجمالي الأصناف</h3>\n              <div class="number">${e.totalItems.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">💰</div>\n            <div class="card-content">\n              <h3>القيمة الإجمالية</h3>\n              <div class="number">$${e.totalValue?.toLocaleString()||"0"}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">⚠️</div>\n            <div class="card-content">\n              <h3>أصناف منخفضة المخزون</h3>\n              <div class="number">${e.lowStockItems||0}</div>\n            </div>\n          </div>\n          <div class="summary-card danger">\n            <div class="card-icon">⏰</div>\n            <div class="card-content">\n              <h3>أصناف منتهية الصلاحية</h3>\n              <div class="number">${e.expiredItems||0}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">❌</div>\n            <div class="card-content">\n              <h3>أصناف نفد مخزونها</h3>\n              <div class="number">${e.outOfStockItems||0}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Inventory Items List Section --\x3e\n        ${e.inventoryItems&&e.inventoryItems.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📋</span>\n            قائمة أصناف المخزون\n          </div>\n          <div class="section-content">\n            <div class="inventory-grid">\n              ${e.inventoryItems.slice(0,50).map((e,t)=>`\n                <div class="inventory-card">\n                  <div class="inventory-header">\n                    <div class="inventory-avatar">\n                      ${(e.name||"ص").charAt(0)}\n                    </div>\n                    <div class="inventory-info">\n                      <h4 class="inventory-name">${e.name||"غير محدد"}</h4>\n                      <span class="inventory-category">${e.category||"غير مصنف"}</span>\n                    </div>\n                  </div>\n                  <div class="inventory-details">\n                    <div class="detail-item">\n                      <span class="detail-label">الكمية:</span>\n                      <span class="detail-value ${e.quantity<=e.minimum_stock?"status-warning":"status-success"}">${e.quantity.toLocaleString()}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">سعر الوحدة:</span>\n                      <span class="detail-value">$${(e.unit_price||e.cost_per_unit||0).toLocaleString()}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">القيمة الإجمالية:</span>\n                      <span class="detail-value">$${((e.unit_price||e.cost_per_unit||0)*e.quantity).toLocaleString()}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">الحد الأدنى:</span>\n                      <span class="detail-value">${e.minimum_stock||0}</span>\n                    </div>\n                    ${e.expiry_date?`\n                    <div class="detail-item">\n                      <span class="detail-label">تاريخ الانتهاء:</span>\n                      <span class="detail-value ${new Date(e.expiry_date)<new Date?"status-danger":"status-info"}">${new Date(e.expiry_date).toLocaleDateString("ar-SA")}</span>\n                    </div>\n                    `:""}\n                    <div class="detail-item">\n                      <span class="detail-label">الحالة:</span>\n                      <span class="detail-value ${0===e.quantity?"status-danger":e.quantity<=e.minimum_stock?"status-warning":"status-success"}">\n                        ${0===e.quantity?"نفد المخزون":e.quantity<=e.minimum_stock?"مخزون منخفض":"متوفر"}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              `).join("")}\n            </div>\n            ${e.inventoryItems.length>50?`\n            <div class="pagination-info">\n              <p>عرض أول 50 صنف من إجمالي ${e.inventoryItems.length.toLocaleString()} صنف</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Category Distribution --\x3e\n        ${e.itemsByCategory&&e.itemsByCategory.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📊</span>\n            توزيع الأصناف حسب الفئة\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الفئة</th>\n                    <th>عدد الأصناف</th>\n                    <th>القيمة الإجمالية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.itemsByCategory.map(t=>{const n=e.totalItems>0?Math.round(t.count/e.totalItems*100):0;return`\n                    <tr>\n                      <td class="category-name">${t.category}</td>\n                      <td class="count-cell">${t.count.toLocaleString()}</td>\n                      <td class="value-cell">$${t.value?.toLocaleString()||"0"}</td>\n                      <td class="progress-cell">\n                        <div class="progress-bar">\n                          <div class="progress-fill" style="width: ${n}%"></div>\n                        </div>\n                        <span class="percentage">${n}%</span>\n                      </td>\n                    </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Stock Alerts Section --\x3e\n        ${e.stockAlerts&&e.stockAlerts.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">⚠️</span>\n            تنبيهات المخزون\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الصنف</th>\n                    <th>الكمية الحالية</th>\n                    <th>الحد الأدنى</th>\n                    <th>الحالة</th>\n                    <th>مستوى التنبيه</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.stockAlerts.slice(0,20).map(e=>{const t=0===e.quantity?"critical":"warning",n=e.minimum_stock>0?Math.min(100,Math.round(e.quantity/e.minimum_stock*100)):0;return`\n                    <tr>\n                      <td class="item-name">${e.name}</td>\n                      <td class="quantity-cell ${t}">${e.quantity.toLocaleString()}</td>\n                      <td class="minimum-cell">${e.minimum_stock||0}</td>\n                      <td class="status-cell">\n                        <span class="status-badge ${t}">\n                          ${0===e.quantity?"نفد المخزون":"مخزون منخفض"}\n                        </span>\n                      </td>\n                      <td class="alert-level">\n                        ${0===e.quantity?"🔴 عاجل":"🟡 تحذير"}\n                      </td>\n                      <td class="progress-cell">\n                        <div class="progress-bar">\n                          <div class="progress-fill ${t}" style="width: ${n}%"></div>\n                        </div>\n                        <span class="percentage">${n}%</span>\n                      </td>\n                    </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${e.stockAlerts.length>20?`\n            <div class="pagination-info">\n              <p>عرض أول 20 تنبيه من إجمالي ${e.stockAlerts.length.toLocaleString()} تنبيه</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Expiry Alerts Section --\x3e\n        ${e.expiryAlerts&&e.expiryAlerts.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">⏰</span>\n            تنبيهات انتهاء الصلاحية\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الصنف</th>\n                    <th>تاريخ الانتهاء</th>\n                    <th>الأيام المتبقية</th>\n                    <th>الكمية</th>\n                    <th>الحالة</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.expiryAlerts.slice(0,15).map(e=>{const t=new Date(e.expiry_date),n=new Date,a=Math.ceil((t.getTime()-n.getTime())/864e5),s=a<0,r=a<=30&&a>=0;return`\n                    <tr>\n                      <td class="item-name">${e.name}</td>\n                      <td class="date-cell">${t.toLocaleDateString("ar-SA")}</td>\n                      <td class="days-cell ${s?"expired":r?"expiring":"safe"}">\n                        ${s?"منتهي الصلاحية":`${a} يوم`}\n                      </td>\n                      <td class="quantity-cell">${e.quantity.toLocaleString()}</td>\n                      <td class="status-cell">\n                        <span class="status-badge ${s?"critical":r?"warning":"safe"}">\n                          ${s?"منتهي":r?"ينتهي قريباً":"آمن"}\n                        </span>\n                      </td>\n                    </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${e.expiryAlerts.length>15?`\n            <div class="pagination-info">\n              <p>عرض أول 15 تنبيه من إجمالي ${e.expiryAlerts.length.toLocaleString()} تنبيه</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Enhanced Footer --\x3e\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة</p>\n              <p class="generated-info">تاريخ الإنشاء: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${t?.clinic_name||"عيادة الأسنان"}</p>\n              ${e.filterInfo?`<p class="filter-info">📊 ${e.filterInfo}</p>`:""}\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">📦 ${e.totalItems?.toLocaleString()||"0"} صنف</span>\n                <span class="stat-item">💰 $${e.totalValue?.toLocaleString()||"0"} قيمة</span>\n                <span class="stat-item">⚠️ ${e.lowStockItems?.toLocaleString()||"0"} منخفض</span>\n                <span class="stat-item">📊 ${e.dataCount?.toLocaleString()||"0"} مفلتر</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static createEnhancedTreatmentReportHTML(e,t){const n=yh.getEnhancedHeader("تقرير العلاجات السنية",t,"تقرير شامل عن إحصائيات العلاجات والإيرادات"),a=yh.getEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير العلاجات - ${t?.clinic_name||"عيادة الأسنان"}</title>\n        ${a}\n      </head>\n      <body>\n        ${n}\n\n        \x3c!-- Summary Statistics --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📊</span>\n            ملخص الإحصائيات\n          </div>\n          <div class="section-content">\n            <div class="stats-grid">\n              <div class="stat-card">\n                <div class="stat-value">${e.totalTreatments?.toLocaleString()||"0"}</div>\n                <div class="stat-label">إجمالي العلاجات</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${e.completedTreatments?.toLocaleString()||"0"}</div>\n                <div class="stat-label">العلاجات المكتملة</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${e.plannedTreatments?.toLocaleString()||"0"}</div>\n                <div class="stat-label">العلاجات المخططة</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${e.inProgressTreatments?.toLocaleString()||"0"}</div>\n                <div class="stat-label">قيد التنفيذ</div>\n              </div>\n            </div>\n            <div class="stats-grid">\n              <div class="stat-card">\n                <div class="stat-value">${new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e.totalRevenue||0)}</div>\n                <div class="stat-label">إجمالي الإيرادات</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e.averageTreatmentCost||0)}</div>\n                <div class="stat-label">متوسط تكلفة العلاج</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${e.completionRate||"0"}%</div>\n                <div class="stat-label">معدل الإنجاز</div>\n              </div>\n              <div class="stat-card">\n                <div class="stat-value">${e.cancelledTreatments?.toLocaleString()||"0"}</div>\n                <div class="stat-label">العلاجات الملغية</div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Treatment Status Distribution --\x3e\n        ${e.treatmentsByStatus&&e.treatmentsByStatus.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📈</span>\n            توزيع العلاجات حسب الحالة\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الحالة</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.treatmentsByStatus.map(e=>{const t=Math.max(5,e.percentage||0);return`\n                      <tr>\n                        <td class="category-cell">${e.status}</td>\n                        <td class="number-cell">${e.count?.toLocaleString()||"0"}</td>\n                        <td class="percentage-cell">${e.percentage?.toFixed(1)||"0"}%</td>\n                        <td class="progress-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${t}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Treatment Types Distribution --\x3e\n        ${e.treatmentsByType&&e.treatmentsByType.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">🦷</span>\n            توزيع العلاجات حسب النوع\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>نوع العلاج</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.treatmentsByType.slice(0,15).map(e=>{const t=Math.max(5,e.percentage||0);return`\n                      <tr>\n                        <td class="category-cell">${e.type}</td>\n                        <td class="number-cell">${e.count?.toLocaleString()||"0"}</td>\n                        <td class="percentage-cell">${e.percentage?.toFixed(1)||"0"}%</td>\n                        <td class="progress-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${t}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${e.treatmentsByType.length>15?`\n            <div class="pagination-info">\n              <p>عرض أول 15 نوع من إجمالي ${e.treatmentsByType.length.toLocaleString()} نوع</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Revenue by Category --\x3e\n        ${e.revenueByCategory&&e.revenueByCategory.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">💰</span>\n            الإيرادات حسب فئة العلاج\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>فئة العلاج</th>\n                    <th>إجمالي الإيرادات</th>\n                    <th>عدد العلاجات</th>\n                    <th>متوسط التكلفة</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.revenueByCategory.slice(0,10).map(e=>{const n=e.count>0?e.revenue/e.count:0;return`\n                      <tr>\n                        <td class="category-cell">${e.category}</td>\n                        <td class="number-cell">${e.revenue?.toLocaleString()||"0"} ${t?.currency||"$"}</td>\n                        <td class="number-cell">${e.count?.toLocaleString()||"0"}</td>\n                        <td class="number-cell">${n.toLocaleString()} ${t?.currency||"$"}</td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Pending Treatments --\x3e\n        ${e.pendingTreatments&&e.pendingTreatments.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">⏳</span>\n            العلاجات المعلقة (${e.pendingTreatments.length})\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>نوع العلاج</th>\n                    <th>اسم المريض</th>\n                    <th>الحالة</th>\n                    <th>التاريخ</th>\n                    <th>التكلفة</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.pendingTreatments.slice(0,20).map(e=>`\n                    <tr>\n                      <td class="category-cell">${ka(e.treatment_type||"غير محدد")}</td>\n                      <td class="patient-cell">${e.patient_name||"غير محدد"}</td>\n                      <td class="status-cell">\n                        <span class="status-badge warning">${e.status||"معلق"}</span>\n                      </td>\n                      <td class="date-cell">${e.created_at?(()=>{const t=new Date(e.created_at);return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`})():"غير محدد"}</td>\n                      <td class="number-cell">${new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e.cost||0)}</td>\n                    </tr>\n                  `).join("")}\n                </tbody>\n              </table>\n            </div>\n            ${e.pendingTreatments.length>20?`\n            <div class="pagination-info">\n              <p>عرض أول 20 علاج من إجمالي ${e.pendingTreatments.length.toLocaleString()} علاج معلق</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Enhanced Footer --\x3e\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة</p>\n              <p class="generated-info">تاريخ الإنشاء: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</p>\n            </div>\n            <div class="footer-right">\n              <p class="clinic-name">${t?.clinic_name||"عيادة الأسنان الحديثة"}</p>\n              ${t?.clinic_address?`<p class="clinic-address">${t.clinic_address}</p>`:""}\n              ${t?.clinic_phone?`<p class="clinic-phone">📞 ${t.clinic_phone}</p>`:""}\n            </div>\n          </div>\n        </div>\n\n      </body>\n      </html>\n    `}static createEnhancedProfitLossReportHTML(e,t){const{reportData:n,payments:a,labOrders:s,clinicNeeds:r,inventoryItems:i,clinicExpenses:l,patients:o,appointments:c,filter:d,currency:m}=e,u=yh.getEnhancedHeader("التقرير الشامل للأرباح والخسائر",t,"تحليل مالي شامل يربط جميع جوانب العيادة"),p=yh.getEnhancedStyles(),h=e=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:m||"SAR",minimumFractionDigits:2}).format(e||0),x=e=>{try{const t=new Date(e);return isNaN(t.getTime())?"غير محدد":t.toLocaleDateString("en-GB")}catch{return"غير محدد"}};return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير الأرباح والخسائر - ${t?.clinic_name||"عيادة الأسنان"}</title>\n        ${p}\n        <style>\n          .profit-loss-summary {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n            margin: 20px 0;\n          }\n          .profit-card {\n            background: linear-gradient(135deg, #10b981, #059669);\n            color: white;\n            padding: 20px;\n            border-radius: 10px;\n            text-align: center;\n          }\n          .loss-card {\n            background: linear-gradient(135deg, #ef4444, #dc2626);\n            color: white;\n            padding: 20px;\n            border-radius: 10px;\n            text-align: center;\n          }\n          .financial-breakdown {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 30px;\n            margin: 30px 0;\n          }\n          .revenue-section, .expenses-section {\n            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);\n            padding: 20px;\n            border-radius: 10px;\n            border: 2px solid #1a365d;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          }\n          .revenue-section h3 {\n            color: #059669;\n            border-bottom: 2px solid #10b981;\n            padding-bottom: 10px;\n          }\n          .expenses-section h3 {\n            color: #dc2626;\n            border-bottom: 2px solid #ef4444;\n            padding-bottom: 10px;\n          }\n          .breakdown-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 8px 0;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          .breakdown-item:last-child {\n            border-bottom: none;\n            font-weight: bold;\n            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);\n            color: white;\n            padding: 12px;\n            margin-top: 10px;\n            border-radius: 5px;\n            text-shadow: 0 1px 2px rgba(0,0,0,0.2);\n          }\n          .details-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            font-size: 12px;\n          }\n          .details-table th,\n          .details-table td {\n            border: 1px solid #e2e8f0;\n            padding: 8px;\n            text-align: right;\n          }\n          .details-table th {\n            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);\n            color: white;\n            font-weight: bold;\n            text-shadow: 0 1px 2px rgba(0,0,0,0.2);\n          }\n          .details-table tr:nth-child(even) {\n            background: #f8fafc;\n          }\n          .statistics-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 15px;\n            margin: 20px 0;\n          }\n          .stat-card {\n            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n            border: 2px solid #1a365d;\n            border-radius: 8px;\n            padding: 15px;\n            text-align: center;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          }\n          .stat-number {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e40af;\n          }\n          .stat-label {\n            font-size: 12px;\n            color: #64748b;\n            margin-top: 5px;\n          }\n        </style>\n      </head>\n      <body>\n        ${u}\n\n        \x3c!-- النتيجة النهائية --\x3e\n        <div class="profit-loss-summary">\n          <div class="${n.calculations.isProfit?"profit-card":"loss-card"}">\n            <h2>${n.calculations.isProfit?"🎉 ربح":"⚠️ خسارة"}</h2>\n            <div class="number" style="font-size: 28px; margin: 10px 0;">\n              ${h(n.calculations.isProfit?n.calculations.netProfit:n.calculations.lossAmount)}\n            </div>\n            <p>نسبة الربح: ${n.calculations.profitMargin.toFixed(2)}%</p>\n          </div>\n          <div class="summary-card info">\n            <h3>معلومات التقرير</h3>\n            <p><strong>الفترة الزمنية:</strong> ${n.filterInfo.dateRange}</p>\n            <p><strong>إجمالي السجلات:</strong> ${n.filterInfo.totalRecords}</p>\n            <p><strong>السجلات المفلترة:</strong> ${n.filterInfo.filteredRecords}</p>\n            <p><strong>تاريخ التقرير:</strong> ${x((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        \x3c!-- تفصيل الإيرادات والمصروفات --\x3e\n        <div class="financial-breakdown">\n          <div class="revenue-section">\n            <h3>📈 تفاصيل الإيرادات</h3>\n            <div class="breakdown-item">\n              <span>المدفوعات المكتملة:</span>\n              <span>${h(n.revenue.completedPayments)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>المدفوعات الجزئية:</span>\n              <span>${h(n.revenue.partialPayments)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>المبالغ المعلقة (غير مدفوعة):</span>\n              <span>${h(n.revenue.pendingAmount||0)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>المبالغ المتبقية:</span>\n              <span>${h(n.revenue.remainingBalances)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>إجمالي الإيرادات:</span>\n              <span>${h(n.revenue.totalRevenue)}</span>\n            </div>\n          </div>\n\n          <div class="expenses-section">\n            <h3>📉 تفاصيل المصروفات</h3>\n            <div class="breakdown-item">\n              <span>مدفوعات المخابر:</span>\n              <span>${h(n.expenses.labOrdersTotal)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>متبقي المخابر:</span>\n              <span>${h(n.expenses.labOrdersRemaining)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>احتياجات العيادة:</span>\n              <span>${h(n.expenses.clinicNeedsTotal)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>متبقي الاحتياجات:</span>\n              <span>${h(n.expenses.clinicNeedsRemaining)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>قيمة المخزون:</span>\n              <span>${h(n.expenses.inventoryExpenses)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>مصروفات العيادة المباشرة:</span>\n              <span>${h(n.expenses.clinicExpensesTotal||0)}</span>\n            </div>\n            <div class="breakdown-item">\n              <span>إجمالي المصروفات:</span>\n              <span>${h(n.calculations.totalExpenses)}</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- إحصائيات إضافية --\x3e\n        <div class="statistics-grid">\n          <div class="stat-card">\n            <div class="stat-number">${n.details.totalPatients}</div>\n            <div class="stat-label">إجمالي المرضى</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-number">${n.details.totalAppointments}</div>\n            <div class="stat-label">إجمالي المواعيد</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-number">${n.details.totalLabOrders}</div>\n            <div class="stat-label">طلبات المخابر</div>\n          </div>\n          <div class="stat-card">\n            <div class="stat-number">${n.details.totalClinicNeeds}</div>\n            <div class="stat-label">احتياجات العيادة</div>\n          </div>\n        </div>\n\n        \x3c!-- متوسطات الإيرادات --\x3e\n        <div class="section">\n          <h3>📊 متوسطات الإيرادات</h3>\n          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">\n            <div class="summary-card">\n              <h4>متوسط الإيرادات لكل مريض</h4>\n              <div class="number">${h(n.details.averageRevenuePerPatient)}</div>\n            </div>\n            <div class="summary-card">\n              <h4>متوسط الإيرادات لكل موعد</h4>\n              <div class="number">${h(n.details.averageRevenuePerAppointment)}</div>\n            </div>\n          </div>\n        </div>\n\n        ${a&&a.length>0?`\n        \x3c!-- تفاصيل المدفوعات --\x3e\n        <div class="section">\n          <h3>💰 تفاصيل المدفوعات (أحدث 20 دفعة)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>اسم المريض</th>\n                <th>المبلغ المدفوع</th>\n                <th>المبلغ الإجمالي</th>\n                <th>المبلغ المتبقي</th>\n                <th>الحالة</th>\n                <th>طريقة الدفع</th>\n                <th>تاريخ الدفع</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${a.slice(0,20).map(e=>{const t=e.amount||0;let n=0,a=0;if("partial"===e.status){n=e.total_amount_due||e.treatment_total_cost||0;const s=e.amount_paid||e.treatment_total_paid||t;a=Math.max(0,n-s)}else"pending"===e.status?(n=e.total_amount_due||e.treatment_total_cost||t,a=n):(n=t,a=0);return`\n                <tr>\n                  <td>${e.patient_name||""}</td>\n                  <td>${h(t)}</td>\n                  <td>${h(n)}</td>\n                  <td>${h(a)}</td>\n                  <td>${"completed"===e.status?"مكتمل":"partial"===e.status?"جزئي":"معلق"}</td>\n                  <td>${e.payment_method||""}</td>\n                  <td>${e.payment_date?x(e.payment_date):""}</td>\n                </tr>\n                `}).join("")}\n            </tbody>\n          </table>\n\n          \x3c!-- ملخص المدفوعات المعلقة والمتبقية --\x3e\n          <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%); border: 2px solid #1a365d; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">\n            <h4>📊 ملخص المدفوعات المعلقة والمتبقية</h4>\n            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">\n              <div>\n                <strong>إجمالي المدفوعات المعلقة:</strong><br>\n                ${h(a.filter(e=>"pending"===e.status).reduce((e,t)=>e+(t.total_amount_due||t.treatment_total_cost||0),0))}\n              </div>\n              <div>\n                <strong>إجمالي المبالغ المتبقية من الدفعات الجزئية:</strong><br>\n                ${h(a.filter(e=>"partial"===e.status).reduce((e,t)=>{const n=t.total_amount_due||t.treatment_total_cost||0,a=t.amount_paid||t.treatment_total_paid||t.amount||0;return e+Math.max(0,n-a)},0))}\n              </div>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        ${s&&s.length>0?`\n        \x3c!-- تفاصيل طلبات المخابر --\x3e\n        <div class="section">\n          <h3>🔬 تفاصيل طلبات المخابر (أحدث 15 طلب)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>رقم الطلب</th>\n                <th>اسم المختبر</th>\n                <th>اسم المريض</th>\n                <th>التكلفة</th>\n                <th>المدفوع</th>\n                <th>المتبقي</th>\n                <th>الحالة</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${s.slice(0,15).map(e=>`\n                <tr>\n                  <td>${e.id||""}</td>\n                  <td>${e.lab?.name||""}</td>\n                  <td>${e.patient?.full_name||""}</td>\n                  <td>${h(e.cost||0)}</td>\n                  <td>${h(e.paid_amount||0)}</td>\n                  <td>${h((e.cost||0)-(e.paid_amount||0))}</td>\n                  <td>${"completed"===e.status?"مكتمل":"pending"===e.status?"معلق":"ملغي"}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${r&&r.length>0?`\n        \x3c!-- تفاصيل احتياجات العيادة --\x3e\n        <div class="section">\n          <h3>🏥 تفاصيل احتياجات العيادة (أحدث 15 احتياج)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>اسم العنصر</th>\n                <th>الكمية</th>\n                <th>سعر الوحدة</th>\n                <th>التكلفة الإجمالية</th>\n                <th>الأولوية</th>\n                <th>الحالة</th>\n                <th>تاريخ الطلب</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${r.slice(0,15).map(e=>{const t=e.quantity||0,n=e.price||0,a=t*n;return`\n                <tr>\n                  <td>${e.need_name||e.item_name||""}</td>\n                  <td>${t}</td>\n                  <td>${h(n)}</td>\n                  <td>${h(a)}</td>\n                  <td>${"urgent"===e.priority?"عاجل":"high"===e.priority?"عالي":"medium"===e.priority?"متوسط":"منخفض"}</td>\n                  <td>${"received"===e.status?"مستلم":"ordered"===e.status?"مطلوب":"معلق"}</td>\n                  <td>${e.created_at?x(e.created_at):""}</td>\n                </tr>\n                `}).join("")}\n            </tbody>\n          </table>\n\n          \x3c!-- إجمالي تكلفة احتياجات العيادة --\x3e\n          <div style="margin-top: 15px; padding: 10px; background: #f1f5f9; border-radius: 5px;">\n            <strong>إجمالي تكلفة احتياجات العيادة: ${h(r.reduce((e,t)=>e+(t.quantity||0)*(t.price||0),0))}</strong>\n          </div>\n        </div>\n        `:""}\n\n        ${l&&l.length>0?`\n        \x3c!-- تفاصيل مصروفات العيادة --\x3e\n        <div class="section">\n          <h3>💸 تفاصيل مصروفات العيادة (أحدث 15 مصروف)</h3>\n          <table class="details-table">\n            <thead>\n              <tr>\n                <th>اسم المصروف</th>\n                <th>النوع</th>\n                <th>المبلغ</th>\n                <th>طريقة الدفع</th>\n                <th>تاريخ الدفع</th>\n                <th>المورد</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${l.slice(0,15).map(e=>`\n                <tr>\n                  <td>${e.expense_name||""}</td>\n                  <td>${e.expense_type||""}</td>\n                  <td>${h(e.amount||0)}</td>\n                  <td>${e.payment_method||""}</td>\n                  <td>${e.payment_date?x(e.payment_date):""}</td>\n                  <td>${e.vendor||""}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        \x3c!-- Footer --\x3e\n        <div class="footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="report-date">تاريخ التقرير: ${x((new Date).toISOString())}</p>\n              <p class="report-time">وقت التقرير: ${(new Date).toLocaleTimeString("ar-SA")}</p>\n            </div>\n            <div class="footer-right">\n              <p class="clinic-name">${t?.clinic_name||"عيادة الأسنان الحديثة"}</p>\n              ${t?.clinic_address?`<p class="clinic-address">${t.clinic_address}</p>`:""}\n              ${t?.clinic_phone?`<p class="clinic-phone">📞 ${t.clinic_phone}</p>`:""}\n            </div>\n          </div>\n        </div>\n\n      </body>\n      </html>\n    `}}class yh{static COLORS={primary:"#1a365d",secondary:"#2c5282",accent:"#92400e",success:"#065f46",warning:"#92400e",danger:"#991b1b",muted:"#374151",light:"#f9fafb",white:"#ffffff",border:"#d1d5db",text:{primary:"#111827",secondary:"#374151",muted:"#4b5563"}};static TYPOGRAPHY={fonts:{primary:"'Tajawal', 'Cairo', Arial, sans-serif",secondary:"'Tajawal', Arial, sans-serif",monospace:"'Courier New', monospace"},sizes:{h1:"28px",h2:"24px",h3:"20px",h4:"18px",h5:"16px",body:"14px",small:"12px",tiny:"10px"},weights:{light:"300",normal:"400",medium:"500",semibold:"600",bold:"700"}};static LAYOUT={margins:{top:"40px",bottom:"40px",left:"30px",right:"30px"},spacing:{section:"30px",card:"20px",element:"15px",small:"10px"},borderRadius:"12px",shadows:{card:"0 4px 20px rgba(0,0,0,0.08)",header:"0 2px 10px rgba(0,0,0,0.05)"}};static getEnhancedHeader(e,t,n){return this.createEnhancedHeader(e,t,n)}static getEnhancedStyles(){return this.createEnhancedStyles()}static createEnhancedHeader(e,t,n){const a=t?.clinic_name||"عيادة الأسنان الحديثة",s=t?.doctor_name||"د. محمد أحمد",r=t?.clinic_address||"",i=t?.clinic_phone||"",l=t?.clinic_logo||"";return(()=>{const e=new Date;e.getDate().toString().padStart(2,"0"),(e.getMonth()+1).toString().padStart(2,"0"),e.getFullYear()})(),`\n      <div class="enhanced-header">\n        <div class="header-content">\n          <div class="clinic-info">\n            ${l&&""!==l.trim()?`\n              <div class="clinic-logo">\n                <img src="${l}" alt="شعار العيادة" />\n              </div>\n            `:""}\n            <div class="clinic-details">\n              <h1 class="clinic-name">${a}</h1>\n              ${s?`<h2 class="doctor-name">${s}</h2>`:""}\n              ${r?`<p class="clinic-address">${r}</p>`:""}\n              ${i?`<p class="clinic-phone">📞 ${i}</p>`:""}\n            </div>\n          </div>\n\n          <div class="report-info">\n            <h3 class="report-title">${e}</h3>\n            ${n?`<p class="report-subtitle">${n}</p>`:""}\n            <p class="report-date">📅 ${this.formatGregorianDate(new Date)}</p>\n            <p class="report-time">🕐 ${(new Date).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}</p>\n          </div>\n        </div>\n\n        <div class="header-decoration"></div>\n      </div>\n    `}static createEnhancedStyles(){return`\n      <style>\n        @import url('/fonts/Tajawal-Regular.ttf');\n        @import url('/fonts/Tajawal-Bold.ttf');\n        @import url('/fonts/Tajawal-Medium.ttf');\n\n        * {\n          box-sizing: border-box;\n          margin: 0;\n          padding: 0;\n        }\n\n        body {\n          font-family: ${this.TYPOGRAPHY.fonts.primary};\n          direction: rtl;\n          line-height: 1.6;\n          color: ${this.COLORS.text.primary};\n          background: ${this.COLORS.white};\n          margin: ${this.LAYOUT.margins.top} ${this.LAYOUT.margins.right} ${this.LAYOUT.margins.bottom} ${this.LAYOUT.margins.left};\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n        }\n\n        /* Enhanced Header Styles */\n        .enhanced-header {\n          background: linear-gradient(135deg, ${this.COLORS.primary} 0%, ${this.COLORS.secondary} 100%);\n          color: ${this.COLORS.white};\n          padding: ${this.LAYOUT.spacing.card};\n          border-radius: ${this.LAYOUT.borderRadius};\n          margin-bottom: ${this.LAYOUT.spacing.section};\n          box-shadow: ${this.LAYOUT.shadows.header};\n          position: relative;\n          overflow: hidden;\n        }\n\n        .header-content {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          position: relative;\n          z-index: 2;\n        }\n\n        .clinic-info {\n          display: flex;\n          align-items: center;\n          gap: ${this.LAYOUT.spacing.element};\n        }\n\n        .clinic-logo {\n          width: 70px;\n          height: 70px;\n          border-radius: 50%;\n          overflow: hidden;\n          background: ${this.COLORS.white};\n          padding: 4px;\n          box-shadow: 0 3px 10px rgba(0,0,0,0.15);\n          border: 2px solid rgba(255,255,255,0.8);\n          flex-shrink: 0;\n        }\n\n        .clinic-logo img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          border-radius: 50%;\n          max-width: 70px;\n          max-height: 70px;\n        }\n\n        .clinic-details h1.clinic-name {\n          font-size: ${this.TYPOGRAPHY.sizes.h2};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          margin-bottom: 5px;\n          text-shadow: 0 2px 4px rgba(0,0,0,0.3);\n        }\n\n        .clinic-details h2.doctor-name {\n          font-size: ${this.TYPOGRAPHY.sizes.h4};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          margin-bottom: 8px;\n          opacity: 0.95;\n        }\n\n        .clinic-details p {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          margin-bottom: 3px;\n          opacity: 0.9;\n        }\n\n        .report-info {\n          text-align: left;\n          direction: ltr;\n        }\n\n        .report-info h3.report-title {\n          font-size: ${this.TYPOGRAPHY.sizes.h3};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          margin-bottom: 8px;\n          text-shadow: 0 2px 4px rgba(0,0,0,0.3);\n        }\n\n        .report-info p {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          margin-bottom: 3px;\n          opacity: 0.9;\n        }\n\n        .header-decoration {\n          position: absolute;\n          top: -50%;\n          right: -10%;\n          width: 200px;\n          height: 200px;\n          background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);\n          border-radius: 50%;\n        }\n\n        /* Enhanced Card Styles */\n        .summary-cards {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n          gap: ${this.LAYOUT.spacing.element};\n          margin: ${this.LAYOUT.spacing.section} 0;\n        }\n\n        .summary-card {\n          background: ${this.COLORS.white};\n          border: 2px solid ${this.COLORS.border};\n          border-radius: ${this.LAYOUT.borderRadius};\n          padding: ${this.LAYOUT.spacing.card};\n          box-shadow: ${this.LAYOUT.shadows.card};\n          transition: all 0.3s ease;\n          position: relative;\n          overflow: hidden;\n          display: flex;\n          align-items: center;\n          gap: 15px;\n        }\n\n        .summary-card.primary::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: ${this.COLORS.primary};\n        }\n\n        .summary-card.success::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: ${this.COLORS.success};\n        }\n\n        .summary-card.info::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: #1e40af;\n        }\n\n        .summary-card.warning::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          bottom: 0;\n          width: 6px;\n          background: ${this.COLORS.warning};\n        }\n\n        .card-icon {\n          font-size: 32px;\n          min-width: 50px;\n          height: 50px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          background: ${this.COLORS.light};\n          border-radius: 50%;\n          flex-shrink: 0;\n        }\n\n        .card-content {\n          flex: 1;\n          text-align: right;\n        }\n\n        .summary-card h3 {\n          font-size: ${this.TYPOGRAPHY.sizes.h5};\n          font-weight: ${this.TYPOGRAPHY.weights.semibold};\n          color: ${this.COLORS.text.secondary};\n          margin-bottom: ${this.LAYOUT.spacing.small};\n        }\n\n        .summary-card .number {\n          font-size: ${this.TYPOGRAPHY.sizes.h2};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.primary};\n          margin-bottom: 5px;\n        }\n\n        .summary-card .currency {\n          color: ${this.COLORS.success};\n        }\n\n        .summary-card .warning {\n          color: ${this.COLORS.warning};\n        }\n\n        .summary-card .danger {\n          color: ${this.COLORS.danger};\n        }\n\n        /* Enhanced Section Styles */\n        .section {\n          margin: ${this.LAYOUT.spacing.section} 0;\n          background: ${this.COLORS.white};\n          border-radius: ${this.LAYOUT.borderRadius};\n          overflow: hidden;\n          box-shadow: ${this.LAYOUT.shadows.card};\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n        }\n\n        .section-title {\n          font-size: ${this.TYPOGRAPHY.sizes.h4};\n          font-weight: ${this.TYPOGRAPHY.weights.semibold};\n          color: ${this.COLORS.primary};\n          margin-bottom: ${this.LAYOUT.spacing.element};\n          padding: ${this.LAYOUT.spacing.element} ${this.LAYOUT.spacing.card};\n          background: linear-gradient(90deg, ${this.COLORS.light} 0%, ${this.COLORS.white} 100%);\n          border-bottom: 2px solid ${this.COLORS.border};\n          position: relative;\n          display: flex;\n          align-items: center;\n          gap: 10px;\n          page-break-after: avoid !important;\n          break-after: avoid !important;\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n        }\n\n        .section-title::before {\n          content: '';\n          position: absolute;\n          left: 0;\n          top: 0;\n          bottom: 0;\n          width: 4px;\n          background: ${this.COLORS.primary};\n        }\n\n        .section-icon {\n          font-size: 20px;\n        }\n\n        .section-content {\n          padding: ${this.LAYOUT.spacing.card};\n        }\n\n        /* Patient Cards Grid */\n        .patients-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .patient-card {\n          background: ${this.COLORS.white};\n          border: 2px solid ${this.COLORS.border};\n          border-radius: 12px;\n          padding: 20px;\n          box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          transition: all 0.3s ease;\n        }\n\n        .patient-card:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 2px 6px rgba(0,0,0,0.15);\n          border-color: ${this.COLORS.primary};\n        }\n\n        .patient-header {\n          display: flex;\n          align-items: center;\n          gap: 15px;\n          margin-bottom: 15px;\n          padding-bottom: 15px;\n          border-bottom: 1px solid ${this.COLORS.border};\n        }\n\n        .patient-avatar {\n          width: 50px;\n          height: 50px;\n          background: ${this.COLORS.primary};\n          color: ${this.COLORS.white};\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 20px;\n          font-weight: bold;\n          flex-shrink: 0;\n        }\n\n        .patient-info {\n          flex: 1;\n        }\n\n        .patient-name {\n          font-size: 16px;\n          font-weight: bold;\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 5px 0;\n        }\n\n        .patient-serial {\n          font-size: 12px;\n          color: ${this.COLORS.text.muted};\n          background: ${this.COLORS.light};\n          padding: 2px 8px;\n          border-radius: 12px;\n          display: inline-block;\n        }\n\n        .patient-details {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 10px;\n        }\n\n        .detail-item {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 8px 0;\n        }\n\n        .detail-label {\n          font-size: 12px;\n          color: ${this.COLORS.text.muted};\n          font-weight: medium;\n        }\n\n        .detail-value {\n          font-size: 12px;\n          color: ${this.COLORS.text.primary};\n          font-weight: bold;\n        }\n\n        .status-active {\n          color: ${this.COLORS.success};\n        }\n\n        .pagination-info {\n          text-align: center;\n          padding: 20px;\n          background: ${this.COLORS.light};\n          border-radius: 8px;\n          margin-top: 20px;\n        }\n\n        .pagination-info p {\n          color: ${this.COLORS.text.muted};\n          font-size: 14px;\n          margin: 0;\n        }\n\n        /* Appointment Cards Grid */\n        .appointments-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .appointment-card {\n          background: ${this.COLORS.white};\n          border: 2px solid ${this.COLORS.border};\n          border-radius: 12px;\n          padding: 20px;\n          box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          transition: all 0.3s ease;\n        }\n\n        .appointment-card:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 2px 6px rgba(0,0,0,0.15);\n          border-color: ${this.COLORS.accent};\n        }\n\n        .appointment-header {\n          display: flex;\n          align-items: center;\n          gap: 15px;\n          margin-bottom: 15px;\n          padding-bottom: 15px;\n          border-bottom: 1px solid ${this.COLORS.border};\n        }\n\n        .appointment-avatar {\n          width: 50px;\n          height: 50px;\n          background: linear-gradient(135deg, ${this.COLORS.accent}, ${this.COLORS.warning});\n          color: ${this.COLORS.white};\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 20px;\n          font-weight: bold;\n          flex-shrink: 0;\n        }\n\n        .appointment-info {\n          flex: 1;\n        }\n\n        .appointment-patient {\n          font-size: 16px;\n          font-weight: bold;\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 5px 0;\n        }\n\n        .appointment-serial {\n          font-size: 12px;\n          color: ${this.COLORS.text.muted};\n          background: ${this.COLORS.light};\n          padding: 2px 8px;\n          border-radius: 12px;\n          display: inline-block;\n        }\n\n        .appointment-details {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 8px;\n        }\n\n        .status-completed {\n          color: ${this.COLORS.success};\n          background: rgba(6, 95, 70, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-cancelled {\n          color: ${this.COLORS.warning};\n          background: rgba(146, 64, 14, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-no-show {\n          color: ${this.COLORS.danger};\n          background: rgba(153, 27, 27, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-scheduled {\n          color: ${this.COLORS.primary};\n          background: rgba(26, 54, 93, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        .status-unknown {\n          color: ${this.COLORS.text.muted};\n          background: rgba(75, 85, 99, 0.1);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          display: inline-block;\n        }\n\n        /* Enhanced Table Styles */\n        table {\n          width: 100%;\n          border-collapse: collapse;\n          margin: ${this.LAYOUT.spacing.element} 0;\n          background: ${this.COLORS.white};\n          border-radius: ${this.LAYOUT.borderRadius};\n          overflow: hidden;\n          box-shadow: 0 2px 10px rgba(0,0,0,0.05);\n        }\n\n        th {\n          background: linear-gradient(135deg, ${this.COLORS.primary} 0%, ${this.COLORS.secondary} 100%);\n          color: ${this.COLORS.white};\n          font-weight: ${this.TYPOGRAPHY.weights.semibold};\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          padding: ${this.LAYOUT.spacing.element};\n          text-align: center;\n          border: none;\n          text-shadow: 0 1px 2px rgba(0,0,0,0.2);\n        }\n\n        td {\n          padding: ${this.LAYOUT.spacing.small} ${this.LAYOUT.spacing.element};\n          text-align: center;\n          border-bottom: 1px solid ${this.COLORS.border};\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          color: ${this.COLORS.text.primary};\n        }\n\n        tr:nth-child(even) {\n          background: ${this.COLORS.light};\n        }\n\n        tr:hover {\n          background: rgba(14, 165, 233, 0.05);\n        }\n\n        /* Enhanced Footer */\n        .report-footer {\n          margin-top: ${this.LAYOUT.spacing.section};\n          padding: ${this.LAYOUT.spacing.card};\n          background: ${this.COLORS.light};\n          border-radius: ${this.LAYOUT.borderRadius};\n          text-align: center;\n          border-top: 3px solid ${this.COLORS.primary};\n        }\n\n        .report-footer p {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          color: ${this.COLORS.text.secondary};\n          margin-bottom: 5px;\n        }\n\n        .report-footer .generated-info {\n          font-size: ${this.TYPOGRAPHY.sizes.tiny};\n          color: ${this.COLORS.text.muted};\n          font-style: italic;\n        }\n\n        /* Enhanced Data Table Styles */\n        .data-table {\n          width: 100%;\n          border-collapse: collapse;\n          margin: ${this.LAYOUT.spacing.element} 0;\n          background: ${this.COLORS.white};\n          border-radius: ${this.LAYOUT.borderRadius};\n          overflow: visible;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          page-break-before: auto;\n          page-break-after: auto;\n          display: table !important;\n        }\n\n        .data-table th {\n          background: ${this.COLORS.primary};\n          color: ${this.COLORS.white};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          padding: ${this.LAYOUT.spacing.element};\n          text-align: center;\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          border: 2px solid ${this.COLORS.border};\n          border-bottom: 3px solid ${this.COLORS.secondary};\n        }\n\n        .data-table td {\n          padding: ${this.LAYOUT.spacing.element};\n          text-align: center;\n          border: 1px solid ${this.COLORS.border};\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          color: ${this.COLORS.text.primary};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          page-break-inside: avoid;\n          break-inside: avoid;\n        }\n\n        .data-table tr {\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          page-break-before: avoid !important;\n          page-break-after: avoid !important;\n          display: table-row !important;\n        }\n\n        .data-table thead {\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          page-break-after: avoid !important;\n          display: table-header-group !important;\n        }\n\n        .data-table tbody {\n          page-break-inside: avoid !important;\n          break-inside: avoid !important;\n          display: table-row-group !important;\n        }\n\n        .data-table tr:nth-child(even) {\n          background: ${this.COLORS.light};\n        }\n\n        .data-table tr:nth-child(odd) {\n          background: ${this.COLORS.white};\n        }\n\n        .data-table tr:hover {\n          background: #e2e8f0;\n        }\n\n        .category-cell {\n          text-align: right !important;\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n        }\n\n        .number-cell {\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.primary};\n        }\n\n        .percentage-cell {\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          color: ${this.COLORS.text.secondary};\n        }\n\n        .chart-cell {\n          width: 150px;\n          padding: 8px !important;\n        }\n\n        .progress-bar {\n          width: 100%;\n          height: 20px;\n          background: ${this.COLORS.light};\n          border: 1px solid ${this.COLORS.border};\n          border-radius: 10px;\n          overflow: hidden;\n          position: relative;\n        }\n\n        .progress-fill {\n          height: 100%;\n          background: ${this.COLORS.primary};\n          border-radius: 8px;\n          transition: width 0.3s ease;\n          position: relative;\n          border: 1px solid ${this.COLORS.secondary};\n        }\n\n        .progress-fill.gender-male {\n          background: #1e40af;\n          border-color: #1e3a8a;\n        }\n\n        .progress-fill.gender-female {\n          background: #be185d;\n          border-color: #9d174d;\n        }\n\n        .progress-fill.trend {\n          background: ${this.COLORS.success};\n          border-color: #047857;\n        }\n\n        .no-data {\n          text-align: center !important;\n          color: ${this.COLORS.text.muted};\n          font-style: italic;\n          padding: 30px !important;\n        }\n\n        .chart-container {\n          background: ${this.COLORS.white};\n          border-radius: 8px;\n          overflow: hidden;\n        }\n\n        /* Enhanced Footer Styles */\n        .footer-content {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          gap: 20px;\n        }\n\n        .footer-left {\n          flex: 1;\n          text-align: right;\n        }\n\n        .footer-right {\n          flex-shrink: 0;\n        }\n\n        .footer-title {\n          margin: 0 0 5px 0;\n          color: ${this.COLORS.text.primary};\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n        }\n\n        .footer-stats {\n          display: flex;\n          gap: 15px;\n          align-items: center;\n        }\n\n        .stat-item {\n          background: ${this.COLORS.white};\n          padding: 8px 12px;\n          border-radius: 20px;\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          color: ${this.COLORS.text.primary};\n          border: 1px solid ${this.COLORS.border};\n        }\n\n        /* Page Break */\n        .page-break {\n          page-break-before: always;\n          break-before: page;\n          height: 0;\n          margin: 0;\n          padding: 0;\n        }\n\n        /* Page Header for New Pages */\n        .page-header {\n          text-align: center;\n          margin: 40px 0 30px 0;\n          padding: 30px 20px;\n          background: linear-gradient(135deg, ${this.COLORS.light} 0%, ${this.COLORS.white} 100%);\n          border-radius: ${this.LAYOUT.borderRadius};\n          border: 2px solid ${this.COLORS.border};\n          position: relative;\n        }\n\n        .page-header::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          height: 4px;\n          background: linear-gradient(90deg, ${this.COLORS.primary}, ${this.COLORS.secondary});\n          border-radius: ${this.LAYOUT.borderRadius} ${this.LAYOUT.borderRadius} 0 0;\n        }\n\n        .page-title {\n          font-size: ${this.TYPOGRAPHY.sizes.h2};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.primary};\n          margin: 0 0 10px 0;\n          text-shadow: 0 1px 2px rgba(0,0,0,0.1);\n        }\n\n        .page-subtitle {\n          font-size: ${this.TYPOGRAPHY.sizes.body};\n          color: ${this.COLORS.text.secondary};\n          margin: 0;\n          font-style: italic;\n        }\n\n        /* Analysis Cards */\n        .analysis-cards {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .analysis-card {\n          background: ${this.COLORS.white};\n          border: 1px solid ${this.COLORS.border};\n          border-left: 4px solid ${this.COLORS.primary};\n          border-radius: ${this.LAYOUT.borderRadius};\n          padding: 25px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          display: flex;\n          align-items: center;\n          gap: 20px;\n          transition: all 0.3s ease;\n        }\n\n        .analysis-card:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 15px rgba(0,0,0,0.15);\n        }\n\n        .analysis-icon {\n          width: 60px;\n          height: 60px;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 28px;\n          flex-shrink: 0;\n        }\n\n        .analysis-content {\n          flex: 1;\n        }\n\n        .analysis-content h3 {\n          font-size: ${this.TYPOGRAPHY.sizes.h4};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 15px 0;\n        }\n\n        .analysis-stats {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n          gap: 10px;\n        }\n\n        .stat {\n          display: flex;\n          flex-direction: column;\n          gap: 5px;\n        }\n\n        .stat-label {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          color: ${this.COLORS.text.muted};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n        }\n\n        .stat-value {\n          font-size: ${this.TYPOGRAPHY.sizes.h5};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.primary};\n        }\n\n        /* Inventory Specific Styles */\n        .inventory-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));\n          gap: 20px;\n          margin: 20px 0;\n        }\n\n        .inventory-card {\n          background: ${this.COLORS.white};\n          border: 1px solid ${this.COLORS.border};\n          border-radius: ${this.LAYOUT.borderRadius};\n          padding: 20px;\n          box-shadow: ${this.LAYOUT.shadows.card};\n          transition: all 0.3s ease;\n          break-inside: avoid;\n          page-break-inside: avoid;\n        }\n\n        .inventory-card:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 6px 25px rgba(0,0,0,0.12);\n        }\n\n        .inventory-header {\n          display: flex;\n          align-items: center;\n          gap: 15px;\n          margin-bottom: 15px;\n          padding-bottom: 15px;\n          border-bottom: 1px solid ${this.COLORS.border};\n        }\n\n        .inventory-avatar {\n          width: 50px;\n          height: 50px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, ${this.COLORS.primary}, ${this.COLORS.secondary});\n          color: ${this.COLORS.white};\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 20px;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          text-transform: uppercase;\n          flex-shrink: 0;\n        }\n\n        .inventory-info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .inventory-name {\n          font-size: ${this.TYPOGRAPHY.sizes.h5};\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          color: ${this.COLORS.text.primary};\n          margin: 0 0 5px 0;\n          line-height: 1.3;\n          word-wrap: break-word;\n        }\n\n        .inventory-category {\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          color: ${this.COLORS.text.muted};\n          background: ${this.COLORS.light};\n          padding: 4px 8px;\n          border-radius: 12px;\n          display: inline-block;\n        }\n\n        .inventory-details {\n          display: grid;\n          gap: 10px;\n        }\n\n        .status-warning {\n          color: #f59e0b !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .status-success {\n          color: #10b981 !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .status-danger {\n          color: #ef4444 !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .status-info {\n          color: #3b82f6 !important;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        /* Alert Level Styles */\n        .alert-level {\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n          text-align: center;\n        }\n\n        .status-badge {\n          padding: 4px 8px;\n          border-radius: 12px;\n          font-size: ${this.TYPOGRAPHY.sizes.small};\n          font-weight: ${this.TYPOGRAPHY.weights.medium};\n          text-align: center;\n          display: inline-block;\n        }\n\n        .status-badge.critical {\n          background: #fef2f2;\n          color: #dc2626;\n          border: 1px solid #fecaca;\n        }\n\n        .status-badge.warning {\n          background: #fffbeb;\n          color: #d97706;\n          border: 1px solid #fed7aa;\n        }\n\n        .status-badge.safe {\n          background: #f0fdf4;\n          color: #16a34a;\n          border: 1px solid #bbf7d0;\n        }\n\n        /* Expiry Status Styles */\n        .days-cell.expired {\n          color: #dc2626;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .days-cell.expiring {\n          color: #d97706;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .days-cell.safe {\n          color: #16a34a;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .quantity-cell.critical {\n          color: #dc2626;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .quantity-cell.warning {\n          color: #d97706;\n          font-weight: ${this.TYPOGRAPHY.weights.bold};\n        }\n\n        .progress-fill.critical {\n          background: linear-gradient(90deg, #dc2626, #ef4444);\n        }\n\n        .progress-fill.warning {\n          background: linear-gradient(90deg, #d97706, #f59e0b);\n        }\n\n        /* Print Optimizations - حماية قوية جداً من انقطاع الجداول */\n        @media print {\n          * {\n            -webkit-print-color-adjust: exact !important;\n            color-adjust: exact !important;\n            print-color-adjust: exact !important;\n          }\n\n          body {\n            margin: 0;\n            padding: 20px;\n            background: white !important;\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          .enhanced-header {\n            background: ${this.COLORS.primary} !important;\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n          }\n\n          .summary-card {\n            break-inside: avoid;\n            page-break-inside: avoid;\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .summary-card::before {\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n          }\n\n          .section {\n            break-inside: avoid;\n            page-break-inside: avoid;\n            border: 1px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .inventory-card {\n            break-inside: avoid;\n            page-break-inside: avoid;\n            border: 1px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .data-table {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            display: table !important;\n            width: 100% !important;\n            table-layout: fixed !important;\n            border-collapse: collapse !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n            margin: 0 !important;\n            position: relative !important;\n          }\n\n          .data-table thead {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-after: avoid !important;\n            display: table-header-group !important;\n          }\n\n          .data-table tbody {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            display: table-row-group !important;\n          }\n\n          .data-table tr {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            display: table-row !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* حماية إضافية للجداول */\n          .data-table td, .data-table th {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* حماية شاملة للأقسام */\n          .section-title {\n            break-inside: avoid !important;\n            page-break-inside: avoid !important;\n            page-break-after: avoid !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* منع الانقطاع للعناصر المحمية */\n          .no-break {\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n            page-break-before: auto !important;\n            page-break-after: auto !important;\n            display: block !important;\n            overflow: visible !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n            position: relative !important;\n          }\n\n          /* حماية إضافية للجداول الصغيرة */\n          .data-table.small-table {\n            min-height: 200px !important;\n            max-height: 400px !important;\n          }\n\n          /* منع انقطاع الصفوف */\n          .data-table tr.no-break {\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            display: table-row !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n          }\n\n          /* حماية خاصة للخلايا */\n          .data-table td.no-break,\n          .data-table th.no-break {\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n            page-break-before: avoid !important;\n            page-break-after: avoid !important;\n            orphans: 10 !important;\n            widows: 10 !important;\n            white-space: nowrap !important;\n            overflow: hidden !important;\n            text-overflow: ellipsis !important;\n          }\n\n          .data-table th {\n            background: ${this.COLORS.primary} !important;\n            color: white !important;\n            border: 2px solid ${this.COLORS.border} !important;\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n          }\n\n          .data-table td {\n            border: 1px solid ${this.COLORS.border} !important;\n            page-break-inside: avoid !important;\n            break-inside: avoid !important;\n          }\n\n          .progress-fill {\n            -webkit-print-color-adjust: exact;\n            color-adjust: exact;\n            border: 1px solid ${this.COLORS.text.primary} !important;\n          }\n\n          .patient-card {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .appointment-card {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          .analysis-card {\n            border: 2px solid ${this.COLORS.border} !important;\n            box-shadow: none !important;\n          }\n\n          table {\n            break-inside: auto;\n          }\n\n          tr {\n            break-inside: avoid;\n            break-after: auto;\n          }\n\n          .page-break {\n            page-break-before: always !important;\n            break-before: page !important;\n          }\n        }\n      </style>\n    `}static generatePDFFileName(e){const t=new Date,n=`${t.getDate().toString().padStart(2,"0")}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getFullYear()}`,a=t.toTimeString().split(" ")[0].replace(/:/g,"-");return`${{patients:"تقرير_المرضى",appointments:"تقرير_المواعيد",financial:"التقرير_المالي",inventory:"تقرير_المخزون",treatments:"تقرير_العلاجات",comprehensive:"التقرير_الشامل"}[e]||`تقرير_${e}`}_${n}_${a}.pdf`}static async exportPatientReport(e,t){try{const n=this.createEnhancedPatientReportHTML(e,t),a=this.generatePDFFileName("patients");await this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting patient report:",n),new Error("فشل في تصدير تقرير المرضى")}}static async exportAppointmentReport(e,t){try{const n=vh.createEnhancedAppointmentReportHTML(e,t),a=this.generatePDFFileName("appointments");await this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting appointment report:",n),new Error("فشل في تصدير تقرير المواعيد")}}static async exportFinancialReport(e,t){try{const n=vh.createEnhancedFinancialReportHTML(e,t),a=this.generatePDFFileName("financial");await this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting financial report:",n),new Error("فشل في تصدير التقرير المالي")}}static async exportInventoryReport(e,t){try{const n=vh.createEnhancedInventoryReportHTML(e,t),a=this.generatePDFFileName("inventory");await this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting inventory report:",n),new Error("فشل في تصدير تقرير المخزون")}}static filterDataByDateRange(e,t,n){if(!t||!t.start||!t.end)return e;const a=new Date(t.start),s=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),r=new Date(t.end),i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);return e.filter(e=>{const t=e[n];if(!t)return!1;const a=new Date(t);let r;return r=t.includes("T")||t.includes(" ")?a:new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),r>=s&&r<=i})}static async exportProfitLossReport(e,t){try{const{reportData:n,payments:a,labOrders:s,clinicNeeds:r,inventoryItems:i,clinicExpenses:l,patients:o,appointments:c,filter:d,currency:m}=e,u=this.filterDataByDateRange(a,d,"payment_date"),p=this.filterDataByDateRange(s,d,"order_date"),h=this.filterDataByDateRange(r,d,"created_at"),x=this.filterDataByDateRange(c,d,"created_at"),g=this.filterDataByDateRange(i,d,"created_at"),f={reportData:n,payments:u,labOrders:p,clinicNeeds:h,inventoryItems:g,clinicExpenses:l?this.filterDataByDateRange(l,d,"payment_date"):[],patients:o,appointments:x,filter:d,currency:m},v=vh.createEnhancedProfitLossReportHTML(f,t),y=this.generatePDFFileName("profit-loss");await this.convertHTMLToPDF(v,y)}catch(n){throw console.error("Error exporting profit/loss report:",n),new Error("فشل في تصدير تقرير الأرباح والخسائر")}}static async exportComprehensivePendingInvoice(e){try{const t=this.createComprehensivePendingInvoiceHTML(e),n=this.generatePDFFileName(`pending-invoice-${e.patient.full_name}`);await this.convertHTMLToPDF(t,n)}catch(t){throw console.error("Error exporting comprehensive pending invoice:",t),new Error("فشل في تصدير فاتورة المدفوعات المعلقة")}}static createComprehensivePendingInvoiceHTML(e){const{patient:t,summary:n,settings:a,clinic_info:s}=e,r=e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return"غير محدد";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${n}/${a}/${t.getFullYear()}`}catch(t){return"غير محدد"}},i=e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return"غير محدد";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear();return`${n}/${a}/${s} - ${t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`}catch(t){return"غير محدد"}},l=e=>{try{if(s?.currency){const t={USD:"$",EUR:"€",SYP:"ل.س",TRY:"₺",SAR:"ر.س"}[s.currency]||s.currency;return`${e.toLocaleString("ar-SA")} ${t}`}return`${e.toLocaleString("ar-SA")} ل.س`}catch(t){return`${e} ل.س`}};return`\n    <!DOCTYPE html>\n    <html dir="rtl" lang="ar">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>فاتورة المدفوعات المعلقة - ${t.full_name}</title>\n      <style>\n        * {\n          margin: 0;\n          padding: 0;\n          box-sizing: border-box;\n        }\n\n        body {\n          font-family: 'Arial', 'Tahoma', sans-serif;\n          direction: rtl;\n          background: white;\n          color: #333;\n          line-height: 1.6;\n          font-size: 14px;\n        }\n\n        .invoice-container {\n          max-width: 800px;\n          margin: 0 auto;\n          padding: 20px;\n          background: white;\n        }\n\n        .header {\n          text-align: center;\n          margin-bottom: 30px;\n          border-bottom: 3px solid #2563eb;\n          padding-bottom: 20px;\n        }\n\n        .header h1 {\n          color: #2563eb;\n          font-size: 28px;\n          margin-bottom: 10px;\n          font-weight: bold;\n        }\n\n        .header .invoice-info {\n          display: flex;\n          justify-content: space-between;\n          margin-top: 15px;\n          font-size: 12px;\n          color: #666;\n        }\n\n        .info-section {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 20px;\n          margin-bottom: 30px;\n        }\n\n        .info-card {\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 15px;\n          background: #f9fafb;\n        }\n\n        .info-card h3 {\n          color: #2563eb;\n          font-size: 16px;\n          margin-bottom: 10px;\n          border-bottom: 1px solid #e5e7eb;\n          padding-bottom: 5px;\n        }\n\n        .info-card p {\n          margin: 5px 0;\n          font-size: 13px;\n        }\n\n        .items-section {\n          margin-bottom: 30px;\n        }\n\n        .items-header {\n          background: #2563eb;\n          color: white;\n          padding: 15px;\n          border-radius: 8px 8px 0 0;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n\n        .items-header h3 {\n          font-size: 18px;\n        }\n\n        .items-badge {\n          background: rgba(255, 255, 255, 0.2);\n          padding: 4px 12px;\n          border-radius: 20px;\n          font-size: 12px;\n        }\n\n        .items-list {\n          border: 1px solid #e5e7eb;\n          border-top: none;\n          border-radius: 0 0 8px 8px;\n        }\n\n        .item-row {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 15px;\n          border-bottom: 1px solid #e5e7eb;\n          transition: background-color 0.2s;\n        }\n\n        .item-row:last-child {\n          border-bottom: none;\n        }\n\n        .item-row:hover {\n          background: #f9fafb;\n        }\n\n        .item-details {\n          flex: 1;\n        }\n\n        .item-title {\n          font-weight: bold;\n          color: #1f2937;\n          margin-bottom: 5px;\n        }\n\n        .item-meta {\n          font-size: 11px;\n          color: #6b7280;\n          display: flex;\n          gap: 15px;\n          flex-wrap: wrap;\n        }\n\n        .item-amount {\n          text-align: left;\n          font-weight: bold;\n          font-size: 16px;\n          color: #059669;\n        }\n\n        .summary-section {\n          background: #f9fafb;\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          padding: 20px;\n          margin-bottom: 30px;\n        }\n\n        .summary-title {\n          color: #2563eb;\n          font-size: 18px;\n          margin-bottom: 15px;\n          text-align: center;\n          border-bottom: 1px solid #e5e7eb;\n          padding-bottom: 10px;\n        }\n\n        .summary-row {\n          display: flex;\n          justify-content: space-between;\n          margin: 10px 0;\n          padding: 5px 0;\n        }\n\n        .summary-row.discount {\n          color: #dc2626;\n        }\n\n        .summary-row.tax {\n          color: #2563eb;\n        }\n\n        .summary-row.total {\n          border-top: 2px solid #2563eb;\n          padding-top: 15px;\n          margin-top: 15px;\n          font-size: 20px;\n          font-weight: bold;\n          color: #2563eb;\n        }\n\n        .footer {\n          text-align: center;\n          margin-top: 40px;\n          padding-top: 20px;\n          border-top: 1px solid #e5e7eb;\n          color: #6b7280;\n          font-size: 12px;\n        }\n\n        .date-range {\n          background: #eff6ff;\n          border: 1px solid #bfdbfe;\n          border-radius: 6px;\n          padding: 10px;\n          margin-bottom: 20px;\n          text-align: center;\n          font-size: 12px;\n          color: #1e40af;\n        }\n\n        @media print {\n          body {\n            margin: 0;\n            padding: 0;\n          }\n\n          .invoice-container {\n            max-width: none;\n            margin: 0;\n            padding: 15px;\n          }\n\n          .item-row:hover {\n            background: transparent;\n          }\n        }\n      </style>\n    </head>\n    <body>\n      <div class="invoice-container">\n        \x3c!-- رأس الفاتورة --\x3e\n        <div class="header">\n          <h1>فاتورة المدفوعات المعلقة الشاملة</h1>\n          <div class="invoice-info">\n            <div>رقم الفاتورة: ${e.invoice_number}</div>\n            <div>تاريخ الإصدار: ${r(e.invoice_date)}</div>\n            <div>وقت الإنشاء: ${i(e.generated_at)}</div>\n          </div>\n        </div>\n\n        \x3c!-- نطاق التاريخ --\x3e\n        <div class="date-range">\n          <strong>فترة الفاتورة:</strong> من ${r(n.date_range.from)} إلى ${r(n.date_range.to)}\n        </div>\n\n        \x3c!-- معلومات المريض والعيادة --\x3e\n        <div class="info-section">\n          <div class="info-card">\n            <h3>معلومات المريض</h3>\n            <p><strong>الاسم الكامل:</strong> ${t.full_name}</p>\n            <p><strong>رقم الهاتف:</strong> ${t.phone||"غير محدد"}</p>\n            ${t.email?`<p><strong>البريد الإلكتروني:</strong> ${t.email}</p>`:""}\n            ${t.address?`<p><strong>العنوان:</strong> ${t.address}</p>`:""}\n            <p><strong>تاريخ الميلاد:</strong> ${t.date_of_birth?r(t.date_of_birth):"غير محدد"}</p>\n          </div>\n\n          <div class="info-card">\n            <h3>معلومات العيادة</h3>\n            <p><strong>اسم العيادة:</strong> ${s.clinic_name||"عيادة الأسنان"}</p>\n            ${s.clinic_phone?`<p><strong>هاتف العيادة:</strong> ${s.clinic_phone}</p>`:""}\n            ${s.clinic_address?`<p><strong>عنوان العيادة:</strong> ${s.clinic_address}</p>`:""}\n            ${s.clinic_email?`<p><strong>إيميل العيادة:</strong> ${s.clinic_email}</p>`:""}\n          </div>\n        </div>\n\n        \x3c!-- تفاصيل المدفوعات المعلقة --\x3e\n        <div class="items-section">\n          <div class="items-header">\n            <h3>تفاصيل المدفوعات المعلقة</h3>\n            <div class="items-badge">${n.total_items} عنصر</div>\n          </div>\n\n          <div class="items-list">\n            ${n.items.map((e,t)=>`\n              <div class="item-row">\n                <div class="item-details">\n                  <div class="item-title">\n                    ${t+1}. ${e.appointment_title||e.treatment_type||e.description||"عنصر غير محدد"}\n                  </div>\n                  <div class="item-meta">\n                    ${e.appointment_date?`<span>📅 ${r(e.appointment_date)}</span>`:""}\n                    ${e.tooth_name?`<span>🦷 ${e.tooth_name} (${e.tooth_number})</span>`:""}\n                    ${e.treatment_type?`<span>🔧 ${e.treatment_type}</span>`:""}\n                    ${e.notes?`<span>📝 ${e.notes}</span>`:""}\n                  </div>\n                </div>\n                <div class="item-amount">\n                  ${l(e.amount)}\n                  ${e.discount_amount&&e.discount_amount>0?`<div style="font-size: 11px; color: #dc2626;">خصم: ${l(e.discount_amount)}</div>`:""}\n                </div>\n              </div>\n            `).join("")}\n          </div>\n        </div>\n\n        \x3c!-- ملخص المبالغ --\x3e\n        <div class="summary-section">\n          <h3 class="summary-title">ملخص المبالغ</h3>\n\n          <div class="summary-row">\n            <span>المجموع الفرعي:</span>\n            <span>${l(n.subtotal)}</span>\n          </div>\n\n          ${n.total_discount>0?`\n            <div class="summary-row discount">\n              <span>الخصم (${"percentage"===a.discount_type?`${a.discount_value}%`:"مبلغ ثابت"}):</span>\n              <span>-${l(n.total_discount)}</span>\n            </div>\n            ${a.discount_reason?`\n              <div style="font-size: 11px; color: #6b7280; text-align: center; margin: 5px 0;">\n                سبب الخصم: ${a.discount_reason}\n              </div>\n            `:""}\n          `:""}\n\n          ${n.total_tax>0?`\n            <div class="summary-row tax">\n              <span>الضريبة (${a.tax_rate}%):</span>\n              <span>+${l(n.total_tax)}</span>\n            </div>\n          `:""}\n\n          <div class="summary-row total">\n            <span>المجموع النهائي:</span>\n            <span>${l(n.final_total)}</span>\n          </div>\n        </div>\n\n        \x3c!-- شروط الدفع --\x3e\n        ${a.include_payment_terms&&a.payment_terms_text?`\n          <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 6px; padding: 15px; margin-bottom: 20px;">\n            <h4 style="color: #92400e; margin-bottom: 8px;">شروط الدفع:</h4>\n            <p style="color: #92400e; font-size: 13px;">${a.payment_terms_text}</p>\n          </div>\n        `:""}\n\n        \x3c!-- الملاحظات --\x3e\n        ${a.footer_notes?`\n          <div class="footer">\n            <p>${a.footer_notes}</p>\n          </div>\n        `:""}\n\n        \x3c!-- معلومات إضافية --\x3e\n        <div class="footer">\n          <p>تم إنشاء هذه الفاتورة إلكترونياً في ${i(e.generated_at)}</p>\n          <p>للاستفسارات، يرجى التواصل مع العيادة</p>\n        </div>\n      </div>\n    </body>\n    </html>\n    `}static async exportComprehensiveReport(e,t,n,a){try{const s=this.createComprehensiveReportHTML(e,t,n,a),r=this.generatePDFFileName("comprehensive");await this.convertHTMLToPDF(s,r)}catch(s){throw console.error("Error exporting comprehensive report:",s),new Error("فشل في تصدير التقرير الشامل")}}static async exportComprehensiveFinancialReport(e,t){try{const n=this.createComprehensiveFinancialReportHTML(e,t),a=this.generatePDFFileName("comprehensive_financial");await this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting comprehensive financial report:",n),new Error("فشل في تصدير التقرير المالي الشامل")}}static createEnhancedPatientReportHTML(e,t){const n=this.createEnhancedHeader("تقرير المرضى",t,"تقرير شامل عن إحصائيات المرضى والتوزيعات"),a=this.createEnhancedStyles();return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المرضى - ${t?.clinic_name||"عيادة الأسنان"}</title>\n        ${a}\n      </head>\n      <body>\n        ${n}\n\n        \x3c!-- Summary Cards with Enhanced Design --\x3e\n        <div class="summary-cards">\n          <div class="summary-card primary">\n            <div class="card-icon">👥</div>\n            <div class="card-content">\n              <h3>إجمالي المرضى</h3>\n              <div class="number">${e.totalPatients.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card success">\n            <div class="card-icon">✨</div>\n            <div class="card-content">\n              <h3>المرضى الجدد</h3>\n              <div class="number">${(e.newPatients||0).toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card info">\n            <div class="card-icon">💚</div>\n            <div class="card-content">\n              <h3>المرضى النشطون</h3>\n              <div class="number">${e.activePatients.toLocaleString()}</div>\n            </div>\n          </div>\n          <div class="summary-card warning">\n            <div class="card-icon">⏸️</div>\n            <div class="card-content">\n              <h3>المرضى غير النشطين</h3>\n              <div class="number">${(e.totalPatients-e.activePatients).toLocaleString()}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Patient List Section --\x3e\n        ${e.patientsList&&e.patientsList.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📋</span>\n            قائمة المرضى\n          </div>\n          <div class="section-content">\n            <div class="patients-grid">\n              ${e.patientsList.slice(0,50).map((e,t)=>`\n                <div class="patient-card">\n                  <div class="patient-header">\n                    <div class="patient-avatar">\n                      ${(e.full_name||e.first_name||"م").charAt(0)}\n                    </div>\n                    <div class="patient-info">\n                      <h4 class="patient-name">${e.full_name||`${e.first_name||""} ${e.last_name||""}`.trim()}</h4>\n                      <span class="patient-serial">#${e.serial_number||(t+1).toString().padStart(3,"0")}</span>\n                    </div>\n                  </div>\n                  <div class="patient-details">\n                    <div class="detail-item">\n                      <span class="detail-label">الجنس:</span>\n                      <span class="detail-value">${"male"===e.gender?"ذكر":"female"===e.gender?"أنثى":"غير محدد"}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">العمر:</span>\n                      <span class="detail-value">${e.age||"غير محدد"} سنة</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">الهاتف:</span>\n                      <span class="detail-value">${e.phone||"غير محدد"}</span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">الحالة:</span>\n                      <span class="detail-value status-active">${e.patient_condition||"نشط"}</span>\n                    </div>\n                  </div>\n                </div>\n              `).join("")}\n            </div>\n            ${e.patientsList.length>50?`\n            <div class="pagination-info">\n              <p>عرض أول 50 مريض من إجمالي ${e.patientsList.length.toLocaleString()} مريض</p>\n            </div>\n            `:""}\n          </div>\n        </div>\n        `:""}\n\n        \x3c!-- Age Distribution --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📊</span>\n            توزيع الأعمار\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الفئة العمرية</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.ageDistribution?.map(t=>{const n=e.totalPatients>0?(t.count/e.totalPatients*100).toFixed(1):"0.0",a=Math.max(5,parseFloat(n));return`\n                      <tr>\n                        <td class="category-cell">${t.ageGroup}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="percentage-cell">${n}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")||'<tr><td colspan="4" class="no-data">لا توجد بيانات</td></tr>'}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Page Break Before Gender Distribution --\x3e\n        <div class="page-break"></div>\n\n        \x3c!-- Gender Distribution Page Header --\x3e\n        <div class="page-header">\n          <h2 class="page-title">📊 تحليل توزيع الجنس</h2>\n          <p class="page-subtitle">تقرير تفصيلي عن توزيع المرضى حسب الجنس</p>\n        </div>\n\n        \x3c!-- Gender Distribution --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">👥</span>\n            توزيع الجنس\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الجنس</th>\n                    <th>العدد</th>\n                    <th>النسبة المئوية</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.genderDistribution?.map(t=>{const n=e.totalPatients>0?(t.count/e.totalPatients*100).toFixed(1):"0.0",a=Math.max(5,parseFloat(n));return`\n                      <tr>\n                        <td class="category-cell">${"ذكر"===t.gender?"👨":"أنثى"===t.gender?"👩":"👤"} ${t.gender}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="percentage-cell">${n}%</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill gender-${"ذكر"===t.gender?"male":"female"}" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")||'<tr><td colspan="4" class="no-data">لا توجد بيانات</td></tr>'}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Gender Analysis Summary --\x3e\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📈</span>\n            تحليل إحصائي لتوزيع الجنس\n          </div>\n          <div class="section-content">\n            <div class="analysis-cards">\n              ${e.genderDistribution?.map(t=>{const n=e.totalPatients>0?(t.count/e.totalPatients*100).toFixed(1):"0.0",a="ذكر"===t.gender?"👨":"أنثى"===t.gender?"👩":"👤",s="ذكر"===t.gender?"#1e40af":"أنثى"===t.gender?"#be185d":"#374151";return`\n                  <div class="analysis-card" style="border-left-color: ${s}; border-left-width: 6px;">\n                    <div class="analysis-icon" style="background: ${"ذكر"===t.gender?"#dbeafe":"أنثى"===t.gender?"#fce7f3":"#f3f4f6"}; color: ${s}; border: 2px solid ${s};">\n                      ${a}\n                    </div>\n                    <div class="analysis-content">\n                      <h3 style="color: ${s};">${t.gender}</h3>\n                      <div class="analysis-stats">\n                        <div class="stat">\n                          <span class="stat-label">العدد:</span>\n                          <span class="stat-value" style="color: ${s};">${t.count.toLocaleString()}</span>\n                        </div>\n                        <div class="stat">\n                          <span class="stat-label">النسبة:</span>\n                          <span class="stat-value" style="color: ${s};">${n}%</span>\n                        </div>\n                        <div class="stat">\n                          <span class="stat-label">من إجمالي:</span>\n                          <span class="stat-value">${e.totalPatients.toLocaleString()}</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                `}).join("")||'<p class="no-data">لا توجد بيانات للتحليل</p>'}\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Registration Trend --\x3e\n        ${e.registrationTrend&&e.registrationTrend.length>0?`\n        <div class="section">\n          <div class="section-title">\n            <span class="section-icon">📈</span>\n            اتجاه التسجيل الشهري\n          </div>\n          <div class="section-content">\n            <div class="chart-container">\n              <table class="data-table">\n                <thead>\n                  <tr>\n                    <th>الشهر</th>\n                    <th>عدد المرضى الجدد</th>\n                    <th>المؤشر البصري</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${e.registrationTrend.map(t=>{const n=Math.max(...e.registrationTrend.map(e=>e.count)),a=n>0?Math.max(5,t.count/n*100):5;return`\n                      <tr>\n                        <td class="category-cell">${t.period}</td>\n                        <td class="number-cell">${t.count.toLocaleString()}</td>\n                        <td class="chart-cell">\n                          <div class="progress-bar">\n                            <div class="progress-fill trend" style="width: ${a}%"></div>\n                          </div>\n                        </td>\n                      </tr>\n                    `}).join("")}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n        `:""}\n\n        <div class="report-footer">\n          <div class="footer-content">\n            <div class="footer-left">\n              <p class="footer-title">تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة</p>\n              <p class="generated-info">تاريخ الإنشاء: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()} | ${t?.clinic_name||"عيادة الأسنان"}</p>\n            </div>\n            <div class="footer-right">\n              <div class="footer-stats">\n                <span class="stat-item">📊 ${e.totalPatients.toLocaleString()} مريض</span>\n                <span class="stat-item">✨ ${(e.newPatients||0).toLocaleString()} جديد</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </body>\n      </html>\n    `}static createPatientReportHTML(e){return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المرضى</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 150px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 16px; color: #1e293b; }\n          .summary-card .number { font-size: 24px; font-weight: bold; color: #0ea5e9; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">تقرير المرضى</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>إجمالي المرضى</h3>\n            <div class="number">${e.totalPatients}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المرضى الجدد</h3>\n            <div class="number">${e.newPatients||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المرضى النشطون</h3>\n            <div class="number">${e.activePatients}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المرضى غير النشطين</h3>\n            <div class="number">${e.totalPatients-e.activePatients||0}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">توزيع الأعمار</div>\n          <table>\n            <thead>\n              <tr>\n                <th>الفئة العمرية</th>\n                <th>العدد</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.ageDistribution?.map(e=>`\n                <tr>\n                  <td>${e.ageGroup}</td>\n                  <td>${e.count}</td>\n                </tr>\n              `).join("")||'<tr><td colspan="2">لا توجد بيانات</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n\n        <div class="section">\n          <div class="section-title">توزيع الجنس</div>\n          <table>\n            <thead>\n              <tr>\n                <th>الجنس</th>\n                <th>العدد</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.genderDistribution?.map(e=>`\n                <tr>\n                  <td>${"male"===e.gender?"ذكر":"أنثى"}</td>\n                  <td>${e.count}</td>\n                </tr>\n              `).join("")||'<tr><td colspan="2">لا توجد بيانات</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static createAppointmentReportHTML(e){return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المواعيد</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 120px; margin: 5px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #1e293b; }\n          .summary-card .number { font-size: 20px; font-weight: bold; color: #0ea5e9; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">تقرير المواعيد</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>إجمالي المواعيد</h3>\n            <div class="number">${e.totalAppointments}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المكتملة</h3>\n            <div class="number">${e.completedAppointments}</div>\n          </div>\n          <div class="summary-card">\n            <h3>الملغية</h3>\n            <div class="number">${e.cancelledAppointments}</div>\n          </div>\n          <div class="summary-card">\n            <h3>عدم الحضور</h3>\n            <div class="number">${e.noShowAppointments||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>معدل الحضور</h3>\n            <div class="number">${e.attendanceRate?.toFixed(1)||0}%</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">توزيع المواعيد حسب الحالة</div>\n          <table>\n            <thead>\n              <tr>\n                <th>الحالة</th>\n                <th>العدد</th>\n                <th>النسبة المئوية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.appointmentsByStatus?.map(e=>`\n                <tr>\n                  <td>${this.translateStatus(e.status)}</td>\n                  <td>${e.count}</td>\n                  <td>${e.percentage?.toFixed(1)||0}%</td>\n                </tr>\n              `).join("")||'<tr><td colspan="3">لا توجد بيانات</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static createFinancialReportHTML(e){return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>التقرير المالي</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 150px; margin: 5px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #1e293b; }\n          .summary-card .number { font-size: 18px; font-weight: bold; color: #0ea5e9; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">التقرير المالي</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>إجمالي الإيرادات</h3>\n            <div class="number">$${e.totalRevenue?.toLocaleString()||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المدفوعات المكتملة</h3>\n            <div class="number">$${e.totalRevenue?.toLocaleString()||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المدفوعات المعلقة</h3>\n            <div class="number">$${e.pendingPayments?.toLocaleString()||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>المدفوعات المتأخرة</h3>\n            <div class="number">$${e.overduePayments?.toLocaleString()||0}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">إحصائيات طرق الدفع</div>\n          <table>\n            <thead>\n              <tr>\n                <th>طريقة الدفع</th>\n                <th>المبلغ</th>\n                <th>عدد المعاملات</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.paymentMethodStats?.map(e=>`\n                <tr>\n                  <td>${this.translatePaymentMethod(e.method)}</td>\n                  <td>${e.amount?.toLocaleString()||0} $</td>\n                  <td>${e.count||0}</td>\n                </tr>\n              `).join("")||'<tr><td colspan="3">لا توجد بيانات</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static createInventoryReportHTML(e){return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>تقرير المخزون</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-cards { display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; }\n          .summary-card { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; min-width: 150px; margin: 5px; }\n          .summary-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #1e293b; }\n          .summary-card .number { font-size: 18px; font-weight: bold; color: #0ea5e9; }\n          .warning { color: #f59e0b !important; }\n          .danger { color: #ef4444 !important; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">تقرير المخزون</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-cards">\n          <div class="summary-card">\n            <h3>إجمالي الأصناف</h3>\n            <div class="number">${e.totalItems}</div>\n          </div>\n          <div class="summary-card">\n            <h3>القيمة الإجمالية</h3>\n            <div class="number">${e.totalValue?.toLocaleString()||0} $</div>\n          </div>\n          <div class="summary-card">\n            <h3>أصناف منخفضة المخزون</h3>\n            <div class="number warning">${e.lowStockItems||0}</div>\n          </div>\n          <div class="summary-card">\n            <h3>أصناف منتهية الصلاحية</h3>\n            <div class="number danger">${e.expiredItems||0}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">توزيع الأصناف حسب الفئة</div>\n          <table>\n            <thead>\n              <tr>\n                <th>الفئة</th>\n                <th>عدد الأصناف</th>\n                <th>القيمة</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.itemsByCategory?.map(e=>`\n                <tr>\n                  <td>${e.category}</td>\n                  <td>${e.count}</td>\n                  <td>${e.value?.toLocaleString()||0} $</td>\n                </tr>\n              `).join("")||'<tr><td colspan="3">لا توجد بيانات</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n\n        ${e.stockAlerts&&e.stockAlerts.length>0?`\n        <div class="section">\n          <div class="section-title">تنبيهات المخزون</div>\n          <table>\n            <thead>\n              <tr>\n                <th>الصنف</th>\n                <th>الكمية الحالية</th>\n                <th>الحالة</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.stockAlerts.slice(0,10).map(e=>`\n                <tr>\n                  <td>${e.name}</td>\n                  <td>${e.quantity}</td>\n                  <td class="${0===e.quantity?"danger":"warning"}">\n                    ${0===e.quantity?"نفد المخزون":"مخزون منخفض"}\n                  </td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n      </body>\n      </html>\n    `}static createComprehensiveReportHTML(e,t,n,a){return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>التقرير الشامل</title>\n        <style>\n          body { font-family: 'Tajawal', Arial, sans-serif; direction: rtl; margin: 20px; }\n          .header { text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 20px; margin-bottom: 30px; }\n          .clinic-name { font-size: 24px; font-weight: bold; color: #0ea5e9; margin-bottom: 10px; }\n          .report-title { font-size: 20px; font-weight: bold; color: #1e293b; margin-bottom: 5px; }\n          .report-date { font-size: 14px; color: #64748b; }\n          .summary-section { display: flex; justify-content: space-between; margin: 30px 0; flex-wrap: wrap; }\n          .summary-group { background: #f8fafc; padding: 20px; border-radius: 8px; min-width: 200px; margin: 10px; }\n          .summary-group h3 { margin: 0 0 15px 0; font-size: 16px; color: #0ea5e9; text-align: center; }\n          .summary-item { margin: 8px 0; font-size: 14px; }\n          .section { margin: 30px 0; }\n          .section-title { font-size: 18px; font-weight: bold; color: #0ea5e9; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { padding: 12px; text-align: center; border: 1px solid #e2e8f0; }\n          th { background: #f8fafc; font-weight: bold; color: #1e293b; }\n          @media print { body { margin: 0; } }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">عيادة الأسنان الحديثة</div>\n          <div class="report-title">التقرير الشامل</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()}</div>\n        </div>\n\n        <div class="summary-section">\n          <div class="summary-group">\n            <h3>المرضى</h3>\n            <div class="summary-item">إجمالي: ${e.totalPatients}</div>\n            <div class="summary-item">جدد: ${e.newPatients||0}</div>\n            <div class="summary-item">نشطون: ${e.activePatients}</div>\n          </div>\n          <div class="summary-group">\n            <h3>المواعيد</h3>\n            <div class="summary-item">إجمالي: ${t.totalAppointments}</div>\n            <div class="summary-item">مكتملة: ${t.completedAppointments}</div>\n            <div class="summary-item">معدل الحضور: ${t.attendanceRate?.toFixed(1)||0}%</div>\n          </div>\n          <div class="summary-group">\n            <h3>الإيرادات</h3>\n            <div class="summary-item">إجمالي: ${n.totalRevenue?.toLocaleString()||0} $</div>\n            <div class="summary-item">مكتملة: ${n.totalRevenue?.toLocaleString()||0} $</div>\n          </div>\n          <div class="summary-group">\n            <h3>المخزون</h3>\n            <div class="summary-item">إجمالي الأصناف: ${a.totalItems}</div>\n            <div class="summary-item">القيمة: ${a.totalValue?.toLocaleString()||0} $</div>\n            <div class="summary-item">تنبيهات: ${(a.lowStockItems||0)+(a.expiredItems||0)}</div>\n          </div>\n        </div>\n\n        <div class="section">\n          <div class="section-title">مؤشرات الأداء الرئيسية</div>\n          <table>\n            <thead>\n              <tr>\n                <th>المؤشر</th>\n                <th>القيمة</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td>معدل نمو المرضى</td>\n                <td>${((e.newPatients||0)/e.totalPatients*100).toFixed(1)}%</td>\n              </tr>\n              <tr>\n                <td>معدل حضور المواعيد</td>\n                <td>${t.attendanceRate?.toFixed(1)||0}%</td>\n              </tr>\n              <tr>\n                <td>معدل الإلغاء</td>\n                <td>${t.cancellationRate?.toFixed(1)||0}%</td>\n              </tr>\n              <tr>\n                <td>متوسط الإيراد لكل مريض</td>\n                <td>${(()=>{try{const{getCurrencyConfig:t,formatCurrencyWithConfig:a,getDefaultCurrency:s}=require("@/lib/utils"),r=t(s());return a((n.totalRevenue||0)/e.totalPatients,r)}catch(t){return`$${((n.totalRevenue||0)/e.totalPatients).toLocaleString()}`}})()}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </body>\n      </html>\n    `}static async convertHTMLToPDF(e,t){try{const n=document.createElement("div");n.innerHTML=e,n.style.position="absolute",n.style.left="-9999px",n.style.top="-9999px",n.style.width="800px",n.style.fontFamily="Arial, sans-serif",n.style.direction="rtl",n.style.fontSize="14px",n.style.lineHeight="1.6",n.style.color="#000",n.style.background="#fff",n.style.padding="20px",document.body.appendChild(n),await new Promise(e=>setTimeout(e,100));const a=await rt(n,{scale:1.5,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:800,height:n.scrollHeight,scrollX:0,scrollY:0});document.body.removeChild(n);const s=a.toDataURL("image/jpeg",2),r=new it({orientation:"portrait",unit:"mm",format:"a4"}),i=r.internal.pageSize.getWidth(),l=r.internal.pageSize.getHeight(),o=i-20,c=a.height*o/a.width;let d=c,m=10;for(r.addImage(s,"PNG",10,m,o,c),d-=l-20;d>=0;)m=d-c+10,r.addPage(),r.addImage(s,"PNG",10,m,o,c),d-=l-20;r.save(t)}catch(n){throw console.error("Error converting HTML to PDF:",n),new Error("فشل في تحويل التقرير إلى PDF")}}static async exportTreatmentReport(e,t){try{const n=vh.createEnhancedTreatmentReportHTML(e,t),a=this.generatePDFFileName("treatments");await this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting treatment report:",n),new Error("فشل في تصدير تقرير العلاجات")}}static async exportIndividualPatientRecord(e,t){try{const n=this.createIndividualPatientRecordHTML(e,t),a=(new Date).toLocaleDateString("en-GB").replace(/\//g,"-"),s=`${e.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;await this.convertHTMLToPDF(n,s)}catch(n){throw console.error("Error exporting individual patient record:",n),new Error("فشل في تصدير سجل المريض")}}static async exportPatientPayments(e,t){try{const n=this.createPatientPaymentsHTML(e,t),a=(new Date).toLocaleDateString("en-GB").replace(/\//g,"-"),s=`مدفوعات_${e.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;await this.convertHTMLToPDF(n,s)}catch(n){throw console.error("Error exporting patient payments:",n),new Error("فشل في تصدير مدفوعات المريض")}}static async exportPatientTreatments(e,t){try{const n=this.createPatientTreatmentsHTML(e,t),a=(new Date).toLocaleDateString("en-GB").replace(/\//g,"-"),s=`علاجات_${e.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;await this.convertHTMLToPDF(n,s)}catch(n){throw console.error("Error exporting patient treatments:",n),new Error("فشل في تصدير علاجات المريض")}}static async exportPatientAppointments(e,t){try{const n=this.createPatientAppointmentsHTML(e,t),a=(new Date).toLocaleDateString("en-GB").replace(/\//g,"-"),s=`مواعيد_${e.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;await this.convertHTMLToPDF(n,s)}catch(n){throw console.error("Error exporting patient appointments:",n),new Error("فشل في تصدير مواعيد المريض")}}static async exportPatientPrescriptions(e,t){try{const n=this.createPatientPrescriptionsHTML(e,t),a=(new Date).toLocaleDateString("en-GB").replace(/\//g,"-"),s=`وصفات_${e.patient.full_name.replace(/\s+/g,"_")}_${a}.pdf`;await this.convertHTMLToPDF(n,s)}catch(n){throw console.error("Error exporting patient prescriptions:",n),new Error("فشل في تصدير وصفات المريض")}}static createPatientRecordHTMLForPrint(e,t){return this.createIndividualPatientRecordHTML(e,t)}static createIndividualPatientRecordHTML(e,t){const{patient:n,appointments:a,treatments:s,payments:r,prescriptions:i,labOrders:l,stats:o}=e,c=e=>e?new Date(e).toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",d=e=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR"}).format(e||0),m=(e,t,n,a=!1,s="")=>`\n        <div style="page-break-before: auto; page-break-inside: avoid !important; break-inside: avoid !important; display: block; margin-bottom: 30px;">\n          <div class="section-title" style="page-break-after: avoid !important; break-after: avoid !important; margin-bottom: 10px;">${e}</div>\n          <div style="page-break-inside: avoid !important; break-inside: avoid !important; display: block; overflow: visible;">\n            <table class="data-table" style="page-break-inside: avoid !important; break-inside: avoid !important; width: 100%; table-layout: fixed; border-collapse: collapse; margin: 0;">\n              <thead style="page-break-inside: avoid !important; break-inside: avoid !important; page-break-after: avoid !important;">\n                <tr>\n                  ${t.map(e=>`<th>${e}</th>`).join("")}\n                </tr>\n              </thead>\n              <tbody style="page-break-inside: avoid !important; break-inside: avoid !important;">\n                ${n.join("")}\n                ${a&&s?s:""}\n              </tbody>\n            </table>\n          </div>\n        </div>`;let u=0,p=0;const h=[],x=[];r?.forEach(e=>{e.appointment_id||(e.tooth_treatment_id?h.push(e):x.push(e)),p+=e.amount||0}),a?.forEach(e=>{e.cost&&(u+=e.cost)}),s?.forEach(e=>{e.cost&&(u+=e.cost)}),x.forEach(e=>{const t=e.treatment_cost||e.total_amount||e.amount||0;u+=t});const g=Math.max(0,u-p);let f=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>${n.full_name} - ${c((new Date).toISOString())}</title>\n        <style>\n          * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n          }\n          body {\n            font-family: 'Arial', sans-serif;\n            line-height: 1.6;\n            color: #000;\n            background: #fff;\n            padding: 20px;\n            direction: rtl;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #000;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-name {\n            font-size: 24px;\n            font-weight: bold;\n            margin-bottom: 10px;\n          }\n          .report-title {\n            font-size: 20px;\n            margin-bottom: 5px;\n          }\n          .report-date {\n            font-size: 14px;\n            color: #666;\n          }\n          .patient-info {\n            border: 2px solid #000;\n            padding: 20px;\n            margin-bottom: 30px;\n          }\n          .patient-name {\n            font-size: 22px;\n            font-weight: bold;\n            text-align: center;\n            margin-bottom: 20px;\n            border-bottom: 1px solid #000;\n            padding-bottom: 10px;\n          }\n          .info-row {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 10px;\n            padding: 5px 0;\n            border-bottom: 1px dotted #ccc;\n          }\n          .info-label {\n            font-weight: bold;\n            width: 30%;\n          }\n          .info-value {\n            width: 65%;\n          }\n          .section-title {\n            font-size: 18px;\n            font-weight: bold;\n            margin: 30px 0 15px 0;\n            padding: 10px;\n            border: 2px solid #000;\n            text-align: center;\n            background: #f5f5f5;\n            page-break-after: avoid;\n            break-after: avoid;\n          }\n          .data-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 20px;\n            border: 2px solid #000;\n            page-break-inside: avoid;\n            break-inside: avoid;\n          }\n          .data-table th {\n            background: #f0f0f0;\n            border: 1px solid #000;\n            padding: 10px;\n            text-align: center;\n            font-weight: bold;\n          }\n          .data-table td {\n            border: 1px solid #000;\n            padding: 8px;\n            text-align: center;\n            page-break-inside: avoid;\n            break-inside: avoid;\n          }\n          .data-table tr {\n            page-break-inside: avoid;\n            break-inside: avoid;\n          }\n          .data-table tr:nth-child(even) {\n            background: #f9f9f9;\n          }\n          .financial-summary {\n            border: 2px solid #000;\n            padding: 20px;\n            margin: 20px 0;\n            page-break-before: always;\n            page-break-inside: avoid;\n          }\n          .financial-title {\n            font-size: 18px;\n            font-weight: bold;\n            text-align: center;\n            margin-bottom: 15px;\n            border-bottom: 1px solid #000;\n            padding-bottom: 10px;\n          }\n          .financial-row {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 10px;\n            padding: 5px 0;\n            border-bottom: 1px dotted #ccc;\n          }\n          .financial-label {\n            font-weight: bold;\n          }\n          .financial-amount {\n            font-weight: bold;\n          }\n          .no-data {\n            text-align: center;\n            color: #666;\n            font-style: italic;\n            padding: 20px;\n            border: 1px solid #ccc;\n            margin: 20px 0;\n          }\n          .footer {\n            margin-top: 40px;\n            text-align: center;\n            font-size: 12px;\n            color: #666;\n            border-top: 1px solid #ccc;\n            padding-top: 20px;\n          }\n\n          @media print {\n  .data-table {\n    page-break-inside: avoid;\n    break-inside: avoid;\n    display: table;\n    width: 100%;\n  }\n\n  .data-table thead {\n    display: table-header-group;\n  }\n\n  .data-table tbody {\n    display: table-row-group;\n  }\n\n  .data-table tr {\n    page-break-inside: avoid;\n    break-inside: avoid;\n  }\n\n  .data-table td,\n  .data-table th {\n    page-break-inside: avoid;\n    break-inside: avoid;\n  }\n\n  .section-title {\n    page-break-before: always;\n    break-before: always;\n  }\n}\n\n        </style>\n      </head>\n      <body>\n        \x3c!-- رأس التقرير --\x3e\n        <div class="header">\n          ${t?.clinic_logo&&""!==t.clinic_logo.trim()?`\n            <div style="text-align: center; margin-bottom: 15px;">\n              <img src="${t.clinic_logo}" alt="شعار العيادة" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid #000; object-fit: cover;" />\n            </div>\n          `:""}\n          <div class="clinic-name">${t?.clinic_name||"عيادة الأسنان"}</div>\n          ${t?.doctor_name?`<div style="font-size: 16px; margin-bottom: 10px;">د. ${t.doctor_name}</div>`:""}\n          <div class="report-title">سجل المريض الطبي</div>\n          <div class="report-date">تاريخ التقرير: ${c((new Date).toISOString())}</div>\n        </div>\n\n        \x3c!-- معلومات المريض الأساسية --\x3e\n        <div class="patient-info">\n          <div class="patient-name">${n.full_name}</div>\n          <div class="info-row">\n            <span class="info-label">العمر:</span>\n            <span class="info-value">${n.age} سنة</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">الجنس:</span>\n            <span class="info-value">${"male"===n.gender?"ذكر":"أنثى"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">رقم الهاتف:</span>\n            <span class="info-value">${n.phone||"غير محدد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">البريد الإلكتروني:</span>\n            <span class="info-value">${n.email||"غير محدد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">العنوان:</span>\n            <span class="info-value">${n.address||"غير محدد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">حالة المريض:</span>\n            <span class="info-value">${n.patient_condition||"غير محدد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">الحساسية:</span>\n            <span class="info-value">${n.allergies||"لا توجد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">الحالات المرضية:</span>\n            <span class="info-value">${n.medical_conditions||"لا توجد"}</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">تاريخ التسجيل:</span>\n            <span class="info-value">${c(n.date_added)}</span>\n          </div>\n        </div>`;if(f+=`\n      \x3c!-- الملخص المالي --\x3e\n      <div class="financial-summary">\n        <div class="header" style="margin-bottom: 30px;">\n          <div class="clinic-name">${t?.clinic_name||"عيادة الأسنان"}</div>\n          <div class="report-title">الملخص المالي للمريض</div>\n          <div class="report-date">${n.full_name} - ${c((new Date).toISOString())}</div>\n        </div>\n\n        <div class="financial-title">تفاصيل الحساب المالي</div>\n        <div class="financial-row">\n          <span class="financial-label">إجمالي التكاليف:</span>\n          <span class="financial-amount">${d(u)}</span>\n        </div>\n        <div class="financial-row">\n          <span class="financial-label">إجمالي المدفوع:</span>\n          <span class="financial-amount">${d(p)}</span>\n        </div>\n        <div class="financial-row">\n          <span class="financial-label">المبلغ المتبقي:</span>\n          <span class="financial-amount">${d(g)}</span>\n        </div>\n\n        <div style="margin-top: 30px; padding: 15px; background: #f5f5f5; border-radius: 5px;">\n          <div style="font-weight: bold; margin-bottom: 10px;">ملاحظات مالية:</div>\n          <div style="font-size: 14px; line-height: 1.6;">\n            ${g>0?`• يوجد مبلغ متبقي قدره ${d(g)} يجب تحصيله`:"• تم سداد جميع المستحقات المالية بالكامل"}\n            <br>• تاريخ آخر تحديث: ${c((new Date).toISOString())}\n            <br>• عدد المدفوعات المسجلة: ${r?r.length:0}\n          </div>\n        </div>\n      </div>`,a&&a.length>0){const e=`سجل المواعيد (${a.length})`,t=["التاريخ","الوقت","نوع الموعد","الحالة","الملاحظات"],n=a.map(e=>{const t="completed"===e.status?"مكتمل":"scheduled"===e.status?"مجدول":"cancelled"===e.status?"ملغي":"معلق";return`\n          <tr>\n            <td>${c(e.start_time)}</td>\n            <td>${n=e.start_time,n?new Date(n).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):"غير محدد"}</td>\n            <td>${e.appointment_type||"عام"}</td>\n            <td>${t}</td>\n            <td>${e.notes||"-"}</td>\n          </tr>`;var n});f+=m(e,t,n)}else f+='\n        <div class="section-title">سجل المواعيد</div>\n        <div class="no-data">لا توجد مواعيد مسجلة لهذا المريض</div>';if(s&&s.length>0){const e=`سجل العلاجات (${s.length})`,t=["رقم السن","نوع العلاج","التكلفة","الحالة","التاريخ","المدفوعات المرتبطة","الملاحظات"],n=s.map(e=>{const t="completed"===e.treatment_status?"مكتمل":"in_progress"===e.treatment_status?"قيد التنفيذ":"مخطط",n=Fa(e.treatment_name||e.treatment_type||""),a=h.filter(t=>t.tooth_treatment_id===e.id).reduce((e,t)=>e+(t.amount||0),0);return`\n          <tr>\n            <td>${e.tooth_number||"-"}</td>\n            <td>${n}</td>\n            <td>${d(e.cost||0)}</td>\n            <td>${t}</td>\n            <td>${c(e.treatment_date||e.created_at)}</td>\n            <td>${d(a)}</td>\n            <td>${e.notes||"-"}</td>\n          </tr>`});f+=m(e,t,n)}else f+='\n        <div class="section-title">سجل العلاجات</div>\n        <div class="no-data">لا توجد علاجات مسجلة لهذا المريض</div>';if(r&&r.length>0){const e=`السجل المالي الشامل - جميع المدفوعات (${r.length})`,t=["التاريخ","المبلغ المدفوع","المبلغ الإجمالي","طريقة الدفع","النوع","الوصف","الملاحظات"],n=r.map(e=>{const t="cash"===e.payment_method?"نقدي":"card"===e.payment_method?"بطاقة":"bank_transfer"===e.payment_method?"تحويل بنكي":"أخرى";let n="عام",a=e.description||"-";const s={zirconia_post_core:"دعامة زيركونيا - قلب وتد",bone_graft:"ترقيع عظم",crown:"تاج",filling:"حشوة",root_canal:"علاج عصب",extraction:"خلع",cleaning:"تنظيف",implant:"زراعة",bridge:"جسر",veneer:"قشرة",orthodontics:"تقويم",whitening:"تبييض",scaling:"تنظيف الجير",polishing:"تلميع",consultation:"استشارة"};if(e.tooth_treatment_id){n="علاج أسنان";const t=e.treatment_name||e.description||"";a=s[t]||t||"علاج أسنان"}else if(e.appointment_id)n="موعد",a=e.appointment_title||e.description||"موعد";else{const t=e.description||"";a=s[t]||t||"دفعة عامة"}return`\n          <tr>\n            <td>${c(e.payment_date||e.created_at)}</td>\n            <td>${d(e.amount||e.total_amount)}</td>\n            <td>${d(e.treatment_cost||e.total_amount||e.amount)}</td>\n            <td>${t}</td>\n            <td>${n}</td>\n            <td>${a}</td>\n            <td>${e.notes||"-"}</td>\n          </tr>`}),a=r.reduce((e,t)=>e+(t.amount||t.total_amount||0),0),s=r.reduce((e,t)=>e+(t.treatment_cost||t.total_amount||t.amount||0),0),i=`\n        <tr style="background-color: #f8f9fa; font-weight: bold; border-top: 2px solid #dee2e6;">\n          <td style="text-align: right; padding: 12px;">المجموع:</td>\n          <td style="padding: 12px; color: #28a745;">${d(a)}</td>\n          <td style="padding: 12px; color: #007bff;">${d(s)}</td>\n          <td colspan="4"></td>\n        </tr>`;f+=m(e,t,n,!0,i)}else f+='\n        <div class="section-title">سجل المدفوعات</div>\n        <div class="no-data">لا توجد مدفوعات مسجلة لهذا المريض</div>';if(i&&i.length>0){const e=`الوصفات الطبية (${i.length})`,t=["التاريخ","اسم الدواء","الجرعة","التكرار","المدة","تعليمات الاستخدام","الملاحظات"],n=[];i.forEach(e=>{e.medications&&e.medications.length>0?e.medications.forEach((t,a)=>{n.push(`\n              <tr>\n                <td>${c(e.prescription_date||e.created_at)}</td>\n                <td>${t.medication_name||t.name||"-"}</td>\n                <td>${t.dosage||"-"}</td>\n                <td>${t.frequency||"-"}</td>\n                <td>${t.duration||"-"}</td>\n                <td>${t.medication_instructions||t.instructions||"-"}</td>\n                <td>${e.notes||"-"}</td>\n              </tr>`)}):n.push(`\n            <tr>\n              <td>${c(e.prescription_date||e.created_at)}</td>\n              <td>${e.medication_name||"-"}</td>\n              <td>${e.dosage||"-"}</td>\n              <td>${e.frequency||"-"}</td>\n              <td>${e.duration||"-"}</td>\n              <td>${e.instructions||"-"}</td>\n              <td>${e.notes||"-"}</td>\n            </tr>`)}),f+=m(e,t,n)}else f+='\n        <div class="section-title">الوصفات الطبية</div>\n        <div class="no-data">لا توجد وصفات طبية مسجلة لهذا المريض</div>';return l&&l.length>0?(f+=`\n        <div style="page-break-before: auto; page-break-inside: avoid; break-inside: avoid;">\n          <div class="section-title">طلبات المختبر (${l.length})</div>\n          <table class="data-table" style="page-break-inside: avoid !important; break-inside: avoid !important;">\n            <thead>\n              <tr>\n                <th>التاريخ</th>\n                <th>نوع الطلب</th>\n                <th>الحالة</th>\n                <th>التكلفة</th>\n                <th>الملاحظات</th>\n              </tr>\n            </thead>\n            <tbody>`,l.forEach(e=>{const t="completed"===e.status?"مكتمل":"in_progress"===e.status?"قيد التنفيذ":"معلق";f+=`\n            <tr>\n              <td>${c(e.order_date||e.created_at)}</td>\n              <td>${e.order_type||"-"}</td>\n              <td>${t}</td>\n              <td>${d(e.cost||0)}</td>\n              <td>${e.notes||"-"}</td>\n            </tr>`}),f+="\n            </tbody>\n          </table>\n        </div>"):f+='\n        <div class="section-title">طلبات المختبر</div>\n        <div class="no-data">لا توجد طلبات مختبر مسجلة لهذا المريض</div>',n.notes&&(f+=`\n        <div class="section-title">ملاحظات إضافية</div>\n        <div style="border: 1px solid #ccc; padding: 20px; margin: 20px 0;">\n          ${n.notes}\n        </div>`),f+=`\n        <div class="footer">\n          تم إنشاء هذا  التقرير في ${c((new Date).toISOString())} - ${t?.clinic_name||"عيادة الأسنان"}\n        </div>\n      </body>\n      </html>`,f}static async exportClinicNeedsReport(e,t){try{const n=this.createClinicNeedsReportHTML(e,t),a=this.generatePDFFileName("clinic-needs");await this.convertHTMLToPDF(n,a)}catch(n){throw console.error("Error exporting clinic needs report:",n),new Error("فشل في تصدير تقرير احتياجات العيادة")}}static createClinicNeedsReportHTML(e,t){const{title:n,currency:a,isDarkMode:s}=t,r=e=>{try{const{getCurrencyConfig:t,formatCurrencyWithConfig:n}=require("@/lib/utils");return n(e||0,t(a||"USD"))}catch(t){try{return new Intl.NumberFormat("en-US",{style:"currency",currency:a||"USD",minimumFractionDigits:2}).format(e||0)}catch(n){try{const{getCurrencyConfig:t,getDefaultCurrency:n}=require("@/lib/utils"),s=t(a||n()),r=(e||0).toFixed(s.decimals);return"before"===s.position?`${s.symbol}${r}`:`${r} ${s.symbol}`}catch(s){return`$${(e||0).toFixed(2)}`}}}},i=e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return"--";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${n}/${a}/${t.getFullYear()}`}catch(t){return"--"}},l=e=>(e=>e?{pending:"معلق",ordered:"مطلوب",received:"مستلم",cancelled:"ملغي"}[e]||e:"غير محدد")(e),o=e=>(e=>e?{urgent:"عاجل",high:"عالي",medium:"متوسط",low:"منخفض"}[e]||e:"غير محدد")(e);return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>${n}</title>\n        <style>\n          @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap');\n\n          * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n          }\n\n          body {\n            font-family: 'Noto Sans Arabic', Arial, sans-serif;\n            line-height: 1.6;\n            color: ${s?"#e5e7eb":"#1f2937"};\n            background-color: ${s?"#1f2937":"#ffffff"};\n            direction: rtl;\n            padding: 20px;\n          }\n\n          .header {\n            text-align: center;\n            margin-bottom: 30px;\n            border-bottom: 3px solid #3b82f6;\n            padding-bottom: 20px;\n          }\n\n          .header h1 {\n            color: #3b82f6;\n            font-size: 28px;\n            font-weight: 700;\n            margin-bottom: 10px;\n          }\n\n          .header p {\n            color: ${s?"#9ca3af":"#6b7280"};\n            font-size: 14px;\n          }\n\n          .stats-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 20px;\n            margin-bottom: 30px;\n          }\n\n          .stat-card {\n            background: ${s?"#374151":"#f8fafc"};\n            border: 1px solid ${s?"#4b5563":"#e2e8f0"};\n            border-radius: 8px;\n            padding: 20px;\n            text-align: center;\n          }\n\n          .stat-card h3 {\n            color: #3b82f6;\n            font-size: 14px;\n            font-weight: 600;\n            margin-bottom: 8px;\n          }\n\n          .stat-card .value {\n            font-size: 24px;\n            font-weight: 700;\n            color: ${s?"#e5e7eb":"#1f2937"};\n          }\n\n          .section {\n            margin-bottom: 30px;\n          }\n\n          .section h2 {\n            color: #3b82f6;\n            font-size: 20px;\n            font-weight: 600;\n            margin-bottom: 15px;\n            border-bottom: 2px solid #e2e8f0;\n            padding-bottom: 8px;\n          }\n\n          .table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 20px;\n            background: ${s?"#374151":"#ffffff"};\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n          }\n\n          .table th,\n          .table td {\n            padding: 12px;\n            text-align: right;\n            border-bottom: 1px solid ${s?"#4b5563":"#e2e8f0"};\n          }\n\n          .table th {\n            background: ${s?"#4b5563":"#f1f5f9"};\n            font-weight: 600;\n            color: ${s?"#e5e7eb":"#374151"};\n          }\n\n          .table tr:hover {\n            background: ${s?"#4b5563":"#f8fafc"};\n          }\n\n          .badge {\n            display: inline-block;\n            padding: 4px 8px;\n            border-radius: 4px;\n            font-size: 12px;\n            font-weight: 500;\n          }\n\n          .badge-pending { background: #fef3c7; color: #92400e; }\n          .badge-ordered { background: #dbeafe; color: #1e40af; }\n          .badge-received { background: #d1fae5; color: #065f46; }\n          .badge-cancelled { background: #fee2e2; color: #991b1b; }\n          .badge-urgent { background: #fee2e2; color: #991b1b; }\n          .badge-high { background: #fef3c7; color: #92400e; }\n          .badge-medium { background: #dbeafe; color: #1e40af; }\n          .badge-low { background: #d1fae5; color: #065f46; }\n\n          .footer {\n            margin-top: 40px;\n            text-align: center;\n            color: ${s?"#9ca3af":"#6b7280"};\n            font-size: 12px;\n            border-top: 1px solid ${s?"#4b5563":"#e2e8f0"};\n            padding-top: 20px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <h1>${n}</h1>\n          <p>تاريخ التقرير: ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()} | ${e.filterInfo||"جميع البيانات"}</p>\n        </div>\n\n        <div class="stats-grid">\n          <div class="stat-card">\n            <h3>إجمالي الاحتياجات</h3>\n            <div class="value">${e.totalNeeds||0}</div>\n          </div>\n          <div class="stat-card">\n            <h3>القيمة الإجمالية</h3>\n            <div class="value">${r(e.totalValue||0)}</div>\n          </div>\n          <div class="stat-card">\n            <h3>الاحتياجات المعلقة</h3>\n            <div class="value">${e.pendingCount||0}</div>\n          </div>\n          <div class="stat-card">\n            <h3>الاحتياجات العاجلة</h3>\n            <div class="value">${e.urgentCount||0}</div>\n          </div>\n          <div class="stat-card">\n            <h3>معدل الإنجاز</h3>\n            <div class="value">${(e.completionRate||0).toFixed(1)}%</div>\n          </div>\n          <div class="stat-card">\n            <h3>متوسط قيمة الاحتياج</h3>\n            <div class="value">${r(e.averageNeedValue||0)}</div>\n          </div>\n        </div>\n\n        ${e.needsByStatus&&e.needsByStatus.length>0?`\n        <div class="section">\n          <h2>توزيع الاحتياجات حسب الحالة</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>الحالة</th>\n                <th>العدد</th>\n                <th>النسبة المئوية</th>\n                <th>القيمة الإجمالية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.needsByStatus.map(e=>`\n                <tr>\n                  <td><span class="badge badge-${e.status}">${l(e.status)}</span></td>\n                  <td>${e.count}</td>\n                  <td>${e.percentage.toFixed(1)}%</td>\n                  <td>${r(e.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.needsByPriority&&e.needsByPriority.length>0?`\n        <div class="section">\n          <h2>توزيع الاحتياجات حسب الأولوية</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>الأولوية</th>\n                <th>العدد</th>\n                <th>النسبة المئوية</th>\n                <th>القيمة الإجمالية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.needsByPriority.map(e=>`\n                <tr>\n                  <td><span class="badge badge-${e.priority}">${o(e.priority)}</span></td>\n                  <td>${e.count}</td>\n                  <td>${e.percentage.toFixed(1)}%</td>\n                  <td>${r(e.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.topExpensiveNeeds&&e.topExpensiveNeeds.length>0?`\n        <div class="section">\n          <h2>الاحتياجات الأغلى سعراً (أعلى 10)</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>اسم الاحتياج</th>\n                <th>الكمية</th>\n                <th>القيمة الإجمالية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.topExpensiveNeeds.map(e=>`\n                <tr>\n                  <td>${e.need_name}</td>\n                  <td>${e.quantity}</td>\n                  <td>${r(e.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.needsByCategory&&e.needsByCategory.length>0?`\n        <div class="section">\n          <h2>توزيع الاحتياجات حسب الفئة</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>الفئة</th>\n                <th>العدد</th>\n                <th>القيمة الإجمالية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.needsByCategory.map(e=>`\n                <tr>\n                  <td>${e.category||"غير محدد"}</td>\n                  <td>${e.count}</td>\n                  <td>${r(e.value)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.urgentNeeds&&e.urgentNeeds.length>0?`\n        <div class="section">\n          <h2>الاحتياجات العاجلة</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>اسم الاحتياج</th>\n                <th>الحالة</th>\n                <th>الفئة</th>\n                <th>القيمة</th>\n                <th>تاريخ الإنشاء</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.urgentNeeds.slice(0,10).map(e=>`\n                <tr>\n                  <td>${e.need_name}</td>\n                  <td><span class="badge badge-${e.status}">${l(e.status)}</span></td>\n                  <td>${e.category||"غير محدد"}</td>\n                  <td>${r(e.price*e.quantity)}</td>\n                  <td>${i(e.created_at)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.pendingNeeds&&e.pendingNeeds.length>0?`\n        <div class="section">\n          <h2>الاحتياجات المعلقة</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>اسم الاحتياج</th>\n                <th>الفئة</th>\n                <th>الأولوية</th>\n                <th>القيمة</th>\n                <th>تاريخ الإنشاء</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.pendingNeeds.slice(0,10).map(e=>`\n                <tr>\n                  <td>${e.need_name}</td>\n                  <td>${e.category||"غير محدد"}</td>\n                  <td><span class="badge badge-${e.priority}">${o(e.priority)}</span></td>\n                  <td>${r(e.price*e.quantity)}</td>\n                  <td>${i(e.created_at)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        ${e.recentlyReceived&&e.recentlyReceived.length>0?`\n        <div class="section">\n          <h2>الاحتياجات المستلمة حديثاً</h2>\n          <table class="table">\n            <thead>\n              <tr>\n                <th>اسم الاحتياج</th>\n                <th>الفئة</th>\n                <th>المورد</th>\n                <th>القيمة</th>\n                <th>تاريخ الإنشاء</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.recentlyReceived.slice(0,10).map(e=>`\n                <tr>\n                  <td>${e.need_name}</td>\n                  <td>${e.category||"غير محدد"}</td>\n                  <td>${e.supplier||"غير محدد"}</td>\n                  <td>${r(e.price*e.quantity)}</td>\n                  <td>${i(e.created_at)}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة | ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</p>\n        </div>\n      </body>\n      </html>\n    `}static createComprehensiveFinancialReportHTML(e,t){const n=e=>{try{const{getCurrencyConfig:n,formatCurrencyWithConfig:a,getDefaultCurrency:s}=require("@/lib/utils");return a(e||0,n(t?.currency||s()))}catch(n){try{const{getCurrencyConfig:n,getDefaultCurrency:a}=require("@/lib/utils"),s=n(t?.currency||a()),r=e.toLocaleString("en-US",{minimumFractionDigits:s.decimals,maximumFractionDigits:s.decimals});return"before"===s.position?`${s.symbol}${r}`:`${r} ${s.symbol}`}catch(a){return`$${e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}}};return`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>التقرير المالي الشامل - ${t?.clinic_name||"عيادة الأسنان"}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-name {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-title {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .report-subtitle {\n            font-size: 16px;\n            color: #64748b;\n            margin-bottom: 10px;\n          }\n          .report-date {\n            font-size: 14px;\n            color: #64748b;\n          }\n          .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 20px;\n            margin: 30px 0;\n          }\n          .summary-card {\n            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n            padding: 20px;\n            border-radius: 12px;\n            text-align: center;\n            border: 1px solid #e2e8f0;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n          }\n          .summary-card h3 {\n            margin: 0 0 10px 0;\n            font-size: 14px;\n            color: #64748b;\n            font-weight: 600;\n          }\n          .summary-card .number {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          .profit { color: #10b981 !important; }\n          .loss { color: #ef4444 !important; }\n          .warning { color: #f59e0b !important; }\n          .section {\n            margin: 40px 0;\n            page-break-inside: avoid;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 20px;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .subsection-title {\n            font-size: 16px;\n            font-weight: bold;\n            color: #1e293b;\n            margin: 20px 0 10px 0;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          td {\n            font-size: 13px;\n          }\n          .profit-loss-section {\n            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\n            padding: 25px;\n            border-radius: 12px;\n            border: 1px solid #0ea5e9;\n            margin: 30px 0;\n          }\n          .two-column {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 30px;\n            margin: 20px 0;\n          }\n          .info-box {\n            background: #f8fafc;\n            padding: 15px;\n            border-radius: 8px;\n            border-left: 4px solid #0ea5e9;\n            margin: 15px 0;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n          @media print {\n            body { margin: 0; }\n            .section { page-break-inside: avoid; }\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-name">${t?.clinic_name||"عيادة الأسنان الحديثة"}</div>\n          <div class="report-title">التقرير المالي الشامل</div>\n          <div class="report-subtitle">تحليل شامل للأرباح والخسائر والإيرادات والمصروفات</div>\n          <div class="report-date">${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</div>\n          ${e.filterInfo?`<div class="info-box">${e.filterInfo}</div>`:""}\n        </div>\n\n        \x3c!-- الإحصائيات المالية الرئيسية --\x3e\n        <div class="section">\n          <div class="section-title">الإحصائيات المالية الرئيسية</div>\n          <div class="summary-grid">\n            <div class="summary-card">\n              <h3>إجمالي الإيرادات</h3>\n              <div class="number profit">${n(e.totalRevenue||0)}</div>\n            </div>\n            <div class="summary-card">\n              <h3>إجمالي المصروفات</h3>\n              <div class="number">${n(e.totalExpenses||0)}</div>\n            </div>\n            <div class="summary-card">\n              <h3>صافي ${e.isProfit?"الربح":"الخسارة"}</h3>\n              <div class="number ${e.isProfit?"profit":"loss"}">\n                ${n(e.isProfit?e.netProfit||0:e.lossAmount||0)}\n              </div>\n            </div>\n            <div class="summary-card">\n              <h3>هامش الربح</h3>\n              <div class="number ${e.profitMargin>=0?"profit":"loss"}">\n                ${(e.profitMargin||0).toFixed(2)}%\n              </div>\n            </div>\n            <div class="summary-card">\n              <h3>المبالغ المعلقة</h3>\n              <div class="number warning">${n(e.totalPending||0)}</div>\n            </div>\n            <div class="summary-card">\n              <h3>المبالغ المتبقية</h3>\n              <div class="number warning">${n(e.totalOverdue||0)}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- تحليل الأرباح والخسائر --\x3e\n        <div class="profit-loss-section">\n          <div class="section-title">تحليل الأرباح والخسائر التفصيلي</div>\n          <div class="two-column">\n            <div>\n              <div class="subsection-title">الإيرادات</div>\n              <table>\n                <tr><td>المدفوعات المكتملة</td><td>${n(e.totalPaid||0)}</td></tr>\n                <tr><td>المدفوعات الجزئية</td><td>${n((e.totalRevenue||0)-(e.totalPaid||0))}</td></tr>\n                <tr><td><strong>إجمالي الإيرادات</strong></td><td><strong>${n(e.totalRevenue||0)}</strong></td></tr>\n              </table>\n            </div>\n            <div>\n              <div class="subsection-title">المصروفات</div>\n              <table>\n                <tr><td>مصروفات العيادة المباشرة</td><td>${n(e.clinicExpensesTotal||0)}</td></tr>\n                <tr><td>مصروفات المخابر</td><td>${n(e.labOrdersTotal||0)}</td></tr>\n                <tr><td>مصروفات الاحتياجات</td><td>${n(e.clinicNeedsTotal||0)}</td></tr>\n                <tr><td>مصروفات المخزون</td><td>${n(e.inventoryExpenses||0)}</td></tr>\n                <tr><td><strong>إجمالي المصروفات</strong></td><td><strong>${n(e.totalExpenses||0)}</strong></td></tr>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- إحصائيات المعاملات --\x3e\n        <div class="section">\n          <div class="section-title">إحصائيات المعاملات</div>\n          <div class="summary-grid">\n            <div class="summary-card">\n              <h3>إجمالي المعاملات</h3>\n              <div class="number">${e.totalTransactions||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>المعاملات المكتملة</h3>\n              <div class="number profit">${e.completedPayments||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>المعاملات الجزئية</h3>\n              <div class="number warning">${e.partialPayments||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>المعاملات المعلقة</h3>\n              <div class="number">${e.pendingPayments||0}</div>\n            </div>\n            <div class="summary-card">\n              <h3>معدل النجاح</h3>\n              <div class="number profit">${e.successRate||"0.0"}%</div>\n            </div>\n            <div class="summary-card">\n              <h3>متوسط المعاملة</h3>\n              <div class="number">${n(parseFloat(e.averageTransaction||"0"))}</div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- توزيع طرق الدفع --\x3e\n        ${e.revenueByPaymentMethod&&e.revenueByPaymentMethod.length>0?`\n        <div class="section">\n          <div class="section-title">توزيع الإيرادات حسب طريقة الدفع</div>\n          <table>\n            <thead>\n              <tr>\n                <th>طريقة الدفع</th>\n                <th>المبلغ</th>\n                <th>النسبة المئوية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.revenueByPaymentMethod.map(e=>`\n                <tr>\n                  <td>${e.method}</td>\n                  <td>${n(e.amount)}</td>\n                  <td>${e.percentage.toFixed(2)}%</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        \x3c!-- توزيع المصروفات حسب النوع --\x3e\n        ${e.expensesByType&&e.expensesByType.length>0?`\n        <div class="section">\n          <div class="section-title">توزيع المصروفات حسب النوع</div>\n          <table>\n            <thead>\n              <tr>\n                <th>نوع المصروف</th>\n                <th>المبلغ</th>\n                <th>النسبة المئوية</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.expensesByType.map(e=>`\n                <tr>\n                  <td>${e.type}</td>\n                  <td>${n(e.amount)}</td>\n                  <td>${e.percentage.toFixed(2)}%</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        \x3c!-- تفاصيل المصروفات الحديثة --\x3e\n        ${e.expenses&&e.expenses.length>0?`\n        <div class="section">\n          <div class="section-title">المصروفات الحديثة (آخر 10 مصروفات)</div>\n          <table>\n            <thead>\n              <tr>\n                <th>اسم المصروف</th>\n                <th>النوع</th>\n                <th>المبلغ</th>\n                <th>طريقة الدفع</th>\n                <th>تاريخ الدفع</th>\n                <th>المورد</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.expenses.slice(0,10).map(e=>`\n                <tr>\n                  <td>${e.expense_name||"غير محدد"}</td>\n                  <td>${{salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"}[e.expense_type]||e.expense_type||"غير محدد"}</td>\n                  <td>${n(e.amount||0)}</td>\n                  <td>${{cash:"نقداً",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمان"}[e.payment_method]||e.payment_method||"غير محدد"}</td>\n                  <td>${e.payment_date?(()=>{try{return new Date(e.payment_date).toLocaleDateString("en-GB")}catch{return e.payment_date}})():"غير محدد"}</td>\n                  <td>${e.vendor||"غير محدد"}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </div>\n        `:""}\n\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة نظام إدارة العيادة | ${(()=>{const e=new Date;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()} - ${e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}`})()}</p>\n        </div>\n      </body>\n      </html>\n    `}static translateStatus(e){return Ra(e)}static translatePaymentMethod(e){return Oa(e)}static formatGregorianDate(e){if(!e||isNaN(e.getTime()))return"غير محدد";return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`}static createPatientPaymentsHTML(e,t){const{patient:n,payments:a}=e,s=t||{},r=e=>{if(s?.currency&&"SYP"!==s?.currency){const t={USD:"$",EUR:"€",SYP:"ل.س",TRY:"₺",SAR:"ر.س"}[s.currency]||s.currency;return`${e.toLocaleString("ar-SA")} ${t}`}return`${e.toLocaleString("ar-SA")} ل.س`},i=e=>{const t=new Date(e);if(!t||isNaN(t.getTime()))return"غير محدد";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`};let l=0;const o=[],c=[];a?.forEach(e=>{e.tooth_treatment_id?o.push(e):e.appointment_id&&c.push(e),l+=e.amount||0});let d=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>مدفوعات المريض - ${n.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${s?.clinic_name||"عيادة الأسنان الحديثة"}</h1>\n            ${s?.address?`<p>${s.address}</p>`:""}\n            ${s?.phone?`<p>الهاتف: ${s.phone}</p>`:""}\n            ${s?.email?`<p>البريد الإلكتروني: ${s.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>تقرير مدفوعات المريض</h2>\n            <p>تاريخ التقرير: ${i((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>معلومات المريض</h3>\n          <div class="info-grid">\n            <div><strong>الاسم:</strong> ${n.full_name}</div>\n            <div><strong>الجنس:</strong> ${"male"===n.gender?"ذكر":"أنثى"}</div>\n            <div><strong>العمر:</strong> ${n.age} سنة</div>\n            ${n.phone?`<div><strong>الهاتف:</strong> ${n.phone}</div>`:""}\n            ${n.email?`<div><strong>البريد الإلكتروني:</strong> ${n.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>الملخص المالي</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">إجمالي المدفوعات:</span>\n              <span class="value">${r(l)}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">عدد المدفوعات:</span>\n              <span class="value">${a?.length||0}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">مدفوعات العلاجات:</span>\n              <span class="value">${o.length}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">مدفوعات المواعيد:</span>\n              <span class="value">${c.length}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const e="سجل المدفوعات",t=["التاريخ","المبلغ","طريقة الدفع","النوع","الوصف","رقم الإيصال","الحالة"],n=a.map(e=>{const t=e.tooth_treatment_id?"علاج سني":e.appointment_id?"موعد":"دفعة عامة",n="completed"===e.status?"مكتمل":"partial"===e.status?"جزئي":"معلق",a="cash"===e.payment_method?"نقدي":"تحويل بنكي";return`\n          <tr>\n            <td>${i(e.payment_date)}</td>\n            <td>${r(e.amount)}</td>\n            <td>${a}</td>\n            <td>${t}</td>\n            <td>${e.description||"-"}</td>\n            <td>${e.receipt_number||"-"}</td>\n            <td>${n}</td>\n          </tr>`});d+=`\n        <div class="section-title">${e}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(e=>`<th>${e}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${n.join("")}\n          </tbody>\n        </table>`}else d+='\n        <div class="section-title">سجل المدفوعات</div>\n        <div class="no-data">لا توجد مدفوعات مسجلة لهذا المريض</div>';return d+=`\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة ${s?.clinic_name||"عيادة الأسنان الحديثة"}</p>\n          <p>تاريخ الطباعة: ${i((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,d}static createPatientTreatmentsHTML(e,t){const{patient:n,treatments:a}=e,s=t||{},r=e=>{if(s?.currency&&"SYP"!==s?.currency){const t={USD:"$",EUR:"€",SYP:"ل.س",TRY:"₺",SAR:"ر.س"}[s.currency]||s.currency;return`${e.toLocaleString("ar-SA")} ${t}`}return`${e.toLocaleString("ar-SA")} ل.س`},i=e=>{const t=new Date(e);if(!t||isNaN(t.getTime()))return"غير محدد";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`},l=a?.length||0,o=a?.filter(e=>"completed"===e.treatment_status).length||0,c=a?.filter(e=>"in_progress"===e.treatment_status).length||0,d=a?.filter(e=>"planned"===e.treatment_status).length||0,m=a?.reduce((e,t)=>e+(t.cost||0),0)||0;let u=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>علاجات المريض - ${n.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${s?.clinic_name||"عيادة الأسنان الحديثة"}</h1>\n            ${s?.address?`<p>${s.address}</p>`:""}\n            ${s?.phone?`<p>الهاتف: ${s.phone}</p>`:""}\n            ${s?.email?`<p>البريد الإلكتروني: ${s.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>تقرير علاجات المريض</h2>\n            <p>تاريخ التقرير: ${i((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>معلومات المريض</h3>\n          <div class="info-grid">\n            <div><strong>الاسم:</strong> ${n.full_name}</div>\n            <div><strong>الجنس:</strong> ${"male"===n.gender?"ذكر":"أنثى"}</div>\n            <div><strong>العمر:</strong> ${n.age} سنة</div>\n            ${n.phone?`<div><strong>الهاتف:</strong> ${n.phone}</div>`:""}\n            ${n.email?`<div><strong>البريد الإلكتروني:</strong> ${n.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>ملخص العلاجات</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">إجمالي العلاجات:</span>\n              <span class="value">${l}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">العلاجات المكتملة:</span>\n              <span class="value">${o}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">العلاجات قيد التنفيذ:</span>\n              <span class="value">${c}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">العلاجات المخططة:</span>\n              <span class="value">${d}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">إجمالي التكلفة:</span>\n              <span class="value">${r(m)}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const e="سجل العلاجات",t=["رقم السن","اسم السن","نوع العلاج","التكلفة","الحالة","تاريخ البدء","تاريخ الانتهاء","الملاحظات"],n=a.map(e=>{const t="completed"===e.treatment_status?"مكتمل":"in_progress"===e.treatment_status?"قيد التنفيذ":"planned"===e.treatment_status?"مخطط":"ملغي",n=Fa(e.treatment_type||"");return`\n          <tr>\n            <td>${e.tooth_number||"-"}</td>\n            <td>${e.tooth_name||"-"}</td>\n            <td>${n}</td>\n            <td>${r(e.cost||0)}</td>\n            <td>${t}</td>\n            <td>${e.start_date?i(e.start_date):"-"}</td>\n            <td>${e.completion_date?i(e.completion_date):"-"}</td>\n            <td>${e.notes||"-"}</td>\n          </tr>`});u+=`\n        <div class="section-title">${e}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(e=>`<th>${e}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${n.join("")}\n          </tbody>\n        </table>`}else u+='\n        <div class="section-title">سجل العلاجات</div>\n        <div class="no-data">لا توجد علاجات مسجلة لهذا المريض</div>';return u+=`\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة ${s?.clinic_name||"عيادة الأسنان الحديثة"}</p>\n          <p>تاريخ الطباعة: ${i((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,u}static createPatientAppointmentsHTML(e,t){const{patient:n,appointments:a}=e,s=t||{},r=e=>{if(!e)return"غير محدد";const t=new Date(e);if(!t||isNaN(t.getTime()))return"غير محدد";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`},i=e=>{if(!e)return"غير محدد";const t=new Date(e);return!t||isNaN(t.getTime())?"غير محدد":t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})},l=a?.length||0,o=a?.filter(e=>"completed"===e.status).length||0,c=a?.filter(e=>"cancelled"===e.status).length||0,d=a?.filter(e=>"scheduled"===e.status).length||0,m=a?.filter(e=>"no_show"===e.status).length||0;let u=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>مواعيد المريض - ${n.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${s?.clinic_name||"عيادة الأسنان الحديثة"}</h1>\n            ${s?.address?`<p>${s.address}</p>`:""}\n            ${s?.phone?`<p>الهاتف: ${s.phone}</p>`:""}\n            ${s?.email?`<p>البريد الإلكتروني: ${s.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>تقرير مواعيد المريض</h2>\n            <p>تاريخ التقرير: ${r((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>معلومات المريض</h3>\n          <div class="info-grid">\n            <div><strong>الاسم:</strong> ${n.full_name}</div>\n            <div><strong>الجنس:</strong> ${"male"===n.gender?"ذكر":"أنثى"}</div>\n            <div><strong>العمر:</strong> ${n.age} سنة</div>\n            ${n.phone?`<div><strong>الهاتف:</strong> ${n.phone}</div>`:""}\n            ${n.email?`<div><strong>البريد الإلكتروني:</strong> ${n.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>ملخص المواعيد</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">إجمالي المواعيد:</span>\n              <span class="value">${l}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">المواعيد المكتملة:</span>\n              <span class="value">${o}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">المواعيد المجدولة:</span>\n              <span class="value">${d}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">المواعيد الملغية:</span>\n              <span class="value">${c}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">لم يحضر:</span>\n              <span class="value">${m}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const e="سجل المواعيد",t=["التاريخ","الوقت","نوع الموعد","الحالة","الملاحظات"],n=a.map(e=>{const t="completed"===e.status?"مكتمل":"cancelled"===e.status?"ملغي":"scheduled"===e.status?"مجدول":"no_show"===e.status?"لم يحضر":"معلق",n=(e=>{if(!e)return{date:"غير محدد",time:"غير محدد"};const t=new Date(e);return!t||isNaN(t.getTime())?{date:"غير محدد",time:"غير محدد"}:{date:r(e),time:i(e)}})(e.start_time);return`\n          <tr>\n            <td>${n.date}</td>\n            <td>${n.time}</td>\n            <td>${e.title||e.appointment_type||"فحص عام"}</td>\n            <td>${t}</td>\n            <td>${e.notes||"-"}</td>\n          </tr>`});u+=`\n        <div class="section-title">${e}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(e=>`<th>${e}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${n.join("")}\n          </tbody>\n        </table>`}else u+='\n        <div class="section-title">سجل المواعيد</div>\n        <div class="no-data">لا توجد مواعيد مسجلة لهذا المريض</div>';return u+=`\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة ${s?.clinic_name||"عيادة الأسنان الحديثة"}</p>\n          <p>تاريخ الطباعة: ${r((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,u}static createPatientPrescriptionsHTML(e,t){const{patient:n,prescriptions:a}=e,s=t||{},r=e=>{const t=new Date(e);if(!t||isNaN(t.getTime()))return"غير محدد";return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`},i=a?.length||0,l=a?.reduce((e,t)=>e+(t.medications?.length||0),0)||0,o=a?.filter(e=>{const t=new Date(e.prescription_date),n=new Date;return n.setDate(n.getDate()-30),t>=n}).length||0;let c=`\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>وصفات المريض - ${n.full_name}</title>\n        <style>\n          body {\n            font-family: 'Tajawal', Arial, sans-serif;\n            direction: rtl;\n            margin: 20px;\n            line-height: 1.6;\n            color: #1e293b;\n          }\n          .header {\n            text-align: center;\n            border-bottom: 3px solid #0ea5e9;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n          }\n          .clinic-info h1 {\n            font-size: 28px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin-bottom: 10px;\n          }\n          .report-info h2 {\n            font-size: 24px;\n            font-weight: bold;\n            color: #1e293b;\n            margin-bottom: 5px;\n          }\n          .patient-info, .financial-summary {\n            margin: 30px 0;\n            padding: 20px;\n            background: #f8fafc;\n            border-radius: 8px;\n            border: 1px solid #e2e8f0;\n          }\n          .info-grid, .summary-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n          }\n          .summary-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px;\n            background: white;\n            border-radius: 6px;\n            border: 1px solid #e2e8f0;\n          }\n          .label {\n            font-weight: 600;\n            color: #64748b;\n          }\n          .value {\n            font-weight: bold;\n            color: #0ea5e9;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          }\n          th, td {\n            padding: 12px 15px;\n            text-align: center;\n            border-bottom: 1px solid #e2e8f0;\n          }\n          th {\n            background: #f8fafc;\n            font-weight: bold;\n            color: #1e293b;\n            font-size: 14px;\n          }\n          .section-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #0ea5e9;\n            margin: 30px 0 15px 0;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          .no-data {\n            text-align: center;\n            padding: 40px;\n            color: #64748b;\n            font-style: italic;\n          }\n          .footer {\n            text-align: center;\n            margin-top: 50px;\n            padding-top: 20px;\n            border-top: 1px solid #e2e8f0;\n            color: #64748b;\n            font-size: 12px;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="clinic-info">\n            <h1>${s?.clinic_name||"عيادة الأسنان الحديثة"}</h1>\n            ${s?.address?`<p>${s.address}</p>`:""}\n            ${s?.phone?`<p>الهاتف: ${s.phone}</p>`:""}\n            ${s?.email?`<p>البريد الإلكتروني: ${s.email}</p>`:""}\n          </div>\n          <div class="report-info">\n            <h2>تقرير وصفات المريض</h2>\n            <p>تاريخ التقرير: ${r((new Date).toISOString())}</p>\n          </div>\n        </div>\n\n        <div class="patient-info">\n          <h3>معلومات المريض</h3>\n          <div class="info-grid">\n            <div><strong>الاسم:</strong> ${n.full_name}</div>\n            <div><strong>الجنس:</strong> ${"male"===n.gender?"ذكر":"أنثى"}</div>\n            <div><strong>العمر:</strong> ${n.age} سنة</div>\n            ${n.phone?`<div><strong>الهاتف:</strong> ${n.phone}</div>`:""}\n            ${n.email?`<div><strong>البريد الإلكتروني:</strong> ${n.email}</div>`:""}\n          </div>\n        </div>\n\n        <div class="financial-summary">\n          <h3>ملخص الوصفات</h3>\n          <div class="summary-grid">\n            <div class="summary-item">\n              <span class="label">إجمالي الوصفات:</span>\n              <span class="value">${i}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">إجمالي الأدوية:</span>\n              <span class="value">${l}</span>\n            </div>\n            <div class="summary-item">\n              <span class="label">الوصفات الحديثة (30 يوم):</span>\n              <span class="value">${o}</span>\n            </div>\n          </div>\n        </div>`;if(a&&a.length>0){const e="سجل الوصفات",t=["تاريخ الوصفة","اسم الدواء","الجرعة","تعليمات الاستخدام","ملاحظات"],n=[];a.forEach(e=>{e.medications&&e.medications.length>0?e.medications.forEach(t=>{n.push(`\n              <tr>\n                <td>${r(e.prescription_date)}</td>\n                <td>${t.medication_name||t.name||"-"}</td>\n                <td>${t.dose||t.dosage||"-"}</td>\n                <td>${t.medication_instructions||t.instructions||"-"}</td>\n                <td>${e.notes||"-"}</td>\n              </tr>`)}):n.push(`\n            <tr>\n              <td>${r(e.prescription_date)}</td>\n              <td>-</td>\n              <td>-</td>\n              <td>-</td>\n              <td>${e.notes||"-"}</td>\n            </tr>`)}),c+=`\n        <div class="section-title">${e}</div>\n        <table>\n          <thead>\n            <tr>\n              ${t.map(e=>`<th>${e}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${n.join("")}\n          </tbody>\n        </table>`}else c+='\n        <div class="section-title">سجل الوصفات</div>\n        <div class="no-data">لا توجد وصفات مسجلة لهذا المريض</div>';return c+=`\n        <div class="footer">\n          <p>تم إنشاء هذا التقرير بواسطة ${s?.clinic_name||"عيادة الأسنان الحديثة"}</p>\n          <p>تاريخ الطباعة: ${r((new Date).toISOString())}</p>\n        </div>\n      </body>\n      </html>`,c}}function bh(){const{patientReports:t,isLoading:n,isExporting:a,generateReport:s,exportReport:r,currentFilter:i,setFilter:l,clearCache:o}=oh(),{currency:c,settings:d}=ta(),{toast:m}=Bl(),{isDarkMode:u}=sa(),{patients:p,loadPatients:h}=bt(),[x,g]=re.useState(""),[f,v]=re.useState("all"),[y,b]=re.useState("all");re.useEffect(()=>{s("patients"),h()},[s,h]),xh("patients");const j=({title:t,value:n,icon:a,color:s="blue",trend:r,description:i})=>e.jsxs(nc,{className:pc(s),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:t}),e.jsx(a,{className:`h-4 w-4 ${hc(s)}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:n}),r&&e.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(r.isPositive?"text-green-600":"text-red-600"),children:[e.jsxs("span",{className:"ml-1",children:[Math.abs(r.value),"%"]}),r.isPositive?e.jsx(ur,{className:"h-3 w-3"}):e.jsx(mr,{className:"h-3 w-3"})]}),i&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:i})]})]}),w=t?.patientsList?.filter(e=>{const t=`${e.first_name} ${e.last_name}`.toLowerCase().includes(x.toLowerCase())||e.phone?.includes(x)||e.email?.toLowerCase().includes(x.toLowerCase()),n="all"===f||(()=>{if(!e.date_of_birth)return"unknown"===f;const t=(new Date).getFullYear()-new Date(e.date_of_birth).getFullYear();switch(f){case"child":return t<18;case"adult":return t>=18&&t<60;case"senior":return t>=60;default:return!0}})();return t&&n&&"all"===y})||[];return n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(br,{className:"h-12 w-12 animate-pulse text-sky-600 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل تقارير المرضى..."})]})}):t?e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"تقارير المرضى"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إحصائيات وتحليلات شاملة للمرضى"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{try{o(),await s("patients"),m({title:"تم التحديث بنجاح",description:"تم تحديث تقارير المرضى بأحدث البيانات"})}catch(e){console.error("Error refreshing patient reports:",e),m({title:"خطأ في التحديث",description:"فشل في تحديث التقارير. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},disabled:n,children:[e.jsx(Js,{className:"w-4 h-4 ml-2 "+(n?"animate-spin":"")}),n?"جاري التحديث...":"تحديث"]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{if(p&&0!==p.length)try{await Zc.exportPatientsToExcel(p),m({title:"تم التصدير بنجاح",description:`تم تصدير تقرير المرضى كملف Excel مع التنسيق الجميل (${p.length} مريض)`})}catch(e){console.error("Error exporting Excel:",e),m({title:"خطأ في التصدير",description:"فشل في تصدير التقرير. يرجى المحاولة مرة أخرى.",variant:"destructive"})}else m({title:"لا توجد بيانات",description:"لا توجد بيانات مرضى للتصدير",variant:"destructive"})},disabled:a,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير اكسل"]}),e.jsxs(Lr,{variant:"default",size:"sm",onClick:async()=>{try{if(!p||0===p.length)return void m({title:"لا توجد بيانات",description:"لا توجد بيانات مرضى للتصدير",variant:"destructive"});const e=p.length,t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1),a=p.filter(e=>new Date(e.created_at)>=n).length,s={children:0,teens:0,adults:0,seniors:0},r={male:0,female:0};let i=0,l=0;p.forEach(e=>{if(e.age&&"number"==typeof e.age&&e.age>0){const t=e.age;i+=t,l++,t<13?s.children++:t<20?s.teens++:t<60?s.adults++:s.seniors++}"male"===e.gender?r.male++:"female"===e.gender&&r.female++});const o={totalPatients:e,newPatientsThisMonth:a,activePatients:e,averageAge:l>0?Math.round(i/l):0,patients:p,ageDistribution:[{ageGroup:"أطفال (0-12)",count:s.children},{ageGroup:"مراهقون (13-19)",count:s.teens},{ageGroup:"بالغون (20-59)",count:s.adults},{ageGroup:"كبار السن (60+)",count:s.seniors}],genderDistribution:[{gender:"ذكور",count:r.male},{gender:"إناث",count:r.female}],registrationTrend:[],filterInfo:"جميع المرضى المسجلين",dataCount:e};await yh.exportPatientReport(o,d),m({title:"تم التصدير بنجاح",description:`تم تصدير تقرير المرضى كملف PDF (${e} مريض)`})}catch(e){console.error("Error exporting PDF:",e),m({title:"خطأ في التصدير",description:"فشل في تصدير التقرير كملف PDF. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},disabled:a,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),a?"جاري التصدير...":"تصدير PDF"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[e.jsx(j,{title:"إجمالي المرضى",value:t?.totalPatients||0,icon:br,color:"blue",description:"العدد الكلي للمرضى المسجلين"}),e.jsx(j,{title:"المرضى الجدد",value:t?.newPatients||0,icon:gr,color:"green",description:"المرضى المسجلين حديثاً"}),e.jsx(j,{title:"المرضى النشطين",value:t?.activePatients||0,icon:xr,color:"emerald",description:"المرضى الذين لديهم مواعيد حديثة"}),e.jsx(j,{title:"المرضى غير النشطين",value:t?.inactivePatients||0,icon:vr,color:"red",description:"المرضى بدون مواعيد حديثة"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Gs,{className:"w-5 h-5"}),e.jsx("span",{children:"التوزيع العمري"})]}),e.jsxs(rc,{children:["توزيع المرضى حسب الفئات العمرية (",t.totalPatients," مريض إجمالي)"]})]}),e.jsxs(ic,{children:[(()=>{const n=fh(t.ageDistribution);Hn("categorical",u),Hn("primary",u);const a=Kn("demographics",u,n.length),s=Wn(u);return 0===n.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Gs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات توزيع عمري متاحة"})]})}):e.jsx(ue,{width:"100%",height:s.responsive.desktop.height,children:e.jsxs(pe,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(he,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:({ageGroup:e,count:t,percent:n})=>t>0?`${e}: ${t} (${(100*n).toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"count",stroke:u?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:n.map((t,n)=>e.jsx(xe,{fill:a[n%a.length]},`age-${n}`))}),e.jsx(ge,{formatter:(e,t)=>[`${e} مريض`,"العدد"],labelFormatter:e=>`الفئة العمرية: ${e}`,contentStyle:s.tooltip})]})})})(),(()=>{const n=fh(t.ageDistribution),a=Kn("demographics",u,n.length);return n.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:n.map((n,s)=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a[s%a.length]}}),e.jsxs("span",{className:"text-muted-foreground",children:[n.ageGroup,": ",n.count," (",Math.round(n.count/t.totalPatients*100),"%)"]})]},`age-legend-${s}`))})})()]})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Ka,{className:"w-5 h-5"}),e.jsx("span",{children:"التوزيع حسب الجنس"})]}),e.jsxs(rc,{children:["توزيع المرضى حسب الجنس (",t.totalPatients," مريض إجمالي)"]})]}),e.jsxs(ic,{children:[(()=>{const n=gh(t.genderDistribution),a=Kn("demographics",u,2),s=Hn("primary",u),r=Wn(u);return 0===n.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ka,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات توزيع جنس متاحة"})]})}):e.jsx(ue,{width:"100%",height:r.responsive.desktop.height,children:e.jsxs(fe,{data:n,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:r.bar.barCategoryGap,children:[e.jsx(ve,{strokeDasharray:r.grid.strokeDasharray,stroke:r.grid.stroke,strokeOpacity:r.grid.strokeOpacity}),e.jsx(ye,{dataKey:"gender",tick:{fontSize:14,fill:u?"#9ca3af":"#6b7280"},axisLine:{stroke:u?"#4b5563":"#d1d5db"},tickLine:{stroke:u?"#4b5563":"#d1d5db"}}),e.jsx(be,{tick:{fontSize:14,fill:u?"#9ca3af":"#6b7280"},axisLine:{stroke:u?"#4b5563":"#d1d5db"},tickLine:{stroke:u?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"],allowDecimals:!1,tickFormatter:e=>`${Math.round(e)} مريض`}),e.jsx(ge,{formatter:(e,t)=>[`${e} مريض`,"العدد"],labelFormatter:e=>`الجنس: ${e}`,contentStyle:r.tooltip}),e.jsx(je,{dataKey:"count",fill:s[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100,children:n.map((t,n)=>e.jsx(xe,{fill:a[n%a.length]},`cell-${n}`))})]})})})(),(()=>{const n=gh(t.genderDistribution);return n.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-4 text-sm",children:n.map((n,a)=>e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:n.gender}),e.jsxs("div",{className:"font-semibold",children:[n.count," مريض (",Math.round(n.count/t.totalPatients*100),"%)"]})]},`gender-summary-${a}`))})})()]})]})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ur,{className:"w-5 h-5"}),e.jsx("span",{children:"اتجاه التسجيل"})]}),e.jsxs(rc,{children:["عدد المرضى المسجلين شهرياً (",t.registrationTrend?.length||0," فترة)"]})]}),e.jsxs(ic,{children:[(()=>{const n=t.registrationTrend||[],a=Hn("primary",u);Kn("medical",u,1);const s=Wn(u);return 0===n.length?e.jsx("div",{className:"flex items-center justify-center h-96 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ur,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات اتجاه تسجيل متاحة"})]})}):e.jsx(ue,{width:"100%",height:s.responsive.large.height,children:e.jsxs(we,{data:n,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(ve,{strokeDasharray:s.grid.strokeDasharray,stroke:s.grid.stroke,strokeOpacity:s.grid.strokeOpacity}),e.jsx(ye,{dataKey:"period",tick:{fontSize:12,fill:u?"#9ca3af":"#6b7280"},axisLine:{stroke:u?"#4b5563":"#d1d5db"},tickLine:{stroke:u?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),e.jsx(be,{tick:{fontSize:12,fill:u?"#9ca3af":"#6b7280"},axisLine:{stroke:u?"#4b5563":"#d1d5db"},tickLine:{stroke:u?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"],tickFormatter:e=>`${e} مريض`}),e.jsx(ge,{formatter:(e,t)=>[`${e} مريض`,"عدد المسجلين"],labelFormatter:e=>`الفترة: ${e}`,contentStyle:s.tooltip}),e.jsx(Ne,{type:"monotone",dataKey:"count",stroke:a[0],fill:a[0],fillOpacity:.3,strokeWidth:3,connectNulls:!1})]})})})(),(()=>{const n=t.registrationTrend||[];return n.length>0&&e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"أعلى فترة"}),e.jsxs("div",{className:"font-semibold",children:[Math.max(...n.map(e=>e.count))," مريض"]})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"متوسط شهري"}),e.jsxs("div",{className:"font-semibold",children:[Math.round(n.reduce((e,t)=>e+t.count,0)/n.length)," مريض"]})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"إجمالي المسجلين"}),e.jsxs("div",{className:"font-semibold",children:[n.reduce((e,t)=>e+t.count,0)," مريض"]})]})]})})()]})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(br,{className:"w-5 h-5"}),e.jsx("span",{children:"قائمة المرضى"})]}),e.jsx(rc,{children:"قائمة تفصيلية بجميع المرضى"})]}),e.jsxs(ic,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",dir:"rtl",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Yr,{htmlFor:"search",children:"البحث"}),e.jsxs("div",{className:"relative",children:[e.jsx(tr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{id:"search",placeholder:"البحث بالاسم، الهاتف، أو البريد الإلكتروني...",value:x,onChange:e=>g(e.target.value),className:"pl-10",dir:"rtl"})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"age-filter",children:"الفئة العمرية"}),e.jsxs(Nl,{value:f,onValueChange:v,children:[e.jsx(Sl,{className:"w-40",dir:"rtl",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الأعمار"}),e.jsx(Al,{value:"child",children:"أطفال (أقل من 18)"}),e.jsx(Al,{value:"adult",children:"بالغين (18-59)"}),e.jsx(Al,{value:"senior",children:"كبار السن (60+)"}),e.jsx(Al,{value:"unknown",children:"غير محدد"})]})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"status-filter",children:"الحالة"}),e.jsxs(Nl,{value:y,onValueChange:b,children:[e.jsx(Sl,{className:"w-32",dir:"rtl",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"الكل"}),e.jsx(Al,{value:"active",children:"نشط"}),e.jsx(Al,{value:"inactive",children:"غير نشط"})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",dir:"rtl",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-center-all",dir:"rtl",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"#"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"الاسم"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"الهاتف"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"البريد الإلكتروني"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"تاريخ التسجيل"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"العمر"}),e.jsx("th",{className:"text-center p-3 font-medium arabic-enhanced",children:"الحالة"})]})}),e.jsx("tbody",{children:w.map((t,n)=>e.jsxs("tr",{className:"hover:bg-muted/50 "+(n%2==0?"bg-background":"bg-muted/30"),children:[e.jsx("td",{className:"p-3 font-medium text-center",children:n+1}),e.jsx("td",{className:"p-3 font-medium text-center table-cell-wrap-truncate-md",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:t.full_name?t.full_name.charAt(0):(t.first_name||"").charAt(0)}),e.jsx("span",{className:"arabic-enhanced",children:t.full_name||`${t.first_name||""} ${t.last_name||""}`.trim()})]})}),e.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced table-cell-wrap-truncate-sm",children:t.phone||"-"}),e.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced table-cell-wrap-truncate-lg",children:t.email||"-"}),e.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced",children:In(t.created_at)}),e.jsx("td",{className:"p-3 text-muted-foreground text-center arabic-enhanced",children:t.age||(t.date_of_birth?(new Date).getFullYear()-new Date(t.date_of_birth).getFullYear():"-")}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(oc,{variant:"secondary",className:"arabic-enhanced",children:"نشط"})})]},t.id))})]})}),0===w.length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(br,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد نتائج مطابقة للبحث"})]})]})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(br,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"لا توجد بيانات"}),e.jsx("p",{className:"text-muted-foreground",children:"لم يتم العثور على بيانات المرضى"})]})}function jh(){const{currency:t,settings:n}=ta(),{inventoryReports:a,isLoading:s,isExporting:r,generateReport:i,exportReport:l,clearCache:o}=oh(),{isDarkMode:c}=sa(),{items:d,loadItems:m}=ma(),[u,p]=re.useState(""),[h,x]=re.useState("all"),[g,f]=re.useState("all"),v=Tc({data:d,dateField:"created_at",initialFilter:{preset:"all",startDate:"",endDate:""}});xh("inventory"),re.useEffect(()=>{i("inventory"),m()},[i,m]);const y=Hn("categorical",c),b=Hn("primary",c),j=Wn(c),w=({title:t,value:n,icon:a,color:s,trend:r,description:i})=>e.jsx(nc,{className:pc(s),dir:"rtl",children:e.jsxs(ic,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground text-right",children:t}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse justify-end",children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:n}),r&&e.jsxs("div",{className:"flex items-center text-sm "+(r.isPositive?"text-green-600":"text-red-600"),children:[e.jsxs("span",{className:"ml-1",children:[Math.abs(r.value),"%"]}),r.isPositive?e.jsx(ur,{className:"w-4 h-4"}):e.jsx(mr,{className:"w-4 h-4"})]})]})]}),e.jsx("div",{className:`p-3 rounded-full ${hc(s)}`,children:e.jsx(a,{className:"w-6 h-6"})})]}),i&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:i})]})}),N=a?.stockAlerts?.filter(e=>{const t=e.name.toLowerCase().includes(u.toLowerCase())||e.category?.toLowerCase().includes(u.toLowerCase()),n="all"===h||e.category===h,a="all"===g||(()=>{const t=new Date,n=e.expiry_date&&new Date(e.expiry_date)<t,a=e.expiry_date&&(()=>{const n=new Date(e.expiry_date),a=Math.ceil((n.getTime()-t.getTime())/864e5);return a<=30&&a>0})(),s=e.quantity<=e.minimum_stock&&e.quantity>0,r=0===e.quantity;switch(g){case"low_stock":return s;case"out_of_stock":return r;case"expired":return n;case"expiring_soon":return a;default:return!0}})();return t&&n&&a})||[];a?.expiryAlerts?.filter(e=>{const t=e.name.toLowerCase().includes(u.toLowerCase())||e.category?.toLowerCase().includes(u.toLowerCase()),n="all"===h||e.category===h;return t&&n});const _=Array.from(new Set([...a?.stockAlerts?.map(e=>e.category).filter(Boolean)||[],...a?.expiryAlerts?.map(e=>e.category).filter(Boolean)||[]]));return s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Bs,{className:"h-12 w-12 animate-pulse text-sky-600 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل تقارير المخزون..."})]})}):a?e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"تقارير المخزون"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إحصائيات وتحليلات شاملة للمخزون والتنبيهات"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{try{await i("inventory");const e=new CustomEvent("showToast",{detail:{title:"تم التحديث بنجاح",description:"تم تحديث تقارير المخزون",type:"success"}});window.dispatchEvent(e)}catch(e){const t=new CustomEvent("showToast",{detail:{title:"خطأ في التحديث",description:"فشل في تحديث التقارير",type:"error"}});window.dispatchEvent(t)}},disabled:s,children:[e.jsx(Js,{className:"w-4 h-4 ml-2 "+(s?"animate-spin":"")}),"تحديث"]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{const e=v.filteredData;if(0!==e.length)try{const t=e.reduce((e,t)=>e+(t.unit_price||t.cost_per_unit||0)*t.quantity,0),n=e.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0).length,a=e.filter(e=>!!e.expiry_date&&new Date(e.expiry_date)<new Date).length,s=e.filter(e=>0===e.quantity).length,r={"نطاق البيانات":v.timeFilter.startDate&&v.timeFilter.endDate?`من ${v.timeFilter.startDate} إلى ${v.timeFilter.endDate}`:"جميع البيانات","إجمالي العناصر":e.length,"القيمة الإجمالية":t,"عناصر منخفضة المخزون":n,"عناصر منتهية الصلاحية":a,"عناصر نفدت من المخزون":s,"تاريخ التقرير":In(new Date)},i="\ufeff"+["المؤشر,القيمة",...Object.entries(r).map(([e,t])=>`"${e}","${t}"`)].join("\n");await ExportService.convertCSVToExcel(i,"inventory",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"}),Kc.exportSuccess(`تم تصدير تقرير المخزون بنجاح! (${e.length} عنصر)`)}catch(t){console.error("Error exporting CSV:",t),Kc.exportError("فشل في تصدير تقرير المخزون")}else Kc.noDataToExport("لا توجد بيانات مخزون للتصدير")},disabled:r,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير اكسل"]}),e.jsxs(Lr,{variant:"default",size:"sm",onClick:async()=>{try{const e=v.filteredData;if(0===e.length)return void Kc.noDataToExport("لا توجد بيانات مخزون للتصدير");const t={...a,totalItems:e.length,totalValue:e.reduce((e,t)=>e+(t.unit_price||t.cost_per_unit||0)*t.quantity,0),lowStockItems:e.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0).length,expiredItems:e.filter(e=>!!e.expiry_date&&new Date(e.expiry_date)<new Date).length,outOfStockItems:e.filter(e=>0===e.quantity).length,inventoryItems:e,filterInfo:v.timeFilter.startDate&&v.timeFilter.endDate?`البيانات من ${v.timeFilter.startDate} إلى ${v.timeFilter.endDate}`:"جميع البيانات",dataCount:e.length};await yh.exportInventoryReport(t,n),Kc.exportSuccess(`تم تصدير تقرير المخزون كملف PDF بنجاح (${e.length} عنصر)`)}catch(e){console.error("Error exporting PDF:",e),Kc.exportError("فشل في تصدير التقرير كملف PDF")}},disabled:r,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير PDF"]})]})]}),e.jsx(Ec,{value:v.timeFilter,onChange:v.handleFilterChange,onClear:v.resetFilter,title:"فلترة زمنية - المخزون",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[e.jsx(w,{title:"إجمالي العناصر",value:v.filteredData.length,icon:Bs,color:"blue",description:"العدد الكلي لعناصر المخزون في الفترة المحددة",trend:v.trend}),e.jsx(w,{title:"القيمة الإجمالية",value:e.jsx(rh,{amount:v.filteredData.reduce((e,t)=>e+t.unit_price*t.quantity,0),currency:t}),icon:ur,color:"green",description:"القيمة الإجمالية للمخزون في الفترة المحددة"}),e.jsx(w,{title:"مخزون منخفض",value:v.filteredData.filter(e=>e.quantity<=e.minimum_stock&&e.quantity>0).length,icon:qa,color:"yellow",description:"عناصر تحتاج إعادة تموين"}),e.jsx(w,{title:"منتهية الصلاحية",value:v.filteredData.filter(e=>!!e.expiry_date&&new Date(e.expiry_date)<new Date).length,icon:es,color:"red",description:"عناصر منتهية الصلاحية"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Gs,{className:"w-5 h-5"}),e.jsx("span",{children:"التوزيع حسب الفئة"})]}),e.jsx(rc,{children:"توزيع عناصر المخزون حسب الفئات"})]}),e.jsx(ic,{children:e.jsx(ue,{width:"100%",height:j.responsive.desktop.height,children:e.jsxs(pe,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(he,{data:a.itemsByCategory.filter(e=>e.count>0),cx:"50%",cy:"50%",labelLine:!1,label:({category:e,count:t,percent:n})=>t>0?`${e}: ${t} (${(100*n).toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"count",stroke:c?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:a.itemsByCategory.filter(e=>e.count>0).map((t,n)=>e.jsx(xe,{fill:y[n%y.length]},`cell-${n}`))}),e.jsx(ge,{formatter:(e,t)=>[e,"عدد العناصر"],labelFormatter:e=>`الفئة: ${e}`,contentStyle:j.tooltip})]})})})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Ka,{className:"w-5 h-5"}),e.jsx("span",{children:"التوزيع حسب المورد"})]}),e.jsx(rc,{children:"توزيع عناصر المخزون حسب الموردين"})]}),e.jsx(ic,{children:e.jsx(ue,{width:"100%",height:j.responsive.desktop.height,children:e.jsxs(fe,{data:a.itemsBySupplier.filter(e=>e.count>0).slice(0,8),margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:"20%",children:[e.jsx(ve,{strokeDasharray:j.grid.strokeDasharray,stroke:j.grid.stroke,strokeOpacity:j.grid.strokeOpacity}),e.jsx(ye,{dataKey:"supplier",tick:{fontSize:14,fill:c?"#9ca3af":"#6b7280"},axisLine:{stroke:c?"#4b5563":"#d1d5db"},tickLine:{stroke:c?"#4b5563":"#d1d5db"},interval:0}),e.jsx(be,{tick:{fontSize:14,fill:c?"#9ca3af":"#6b7280"},axisLine:{stroke:c?"#4b5563":"#d1d5db"},tickLine:{stroke:c?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"]}),e.jsx(ge,{formatter:(e,t)=>[e,"عدد العناصر"],labelFormatter:e=>`المورد: ${e}`,contentStyle:j.tooltip}),e.jsx(je,{dataKey:"count",fill:b[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100})]})})})]})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ur,{className:"w-5 h-5"}),e.jsx("span",{children:"اتجاه الاستخدام"})]}),e.jsx(rc,{children:"معدل استخدام المخزون شهرياً"})]}),e.jsx(ic,{children:e.jsx(ue,{width:"100%",height:j.responsive.desktop.height,children:e.jsxs(we,{data:a.usageTrend,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(ve,{strokeDasharray:j.grid.strokeDasharray,stroke:j.grid.stroke,strokeOpacity:j.grid.strokeOpacity}),e.jsx(ye,{dataKey:"period",tick:{fontSize:12,fill:c?"#9ca3af":"#6b7280"},axisLine:{stroke:c?"#4b5563":"#d1d5db"}}),e.jsx(be,{tick:{fontSize:12,fill:c?"#9ca3af":"#6b7280"},axisLine:{stroke:c?"#4b5563":"#d1d5db"}}),e.jsx(ge,{formatter:(e,t)=>[e,"معدل الاستخدام"],labelFormatter:e=>`الفترة: ${e}`,contentStyle:j.tooltip}),e.jsx(Ne,{type:"monotone",dataKey:"usage",stroke:b[3],fill:b[3],fillOpacity:.3,strokeWidth:3})]})})})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qa,{className:"w-5 h-5"}),e.jsx("span",{children:"تنبيهات المخزون"})]}),e.jsx(rc,{children:"العناصر التي تحتاج انتباهك"})]}),e.jsxs(ic,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Yr,{htmlFor:"search",children:"البحث"}),e.jsxs("div",{className:"relative",children:[e.jsx(tr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{id:"search",placeholder:"البحث بالاسم أو الفئة...",value:u,onChange:e=>p(e.target.value),className:"pr-10"})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"category-filter",children:"الفئة"}),e.jsxs(Nl,{value:h,onValueChange:x,children:[e.jsx(Sl,{className:"w-40",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الفئات"}),_.map(t=>e.jsx(Al,{value:t,children:t},t))]})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"alert-filter",children:"نوع التنبيه"}),e.jsxs(Nl,{value:g,onValueChange:f,children:[e.jsx(Sl,{className:"w-40",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع التنبيهات"}),e.jsx(Al,{value:"low_stock",children:"مخزون منخفض"}),e.jsx(Al,{value:"out_of_stock",children:"نفد المخزون"}),e.jsx(Al,{value:"expired",children:"منتهي الصلاحية"}),e.jsx(Al,{value:"expiring_soon",children:"ينتهي قريباً"})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",dir:"rtl",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-center-all",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center p-3 font-medium",children:"#"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"اسم العنصر"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"الفئة"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"الكمية الحالية"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"الحد الأدنى"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"نوع التنبيه"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"الإجراءات"})]})}),e.jsx("tbody",{children:N.map((t,n)=>{const a=new Date,s=t.expiry_date&&new Date(t.expiry_date)<a,r=t.expiry_date&&(()=>{const e=new Date(t.expiry_date),n=Math.ceil((e.getTime()-a.getTime())/864e5);return n<=30&&n>0})(),i=t.quantity<=t.minimum_stock&&t.quantity>0;let l="",o="";return 0===t.quantity?(l="نفد المخزون",o="destructive"):s?(l="منتهي الصلاحية",o="destructive"):i?(l="مخزون منخفض",o="warning"):r&&(l="ينتهي قريباً",o="warning"),e.jsxs("tr",{className:n%2==0?"bg-background":"bg-muted/50",children:[e.jsx("td",{className:"p-3 font-medium text-center",children:n+1}),e.jsx("td",{className:"p-3 font-medium text-center table-cell-wrap-truncate-md",children:t.name}),e.jsx("td",{className:"p-3 text-muted-foreground text-center table-cell-wrap-truncate-sm",children:t.category||"-"}),e.jsxs("td",{className:"p-3 text-muted-foreground text-center",children:[t.quantity," ",t.unit||"قطعة"]}),e.jsxs("td",{className:"p-3 text-muted-foreground text-center",children:[t.minimum_stock," ",t.unit||"قطعة"]}),e.jsx("td",{className:"p-3 text-muted-foreground text-center",children:t.expiry_date?In(t.expiry_date):"-"}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(oc,{variant:o,children:l})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(Lr,{variant:"ghost",size:"sm",children:e.jsx(ys,{className:"w-4 h-4"})})})]},t.id)})})]})}),0===N.length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Bs,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:0===a?.stockAlerts?.length?"لا توجد تنبيهات للمخزون - جميع العناصر في حالة جيدة":"لا توجد تنبيهات مطابقة للبحث"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["إجمالي التنبيهات: ",a?.stockAlerts?.length||0]})]})]})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Bs,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"لا توجد بيانات"}),e.jsx("p",{className:"text-muted-foreground",children:"لم يتم العثور على بيانات المخزون"}),e.jsxs(Lr,{onClick:()=>i("inventory"),className:"mt-4",variant:"outline",children:[e.jsx(Js,{className:"w-4 h-4 ml-2"}),"إعادة تحميل"]})]})}function wh(){const{appointmentReports:t,isLoading:n,isExporting:a,generateReport:s,clearCache:r}=oh(),{appointments:i,loadAppointments:l}=Jn(),{settings:o}=ta(),{isDarkMode:c}=sa(),d=Tc({data:i,dateField:"start_time",initialFilter:{preset:"all",startDate:"",endDate:""}});xh("appointments"),re.useEffect(()=>{s("appointments"),l()},[s,l]);const m=(()=>{const e=d.filteredData.length>0?d.filteredData:i,t=e.length,n=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"cancelled"===e.status).length,s=e.filter(e=>"scheduled"===e.status).length,r=e.filter(e=>"no_show"===e.status).length,l=t>0?Math.round(n/t*1e3)/10:0,o=t>0?Math.round(a/t*1e3)/10:0;return{total:t,completed:n,cancelled:a,pending:s,noShow:r,attendanceRate:l.toFixed(1),cancellationRate:o.toFixed(1),appointmentsByStatus:[],appointmentTrend:[]}})();Hn("categorical",c);const u=Hn("primary",c),p=Kn("status",c,8),h=Wn(c),x=(()=>{try{return function(e){return e.filter(e=>e.value>0)}([{name:"مكتمل",value:m.completed,color:p[0]},{name:"مجدول",value:m.pending,color:p[4]},{name:"ملغي",value:m.cancelled,color:p[2]},{name:"لم يحضر",value:m.noShow,color:p[3]}].map(e=>({...e,percentage:m.total>0?Math.round(e.value/m.total*100):0})))}catch(e){return console.error("Appointment Reports: Error processing status data:",e),[]}})(),g=(()=>{try{if(t?.appointmentTrend&&t.appointmentTrend.length>0)return t.appointmentTrend.map(e=>({month:e.period,count:e.count,formattedCount:`${e.count} موعد`}));e=i,n="start_time",Array.isArray(e)&&0!==e.length&&e.every(e=>{const t=e[n];if(!t)return!1;const a=new Date(t);return!isNaN(a.getTime())&&a.getFullYear()>1900&&a.getFullYear()<2100})||console.warn("Appointment Reports: Invalid date data detected");const a=i.reduce((e,t)=>{try{if(!t||!t.start_time)return e;const n=new Date(t.start_time);if(isNaN(n.getTime())||n.getFullYear()<1900||n.getFullYear()>2100)return console.warn("Invalid appointment start_time:",t.start_time),e;const a=n.getMonth(),s=Yn(n.getFullYear(),a);return e[s]=(e[s]||0)+1,e}catch(n){return console.warn("Error processing appointment date:",t.start_time,n),e}},{}),s=Object.entries(a).map(([e,t])=>({month:e,count:t,formattedCount:`${t} موعد`})).sort((e,t)=>{const n=new Date(e.month),a=new Date(t.month);return n.getTime()-a.getTime()}).filter(e=>e.count>0);return function(e){return!(!Array.isArray(e)||0===e.length)&&e.every(e=>"object"==typeof e&&null!==e&&Object.values(e).some(e=>"number"==typeof e&&!isNaN(e)&&isFinite(e)))}(s)?s:(console.warn("Appointment Reports: Invalid monthly chart data"),[])}catch(a){return console.error("Appointment Reports: Error processing monthly data:",a),[]}var e,n})();return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"تقارير المواعيد"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إحصائيات وتحليلات شاملة للمواعيد"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{try{r(),await s("appointments"),await l();const e=new CustomEvent("showToast",{detail:{title:"تم التحديث بنجاح",description:"تم تحديث تقارير المواعيد",type:"success"}});window.dispatchEvent(e)}catch(e){console.error("Error refreshing appointment reports:",e);const t=new CustomEvent("showToast",{detail:{title:"خطأ في التحديث",description:"فشل في تحديث التقارير",type:"error"}});window.dispatchEvent(t)}},disabled:n,children:[e.jsx(Js,{className:"w-4 h-4 ml-2 "+(n?"animate-spin":"")}),"تحديث"]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{const e=d.filteredData.length>0?d.filteredData:i;if(0!==e.length)try{const t=d.timeFilter.startDate&&d.timeFilter.endDate?`من ${d.timeFilter.startDate} إلى ${d.timeFilter.endDate}`:"جميع البيانات",n={};e.forEach(e=>{const t=e.treatment_name||"غير محدد";n[t]=(n[t]||0)+1});const a=Object.entries(n).map(([e,t])=>({treatment:e,count:t})).sort((e,t)=>t.count-e.count),s={totalAppointments:m.total,completedAppointments:m.completed,cancelledAppointments:m.cancelled,scheduledAppointments:m.pending,noShowAppointments:m.noShow,attendanceRate:parseFloat(m.attendanceRate),cancellationRate:parseFloat(m.cancellationRate),appointmentsByStatus:x.map(e=>({status:e.name,count:e.value,percentage:m.total>0?e.value/m.total*100:0})),appointmentsByTreatment:a,appointmentsByDay:[],appointmentsByHour:[],peakHours:[],appointmentTrend:[],appointmentsList:e,filterInfo:t,dataCount:e.length},r="\ufeff"+Zc.generateAppointmentCSV(s,{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"});await Zc.convertCSVToExcel(r,"appointments",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"}),Kc.exportSuccess(`تم تصدير تقرير المواعيد بنجاح! (${e.length} موعد)`)}catch(t){console.error("Error exporting CSV:",t),Kc.exportError("فشل في تصدير تقرير المواعيد")}else Kc.noDataToExport("لا توجد بيانات مواعيد للتصدير")},disabled:a,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير اكسل"]}),e.jsxs(Lr,{variant:"default",size:"sm",onClick:async()=>{try{const e=d.filteredData.length>0?d.filteredData:i;if(0===e.length)return void Kc.noDataToExport("لا توجد بيانات مواعيد للتصدير");const t={totalAppointments:m.total,completedAppointments:m.completed,cancelledAppointments:m.cancelled,noShowAppointments:m.noShow,attendanceRate:parseFloat(m.attendanceRate),cancellationRate:parseFloat(m.cancellationRate),appointmentsByStatus:x.map(e=>({status:e.name,count:e.value,percentage:m.total>0?e.value/m.total*100:0})),peakHours:[],monthlyTrend:g,filterInfo:d.timeFilter.startDate&&d.timeFilter.endDate?`البيانات من ${d.timeFilter.startDate} إلى ${d.timeFilter.endDate}`:"جميع البيانات",dataCount:e.length};await yh.exportAppointmentReport(t,o),Kc.exportSuccess(`تم تصدير تقرير المواعيد كملف PDF بنجاح (${e.length} موعد)`)}catch(e){console.error("Error exporting PDF:",e),Kc.exportError("فشل في تصدير التقرير كملف PDF")}},disabled:a,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير PDF"]})]})]}),e.jsx(Ec,{value:d.timeFilter,onChange:d.handleFilterChange,onClear:d.resetFilter,title:"فلترة زمنية - المواعيد",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",dir:"rtl",children:[e.jsxs(nc,{className:pc("purple"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"إجمالي المواعيد"}),e.jsx(es,{className:`h-4 w-4 ${hc("purple")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:i.length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"إجمالي المواعيد المسجلة"})]})]}),e.jsxs(nc,{className:pc("blue"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===d.timeFilter.preset||!d.timeFilter.startDate&&!d.timeFilter.endDate?"المواعيد الحالية":"المواعيد المفلترة"}),e.jsx(br,{className:`h-4 w-4 ${hc("blue")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:"all"===d.timeFilter.preset||!d.timeFilter.startDate&&!d.timeFilter.endDate?i.length:d.filteredData.length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"all"===d.timeFilter.preset||!d.timeFilter.startDate&&!d.timeFilter.endDate?"جميع المواعيد":"المواعيد في الفترة المحددة"}),d.trend&&e.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(d.trend.isPositive?"text-green-600":"text-red-600"),children:[e.jsxs("span",{className:"ml-1",children:[Math.abs(d.trend.changePercent),"%"]}),d.trend.isPositive?e.jsx(ur,{className:"h-3 w-3"}):e.jsx(mr,{className:"h-3 w-3"})]})]})]}),e.jsxs(nc,{className:pc("emerald"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"المواعيد المكتملة"}),e.jsx(ns,{className:`h-4 w-4 ${hc("emerald")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:m.completed}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["معدل الحضور: ",m.attendanceRate,"%"]})]})]}),e.jsxs(nc,{className:pc("orange"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"المواعيد الملغية"}),e.jsx(Nr,{className:`h-4 w-4 ${hc("orange")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:m.cancelled}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["معدل الإلغاء: ",m.cancellationRate,"%"]})]})]}),e.jsxs(nc,{className:pc("cyan"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"المواعيد المجدولة"}),e.jsx(us,{className:`h-4 w-4 ${hc("cyan")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:m.pending}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"في انتظار التنفيذ"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Gs,{className:"w-5 h-5"}),e.jsx("span",{children:"توزيع حالات المواعيد"})]}),e.jsxs(rc,{children:["توزيع المواعيد حسب الحالة (",m.total," موعد إجمالي)"]})]}),e.jsxs(ic,{children:[0===x.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Gs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات مواعيد متاحة"})]})}):e.jsx(ue,{width:"100%",height:h.responsive.desktop.height,children:e.jsxs(pe,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(he,{data:x,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t,percent:n})=>t>0?`${e}: ${t} (${(100*n).toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"value",stroke:c?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:x.map((t,n)=>e.jsx(xe,{fill:t.color},`appointment-status-${n}`))}),e.jsx(ge,{formatter:(e,t)=>[`${e} موعد`,"العدد"],labelFormatter:e=>`الحالة: ${e}`,contentStyle:h.tooltip})]})}),x.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:x.map((t,n)=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[t.name,": ",t.value," (",t.percentage,"%)"]})]},`status-legend-${n}`))})]})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Ka,{className:"w-5 h-5"}),e.jsx("span",{children:"المواعيد الشهرية"})]}),e.jsxs(rc,{children:["عدد المواعيد حسب الشهر (",g.length," شهر)"]})]}),e.jsxs(ic,{children:[0===g.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ka,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات مواعيد شهرية متاحة"})]})}):e.jsx(ue,{width:"100%",height:h.responsive.desktop.height,children:e.jsxs(fe,{data:g,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:h.bar.barCategoryGap,children:[e.jsx(ve,{strokeDasharray:h.grid.strokeDasharray,stroke:h.grid.stroke,strokeOpacity:h.grid.strokeOpacity}),e.jsx(ye,{dataKey:"month",tick:{fontSize:14,fill:c?"#9ca3af":"#6b7280"},axisLine:{stroke:c?"#4b5563":"#d1d5db"},tickLine:{stroke:c?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),e.jsx(be,{tick:{fontSize:14,fill:c?"#9ca3af":"#6b7280"},axisLine:{stroke:c?"#4b5563":"#d1d5db"},tickLine:{stroke:c?"#4b5563":"#d1d5db"},domain:[0,"dataMax + 1"],tickFormatter:e=>`${e} موعد`}),e.jsx(ge,{formatter:(e,t)=>[`${e} موعد`,"العدد"],labelFormatter:e=>`الشهر: ${e}`,contentStyle:h.tooltip}),e.jsx(je,{dataKey:"count",fill:u[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100})]})}),g.length>0&&e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"أعلى شهر"}),e.jsxs("div",{className:"font-semibold",children:[Math.max(...g.map(e=>e.count))," موعد"]})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"متوسط شهري"}),e.jsxs("div",{className:"font-semibold",children:[Math.round(g.reduce((e,t)=>e+t.count,0)/g.length)," موعد"]})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"أقل شهر"}),e.jsxs("div",{className:"font-semibold",children:[Math.min(...g.map(e=>e.count))," موعد"]})]})]})]})]})]})]})}function Nh(e){const t=[],n=[];if(null==e)return t.push("Amount is null or undefined"),{isValid:!1,errors:t,warnings:n,sanitizedValue:0};const a=Number(e);if(isNaN(a))return t.push(`Invalid amount: ${e} cannot be converted to number`),{isValid:!1,errors:t,warnings:n,sanitizedValue:0};if(!isFinite(a))return t.push(`Amount is not finite: ${a}`),{isValid:!1,errors:t,warnings:n,sanitizedValue:0};a<0&&n.push(`Negative amount detected: ${a}`),a>1e6&&n.push(`Very large amount detected: ${a}`);return{isValid:!0,errors:t,warnings:n,sanitizedValue:Math.round(100*a)/100}}function _h(e){if(!Array.isArray(e))return console.error("Payments is not an array:",e),{validPayments:[],invalidPayments:[],totalErrors:1,totalWarnings:0};const t=[],n=[];let a=0,s=0;return e.forEach((e,r)=>{const i=function(e){const t=[],n=[];if(!e)return t.push("Payment object is null or undefined"),{isValid:!1,errors:t,warnings:n};if(e.id||t.push("Payment ID is missing"),e.patient_id||t.push("Patient ID is missing"),e.payment_date){const n=new Date(e.payment_date);isNaN(n.getTime())&&t.push(`Invalid payment date: ${e.payment_date}`)}else t.push("Payment date is missing");e.payment_method||n.push("Payment method is missing"),e.status||n.push("Payment status is missing");const a=Nh(e.amount);return a.isValid||t.push(...a.errors),n.push(...a.warnings),{isValid:0===t.length,errors:t,warnings:n}}(e);if(a+=i.errors.length,s+=i.warnings.length,i.isValid){const n=Nh(e.amount);t.push({...e,amount:n.sanitizedValue||0})}else console.warn(`Invalid payment at index ${r}:`,i.errors),n.push({payment:e,errors:i.errors,warnings:i.warnings})}),{validPayments:t,invalidPayments:n,totalErrors:a,totalWarnings:s}}function kh(e){return Nh(e).sanitizedValue||0}function Sh(e){const t={},n=[];return e&&"object"==typeof e?(Object.entries(e).forEach(([e,a])=>{if(!e.match(/^\d{4}-\d{2}$/))return void n.push(`Invalid month format: ${e}`);const s=Nh(a);s.isValid?t[e]=s.sanitizedValue||0:n.push(`Invalid amount for month ${e}: ${a}`)}),{validData:t,errors:n}):(n.push("Monthly data is not a valid object"),{validData:t,errors:n})}function Ch(e){const t={},n=[];if(!e||"object"!=typeof e)return n.push("Payment method stats is not a valid object"),{validStats:t,errors:n};const a=["cash","card","bank_transfer","check","insurance"];return Object.entries(e).forEach(([e,s])=>{a.includes(e)||"unknown"===e||console.warn(`Unknown payment method: ${e}`);const r=Nh(s);r.isValid?t[e]=r.sanitizedValue||0:n.push(`Invalid amount for payment method ${e}: ${s}`)}),{validStats:t,errors:n}}class $h{static validateAmount(e){if(null==e)return{isValid:!0,value:0};const t=Number(e);return isNaN(t)?{isValid:!1,value:0,error:`Invalid amount: ${e}`}:isFinite(t)?t<0?{isValid:!1,value:0,error:`Amount cannot be negative: ${e}`}:{isValid:!0,value:Math.round(100*t)/100}:{isValid:!1,value:0,error:`Amount is not finite: ${e}`}}static validatePayments(e){const t=[],n=[];let a=0,s=0,r=0,i=0,l=0;if(!Array.isArray(e))return t.push("Payments data is not an array"),{isValid:!1,errors:t,warnings:n,calculations:{totalRevenue:0,completedAmount:0,partialAmount:0,pendingAmount:0,overdueAmount:0}};e.forEach((e,o)=>{if(!e||"object"!=typeof e)return void t.push(`Payment at index ${o} is invalid`);const c=this.validateAmount(e.amount);if(!c.isValid)return void t.push(`Payment ${e.id||o}: ${c.error}`);const d=c.value;switch(e.status){case"completed":s+=d,a+=d;break;case"partial":const t=this.validateAmount(e.amount_paid||e.amount);t.isValid&&(r+=t.value,a+=t.value);break;case"pending":i+=d;break;case"overdue":l+=d;break;default:n.push(`Payment ${e.id||o}: Unknown status '${e.status}'`)}});const o=s+r;return Math.abs(a-o)>.01&&n.push(`Revenue calculation mismatch: ${a} vs ${o}`),{isValid:0===t.length,errors:t,warnings:n,calculations:{totalRevenue:Math.round(100*a)/100,completedAmount:Math.round(100*s)/100,partialAmount:Math.round(100*r)/100,pendingAmount:Math.round(100*i)/100,overdueAmount:Math.round(100*l)/100}}}static validateExpenses(e){const t=[],n=[];let a=0,s=0,r=0;const i={};return Array.isArray(e)?(e.forEach((e,n)=>{if(!e||"object"!=typeof e)return void t.push(`Expense at index ${n} is invalid`);const l=this.validateAmount(e.amount);if(!l.isValid)return void t.push(`Expense ${e.id||n}: ${l.error}`);const o=l.value;"paid"===e.status?(s+=o,a+=o):"pending"===e.status&&(r+=o);const c=e.expense_type||"other";i[c]=(i[c]||0)+o}),{isValid:0===t.length,errors:t,warnings:n,calculations:{totalExpenses:Math.round(100*a)/100,paidExpenses:Math.round(100*s)/100,pendingExpenses:Math.round(100*r)/100,expensesByType:i}}):(t.push("Expenses data is not an array"),{isValid:!1,errors:t,warnings:n,calculations:{totalExpenses:0,paidExpenses:0,pendingExpenses:0,expensesByType:{}}})}static validateInventory(e){const t=[],n=[];let a=0,s=0,r=0;if(!Array.isArray(e))return t.push("Inventory data is not an array"),{isValid:!1,errors:t,warnings:n,calculations:{totalValue:0,totalItems:0,lowStockItems:0,expiredItems:0}};const i=new Date;return e.forEach((e,l)=>{if(!e||"object"!=typeof e)return void t.push(`Inventory item at index ${l} is invalid`);const o=this.validateAmount(e.quantity),c=this.validateAmount(e.cost_per_unit||0);if(!o.isValid)return void t.push(`Item ${e.id||l}: Invalid quantity`);c.isValid||n.push(`Item ${e.id||l}: Invalid price`);const d=o.value,m=c.value;if(a+=d*m,d<=(e.minimum_stock||0)&&d>0&&s++,e.expiry_date){new Date(e.expiry_date)<i&&r++}}),{isValid:0===t.length,errors:t,warnings:n,calculations:{totalValue:Math.round(100*a)/100,totalItems:e.length,lowStockItems:s,expiredItems:r}}}static validateAllFinancialData(e){const t=[],n=[],a=this.validatePayments(e.payments);t.push(...a.errors),n.push(...a.warnings);let s={calculations:{totalExpenses:0}};e.expenses&&(s=this.validateExpenses(e.expenses),t.push(...s.errors),n.push(...s.warnings));let r={calculations:{totalValue:0}};e.inventory&&(r=this.validateInventory(e.inventory),t.push(...r.errors),n.push(...r.warnings)),e.labOrders&&e.labOrders.forEach((e,a)=>{const s=this.validateAmount(e.paid_amount||0),r=this.validateAmount(e.cost||0);s.isValid||t.push(`Lab order ${a+1}: Invalid paid amount - ${s.error}`),r.isValid||t.push(`Lab order ${a+1}: Invalid cost - ${r.error}`),s.value>r.value&&n.push(`Lab order ${a+1}: Paid amount (${s.value}) exceeds cost (${r.value})`)}),e.clinicNeeds&&e.clinicNeeds.forEach((e,a)=>{const s=this.validateAmount(e.quantity||0),r=this.validateAmount(e.price||0);s.isValid||t.push(`Clinic need ${a+1}: Invalid quantity - ${s.error}`),r.isValid||t.push(`Clinic need ${a+1}: Invalid price - ${r.error}`),s.value<=0&&n.push(`Clinic need ${a+1}: Zero or negative quantity`)});let i=s.calculations.totalExpenses;if(e.inventory){i+=e.inventory.reduce((e,t)=>e+this.validateAmount(t.cost_per_unit||0).value*this.validateAmount(t.quantity||0).value,0)}if(e.labOrders){const t=e.labOrders.reduce((e,t)=>e+this.validateAmount(t.paid_amount||0).value,0);i+=t}if(e.clinicNeeds){i+=e.clinicNeeds.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+this.validateAmount(t.quantity||0).value*this.validateAmount(t.price||0).value,0)}const l=a.calculations.totalRevenue,o=l-i,c=l>0?o/l*100:0;return l<0&&t.push("Total revenue cannot be negative"),i<0&&t.push("Total expenses cannot be negative"),{isValid:0===t.length,errors:t,warnings:n,calculations:{totalRevenue:Math.round(100*l)/100,totalExpenses:Math.round(100*i)/100,netProfit:Math.round(100*o)/100,profitMargin:Math.round(100*c)/100}}}}class Dh{static validatePaymentCalculations(e){const t=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},n=e.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,n)=>e+("partial"===n.status&&void 0!==n.amount_paid?t(n.amount_paid):t(n.amount)),0),a=e.filter(e=>"completed"===e.status).reduce((e,n)=>e+t(n.amount),0),s=e.filter(e=>"partial"===e.status).reduce((e,n)=>e+(void 0!==n.amount_paid?t(n.amount_paid):t(n.amount)),0),r=e.filter(e=>"pending"===e.status).reduce((e,n)=>{const a=t(n.amount),s=t(n.total_amount_due);return e+(0===a&&s>0?s:a)},0),i=e.filter(e=>{if("pending"!==e.status)return!1;const t=new Date(e.payment_date),n=new Date;return n.setDate(n.getDate()-30),t<n}).reduce((e,n)=>{const a=t(n.amount),s=t(n.total_amount_due);return e+(0===a&&s>0?s:a)},0),l=a+s;return Math.abs(n-l)>.01&&console.warn("Payment calculation mismatch:",{totalRevenue:n,calculatedTotal:a+s,completedAmount:a,partialAmount:s,difference:n-l}),{totalRevenue:Math.round(100*n)/100,completedAmount:Math.round(100*a)/100,partialAmount:Math.round(100*s)/100,pendingAmount:Math.round(100*r)/100,overdueAmount:Math.round(100*i)/100,isValid:Math.abs(n-l)<=.01}}static validateAppointmentStats(e){const t=e.length,n=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"cancelled"===e.status).length,s=e.filter(e=>"no-show"===e.status).length,r=e.filter(e=>"scheduled"===e.status).length,i=n+a+s+r,l=t-i;0!==l&&console.warn("Appointment status calculation mismatch:",{total:t,calculatedTotal:i,otherStatuses:l,statusBreakdown:{completed:n,cancelled:a,noShow:s,scheduled:r}});return{total:t,completed:n,cancelled:a,noShow:s,scheduled:r,attendanceRate:t>0?Math.round(n/t*100):0,isValid:0===l}}static validateInventoryStats(e){const t=e.length,n=e.reduce((e,t)=>e+(t.unit_price||0)*(t.quantity||0),0),a=e.filter(e=>(e.quantity||0)<=(e.minimum_stock||0)&&(e.quantity||0)>0).length,s=e.filter(e=>0===(e.quantity||0)).length,r=e.filter(e=>(e.quantity||0)>(e.minimum_stock||0)).length,i=a+s+r;return i!==t&&console.warn("Inventory calculation mismatch:",{totalItems:t,calculatedTotal:i,breakdown:{lowStockItems:a,outOfStockItems:s,inStockItems:r}}),{totalItems:t,totalValue:Math.round(100*n)/100,lowStockItems:a,outOfStockItems:s,inStockItems:r,isValid:i===t}}static validateAllData(e){const t=this.validatePaymentCalculations(e.payments),n=this.validateAppointmentStats(e.appointments),a=this.validateInventoryStats(e.inventory),s=t.isValid&&n.isValid&&a.isValid;return s||console.error("Data validation failed:",{payments:t.isValid,appointments:n.isValid,inventory:a.isValid}),{payments:t,appointments:n,inventory:a,isAllValid:s}}static compareFilteredData(e,t,n){const a=e.length,s=t.length,r=a>0?s/a*100:0;return console.log(`Filter comparison for ${n}:`,{original:a,filtered:s,ratio:`${Math.round(r)}%`,isFiltered:s<a}),{originalCount:a,filteredCount:s,filterRatio:Math.round(r),isFiltered:s<a}}}const Eh={all:"جميع البيانات",today:"اليوم",yesterday:"أمس",this_week:"هذا الأسبوع",last_week:"الأسبوع الماضي",this_month:"هذا الشهر",last_month:"الشهر الماضي",this_quarter:"هذا الربع",last_quarter:"الربع الماضي",this_year:"هذا العام",last_year:"العام الماضي",last_30_days:"آخر 30 يوم",last_90_days:"آخر 90 يوم",custom:"فترة مخصصة"};class Th{static calculateFinancialStats(e,t,n,a,s){const r=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},i=Array.isArray(e)?e.filter(e=>e&&"object"==typeof e):[],l=Array.isArray(t)?t.filter(e=>e&&"object"==typeof e):[],o=Array.isArray(n)?n.filter(e=>e&&"object"==typeof e):[],c=Array.isArray(a)?a.filter(e=>e&&"object"==typeof e):[],d=Array.isArray(s)?s.filter(e=>e&&"object"==typeof e):[];console.log("🔍 calculateFinancialStats called with validated data:",{paymentsCount:i.length,labOrdersCount:l.length,clinicNeedsCount:o.length,inventoryItemsCount:c.length,expensesCount:d.length});const m=r(e.filter(e=>"completed"===e.status).reduce((e,t)=>e+r(t.amount),0)),u=r(e.filter(e=>"partial"===e.status).reduce((e,t)=>e+r(t.amount),0)),p=m+u,h=r(e.filter(e=>("partial"===e.status||"pending"===e.status)&&(e.treatment_remaining_balance||e.remaining_balance)).reduce((e,t)=>{const n=r(t.treatment_remaining_balance),a=r(t.remaining_balance);return e+(n||a)},0)),x=e.filter(e=>"pending"===e.status).reduce((e,t)=>{const n=r(t.amount),a=r(t.total_amount_due);let s=n;if(t.tooth_treatment_id){s=r(t.treatment_total_cost)||a}else 0===n&&a>0&&(s=a);return e+s},0);let g=0,f=0,v=0,y=0,b=0;t&&Array.isArray(t)&&(g=r(t.reduce((e,t)=>e+r(t.paid_amount||0),0)),f=r(t.reduce((e,t)=>e+r(t.remaining_balance||0),0))),n&&Array.isArray(n)&&(v=r(n.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+r(t.quantity)*r(t.price),0)),y=r(n.filter(e=>"pending"===e.status||"ordered"===e.status).reduce((e,t)=>e+r(t.quantity)*r(t.price),0))),a&&Array.isArray(a)&&(b=r(a.reduce((e,t)=>e+r(t.cost_per_unit||0)*r(t.quantity||0),0)));let j=0,w=[];if(d&&d.length>0){j=r(d.filter(e=>"paid"===e.status).reduce((e,t)=>e+r(t.amount),0));const e={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},t={};d.filter(e=>"paid"===e.status).forEach(e=>{const n=e.expense_type||"other",a=r(e.amount);t[n]=(t[n]||0)+a}),w=Object.entries(t).map(([t,n])=>({type:e[t]||t,amount:r(n),percentage:j>0?r(n)/j*100:0}))}const N=r(g+v+b+j),_=r(p-N),k=_>=0,S=p>0?r(_/p*100):0;console.log("💰 Financial calculations verification:",{totalRevenue:r(p),totalExpenses:r(N),netProfit:r(_),profitMargin:r(S),breakdown:{labOrdersTotal:r(g),clinicNeedsTotal:r(v),inventoryExpenses:r(b),clinicExpensesTotal:r(j)}});const C=new Date;return C.setDate(C.getDate()-30),{completedPayments:m,partialPayments:u,totalRevenue:p,remainingBalances:h,pendingAmount:x,labOrdersTotal:g,labOrdersRemaining:f,clinicNeedsTotal:v,clinicNeedsRemaining:y,inventoryExpenses:b,clinicExpensesTotal:j,expensesByType:w,totalExpenses:N,netProfit:k?_:0,lossAmount:k?0:Math.abs(_),profitMargin:r(S),isProfit:k,totalTransactions:e.length,completedTransactions:e.filter(e=>"completed"===e.status).length,partialTransactions:e.filter(e=>"partial"===e.status).length,pendingTransactions:e.filter(e=>"pending"===e.status).length}}static filterAllDataByDateRange(e,t){const n=e=>{if(!e)return!1;const n=new Date(e);let a;return a=e.includes("T")||e.includes(" ")?n:new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),a>=t.startDate&&a<=t.endDate};return{patients:e.patients,appointments:e.appointments.filter(e=>n(e.start_time)||n(e.created_at)),payments:e.payments.filter(e=>n(e.payment_date)||n(e.created_at)),inventory:e.inventory.filter(e=>n(e.created_at)||n(e.updated_at)),treatments:e.treatments?.filter(e=>n(e.start_date||"")||n(e.created_at||""))||[],prescriptions:e.prescriptions?.filter(e=>n(e.created_at))||[],labOrders:e.labOrders?.filter(e=>n(e.order_date)||n(e.created_at))||[],clinicNeeds:e.clinicNeeds?.filter(e=>n(e.created_at))||[]}}static calculateAllAspectsStats(e,t){const n=this.calculateFinancialStats(e.payments,e.labOrders,e.clinicNeeds,e.inventory,e.expenses),a=this.calculateDetailedAppointmentStats(e.appointments),s=this.calculateTreatmentStats(e.treatments),r=this.calculatePrescriptionStats(e.prescriptions),i=this.calculateLabOrderStats(e.labOrders),l=this.calculateClinicNeedsStats(e.clinicNeeds),o=this.calculateInventoryStats(e.inventory);return{dateRange:{start:In(t.startDate.toISOString()),end:In(t.endDate.toISOString()),period:`${In(t.startDate.toISOString())} - ${In(t.endDate.toISOString())}`},totalPatients:e.patients.length,totalAppointments:e.appointments.length,totalPayments:e.payments.length,totalTreatments:e.treatments.length,totalPrescriptions:e.prescriptions.length,totalLabOrders:e.labOrders.length,totalClinicNeeds:e.clinicNeeds.length,totalInventoryItems:e.inventory.length,...n,...a,...s,...r,...i,...l,...o}}static calculateAppointmentStats(e){const t=e.length,n=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"cancelled"===e.status).length,s=e.filter(e=>"no-show"===e.status).length,r=e.filter(e=>"scheduled"===e.status).length;return{total:t,completed:n,cancelled:a,noShow:s,scheduled:r,attendanceRate:t>0?Math.round(n/t*100):0}}static calculateDetailedAppointmentStats(e){const t=this.calculateAppointmentStats(e),n=e.reduce((e,t)=>{if(t.start_time){const n=new Date(t.start_time).getHours();e[n]=(e[n]||0)+1}return e},{}),a=Object.entries(n).reduce((e,[t,n])=>n>e.count?{hour:parseInt(t),count:n}:e,{hour:0,count:0}),s=e.reduce((e,t)=>{if(t.start_time){const n=["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"][new Date(t.start_time).getDay()];e[n]=(e[n]||0)+1}return e},{});return{...t,peakHour:a.hour?`${a.hour}:00 (${a.count} مواعيد)`:"غير محدد",dayDistribution:s,averagePerDay:e.length>0?Math.round(e.length/7):0}}static calculateTreatmentStats(e){const t=e.length,n=e.filter(e=>"completed"===e.treatment_status).length,a=e.filter(e=>"planned"===e.treatment_status).length,s=e.filter(e=>"in_progress"===e.treatment_status).length,r=e.filter(e=>"cancelled"===e.treatment_status).length,i=e.reduce((e,t)=>{const n=t.treatment_type||"غير محدد";return e[n]=(e[n]||0)+1,e},{}),l=e.reduce((e,t)=>{const n=t.tooth_number?.toString()||"غير محدد";return e[n]=(e[n]||0)+1,e},{});return{totalTreatments:t,completedTreatments:n,plannedTreatments:a,inProgressTreatments:s,cancelledTreatments:r,completionRate:t>0?Math.round(n/t*100):0,treatmentTypes:i,teethTreated:l,mostTreatedTooth:Object.entries(l).reduce((e,[t,n])=>n>e.count?{tooth:t,count:n}:e,{tooth:"غير محدد",count:0})}}static calculatePrescriptionStats(e){const t=e.length;e.reduce((e,t)=>e,{});const n=new Set(e.map(e=>e.patient_id)).size;return{totalPrescriptions:t,patientsWithPrescriptions:n,averagePrescriptionsPerPatient:n>0?Math.round(t/n*100)/100:0}}static calculateLabOrderStats(e){const t=e.length,n=e.filter(e=>"معلق"===e.status).length,a=e.filter(e=>"مكتمل"===e.status).length,s=e.filter(e=>"ملغي"===e.status).length,r=e.reduce((e,t)=>e+(t.cost||0),0),i=e.reduce((e,t)=>e+(t.paid_amount||0),0),l=e.reduce((e,t)=>e+(t.remaining_balance||0),0),o=e.reduce((e,t)=>{const n=t.lab?.name||"غير محدد";return e[n]=(e[n]||0)+1,e},{});return{totalLabOrders:t,pendingLabOrders:n,completedLabOrders:a,cancelledLabOrders:s,labOrdersCompletionRate:t>0?Math.round(a/t*100):0,totalLabCost:r,totalLabPaid:i,totalLabRemaining:l,labFrequency:o,mostUsedLab:Object.entries(o).reduce((e,[t,n])=>n>e.count?{lab:t,count:n}:e,{lab:"غير محدد",count:0})}}static calculateClinicNeedsStats(e){const t=e.length,n=e.filter(e=>"pending"===e.status).length,a=e.filter(e=>"ordered"===e.status).length,s=e.filter(e=>"received"===e.status).length,r=e.filter(e=>"cancelled"===e.status).length,i=e.reduce((e,t)=>e+(t.quantity||0)*(t.price||0),0),l=e.reduce((e,t)=>{const n=t.priority||"medium";return e[n]=(e[n]||0)+1,e},{}),o=e.reduce((e,t)=>{const n=t.category||"غير محدد";return e[n]=(e[n]||0)+1,e},{});return{totalClinicNeeds:t,pendingNeeds:n,orderedNeeds:a,receivedNeeds:s,cancelledNeeds:r,needsCompletionRate:t>0?Math.round(s/t*100):0,totalNeedsValue:i,priorityAnalysis:l,categoryAnalysis:o,urgentNeeds:l.urgent||0,highPriorityNeeds:l.high||0}}static validateAmount(e){const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100}static calculateInventoryStats(e){const t=e.length,n=e.reduce((e,t)=>{const n=t.category||"غير محدد";return e[n]=(e[n]||0)+1,e},{});return{totalInventoryItems:t,totalInventoryValue:e.reduce((e,t)=>e+this.validateAmount(t.cost_per_unit||0)*this.validateAmount(t.quantity||0),0),lowStockItems:e.filter(e=>(e.quantity||0)<=(e.minimum_quantity||0)).length,inventoryByCategory:n}}static groupByStatus(e,t){return e.reduce((e,n)=>{const a=n[t]||"غير محدد";return e[a]=(e[a]||0)+1,e},{})}static groupByMethod(e){return e.reduce((e,t)=>{const n=t.payment_method||"غير محدد";return e[n]=(e[n]||0)+1,e},{})}static groupByCategory(e){return e.reduce((e,t)=>{const n=t.category||"غير محدد";return e[n]=(e[n]||0)+1,e},{})}static generateComprehensiveCSV(e){const t=this.calculateFinancialStats(e.payments),n=this.calculateAppointmentStats(e.appointments),a=this.calculateInventoryStats(e.inventory);let s="\ufeff";if(s+="التقرير الشامل - عيادة الأسنان الحديثة\n",s+=`تاريخ التقرير,${this.formatGregorianDate(new Date)}\n`,s+=`وقت الإنشاء,${(new Date).toLocaleTimeString("ar-SA")}\n\n`,s+="معلومات الفلترة المطبقة\n",s+=`فلتر المواعيد,${e.filterInfo.appointmentFilter}\n`,s+=`فلتر المدفوعات,${e.filterInfo.paymentFilter}\n`,s+=`فلتر المخزون,${e.filterInfo.inventoryFilter}\n\n`,s+="إحصائيات المرضى\n",s+=`إجمالي المرضى,${e.patients.length}\n`,s+=`المرضى الجدد هذا الشهر,${this.getNewPatientsThisMonth(e.patients)}\n`,s+=`المرضى النشطون,${this.getActivePatients(e.patients,e.appointments)}\n`,s+=`متوسط عمر المرضى,${this.calculateAverageAge(e.patients)}\n`,s+=`توزيع الجنس,${this.getGenderDistribution(e.patients)}\n\n`,s+="إحصائيات المواعيد (مفلترة)\n",s+=`إجمالي المواعيد,${n.total}\n`,s+=`المواعيد المكتملة,${n.completed}\n`,s+=`المواعيد الملغية,${n.cancelled}\n`,s+=`المواعيد المجدولة,${n.scheduled}\n`,s+=`معدل الحضور,${n.attendanceRate}%\n\n`,s+="الإحصائيات المالية (مفلترة)\n",s+=`إجمالي الإيرادات,${Mn(t.totalRevenue)}\n`,s+=`المدفوعات المكتملة,${Mn(t.completedAmount)}\n`,s+=`المدفوعات الجزئية,${Mn(t.partialAmount)}\n`,s+=`المدفوعات المعلقة,${Mn(t.pendingAmount)}\n`,s+=`المدفوعات المتأخرة,${Mn(t.overdueAmount)}\n`,t.totalRemainingFromPartialPayments>0&&(s+=`المبالغ المتبقية من الدفعات الجزئية,${Mn(t.totalRemainingFromPartialPayments)}\n`),s+=`الرصيد المستحق الإجمالي,${Mn(t.outstandingBalance)}\n`,s+=`إجمالي المعاملات,${t.totalTransactions}\n`,s+=`إجمالي المصروفات,${Mn(t.totalExpenses||0)}\n`,s+=`صافي الربح,${Mn(t.netProfit||0)}\n`,s+=`هامش الربح,${(t.profitMargin||0).toFixed(2)}%\n`,s+=`حالة الربحية,${(t.netProfit||0)>=0?"ربح":"خسارة"}\n\n`,t.expensesByType&&t.expensesByType.length>0&&(s+="توزيع المصروفات حسب النوع\n",s+="نوع المصروف,المبلغ,النسبة المئوية\n",t.expensesByType.forEach(e=>{s+=`"${e.type}","${Mn(e.amount)}","${e.percentage.toFixed(2)}%"\n`}),s+="\n"),s+="توزيع طرق الدفع\n",s+="طريقة الدفع,المبلغ,عدد المعاملات\n",Object.entries(t.paymentMethodStats).forEach(([e,t])=>{s+=`"${e}","${Mn(t.amount)}","${t.count}"\n`}),s+="\n",s+="إحصائيات المخزون (مفلترة)\n",s+=`إجمالي العناصر,${a.totalItems}\n`,s+=`القيمة الإجمالية,${Mn(a.totalValue)}\n`,s+=`عناصر منخفضة المخزون,${a.lowStockItems}\n`,s+=`عناصر نفدت من المخزون,${a.outOfStockItems}\n`,s+=`عناصر منتهية الصلاحية,${a.expiredItems}\n`,s+=`عناصر قريبة الانتهاء (30 يوم),${a.nearExpiryItems}\n\n`,e.appointments.length>0&&(s+="تفاصيل المواعيد المفلترة\n",s+="التاريخ,الوقت,اسم المريض,عنوان الموعد,نوع العلاج,التكلفة,الحالة,ملاحظات\n",e.appointments.forEach(e=>{const t=In(e.start_time),n=new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}),a=e.patient?.full_name||e.patient?.name||"غير محدد",r=e.title||"غير محدد",i=e.treatment_type||"غير محدد",l=e.cost?Mn(e.cost):"0",o=this.getStatusInArabic(e.status),c=e.notes||"";s+=`"${t}","${n}","${a}","${r}","${i}","${l}","${o}","${c}"\n`}),s+="\n"),e.payments.length>0&&(s+="تفاصيل المدفوعات المفلترة\n",s+="تاريخ الدفع,اسم المريض,الوصف,المبلغ,المبلغ المدفوع,الرصيد المتبقي,طريقة الدفع,الحالة,رقم الإيصال,ملاحظات\n",e.payments.forEach(e=>{const t=In(e.payment_date),n=e.patient?.full_name||e.patient?.name||"غير محدد",a=e.description||"غير محدد";let r,i,l;if("partial"===e.status){const t=Number(e.total_amount_due||e.amount)||0,n=Number(e.amount_paid||e.amount)||0;r=Mn(t),i=Mn(n),l=Mn(Math.max(0,t-n))}else e.appointment_id&&e.treatment_total_cost?(r=Mn(Number(e.treatment_total_cost)||0),i=Mn(Number(e.treatment_total_paid||e.amount)||0),l=Mn(Number(e.treatment_remaining_balance||0))):(r=Mn(Number(e.amount)||0),i=Mn(Number(e.amount)||0),l=Mn(0));const o=this.getPaymentMethodInArabic(e.payment_method),c=Oa(e.status),d=e.receipt_number||"",m=e.notes||"";s+=`"${t}","${n}","${a}","${r}","${i}","${l}","${o}","${c}","${d}","${m}"\n`}),s+="\n"),e.inventory.length>0&&(s+="تفاصيل المخزون المفلتر\n",s+="اسم الصنف,الوصف,الفئة,الكمية,الوحدة,الحد الأدنى,تكلفة الوحدة,القيمة الإجمالية,المورد,تاريخ الانتهاء,الحالة,تاريخ الإنشاء\n",e.inventory.forEach(e=>{const t=e.name||"غير محدد",n=e.description||"غير محدد",a=e.category||"غير محدد",r=e.quantity||0,i=e.unit||"قطعة",l=e.minimum_stock||0,o=Mn(e.cost_per_unit||0),c=Mn((e.cost_per_unit||0)*(e.quantity||0)),d=e.supplier||"غير محدد",m=e.expiry_date?In(e.expiry_date):"غير محدد",u=this.getInventoryStatusInArabic(e.quantity||0,e.minimum_stock||0),p=In(e.created_at);s+=`"${t}","${n}","${a}","${r}","${i}","${l}","${o}","${c}","${d}","${m}","${u}","${p}"\n`}),s+="\n"),e.patients.length>0){s+="تفاصيل المرضى (أحدث 50 مريض)\n",s+="#,الاسم الكامل,رقم الهاتف,العمر,الجنس,الحالة الطبية,الحساسية,البريد الإلكتروني,العنوان,تاريخ التسجيل,آخر موعد,إجمالي المواعيد,إجمالي المدفوعات,الرصيد المتبقي,ملاحظات\n";const t=[...e.patients].sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,50);t.forEach(t=>{const n=t.serial_number||"غير محدد",a=t.full_name||t.name||"غير محدد",r=t.phone||"غير محدد",i=t.age||"غير محدد",l="male"===t.gender?"ذكر":"female"===t.gender?"أنثى":"غير محدد",o=t.patient_condition||"غير محدد",c=t.allergies||"لا يوجد",d=t.email||"غير محدد",m=t.address||"غير محدد",u=In(t.created_at),p=t.notes||"لا يوجد",h=e.appointments.filter(e=>e.patient_id===t.id),x=e.payments.filter(e=>e.patient_id===t.id),g=h.length>0?In(h.sort((e,t)=>new Date(t.start_time).getTime()-new Date(e.start_time).getTime())[0].start_time):"لا يوجد",f=h.length;let v=0,y=0,b=0,j=0;h.forEach(e=>{if(e.cost){const t=x.filter(t=>t.appointment_id===e.id).reduce((e,t)=>e+(t.amount||0),0);b+=e.cost,j+=t}});x.filter(e=>!e.appointment_id).forEach(e=>{j+=e.amount||0,e.total_amount_due&&(b+=e.total_amount_due)}),v+=j,y+=Math.max(0,b-j),s+=`"${n}","${a}","${r}","${i}","${l}","${o}","${c}","${d}","${m}","${u}","${g}","${f}","${Mn(v)}","${Mn(y)}","${p}"\n`}),s+="\n"}s+="ملخص إضافي للطبيب\n",s+=`متوسط قيمة الموعد,${n.total>0?Mn(t.totalRevenue/n.total):"0"}\n`,s+=`متوسط المدفوعات اليومية,${this.calculateDailyAverage(e.payments,t.totalRevenue)}\n`,s+=`نسبة المدفوعات المكتملة,${t.totalTransactions>0?Math.round(t.completedTransactions/t.totalTransactions*100):0}%\n`,s+=`نسبة المدفوعات الجزئية,${t.totalTransactions>0?Math.round(t.partialTransactions/t.totalTransactions*100):0}%\n`,s+=`نسبة الإلغاء,${n.total>0?Math.round(n.cancelled/n.total*100):0}%\n`,s+=`متوسط عدد المواعيد لكل مريض,${e.patients.length>0?Math.round(n.total/e.patients.length*100)/100:0}\n`,s+=`متوسط الإيرادات لكل مريض,${e.patients.length>0?Mn(t.totalRevenue/e.patients.length):"0"}\n\n`,s+="تحليلات متقدمة\n";const r=e.appointments.reduce((e,t)=>e+(t.cost||0),0),i=r>0?Math.round(t.totalRevenue/r*100):0;s+=`معدل التحصيل,${i}%\n`;const l=this.analyzeTreatmentTypes(e.appointments);s+=`أكثر أنواع العلاج طلباً,${l.mostCommon}\n`,s+=`أعلى أنواع العلاج قيمة,${l.highestValue}\n`;const o=this.analyzeAppointmentTimes(e.appointments);s+=`أكثر الأوقات ازدحاماً,${o.peakHour}\n`,s+=`أكثر الأيام ازدحاماً,${o.peakDay}\n`;const c=this.analyzePatients(e.patients,e.appointments,e.payments);return s+=`أكثر المرضى زيارة,${c.mostFrequent}\n`,s+=`أعلى المرضى إنفاقاً,${c.highestSpender}\n`,s+="\nتوصيات للطبيب\n",n.attendanceRate<80&&(s+=`توصية,تحسين معدل الحضور - النسبة الحالية ${n.attendanceRate}% منخفضة\n`),i<90&&(s+=`توصية,تحسين معدل التحصيل - النسبة الحالية ${i}% منخفضة\n`),t.partialTransactions>t.completedTransactions&&(s+=`توصية,متابعة المدفوعات الجزئية - ${t.partialTransactions} معاملة جزئية مقابل ${t.completedTransactions} مكتملة\n`),a.lowStockItems>0&&(s+=`توصية,تجديد المخزون - ${a.lowStockItems} صنف منخفض المخزون\n`),a.expiredItems>0&&(s+=`توصية,إزالة المواد المنتهية الصلاحية - ${a.expiredItems} صنف منتهي الصلاحية\n`),a.nearExpiryItems>0&&(s+=`توصية,استخدام المواد قريبة الانتهاء - ${a.nearExpiryItems} صنف ينتهي خلال 30 يوم\n`),n.cancelled>.2*n.completed&&(s+=`توصية,تقليل معدل الإلغاء - ${n.cancelled} موعد ملغي من أصل ${n.total}\n`),t.overdueAmount>.1*t.totalRevenue&&(s+=`توصية,متابعة المدفوعات المتأخرة - ${Mn(t.overdueAmount)} مبلغ متأخر\n`),s}static getStatusInArabic(e){return{scheduled:"مجدول",completed:"مكتمل",cancelled:"ملغي","no-show":"لم يحضر",confirmed:"مؤكد",pending:"معلق"}[e]||e}static getPaymentMethodInArabic(e){return{cash:"نقدي",bank_transfer:"تحويل بنكي",credit_card:"بطاقة ائتمان",debit_card:"بطاقة خصم"}[e]||e}static getInventoryStatusInArabic(e,t){return 0===e?"نفد من المخزون":e<=t?"منخفض المخزون":"متوفر"}static calculateDailyAverage(e,t){if(0===e.length)return"0";const n=new Set(e.map(e=>e.payment_date.split("T")[0])).size;if(0===n)return"0";return Mn(t/n)}static calculateAge(e){try{const t=new Date(e),n=new Date;let a=n.getFullYear()-t.getFullYear();const s=n.getMonth()-t.getMonth();return(s<0||0===s&&n.getDate()<t.getDate())&&a--,a.toString()}catch(t){return"غير محدد"}}static calculateAverageAge(e){if(0===e.length)return"0";const t=e.reduce((e,t)=>e+("number"==typeof t.age?t.age:0),0)/e.length;return Math.round(t).toString()}static getGenderDistribution(e){if(0===e.length)return"لا يوجد بيانات";const t=e.filter(e=>"male"===e.gender).length,n=e.filter(e=>"female"===e.gender).length;return`ذكور: ${t} (${Math.round(t/e.length*100)}%) - إناث: ${n} (${Math.round(n/e.length*100)}%)`}static getNewPatientsThisMonth(e){const t=(new Date).toISOString().slice(0,7);return e.filter(e=>e.created_at.startsWith(t)).length}static getActivePatients(e,t){const n=new Date;n.setMonth(n.getMonth()-3);const a=new Set(t.filter(e=>new Date(e.start_time)>=n).map(e=>e.patient_id));return a.size}static analyzeTreatmentTypes(e){const t={};e.forEach(e=>{const n=e.title||e.treatment_type||"غير محدد",a=this.getTreatmentNameInArabic(n);t[a]||(t[a]={count:0,totalValue:0}),t[a].count++,t[a].totalValue+=e.cost||0});const n=Object.entries(t).sort((e,t)=>t[1].count-e[1].count),a=Object.entries(t).sort((e,t)=>t[1].totalValue-e[1].totalValue);return{mostCommon:n.length>0?`${n[0][0]} (${n[0][1].count} مرة)`:"لا يوجد",highestValue:a.length>0?`${a[0][0]} (${Mn(a[0][1].totalValue)})`:"لا يوجد"}}static analyzeAppointmentTimes(e){const t={},n={};e.forEach(e=>{const a=new Date(e.start_time),s=a.getHours(),r=a.toLocaleDateString("ar-SA",{weekday:"long"});t[s]=(t[s]||0)+1,n[r]=(n[r]||0)+1});const a=Object.entries(t).sort((e,t)=>t[1]-e[1])[0],s=Object.entries(n).sort((e,t)=>t[1]-e[1])[0];return{peakHour:a?`${a[0]}:00 (${a[1]} موعد)`:"لا يوجد",peakDay:s?`${s[0]} (${s[1]} موعد)`:"لا يوجد"}}static analyzePatients(e,t,n){const a={};e.forEach(e=>{const s=t.filter(t=>t.patient_id===e.id),r=n.filter(t=>t.patient_id===e.id).reduce((e,t)=>e+("partial"===t.status&&void 0!==t.amount_paid?Number(t.amount_paid):Number(t.amount)),0);a[e.id]={name:e.full_name||e.name||"غير محدد",appointmentCount:s.length,totalPayments:r}});const s=Object.values(a).sort((e,t)=>t.appointmentCount-e.appointmentCount),r=Object.values(a).sort((e,t)=>t.totalPayments-e.totalPayments);return{mostFrequent:s.length>0?`${s[0].name} (${s[0].appointmentCount} موعد)`:"لا يوجد",highestSpender:r.length>0?`${r[0].name} (${Mn(r[0].totalPayments)})`:"لا يوجد"}}static async exportComprehensiveReport(e){try{const t=function(e,t,n){const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(e){case"today":const e=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999);return{startDate:s,endDate:e};case"yesterday":const r=new Date(s.getFullYear(),s.getMonth(),s.getDate()-1),i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999);return{startDate:r,endDate:i};case"this_week":const l=new Date(s);return l.setDate(s.getDate()-s.getDay()),{startDate:l,endDate:a};case"last_week":const o=new Date(s);o.setDate(s.getDate()-s.getDay()-7);const c=new Date(o);return c.setDate(o.getDate()+6),c.setHours(23,59,59,999),{startDate:o,endDate:c};case"this_month":return{startDate:new Date(s.getFullYear(),s.getMonth(),1),endDate:a};case"last_month":const d=new Date(s.getFullYear(),s.getMonth()-1,1),m=new Date(s.getFullYear(),s.getMonth(),0);return m.setHours(23,59,59,999),{startDate:d,endDate:m};case"this_quarter":return{startDate:new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3),1),endDate:a};case"last_quarter":const u=new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3)-3,1),p=new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3),0);return p.setHours(23,59,59,999),{startDate:u,endDate:p};case"this_year":return{startDate:new Date(s.getFullYear(),0,1),endDate:a};case"last_year":const h=new Date(s.getFullYear()-1,0,1),x=new Date(s.getFullYear()-1,11,31);return x.setHours(23,59,59,999),{startDate:h,endDate:x};case"last_30_days":return{startDate:new Date(s.getFullYear(),s.getMonth(),s.getDate()-30),endDate:new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999)};case"last_90_days":return{startDate:new Date(s.getFullYear(),s.getMonth(),s.getDate()-90),endDate:new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999)};case"custom":return t&&n?{startDate:new Date(t+"T00:00:00"),endDate:new Date(n+"T23:59:59.999")}:{startDate:new Date(0),endDate:a};default:return{startDate:new Date(0),endDate:a}}}(e.timePeriod,e.customStartDate,e.customEndDate),n=this.filterAllDataByDateRange(e,t);e.expenses&&(n.expenses=e.expenses.filter(e=>{if(!e.payment_date)return!1;const n=new Date(e.payment_date);return n>=t.startDate&&n<=t.endDate}));const a=function(e){return console.log("🔍 Validating data before export..."),Dh.validateAllData(e).isAllValid?(console.log("✅ Data validation passed! Export will contain accurate values."),e.filterInfo&&console.log("📊 Filter information:",e.filterInfo),!0):(console.error("❌ Data validation failed! Export may contain incorrect values."),!1)}({payments:n.payments,appointments:n.appointments,inventory:n.inventory,filterInfo:{appointmentFilter:Eh[e.timePeriod],paymentFilter:Eh[e.timePeriod],inventoryFilter:Eh[e.timePeriod]}});if(!a)throw new Error("فشل في التحقق من صحة البيانات");const s=this.calculateAllAspectsStats(n,t);this.generateEnhancedComprehensiveCSV({patients:e.patients,appointments:n.appointments,payments:n.payments,inventory:n.inventory,treatments:n.treatments,prescriptions:n.prescriptions,labOrders:n.labOrders,clinicNeeds:n.clinicNeeds,timePeriod:e.timePeriod,stats:s});await this.exportComprehensiveReportToExcel({patients:e.patients,appointments:n.appointments,payments:n.payments,inventory:n.inventory,treatments:n.treatments,prescriptions:n.prescriptions,labOrders:n.labOrders,clinicNeeds:n.clinicNeeds,expenses:n.expenses||[],timePeriod:e.timePeriod,stats:s,dateRange:t})}catch(t){throw console.error("Error exporting comprehensive report:",t),new Error("فشل في تصدير التقرير الشامل")}}static calculateComprehensiveStats(e){const t=this.calculateFinancialStats(e.filteredPayments,e.labOrders,e.clinicNeeds,e.filteredInventory,e.expenses);return{totalPatients:e.patients.length,totalAppointments:e.filteredAppointments.length,totalPayments:e.filteredPayments.length,totalInventoryItems:e.filteredInventory.length,totalLabOrders:e.labOrders?.length||0,totalClinicNeeds:e.clinicNeeds?.length||0,...t,appointmentsByStatus:this.groupByStatus(e.filteredAppointments,"status"),paymentsByMethod:this.groupByMethod(e.filteredPayments),inventoryByCategory:this.groupByCategory(e.filteredInventory)}}static generateEnhancedComprehensiveCSV(e){let t="\ufeff";return t+="التقرير الشامل المفصل للعيادة - جميع الجوانب\n",t+=`تاريخ التقرير,${this.formatGregorianDate(new Date)}\n`,t+=`وقت التقرير,${(new Date).toLocaleTimeString("ar-SA")}\n`,t+=`الفترة الزمنية,${Eh[e.timePeriod]}\n`,e.stats.dateRange&&(t+=`نطاق التواريخ,${e.stats.dateRange.period}\n`),t+="\n",t+="=== ملخص عام شامل ===\n",t+=`إجمالي المرضى,${e.stats.totalPatients}\n`,t+=`إجمالي المواعيد (مفلترة),${e.stats.totalAppointments}\n`,t+=`إجمالي المدفوعات (مفلترة),${e.stats.totalPayments}\n`,t+=`إجمالي العلاجات (مفلترة),${e.stats.totalTreatments}\n`,t+=`إجمالي الوصفات (مفلترة),${e.stats.totalPrescriptions}\n`,t+=`إجمالي طلبات المخابر (مفلترة),${e.stats.totalLabOrders}\n`,t+=`إجمالي احتياجات العيادة (مفلترة),${e.stats.totalClinicNeeds}\n`,t+=`إجمالي عناصر المخزون,${e.stats.totalInventoryItems}\n\n`,t+="تحليل الأرباح والخسائر الشامل\n",t+="=================================\n\n",t+="الإيرادات\n",t+=`المدفوعات المكتملة,${Mn(e.stats.completedPayments||0)}\n`,t+=`المدفوعات الجزئية,${Mn(e.stats.partialPayments||0)}\n`,t+=`إجمالي الإيرادات,${Mn(e.stats.totalRevenue||0)}\n`,t+=`المبالغ المتبقية من المدفوعات الجزئية,${Mn(e.stats.remainingBalances||0)}\n`,t+=`المدفوعات المعلقة,${Mn(e.stats.pendingAmount||0)}\n\n`,t+="المصروفات\n",t+=`إجمالي المدفوعات للمخابر,${Mn(e.stats.labOrdersTotal||0)}\n`,t+=`إجمالي المتبقي للمخابر,${Mn(e.stats.labOrdersRemaining||0)}\n`,t+=`إجمالي المدفوعات للاحتياجات والمخزون,${Mn(e.stats.clinicNeedsTotal||0)}\n`,t+=`إجمالي المتبقي للاحتياجات,${Mn(e.stats.clinicNeedsRemaining||0)}\n`,t+=`قيمة المخزون الحالي,${Mn(e.stats.inventoryExpenses||0)}\n`,t+=`مصروفات العيادة المباشرة,${Mn(e.stats.clinicExpensesTotal||0)}\n`,t+=`إجمالي المصروفات,${Mn(e.stats.totalExpenses||0)}\n\n`,t+="النتيجة النهائية\n",e.stats.isProfit?(t+=`صافي الربح,${Mn(e.stats.netProfit||0)}\n`,t+=`نسبة الربح,${(e.stats.profitMargin||0).toFixed(2)}%\n`,t+="الحالة,ربح\n"):(t+=`إجمالي الخسارة,${Mn(e.stats.lossAmount||0)}\n`,t+=`نسبة الخسارة,${Math.abs(e.stats.profitMargin||0).toFixed(2)}%\n`,t+="الحالة,خسارة\n"),t+="\n",t+="تحليل المواعيد التفصيلي\n",t+="========================\n",t+=`إجمالي المواعيد,${e.stats.total||0}\n`,t+=`المواعيد المكتملة,${e.stats.completed||0}\n`,t+=`المواعيد الملغية,${e.stats.cancelled||0}\n`,t+=`المواعيد المجدولة,${e.stats.scheduled||0}\n`,t+=`المواعيد الغائبة,${e.stats.noShow||0}\n`,t+=`معدل الحضور,${e.stats.attendanceRate||0}%\n`,e.stats.peakHour&&(t+=`أكثر الأوقات ازدحاماً,${e.stats.peakHour}\n`),t+=`متوسط المواعيد يومياً,${e.stats.averagePerDay||0}\n\n`,t+="تحليل العلاجات التفصيلي\n",t+="========================\n",t+=`إجمالي العلاجات,${e.stats.totalTreatments||0}\n`,t+=`العلاجات المكتملة,${e.stats.completedTreatments||0}\n`,t+=`العلاجات المخططة,${e.stats.plannedTreatments||0}\n`,t+=`العلاجات قيد التنفيذ,${e.stats.inProgressTreatments||0}\n`,t+=`العلاجات الملغية,${e.stats.cancelledTreatments||0}\n`,t+=`معدل إنجاز العلاجات,${e.stats.completionRate||0}%\n`,e.stats.mostTreatedTooth&&(t+=`أكثر الأسنان علاجاً,السن رقم ${e.stats.mostTreatedTooth.tooth} (${e.stats.mostTreatedTooth.count} علاج)\n`),t+="\n",t+="توزيع أنواع العلاجات\n",e.stats.treatmentTypes&&"object"==typeof e.stats.treatmentTypes?Object.entries(e.stats.treatmentTypes).forEach(([e,n])=>{const a=this.getTreatmentNameInArabic(e);t+=`${a},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",t+="توزيع الأسنان المعالجة\n",e.stats.teethTreated&&"object"==typeof e.stats.teethTreated?Object.entries(e.stats.teethTreated).forEach(([e,n])=>{t+=`السن رقم ${e},${n} علاج\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",e.treatments&&e.treatments.length>0&&e.treatments.length<=100&&(t+="تفاصيل العلاجات الفردية\n",t+="المريض,رقم السن,نوع العلاج,الفئة,الحالة,تاريخ البداية,تاريخ الإكمال,التكلفة,ملاحظات\n",e.treatments.forEach(n=>{const a=e.patients.find(e=>e.id===n.patient_id),s=a?a.full_name||a.name||`${a.first_name||""} ${a.last_name||""}`.trim():"غير محدد",r=n.start_date?In(n.start_date):"غير محدد",i=n.completion_date?In(n.completion_date):"غير محدد",l=n.cost?Mn(n.cost):"غير محدد",o=(n.notes||"").replace(/,/g,"؛"),c=this.getTreatmentNameInArabic(n.treatment_type||"غير محدد"),d=this.getCategoryNameInArabic(n.treatment_category||"غير محدد"),m=this.getStatusLabelInArabic(n.treatment_status||"غير محدد");t+=`"${s}",${n.tooth_number||"غير محدد"},"${c}","${d}","${m}",${r},${i},${l},"${o}"\n`}),t+="\n"),t+="تحليل الوصفات\n",t+="===============\n",t+=`إجمالي الوصفات,${e.stats.totalPrescriptions||0}\n`,t+=`المرضى الذين لديهم وصفات,${e.stats.patientsWithPrescriptions||0}\n`,t+=`متوسط الوصفات لكل مريض,${e.stats.averagePrescriptionsPerPatient||0}\n\n`,e.prescriptions&&e.prescriptions.length>0&&e.prescriptions.length<=50&&(t+="تفاصيل الوصفات الفردية\n",t+="تاريخ الوصفة,المريض,الموعد,ملاحظات\n",e.prescriptions.forEach(n=>{const a=n.prescription_date?In(n.prescription_date):"غير محدد";let s=n.patient_name||"غير محدد",r=n.appointment_title||"غير محدد";if("غير محدد"===s){const t=e.patients.find(e=>e.id===n.patient_id);s=t?t.full_name||t.name||`${t.first_name||""} ${t.last_name||""}`.trim():"غير محدد"}if("غير محدد"===r){const t=e.appointments.find(e=>e.id===n.appointment_id);r=t?t.title||t.description||"موعد طبي":"غير محدد"}const i=(n.notes||"").replace(/,/g,"؛");t+=`${a},"${s}","${r}","${i}"\n`}),t+="\n"),t+="تحليل طلبات المخابر\n",t+="==================\n",t+=`إجمالي طلبات المخابر,${e.stats.totalLabOrders||0}\n`,t+=`الطلبات المعلقة,${e.stats.pendingLabOrders||0}\n`,t+=`الطلبات المكتملة,${e.stats.completedLabOrders||0}\n`,t+=`الطلبات الملغية,${e.stats.cancelledLabOrders||0}\n`,t+=`معدل إنجاز طلبات المخابر,${e.stats.labOrdersCompletionRate||0}%\n`,t+=`إجمالي تكلفة المخابر,${Mn(e.stats.totalLabCost||0)}\n`,t+=`إجمالي المدفوع للمخابر,${Mn(e.stats.totalLabPaid||0)}\n`,t+=`إجمالي المتبقي للمخابر,${Mn(e.stats.totalLabRemaining||0)}\n`,e.stats.mostUsedLab&&(t+=`أكثر المخابر استخداماً,${e.stats.mostUsedLab.lab} (${e.stats.mostUsedLab.count} طلب)\n`),t+="\n",t+="توزيع المخابر المستخدمة\n",e.stats.labFrequency&&"object"==typeof e.stats.labFrequency?Object.entries(e.stats.labFrequency).forEach(([e,n])=>{t+=`${e},${n} طلب\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",e.labOrders&&e.labOrders.length>0&&e.labOrders.length<=50&&(t+="تفاصيل طلبات المخابر الفردية\n",t+="تاريخ الطلب,المختبر,المريض,الحالة,التكلفة,المدفوع,المتبقي,ملاحظات\n",e.labOrders.forEach(n=>{const a=n.order_date?In(n.order_date):"غير محدد",s=n.lab_name||n.laboratory||"غير محدد",r=e.patients.find(e=>e.id===n.patient_id),i=r?r.full_name||r.name||`${r.first_name||""} ${r.last_name||""}`.trim():"غير محدد",l=n.status||"غير محدد",o=n.cost?Mn(n.cost):"غير محدد",c=n.paid_amount?Mn(n.paid_amount):"غير محدد",d=n.remaining_balance?Mn(n.remaining_balance):"غير محدد",m=(n.notes||"").replace(/,/g,"؛");t+=`${a},"${s}","${i}",${l},${o},${c},${d},"${m}"\n`}),t+="\n"),t+="تحليل احتياجات العيادة\n",t+="=====================\n",t+=`إجمالي الاحتياجات,${e.stats.totalClinicNeeds||0}\n`,t+=`الاحتياجات المعلقة,${e.stats.pendingNeeds||0}\n`,t+=`الاحتياجات المطلوبة,${e.stats.orderedNeeds||0}\n`,t+=`الاحتياجات المستلمة,${e.stats.receivedNeeds||0}\n`,t+=`الاحتياجات الملغية,${e.stats.cancelledNeeds||0}\n`,t+=`معدل إنجاز الاحتياجات,${e.stats.needsCompletionRate||0}%\n`,t+=`إجمالي قيمة الاحتياجات,${Mn(e.stats.totalNeedsValue||0)}\n`,t+=`الاحتياجات العاجلة,${e.stats.urgentNeeds||0}\n`,t+=`الاحتياجات عالية الأولوية,${e.stats.highPriorityNeeds||0}\n\n`,t+="توزيع الأولويات\n",e.stats.priorityAnalysis&&"object"==typeof e.stats.priorityAnalysis?Object.entries(e.stats.priorityAnalysis).forEach(([e,n])=>{t+=`${"urgent"===e?"عاجل":"high"===e?"عالي":"medium"===e?"متوسط":"low"===e?"منخفض":e},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",t+="توزيع فئات الاحتياجات\n",e.stats.categoryAnalysis&&"object"==typeof e.stats.categoryAnalysis?Object.entries(e.stats.categoryAnalysis).forEach(([e,n])=>{t+=`${e},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",e.clinicNeeds&&e.clinicNeeds.length>0&&e.clinicNeeds.length<=50&&(t+="تفاصيل احتياجات العيادة الفردية\n",t+="تاريخ الطلب,اسم الصنف,الفئة,الكمية,السعر,القيمة الإجمالية,الأولوية,الحالة,ملاحظات\n",e.clinicNeeds.forEach(e=>{const n=e.created_at?In(e.created_at):"غير محدد",a=e.item_name||"غير محدد",s=e.category||"غير محدد",r=e.quantity||0,i=e.price?Mn(e.price):"غير محدد",l=Mn((e.quantity||0)*(e.price||0)),o="urgent"===e.priority?"عاجل":"high"===e.priority?"عالي":"medium"===e.priority?"متوسط":"low"===e.priority?"منخفض":e.priority||"غير محدد",c="pending"===e.status?"معلق":"ordered"===e.status?"مطلوب":"received"===e.status?"مستلم":"cancelled"===e.status?"ملغي":e.status||"غير محدد",d=(e.notes||"").replace(/,/g,"؛");t+=`${n},"${a}","${s}",${r},${i},${l},"${o}","${c}","${d}"\n`}),t+="\n"),t+="توزيع المواعيد حسب الحالة\n",e.stats.appointmentsByStatus&&"object"==typeof e.stats.appointmentsByStatus?Object.entries(e.stats.appointmentsByStatus).forEach(([e,n])=>{t+=`${e},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",t+="توزيع المدفوعات حسب طريقة الدفع\n",e.stats.paymentsByMethod&&"object"==typeof e.stats.paymentsByMethod?Object.entries(e.stats.paymentsByMethod).forEach(([e,n])=>{t+=`${e},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",t+="توزيع المخزون حسب الفئة\n",e.stats.inventoryByCategory&&"object"==typeof e.stats.inventoryByCategory?Object.entries(e.stats.inventoryByCategory).forEach(([e,n])=>{t+=`${e},${n}\n`}):t+="لا توجد بيانات متاحة\n",t+="\n",e.payments.length>0&&(t+="تفاصيل المدفوعات المفلترة\n",t+="رقم الإيصال,المريض,المبلغ,طريقة الدفع,الحالة,تاريخ الدفع,الوصف\n",e.payments.forEach(n=>{const a=e.patients.find(e=>e.id===n.patient_id)?.full_name||"غير محدد";t+=`"${n.receipt_number||`#${n.id.slice(-6)}`}","${a}","${Mn(n.amount)}","${n.payment_method}","${n.status}","${In(n.payment_date)}","${n.description||"-"}"\n`}),t+="\n"),e.appointments.length>0&&(t+="تفاصيل المواعيد المفلترة\n",t+="المريض,العنوان,التاريخ,الوقت,الحالة,التكلفة\n",e.appointments.forEach(n=>{const a=e.patients.find(e=>e.id===n.patient_id)?.full_name||"غير محدد";t+=`"${a}","${n.title||"-"}","${In(n.start_time)}","${Bn(n.start_time)}","${n.status}","${Mn(n.cost||0)}"\n`}),t+="\n"),e.inventory.length>0&&(t+="تفاصيل المخزون المفلتر\n",t+="اسم المنتج,الفئة,الكمية,السعر,تاريخ الانتهاء,الحالة\n",e.inventory.forEach(e=>{t+=`"${e.name}","${e.category||"-"}","${e.quantity}","${Mn(e.price||0)}","${e.expiry_date?In(e.expiry_date):"-"}","${e.status||"-"}"\n`})),t}static getTreatmentNameInArabic(e){return Fa(e)}static getCategoryNameInArabic(e){return Pa(e)}static getStatusLabelInArabic(e){return Ra(e)}static formatGregorianDate(e){if(!e||isNaN(e.getTime()))return"غير محدد";return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`}static async exportComprehensiveReportToExcel(e){const t=new ct.Workbook;t.creator="نظام إدارة العيادة",t.created=new Date,t.modified=new Date,t.title="التقرير الشامل المفصل",t.description="تقرير شامل لجميع جوانب العيادة",await this.createSummarySheet(t,e),await this.createPatientsSheet(t,e),await this.createAppointmentsSheet(t,e),await this.createPaymentsSheet(t,e),await this.createInventorySheet(t,e),await this.createLabOrdersSheet(t,e),await this.createClinicNeedsSheet(t,e),await this.createExpensesSheet(t,e),await this.createProfitLossSheet(t,e);const n=`التقرير_الشامل_المفصل_${Eh[e.timePeriod]}_${(new Date).toISOString().split("T")[0]}`,a=await t.xlsx.writeBuffer(),s=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=document.createElement("a"),i=URL.createObjectURL(s);r.setAttribute("href",i),r.setAttribute("download",`${n}.xlsx`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),console.log("✅ تم تصدير التقرير الشامل المفصل بنجاح")}static async createSummarySheet(e,t){try{console.log("Creating summary sheet with data:",t);const n=e.addWorksheet("الملخص العام");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="التقرير الشامل المفصل - عيادة الأسنان",a.font={size:18,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF2E8B57"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"thick"},left:{style:"thick"},bottom:{style:"thick"},right:{style:"thick"}},n.getCell("A3").value=`تاريخ التقرير: ${In(new Date)}`,n.getCell("A3").font={size:12,italic:!0};const s=t.timePeriod&&Eh[t.timePeriod]?Eh[t.timePeriod]:t.timePeriod||"غير محدد";n.getCell("A4").value=`الفترة الزمنية: ${s}`,n.getCell("A4").font={size:12,italic:!0};let r=6;const i=Array.isArray(t.patients)?t.patients:[],l=Array.isArray(t.appointments)?t.appointments:[],o=Array.isArray(t.payments)?t.payments:[],c=Array.isArray(t.inventory)?t.inventory:[],d=Array.isArray(t.labOrders)?t.labOrders:[],m=Array.isArray(t.clinicNeeds)?t.clinicNeeds:[],u=Array.isArray(t.expenses)?t.expenses:[];console.log("Data arrays lengths:",{patients:i.length,appointments:l.length,payments:o.length,inventory:c.length,labOrders:d.length,clinicNeeds:m.length,expenses:u.length});const p=[["إجمالي المرضى",i.length],["إجمالي المواعيد",l.length],["إجمالي المدفوعات",o.length],["إجمالي عناصر المخزون",c.length],["إجمالي طلبات المختبرات",d.length],["إجمالي احتياجات العيادة",m.length],["إجمالي مصروفات العيادة",u.length]];n.getCell(`A${r}`).value="الإحصائيات الأساسية",n.getCell(`A${r}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},r+=2,Array.isArray(p)&&p.forEach(([e,t])=>{n.getCell(`A${r}`).value=e,n.getCell(`B${r}`).value=t,n.getCell(`A${r}`).font={bold:!0};["A","B"].forEach(e=>{const t=n.getCell(`${e}${r}`);t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}},t.alignment={horizontal:"right",vertical:"middle"}}),r++}),r+=2,n.getCell(`A${r}`).value="الإحصائيات المالية",n.getCell(`A${r}`).font={size:14,bold:!0,color:{argb:"FF2E8B57"}},r+=2;const h=t.stats||{},x=[["إجمالي الإيرادات",Mn(h.totalRevenue||0)],["المدفوعات المكتملة",Mn(h.completedPayments||0)],["المدفوعات الجزئية",Mn(h.partialPayments||0)],["المبالغ المعلقة",Mn(h.pendingAmount||0)],["إجمالي المصروفات",Mn(h.totalExpenses||0)],["صافي الربح/الخسارة",Mn(h.netProfit||0)]];Array.isArray(x)&&x.forEach(([e,t])=>{n.getCell(`A${r}`).value=e,n.getCell(`B${r}`).value=t,n.getCell(`A${r}`).font={bold:!0};["A","B"].forEach(e=>{const t=n.getCell(`${e}${r}`);t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}},t.alignment={horizontal:"right",vertical:"middle"}}),r++}),n.getColumn("A").width=30,n.getColumn("B").width=20,console.log("Summary sheet created successfully")}catch(n){throw console.error("Error creating summary sheet:",n),n}}static async createPatientsSheet(e,t){const n=e.addWorksheet("المرضى");n.mergeCells("A1:G1");const a=n.getCell("A1");a.value="تقرير المرضى",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=t.patients||[],i=[["إجمالي المرضى",r.length],["المرضى الذكور",r.filter(e=>"male"===e.gender).length],["المرضى الإناث",r.filter(e=>"female"===e.gender).length],["متوسط العمر",r.length>0?Math.round(r.reduce((e,t)=>e+(t.age||0),0)/r.length):0]];n.getCell(`A${s}`).value="إحصائيات المرضى",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,i.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل المرضى",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["الرقم التسلسلي","الاسم الكامل","الجنس","العمر","الهاتف","البريد الإلكتروني","تاريخ التسجيل"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,r.forEach((e,t)=>{[e.serial_number||"",e.full_name||"","male"===e.gender?"ذكر":"female"===e.gender?"أنثى":"غير محدد",e.age||"",e.phone||"",e.email||"",e.created_at?In(e.created_at):""].forEach((e,a)=>{const r=n.getCell(s,a+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})}),s++}),n.columns.forEach(e=>{e.width=15})}static async createAppointmentsSheet(e,t){const n=e.addWorksheet("المواعيد");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="تقرير المواعيد",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF8B5CF6"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=Array.isArray(t.appointments)?t.appointments:[],i=[["إجمالي المواعيد",r.length],["المواعيد المكتملة",r.filter(e=>"completed"===e.status).length],["المواعيد الملغية",r.filter(e=>"cancelled"===e.status).length],["المواعيد المجدولة",r.filter(e=>"scheduled"===e.status).length]];n.getCell(`A${s}`).value="إحصائيات المواعيد",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,i.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل المواعيد",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["التاريخ","الوقت","اسم المريض","نوع العلاج","التكلفة","الحالة","الطبيب","ملاحظات"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF8B5CF6"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,Array.isArray(r)&&r.forEach((e,t)=>{[e.start_time?In(e.start_time):"",e.start_time?new Date(e.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"",e.patient?.full_name||"غير محدد",e.title||"غير محدد",e.cost?Mn(e.cost):"0",this.getStatusInArabic(e.status),e.doctor_name||"غير محدد",e.notes||""].forEach((e,a)=>{const r=n.getCell(s,a+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})}),s++}),n.columns.forEach(e=>{e.width=15})}static async createPaymentsSheet(e,t){const n=e.addWorksheet("المدفوعات");n.mergeCells("A1:I1");const a=n.getCell("A1");a.value="تقرير المدفوعات",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF10B981"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=Array.isArray(t.payments)?t.payments:[],i=r.reduce((e,t)=>e+(t.amount||0),0),l=r.filter(e=>"completed"===e.status),o=r.filter(e=>"partial"===e.status),c=r.filter(e=>"pending"===e.status),d=[["إجمالي المدفوعات",r.length],["إجمالي الإيرادات",Mn(i)],["المدفوعات المكتملة",l.length],["المدفوعات الجزئية",o.length],["المدفوعات المعلقة",c.length]];n.getCell(`A${s}`).value="إحصائيات المدفوعات",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,d.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل المدفوعات",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["تاريخ الدفع","اسم المريض","الوصف","المبلغ","المبلغ المدفوع","الرصيد المتبقي","طريقة الدفع","الحالة","رقم الإيصال"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF10B981"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,Array.isArray(r)&&r.forEach((e,t)=>{let a,r,i;"partial"===e.status?(a=Number(e.total_amount_due||e.amount)||0,r=Number(e.amount_paid||e.amount)||0,i=Math.max(0,a-r)):e.appointment_id&&e.appointment_total_cost?(a=Number(e.appointment_total_cost)||0,r=Number(e.appointment_total_paid||e.amount)||0,i=Number(e.appointment_remaining_balance||0)):(a=Number(e.amount)||0,r=Number(e.amount)||0,i=0);[e.payment_date?In(e.payment_date):"",e.patient?.full_name||"غير محدد",e.description||"غير محدد",Mn(a),Mn(r),Mn(i),e.payment_method||"غير محدد",this.getPaymentStatusInArabic(e.status),e.receipt_number||""].forEach((e,a)=>{const r=n.getCell(s,a+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),a>=3&&a<=5&&(r.font={bold:!0},r.fill||(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}}))}),s++}),n.columns.forEach(e=>{e.width=15})}static async createInventorySheet(e,t){const n=e.addWorksheet("المخزون");n.mergeCells("A1:F1");const a=n.getCell("A1");a.value="تقرير المخزون",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF59E0B"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=Array.isArray(t.inventory)?t.inventory:[],i=r.reduce((e,t)=>e+(t.cost||0)*(t.quantity||0),0),l=r.filter(e=>(e.quantity||0)<=5).length,o=[["إجمالي العناصر",r.length],["القيمة الإجمالية",Mn(i)],["عناصر منخفضة المخزون",l],["عناصر نفدت من المخزون",r.filter(e=>0===(e.quantity||0)).length]];n.getCell(`A${s}`).value="إحصائيات المخزون",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,o.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل المخزون",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["اسم المنتج","الفئة","الكمية","التكلفة","القيمة الإجمالية","تاريخ الانتهاء"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF59E0B"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,Array.isArray(r)&&r.forEach((e,t)=>{[e.name||"",e.category||"",e.quantity||0,Mn(e.cost||0),Mn((e.cost||0)*(e.quantity||0)),e.expiry_date?In(e.expiry_date):""].forEach((a,r)=>{const i=n.getCell(s,r+1);i.value=a,i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),2===r&&(e.quantity||0)<=5&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFECACA"}},i.font={bold:!0,color:{argb:"FFDC2626"}})}),s++}),n.columns.forEach(e=>{e.width=15})}static async createLabOrdersSheet(e,t){const n=e.addWorksheet("طلبات المختبرات");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="تقرير طلبات المختبرات",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF14B8A6"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=Array.isArray(t.labOrders)?t.labOrders:[],i=r.reduce((e,t)=>e+(t.cost||0),0),l=r.reduce((e,t)=>e+(t.paid_amount||0),0),o=i-l,c=[["إجمالي الطلبات",r.length],["إجمالي التكلفة",Mn(i)],["إجمالي المدفوع",Mn(l)],["إجمالي المتبقي",Mn(o)]];n.getCell(`A${s}`).value="إحصائيات طلبات المختبرات",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,c.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل طلبات المختبرات",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["تاريخ الطلب","المختبر","اسم المريض","الخدمة","التكلفة","المدفوع","المتبقي","الحالة"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF14B8A6"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,Array.isArray(r)&&r.forEach((e,a)=>{const r=(Array.isArray(t.patients)?t.patients:[]).find(t=>t.id===e.patient_id);[e.order_date?In(e.order_date):"",e.lab?.name||"غير محدد",r?.full_name||"غير محدد",e.service_name||"غير محدد",Mn(e.cost||0),Mn(e.paid_amount||0),Mn((e.cost||0)-(e.paid_amount||0)),e.status||"غير محدد"].forEach((e,t)=>{const r=n.getCell(s,t+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},a%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),t>=4&&t<=6&&(r.font={bold:!0},r.fill||(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}}))}),s++}),n.columns.forEach(e=>{e.width=15})}static async createClinicNeedsSheet(e,t){const n=e.addWorksheet("احتياجات العيادة");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="تقرير احتياجات العيادة",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEC4899"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=t.clinicNeeds.reduce((e,t)=>e+(t.price||0)*(t.quantity||0),0),i=t.clinicNeeds.filter(e=>"urgent"===e.priority).length,l=t.clinicNeeds.filter(e=>"pending"===e.status).length,o=[["إجمالي الاحتياجات",t.clinicNeeds.length],["إجمالي التكلفة المتوقعة",Mn(r)],["الاحتياجات العاجلة",i],["الاحتياجات المعلقة",l]];n.getCell(`A${s}`).value="إحصائيات احتياجات العيادة",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,o.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل احتياجات العيادة",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["تاريخ الطلب","اسم الصنف","الفئة","الكمية","السعر المتوقع","القيمة الإجمالية","الأولوية","الحالة"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEC4899"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,t.clinicNeeds.forEach((e,t)=>{[e.created_at?In(e.created_at):"",e.name||"غير محدد",e.category||"غير محدد",e.quantity||0,Mn(e.price||0),Mn((e.price||0)*(e.quantity||0)),{urgent:"عاجل",high:"عالي",medium:"متوسط",low:"منخفض"}[e.priority]||e.priority||"غير محدد",{pending:"معلق",ordered:"تم الطلب",received:"تم الاستلام"}[e.status]||e.status||"غير محدد"].forEach((a,r)=>{const i=n.getCell(s,r+1);i.value=a,i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),"urgent"===e.priority&&(i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFECACA"}},i.font={bold:!0,color:{argb:"FFDC2626"}})}),s++}),n.columns.forEach(e=>{e.width=15})}static async createExpensesSheet(e,t){const n=e.addWorksheet("مصروفات العيادة");n.mergeCells("A1:G1");const a=n.getCell("A1");a.value="تقرير مصروفات العيادة",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEF4444"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=t.expenses.reduce((e,t)=>e+(t.amount||0),0),i=t.expenses.filter(e=>"paid"===e.status),l=t.expenses.filter(e=>"pending"===e.status),o=[["إجمالي المصروفات",t.expenses.length],["إجمالي المبلغ",Mn(r)],["المصروفات المدفوعة",i.length],["المصروفات المعلقة",l.length]];n.getCell(`A${s}`).value="إحصائيات مصروفات العيادة",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2,o.forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفاصيل مصروفات العيادة",n.getCell(`A${s}`).font={size:14,bold:!0},s+=2;["تاريخ الدفع","اسم المصروف","النوع","المبلغ","طريقة الدفع","المورد","الحالة"].forEach((e,t)=>{const a=n.getCell(s,t+1);a.value=e,a.font={bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEF4444"}},a.alignment={horizontal:"center",vertical:"middle"},a.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}}}),s++,t.expenses.forEach((e,t)=>{[e.payment_date?In(e.payment_date):"",e.expense_name||"غير محدد",{salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"}[e.expense_type]||e.expense_type||"غير محدد",Mn(e.amount||0),{cash:"نقداً",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمان"}[e.payment_method]||e.payment_method||"غير محدد",e.vendor||"غير محدد","paid"===e.status?"مدفوع":"معلق"].forEach((e,a)=>{const r=n.getCell(s,a+1);r.value=e,r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},r.alignment={horizontal:"right",vertical:"middle"},t%2==0&&(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}),3===a&&(r.font={bold:!0},r.fill||(r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}}))}),s++}),n.columns.forEach(e=>{e.width=15})}static async createProfitLossSheet(e,t){const n=e.addWorksheet("الأرباح والخسائر");n.mergeCells("A1:H1");const a=n.getCell("A1");a.value="تقرير الأرباح والخسائر",a.font={size:16,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF7C3AED"}},a.alignment={horizontal:"center",vertical:"middle"};let s=3;const r=t.payments.reduce((e,t)=>e+(t.amount||0),0),i=t.labOrders.reduce((e,t)=>e+(t.cost||0),0),l=t.clinicNeeds.reduce((e,t)=>e+(t.price||0)*(t.quantity||0),0),o=t.inventory.reduce((e,t)=>e+(t.cost||0)*(t.quantity||0),0),c=t.expenses.reduce((e,t)=>e+(t.amount||0),0),d=i+l+o+c,m=r-d,u=m>=0,p=r>0?m/r*100:0;n.getCell(`A${s}`).value="ملخص الأرباح والخسائر",n.getCell(`A${s}`).font={size:14,bold:!0,color:{argb:"FF7C3AED"}},s+=2;[["إجمالي الإيرادات",Mn(r)],["إجمالي المصروفات",Mn(d)],["صافي الربح/الخسارة",Mn(Math.abs(m))],["نسبة الربح",`${p.toFixed(2)}%`],["الحالة المالية",u?"ربح":"خسارة"]].forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,n.getCell(`A${s}`).font={bold:!0},"الحالة المالية"===e&&(n.getCell(`B${s}`).font={bold:!0,color:{argb:u?"FF10B981":"FFEF4444"}}),s++}),s+=2,n.getCell(`A${s}`).value="تفصيل الإيرادات",n.getCell(`A${s}`).font={size:14,bold:!0,color:{argb:"FF10B981"}},s+=2;const h=t.payments.filter(e=>"completed"===e.status),x=t.payments.filter(e=>"partial"===e.status),g=t.payments.filter(e=>"pending"===e.status);[["المدفوعات المكتملة",`${h.length} (${Mn(h.reduce((e,t)=>e+(t.amount||0),0))})`],["المدفوعات الجزئية",`${x.length} (${Mn(x.reduce((e,t)=>e+(t.amount||0),0))})`],["المدفوعات المعلقة",`${g.length} (${Mn(g.reduce((e,t)=>e+(t.amount||0),0))})`]].forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),s+=2,n.getCell(`A${s}`).value="تفصيل المصروفات",n.getCell(`A${s}`).font={size:14,bold:!0,color:{argb:"FFEF4444"}},s+=2;[["تكاليف المختبرات",Mn(i)],["احتياجات العيادة",Mn(l)],["تكاليف المخزون",Mn(o)],["مصروفات مباشرة",Mn(c)]].forEach(([e,t])=>{n.getCell(`A${s}`).value=e,n.getCell(`B${s}`).value=t,s++}),n.getColumn("A").width=30,n.getColumn("B").width=20}static getPaymentStatusInArabic(e){return{completed:"مكتمل",partial:"جزئي",pending:"معلق",overdue:"متأخر",cancelled:"ملغي"}[e]||e}static filterByDateRange(e,t,n){if(!t||!t.start||!t.end)return e;const a=new Date(t.start),s=new Date(t.end);return s.setHours(23,59,59,999),e.filter(e=>{const t=new Date(e[n]);return t>=a&&t<=s})}}function Ah(){const{payments:t}=ca(),{expenses:n}=mh(),{inventoryItems:a}=ma(),{labOrders:s}=ph(),{clinicNeeds:r}=uh(),{currentCurrency:i}=oa(),[l,o]=re.useState(null),[c,d]=re.useState(!1),m=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},u=async()=>{d(!0);try{const e=$h.validateAllFinancialData({payments:t,expenses:n,inventory:a,labOrders:s,clinicNeeds:r}),i=Th.calculateFinancialStats(t,s,r,a,n),l=m(n.filter(e=>"paid"===e.status).reduce((e,t)=>e+m(t.amount),0)),c=Array.isArray(a)?a:[],d=m(c.reduce((e,t)=>e+m(t.cost_per_unit||0)*m(t.quantity||0),0)),u=Array.isArray(r)?r:[],p=m(u.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+m(t.quantity)*m(t.price),0)),h=Array.isArray(s)?s:[],x=m(h.reduce((e,t)=>e+m(t.paid_amount||0),0)),g=l+d+p+x,f=m(t.filter(e=>"completed"===e.status||"partial"===e.status).reduce((e,t)=>e+m(t.amount),0)),v=f-g,y=f>0?v/f*100:0,b={revenueMatch:Math.abs(f-i.totalRevenue)<.01,expensesMatch:Math.abs(g-i.totalExpenses)<.01,profitMatch:Math.abs(v-(i.netProfit||i.lossAmount))<.01},j=e.isValid&&b.revenueMatch&&b.expensesMatch&&b.profitMatch;o({isAccurate:j,totalRevenue:f,totalExpenses:g,netProfit:v,profitMargin:y,dataIntegrity:{paymentsValid:t.length>0,expensesValid:n.length>=0,inventoryValid:a.length>=0,labOrdersValid:s.length>=0,clinicNeedsValid:r.length>=0},errors:e.errors,warnings:e.warnings,lastVerified:new Date})}catch(e){console.error("Error during financial verification:",e),o({isAccurate:!1,totalRevenue:0,totalExpenses:0,netProfit:0,profitMargin:0,dataIntegrity:{paymentsValid:!1,expensesValid:!1,inventoryValid:!1,labOrdersValid:!1,clinicNeedsValid:!1},errors:[`Verification failed: ${e}`],warnings:[],lastVerified:new Date})}finally{d(!1)}};re.useEffect(()=>{u()},[t,n,a,s,r]);const p=t=>t?e.jsx(ns,{className:"h-4 w-4 text-green-500"}):e.jsx(Nr,{className:"h-4 w-4 text-red-500"});return e.jsxs(nc,{className:"w-full",children:[e.jsx(ac,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(Xa,{className:"h-5 w-5"}),"التحقق من دقة النظام المالي"]}),e.jsx(rc,{children:"فحص شامل لضمان دقة 100% في جميع الحسابات المالية"})]}),e.jsxs(Lr,{onClick:u,disabled:c,size:"sm",children:[c?e.jsx(Js,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Js,{className:"h-4 w-4 mr-2"}),"فحص الآن"]})]})}),e.jsx(ic,{className:"space-y-6",children:l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p(l.isAccurate),e.jsxs("span",{className:"font-medium",children:["حالة النظام المالي: ",(t=>e.jsx(oc,{variant:t?"default":"destructive",children:t?"صحيح":"خطأ"}))(l.isAccurate)]})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["آخر فحص: ",l.lastVerified.toLocaleString("ar-SA")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"إجمالي الإيرادات"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:e.jsx(rh,{amount:l.totalRevenue,currency:i})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"إجمالي المصروفات"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:e.jsx(rh,{amount:l.totalExpenses,currency:i})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"صافي الربح"}),e.jsx("div",{className:"text-2xl font-bold "+(l.netProfit>=0?"text-green-600":"text-red-600"),children:e.jsx(rh,{amount:l.netProfit,currency:i})}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["هامش الربح: ",l.profitMargin.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"سلامة البيانات"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[p(l.dataIntegrity.paymentsValid),e.jsx("span",{className:"text-sm",children:"المدفوعات"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[p(l.dataIntegrity.expensesValid),e.jsx("span",{className:"text-sm",children:"المصروفات"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[p(l.dataIntegrity.inventoryValid),e.jsx("span",{className:"text-sm",children:"المخزون"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[p(l.dataIntegrity.labOrdersValid),e.jsx("span",{className:"text-sm",children:"المختبر"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[p(l.dataIntegrity.clinicNeedsValid),e.jsx("span",{className:"text-sm",children:"الاحتياجات"})]})]})]}),l.errors.length>0&&e.jsxs(Ur,{variant:"destructive",children:[e.jsx(Nr,{className:"h-4 w-4"}),e.jsxs(Hr,{children:[e.jsx("div",{className:"font-medium mb-2",children:"أخطاء مكتشفة:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:l.errors.map((t,n)=>e.jsx("li",{className:"text-sm",children:t},n))})]})]}),l.warnings.length>0&&e.jsxs(Ur,{children:[e.jsx(qa,{className:"h-4 w-4"}),e.jsxs(Hr,{children:[e.jsx("div",{className:"font-medium mb-2",children:"تحذيرات:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:l.warnings.map((t,n)=>e.jsx("li",{className:"text-sm",children:t},n))})]})]})]})})]})}const Fh=re.forwardRef(({className:t,value:n=0,max:a=100,...s},r)=>{const i=Math.min(Math.max(n/a*100,0),100);return e.jsx("div",{ref:r,className:En("relative h-2 w-full overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",t),...s,children:e.jsx("div",{className:"h-full bg-blue-600 dark:bg-blue-500 transition-all duration-300 ease-in-out rounded-full",style:{width:`${i}%`}})})});function Ph(){const{payments:t}=ca(),{expenses:n}=mh(),{inventoryItems:a}=ma(),{labOrders:s}=ph(),{clinicNeeds:r}=uh(),{currentCurrency:i}=oa(),[l,o]=re.useState(null),[c,d]=re.useState(!1),m=async()=>{d(!0);try{const e=Date.now(),i=[],l=[],c=[];let d=100;const m=Array.isArray(t)?t:[],u=Array.isArray(n)?n:[],p=Array.isArray(a)?a:[],h=Array.isArray(s)?s:[],x=Array.isArray(r)?r:[];0===m.length&&(l.push("لا توجد مدفوعات في النظام"),d-=20),0===u.length&&(l.push("لا توجد مصروفات مسجلة"),d-=10);const g=$h.validateAllFinancialData({payments:m,expenses:u,inventory:p,labOrders:h,clinicNeeds:x});let f=g.isValid?100:70;g.isValid||(i.push(...g.errors),f-=10*g.errors.length),g.warnings.length>0&&(l.push(...g.warnings),f-=5*g.warnings.length);const v=Th.calculateFinancialStats(t,s,r,a,n),y=v.totalRevenue,b=v.totalExpenses,j=v.isProfit?v.netProfit:-v.lossAmount,w=v.profitMargin,N=Date.now()-e;let _=100;N>1e3&&(_-=20,l.push("تحليل النظام يستغرق وقتاً أطول من المتوقع"));let k=100;const S=new Date(Date.now()-36e5),C=t.filter(e=>new Date(e.payment_date)>S);t.length>0&&0===C.length&&(k-=10,l.push("لا توجد مدفوعات حديثة في الساعة الماضية")),b>y&&c.push("المصروفات تتجاوز الإيرادات - يُنصح بمراجعة الميزانية"),w<10&&c.push("هامش الربح منخفض - يُنصح بتحسين الكفاءة التشغيلية"),0===a.length&&c.push("لا توجد عناصر في المخزون - يُنصح بإضافة المواد الأساسية");const $=Math.round((d+f+k+_)/4),D={overallHealth:Math.max(0,Math.min(100,$)),dataIntegrity:Math.max(0,Math.min(100,d)),calculationAccuracy:Math.max(0,Math.min(100,f)),realTimeSync:Math.max(0,Math.min(100,k)),performanceScore:Math.max(0,Math.min(100,_))};o({isHealthy:$>=80&&0===i.length,lastUpdated:new Date,metrics:D,issues:i,warnings:l,recommendations:c,financialSummary:{totalRevenue:y,totalExpenses:b,netProfit:j,profitMargin:w},dataStats:{paymentsCount:t.length,expensesCount:n.length,inventoryCount:a.length,labOrdersCount:s.length,clinicNeedsCount:r.length}})}catch(e){console.error("Error analyzing system health:",e),o({isHealthy:!1,lastUpdated:new Date,metrics:{overallHealth:0,dataIntegrity:0,calculationAccuracy:0,realTimeSync:0,performanceScore:0},issues:[`خطأ في تحليل النظام: ${e}`],warnings:[],recommendations:["يُنصح بإعادة تشغيل التطبيق"],financialSummary:{totalRevenue:0,totalExpenses:0,netProfit:0,profitMargin:0},dataStats:{paymentsCount:0,expensesCount:0,inventoryCount:0,labOrdersCount:0,clinicNeedsCount:0}})}finally{d(!1)}};re.useEffect(()=>{m()},[t,n,a,s,r]);const u=e=>e>=90?"text-green-600":e>=70?"text-yellow-600":"text-red-600";return e.jsxs(nc,{className:"w-full",children:[e.jsx(ac,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"h-5 w-5"}),"حالة النظام المالي"]}),e.jsx(rc,{children:"مراقبة شاملة لصحة وأداء النظام المالي في الوقت الفعلي"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l&&(p=l.isHealthy,e.jsx(oc,{variant:p?"default":"destructive",children:p?"صحي":"يحتاج انتباه"})),e.jsxs(Lr,{onClick:m,disabled:c,size:"sm",variant:"outline",children:[c?e.jsx(Js,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Js,{className:"h-4 w-4 mr-2"}),"تحديث"]})]})]})}),e.jsx(ic,{className:"space-y-6",children:l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center p-6 border rounded-lg",children:[e.jsxs("div",{className:`text-4xl font-bold ${u(l.metrics.overallHealth)}`,children:[l.metrics.overallHealth,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"الصحة العامة للنظام"}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["آخر تحديث: ",l.lastUpdated.toLocaleString("ar-SA")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"سلامة البيانات"}),e.jsxs("span",{className:u(l.metrics.dataIntegrity),children:[l.metrics.dataIntegrity,"%"]})]}),e.jsx(Fh,{value:l.metrics.dataIntegrity,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"دقة الحسابات"}),e.jsxs("span",{className:u(l.metrics.calculationAccuracy),children:[l.metrics.calculationAccuracy,"%"]})]}),e.jsx(Fh,{value:l.metrics.calculationAccuracy,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"التزامن الفوري"}),e.jsxs("span",{className:u(l.metrics.realTimeSync),children:[l.metrics.realTimeSync,"%"]})]}),e.jsx(Fh,{value:l.metrics.realTimeSync,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"الأداء"}),e.jsxs("span",{className:u(l.metrics.performanceScore),children:[l.metrics.performanceScore,"%"]})]}),e.jsx(Fh,{value:l.metrics.performanceScore,className:"h-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gs,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"إجمالي الإيرادات"})]}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:e.jsx(rh,{amount:l.financialSummary.totalRevenue,currency:i})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ls,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"إجمالي المصروفات"})]}),e.jsx("div",{className:"text-xl font-bold text-red-600",children:e.jsx(rh,{amount:l.financialSummary.totalExpenses,currency:i})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.financialSummary.netProfit>=0?e.jsx(Zs,{className:"h-4 w-4 text-green-600"}):e.jsx(Ls,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"صافي الربح"})]}),e.jsx("div",{className:"text-xl font-bold "+(l.financialSummary.netProfit>=0?"text-green-600":"text-red-600"),children:e.jsx(rh,{amount:l.financialSummary.netProfit,currency:i})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.financialSummary.profitMargin>=0?e.jsx(ur,{className:"h-4 w-4 text-green-600"}):e.jsx(mr,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"هامش الربح"})]}),e.jsxs("div",{className:"text-xl font-bold "+(l.financialSummary.profitMargin>=0?"text-green-600":"text-red-600"),children:[l.financialSummary.profitMargin.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx("div",{className:"text-2xl font-bold",children:l.dataStats.paymentsCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"مدفوعات"})]}),e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx("div",{className:"text-2xl font-bold",children:l.dataStats.expensesCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"مصروفات"})]}),e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx("div",{className:"text-2xl font-bold",children:l.dataStats.inventoryCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"مخزون"})]}),e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx("div",{className:"text-2xl font-bold",children:l.dataStats.labOrdersCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"مختبر"})]}),e.jsxs("div",{className:"text-center p-3 border rounded",children:[e.jsx("div",{className:"text-2xl font-bold",children:l.dataStats.clinicNeedsCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"احتياجات"})]})]}),l.issues.length>0&&e.jsxs(Ur,{variant:"destructive",children:[e.jsx(Nr,{className:"h-4 w-4"}),e.jsxs(Hr,{children:[e.jsx("div",{className:"font-medium mb-2",children:"مشاكل تحتاج إصلاح:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:l.issues.map((t,n)=>e.jsx("li",{className:"text-sm",children:t},n))})]})]}),l.warnings.length>0&&e.jsxs(Ur,{children:[e.jsx(qa,{className:"h-4 w-4"}),e.jsxs(Hr,{children:[e.jsx("div",{className:"font-medium mb-2",children:"تحذيرات:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:l.warnings.map((t,n)=>e.jsx("li",{className:"text-sm",children:t},n))})]})]}),l.recommendations.length>0&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/50 border border-blue-200 dark:border-blue-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(kr,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800 dark:text-blue-200",children:"توصيات للتحسين:"})]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-blue-700 dark:text-blue-300",children:l.recommendations.map((t,n)=>e.jsx("li",{children:t},n))})]})]})})]});var p}function Rh(){const{financialReports:t,isLoading:n,isExporting:a,generateReport:s,clearCache:r}=oh(),{payments:i,totalRevenue:l,pendingAmount:o,overdueAmount:c,paymentMethodStats:d,monthlyRevenue:m,loadPayments:u}=ca(),{expenses:p,analytics:h,loadExpenses:x}=mh(),{inventoryItems:g,loadItems:f}=ma(),{labOrders:v,loadLabOrders:y}=ph(),{clinicNeeds:b,loadNeeds:j}=uh(),{currentCurrency:w,formatAmount:N}=oa(),{settings:_}=ta(),{isDarkMode:k}=sa(),S=Tc({data:i,dateField:"payment_date",initialFilter:{preset:"all",startDate:"",endDate:""}}),C=Tc({data:p,dateField:"payment_date",initialFilter:S.timeFilter});xh("financial"),re.useEffect(()=>{s("financial"),u(),x(),f(),y(),j()},[s,u,x,f,y,j]),re.useEffect(()=>{const e=Array.isArray(i)?i:[],t=Array.isArray(p)?p:[],n=Array.isArray(g)?g:[];if(e.length>0||t.length>0||n.length>0)try{(function(e){const t=$h.validateAllFinancialData(e);return t.isValid?(t.warnings.length>0&&console.warn("⚠️ Financial validation warnings:",t.warnings),console.log("✅ Financial validation passed with 100% accuracy"),!0):(console.error("❌ Financial validation failed:",t.errors),!1)})({payments:e,expenses:t,inventory:n})||console.warn("⚠️ Financial data validation issues detected. Please check the data integrity.")}catch(a){console.error("Error validating financial data:",a)}},[i,p,g]),re.useEffect(()=>{const e=Array.isArray(i)?i:[];if(e.length>0)try{const t=_h(e);t.totalErrors>0&&console.warn(`Found ${t.totalErrors} errors in ${t.invalidPayments.length} payments`),t.totalWarnings>0&&console.warn(`Found ${t.totalWarnings} warnings in payment data`)}catch(t){console.error("Error validating payments:",t)}},[i]);const $=(()=>{const e=S||{filteredData:[],timeFilter:{preset:"all"}},n=Array.isArray(i)?i:[],a=_h(Array.isArray(e.filteredData)&&e.filteredData.length>0?e.filteredData:n).validPayments;if(t&&"all"===e.timeFilter.preset&&(!e.timeFilter.startDate||!e.timeFilter.endDate))return{totalRevenue:kh(t.totalRevenue),totalPaid:kh(t.totalPaid),totalPending:kh(t.totalPending),totalOverdue:kh(t.totalOverdue),revenueByPaymentMethod:t.revenueByPaymentMethod||{},revenueTrend:t.revenueTrend||[],recentTransactions:t.recentTransactions||[],outstandingPayments:t.outstandingPayments||[]};const s=a.filter(e=>"completed"===e.status),r=a.filter(e=>"pending"===e.status),l=a.filter(e=>"failed"===e.status),o=a.filter(e=>"refunded"===e.status),c=s.reduce((e,t)=>e+(t.amount||0),0),u=r.reduce((e,t)=>e+(t.amount||0),0),p=a.filter(e=>"overdue"===e.status).reduce((e,t)=>e+(t.amount||0),0);Sh(m||{});const h=Ch(d||{}),x=a.length,g=x>0?Math.round(s.length/x*1e3)/10:0,f=s.length>0&&c>0?Math.round(c/s.length*100)/100:0;return{totalRevenue:kh(c),totalPaid:kh(c),totalPending:kh(u),totalOverdue:kh(p),revenueByPaymentMethod:h.validStats,revenueTrend:[],recentTransactions:[],outstandingPayments:[],totalTransactions:x,completedCount:s.length,pendingCount:r.length,failedCount:l.length,refundedCount:o.length,successRate:isNaN(g)?"0.0":g.toFixed(1),averageTransaction:isNaN(f)?"0.00":f.toFixed(2),validatedPayments:a}})();$.totalTransactions||(i||[]).length,$.completedCount||(i||[]).filter(e=>"completed"===e.status).length,$.pendingCount||(i||[]).filter(e=>"pending"===e.status).length,$.failedCount||(i||[]).filter(e=>"failed"===e.status).length,$.refundedCount||(i||[]).filter(e=>"refunded"===e.status).length,$.successRate,$.averageTransaction;const D=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},E=C||{filteredData:[]},T=Array.isArray(p)?p:[],A=Array.isArray(E.filteredData)&&E.filteredData.length>0?E.filteredData:T,F=$h.validateExpenses(A),P=F.calculations.totalExpenses,R=D((g||[]).reduce((e,t)=>e+D(t.cost_per_unit||0)*D(t.quantity||0),0)),O=D((b||[]).filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+D(t.quantity)*D(t.price),0)),M=D((v||[]).reduce((e,t)=>e+D(t.paid_amount||0),0)),L=P+R+O+M;console.log("💰 Financial System Verification:",{revenue:{totalRevenue:$.totalRevenue,completedPayments:S?.financialStats?.completedPayments||0,partialPayments:S?.financialStats?.partialPayments||0,pendingAmount:o,overdueAmount:c},expenses:{directExpenses:P,inventoryExpenses:R,clinicNeedsExpenses:O,labOrdersExpenses:M,totalExpenses:L},calculations:{netProfit:$.totalRevenue-L,profitMargin:$.totalRevenue>0?($.totalRevenue-L)/$.totalRevenue*100:0},dataIntegrity:{paymentsCount:(i||[]).length,expensesCount:(p||[]).length,inventoryItemsCount:(g||[]).length,clinicNeedsCount:(b||[]).length,labOrdersCount:(v||[]).length}}),!F.isValid&&A.length>0&&console.warn("⚠️ Expense validation errors:",F.errors);const I=$h.validateAmount($.totalRevenue-L).value,z=$.totalRevenue>0?I/$.totalRevenue*100:0,B=$h.validateAllFinancialData({payments:i||[],expenses:A||[],inventory:g||[],labOrders:v||[],clinicNeeds:b||[]});B.isValid||console.error("❌ Comprehensive Financial Validation Failed:",B.errors),B.warnings.length>0&&console.warn("⚠️ Financial Validation Warnings:",B.warnings);const V=Th.calculateFinancialStats(i,v,b,g,A),Y={revenueMatch:Math.abs($.totalRevenue-V.totalRevenue)<.01,expensesMatch:Math.abs(L-V.totalExpenses)<.01,profitMatch:Math.abs(I-V.netProfit)<.01};Y.revenueMatch&&Y.expensesMatch&&Y.profitMatch?console.log("✅ Financial Calculations Verified - 100% Accuracy Confirmed"):console.warn("⚠️ Financial Calculation Mismatch Detected:",{local:{revenue:$.totalRevenue,expenses:L,profit:I},system:{revenue:V.totalRevenue,expenses:V.totalExpenses,profit:V.netProfit},comparison:Y}),re.useEffect(()=>{const e=S||{timeFilter:{preset:"all"}},t=C||{timeFilter:{preset:"all"},handleFilterChange:()=>{}};e.timeFilter!==t.timeFilter&&t.handleFilterChange&&t.handleFilterChange(e.timeFilter)},[S?.timeFilter,C?.timeFilter]),re.useEffect(()=>{const e=e=>{console.log("🔄 Financial data changed:",e.detail),u(),x(),f(),y(),j()},t=["payments-changed","clinic-expenses-changed","inventory-changed","lab-orders-changed","clinic-needs-changed"];return t.forEach(t=>{window.addEventListener(t,e)}),()=>{t.forEach(t=>{window.removeEventListener(t,e)})}},[u,x,f,y,j]);const q=(()=>{const e={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},t={};return A.filter(e=>"paid"===e.status).forEach(e=>{const n=e.expense_type||"other",a=D(e.amount);t[n]=(t[n]||0)+a}),Object.entries(t).map(([t,n])=>({name:e[t]||t,value:n,percentage:L>0?n/L*100:0}))})();Hn("categorical",k);const U=Hn("primary",k),H=Kn("financial",k,8),G=Kn("status",k,8),W=Wn(k),K=(()=>{try{const e={cash:"نقداً",card:"بطاقة ائتمان",bank_transfer:"تحويل بنكي",check:"شيك",insurance:"تأمين"},t=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},n=i||[],a=S?.filteredData?.length>0?S.filteredData:n;if(0===a.length)return[];const s={};a.filter(e=>"completed"===e.status||"partial"===e.status).forEach(e=>{const n=e.payment_method||"cash",a=t(e.amount);console.log(`Payment method calculation - Payment ${e.id}: Method=${n}, Amount=${a}, Status=${e.status}`),a>0&&(s[n]=(s[n]||0)+a)}),console.log("Payment method calculated stats:",s);const r=Object.entries(s).filter(([e,t])=>t>0).map(([n,s])=>({method:e[n]||n,amount:t(s),formattedAmount:Mn(s,w),count:a.filter(e=>e.payment_method===n&&("completed"===e.status||"partial"===e.status)).length})).sort((e,t)=>t.amount-e.amount);return console.log("Payment method final data:",r),console.log("Payment method total:",r.reduce((e,t)=>e+t.amount,0)),function(e){return e.filter(e=>e.amount>0).map(e=>({...e,method:e.method||"غير محدد"}))}(r)}catch(e){return console.error("Financial Reports: Error processing payment method data:",e),[]}})(),Z=(()=>{try{const e=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},t=i||[],n=S?.filteredData?.length>0?S.filteredData:t;if(0===n.length)return[];console.log("Processing monthly revenue for",n.length,"payments"),console.log("Sample payments:",n.slice(0,3)),console.log("All payment amounts:",n.map(e=>({id:e.id,amount:e.amount,status:e.status,date:e.payment_date})));const a={};n.filter(e=>"completed"===e.status||"partial"===e.status).forEach(t=>{try{const n=new Date(t.payment_date||t.created_at||t.date);if(isNaN(n.getTime()))return void console.warn("Invalid payment date for payment:",t.id,t.payment_date);const s=n.toISOString().slice(0,7),r=e(t.amount);console.log(`Payment ${t.id}: Date=${t.payment_date}, Month=${s}, Amount=${r}, Status=${t.status}`),r>0&&(a[s]=(a[s]||0)+r,console.log(`Added ${r} to month ${s}, total now: ${a[s]}`))}catch(n){console.warn("Error processing payment date:",t.payment_date,n)}}),console.log("Calculated monthly revenue:",a);const s=Object.entries(a);if(1===s.length){const[e,t]=s[0],n=new Date(e+"-01"),r=new Date(n);r.setMonth(r.getMonth()-1);const i=r.toISOString().slice(0,7);a[i]=0;const l=new Date(n);l.setMonth(l.getMonth()+1);const o=l.toISOString().slice(0,7);a[o]=0}const r=Object.entries(a).filter(([e,t])=>e.match(/^\d{4}-\d{2}$/)).map(([t,n])=>{const a=new Date(t+"-01");return{month:`${["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"][a.getMonth()]} ${a.getFullYear()}`,revenue:e(n),formattedRevenue:Mn(e(n),w),originalMonth:t}}).sort((e,t)=>e.originalMonth.localeCompare(t.originalMonth)).map(({originalMonth:e,...t})=>t);return console.log("Final monthly revenue data:",r),r}catch(e){return console.error("Financial Reports: Error processing monthly revenue data:",e),[]}})(),Q=(()=>{try{const e=i||[],t=S?.filteredData?.length>0?S.filteredData:e;if(0===t.length)return[];const n=t.filter(e=>"completed"===e.status).length,a=t.filter(e=>"partial"===e.status).length,s=t.filter(e=>"pending"===e.status).length,r=t.filter(e=>"failed"===e.status).length,l=t.filter(e=>"refunded"===e.status).length,o=t.length;return function(e){return e.filter(e=>e.value>0)}([{name:"مكتمل",value:n,color:G[0]||"#10b981"},{name:"جزئي",value:a,color:G[1]||"#f59e0b"},{name:"معلق",value:s,color:G[2]||"#6b7280"},{name:"فاشل",value:r,color:G[3]||"#ef4444"},{name:"مسترد",value:l,color:G[4]||"#8b5cf6"}].filter(e=>e.value>0).map(e=>({...e,percentage:o>0?Math.round(e.value/o*100):0})))}catch(e){return console.error("Financial Reports: Error processing status data:",e),[]}})();return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"التقارير المالية"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إحصائيات وتحليلات شاملة للمدفوعات والإيرادات"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"البيانات محدثة في الوقت الفعلي"})]}),S.filteredData.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["• ",S.filteredData.length," معاملة",S.timeFilter.startDate&&S.timeFilter.endDate&&" (مفلترة)"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{try{r(),await s("financial"),await u();const e=new CustomEvent("showToast",{detail:{title:"تم التحديث بنجاح",description:"تم تحديث التقارير المالية",type:"success"}});window.dispatchEvent(e)}catch(e){console.error("Error refreshing financial reports:",e);const t=new CustomEvent("showToast",{detail:{title:"خطأ في التحديث",description:"فشل في تحديث التقارير",type:"error"}});window.dispatchEvent(t)}},disabled:n,children:[e.jsx(Js,{className:"w-4 h-4 ml-2 "+(n?"animate-spin":"")}),"تحديث"]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{try{const e=S.filteredData.length>0?S.filteredData:i;if(0===e.length)return void Kc.noDataToExport("لا توجد بيانات مالية للتصدير");const t=await async function(e,t,n){const a=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},s=Th.calculateFinancialStats(e,[],[],[],n);let r="\ufeff";r+="التقرير المالي الشامل\n",r+="===================\n\n",r+="معلومات التقرير\n",r+="================\n",r+=`تاريخ التقرير,${In((new Date).toISOString())}\n`,r+=`وقت التقرير,${(new Date).toLocaleTimeString("ar-SA")}\n`,t.startDate&&t.endDate?r+=`الفترة الزمنية,من ${t.startDate} إلى ${t.endDate}\n`:r+="الفترة الزمنية,جميع البيانات\n",r+=`عدد المعاملات,${e.length}\n\n`,r+="الإحصائيات المالية الرئيسية\n",r+="============================\n",r+=`إجمالي الإيرادات,${Mn(s.totalRevenue)}\n`,r+=`المدفوعات المكتملة,${Mn(s.completedPayments)}\n`,r+=`المدفوعات الجزئية,${Mn(s.partialPayments)}\n`,r+=`المبالغ المتبقية,${Mn(s.remainingBalances)}\n`,r+=`المبالغ المعلقة,${Mn(s.pendingAmount)}\n`,r+=`إجمالي المصروفات,${Mn(s.totalExpenses||0)}\n`,r+=`صافي الربح,${Mn(s.netProfit||0)}\n`,r+=`هامش الربح,${(s.profitMargin||0).toFixed(2)}%\n`,r+=`حالة الربحية,${(s.netProfit||0)>=0?"ربح":"خسارة"}\n\n`,r+="تحليل الأرباح والخسائر\n",r+="====================\n",r+=`صافي الربح,${Mn(s.netProfit||0)}\n`,r+=`مبلغ الخسارة,${Mn(s.lossAmount||0)}\n`,r+=`هامش الربح,${(s.profitMargin||0).toFixed(2)}%\n`,r+=`حالة الأرباح,${s.isProfit?"ربح":"خسارة"}\n`,r+=`إجمالي المصروفات,${Mn(s.totalExpenses||0)}\n\n`,r+="تفصيل المصروفات\n",r+="================\n",r+=`مصروفات المخابر,${Mn(s.labOrdersTotal||0)}\n`,r+=`متبقي المخابر,${Mn(s.labOrdersRemaining||0)}\n`,r+=`مصروفات الاحتياجات,${Mn(s.clinicNeedsTotal||0)}\n`,r+=`متبقي الاحتياجات,${Mn(s.clinicNeedsRemaining||0)}\n`,r+=`مصروفات المخزون,${Mn(s.inventoryExpenses||0)}\n\n`,r+="إحصائيات المعاملات\n",r+="==================\n",r+=`إجمالي المعاملات,${s.totalTransactions}\n`,r+=`المعاملات المكتملة,${s.completedTransactions}\n`,r+=`المعاملات الجزئية,${s.partialTransactions}\n`,r+=`المعاملات المعلقة,${s.pendingTransactions}\n\n`,r+="تحليل طرق الدفع\n",r+="================\n";const i={};if(e.forEach(e=>{const t=e.payment_method||"غير محدد",n="cash"===t?"نقدي":"card"===t?"بطاقة ائتمان":"bank_transfer"===t?"تحويل بنكي":"check"===t?"شيك":"insurance"===t?"تأمين":t;let s=0;"completed"===e.status?s=a(e.amount):"partial"===e.status&&void 0!==e.amount_paid&&(s=a(e.amount_paid)),s>0&&(i[n]=(i[n]||0)+s)}),Object.entries(i).forEach(([e,t])=>{const n=s.totalRevenue>0?(t/s.totalRevenue*100).toFixed(2):"0.00";r+=`${e},${Mn(t)} (${n}%)\n`}),r+="\n",s.expensesByType&&s.expensesByType.length>0&&(r+="توزيع المصروفات حسب النوع\n",r+="==========================\n",r+="نوع المصروف,المبلغ,النسبة المئوية\n",s.expensesByType.forEach(e=>{r+=`"${e.type}",${Mn(e.amount)},${e.percentage.toFixed(2)}%\n`}),r+="\n"),n&&n.length>0){const e=n.filter(e=>"paid"===e.status).sort((e,t)=>new Date(t.payment_date).getTime()-new Date(e.payment_date).getTime()).slice(0,20);if(e.length>0){r+="المصروفات الحديثة (آخر 20 مصروف)\n",r+="===================================\n",r+="اسم المصروف,النوع,المبلغ,طريقة الدفع,تاريخ الدفع,المورد,رقم الإيصال,ملاحظات\n";const t={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},n={cash:"نقداً",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمان"};e.forEach(e=>{const a=(e.expense_name||"غير محدد").replace(/,/g,"؛"),s=t[e.expense_type]||e.expense_type||"غير محدد",i=Mn(e.amount||0),l=n[e.payment_method]||e.payment_method||"غير محدد",o=e.payment_date?In(e.payment_date):"غير محدد",c=(e.vendor||"غير محدد").replace(/,/g,"؛"),d=e.receipt_number||"غير محدد",m=(e.notes||"").replace(/,/g,"؛");r+=`"${a}","${s}",${i},"${l}",${o},"${c}","${d}","${m}"\n`}),r+="\n"}}return e.length<=100&&(r+="تفاصيل المدفوعات الفردية\n",r+="=========================\n",r+="رقم الإيصال,المريض,المبلغ,المبلغ المدفوع,طريقة الدفع,الحالة,تاريخ الدفع,الوصف,ملاحظات\n",e.forEach(e=>{const t=e.receipt_number||`#${e.id?.slice(-6)||"N/A"}`,n=e.patient?.full_name||e.patient_name||"غير محدد",a=Mn(e.amount||0),s=e.amount_paid?Mn(e.amount_paid):a,i="cash"===e.payment_method?"نقدي":"card"===e.payment_method?"بطاقة ائتمان":"bank_transfer"===e.payment_method?"تحويل بنكي":"check"===e.payment_method?"شيك":"insurance"===e.payment_method?"تأمين":e.payment_method||"غير محدد",l="completed"===e.status?"مكتمل":"partial"===e.status?"جزئي":"pending"===e.status?"معلق":"failed"===e.status?"فاشل":"refunded"===e.status?"مسترد":e.status||"غير محدد",o=e.payment_date?In(e.payment_date):"غير محدد",c=(e.description||"").replace(/,/g,"؛"),d=(e.notes||"").replace(/,/g,"؛");r+=`"${t}","${n}",${a},${s},"${i}","${l}",${o},"${c}","${d}"\n`})),r}(e,S.timeFilter,A);await Zc.convertCSVToExcel(t,"comprehensive-financial",{format:"csv",includeCharts:!1,includeDetails:!0,language:"ar"}),Kc.exportSuccess(`تم تصدير التقرير المالي الشامل بنجاح! (${e.length} معاملة)`)}catch(e){console.error("Error exporting comprehensive financial CSV:",e),Kc.exportError("فشل في تصدير التقرير المالي الشامل")}},disabled:a,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير Excel شامل"]}),e.jsxs(Lr,{variant:"default",size:"sm",onClick:async()=>{try{const e=S.filteredData.length>0?S.filteredData:i;if(0===e.length)return void Kc.noDataToExport("لا توجد بيانات مالية للتصدير");const t=await async function(e,t,n,a,s,r){const i=e=>{const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100},l=Th.calculateFinancialStats(e,n,a,s,r),o=r?r.filter(e=>"paid"===e.status).reduce((e,t)=>e+i(t.amount),0):0,c=r?(()=>{const e={salary:"رواتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"},t={};return r.filter(e=>"paid"===e.status).forEach(e=>{const n=e.expense_type||"other",a=i(e.amount);t[n]=(t[n]||0)+a}),Object.entries(t).map(([t,n])=>({type:e[t]||t,amount:i(n),percentage:o>0?i(n)/o*100:0}))})():[],d=(l.totalExpenses||0)+o,m=l.totalRevenue-d,u=l.totalRevenue>0?m/l.totalRevenue*100:0,p={};return e.forEach(e=>{const t=e.payment_method||"unknown",n=i(e.amount);n>0&&("completed"===e.status||"partial"===e.status)&&(p[t]=(p[t]||0)+n)}),console.log("Payment method stats calculation:",{paymentsLength:e.length,paymentMethodStats:p}),{totalRevenue:l.totalRevenue,totalPaid:l.completedPayments+l.partialPayments,totalPending:l.pendingAmount,totalOverdue:l.remainingBalances,completedPayments:e.filter(e=>"completed"===e.status).length,partialPayments:e.filter(e=>"partial"===e.status).length,pendingPayments:e.filter(e=>"pending"===e.status).length,failedPayments:e.filter(e=>"failed"===e.status).length,netProfit:m,lossAmount:m<0?Math.abs(m):0,profitMargin:u,isProfit:m>=0,totalExpenses:d,labOrdersTotal:l.labOrdersTotal||0,labOrdersRemaining:l.labOrdersRemaining||0,clinicNeedsTotal:l.clinicNeedsTotal||0,clinicNeedsRemaining:l.clinicNeedsRemaining||0,inventoryExpenses:l.inventoryExpenses||0,clinicExpensesTotal:o,expensesByType:c,revenueByPaymentMethod:Object.entries(p).map(([e,t])=>({method:"cash"===e?"نقدي":"card"===e?"بطاقة ائتمان":"bank_transfer"===e?"تحويل بنكي":"check"===e?"شيك":"insurance"===e?"تأمين":e,amount:i(t),percentage:l.totalRevenue>0?i(t)/l.totalRevenue*100:0})),filterInfo:t.startDate&&t.endDate?`البيانات المفلترة من ${t.startDate} إلى ${t.endDate}`:"جميع البيانات المالية",dataCount:e.length,totalTransactions:e.length,successRate:e.length>0?(e.filter(e=>"completed"===e.status||"partial"===e.status).length/e.length*100).toFixed(1):"0.0",averageTransaction:e.length>0?(l.totalRevenue/e.length).toFixed(2):"0.00",payments:e.map(e=>({id:e.id,receipt_number:e.receipt_number||`#${e.id?.slice(-6)||"N/A"}`,patient_name:e.patient?.full_name||e.patient_name||"غير محدد",amount:e.amount,amount_paid:e.amount_paid,payment_method:e.payment_method,status:e.status,payment_date:e.payment_date,description:e.description,notes:e.notes})),expenses:r?r.filter(e=>"paid"===e.status).map(e=>({id:e.id,expense_name:e.expense_name,amount:e.amount,expense_type:e.expense_type,category:e.category,payment_method:e.payment_method,payment_date:e.payment_date,description:e.description,vendor:e.vendor,receipt_number:e.receipt_number,notes:e.notes})):[]}}(e,S.timeFilter,v,b,g,A);await yh.exportComprehensiveFinancialReport(t,_);let n=`تم تصدير التقرير المالي الشامل كملف PDF بنجاح! (${e.length} معاملة)`;S.timeFilter.startDate&&S.timeFilter.endDate&&(n+=` - مفلتر من ${S.timeFilter.startDate} إلى ${S.timeFilter.endDate}`),n+=` - إجمالي الإيرادات: $${t.totalRevenue.toFixed(2)}`,Kc.exportSuccess(n)}catch(e){console.error("Error exporting comprehensive financial PDF:",e),Kc.exportError("فشل في تصدير التقرير المالي الشامل كملف PDF")}},disabled:a,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير PDF شامل"]})]})]}),e.jsx(Ec,{value:S.timeFilter,onChange:S.handleFilterChange,onClear:S.resetFilter,title:"فلترة زمنية - المدفوعات",defaultOpen:!1}),e.jsx(Ph,{}),e.jsx(Ah,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[e.jsxs(nc,{className:pc("green"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"إجمالي الإيرادات"}),e.jsx(gs,{className:`h-4 w-4 ${hc("green")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(rh,{amount:S?.financialStats?.totalRevenue||l||0,currency:w})}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:["من ",(S?.filteredData||[]).filter(e=>"completed"===e.status||"partial"===e.status).length," معاملة"]}),S?.trend&&e.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(S.trend.isPositive?"text-green-600":"text-red-600"),children:[e.jsxs("span",{className:"ml-1",children:[Math.abs(S.trend.changePercent||0),"%"]}),S.trend.isPositive?e.jsx(ur,{className:"h-3 w-3"}):e.jsx(mr,{className:"h-3 w-3"})]})]})]}),e.jsxs(nc,{className:pc("red"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"إجمالي المصروفات"}),e.jsx(Ls,{className:`h-4 w-4 ${hc("red")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(rh,{amount:L,currency:w})}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right space-y-1 mt-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"مصروفات مباشرة:"}),e.jsx(rh,{amount:P,currency:w})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"تكلفة المخزون:"}),e.jsx(rh,{amount:R,currency:w})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"احتياجات العيادة:"}),e.jsx(rh,{amount:O,currency:w})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"طلبات المختبر:"}),e.jsx(rh,{amount:M,currency:w})]}),e.jsx("div",{className:"border-t pt-1 mt-2 font-medium",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"إجمالي المصروفات:"}),e.jsx(rh,{amount:L,currency:w})]})})]})]})]}),e.jsxs(nc,{className:pc(I>=0?"green":"red"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"صافي الربح"}),I>=0?e.jsx(Zs,{className:`h-4 w-4 ${hc("green")}`}):e.jsx(Ls,{className:`h-4 w-4 ${hc("red")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(rh,{amount:I,currency:w})}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"الإيرادات - المصروفات"})]})]}),e.jsxs(nc,{className:pc("yellow"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"المبالغ المستحقة"}),e.jsx(us,{className:`h-4 w-4 ${hc("yellow")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(rh,{amount:o+c+(S?.financialStats?.totalRemainingBalance||0),currency:w})}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"معلقة ومتأخرة ومتبقية"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",dir:"rtl",children:[e.jsxs(nc,{className:pc(z>=0?"green":"red"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"هامش الربح"}),e.jsx(Ka,{className:`h-4 w-4 ${hc(z>=0?"green":"red")}`})]}),e.jsxs(ic,{children:[e.jsxs("div",{className:"text-2xl font-bold text-foreground text-right",children:[z.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"نسبة الربح من الإيرادات"})]})]}),e.jsxs(nc,{className:pc("purple"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"إجمالي المعاملات"}),e.jsx(Xs,{className:`h-4 w-4 ${hc("purple")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:(S?.filteredData||[]).length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"معاملة مالية"})]})]}),e.jsxs(nc,{className:pc("teal"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"متوسط المعاملة"}),e.jsx(gs,{className:`h-4 w-4 ${hc("teal")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(rh,{amount:(()=>{const e=S||{filteredData:[],financialStats:{totalRevenue:0}},t=Array.isArray(i)?i:[],n=Array.isArray(e.filteredData)&&e.filteredData.length>0?e.filteredData:t,a=e.financialStats?.totalRevenue||0;return n.length>0?a/n.length:0})(),currency:w})}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"متوسط قيمة المعاملة"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Gs,{className:"w-5 h-5"}),e.jsx("span",{children:"توزيع حالات المدفوعات"})]}),e.jsxs(rc,{children:["توزيع المدفوعات حسب الحالة (",S.filteredData.length," معاملة)",S.timeFilter.startDate&&S.timeFilter.endDate&&" في الفترة المحددة"]})]}),e.jsxs(ic,{children:[0===Q.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Gs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات مدفوعات متاحة"})]})}):e.jsx(ue,{width:"100%",height:W.responsive.desktop.height,children:e.jsxs(pe,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(he,{data:Q,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t,percent:n})=>t>0?`${e}: ${t} (${(100*n).toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"value",stroke:k?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:Q.map((t,n)=>e.jsx(xe,{fill:t.color},`payment-status-${n}`))}),e.jsx(ge,{formatter:(e,t)=>[`${e} معاملة`,"العدد"],labelFormatter:e=>`الحالة: ${e}`,contentStyle:W.tooltip})]})}),Q.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:Q.map((t,n)=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[t.name,": ",t.value," (",t.percentage,"%)"]})]},`status-legend-${n}`))})]})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Ka,{className:"w-5 h-5"}),e.jsx("span",{children:"طرق الدفع"})]}),e.jsxs(rc,{children:["الإيرادات حسب طريقة الدفع (",Mn((()=>{const e=K.reduce((e,t)=>e+t.amount,0);return console.log("Payment method total calculation:",{paymentMethodData:K,total:e,financialStatsTotal:S.financialStats.totalRevenue}),e})(),w)," إجمالي)",S.timeFilter.startDate&&S.timeFilter.endDate&&" في الفترة المحددة"]})]}),e.jsxs(ic,{children:[0===K.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ka,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات طرق دفع متاحة"})]})}):e.jsx(ue,{width:"100%",height:W.responsive.desktop.height,children:e.jsxs(fe,{data:K,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:W.bar.barCategoryGap,children:[e.jsx(ve,{strokeDasharray:W.grid.strokeDasharray,stroke:W.grid.stroke,strokeOpacity:W.grid.strokeOpacity}),e.jsx(ye,{dataKey:"method",tick:{fontSize:14,fill:k?"#9ca3af":"#6b7280"},axisLine:{stroke:k?"#4b5563":"#d1d5db"},tickLine:{stroke:k?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),e.jsx(be,{tick:{fontSize:14,fill:k?"#9ca3af":"#6b7280"},axisLine:{stroke:k?"#4b5563":"#d1d5db"},tickLine:{stroke:k?"#4b5563":"#d1d5db"},tickFormatter:e=>Zn(e,"currency",w),domain:[0,"dataMax + 100"]}),e.jsx(ge,{formatter:(e,t,n)=>[Mn(Number(e),w),"المبلغ",`${n.payload.count} معاملة`],labelFormatter:e=>`طريقة الدفع: ${e}`,contentStyle:W.tooltip}),e.jsx(je,{dataKey:"amount",fill:U[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100})]})}),K.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-2 text-sm",children:K.slice(0,3).map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/50 rounded",children:[e.jsx("span",{className:"font-medium",children:t.method}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:t.formattedAmount}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.count," معاملة"]})]})]},`method-summary-${n}`))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Gs,{className:"w-5 h-5"}),e.jsx("span",{children:"توزيع المصروفات حسب النوع"})]}),e.jsxs(rc,{children:["توزيع المصروفات المدفوعة حسب النوع (",N(L)," إجمالي)"]})]}),e.jsxs(ic,{children:[0===q.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Gs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد مصروفات مدفوعة"})]})}):e.jsx(ue,{width:"100%",height:W.responsive.desktop.height,children:e.jsxs(pe,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(he,{data:q,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t,percentage:n})=>t>0?`${e}: ${N(t)} (${n.toFixed(0)}%)`:"",outerRadius:120,innerRadius:50,fill:"#8884d8",dataKey:"value",stroke:k?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:q.map((t,n)=>e.jsx(xe,{fill:H[n%H.length]},`expense-type-${n}`))}),e.jsx(ge,{formatter:(e,t)=>[N(Number(e)),"المبلغ"],labelFormatter:e=>`نوع المصروف: ${e}`,contentStyle:W.tooltip})]})}),q.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:q.map((t,n)=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:H[n%H.length]}}),e.jsxs("span",{className:"text-muted-foreground",children:[t.name,": ",e.jsx(rh,{amount:t.value})," (",t.percentage.toFixed(1),"%)"]})]},`expense-legend-${n}`))})]})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Ka,{className:"w-5 h-5"}),e.jsx("span",{children:"مقارنة الإيرادات والمصروفات"})]}),e.jsx(rc,{children:"مقارنة بين الإيرادات والمصروفات وصافي الربح"})]}),e.jsx(ic,{children:e.jsx(ue,{width:"100%",height:W.responsive.desktop.height,children:e.jsxs(fe,{data:[{name:"الإيرادات",value:$.totalRevenue,type:"revenue"},{name:"المصروفات",value:L,type:"expenses"},{name:"صافي الربح",value:I,type:"profit"}],margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:W.bar.barCategoryGap,children:[e.jsx(ve,{strokeDasharray:W.grid.strokeDasharray,stroke:W.grid.stroke,strokeOpacity:W.grid.strokeOpacity}),e.jsx(ye,{dataKey:"name",tick:{fontSize:14,fill:k?"#9ca3af":"#6b7280"},axisLine:{stroke:k?"#4b5563":"#d1d5db"},tickLine:{stroke:k?"#4b5563":"#d1d5db"}}),e.jsx(be,{tick:{fontSize:14,fill:k?"#9ca3af":"#6b7280"},axisLine:{stroke:k?"#4b5563":"#d1d5db"},tickLine:{stroke:k?"#4b5563":"#d1d5db"},tickFormatter:e=>Zn(e,"currency",w)}),e.jsx(ge,{formatter:(e,t,n)=>[N(Number(e)),"المبلغ"],labelFormatter:e=>e,contentStyle:W.tooltip}),e.jsx(je,{dataKey:"value",fill:e=>"revenue"===e?.type?Hn("financial",k)[0]:"expenses"===e?.type?Hn("financial",k)[1]:e?.value>=0?Hn("financial",k)[0]:Hn("financial",k)[1],radius:[4,4,0,0],minPointSize:5,maxBarSize:100,children:[{name:"الإيرادات",value:$.totalRevenue,type:"revenue"},{name:"المصروفات",value:L,type:"expenses"},{name:"صافي الربح",value:I,type:"profit"}].map((t,n)=>e.jsx(xe,{fill:"revenue"===t.type?Hn("financial",k)[0]:"expenses"===t.type?Hn("financial",k)[1]:t.value>=0?Hn("financial",k)[0]:Hn("financial",k)[1]},`profit-loss-${n}`))})]})})})]})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ur,{className:"w-5 h-5"}),e.jsx("span",{children:"الإيرادات الشهرية"})]}),e.jsxs(rc,{children:["تطور الإيرادات عبر الأشهر (",Z.length," شهر)"]})]}),e.jsxs(ic,{children:[0===Z.length?e.jsx("div",{className:"flex items-center justify-center h-96 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ur,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات إيرادات شهرية متاحة"}),e.jsx("p",{className:"text-sm mt-2",children:0===S.filteredData.length?"قم بإضافة مدفوعات لعرض الإحصائيات":`يوجد ${S.filteredData.length} مدفوعة ولكن لا توجد بيانات شهرية صالحة`})]})}):e.jsx(ue,{width:"100%",height:W.responsive.large.height,children:e.jsxs(we,{data:Z,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(ve,{strokeDasharray:W.grid.strokeDasharray,stroke:W.grid.stroke,strokeOpacity:W.grid.strokeOpacity}),e.jsx(ye,{dataKey:"month",tick:{fontSize:12,fill:k?"#9ca3af":"#6b7280"},axisLine:{stroke:k?"#4b5563":"#d1d5db"},tickLine:{stroke:k?"#4b5563":"#d1d5db"},interval:0,angle:-45,textAnchor:"end",height:60}),e.jsx(be,{tick:{fontSize:12,fill:k?"#9ca3af":"#6b7280"},axisLine:{stroke:k?"#4b5563":"#d1d5db"},tickLine:{stroke:k?"#4b5563":"#d1d5db"},tickFormatter:e=>Zn(e,"currency",w),domain:[0,"dataMax + 100"]}),e.jsx(ge,{formatter:e=>[Mn(Number(e),w),"الإيرادات"],labelFormatter:e=>`الشهر: ${e}`,contentStyle:W.tooltip}),e.jsx(Ne,{type:"monotone",dataKey:"revenue",stroke:U[0],fill:U[0],fillOpacity:.3,strokeWidth:3,connectNulls:!1})]})}),Z.length>0&&e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"أعلى شهر"}),e.jsx("div",{className:"font-semibold",children:(()=>{const e=Z.map(e=>e.revenue).filter(e=>e>0);return e.length>0?Mn(Math.max(...e),w):Mn(0,w)})()})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"متوسط شهري"}),e.jsx("div",{className:"font-semibold",children:(()=>{const e=Z.map(e=>e.revenue).filter(e=>e>0);return e.length>0?Mn(e.reduce((e,t)=>e+t,0)/e.length,w):Mn(0,w)})()})]}),e.jsxs("div",{className:"text-center p-3 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"أقل شهر"}),e.jsx("div",{className:"font-semibold",children:(()=>{const e=Z.map(e=>e.revenue).filter(e=>e>0);return e.length>0?Mn(Math.min(...e),w):Mn(0,w)})()})]})]})]})]}),S.filteredData.length>0&&e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Xs,{className:"w-5 h-5"}),e.jsx("span",{children:"المدفوعات الحديثة"})]}),e.jsxs(rc,{children:["آخر ",Math.min(10,S.filteredData.length)," مدفوعات",S.timeFilter.startDate&&S.timeFilter.endDate&&` في الفترة من ${S.timeFilter.startDate} إلى ${S.timeFilter.endDate}`]})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"رقم الإيصال"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"المريض"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"المبلغ"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"طريقة الدفع"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"الحالة"}),e.jsx("th",{className:"text-right p-3 font-semibold text-muted-foreground",children:"التاريخ"})]})}),e.jsx("tbody",{children:S.filteredData.sort((e,t)=>new Date(t.payment_date||t.created_at).getTime()-new Date(e.payment_date||e.created_at).getTime()).slice(0,10).map((t,n)=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"font-mono text-sm",children:t.receipt_number||`#${t.id?.slice(-6)||"N/A"}`})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"font-medium",children:t.patient?.full_name||t.patient_name||"غير محدد"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(rh,{amount:"pending"===t.status?t.total_amount_due&&t.total_amount_due>0?t.total_amount_due:t.remaining_balance&&t.remaining_balance>0?t.remaining_balance:t.amount||0:t.amount||0,currency:w})}),"partial"===t.status&&e.jsxs("div",{className:"text-xs space-y-0.5",children:[t.amount_paid&&e.jsxs("div",{className:"text-blue-600 dark:text-blue-400",children:["مدفوع: ",e.jsx(rh,{amount:t.amount_paid,currency:w})]}),(t.appointment_remaining_balance||t.remaining_balance)&&e.jsxs("div",{className:"text-orange-600 dark:text-orange-400",children:["متبقي: ",e.jsx(rh,{amount:t.appointment_remaining_balance||t.remaining_balance||0,currency:w})]})]}),"pending"===t.status&&t.total_amount_due&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["إجمالي مطلوب: ",e.jsx(rh,{amount:t.total_amount_due,currency:w})]})]})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"text-sm",children:{cash:"نقداً",card:"بطاقة ائتمان",bank_transfer:"تحويل بنكي",check:"شيك",insurance:"تأمين"}[t.payment_method]||t.payment_method||"غير محدد"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${{completed:"text-green-600 bg-green-50 dark:bg-green-900/20",partial:"text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20",pending:"text-gray-600 bg-gray-50 dark:bg-gray-900/20",failed:"text-red-600 bg-red-50 dark:bg-red-900/20",refunded:"text-purple-600 bg-purple-50 dark:bg-purple-900/20"}[t.status]||"text-gray-600 bg-gray-50"}`,children:{completed:"مكتمل",partial:"جزئي",pending:"معلق",failed:"فاشل",refunded:"مسترد"}[t.status]||t.status||"غير محدد"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:In(t.payment_date||t.created_at)})})]},t.id||n))})]})}),S.filteredData.length>10&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["عرض 10 من أصل ",S.filteredData.length," مدفوعة"]})})]})]})]})}function Oh({isActive:t=!0,lastUpdate:n,className:a=""}){const[s,r]=re.useState(!1);re.useEffect(()=>{const e=()=>{r(!0),setTimeout(()=>r(!1),1e3)},t=["patient-added","patient-updated","patient-deleted","patient-changed","appointment-added","appointment-updated","appointment-deleted","appointment-changed","payment-added","payment-updated","payment-deleted","payment-changed","inventory-added","inventory-updated","inventory-deleted","inventory-changed"];return t.forEach(t=>{window.addEventListener(t,e)}),()=>{t.forEach(t=>{window.removeEventListener(t,e)})}},[]);return t?e.jsx(oc,{variant:s?"default":"secondary",className:`flex items-center gap-1 ${a} ${s?"bg-green-500 text-white":"bg-green-100 text-green-800"}`,children:s?e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"w-3 h-3 animate-spin"}),e.jsx("span",{className:"text-xs",children:"يتم التحديث..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(wr,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:n?(e=>{const t=(new Date).getTime()-e.getTime(),n=Math.floor(t/1e3),a=Math.floor(n/60),s=Math.floor(a/60);if(n<60)return"الآن";if(a<60)return`منذ ${a} دقيقة`;if(s<24)return`منذ ${s} ساعة`;return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})(n):"متصل"})]})}):e.jsxs(oc,{variant:"secondary",className:`flex items-center gap-1 ${a}`,children:[e.jsx(jr,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:"غير متصل"})]})}Fh.displayName="Progress";const Mh=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16","#f97316"];function Lh({title:t,value:n,icon:a,color:s,description:r,trend:i}){return e.jsxs(nc,{className:pc(s),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:t}),e.jsx(a,{className:`h-4 w-4 ${hc(s)}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right mb-1",children:n}),r&&e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:r}),i&&e.jsxs("div",{className:"text-xs flex items-center justify-end mt-1 "+(i.isPositive?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[e.jsx(ur,{className:"h-3 w-3 ml-1 "+(i.isPositive?"":"rotate-180")}),e.jsxs("span",{children:[Math.abs(i.value),"%"]})]})]})]})}function Ih(){const{treatmentReports:t,isLoading:n,isExporting:a,generateReport:s,clearCache:r}=oh(),{toothTreatments:i,loadToothTreatments:l}=cc(),{patients:o,loadPatients:c}=bt(),{currency:d,settings:m}=ta();sa();const{refreshTreatmentNames:u}=Ma(),p=Tc({data:i,dateField:"created_at",initialFilter:{preset:"all",startDate:"",endDate:""}});xh("treatments"),re.useEffect(()=>{s("treatments"),l(),c(),u()},[s,l,c,u]);const h=re.useMemo(()=>{const e=p.filteredData;if(!e||0===e.length)return{totalTreatments:0,completedTreatments:0,plannedTreatments:0,inProgressTreatments:0,cancelledTreatments:0,totalRevenue:0,averageTreatmentCost:0,completionRate:0,treatmentsByStatus:[],treatmentsByCategory:[],treatmentsByType:[],revenueByCategory:[],pendingTreatments:[],overdueTreatments:[]};const t=e.length,n=e.filter(e=>"completed"===e.status).length,a=e.filter(e=>"planned"===e.status).length,s=e.filter(e=>"in-progress"===e.status).length,r=e.filter(e=>"cancelled"===e.status).length,i=e.reduce((e,t)=>e+(t.cost||0),0),l=t>0?i/t:0,c=t>0?Math.round(n/t*100):0,d=e.reduce((e,t)=>{const n=Ra(t.status||"غير محدد");return e[n]=(e[n]||0)+1,e},{}),m=Object.entries(d).map(([e,n])=>({status:e,count:n,percentage:t>0?Math.round(n/t*100):0})),u=e.reduce((e,t)=>{const n=Pa(t.treatment_category||"غير محدد");return e[n]=(e[n]||0)+1,e},{}),h=Object.entries(u).map(([e,n])=>({category:e,count:n,percentage:t>0?Math.round(n/t*100):0})),x=e.reduce((e,t)=>{const n=Fa(t.treatment_type||"غير محدد");return e[n]=(e[n]||0)+1,e},{}),g=Object.entries(x).map(([e,n])=>({type:e,count:n,percentage:t>0?Math.round(n/t*100):0})),f=Object.entries(e.reduce((e,t)=>{const n=Pa(t.treatment_category||"غير محدد");return e[n]||(e[n]={revenue:0,count:0}),e[n].revenue+=t.cost||0,e[n].count+=1,e},{})).map(([e,t])=>({category:e,revenue:t.revenue,count:t.count})),v=e.filter(e=>"planned"===e.status||"in-progress"===e.status).map(e=>({...e,patient_name:o.find(t=>t.id===e.patient_id)?.full_name||`${o.find(t=>t.id===e.patient_id)?.first_name||""} ${o.find(t=>t.id===e.patient_id)?.last_name||""}`.trim()||`مريض ${e.patient_id}`})),y=new Date;y.setDate(y.getDate()-30);const b=v.filter(e=>new Date(e.created_at)<y);return{totalTreatments:t,completedTreatments:n,plannedTreatments:a,inProgressTreatments:s,cancelledTreatments:r,totalRevenue:i,averageTreatmentCost:l,completionRate:c,treatmentsByStatus:m,treatmentsByCategory:h,treatmentsByType:g,revenueByCategory:f,pendingTreatments:v,overdueTreatments:b}},[p.filteredData,o]),x=async()=>{try{r(),await s("treatments"),await l(),await c(),Kc.success("تم تحديث تقارير العلاجات بنجاح")}catch(e){console.error("Error refreshing treatment reports:",e),Kc.error("فشل في تحديث تقارير العلاجات")}};return n?e.jsx("div",{className:"flex items-center justify-center h-64",dir:"rtl",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Js,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{children:"جاري تحميل تقارير العلاجات..."})]})}):t?e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"تقارير العلاجات"}),e.jsx(Oh,{isActive:!0})]}),e.jsx("p",{className:"text-muted-foreground",children:"تحليل شامل لجميع العلاجات والإجراءات الطبية"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{onClick:x,disabled:n,variant:"outline",size:"sm",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Js,{className:"w-4 h-4 ml-2 "+(n?"animate-spin":"")}),"تحديث"]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{try{const e=p.filteredData.length>0?p.filteredData:i;if(0===e.length)return void Kc.noDataToExport("لا توجد بيانات علاجات للتصدير");const t={};o.forEach(e=>{t[e.id]=e.full_name||`${e.first_name||""} ${e.last_name||""}`.trim()});const n=e.map(e=>({...e,patient_name:t[e.patient_id]||`مريض ${e.patient_id}`}));await Zc.exportTreatmentsToCSV(n),Kc.exportSuccess(`تم تصدير تقرير العلاجات بنجاح! (${e.length} علاج)`)}catch(e){console.error("Error exporting CSV:",e),Kc.exportError("فشل في تصدير تقرير العلاجات")}},disabled:a,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير اكسل"]}),e.jsxs(Lr,{variant:"default",size:"sm",onClick:async()=>{try{const e=p.filteredData.length>0?p.filteredData:i;if(0===e.length)return void Kc.noDataToExport("لا توجد بيانات علاجات للتصدير");const t={};o.forEach(e=>{t[e.id]=e.full_name||`${e.first_name||""} ${e.last_name||""}`.trim()});e.map(e=>({...e,patient_name:t[e.patient_id]||`مريض ${e.patient_id}`}));const n={...h,filterInfo:p.timeFilter.startDate&&p.timeFilter.endDate?`البيانات من ${p.timeFilter.startDate} إلى ${p.timeFilter.endDate}`:"جميع البيانات",dataCount:e.length};await yh.exportTreatmentReport(n,m),Kc.exportSuccess(`تم تصدير تقرير العلاجات كملف PDF بنجاح (${e.length} علاج)`)}catch(e){console.error("Error exporting PDF:",e),Kc.exportError("فشل في تصدير تقرير العلاجات كملف PDF")}},disabled:a,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير PDF"]})]})]}),e.jsx(Ec,{value:p.timeFilter,onChange:p.handleFilterChange,onClear:p.resetFilter,title:"فلترة العلاجات حسب التاريخ",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Lh,{title:"إجمالي العلاجات",value:h.totalTreatments,icon:Va,color:"blue",description:"العدد الكلي للعلاجات",trend:p.trend}),e.jsx(Lh,{title:"العلاجات المكتملة",value:h.completedTreatments,icon:ns,color:"green",description:`معدل الإنجاز: ${h.completionRate}%`}),e.jsx(Lh,{title:"إجمالي الإيرادات",value:e.jsx(rh,{amount:h.totalRevenue,currency:d}),icon:gs,color:"green",description:`متوسط التكلفة: ${Mn(h.averageTreatmentCost,d)}`}),e.jsx(Lh,{title:"العلاجات المعلقة",value:h.pendingTreatments.length,icon:us,color:"yellow",description:`متأخرة: ${h.overdueTreatments.length}`})]}),e.jsxs(Ud,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(Hd,{className:"grid w-full grid-cols-4",children:[e.jsx(Gd,{value:"overview",children:"نظرة عامة"}),e.jsx(Gd,{value:"analysis",children:"التحليل"}),e.jsx(Gd,{value:"performance",children:"الأداء"}),e.jsx(Gd,{value:"details",children:"التفاصيل"})]}),e.jsx(Wd,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"h-5 w-5"}),"توزيع حالات العلاج"]})}),e.jsx(ic,{children:0===h.treatmentsByStatus.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Gs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات علاجات متاحة"})]})}):e.jsx(ue,{width:"100%",height:300,children:e.jsxs(pe,{children:[e.jsx(he,{data:h.treatmentsByStatus,cx:"50%",cy:"50%",labelLine:!1,label:({status:e,percentage:t})=>`${e}: ${t}%`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:h.treatmentsByStatus.map((t,n)=>e.jsx(xe,{fill:Mh[n%Mh.length]},`cell-${n}`))}),e.jsx(ge,{formatter:(e,t)=>[e,t],labelFormatter:e=>`الحالة: ${e}`})]})})})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(Ka,{className:"h-5 w-5"}),"العلاجات حسب الفئة"]})}),e.jsx(ic,{children:0===h.treatmentsByCategory.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ka,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات فئات علاجات متاحة"})]})}):e.jsx(ue,{width:"100%",height:300,children:e.jsxs(fe,{data:h.treatmentsByCategory,children:[e.jsx(ve,{strokeDasharray:"3 3"}),e.jsx(ye,{dataKey:"category",tick:{fontSize:12},interval:0,angle:-45,textAnchor:"end",height:80}),e.jsx(be,{}),e.jsx(ge,{formatter:(e,t)=>[e,"عدد العلاجات"],labelFormatter:e=>`الفئة: ${e}`}),e.jsx(je,{dataKey:"count",fill:"#3b82f6",radius:[4,4,0,0]})]})})})]})]})}),e.jsx(Wd,{value:"analysis",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsx(sc,{children:"الإيرادات حسب الفئة"})}),e.jsx(ic,{children:e.jsx("div",{className:"space-y-4",children:h.revenueByCategory&&0!==h.revenueByCategory.length?h.revenueByCategory.map((t,n)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/30 rounded-lg",children:[e.jsx("span",{className:"font-medium text-right",children:t.category}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold",children:e.jsx(rh,{amount:t.revenue,currency:d})}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.count," علاج"]})]})]},n)):e.jsx("div",{className:"flex items-center justify-center h-40 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(gs,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"لا توجد بيانات إيرادات متاحة"})]})})})})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsx(sc,{children:"أشهر العلاجات"})}),e.jsx(ic,{children:e.jsx("div",{className:"space-y-4",children:t.mostPopularTreatments.slice(0,5).map((t,n)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"font-bold",children:[t.count," مرة"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(rh,{amount:t.revenue,currency:d})})]})]},n))})})]})]})}),e.jsx(Wd,{value:"performance",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsx(sc,{children:"اتجاه العلاجات الشهري"})}),e.jsx(ic,{children:t.treatmentTrend&&0!==t.treatmentTrend.length?e.jsx(ue,{width:"100%",height:300,children:e.jsxs(_e,{data:t.treatmentTrend,children:[e.jsx(ve,{strokeDasharray:"3 3"}),e.jsx(ye,{dataKey:"period"}),e.jsx(be,{}),e.jsx(ge,{formatter:(e,t)=>[e,t],labelFormatter:e=>`الفترة: ${e}`}),e.jsx(ke,{type:"monotone",dataKey:"completed",stroke:"#10b981",name:"مكتمل",strokeWidth:2,dot:{fill:"#10b981",strokeWidth:2,r:4}}),e.jsx(ke,{type:"monotone",dataKey:"planned",stroke:"#3b82f6",name:"مخطط",strokeWidth:2,dot:{fill:"#3b82f6",strokeWidth:2,r:4}})]})}):e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ur,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات اتجاه العلاجات متاحة"})]})})})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsx(sc,{children:"مؤشرات الأداء"})}),e.jsx(ic,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"معدل الإنجاز"}),e.jsxs(oc,{variant:"secondary",children:[t.completionRate,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"متوسط وقت الإنجاز"}),e.jsxs(oc,{variant:"secondary",children:[Math.round(t.averageCompletionTime)," يوم"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"المرضى بعلاجات متعددة"}),e.jsx(oc,{variant:"secondary",children:t.patientsWithMultipleTreatments})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"متوسط العلاجات لكل مريض"}),e.jsx(oc,{variant:"secondary",children:t.averageTreatmentsPerPatient.toFixed(1)})]})]})})]})]})}),e.jsx(Wd,{value:"details",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5"}),"العلاجات المعلقة (",h.pendingTreatments.length,")"]})}),e.jsx(ic,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===h.pendingTreatments.length?e.jsx("div",{className:"flex items-center justify-center h-40 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(us,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"لا توجد علاجات معلقة"})]})}):e.jsxs(Bc,{children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-right",children:"نوع العلاج"}),e.jsx(Uc,{className:"text-right",children:"اسم المريض"}),e.jsx(Uc,{className:"text-right",children:"الحالة"}),e.jsx(Uc,{className:"text-right",children:"التاريخ"}),e.jsx(Uc,{className:"text-right",children:"التكلفة"})]})}),e.jsx(Yc,{children:h.pendingTreatments.slice(0,10).map(t=>e.jsxs(qc,{children:[e.jsx(Hc,{className:"text-right",children:Fa(t.treatment_type)}),e.jsx(Hc,{className:"text-right",children:t.patient_name||`مريض ${t.patient_id}`}),e.jsx(Hc,{className:"text-right",children:e.jsx(oc,{variant:"planned"===t.status?"secondary":"default",children:Ra(t.status||"غير محدد")})}),e.jsx(Hc,{className:"text-right",children:t.created_at?In(t.created_at):"غير محدد"}),e.jsx(Hc,{className:"text-right",children:e.jsx(rh,{amount:t.cost||0,currency:d})})]},t.id))})]})})})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(Ya,{className:"h-5 w-5 text-red-500"}),"العلاجات المتأخرة (",h.overdueTreatments.length,")"]})}),e.jsx(ic,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===h.overdueTreatments.length?e.jsx("div",{className:"flex items-center justify-center h-40 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ns,{className:"w-8 h-8 mx-auto mb-2 opacity-50 text-green-500"}),e.jsx("p",{className:"text-sm",children:"لا توجد علاجات متأخرة"})]})}):e.jsxs(Bc,{children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-right",children:"نوع العلاج"}),e.jsx(Uc,{className:"text-right",children:"اسم المريض"}),e.jsx(Uc,{className:"text-right",children:"تاريخ الإنشاء"}),e.jsx(Uc,{className:"text-right",children:"الأيام المتأخرة"}),e.jsx(Uc,{className:"text-right",children:"التكلفة"})]})}),e.jsx(Yc,{children:h.overdueTreatments.slice(0,10).map(t=>{const n=t.created_at?Math.ceil(((new Date).getTime()-new Date(t.created_at).getTime())/864e5):0;return e.jsxs(qc,{children:[e.jsx(Hc,{className:"text-right",children:Fa(t.treatment_type)}),e.jsx(Hc,{className:"text-right",children:t.patient_name||`مريض ${t.patient_id}`}),e.jsx(Hc,{className:"text-right",children:t.created_at?In(t.created_at):"غير محدد"}),e.jsx(Hc,{className:"text-right",children:e.jsxs(oc,{variant:"destructive",children:[n," يوم"]})}),e.jsx(Hc,{className:"text-right",children:e.jsx(rh,{amount:t.cost||0,currency:d})})]},t.id)})})]})})})]})]})})]})]}):e.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[e.jsx(ir,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد بيانات علاجات متاحة"}),e.jsxs(Lr,{onClick:x,className:"mt-4",children:[e.jsx(Js,{className:"h-4 w-4 ml-2"}),"تحديث"]})]})}const zh={pending:"#f59e0b",ordered:"#3b82f6",received:"#10b981",cancelled:"#ef4444",urgent:"#dc2626",high:"#f59e0b",medium:"#3b82f6",low:"#10b981"},Bh={pending:"معلق",ordered:"مطلوب",received:"مستلم",cancelled:"ملغي"},Vh={urgent:"عاجل",high:"عالي",medium:"متوسط",low:"منخفض"};function Yh(){const{clinicNeedsReports:t,isLoading:n,isExporting:a,generateReport:s,clearCache:r}=oh(),{needs:i,loadNeeds:l}=uh(),{currency:o,settings:c}=ta(),{isDarkMode:d}=sa(),m=Tc({data:i,dateField:"created_at",initialFilter:{preset:"all",startDate:"",endDate:""}});xh("clinicNeeds"),re.useEffect(()=>{s("clinicNeeds"),l()},[s,l]);const u=re.useMemo(()=>{const e=m.filteredData;if(!e||0===e.length)return{totalNeeds:0,totalValue:0,pendingCount:0,orderedCount:0,receivedCount:0,cancelledCount:0,urgentCount:0,completionRate:0,urgencyRate:0,averageNeedValue:0,needsByStatus:[],needsByPriority:[],needsByCategory:[],topExpensiveNeeds:[]};const t=e.length,n=e.reduce((e,t)=>e+t.price*t.quantity,0),a=t>0?n/t:0,s=e.filter(e=>"pending"===e.status).length,r=e.filter(e=>"ordered"===e.status).length,i=e.filter(e=>"received"===e.status).length,l=e.filter(e=>"cancelled"===e.status).length,o=e.filter(e=>"urgent"===e.priority).length,c=t>0?i/t*100:0,d=t>0?o/t*100:0,u=[{name:Bh.pending,value:s,color:zh.pending},{name:Bh.ordered,value:r,color:zh.ordered},{name:Bh.received,value:i,color:zh.received},{name:Bh.cancelled,value:l,color:zh.cancelled}].filter(e=>e.value>0),p={urgent:e.filter(e=>"urgent"===e.priority).length,high:e.filter(e=>"high"===e.priority).length,medium:e.filter(e=>"medium"===e.priority).length,low:e.filter(e=>"low"===e.priority).length},h=[{name:Vh.urgent,value:p.urgent,color:zh.urgent},{name:Vh.high,value:p.high,color:zh.high},{name:Vh.medium,value:p.medium,color:zh.medium},{name:Vh.low,value:p.low,color:zh.low}].filter(e=>e.value>0),x=new Map;e.forEach(e=>{const t=e.category||"غير محدد",n=x.get(t)||{count:0,value:0};x.set(t,{count:n.count+1,value:n.value+e.price*e.quantity})});const g=Array.from(x.entries()).map(([e,t])=>({category:e,count:t.count,value:t.value})).sort((e,t)=>t.value-e.value),f=e.map(e=>({need_name:e.need_name,value:e.price*e.quantity,quantity:e.quantity,price:e.price})).sort((e,t)=>t.value-e.value).slice(0,10);return{totalNeeds:t,totalValue:n,pendingCount:s,orderedCount:r,receivedCount:i,cancelledCount:l,urgentCount:o,completionRate:c,urgencyRate:d,averageNeedValue:a,needsByStatus:u,needsByPriority:h,needsByCategory:g,topExpensiveNeeds:f}},[m.filteredData]);if(n)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل تقرير احتياجات العيادة..."})]})});const p=u;return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(ms,{className:"w-6 h-6 text-primary"}),"تقرير احتياجات العيادة"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"تحليل شامل لاحتياجات ومتطلبات العيادة"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{r(),await s("clinicNeeds"),await l(),Wc.success("تم تحديث التقرير")},disabled:n,className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Js,{className:"w-4 h-4 "+(n?"animate-spin":"")}),e.jsx("span",{children:"تحديث"})]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{try{const e=m.filteredData;if(!e||0===e.length)return void Wc.error("لا توجد بيانات للتصدير");const t=`clinic-needs-report${"all"!==m.filter.preset?`_${m.filter.preset}_${m.filter.startDate||""}_${m.filter.endDate||""}`:""}`;await Zc.exportClinicNeedsToCSV(e,t),Wc.success(`تم تصدير ${e.length} احتياج بنجاح`)}catch(e){console.error("Error exporting CSV:",e),Wc.error("فشل في تصدير البيانات")}},disabled:a,className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(fs,{className:"w-4 h-4"}),e.jsx("span",{children:"CSV"})]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{try{if(!m.filteredData||0===m.filteredData.length)return void Wc.error("لا توجد بيانات للتصدير");const e={...p,needsList:m.filteredData,filterInfo:"all"!==m.filter.preset?`الفترة: ${m.filter.preset} (${m.filter.startDate||""} - ${m.filter.endDate||""})`:"جميع البيانات",dataCount:m.filteredData.length};await yh.exportClinicNeedsReport(e,{title:"تقرير احتياجات العيادة",currency:o,isDarkMode:d}),Wc.success("تم تصدير التقرير بنجاح")}catch(e){console.error("Error exporting PDF:",e),Wc.error("فشل في تصدير التقرير")}},disabled:a,className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(fs,{className:"w-4 h-4"}),e.jsx("span",{children:"PDF"})]})]})]}),e.jsx(Ec,{value:m.filter,onChange:m.setFilter,className:"w-full"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[e.jsxs(nc,{className:pc("blue"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"إجمالي الاحتياجات"}),e.jsx(ms,{className:`h-4 w-4 ${hc("blue")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:p.totalNeeds}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"احتياج مسجل في النظام"})]})]}),e.jsxs(nc,{className:pc("green"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"القيمة الإجمالية"}),e.jsx(gs,{className:`h-4 w-4 ${hc("green")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:e.jsx(rh,{amount:p.totalValue,currency:o})}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"قيمة جميع الاحتياجات"})]})]}),e.jsxs(nc,{className:pc("orange"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"الاحتياجات المعلقة"}),e.jsx(us,{className:`h-4 w-4 ${hc("orange")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:p.pendingCount}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"في انتظار الطلب"})]})]}),e.jsxs(nc,{className:pc("red"),dir:"rtl",children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"الاحتياجات العاجلة"}),e.jsx(qa,{className:`h-4 w-4 ${hc("red")}`})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground text-right",children:p.urgentCount}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"تحتاج اهتمام فوري"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Gs,{className:"w-5 h-5"}),e.jsx("span",{children:"توزيع الاحتياجات حسب الحالة"})]}),e.jsxs(rc,{children:["توزيع الاحتياجات حسب حالة الطلب (",p.totalNeeds," احتياج إجمالي)"]})]}),e.jsx(ic,{children:0===p.needsByStatus.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Gs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات احتياجات متاحة"})]})}):e.jsx(ue,{width:"100%",height:300,children:e.jsxs(pe,{children:[e.jsx(he,{data:p.needsByStatus,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:t,percent:n})=>`${e}: ${t} (${(100*n).toFixed(1)}%)`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:p.needsByStatus.map((t,n)=>e.jsx(xe,{fill:t.color},`cell-${n}`))}),e.jsx(ge,{}),e.jsx(Se,{})]})})})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Ka,{className:"w-5 h-5"}),e.jsx("span",{children:"توزيع الاحتياجات حسب الأولوية"})]}),e.jsx(rc,{children:"توزيع الاحتياجات حسب مستوى الأولوية"})]}),e.jsx(ic,{children:0===p.needsByPriority.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ka,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات أولوية متاحة"})]})}):e.jsx(ue,{width:"100%",height:300,children:e.jsxs(fe,{data:p.needsByPriority,children:[e.jsx(ve,{strokeDasharray:"3 3"}),e.jsx(ye,{dataKey:"name"}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(je,{dataKey:"value",fill:"#8884d8",children:p.needsByPriority.map((t,n)=>e.jsx(xe,{fill:t.color},`cell-${n}`))})]})})})]})]}),e.jsxs(Ud,{defaultValue:"categories",className:"w-full",dir:"rtl",children:[e.jsxs(Hd,{className:"grid w-full grid-cols-4",children:[e.jsx(Gd,{value:"categories",children:"الفئات"}),e.jsx(Gd,{value:"expensive",children:"الأغلى سعراً"}),e.jsx(Gd,{value:"pending",children:"المعلقة"}),e.jsx(Gd,{value:"urgent",children:"العاجلة"})]}),e.jsx(Wd,{value:"categories",className:"space-y-4",children:e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"h-5 w-5"}),"الاحتياجات حسب الفئة (",p.needsByCategory.length," فئة)"]})}),e.jsx(ic,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs(Bc,{children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-right",children:"الفئة"}),e.jsx(Uc,{className:"text-right",children:"العدد"}),e.jsx(Uc,{className:"text-right",children:"القيمة الإجمالية"}),e.jsx(Uc,{className:"text-right",children:"متوسط القيمة"})]})}),e.jsx(Yc,{children:p.needsByCategory.map((t,n)=>e.jsxs(qc,{children:[e.jsx(Hc,{className:"font-medium text-right",children:t.category}),e.jsx(Hc,{className:"text-right",children:t.count}),e.jsx(Hc,{className:"text-right",children:e.jsx(rh,{amount:t.value,currency:o})}),e.jsx(Hc,{className:"text-right",children:e.jsx(rh,{amount:t.value/t.count,currency:o})})]},n))})]})})})]})}),e.jsx(Wd,{value:"expensive",className:"space-y-4",children:e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-5 w-5"}),"الاحتياجات الأغلى سعراً (أعلى 10)"]})}),e.jsx(ic,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs(Bc,{children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-right",children:"اسم الاحتياج"}),e.jsx(Uc,{className:"text-right",children:"الكمية"}),e.jsx(Uc,{className:"text-right",children:"سعر الوحدة"}),e.jsx(Uc,{className:"text-right",children:"القيمة الإجمالية"})]})}),e.jsx(Yc,{children:p.topExpensiveNeeds.map((t,n)=>e.jsxs(qc,{children:[e.jsx(Hc,{className:"font-medium text-right",children:t.need_name}),e.jsx(Hc,{className:"text-right",children:t.quantity}),e.jsx(Hc,{className:"text-right",children:e.jsx(rh,{amount:t.price,currency:o})}),e.jsx(Hc,{className:"text-right",children:e.jsx(rh,{amount:t.value,currency:o})})]},n))})]})})})]})}),e.jsx(Wd,{value:"pending",className:"space-y-4",children:e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5"}),"الاحتياجات المعلقة (",p.pendingCount,")"]})}),e.jsx(ic,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs(Bc,{children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-right",children:"اسم الاحتياج"}),e.jsx(Uc,{className:"text-right",children:"الفئة"}),e.jsx(Uc,{className:"text-right",children:"الأولوية"}),e.jsx(Uc,{className:"text-right",children:"القيمة"}),e.jsx(Uc,{className:"text-right",children:"تاريخ الإنشاء"})]})}),e.jsx(Yc,{children:m.filteredData.filter(e=>"pending"===e.status).slice(0,10).map(t=>e.jsxs(qc,{children:[e.jsx(Hc,{className:"font-medium text-right",children:t.need_name}),e.jsx(Hc,{className:"text-right",children:t.category||"غير محدد"}),e.jsx(Hc,{className:"text-right",children:e.jsx(oc,{variant:"urgent"===t.priority?"destructive":"secondary",children:Vh[t.priority]})}),e.jsx(Hc,{className:"text-right",children:e.jsx(rh,{amount:t.price*t.quantity,currency:o})}),e.jsx(Hc,{className:"text-right",children:In(t.created_at)})]},t.id))})]})})})]})}),e.jsx(Wd,{value:"urgent",className:"space-y-4",children:e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(qa,{className:"h-5 w-5"}),"الاحتياجات العاجلة (",p.urgentCount,")"]})}),e.jsx(ic,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs(Bc,{children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-right",children:"اسم الاحتياج"}),e.jsx(Uc,{className:"text-right",children:"الحالة"}),e.jsx(Uc,{className:"text-right",children:"الفئة"}),e.jsx(Uc,{className:"text-right",children:"القيمة"}),e.jsx(Uc,{className:"text-right",children:"تاريخ الإنشاء"})]})}),e.jsx(Yc,{children:m.filteredData.filter(e=>"urgent"===e.priority).slice(0,10).map(t=>e.jsxs(qc,{children:[e.jsx(Hc,{className:"font-medium text-right",children:t.need_name}),e.jsx(Hc,{className:"text-right",children:e.jsx(oc,{variant:"received"===t.status?"default":"secondary",children:Bh[t.status]})}),e.jsx(Hc,{className:"text-right",children:t.category||"غير محدد"}),e.jsx(Hc,{className:"text-right",children:e.jsx(rh,{amount:t.price*t.quantity,currency:o})}),e.jsx(Hc,{className:"text-right",children:In(t.created_at)})]},t.id))})]})})})]})})]})]})}var qh="horizontal",Uh=["horizontal","vertical"],Hh=re.forwardRef((t,n)=>{const{decorative:a,orientation:s=qh,...r}=t,i=function(e){return Uh.includes(e)}(s)?s:qh,l=a?{role:"none"}:{"aria-orientation":"vertical"===i?i:void 0,role:"separator"};return e.jsx(c.div,{"data-orientation":i,...l,...r,ref:n})});Hh.displayName="Separator";var Gh=Hh;const Wh=re.forwardRef(({className:t,orientation:n="horizontal",decorative:a=!0,...s},r)=>e.jsx(Gh,{ref:r,decorative:a,orientation:n,className:En("shrink-0 bg-border","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",t),...s}));Wh.displayName=Gh.displayName;class Kh{static validateAmount(e){const t=Number(e);return isNaN(t)||!isFinite(t)?0:Math.round(100*t)/100}static filterByDateRange(e,t,n){const a=t.start||t.startDate,s=t.end||t.endDate;if(!a&&!s)return e;const r=e.filter(e=>{const t=e[n];if(!t)return!1;const r=new Date(t);let i,l=null,o=null;a&&(l=new Date(a),l=new Date(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0,0)),s&&(o=new Date(s),o=new Date(o.getFullYear(),o.getMonth(),o.getDate(),23,59,59,999)),i=t.includes("T")||t.includes(" ")?r:new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0);return(!l||i>=l)&&(!o||i<=o)});return r}static calculateRevenueStats(e){const t=this.validateAmount(e.filter(e=>"completed"===e.status).reduce((e,t)=>e+this.validateAmount(t.amount),0)),n=this.validateAmount(e.filter(e=>"partial"===e.status).reduce((e,t)=>e+this.validateAmount(t.amount),0));return{completedPayments:t,totalRevenue:t+n,partialPayments:n,remainingBalances:this.validateAmount(e.filter(e=>"partial"===e.status).reduce((e,t)=>{const n=this.validateAmount(t.total_amount_due||t.treatment_total_cost||t.appointment_total_cost||0),a=this.validateAmount(t.amount_paid||t.treatment_total_paid||t.appointment_total_paid||t.amount||0),s=Math.max(0,n-a);return 0===n?e+this.validateAmount(t.remaining_balance||t.treatment_remaining_balance||t.appointment_remaining_balance||0):e+s},0)),pendingAmount:this.validateAmount(e.filter(e=>"pending"===e.status).reduce((e,t)=>{const n=this.validateAmount(t.amount),a=this.validateAmount(t.total_amount_due);let s=n;if(t.tooth_treatment_id){s=this.validateAmount(t.treatment_total_cost)||a}else 0===n&&a>0?s=a:t.remaining_balance&&t.remaining_balance>0&&(s=this.validateAmount(t.remaining_balance));return e+s},0))}}static calculateExpenseStats(e,t,n,a){const s=this.validateAmount(e.reduce((e,t)=>e+this.validateAmount(t.paid_amount||0),0)),r=this.validateAmount(e.reduce((e,t)=>e+this.validateAmount(t.remaining_balance||0),0));return{labOrdersTotal:s,labOrdersRemaining:r,clinicNeedsTotal:this.validateAmount(t.filter(e=>"received"===e.status||"ordered"===e.status).reduce((e,t)=>e+this.validateAmount(t.quantity)*this.validateAmount(t.price),0)),clinicNeedsRemaining:this.validateAmount(t.filter(e=>"pending"===e.status||"ordered"===e.status).reduce((e,t)=>e+this.validateAmount(t.quantity)*this.validateAmount(t.price),0)),inventoryExpenses:this.validateAmount(n.reduce((e,t)=>e+this.validateAmount(t.cost_per_unit||0)*this.validateAmount(t.quantity||0),0)),clinicExpensesTotal:a?this.validateAmount(a.filter(e=>"paid"===e.status).reduce((e,t)=>e+this.validateAmount(t.amount),0)):0}}static calculateProfitLoss(e,t){const n=e-t,a=n>=0,s=a?0:Math.abs(n),r=e>0?n/e*100:0;return{totalIncome:e,totalExpenses:t,netProfit:a?n:0,profitMargin:this.validateAmount(r),lossAmount:s,isProfit:a}}static generateComprehensiveProfitLossReport(e,t,n,a,s,r,i,l){const o=i?.dateRange?this.filterByDateRange(e,i.dateRange,"payment_date"):e,c=i?.dateRange?this.filterByDateRange(t,i.dateRange,"order_date"):t,d=i?.dateRange?this.filterByDateRange(n,i.dateRange,"created_at"):n,m=i?.dateRange?this.filterByDateRange(r,i.dateRange,"created_at"):r,u=i?.dateRange?this.filterByDateRange(a,i.dateRange,"created_at"):a,p=i?.dateRange&&l?this.filterByDateRange(l,i.dateRange,"payment_date"):l,h=this.calculateRevenueStats(o),x=this.calculateExpenseStats(c,d,u,p),g=h.totalRevenue,f=x.labOrdersTotal+x.clinicNeedsTotal+x.inventoryExpenses+x.clinicExpensesTotal;return{revenue:h,expenses:x,calculations:this.calculateProfitLoss(g,f),details:{totalPatients:s.length,totalAppointments:m.length,totalLabOrders:c.length,totalClinicNeeds:d.length,totalInventoryItems:u.length,totalExpenses:p?p.length:0,averageRevenuePerPatient:s.length>0?g/s.length:0,averageRevenuePerAppointment:m.length>0?g/m.length:0},filterInfo:{dateRange:i?.dateRange?`${i.dateRange.start||i.dateRange.startDate||"البداية"} - ${i.dateRange.end||i.dateRange.endDate||"النهاية"}`:"جميع البيانات",totalRecords:e.length+t.length+n.length+r.length+a.length+(l?l.length:0),filteredRecords:o.length+c.length+d.length+m.length+u.length+(p?p.length:0)}}}}function Zh(){const{payments:t}=ca(),{expenses:n}=mh(),{labOrders:a}=ph(),{needs:s}=uh(),{items:r}=ma(),{patients:i}=bt(),{appointments:l}=Jn(),{currency:o,settings:c}=ta(),{isDarkMode:d}=sa(),[m,u]=re.useState(null),[p,h]=re.useState("this_month"),[x,g]=re.useState(""),[f,v]=re.useState(""),[y,b]=re.useState(!1),[j,w]=re.useState(!1),N=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,_=(e,t,n)=>{const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(e){case"all":default:return null;case"today":return{start:N(s),end:N(s)};case"yesterday":const e=new Date(s);return e.setDate(e.getDate()-1),{start:N(e),end:N(e)};case"this_week":const a=new Date(s);return a.setDate(s.getDate()-s.getDay()),{start:N(a),end:N(s)};case"last_week":const r=new Date(s);r.setDate(s.getDate()-s.getDay()-1);const i=new Date(r);return i.setDate(r.getDate()-6),{start:N(i),end:N(r)};case"this_month":const l=new Date(s.getFullYear(),s.getMonth(),1);return{start:N(l),end:N(s)};case"last_month":const o=new Date(s.getFullYear(),s.getMonth()-1,1),c=new Date(s.getFullYear(),s.getMonth(),0);return{start:N(o),end:N(c)};case"this_quarter":const d=new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3),1);return{start:N(d),end:N(s)};case"last_quarter":const m=new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3)-3,1),u=new Date(s.getFullYear(),3*Math.floor(s.getMonth()/3),0);return{start:N(m),end:N(u)};case"this_year":const p=new Date(s.getFullYear(),0,1);return{start:N(p),end:N(s)};case"last_year":const h=new Date(s.getFullYear()-1,0,1),x=new Date(s.getFullYear()-1,11,31);return{start:N(h),end:N(x)};case"last_30_days":const g=new Date(s);return g.setDate(s.getDate()-30),{start:N(g),end:N(s)};case"last_90_days":const f=new Date(s);return f.setDate(s.getDate()-90),{start:N(f),end:N(s)};case"custom":return t&&n?{start:t,end:n}:null}};if(re.useEffect(()=>{(async()=>{b(!0);try{const e=_(p,x,f),o=Kh.generateComprehensiveProfitLossReport(t,a,s,r,i,l,e?{dateRange:e}:void 0,n);u(o)}catch(e){console.error("Error generating comprehensive profit/loss report:",e)}finally{b(!1)}})()},[p,x,f,t,n,a,s,r,i,l]),y||!m)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Xa,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري حساب التقرير الشامل..."})]})});const{revenue:k,expenses:S,calculations:C,details:$,filterInfo:D}=m;return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(Xa,{className:"w-6 h-6"}),"التقرير الشامل للأرباح والخسائر"]}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["تحليل مالي شامل يربط جميع جوانب العيادة - ",D.dateRange]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{if(m){w(!0);try{await yh.exportProfitLossReport({reportData:m,payments:t,labOrders:a,clinicNeeds:s,inventoryItems:r,clinicExpenses:n,patients:i,appointments:l,filter:_(p,x,f),currency:o},c),Kc.success("تم تصدير تقرير الأرباح والخسائر إلى PDF بنجاح")}catch(e){console.error("Error exporting to PDF:",e),Kc.error("فشل في تصدير التقرير إلى PDF")}finally{w(!1)}}else Kc.error("لا توجد بيانات للتصدير")},disabled:j||!m,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),j?"جاري التصدير...":"تصدير PDF"]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{if(m){w(!0);try{await Zc.exportProfitLossToExcel({reportData:m,payments:t,labOrders:a,clinicNeeds:s,inventoryItems:r,clinicExpenses:n,patients:i,appointments:l,filter:_(p,x,f),currency:o}),Kc.success("تم تصدير تقرير الأرباح والخسائر إلى Excel بنجاح")}catch(e){console.error("Error exporting to Excel:",e),Kc.error("فشل في تصدير التقرير إلى Excel")}finally{w(!1)}}else Kc.error("لا توجد بيانات للتصدير")},disabled:j||!m,children:[e.jsx(bs,{className:"w-4 h-4 ml-2"}),j?"جاري التصدير...":"تصدير اكسل"]})]})]}),e.jsxs(nc,{className:pc("blue"),children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center gap-3",children:[e.jsx(js,{className:`w-5 h-5 ${hc("blue")}`}),"فلترة التقرير"]}),e.jsx(rc,{children:"اختر الفترة الزمنية للتقرير الشامل للأرباح والخسائر"})]}),e.jsx(ic,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"period",children:"الفترة الزمنية"}),e.jsxs(Nl,{value:p,onValueChange:e=>h(e),children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر الفترة الزمنية"})}),e.jsx(Dl,{children:Object.entries(Eh).map(([t,n])=>e.jsx(Al,{value:t,children:n},t))})]})]}),"custom"===p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"startDate",children:"تاريخ البداية"}),e.jsx(Ir,{id:"startDate",type:"date",value:x,onChange:e=>g(e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"endDate",children:"تاريخ النهاية"}),e.jsx(Ir,{id:"endDate",type:"date",value:f,onChange:e=>v(e.target.value)})]})]})]})})]}),e.jsxs(nc,{className:C.isProfit?pc("green"):pc("red"),children:[e.jsx(ac,{children:e.jsx(sc,{className:"flex items-center gap-3 text-xl",children:C.isProfit?e.jsxs(e.Fragment,{children:[e.jsx(ur,{className:`w-6 h-6 ${hc("green")}`}),e.jsx("span",{children:"ربح"}),e.jsxs(oc,{variant:"secondary",className:"bg-green-100 text-green-800",children:[C.profitMargin.toFixed(1),"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(mr,{className:`w-6 h-6 ${hc("red")}`}),e.jsx("span",{children:"خسارة"}),e.jsx(oc,{variant:"destructive",children:"خسارة"})]})})}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-3xl font-bold",children:C.isProfit?e.jsx(rh,{amount:C.netProfit,currency:o}):e.jsx(rh,{amount:C.lossAmount,currency:o})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:C.isProfit?`صافي الربح بنسبة ${C.profitMargin.toFixed(1)}%`:"إجمالي الخسارة من العمليات"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(nc,{className:pc("blue"),children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-3",children:[e.jsx(ur,{className:`w-5 h-5 ${hc("blue")}`}),"إجمالي الإيرادات"]})}),e.jsxs(ic,{className:"space-y-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(rh,{amount:k.totalRevenue,currency:o})}),e.jsx(Wh,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المدفوعات المكتملة"}),e.jsx(rh,{amount:k.completedPayments,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المدفوعات الجزئية"}),e.jsx(rh,{amount:k.partialPayments,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المبالغ المتبقية"}),e.jsx(rh,{amount:k.remainingBalances,currency:o})]})]})]})]}),e.jsxs(nc,{className:pc("red"),children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-3",children:[e.jsx(mr,{className:`w-5 h-5 ${hc("red")}`}),"إجمالي المصروفات"]})}),e.jsxs(ic,{className:"space-y-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(rh,{amount:C.totalExpenses,currency:o})}),e.jsx(Wh,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"مدفوعات المخابر"}),e.jsx(rh,{amount:S.labOrdersTotal,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"متبقي المخابر"}),e.jsx(rh,{amount:S.labOrdersRemaining,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"احتياجات العيادة"}),e.jsx(rh,{amount:S.clinicNeedsTotal,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"متبقي الاحتياجات"}),e.jsx(rh,{amount:S.clinicNeedsRemaining,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"قيمة المخزون"}),e.jsx(rh,{amount:S.inventoryExpenses,currency:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"مصروفات العيادة المباشرة"}),e.jsx(rh,{amount:S.clinicExpensesTotal||0,currency:o})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(nc,{className:pc("purple"),children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(br,{className:`w-8 h-8 ${hc("purple")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المرضى"}),e.jsx("p",{className:"text-xl font-bold",children:$.totalPatients})]})]})})}),e.jsx(nc,{className:pc("orange"),children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(es,{className:`w-8 h-8 ${hc("orange")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"المواعيد"}),e.jsx("p",{className:"text-xl font-bold",children:$.totalAppointments})]})]})})}),e.jsx(nc,{className:pc("cyan"),children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Qa,{className:`w-8 h-8 ${hc("cyan")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"طلبات المخابر"}),e.jsx("p",{className:"text-xl font-bold",children:$.totalLabOrders})]})]})})}),e.jsx(nc,{className:pc("indigo"),children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Bs,{className:`w-8 h-8 ${hc("indigo")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"احتياجات العيادة"}),e.jsx("p",{className:"text-xl font-bold",children:$.totalClinicNeeds})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsx(sc,{className:"text-lg",children:"متوسط الإيرادات لكل مريض"})}),e.jsx(ic,{children:e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(rh,{amount:$.averageRevenuePerPatient,currency:o})})})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsx(sc,{className:"text-lg",children:"متوسط الإيرادات لكل موعد"})}),e.jsx(ic,{children:e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(rh,{amount:$.averageRevenuePerAppointment,currency:o})})})]})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsx(sc,{className:"text-lg",children:"معلومات التقرير"})}),e.jsx(ic,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الفترة المحددة: "}),e.jsx("span",{className:"font-medium",children:Eh[p]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"نطاق التواريخ: "}),e.jsx("span",{className:"font-medium",children:D.dateRange})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"إجمالي السجلات: "}),e.jsx("span",{className:"font-medium",children:D.totalRecords})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"السجلات المفلترة: "}),e.jsx("span",{className:"font-medium",children:D.filteredRecords})]})]})})]}),function(){if(!m)return null;const{revenue:n,expenses:a,calculations:s}=m,r={primary:d?"#3b82f6":"#2563eb",secondary:d?"#10b981":"#059669",warning:d?"#f59e0b":"#d97706",danger:d?"#ef4444":"#dc2626",purple:d?"#8b5cf6":"#7c3aed",teal:d?"#14b8a6":"#0d9488"},i=[{name:"مدفوعات مكتملة",value:n.completedPayments,color:r.secondary,percentage:n.totalRevenue>0?(n.completedPayments/n.totalRevenue*100).toFixed(1):"0"},{name:"مدفوعات جزئية",value:n.partialPayments,color:r.warning,percentage:n.totalRevenue>0?(n.partialPayments/n.totalRevenue*100).toFixed(1):"0"},{name:"مبالغ معلقة",value:n.pendingAmount||0,color:r.danger,percentage:n.totalRevenue>0?((n.pendingAmount||0)/n.totalRevenue*100).toFixed(1):"0"},{name:"مبالغ متبقية",value:n.remainingBalances,color:r.purple,percentage:n.totalRevenue>0?(n.remainingBalances/n.totalRevenue*100).toFixed(1):"0"}].filter(e=>e.value>0),l=[{name:"طلبات المخابر",value:a.labOrdersTotal,color:r.primary,percentage:s.totalExpenses>0?(a.labOrdersTotal/s.totalExpenses*100).toFixed(1):"0"},{name:"احتياجات العيادة",value:a.clinicNeedsTotal,color:r.secondary,percentage:s.totalExpenses>0?(a.clinicNeedsTotal/s.totalExpenses*100).toFixed(1):"0"},{name:"تكلفة المخزون",value:a.inventoryExpenses,color:r.warning,percentage:s.totalExpenses>0?(a.inventoryExpenses/s.totalExpenses*100).toFixed(1):"0"},{name:"مصروفات مباشرة",value:a.clinicExpensesTotal||0,color:r.danger,percentage:s.totalExpenses>0?((a.clinicExpensesTotal||0)/s.totalExpenses*100).toFixed(1):"0"}].filter(e=>e.value>0),c=[{name:"الإيرادات",value:n.totalRevenue,type:"revenue"},{name:"المصروفات",value:s.totalExpenses,type:"expenses"},{name:"صافي الربح",value:s.isProfit?s.netProfit:-s.lossAmount,type:"profit"}],u={tooltip:{backgroundColor:d?"#1f2937":"#ffffff",border:"1px solid "+(d?"#374151":"#e5e7eb"),borderRadius:"8px",color:d?"#f9fafb":"#111827"},grid:{strokeDasharray:"3 3",stroke:d?"#374151":"#e5e7eb",strokeOpacity:.5}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Gs,{className:"w-5 h-5"}),e.jsx("span",{children:"توزيع الإيرادات"})]}),e.jsxs(rc,{children:["توزيع الإيرادات حسب نوع المدفوعات (",i.length," فئة)"]})]}),e.jsxs(ic,{children:[0===i.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Gs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد بيانات إيرادات متاحة"})]})}):e.jsx(ue,{width:"100%",height:300,children:e.jsxs(pe,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(he,{data:i,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percentage:t})=>`${e}: ${t}%`,outerRadius:100,innerRadius:40,fill:"#8884d8",dataKey:"value",stroke:d?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:i.map((t,n)=>e.jsx(xe,{fill:t.color},`revenue-${n}`))}),e.jsx(ge,{formatter:t=>[e.jsx(rh,{amount:Number(t),currency:o}),"المبلغ"],labelFormatter:e=>`نوع الإيراد: ${e}`,contentStyle:u.tooltip})]})}),i.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:i.map((t,n)=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[t.name,": ",e.jsx(rh,{amount:t.value,currency:o})," (",t.percentage,"%)"]})]},`revenue-legend-${n}`))})]})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Gs,{className:"w-5 h-5"}),e.jsx("span",{children:"توزيع المصروفات"})]}),e.jsxs(rc,{children:["توزيع المصروفات حسب النوع (",l.length," فئة)"]})]}),e.jsxs(ic,{children:[0===l.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Gs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد مصروفات متاحة"})]})}):e.jsx(ue,{width:"100%",height:300,children:e.jsxs(pe,{margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(he,{data:l,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percentage:t})=>`${e}: ${t}%`,outerRadius:100,innerRadius:40,fill:"#8884d8",dataKey:"value",stroke:d?"#1f2937":"#ffffff",strokeWidth:2,paddingAngle:2,children:l.map((t,n)=>e.jsx(xe,{fill:t.color},`expense-${n}`))}),e.jsx(ge,{formatter:t=>[e.jsx(rh,{amount:Number(t),currency:o}),"المبلغ"],labelFormatter:e=>`نوع المصروف: ${e}`,contentStyle:u.tooltip})]})}),l.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:l.map((t,n)=>e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[t.name,": ",e.jsx(rh,{amount:t.value,currency:o})," (",t.percentage,"%)"]})]},`expense-legend-${n}`))})]})]})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Ka,{className:"w-5 h-5"}),e.jsx("span",{children:"مقارنة الإيرادات والمصروفات"})]}),e.jsx(rc,{children:"مقارنة شاملة بين الإيرادات والمصروفات وصافي الربح/الخسارة"})]}),e.jsxs(ic,{children:[e.jsx(ue,{width:"100%",height:400,children:e.jsxs(fe,{data:c,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:"20%",children:[e.jsx(ve,{strokeDasharray:u.grid.strokeDasharray,stroke:u.grid.stroke,strokeOpacity:u.grid.strokeOpacity}),e.jsx(ye,{dataKey:"name",tick:{fontSize:14,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"}}),e.jsx(be,{tick:{fontSize:14,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"},tickFormatter:e=>Math.abs(e)>=1e3?`${(e/1e3).toFixed(0)}k`:e.toString()}),e.jsx(ge,{formatter:t=>[e.jsx(rh,{amount:Number(t),currency:o}),"المبلغ"],labelFormatter:e=>e,contentStyle:u.tooltip}),e.jsx(je,{dataKey:"value",radius:[4,4,0,0],minPointSize:5,maxBarSize:100,children:c.map((t,n)=>e.jsx(xe,{fill:"revenue"===t.type?r.secondary:"expenses"===t.type?r.danger:t.value>=0?r.secondary:r.danger},`comparison-${n}`))})]})}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 dark:bg-green-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400",children:"الإيرادات"}),e.jsx("div",{className:"font-semibold text-green-700 dark:text-green-300",children:e.jsx(rh,{amount:n.totalRevenue,currency:o})})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 dark:bg-red-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400",children:"المصروفات"}),e.jsx("div",{className:"font-semibold text-red-700 dark:text-red-300",children:e.jsx(rh,{amount:s.totalExpenses,currency:o})})]}),e.jsxs("div",{className:"text-center p-3 rounded "+(s.isProfit?"bg-blue-50 dark:bg-blue-950/50":"bg-orange-50 dark:bg-orange-950/50"),children:[e.jsx("div",{className:"text-xs "+(s.isProfit?"text-blue-600 dark:text-blue-400":"text-orange-600 dark:text-orange-400"),children:s.isProfit?"صافي الربح":"صافي الخسارة"}),e.jsx("div",{className:"font-semibold "+(s.isProfit?"text-blue-700 dark:text-blue-300":"text-orange-700 dark:text-orange-300"),children:e.jsx(rh,{amount:s.isProfit?s.netProfit:s.lossAmount,currency:o})})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",dir:"rtl",children:[e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Xs,{className:"w-5 h-5"}),e.jsx("span",{children:"حالات المدفوعات"})]}),e.jsxs(rc,{children:["توزيع المدفوعات حسب الحالة (",t.length," مدفوعة)"]})]}),e.jsx(ic,{children:(()=>{const n=[{name:"مكتملة",value:t.filter(e=>"completed"===e.status).length,color:r.secondary,amount:t.filter(e=>"completed"===e.status).reduce((e,t)=>e+(t.amount||0),0)},{name:"جزئية",value:t.filter(e=>"partial"===e.status).length,color:r.warning,amount:t.filter(e=>"partial"===e.status).reduce((e,t)=>e+(t.amount||0),0)},{name:"معلقة",value:t.filter(e=>"pending"===e.status).length,color:r.danger,amount:t.filter(e=>"pending"===e.status).reduce((e,t)=>e+(t.total_amount_due||t.amount||0),0)}].filter(e=>e.value>0);return 0===n.length?e.jsx("div",{className:"flex items-center justify-center h-80 text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Xs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد مدفوعات متاحة"})]})}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{width:"100%",height:300,children:e.jsxs(fe,{data:n,margin:{top:20,right:30,left:20,bottom:20},barCategoryGap:"20%",children:[e.jsx(ve,{strokeDasharray:u.grid.strokeDasharray,stroke:u.grid.stroke,strokeOpacity:u.grid.strokeOpacity}),e.jsx(ye,{dataKey:"name",tick:{fontSize:14,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"}}),e.jsx(be,{tick:{fontSize:14,fill:d?"#9ca3af":"#6b7280"},axisLine:{stroke:d?"#4b5563":"#d1d5db"},tickLine:{stroke:d?"#4b5563":"#d1d5db"}}),e.jsx(ge,{formatter:(t,n,a)=>[`${t} مدفوعة`,"العدد",e.jsx(rh,{amount:a.payload.amount,currency:o})],labelFormatter:e=>`الحالة: ${e}`,contentStyle:u.tooltip}),e.jsx(je,{dataKey:"value",radius:[4,4,0,0],minPointSize:5,maxBarSize:80,children:n.map((t,n)=>e.jsx(xe,{fill:t.color},`status-${n}`))})]})}),e.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2 text-sm",children:n.map((t,n)=>e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:t.name}),e.jsxs("div",{className:"font-semibold",children:[t.value," مدفوعة"]}),e.jsx("div",{className:"text-xs",children:e.jsx(rh,{amount:t.amount,currency:o})})]},`status-summary-${n}`))})]})})()})]}),e.jsxs(nc,{dir:"rtl",children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ur,{className:"w-5 h-5"}),e.jsx("span",{children:"تحليل الربحية"})]}),e.jsx(rc,{children:"تحليل مفصل لهامش الربح والأداء المالي"})]}),e.jsx(ic,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold mb-2",children:e.jsxs("span",{className:s.isProfit?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:[s.profitMargin.toFixed(1),"%"]})}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"هامش الربح"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"الأداء المالي"}),e.jsx("span",{className:s.isProfit?"text-green-600":"text-red-600",children:s.isProfit?"ربح":"خسارة"})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"h-3 rounded-full transition-all duration-300 "+(s.isProfit?"bg-green-500":"bg-red-500"),style:{width:`${Math.min(Math.abs(s.profitMargin),100)}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:"نسبة المصروفات"}),e.jsxs("div",{className:"font-semibold text-blue-700 dark:text-blue-300",children:[n.totalRevenue>0?(s.totalExpenses/n.totalRevenue*100).toFixed(1):"0","%"]})]}),e.jsxs("div",{className:"p-3 bg-purple-50 dark:bg-purple-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400",children:"كفاءة التكلفة"}),e.jsxs("div",{className:"font-semibold text-purple-700 dark:text-purple-300",children:[s.totalExpenses>0?(n.totalRevenue/s.totalExpenses*100).toFixed(0):"0","%"]})]}),e.jsxs("div",{className:"p-3 bg-teal-50 dark:bg-teal-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-teal-600 dark:text-teal-400",children:"متوسط المعاملة"}),e.jsx("div",{className:"font-semibold text-teal-700 dark:text-teal-300",children:e.jsx(rh,{amount:t.length>0?n.totalRevenue/t.length:0,currency:o})})]}),e.jsxs("div",{className:"p-3 bg-orange-50 dark:bg-orange-950/50 rounded",children:[e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:"المبالغ المعلقة"}),e.jsx("div",{className:"font-semibold text-orange-700 dark:text-orange-300",children:e.jsx(rh,{amount:n.pendingAmount||0,currency:o})})]})]})]})})]})]})]})}()]})}function Qh(){const{currency:t}=ta(),{payments:n}=ca(),{expenses:a}=mh(),{appointments:s}=Jn(),{items:r}=ma(),{patients:i}=bt(),{needs:l,totalValue:o}=uh(),{labOrders:c}=ph(),{toothTreatments:d}=cc(),{prescriptions:m}=pa(),{reportData:u,patientReports:p,appointmentReports:h,financialReports:x,inventoryReports:g,clinicNeedsReports:f,isLoading:v,isExporting:y,error:b,activeReportType:j,currentFilter:w,generateReport:N,generateAllReports:_,setActiveReportType:k,setFilter:S,exportReport:C,clearError:$}=oh(),[D,E]=re.useState("overview"),[T,A]=re.useState("this_month"),[F,P]=re.useState(""),[R,O]=re.useState(""),[M,L]=re.useState(!1),I=(e,t)=>{if("all"===T)return e;const n=new Date;let a,s=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59);switch(T){case"today":a=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0);break;case"this_week":const t=n.getDay();a=new Date(n.getTime()-24*t*60*60*1e3),a.setHours(0,0,0,0);break;case"this_month":a=new Date(n.getFullYear(),n.getMonth(),1,0,0,0);break;case"this_year":a=new Date(n.getFullYear(),0,1,0,0,0);break;case"last_week":const r=new Date(n.getTime()-24*n.getDay()*60*60*1e3);r.setHours(23,59,59,999),s=r,a=new Date(r.getTime()-5184e5),a.setHours(0,0,0,0);break;case"last_month":const i=0===n.getMonth()?11:n.getMonth()-1,l=0===n.getMonth()?n.getFullYear()-1:n.getFullYear();a=new Date(l,i,1,0,0,0),s=new Date(n.getFullYear(),n.getMonth(),0,23,59,59);break;case"last_year":a=new Date(n.getFullYear()-1,0,1,0,0,0),s=new Date(n.getFullYear()-1,11,31,23,59,59);break;case"last_30_days":a=new Date(n.getTime()-2592e6),a.setHours(0,0,0,0);break;case"last_90_days":a=new Date(n.getTime()-7776e6),a.setHours(0,0,0,0);break;case"custom":if(!F||!R)return e;a=new Date(F),s=new Date(R),s.setHours(23,59,59,999);break;default:return e}return e.filter(e=>{const n=new Date(e[t]);return n>=a&&n<=s})},z=I(s,"start_time"),B=I(n,"payment_date"),V=I(r,"created_at"),Y=I(l,"created_at"),q=I(a,"payment_date"),U=B.filter(e=>{const t=e.status?.toLowerCase();return"pending"===t||"معلق"===t||"unpaid"===t||!e.status&&e.amount>0&&!e.amount_paid}),H=U.reduce((e,t)=>{let n=t.amount||0;if(t.tooth_treatment_id){n=t.treatment_total_cost||t.total_amount_due||0}else 0===n&&(t.total_amount_due||0)>0?n=t.total_amount_due:0===n&&(t.remaining_balance||0)>0&&(n=t.remaining_balance);return e+n},0);console.log("🔍 Debug Pending Payments:",{totalPayments:n.length,filteredPayments:B.length,filteredPendingPayments:U.length,filteredPendingAmount:H,selectedPeriod:T,allPayments:n.map(e=>({id:e.id,status:e.status,amount:e.amount,date:e.payment_date,patient:e.patient?.full_name})),filteredPendingDetails:U.map(e=>{let t=e.amount||0;if(e.tooth_treatment_id){t=e.treatment_total_cost||e.total_amount_due||0}else 0===t&&(e.total_amount_due||0)>0?t=e.total_amount_due:0===t&&(e.remaining_balance||0)>0&&(t=e.remaining_balance);return{id:e.id,status:e.status,amount:e.amount,total_amount_due:e.total_amount_due,treatment_total_cost:e.treatment_total_cost,amount_paid:e.amount_paid,remaining_balance:e.remaining_balance,calculatedPendingAmount:t,date:e.payment_date,patient:e.patient?.full_name,tooth_treatment_id:e.tooth_treatment_id}})}),re.useEffect(()=>{console.log("🔄 Loading initial reports..."),$(),_();(async()=>{try{const{loadAppointments:e}=Jn.getState(),{loadPayments:t}=ca.getState(),{loadItems:n}=ma.getState(),{loadPatients:a}=bt.getState(),{loadNeeds:s}=uh.getState(),{loadLabOrders:r}=ph.getState(),{loadToothTreatments:i}=cc.getState(),{loadPrescriptions:l}=pa.getState();console.log("🔄 Loading all data for comprehensive reports..."),await Promise.all([e(),t(),n(),a(),s(),r(),i(),l()]),console.log("✅ All data loaded successfully for reports")}catch(e){console.error("❌ Error loading data for reports:",e)}})()},[_,$]),re.useEffect(()=>{if(b){console.error("❌ Reports error:",b);const e=new CustomEvent("showToast",{detail:{title:"خطأ في التقارير",description:b,type:"error"}});window.dispatchEvent(e)}},[b]);return hh(["overview"]),re.useEffect(()=>{const{startAutoRefresh:e,stopAutoRefresh:t}=oh.getState();return e(1),()=>{t()}},[]),re.useEffect(()=>{k(D)},[D,k]),e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"التقارير والتحليلات"}),e.jsx(Oh,{isActive:!0})]}),e.jsx("p",{className:"text-muted-foreground",children:"تقارير شاملة ومفصلة لجميع جوانب العيادة - تحديث تلقائي في الوقت الفعلي"})]})}),b&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(qa,{className:"h-5 w-5 text-red-600 ml-2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"خطأ في تحميل التقارير"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:b})]}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:$,className:"mr-auto",children:"إغلاق"})]})}),v&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Js,{className:"h-8 w-8 animate-spin text-sky-600 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل التقارير..."})]})}),e.jsxs(Ud,{value:D,onValueChange:async e=>{E(e),k(e);try{if("treatments"===e){const{loadToothTreatments:e}=cc.getState(),{loadPatients:t}=bt.getState();await Promise.all([e(),t()])}else if("clinicNeeds"===e){const{loadNeeds:e}=uh.getState();await e()}else if("inventory"===e){const{loadItems:e}=ma.getState();await e()}else if("financial"===e){const{loadPayments:e}=ca.getState(),{loadLabOrders:t}=ph.getState();await Promise.all([e(),t()])}else if("profitLoss"===e){const{loadPayments:e}=ca.getState(),{loadExpenses:t}=mh.getState(),{loadLabOrders:n}=ph.getState(),{loadNeeds:a}=uh.getState(),{loadItems:s}=ma.getState();await Promise.all([e(),t(),n(),a(),s()])}else if("patients"===e){const{loadPatients:e}=bt.getState();await e()}else if("appointments"===e){const{loadAppointments:e}=Jn.getState();await e()}"overview"!==e&&await N(e)}catch(t){console.error(`❌ Error loading data for ${e} tab:`,t)}},className:"space-y-6",children:[e.jsxs(Hd,{className:"grid w-full grid-cols-7",children:[e.jsxs(Gd,{value:"overview",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Xa,{className:"w-4 h-4"}),e.jsx("span",{children:"التقرير الشامل المفصل"})]}),e.jsxs(Gd,{value:"profitLoss",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ur,{className:"w-4 h-4"}),e.jsx("span",{children:"المالية"})]}),e.jsxs(Gd,{value:"patients",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(br,{className:"w-4 h-4"}),e.jsx("span",{children:"المرضى"})]}),e.jsxs(Gd,{value:"appointments",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(es,{className:"w-4 h-4"}),e.jsx("span",{children:"المواعيد"})]}),e.jsxs(Gd,{value:"treatments",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ir,{className:"w-4 h-4"}),e.jsx("span",{children:"العلاجات"})]}),e.jsxs(Gd,{value:"inventory",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Bs,{className:"w-4 h-4"}),e.jsx("span",{children:"المخزون"})]}),e.jsxs(Gd,{value:"clinicNeeds",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{children:"احتياجات العيادة"})]})]}),e.jsx(Wd,{value:"overview",className:"space-y-6",dir:"rtl",children:e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(Ka,{className:"w-6 h-6"}),"التقرير الشامل المفصل"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"نظرة شاملة على أداء العيادة"})]}),e.jsxs(Lr,{variant:"outline",onClick:async()=>{L(!0);try{console.log("🔄 Loading fresh data for comprehensive export...");const{loadAppointments:e}=Jn.getState(),{loadPayments:t}=ca.getState(),{loadExpenses:o}=mh.getState(),{loadItems:u}=ma.getState(),{loadPatients:p}=bt.getState(),{loadNeeds:h}=uh.getState(),{loadLabOrders:x}=ph.getState(),{loadToothTreatments:g}=cc.getState(),{loadPrescriptions:f}=pa.getState();await Promise.all([e(),t(),o(),u(),p(),h(),x(),g(),f()]),console.log("✅ All data loaded, starting filtered export..."),await Th.exportComprehensiveReport({patients:i,appointments:s,payments:n,inventory:r,treatments:d||[],prescriptions:m||[],labOrders:c||[],clinicNeeds:l||[],expenses:a||[],timePeriod:T,customStartDate:"custom"===T?F:void 0,customEndDate:"custom"===T?R:void 0});let v="تم تصدير التقرير الشامل المفصل بنجاح!";v+=` (${Eh[T]})`;v+=` - ${s.length+n.length+(d?.length||0)+(m?.length||0)+(c?.length||0)+(l?.length||0)} سجل إجمالي`,Kc.exportSuccess(v)}catch(e){console.error("Error exporting comprehensive report:",e),Kc.exportError("فشل في تصدير التقرير الشامل")}finally{L(!1)}},disabled:M,className:"flex items-center gap-2",children:[e.jsx(fs,{className:"w-4 h-4"}),M?"جاري التصدير...":"تصدير التقرير"]})]}),e.jsxs(nc,{className:pc("blue"),children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center gap-3",children:[e.jsx(js,{className:`w-5 h-5 ${hc("blue")}`}),"فلترة التقرير"]}),e.jsx(rc,{children:"اختر الفترة الزمنية للتقرير الشامل"})]}),e.jsx(ic,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"period",children:"الفترة الزمنية"}),e.jsxs(Nl,{value:T,onValueChange:e=>A(e),children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر الفترة الزمنية"})}),e.jsx(Dl,{children:Object.entries(Eh).map(([t,n])=>e.jsx(Al,{value:t,children:n},t))})]})]}),"custom"===T&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"startDate",children:"تاريخ البداية"}),e.jsx(Ir,{id:"startDate",type:"date",value:F,onChange:e=>P(e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"endDate",children:"تاريخ النهاية"}),e.jsx(Ir,{id:"endDate",type:"date",value:R,onChange:e=>O(e.target.value)})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",dir:"rtl",children:[e.jsx(nc,{className:pc("blue"),children:e.jsx(ic,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${pc("blue")}`,children:e.jsx(br,{className:`w-6 h-6 ${hc("blue")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المرضى"}),e.jsx("p",{className:"text-2xl font-bold",children:i.length})]})]})})}),e.jsx(nc,{className:pc("purple"),children:e.jsx(ic,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${pc("purple")}`,children:e.jsx(es,{className:`w-6 h-6 ${hc("purple")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"المواعيد المفلترة"}),e.jsx("p",{className:"text-2xl font-bold",children:z.length})]})]})})}),e.jsx(nc,{className:pc("green"),children:e.jsx(ic,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${pc("green")}`,children:e.jsx(gs,{className:`w-6 h-6 ${hc("green")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"الإيرادات المفلترة"}),e.jsx("p",{className:"text-xl font-bold",children:e.jsx(rh,{amount:B.reduce((e,t)=>e+(t.amount||0),0),currency:t})})]})]})})}),e.jsx(nc,{className:pc("orange"),children:e.jsx(ic,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${pc("orange")}`,children:e.jsx(Bs,{className:`w-6 h-6 ${hc("orange")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"عناصر المخزون المفلترة"}),e.jsx("p",{className:"text-2xl font-bold",children:V.length})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(ur,{className:"w-5 h-5 text-green-500"}),"الملخص المالي"]})}),e.jsxs(ic,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-green-50/80 dark:bg-green-950/50 border border-green-200/50 dark:border-green-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"الإيرادات المفلترة"}),e.jsx("span",{className:"text-lg font-bold text-green-700 dark:text-green-100",children:e.jsx(rh,{amount:B.reduce((e,t)=>e+(t.amount||0),0),currency:t})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-yellow-50/80 dark:bg-yellow-950/50 border border-yellow-200/50 dark:border-yellow-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"المدفوعات المعلقة المفلترة"}),e.jsx("span",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-100",children:e.jsx(rh,{amount:H,currency:t})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-orange-50/80 dark:bg-orange-950/50 border border-orange-200/50 dark:border-orange-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("span",{className:"text-sm font-medium text-orange-800 dark:text-orange-200",children:"المدفوعات الجزئية المفلترة"}),e.jsx("span",{className:"text-lg font-bold text-orange-700 dark:text-orange-100",children:e.jsx(rh,{amount:B.filter(e=>"partial"===e.status).reduce((e,t)=>{const n=Number(t.total_amount_due||t.amount)||0,a=Number(t.amount_paid||t.amount)||0;return e+Math.max(0,n-a)},0),currency:t})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-red-50/80 dark:bg-red-950/50 border border-red-200/50 dark:border-red-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("span",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"المصروفات المفلترة"}),e.jsx("span",{className:"text-lg font-bold text-red-700 dark:text-red-100",children:e.jsx(rh,{amount:q.reduce((e,t)=>e+(t.amount||0),0),currency:t})})]})]})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"w-5 h-5 text-blue-500"}),"إحصائيات سريعة"]})}),e.jsx(ic,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50/80 dark:bg-blue-950/50 border border-blue-200/50 dark:border-blue-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-100",children:z.filter(e=>"completed"===e.status).length}),e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-200 mt-1 font-medium",children:"مواعيد مكتملة مفلترة"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50/80 dark:bg-purple-950/50 border border-purple-200/50 dark:border-purple-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-100",children:z.filter(e=>"scheduled"===e.status).length}),e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-200 mt-1 font-medium",children:"مواعيد مجدولة مفلترة"})]}),e.jsxs("div",{className:"text-center p-4 bg-emerald-50/80 dark:bg-emerald-950/50 border border-emerald-200/50 dark:border-emerald-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-700 dark:text-emerald-100",children:Y.length}),e.jsx("div",{className:"text-xs text-emerald-600 dark:text-emerald-200 mt-1 font-medium",children:"احتياجات العيادة المفلترة"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50/80 dark:bg-orange-950/50 border border-orange-200/50 dark:border-orange-700/50 rounded-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-700 dark:text-orange-100",children:q.length}),e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-200 mt-1 font-medium",children:"مصروفات مفلترة"})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(nc,{className:pc("cyan"),children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(bs,{className:`w-6 h-6 ${hc("cyan")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"العلاجات"}),e.jsx("p",{className:"text-xl font-bold",children:d?.length||0})]})]})})}),e.jsx(nc,{className:pc("indigo"),children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(bs,{className:`w-6 h-6 ${hc("indigo")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"الوصفات"}),e.jsx("p",{className:"text-xl font-bold",children:m?.length||0})]})]})})}),e.jsx(nc,{className:pc("purple"),children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Qa,{className:`w-6 h-6 ${hc("purple")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"طلبات المخابر"}),e.jsx("p",{className:"text-xl font-bold",children:c?.length||0})]})]})})}),e.jsx(nc,{className:pc("gray"),children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ms,{className:`w-6 h-6 ${hc("gray")}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"احتياجات العيادة المفلترة"}),e.jsx("p",{className:"text-xl font-bold",children:Y.length})]})]})})})]})]})}),e.jsx(Wd,{value:"patients",dir:"rtl",children:e.jsx(bh,{})}),e.jsx(Wd,{value:"appointments",dir:"rtl",children:e.jsx(wh,{})}),e.jsx(Wd,{value:"financial",dir:"rtl",children:e.jsx(Rh,{})}),e.jsx(Wd,{value:"treatments",dir:"rtl",children:e.jsx(Ih,{})}),e.jsx(Wd,{value:"inventory",dir:"rtl",children:e.jsx(jh,{})}),e.jsx(Wd,{value:"clinicNeeds",dir:"rtl",children:e.jsx(Yh,{})}),e.jsx(Wd,{value:"profitLoss",dir:"rtl",children:e.jsx(Zh,{})})]})]})}class Xh{static async getQuickAccessData(){try{const[e,t,n,a,s]=await Promise.all([this.getRecentPatients(),this.getTodayAppointments(),this.getPendingPayments(),this.getUrgentTreatments(),this.getRecentActivities()]);return{recentPatients:e,todayAppointments:t,pendingPayments:n,urgentTreatments:a,recentActivities:s,quickStats:await this.getQuickStats()}}catch(e){throw console.error("Error getting quick access data:",e),new Error("فشل في جلب بيانات الوصول السريع")}}static async getRecentPatients(){try{const e=await(window.electronAPI?.patients?.getAll?.())||[];return 0===e.length?[]:e.sort((e,t)=>new Date(t.updated_at||t.created_at).getTime()-new Date(e.updated_at||e.created_at).getTime()).slice(0,5)}catch(e){return console.error("Error getting recent patients:",e),[]}}static async getTodayAppointments(){try{const e=await(window.electronAPI?.appointments?.getAll?.())||[],t=new Date;return e.filter(e=>{const n=new Date(e.start_time);return this.isSameDay(n,t)}).sort((e,t)=>new Date(e.start_time).getTime()-new Date(t.start_time).getTime())}catch(e){return console.error("Error getting today appointments:",e),[]}}static async getPendingPayments(){try{return(await(window.electronAPI?.payments?.getAll?.())||[]).filter(e=>"pending"===e.status&&e.remaining_balance&&e.remaining_balance>0).sort((e,t)=>new Date(e.payment_date).getTime()-new Date(t.payment_date).getTime()).slice(0,10)}catch(e){return console.error("Error getting pending payments:",e),[]}}static async getUrgentTreatments(){try{const e=await(window.electronAPI?.treatments?.getAll?.())||[],t=new Date;return e.filter(e=>{if("planned"!==e.treatment_status&&"in_progress"!==e.treatment_status)return!1;const n=new Date(e.created_at);return Math.floor((t.getTime()-n.getTime())/864e5)>7}).sort((e,t)=>e.priority!==t.priority?e.priority-t.priority:new Date(e.created_at).getTime()-new Date(t.created_at).getTime()).slice(0,8)}catch(e){return console.error("Error getting urgent treatments:",e),[]}}static async getRecentActivities(){try{const e=[],t=(await(window.electronAPI?.patients?.getAll?.())||[]).sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,3);t.forEach(t=>{e.push({id:`patient_added_${t.id}`,type:"patient_added",title:"مريض جديد",description:`تم إضافة المريض ${t.full_name}`,patientId:t.id,patientName:t.full_name,timestamp:t.created_at,icon:"👤"})});const n=(await(window.electronAPI?.appointments?.getAll?.())||[]).filter(e=>"completed"===e.status).sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime()).slice(0,3);n.forEach(t=>{e.push({id:`appointment_completed_${t.id}`,type:"appointment_created",title:"موعد مكتمل",description:`تم إكمال موعد ${t.patient?.full_name||"مريض غير محدد"}`,patientId:t.patient_id,patientName:t.patient?.full_name,timestamp:t.updated_at,icon:"📅"})});const a=(await(window.electronAPI?.payments?.getAll?.())||[]).filter(e=>"completed"===e.status).sort((e,t)=>new Date(t.payment_date).getTime()-new Date(e.payment_date).getTime()).slice(0,3);return a.forEach(t=>{e.push({id:`payment_received_${t.id}`,type:"payment_received",title:"دفعة مستلمة",description:`تم استلام دفعة ${t.amount}$ من ${t.patient?.full_name||"مريض غير محدد"}`,patientId:t.patient_id,patientName:t.patient?.full_name,timestamp:t.payment_date,icon:"💰"})}),e.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()).slice(0,10)}catch(e){return console.error("Error getting recent activities:",e),[]}}static async getQuickStats(){try{const[e,t,n]=await Promise.all([window.electronAPI?.patients?.getAll?.()||[],window.electronAPI?.appointments?.getAll?.()||[],window.electronAPI?.payments?.getAll?.()||[]]),a=new Date,s=e.length,r=t.filter(e=>{const t=new Date(e.start_time);return this.isSameDay(t,a)}).length,i=n.filter(e=>"pending"===e.status&&e.remaining_balance&&e.remaining_balance>0).length;return{totalPatients:s,todayAppointments:r,pendingPayments:i,urgentAlerts:0}}catch(e){return console.error("Error getting quick stats:",e),{totalPatients:0,todayAppointments:0,pendingPayments:0,urgentAlerts:0}}}static async refreshQuickAccessData(){return this.getQuickAccessData()}static async getMostVisitedPatients(){try{const e=await(window.electronAPI?.appointments?.getAll?.())||[],t=await(window.electronAPI?.patients?.getAll?.())||[],n={};return e.forEach(e=>{e.patient_id&&"completed"===e.status&&(n[e.patient_id]=(n[e.patient_id]||0)+1)}),t.filter(e=>n[e.id]>0).sort((e,t)=>(n[t.id]||0)-(n[e.id]||0)).slice(0,10)}catch(e){return console.error("Error getting most visited patients:",e),[]}}static async getPatientsNeedingFollowUp(){try{const e=await(window.electronAPI?.appointments?.getAll?.())||[],t=await(window.electronAPI?.patients?.getAll?.())||[],n=new Date,a={};return e.forEach(e=>{if(e.patient_id&&"completed"===e.status){const t=new Date(e.start_time);(!a[e.patient_id]||t>a[e.patient_id])&&(a[e.patient_id]=t)}}),t.filter(e=>{const t=a[e.id];if(!t)return!1;return Math.floor((n.getTime()-t.getTime())/864e5)>90}).slice(0,10)}catch(e){return console.error("Error getting patients needing follow up:",e),[]}}static isSameDay(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}}class Jh{static async performGlobalSearch(e){const t=Date.now();try{const n=e.types||["patient","appointment","payment","treatment","prescription"],a=[];n.includes("patient")&&a.push(this.searchPatients(e)),n.includes("appointment")&&a.push(this.searchAppointments(e)),n.includes("payment")&&a.push(this.searchPayments(e)),n.includes("treatment")&&a.push(this.searchTreatments(e)),n.includes("prescription")&&a.push(this.searchPrescriptions(e));const s=await Promise.all(a),r={patients:n.includes("patient")&&s[n.indexOf("patient")]||[],appointments:n.includes("appointment")&&s[n.indexOf("appointment")]||[],payments:n.includes("payment")&&s[n.indexOf("payment")]||[],treatments:n.includes("treatment")&&s[n.indexOf("treatment")]||[],prescriptions:n.includes("prescription")&&s[n.indexOf("prescription")]||[],totalCount:0,searchTime:Date.now()-t,query:e.query};return r.totalCount=r.patients.length+r.appointments.length+r.payments.length+r.treatments.length+r.prescriptions.length,this.sortResultsByRelevance(r,e),e.limit&&this.limitResults(r,e.limit),r}catch(n){throw console.error("Global search error:",n),new Error("فشل في البحث الشامل")}}static async searchPatients(e){try{return(await(window.electronAPI?.patients?.search?.(e.query))||[]).map(t=>({id:t.id,type:"patient",title:t.full_name,subtitle:`#${t.serial_number} | ${t.age} سنة | ${"male"===t.gender?"ذكر":"أنثى"}`,description:`📞 ${t.phone||"غير محدد"} | 📧 ${t.email||"غير محدد"}`,relevanceScore:this.calculateRelevanceScore(e.query,[t.full_name,t.serial_number,t.phone||"",t.email||""]),data:t,relatedData:{patientId:t.id}}))}catch(t){return console.error("Search patients error:",t),[]}}static async searchAppointments(e){try{return(await(window.electronAPI?.appointments?.search?.(e.query))||[]).map(t=>({id:t.id,type:"appointment",title:t.title,subtitle:`${t.patient_name||"مريض غير محدد"} | ${this.formatDate(t.start_time)}`,description:`🕐 ${this.formatTime(t.start_time)} - ${this.formatTime(t.end_time)} | ${this.getStatusText(t.status)}`,relevanceScore:this.calculateRelevanceScore(e.query,[t.title,t.description||"",t.patient_name||"",t.notes||""]),data:t,relatedData:{patientId:t.patient_id,appointmentId:t.id}}))}catch(t){return console.error("Search appointments error:",t),[]}}static async searchPayments(e){try{return(await(window.electronAPI?.payments?.search?.(e.query))||[]).map(t=>({id:t.id,type:"payment",title:`دفعة ${t.amount}$ - ${t.patient_name||"مريض غير محدد"}`,subtitle:`${this.formatDate(t.payment_date)} | ${t.receipt_number||"بدون رقم إيصال"}`,description:`💳 ${"cash"===t.payment_method?"نقدي":"تحويل بنكي"} | ${this.getPaymentStatusText(t.status)}`,relevanceScore:this.calculateRelevanceScore(e.query,[t.patient?.full_name||"",t.description||"",t.receipt_number||"",t.notes||""]),data:t,relatedData:{patientId:t.patient_id,paymentId:t.id,appointmentId:t.appointment_id}}))}catch(t){return console.error("Search payments error:",t),[]}}static async searchTreatments(e){try{return(await(window.electronAPI?.treatments?.search?.(e.query))||[]).map(t=>({id:t.id,type:"treatment",title:`${ka(t.treatment_type)} - السن ${t.tooth_number}`,subtitle:`${t.patient_name||"مريض غير محدد"} | ${this.getTreatmentStatusText(t.treatment_status)}`,description:`🦷 ${t.tooth_name} | 💰 ${t.cost||0}$`,relevanceScore:this.calculateRelevanceScore(e.query,[ka(t.treatment_type),t.tooth_name,t.patient?.full_name||"",t.notes||""]),data:t,relatedData:{patientId:t.patient_id,treatmentId:t.id,appointmentId:t.appointment_id}}))}catch(t){return console.error("Search treatments error:",t),[]}}static async searchPrescriptions(e){try{return(await(window.electronAPI?.prescriptions?.search?.(e.query))||[]).map(t=>({id:t.id,type:"prescription",title:`وصفة ${t.patient_name||"مريض غير محدد"}`,subtitle:`${this.formatDate(t.prescription_date)} | ${t.medications?.length||0} دواء`,description:`💊 ${t.medications?.map(e=>e.medication_name).join(", ")||"لا توجد أدوية"}`,relevanceScore:this.calculateRelevanceScore(e.query,[t.patient?.full_name||"",t.notes||"",...t.medications?.map(e=>e.medication_name||"")||[]]),data:t,relatedData:{patientId:t.patient_id,appointmentId:t.appointment_id,treatmentId:t.tooth_treatment_id}}))}catch(t){return console.error("Search prescriptions error:",t),[]}}static calculateRelevanceScore(e,t){const n=e.toLowerCase();let a=0;return t.forEach(e=>{if(e){const t=e.toLowerCase();if(t===n)a+=100;else if(t.startsWith(n))a+=80;else if(t.includes(n))a+=60;else{n.split(" ").forEach(e=>{e.length>2&&t.includes(e)&&(a+=20)})}}}),a}static sortResultsByRelevance(e,t){const n=(e,n)=>"relevance"===t.sortBy?"asc"===t.sortOrder?e.relevanceScore-n.relevanceScore:n.relevanceScore-e.relevanceScore:"name"===t.sortBy?"asc"===t.sortOrder?e.title.localeCompare(n.title):n.title.localeCompare(e.title):0;e.patients.sort(n),e.appointments.sort(n),e.payments.sort(n),e.treatments.sort(n),e.prescriptions.sort(n)}static limitResults(e,t){if(e.totalCount<=t)return;const n=Math.floor(t/5),a=t%5;e.patients=e.patients.slice(0,n+(a>0?1:0)),e.appointments=e.appointments.slice(0,n+(a>1?1:0)),e.payments=e.payments.slice(0,n+(a>2?1:0)),e.treatments=e.treatments.slice(0,n+(a>3?1:0)),e.prescriptions=e.prescriptions.slice(0,n+(a>4?1:0)),e.totalCount=t}static formatDate(e){try{const t=new Date(e);if(isNaN(t.getTime()))return"--";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${n}/${a}/${t.getFullYear()}`}catch(t){return"--"}}static formatTime(e){return new Date(e).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})}static getStatusText(e){return{scheduled:"🟡 مجدول",completed:"🟢 مكتمل",cancelled:"🔴 ملغي",no_show:"⚫ لم يحضر"}[e]||e}static getPaymentStatusText(e){return{completed:"🟢 مكتمل",partial:"🟡 جزئي",pending:"🔴 معلق"}[e]||e}static getTreatmentStatusText(e){return{planned:"🟡 مخطط",in_progress:"🔵 قيد التنفيذ",completed:"🟢 مكتمل",cancelled:"🔴 ملغي"}[e]||e}}const ex=de()(xt((e,t)=>{if("undefined"!=typeof window){const e=()=>{console.log("🔄 Global Store: Data changed, refreshing alerts..."),t().loadAlerts()};["patient-added","patient-updated","patient-deleted","patient-changed","appointment-added","appointment-updated","appointment-deleted","appointment-changed","payment-added","payment-updated","payment-deleted","payment-changed","treatment-added","treatment-updated","treatment-deleted","treatment-changed","prescription-added","prescription-updated","prescription-deleted","prescription-changed","inventory-added","inventory-updated","inventory-deleted","inventory-changed"].forEach(t=>{window.addEventListener(t,e)})}return{globalSearchQuery:"",globalSearchResults:null,isSearching:!1,searchHistory:[],alerts:[],unreadAlertsCount:0,isLoadingAlerts:!1,quickAccessData:null,isLoadingQuickAccess:!1,recentActivities:[],quickActions:[],quickLinks:[],isGlobalLoading:!1,lastSyncTime:null,error:null,showGlobalSearch:!1,showQuickAccess:!0,showAlerts:!0,eventListenersSetup:!1,setGlobalSearchQuery:t=>{e({globalSearchQuery:t})},performGlobalSearch:async n=>{e({isSearching:!0,error:null});try{const a=Date.now(),s=await Jh.performGlobalSearch(n),r=Date.now()-a;e({globalSearchResults:{...s,searchTime:r,query:n.query},isSearching:!1}),n.query.trim()&&t().addToSearchHistory(n.query.trim())}catch(a){console.error("Global search error:",a),e({error:a instanceof Error?a.message:"فشل في البحث الشامل",isSearching:!1})}},clearSearchResults:()=>{e({globalSearchResults:null,globalSearchQuery:""})},addToSearchHistory:n=>{const{searchHistory:a}=t(),s=[n,...a.filter(e=>e!==n)].slice(0,10);e({searchHistory:s})},clearSearchHistory:()=>{e({searchHistory:[]})},loadAlerts:async()=>{e({isLoadingAlerts:!0,error:null});try{const t=await Xn.getAllAlerts(),n=t.filter(e=>!e.isRead&&!e.isDismissed).length;console.log("📊 Loaded alerts:",t.length,"unread:",n),console.log("📋 Alert details:",t.map(e=>({id:e.id,title:e.title,isRead:e.isRead,isDismissed:e.isDismissed}))),e({alerts:t,unreadAlertsCount:n,isLoadingAlerts:!1})}catch(t){console.error("Load alerts error:",t),e({error:t instanceof Error?t.message:"فشل في تحميل التنبيهات",isLoadingAlerts:!1,alerts:[],unreadAlertsCount:0})}},markAlertAsRead:async e=>{try{console.log("🏪 GlobalStore: markAlertAsRead called for:",e);const n=t().alerts.find(t=>t.id===e);if(!n)return void console.warn("⚠️ Alert not found in store:",e);console.log("📋 Current alert state:",{id:n.id,title:n.title,isRead:n.isRead}),console.log("🔄 Calling SmartAlertsService.updateAlert..."),await Xn.updateAlert(e,{isRead:!0}),console.log("✅ SmartAlertsService.updateAlert completed")}catch(n){throw console.error("❌ Mark alert as read error:",n),n}},dismissAlert:async e=>{try{await Xn.updateAlert(e,{isDismissed:!0})}catch(t){console.error("Dismiss alert error:",t)}},snoozeAlert:async(e,t)=>{try{await Xn.updateAlert(e,{snoozeUntil:t})}catch(n){console.error("Snooze alert error:",n)}},createAlert:async e=>{try{await Xn.createAlert(e)}catch(t){console.error("Create alert error:",t)}},loadQuickAccessData:async()=>{e({isLoadingQuickAccess:!0,error:null});try{const t=await Xh.getQuickAccessData();e({quickAccessData:t,isLoadingQuickAccess:!1})}catch(t){console.error("Load quick access data error:",t),e({error:t instanceof Error?t.message:"فشل في تحميل بيانات الوصول السريع",isLoadingQuickAccess:!1})}},refreshQuickAccessData:async()=>{await t().loadQuickAccessData()},addActivity:n=>{const{recentActivities:a}=t(),s=[{...n,id:`activity_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:(new Date).toISOString()},...a].slice(0,50);e({recentActivities:s})},loadRecentActivities:async()=>{try{const t=await(window.electronAPI?.activities?.getRecent?.())||[];e({recentActivities:t})}catch(t){console.error("Load recent activities error:",t)}},executeQuickAction:e=>{const{quickActions:n}=t(),a=n.find(t=>t.id===e);a&&a.action()},addQuickAction:n=>{const{quickActions:a}=t();e({quickActions:[...a,n]})},removeQuickAction:n=>{const{quickActions:a}=t();e({quickActions:a.filter(e=>e.id!==n)})},syncAllData:async()=>{e({isGlobalLoading:!0});try{await Promise.all([t().loadAlerts(),t().loadQuickAccessData(),t().loadRecentActivities()]),e({lastSyncTime:(new Date).toISOString(),isGlobalLoading:!1})}catch(n){console.error("Sync all data error:",n),e({error:n instanceof Error?n.message:"Sync failed",isGlobalLoading:!1})}},clearError:()=>{e({error:null})},toggleGlobalSearch:()=>{e(e=>({showGlobalSearch:!e.showGlobalSearch}))},toggleQuickAccess:()=>{e(e=>({showQuickAccess:!e.showQuickAccess}))},toggleAlerts:()=>{e(e=>({showAlerts:!e.showAlerts}))}}},{name:"globalThis-store"}));function tx({onResultSelect:t,onClose:n,autoFocus:a=!0,placeholder:s="🔍 ابحث في المرضى، المواعيد، الدفعات، العلاجات... (F)"}){const{globalSearchQuery:r,globalSearchResults:i,isSearching:l,searchHistory:o,setGlobalSearchQuery:c,performGlobalSearch:d,clearSearchResults:m,addToSearchHistory:u}=ex(),[p,h]=re.useState(!1),[x,g]=re.useState(-1),f=re.useRef(null),v=re.useRef(null),y=re.useRef(null);re.useEffect(()=>{a&&f.current&&f.current.focus()},[a]),re.useEffect(()=>{const e=e=>{y.current&&!y.current.contains(e.target)&&j()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);re.useEffect(()=>{const e=setTimeout(()=>{r&&(async e=>{if(c(e),e.trim().length>0){const n={query:e.trim(),sortBy:"relevance",sortOrder:"desc",limit:20};try{await d(n),h(!0),g(-1),console.log("🔍 Search performed:",e.trim()),console.log("🔍 Search results:",i)}catch(t){console.error("Search error:",t),h(!0)}}else h(!1),m()})(r)},300);return()=>clearTimeout(e)},[r]);const b=e=>{u(r),t?.(e),j()},j=()=>{h(!1),m(),c(""),n?.()},w=t=>{switch(t){case"patient":return e.jsx(yr,{className:"w-4 h-4 text-blue-500"});case"appointment":return e.jsx(es,{className:"w-4 h-4 text-purple-500"});case"payment":return e.jsx(gs,{className:"w-4 h-4 text-green-500"});case"treatment":return e.jsx(Va,{className:"w-4 h-4 text-red-500"});case"prescription":return e.jsx(bs,{className:"w-4 h-4 text-orange-500"});default:return e.jsx(tr,{className:"w-4 h-4 text-gray-500"})}},N=e=>{switch(e){case"patient":return"مريض";case"appointment":return"موعد";case"payment":return"دفعة";case"treatment":return"علاج";case"prescription":return"وصفة";default:return e}},_=(t,n,a)=>0===n.length?null:e.jsxs("div",{children:[e.jsx("div",{className:"px-3 py-2 bg-muted/50",children:e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground",children:[t," (",n.length,")"]})}),n.map((t,n)=>((t,n)=>e.jsx("div",{className:"p-3 cursor-pointer border-r-2 transition-colors "+(x===n?"bg-accent border-r-primary":"hover:bg-muted border-r-transparent"),onClick:()=>b(t),children:e.jsxs("div",{className:"flex items-start gap-3",dir:"rtl",children:[w(t.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:t.title}),e.jsx(oc,{variant:"outline",className:"text-xs",children:N(t.type)})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:t.subtitle}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description})]}),e.jsx(Ha,{className:"w-4 h-4 text-muted-foreground"})]})},t.id))(t,a+n))]});return e.jsxs("div",{ref:y,className:"relative w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx(tr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{ref:f,value:r,onChange:e=>c(e.target.value),onKeyDown:e=>{if(!i||!p)return;const t=[...i.patients,...i.appointments,...i.payments,...i.treatments,...i.prescriptions];switch(e.key){case"ArrowDown":e.preventDefault(),g(e=>e<t.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),g(e=>e>0?e-1:-1);break;case"Enter":e.preventDefault(),x>=0&&t[x]&&b(t[x]);break;case"Escape":e.preventDefault(),j()}},placeholder:s,className:"pr-10 pl-10 h-12 text-base",dir:"rtl"}),r&&e.jsx(Lr,{variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",onClick:j,children:e.jsx(_r,{className:"w-4 h-4"})}),l&&e.jsx("div",{className:"absolute left-10 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})})]}),p&&i&&e.jsx(nc,{className:"absolute top-full mt-2 w-full max-h-96 overflow-hidden shadow-lg z-50",children:e.jsx(ic,{className:"p-0",children:i.totalCount>0?e.jsxs("div",{ref:v,className:"max-h-96 overflow-y-auto",children:[e.jsx("div",{className:"px-3 py-2 bg-primary/5 border-b",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[i.totalCount," نتيجة في ",i.searchTime,"ms"]}),e.jsxs("span",{className:"text-muted-foreground",children:['"',i.query,'"']})]})}),_("المرضى",i.patients,0),i.patients.length>0&&i.appointments.length>0&&e.jsx(Wh,{}),_("المواعيد",i.appointments,i.patients.length),(i.patients.length>0||i.appointments.length>0)&&i.payments.length>0&&e.jsx(Wh,{}),_("الدفعات",i.payments,i.patients.length+i.appointments.length),(i.patients.length>0||i.appointments.length>0||i.payments.length>0)&&i.treatments.length>0&&e.jsx(Wh,{}),_("العلاجات",i.treatments,i.patients.length+i.appointments.length+i.payments.length),(i.patients.length>0||i.appointments.length>0||i.payments.length>0||i.treatments.length>0)&&i.prescriptions.length>0&&e.jsx(Wh,{}),_("الوصفات",i.prescriptions,i.patients.length+i.appointments.length+i.payments.length+i.treatments.length)]}):e.jsxs("div",{className:"p-6 text-center text-muted-foreground",children:[e.jsx(tr,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsxs("p",{children:['لا توجد نتائج للبحث "',r,'"']}),o.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs mb-2",children:"عمليات البحث الأخيرة:"}),e.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:o.slice(0,5).map((t,n)=>e.jsx(oc,{variant:"outline",className:"cursor-pointer text-xs",onClick:()=>c(t),children:t},n))})]})]})})})]})}function nx(e){try{if(!e)return"غير محدد";const t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"تاريخ غير صحيح";const n=new Date,a=Math.floor((n.getTime()-t.getTime())/1e3);if(a<60)return"منذ لحظات";if(a<3600){return`منذ ${Math.floor(a/60)} دقيقة`}if(a<86400){return`منذ ${Math.floor(a/3600)} ساعة`}if(a<2592e3){return`منذ ${Math.floor(a/86400)} يوم`}return`منذ ${Math.floor(a/2592e3)} شهر`}catch(t){return console.error("Error formatting time distance:",t),"خطأ في التاريخ"}}function ax(e){try{if(!e)return"--";const t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"--";const n=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0");return`${n}/${a}/${t.getFullYear()}`}catch(t){return console.error("Error formatting date:",t),"--"}}function sx({maxVisible:t=5,showHeader:n=!0,compact:a=!1,onAlertClick:s,showReadAlerts:r=!1}){const{alerts:i,unreadAlertsCount:l,isLoadingAlerts:o,loadAlerts:c,markAlertAsRead:d}=ex();!function(){const{loadAlerts:e}=ex(),t=re.useRef(new Map),n=re.useRef(null),a=re.useCallback(()=>{console.log("🔄 useRealTimeAlerts: refreshAlerts triggered"),n.current&&(console.log("🔄 useRealTimeAlerts: Clearing previous timeout"),clearTimeout(n.current)),n.current=setTimeout(()=>{console.log("🔄 useRealTimeAlerts: Executing loadAlerts..."),e(),n.current=null},300)},[e]);re.useEffect(()=>{console.log("🔔 Setting up real-time alerts listeners...");const e=async e=>{const t=e?.type||e?.detail?.event||"unknown";console.log("📡 Data changed, refreshing alerts...",t),a()},s=e=>{console.log("🔔 Alerts changed event received:",e?.detail||"no details"),a()},r=e=>{const t=e?.detail||e;console.log("🔔 useRealTimeAlerts: Alert updated event received:",t),console.log("🔄 useRealTimeAlerts: Triggering refreshAlerts..."),a()},i=e=>{const t=e?.detail||e;console.log("🔔 Alert created event received:",t),a()},l=e=>{const t=e?.detail||e;console.log("🔔 Alert deleted event received:",t),a()};t.current.set("handleDataChanged",e),t.current.set("handleAlertsChanged",s),t.current.set("handleAlertUpdated",r),t.current.set("handleAlertCreated",i),t.current.set("handleAlertDeleted",l),Xn.addEventListener("alerts:changed",s),Xn.addEventListener("alert:updated",r),Xn.addEventListener("alert:created",i),Xn.addEventListener("alert:deleted",l),window.addEventListener("alerts:alerts:changed",s),window.addEventListener("alerts:alert:updated",e=>r(e.detail)),window.addEventListener("alerts:alert:created",e=>i(e.detail)),window.addEventListener("alerts:alert:deleted",e=>l(e.detail));const o=["patient-added","patient-updated","patient-deleted","patient-changed","appointment-added","appointment-updated","appointment-deleted","appointment-changed","payment-added","payment-updated","payment-deleted","payment-changed","treatment-added","treatment-updated","treatment-deleted","treatment-changed","prescription-added","prescription-updated","prescription-deleted","prescription-changed","inventory-added","inventory-updated","inventory-deleted","inventory-changed"];return o.forEach(t=>{window.addEventListener(t,e)}),()=>{console.log("🔔 Cleaning up real-time alerts listeners..."),n.current&&(clearTimeout(n.current),n.current=null);const e=t.current;if(e.has("handleAlertsChanged")&&Xn.removeEventListener("alerts:changed",e.get("handleAlertsChanged")),e.has("handleAlertUpdated")&&Xn.removeEventListener("alert:updated",e.get("handleAlertUpdated")),e.has("handleAlertCreated")&&Xn.removeEventListener("alert:created",e.get("handleAlertCreated")),e.has("handleAlertDeleted")&&Xn.removeEventListener("alert:deleted",e.get("handleAlertDeleted")),e.has("handleAlertsChanged")&&window.removeEventListener("alerts:alerts:changed",e.get("handleAlertsChanged")),e.has("handleAlertUpdated")){const t=e.get("handleAlertUpdated");window.removeEventListener("alerts:alert:updated",e=>t(e.detail))}if(e.has("handleAlertCreated")){const t=e.get("handleAlertCreated");window.removeEventListener("alerts:alert:created",e=>t(e.detail))}if(e.has("handleAlertDeleted")){const t=e.get("handleAlertDeleted");window.removeEventListener("alerts:alert:deleted",e=>t(e.detail))}if(e.has("handleDataChanged")){const t=e.get("handleDataChanged");o.forEach(e=>{window.removeEventListener(e,t)})}t.current.clear()}},[a])}();const{isDarkMode:m}=sa(),{toast:u}=Bl(),[p,h]=re.useState(r);re.useEffect(()=>{console.log("🔔 SmartAlerts: Initial load"),c();const e=setInterval(()=>{console.log("🔄 SmartAlerts: Periodic refresh (every minute)"),c()},6e4);return()=>{clearInterval(e)}},[c]),re.useEffect(()=>{h(r)},[r]);const x=i.filter(e=>!e.isDismissed).filter(e=>{if(e.snoozeUntil){return new Date(e.snoozeUntil)<=new Date}return!0}).filter(e=>!!p||!e.isRead).slice(0,t),g=i.filter(e=>e.isRead&&!e.isDismissed).length,f=i.filter(e=>!e.isDismissed).length,v=t=>{switch(t.type){case"appointment":return e.jsx(es,{className:"w-4 h-4"});case"payment":return e.jsx(gs,{className:"w-4 h-4"});case"treatment":return e.jsx(Va,{className:"w-4 h-4"});case"prescription":return e.jsx(Ws,{className:"w-4 h-4"});case"follow_up":return e.jsx(xr,{className:"w-4 h-4"});case"lab_order":return e.jsx(bs,{className:"w-4 h-4"});case"inventory":return e.jsx(Bs,{className:"w-4 h-4"});default:return e.jsx(Za,{className:"w-4 h-4"})}},y=e=>{switch(e){case"high":return m?"text-red-400 bg-red-900/20 border-red-800/50":"text-red-500 bg-red-50 border-red-200";case"medium":return m?"text-yellow-400 bg-yellow-900/20 border-yellow-800/50":"text-yellow-500 bg-yellow-50 border-yellow-200";case"low":return m?"text-blue-400 bg-blue-900/20 border-blue-800/50":"text-blue-500 bg-blue-50 border-blue-200";default:return m?"text-gray-400 bg-gray-900/20 border-gray-800/50":"text-gray-500 bg-gray-50 border-gray-200"}},b=e=>{switch(e){case"high":return"عاجل";case"medium":return"متوسط";case"low":return"منخفض";default:return e}};return o?e.jsxs(nc,{className:a?"shadow-sm":"",children:[n&&e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"text-lg flex items-center gap-2",children:[e.jsx(Za,{className:"w-5 h-5"}),"التنبيهات الذكية"]})}),e.jsx(ic,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})})]}):e.jsxs(nc,{className:a?"shadow-sm":"",children:[n&&e.jsxs(ac,{className:"pb-3",children:[e.jsxs(sc,{className:"text-lg flex items-center gap-2",children:[e.jsx(Za,{className:"w-5 h-5"}),"التنبيهات الذكية",l>0&&e.jsx(oc,{variant:"destructive",className:"text-xs",children:l})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["المجموع: ",f," | غير مقروءة: ",l," | مقروءة: ",g]})]}),e.jsx(ic,{className:n?"":"pt-6",children:0===x.length?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ns,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:p?0===f?"لا توجد تنبيهات":"لا توجد تنبيهات في هذا العرض":"لا توجد تنبيهات غير مقروءة"}),!p&&g>0&&e.jsxs("p",{className:"text-xs mt-1",children:["يوجد ",g,' تنبيه مقروء - اضغط "عرض المقروءة" لرؤيتها']})]}):e.jsx("div",{className:"space-y-3",children:x.map((t,n)=>e.jsxs("div",{children:[e.jsx("div",{className:"p-3 rounded-lg border cursor-pointer transition-all duration-200 "+(t.isRead?m?"bg-muted/10 border-muted/30 hover:bg-muted/20 hover:border-muted/50":"bg-muted/20 border-muted/40 hover:bg-muted/30 hover:border-muted/60":m?`${y(t.priority)} hover:opacity-90 hover:shadow-md`:`${y(t.priority)} hover:opacity-85 hover:shadow-lg`),onClick:()=>(async e=>{e.isRead||await d(e.id),console.log("🔔 Alert clicked:",{title:e.title,description:e.description,type:e.type,priority:e.priority,patientName:e.patientName,relatedData:e.relatedData}),s?.(e)})(t),children:e.jsxs("div",{className:"flex items-start gap-3",dir:"rtl",children:[e.jsx("div",{className:"p-2 rounded-full "+(m?`${y(t.priority)} bg-opacity-20 border border-current border-opacity-30`:`${y(t.priority)} bg-opacity-10 border border-current border-opacity-20`),children:v(t)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:t.title}),e.jsx(oc,{variant:"outline",className:"text-xs",children:b(t.priority)}),!t.isRead&&e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2 line-clamp-2",children:t.description}),t.patientName&&e.jsxs("p",{className:"text-xs font-medium text-primary mb-2",children:["👤 ",t.patientName]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:nx(t.createdAt)}),t.dueDate&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["📅 ",ax(t.dueDate)]})]}),!t.isRead&&e.jsx("div",{className:"mt-2",children:e.jsxs(Lr,{size:"sm",variant:"outline",className:"h-6 text-xs",onClick:e=>(async(e,t)=>{t.stopPropagation(),console.log("🔔 Mark as read button clicked for alert:",e);try{console.log("🔄 Calling markAlertAsRead..."),await d(e),console.log("✅ markAlertAsRead completed successfully"),console.log("📡 Real-time system will handle the update automatically"),u({title:"✅ تم التحديث",description:"تم تحديد الإشعار كمقروء",duration:2e3})}catch(n){console.error("❌ Error marking alert as read:",n),u({title:"❌ خطأ",description:"فشل في تحديث الإشعار",variant:"destructive"})}})(t.id,e),children:[e.jsx(ns,{className:"w-3 h-3 mr-1"}),"تحديد كمقروء"]})})]})]})}),n<x.length-1&&e.jsx(Wh,{className:"my-2 "+(m?"bg-muted/30":"")})]},t.id))})})]})}function rx({shortcut:e,className:t,size:n="sm",showArabic:a=!0,arabicKey:s}){return null}function ix({children:t,shortcut:n,description:a}){return e.jsx(e.Fragment,{children:t})}function lx({onNavigateToPatients:t,onNavigateToAppointments:n,onNavigateToPayments:a,onNavigateToTreatments:s,onAddPatient:r,onAddAppointment:i,onAddPayment:l}){const{quickAccessData:o,isLoadingQuickAccess:c,loadQuickAccessData:d,refreshQuickAccessData:m}=ex();re.useEffect(()=>{d()},[d]);const u=async()=>{await m()},{formatAmount:p}=oa();return c?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((t,n)=>e.jsx(nc,{className:"animate-pulse",children:e.jsx(ic,{className:"pt-6",children:e.jsx("div",{className:"h-20 bg-muted rounded"})})},n))}):o?e.jsxs("div",{className:"space-y-6 rtl-layout",children:[e.jsxs("div",{className:"dashboard-grid-rtl",children:[e.jsx(nc,{className:"hover:shadow-md transition-shadow cursor-pointer stats-card-rtl",onClick:t,children:e.jsx(ic,{className:"pt-6 stats-content",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"إجمالي المرضى"}),e.jsx("p",{className:"text-2xl font-bold",children:o.quickStats.totalPatients})]}),e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg stats-icon",children:e.jsx(br,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(nc,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:n,children:e.jsx(ic,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"مواعيد اليوم"}),e.jsx("p",{className:"text-2xl font-bold",children:o.quickStats.todayAppointments})]}),e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(es,{className:"w-6 h-6 text-purple-600"})})]})})}),e.jsx(nc,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:a,children:e.jsx(ic,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"دفعات معلقة"}),e.jsx("p",{className:"text-2xl font-bold",children:o.quickStats.pendingPayments})]}),e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(gs,{className:"w-6 h-6 text-yellow-600"})})]})})}),e.jsx(nc,{className:"hover:shadow-md transition-shadow",children:e.jsx(ic,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"تنبيهات عاجلة"}),e.jsx("p",{className:"text-2xl font-bold",children:o.quickStats.urgentAlerts})]}),e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(qa,{className:"w-6 h-6 text-red-600"})})]})})})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"w-5 h-5"}),"إجراءات سريعة"]})}),e.jsx(ic,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ix,{shortcut:"A",description:"إضافة مريض جديد",children:e.jsxs(Lr,{onClick:()=>{console.log("🏥 Add Patient button clicked!"),r?.()},className:"h-12 justify-between hover:shadow-lg transition-all duration-200 active:scale-95",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(br,{className:"w-4 h-4 mr-2"}),"إضافة مريض جديد"]}),e.jsx(rx,{shortcut:"A",size:"sm"})]})}),e.jsx(ix,{shortcut:"S",description:"حجز موعد جديد",children:e.jsxs(Lr,{onClick:()=>{console.log("📅 Add Appointment button clicked!"),i?.()},variant:"outline",className:"h-12 justify-between hover:shadow-lg transition-all duration-200 active:scale-95",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),"حجز موعد جديد"]}),e.jsx(rx,{shortcut:"S",size:"sm"})]})}),e.jsx(ix,{shortcut:"D",description:"تسجيل دفعة جديدة",children:e.jsxs(Lr,{onClick:()=>{console.log("💰 Add Payment button clicked!"),l?.()},variant:"outline",className:"h-12 justify-between hover:shadow-lg transition-all duration-200 active:scale-95",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(gs,{className:"w-4 h-4 mr-2"}),"تسجيل دفعة جديدة"]}),e.jsx(rx,{shortcut:"D",size:"sm"})]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(br,{className:"w-5 h-5"}),"المرضى الأخيرون"]}),e.jsxs(Lr,{variant:"ghost",size:"sm",onClick:()=>{console.log("👥 Navigate to Patients clicked!"),t?.()},className:"hover:bg-blue-50 hover:text-blue-600 transition-colors",children:[e.jsx(ys,{className:"w-4 h-4 mr-1"}),"عرض الكل"]})]})}),e.jsx(ic,{children:0===o.recentPatients.length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(br,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"لا توجد مرضى حديثون"})]}):e.jsx("div",{className:"space-y-3",children:o.recentPatients.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(br,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:t.full_name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",t.serial_number," | ",t.age," سنة"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oc,{variant:"outline",className:"text-xs",children:"male"===t.gender?"ذكر":"أنثى"}),e.jsx(Lr,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(ys,{className:"w-3 h-3"})})]})]},t.id))})})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-5 h-5"}),"مواعيد اليوم"]}),e.jsxs(Lr,{variant:"ghost",size:"sm",onClick:()=>{console.log("📅 Navigate to Appointments clicked!"),n?.()},className:"hover:bg-blue-50 hover:text-blue-600 transition-colors",children:[e.jsx(ys,{className:"w-4 h-4 mr-1"}),"عرض الكل"]})]})}),e.jsx(ic,{children:0===o.todayAppointments.length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(es,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"لا توجد مواعيد اليوم"})]}):e.jsx("div",{className:"space-y-3",children:o.todayAppointments.slice(0,5).map(t=>{return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(es,{className:"w-4 h-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:t.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.patient?.full_name||"مريض غير محدد"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oc,{variant:"outline",className:"text-xs",children:(n=t.start_time,new Date(n).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"}))}),e.jsx(Lr,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(ys,{className:"w-3 h-3"})})]})]},t.id);var n})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"w-5 h-5"}),"الدفعات المعلقة"]}),e.jsxs(Lr,{variant:"ghost",size:"sm",onClick:()=>{console.log("💰 Navigate to Payments clicked!"),a?.()},className:"hover:bg-blue-50 hover:text-blue-600 transition-colors",children:[e.jsx(ys,{className:"w-4 h-4 mr-1"}),"عرض الكل"]})]})}),e.jsx(ic,{children:0===o.pendingPayments.length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(gs,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"لا توجد دفعات معلقة"})]}):e.jsx("div",{className:"space-y-3",children:o.pendingPayments.slice(0,5).map(t=>{return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx(gs,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:t.patient?.full_name||"مريض غير محدد"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(n=t.payment_date,new Date(n).toLocaleDateString("ar-EG"))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oc,{variant:"destructive",className:"text-xs",children:p(t.total_amount_due||t.remaining_balance||t.amount||0)}),e.jsx(Lr,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(ys,{className:"w-3 h-3"})})]})]},t.id);var n})})})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"w-5 h-5"}),"العلاجات العاجلة"]}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:s,children:"عرض الكل"})]})}),e.jsx(ic,{children:0===o.urgentTreatments.length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(Va,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"لا توجد علاجات عاجلة"})]}):e.jsx("div",{className:"space-y-3",children:o.urgentTreatments.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Va,{className:"w-4 h-4 text-red-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sm",children:[t.treatment_type," - السن ",t.tooth_number]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.patient?.full_name||"مريض غير محدد"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oc,{variant:"outline",className:"text-xs",children:"planned"===t.treatment_status?"مخطط":"قيد التنفيذ"}),e.jsx(Lr,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(ys,{className:"w-3 h-3"})})]})]},t.id))})})]})]})]}):e.jsx(nc,{children:e.jsx(ic,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(qa,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"فشل في تحميل بيانات الوصول السريع"}),e.jsxs(Lr,{variant:"outline",size:"sm",className:"mt-2",onClick:u,children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),"إعادة المحاولة"]})]})})})}function ox({onNavigateToPatients:t,onNavigateToAppointments:n,onNavigateToPayments:a,onNavigateToTreatments:s,onAddPatient:r,onAddAppointment:i,onAddPayment:l}){const[o,c]=re.useState("overview"),[d,m]=re.useState(!1),{syncAllData:u,isGlobalLoading:p,lastSyncTime:h,unreadAlertsCount:x}=ex();ta();const g=Rc();re.useEffect(()=>{u()},[u]),re.useEffect(()=>{const e=e=>{if(e.ctrlKey)return;const t=e.target;if("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||"number"===t.getAttribute("type")||t.closest('[data-prevent-shortcuts="true"]'))return;if("Escape"===e.key&&m(!1),["1","2","3","4"].includes(e.key)){e.preventDefault();const t=["overview","quick-access","alerts","analytics"],n=parseInt(e.key)-1;t[n]&&c(t[n])}const n=Ia(e);"a"===n.mappedKey.toLowerCase()?(n.preventDefault(),r?.()):"s"===n.mappedKey.toLowerCase()?(n.preventDefault(),i?.()):"d"===n.mappedKey.toLowerCase()&&(n.preventDefault(),l?.()),"r"===n.mappedKey.toLowerCase()&&(n.preventDefault(),u()),"f"===n.mappedKey.toLowerCase()&&(n.preventDefault(),m(!0)),"r"===n.mappedKey.toLowerCase()&&(n.preventDefault(),u())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[u,r,i,l]);const f=e=>{console.log("Alert clicked:",e),"appointment"===e.type?(e.context?.includes("upcoming")||e.context?.includes("today"))&&n?.():"payment"===e.type?(e.context?.includes("overdue")||e.context?.includes("pending"))&&a?.():"patient"===e.type?t?.():"inventory"===e.type&&console.log("Navigate to inventory for:",e.title),c("alerts")};re.useEffect(()=>{const e=e=>{"f"!==e.key&&"F"!==e.key&&"ب"!==e.key||e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),m(!0)),"Escape"===e.key&&d&&m(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d]);return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsxs("h1",{className:"text-3xl font-bold text-foreground",children:["مرحباً بك في ",g]})}),e.jsx("p",{className:"text-muted-foreground",children:"نظام إدارة سريع ومتكامل - تحديث تلقائي في الوقت الفعلي"}),h&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["آخر تحديث: ",new Date(h).toLocaleString("ar-EG")]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Lr,{variant:"outline",onClick:()=>m(!d),className:"relative",children:[e.jsx(tr,{className:"w-4 h-4 mr-2"}),"بحث شامل",e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(F)"})]}),e.jsxs(Lr,{variant:"outline",onClick:()=>c("alerts"),className:"relative",children:[e.jsx(Za,{className:"w-4 h-4 mr-2"}),"التنبيهات",x>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:x})]}),e.jsxs(Lr,{variant:"outline",onClick:async()=>{await u()},disabled:p,children:[e.jsx(Js,{className:"w-4 h-4 mr-2 "+(p?"animate-spin":"")}),"تحديث"]})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-20",onClick:e=>{e.target===e.currentTarget&&m(!1)},children:e.jsx("div",{className:"w-full max-w-2xl mx-4",children:e.jsx(tx,{onResultSelect:e=>{switch(console.log("Selected search result:",e),e.type){case"patient":localStorage.setItem("selectedPatientForDetails",JSON.stringify({patient:e.data,openDetailsModal:!0})),t?.();break;case"appointment":localStorage.setItem("selectedAppointmentForDetails",JSON.stringify({appointment:e.data,openDetailsModal:!0})),n?.();break;case"payment":localStorage.setItem("selectedPaymentForDetails",JSON.stringify({payment:e.data,openDetailsModal:!0})),a?.();break;case"treatment":localStorage.setItem("selectedTreatmentForDetails",JSON.stringify({treatment:e.data,patientId:e.relatedData?.patientId,openDetailsModal:!0})),s?.();break;case"prescription":localStorage.setItem("selectedPrescriptionForDetails",JSON.stringify({prescription:e.data,openDetailsModal:!0})),s?.()}m(!1)},onClose:()=>m(!1),autoFocus:!0})})}),e.jsxs(Ud,{value:o,onValueChange:c,className:"space-y-4",children:[e.jsxs(Hd,{className:"grid w-full grid-cols-3",children:[e.jsxs(Gd,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"w-4 h-4"}),"نظرة عامة"]}),e.jsxs(Gd,{value:"quick-access",className:"flex items-center gap-2",children:[e.jsx(kr,{className:"w-4 h-4"}),"الوصول السريع"]}),e.jsxs(Gd,{value:"alerts",className:"flex items-center gap-2 relative",children:[e.jsx(Za,{className:"w-4 h-4"}),"التنبيهات",x>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:x})]})]}),e.jsx(Wd,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(lx,{onNavigateToPatients:t,onNavigateToAppointments:n,onNavigateToPayments:a,onNavigateToTreatments:s,onAddPatient:r,onAddAppointment:i,onAddPayment:l})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(sx,{maxVisible:8,showHeader:!0,compact:!1,onAlertClick:e=>{f(e)}})})]})}),e.jsx(Wd,{value:"quick-access",className:"space-y-6",children:e.jsx(lx,{onNavigateToPatients:t,onNavigateToAppointments:n,onNavigateToPayments:a,onNavigateToTreatments:s,onAddPatient:r,onAddAppointment:i,onAddPayment:l})}),e.jsx(Wd,{value:"alerts",className:"space-y-6",children:e.jsx(sx,{maxVisible:20,showHeader:!0,compact:!1,showReadAlerts:!0,onAlertClick:e=>{f(e)}})})]}),e.jsx(id,{compact:!0})]})}var cx=["Enter"," "],dx=["ArrowUp","PageDown","End"],mx=["ArrowDown","PageUp","Home",...dx],ux={ltr:[...cx,"ArrowRight"],rtl:[...cx,"ArrowLeft"]},px={ltr:["ArrowLeft"],rtl:["ArrowRight"]},hx="Menu",[xx,gx,fx]=M(hx),[vx,yx]=k(hx,[fx,z,gd]),bx=z(),jx=gd(),[wx,Nx]=vx(hx),[_x,kx]=vx(hx),Sx=t=>{const{__scopeMenu:n,open:a=!1,children:s,dir:r,onOpenChange:i,modal:l=!0}=t,o=bx(n),[c,d]=re.useState(null),m=re.useRef(!1),u=A(i),p=L(r);return re.useEffect(()=>{const e=()=>{m.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>m.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),e.jsx(J,{...o,children:e.jsx(wx,{scope:n,open:a,onOpenChange:u,content:c,onContentChange:d,children:e.jsx(_x,{scope:n,onClose:re.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:m,dir:p,modal:l,children:s})})})};Sx.displayName=hx;var Cx=re.forwardRef((t,n)=>{const{__scopeMenu:a,...s}=t,r=bx(a);return e.jsx(B,{...r,...s,ref:n})});Cx.displayName="MenuAnchor";var $x="MenuPortal",[Dx,Ex]=vx($x,{forceMount:void 0}),Tx=t=>{const{__scopeMenu:n,forceMount:a,children:s,container:r}=t,i=Nx($x,n);return e.jsx(Dx,{scope:n,forceMount:a,children:e.jsx(O,{present:a||i.open,children:e.jsx(Q,{asChild:!0,container:r,children:s})})})};Tx.displayName=$x;var Ax="MenuContent",[Fx,Px]=vx(Ax),Rx=re.forwardRef((t,n)=>{const a=Ex(Ax,t.__scopeMenu),{forceMount:s=a.forceMount,...r}=t,i=Nx(Ax,t.__scopeMenu),l=kx(Ax,t.__scopeMenu);return e.jsx(xx.Provider,{scope:t.__scopeMenu,children:e.jsx(O,{present:s||i.open,children:e.jsx(xx.Slot,{scope:t.__scopeMenu,children:l.modal?e.jsx(Ox,{...r,ref:n}):e.jsx(Mx,{...r,ref:n})})})})}),Ox=re.forwardRef((t,n)=>{const a=Nx(Ax,t.__scopeMenu),s=re.useRef(null),r=$(n,s);return re.useEffect(()=>{const e=s.current;if(e)return V(e)},[]),e.jsx(Ix,{...t,ref:r,trapFocus:a.open,disableOutsidePointerEvents:a.open,disableOutsideScroll:!0,onFocusOutside:E(t.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>a.onOpenChange(!1)})}),Mx=re.forwardRef((t,n)=>{const a=Nx(Ax,t.__scopeMenu);return e.jsx(Ix,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>a.onOpenChange(!1)})}),Lx=X("MenuContent.ScrollLock"),Ix=re.forwardRef((t,n)=>{const{__scopeMenu:a,loop:s=!1,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:l,disableOutsidePointerEvents:o,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:m,onFocusOutside:u,onInteractOutside:p,onDismiss:h,disableOutsideScroll:x,...g}=t,f=Nx(Ax,a),v=kx(Ax,a),y=bx(a),b=jx(a),j=gx(a),[w,N]=re.useState(null),_=re.useRef(null),k=$(n,_,f.onContentChange),S=re.useRef(0),C=re.useRef(""),D=re.useRef(0),T=re.useRef(null),A=re.useRef("right"),F=re.useRef(0),P=x?K:re.Fragment,R=x?{as:Lx,allowPinchZoom:!0}:void 0,O=e=>{const t=C.current+e,n=j().filter(e=>!e.disabled),a=document.activeElement,s=n.find(e=>e.ref.current===a)?.textValue,r=function(e,t,n){const a=t.length>1&&Array.from(t).every(e=>e===t[0]),s=a?t[0]:t,r=n?e.indexOf(n):-1;let i=(l=e,o=Math.max(r,0),l.map((e,t)=>l[(o+t)%l.length]));var l,o;1===s.length&&(i=i.filter(e=>e!==n));const c=i.find(e=>e.toLowerCase().startsWith(s.toLowerCase()));return c!==n?c:void 0}(n.map(e=>e.textValue),t,s),i=n.find(e=>e.textValue===r)?.ref.current;!function e(t){C.current=t,window.clearTimeout(S.current),""!==t&&(S.current=window.setTimeout(()=>e(""),1e3))}(t),i&&setTimeout(()=>i.focus())};re.useEffect(()=>()=>window.clearTimeout(S.current),[]),Y();const M=re.useCallback(e=>A.current===T.current?.side&&function(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return function(e,t){const{x:n,y:a}=e;let s=!1;for(let r=0,i=t.length-1;r<t.length;i=r++){const e=t[r],l=t[i],o=e.x,c=e.y,d=l.x,m=l.y;c>a!=m>a&&n<(d-o)*(a-c)/(m-c)+o&&(s=!s)}return s}(n,t)}(e,T.current?.area),[]);return e.jsx(Fx,{scope:a,searchRef:C,onItemEnter:re.useCallback(e=>{M(e)&&e.preventDefault()},[M]),onItemLeave:re.useCallback(e=>{M(e)||(_.current?.focus(),N(null))},[M]),onTriggerLeave:re.useCallback(e=>{M(e)&&e.preventDefault()},[M]),pointerGraceTimerRef:D,onPointerGraceIntentChange:re.useCallback(e=>{T.current=e},[]),children:e.jsx(P,{...R,children:e.jsx(q,{asChild:!0,trapped:r,onMountAutoFocus:E(i,e=>{e.preventDefault(),_.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:l,children:e.jsx(U,{asChild:!0,disableOutsidePointerEvents:o,onEscapeKeyDown:d,onPointerDownOutside:m,onFocusOutside:u,onInteractOutside:p,onDismiss:h,children:e.jsx(kd,{asChild:!0,...b,dir:v.dir,orientation:"vertical",loop:s,currentTabStopId:w,onCurrentTabStopIdChange:N,onEntryFocus:E(c,e=>{v.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(H,{role:"menu","aria-orientation":"vertical","data-state":mg(f.open),"data-radix-menu-content":"",dir:v.dir,...y,...g,ref:k,style:{outline:"none",...g.style},onKeyDown:E(g.onKeyDown,e=>{const t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,a=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&a&&O(e.key));const s=_.current;if(e.target!==s)return;if(!mx.includes(e.key))return;e.preventDefault();const r=j().filter(e=>!e.disabled).map(e=>e.ref.current);dx.includes(e.key)&&r.reverse(),function(e){const t=document.activeElement;for(const n of e){if(n===t)return;if(n.focus(),document.activeElement!==t)return}}(r)}),onBlur:E(t.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(S.current),C.current="")}),onPointerMove:E(t.onPointerMove,hg(e=>{const t=e.target,n=F.current!==e.clientX;if(e.currentTarget.contains(t)&&n){const t=e.clientX>F.current?"right":"left";A.current=t,F.current=e.clientX}}))})})})})})})});Rx.displayName=Ax;var zx=re.forwardRef((t,n)=>{const{__scopeMenu:a,...s}=t;return e.jsx(c.div,{role:"group",...s,ref:n})});zx.displayName="MenuGroup";var Bx=re.forwardRef((t,n)=>{const{__scopeMenu:a,...s}=t;return e.jsx(c.div,{...s,ref:n})});Bx.displayName="MenuLabel";var Vx="MenuItem",Yx="menu.itemSelect",qx=re.forwardRef((t,n)=>{const{disabled:a=!1,onSelect:s,...r}=t,i=re.useRef(null),l=kx(Vx,t.__scopeMenu),o=Px(Vx,t.__scopeMenu),c=$(n,i),d=re.useRef(!1);return e.jsx(Ux,{...r,ref:c,disabled:a,onClick:E(t.onClick,()=>{const e=i.current;if(!a&&e){const t=new CustomEvent(Yx,{bubbles:!0,cancelable:!0});e.addEventListener(Yx,e=>s?.(e),{once:!0}),Z(e,t),t.defaultPrevented?d.current=!1:l.onClose()}}),onPointerDown:e=>{t.onPointerDown?.(e),d.current=!0},onPointerUp:E(t.onPointerUp,e=>{d.current||e.currentTarget?.click()}),onKeyDown:E(t.onKeyDown,e=>{const t=""!==o.searchRef.current;a||t&&" "===e.key||cx.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});qx.displayName=Vx;var Ux=re.forwardRef((t,n)=>{const{__scopeMenu:a,disabled:s=!1,textValue:r,...i}=t,l=Px(Vx,a),o=jx(a),d=re.useRef(null),m=$(n,d),[u,p]=re.useState(!1),[h,x]=re.useState("");return re.useEffect(()=>{const e=d.current;e&&x((e.textContent??"").trim())},[i.children]),e.jsx(xx.ItemSlot,{scope:a,disabled:s,textValue:r??h,children:e.jsx(Sd,{asChild:!0,...o,focusable:!s,children:e.jsx(c.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...i,ref:m,onPointerMove:E(t.onPointerMove,hg(e=>{if(s)l.onItemLeave(e);else if(l.onItemEnter(e),!e.defaultPrevented){e.currentTarget.focus({preventScroll:!0})}})),onPointerLeave:E(t.onPointerLeave,hg(e=>l.onItemLeave(e))),onFocus:E(t.onFocus,()=>p(!0)),onBlur:E(t.onBlur,()=>p(!1))})})})}),Hx=re.forwardRef((t,n)=>{const{checked:a=!1,onCheckedChange:s,...r}=t;return e.jsx(eg,{scope:t.__scopeMenu,checked:a,children:e.jsx(qx,{role:"menuitemcheckbox","aria-checked":ug(a)?"mixed":a,...r,ref:n,"data-state":pg(a),onSelect:E(r.onSelect,()=>s?.(!!ug(a)||!a),{checkForDefaultPrevented:!1})})})});Hx.displayName="MenuCheckboxItem";var Gx="MenuRadioGroup",[Wx,Kx]=vx(Gx,{value:void 0,onValueChange:()=>{}}),Zx=re.forwardRef((t,n)=>{const{value:a,onValueChange:s,...r}=t,i=A(s);return e.jsx(Wx,{scope:t.__scopeMenu,value:a,onValueChange:i,children:e.jsx(zx,{...r,ref:n})})});Zx.displayName=Gx;var Qx="MenuRadioItem",Xx=re.forwardRef((t,n)=>{const{value:a,...s}=t,r=Kx(Qx,t.__scopeMenu),i=a===r.value;return e.jsx(eg,{scope:t.__scopeMenu,checked:i,children:e.jsx(qx,{role:"menuitemradio","aria-checked":i,...s,ref:n,"data-state":pg(i),onSelect:E(s.onSelect,()=>r.onValueChange?.(a),{checkForDefaultPrevented:!1})})})});Xx.displayName=Qx;var Jx="MenuItemIndicator",[eg,tg]=vx(Jx,{checked:!1}),ng=re.forwardRef((t,n)=>{const{__scopeMenu:a,forceMount:s,...r}=t,i=tg(Jx,a);return e.jsx(O,{present:s||ug(i.checked)||!0===i.checked,children:e.jsx(c.span,{...r,ref:n,"data-state":pg(i.checked)})})});ng.displayName=Jx;var ag=re.forwardRef((t,n)=>{const{__scopeMenu:a,...s}=t;return e.jsx(c.div,{role:"separator","aria-orientation":"horizontal",...s,ref:n})});ag.displayName="MenuSeparator";var sg=re.forwardRef((t,n)=>{const{__scopeMenu:a,...s}=t,r=bx(a);return e.jsx(G,{...r,...s,ref:n})});sg.displayName="MenuArrow";var[rg,ig]=vx("MenuSub"),lg="MenuSubTrigger",og=re.forwardRef((t,n)=>{const a=Nx(lg,t.__scopeMenu),s=kx(lg,t.__scopeMenu),r=ig(lg,t.__scopeMenu),i=Px(lg,t.__scopeMenu),l=re.useRef(null),{pointerGraceTimerRef:o,onPointerGraceIntentChange:c}=i,d={__scopeMenu:t.__scopeMenu},m=re.useCallback(()=>{l.current&&window.clearTimeout(l.current),l.current=null},[]);return re.useEffect(()=>m,[m]),re.useEffect(()=>{const e=o.current;return()=>{window.clearTimeout(e),c(null)}},[o,c]),e.jsx(Cx,{asChild:!0,...d,children:e.jsx(Ux,{id:r.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":r.contentId,"data-state":mg(a.open),...t,ref:W(n,r.onTriggerChange),onClick:e=>{t.onClick?.(e),t.disabled||e.defaultPrevented||(e.currentTarget.focus(),a.open||a.onOpenChange(!0))},onPointerMove:E(t.onPointerMove,hg(e=>{i.onItemEnter(e),e.defaultPrevented||t.disabled||a.open||l.current||(i.onPointerGraceIntentChange(null),l.current=window.setTimeout(()=>{a.onOpenChange(!0),m()},100))})),onPointerLeave:E(t.onPointerLeave,hg(e=>{m();const t=a.content?.getBoundingClientRect();if(t){const n=a.content?.dataset.side,s="right"===n,r=s?-5:5,l=t[s?"left":"right"],c=t[s?"right":"left"];i.onPointerGraceIntentChange({area:[{x:e.clientX+r,y:e.clientY},{x:l,y:t.top},{x:c,y:t.top},{x:c,y:t.bottom},{x:l,y:t.bottom}],side:n}),window.clearTimeout(o.current),o.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(e),e.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:E(t.onKeyDown,e=>{const n=""!==i.searchRef.current;t.disabled||n&&" "===e.key||ux[s.dir].includes(e.key)&&(a.onOpenChange(!0),a.content?.focus(),e.preventDefault())})})})});og.displayName=lg;var cg="MenuSubContent",dg=re.forwardRef((t,n)=>{const a=Ex(Ax,t.__scopeMenu),{forceMount:s=a.forceMount,...r}=t,i=Nx(Ax,t.__scopeMenu),l=kx(Ax,t.__scopeMenu),o=ig(cg,t.__scopeMenu),c=re.useRef(null),d=$(n,c);return e.jsx(xx.Provider,{scope:t.__scopeMenu,children:e.jsx(O,{present:s||i.open,children:e.jsx(xx.Slot,{scope:t.__scopeMenu,children:e.jsx(Ix,{id:o.contentId,"aria-labelledby":o.triggerId,...r,ref:d,align:"start",side:"rtl"===l.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{l.isUsingKeyboardRef.current&&c.current?.focus(),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:E(t.onFocusOutside,e=>{e.target!==o.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:E(t.onEscapeKeyDown,e=>{l.onClose(),e.preventDefault()}),onKeyDown:E(t.onKeyDown,e=>{const t=e.currentTarget.contains(e.target),n=px[l.dir].includes(e.key);t&&n&&(i.onOpenChange(!1),o.trigger?.focus(),e.preventDefault())})})})})})});function mg(e){return e?"open":"closed"}function ug(e){return"indeterminate"===e}function pg(e){return ug(e)?"indeterminate":e?"checked":"unchecked"}function hg(e){return t=>"mouse"===t.pointerType?e(t):void 0}dg.displayName=cg;var xg=Sx,gg=Cx,fg=Tx,vg=Rx,yg=zx,bg=Bx,jg=qx,wg=Hx,Ng=Zx,_g=Xx,kg=ng,Sg=ag,Cg=sg,$g=og,Dg=dg,Eg="DropdownMenu",[Tg,Ag]=k(Eg,[yx]),Fg=yx(),[Pg,Rg]=Tg(Eg),Og=t=>{const{__scopeDropdownMenu:n,children:a,dir:s,open:r,defaultOpen:i,onOpenChange:l,modal:o=!0}=t,c=Fg(n),d=re.useRef(null),[m,u]=P({prop:r,defaultProp:i??!1,onChange:l,caller:Eg});return e.jsx(Pg,{scope:n,triggerId:R(),triggerRef:d,contentId:R(),open:m,onOpenChange:u,onOpenToggle:re.useCallback(()=>u(e=>!e),[u]),modal:o,children:e.jsx(xg,{...c,open:m,onOpenChange:u,dir:s,modal:o,children:a})})};Og.displayName=Eg;var Mg="DropdownMenuTrigger",Lg=re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,disabled:s=!1,...r}=t,i=Rg(Mg,a),l=Fg(a);return e.jsx(gg,{asChild:!0,...l,children:e.jsx(c.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...r,ref:W(n,i.triggerRef),onPointerDown:E(t.onPointerDown,e=>{s||0!==e.button||!1!==e.ctrlKey||(i.onOpenToggle(),i.open||e.preventDefault())}),onKeyDown:E(t.onKeyDown,e=>{s||(["Enter"," "].includes(e.key)&&i.onOpenToggle(),"ArrowDown"===e.key&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});Lg.displayName=Mg;var Ig=t=>{const{__scopeDropdownMenu:n,...a}=t,s=Fg(n);return e.jsx(fg,{...s,...a})};Ig.displayName="DropdownMenuPortal";var zg="DropdownMenuContent",Bg=re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Rg(zg,a),i=Fg(a),l=re.useRef(!1);return e.jsx(vg,{id:r.contentId,"aria-labelledby":r.triggerId,...i,...s,ref:n,onCloseAutoFocus:E(t.onCloseAutoFocus,e=>{l.current||r.triggerRef.current?.focus(),l.current=!1,e.preventDefault()}),onInteractOutside:E(t.onInteractOutside,e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,a=2===t.button||n;r.modal&&!a||(l.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Bg.displayName=zg;re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Fg(a);return e.jsx(yg,{...r,...s,ref:n})}).displayName="DropdownMenuGroup";var Vg=re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Fg(a);return e.jsx(bg,{...r,...s,ref:n})});Vg.displayName="DropdownMenuLabel";var Yg=re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Fg(a);return e.jsx(jg,{...r,...s,ref:n})});Yg.displayName="DropdownMenuItem";var qg=re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Fg(a);return e.jsx(wg,{...r,...s,ref:n})});qg.displayName="DropdownMenuCheckboxItem";re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Fg(a);return e.jsx(Ng,{...r,...s,ref:n})}).displayName="DropdownMenuRadioGroup";var Ug=re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Fg(a);return e.jsx(_g,{...r,...s,ref:n})});Ug.displayName="DropdownMenuRadioItem";var Hg=re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Fg(a);return e.jsx(kg,{...r,...s,ref:n})});Hg.displayName="DropdownMenuItemIndicator";var Gg=re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Fg(a);return e.jsx(Sg,{...r,...s,ref:n})});Gg.displayName="DropdownMenuSeparator";re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Fg(a);return e.jsx(Cg,{...r,...s,ref:n})}).displayName="DropdownMenuArrow";var Wg=re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Fg(a);return e.jsx($g,{...r,...s,ref:n})});Wg.displayName="DropdownMenuSubTrigger";var Kg=re.forwardRef((t,n)=>{const{__scopeDropdownMenu:a,...s}=t,r=Fg(a);return e.jsx(Dg,{...r,...s,ref:n,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Kg.displayName="DropdownMenuSubContent";var Zg=Ig,Qg=Bg,Xg=Vg,Jg=Yg,ef=qg,tf=Ug,nf=Hg,af=Gg,sf=Wg,rf=Kg;const lf=Og,of=Lg;re.forwardRef(({className:t,inset:n,children:a,...s},r)=>e.jsxs(sf,{ref:r,className:En("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",t),...s,children:[a,e.jsx(is,{className:"ml-auto"})]})).displayName=sf.displayName;re.forwardRef(({className:t,...n},a)=>e.jsx(rf,{ref:a,className:En("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...n})).displayName=rf.displayName;const cf=re.forwardRef(({className:t,sideOffset:n=4,...a},s)=>e.jsx(Zg,{children:e.jsx(Qg,{ref:s,sideOffset:n,className:En("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md dark:bg-popover dark:border-border dark:shadow-xl dark:shadow-black/20","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...a})}));cf.displayName=Qg.displayName;const df=re.forwardRef(({className:t,inset:n,...a},s)=>e.jsx(Jg,{ref:s,className:En("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0 dark:focus:bg-accent dark:focus:text-accent-foreground hover:bg-accent/50 dark:hover:bg-accent/50",n&&"pl-8",t),...a}));df.displayName=Jg.displayName;re.forwardRef(({className:t,children:n,checked:a,...s},r)=>e.jsxs(ef,{ref:r,className:En("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:a,...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(nf,{children:e.jsx(as,{className:"h-4 w-4"})})}),n]})).displayName=ef.displayName;re.forwardRef(({className:t,children:n,...a},s)=>e.jsxs(tf,{ref:s,className:En("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(nf,{children:e.jsx(ds,{className:"h-2 w-2 fill-current"})})}),n]})).displayName=tf.displayName;re.forwardRef(({className:t,inset:n,...a},s)=>e.jsx(Xg,{ref:s,className:En("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",t),...a})).displayName=Xg.displayName;const mf=re.forwardRef(({className:t,...n},a)=>e.jsx(af,{ref:a,className:En("-mx-1 my-1 h-px bg-muted",t),...n}));mf.displayName=af.displayName;class uf{static async getPatientIntegratedData(e){try{const t=(await(window.electronAPI?.patients?.getAll?.())||[]).find(t=>t.id===e);if(!t)throw new Error("المريض غير موجود");const[n,a,s,r,i,l,o]=await Promise.all([this.getPatientAppointments(e),this.getPatientTreatments(e),this.getPatientPayments(e),this.getPatientPrescriptions(e),this.getPatientLabOrders(e),this.getPatientTimeline(e),this.getPatientTreatmentPlans(e)]);return{patient:t,appointments:n,treatments:a,payments:s,prescriptions:r,labOrders:i,timeline:l,treatmentPlans:o,stats:this.calculatePatientStats({appointments:n,treatments:a,payments:s,prescriptions:r,labOrders:i})}}catch(t){return console.error("خطأ في جلب البيانات المتكاملة للمريض:",t),null}}static async getPatientAppointments(e){try{return await(window.electronAPI?.appointments?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب مواعيد المريض:",t),[]}}static async getPatientTreatments(e){try{return await(window.electronAPI?.toothTreatments?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب علاجات المريض:",t),[]}}static async getPatientPayments(e){try{return await(window.electronAPI?.payments?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب دفعات المريض:",t),[]}}static async getPatientPrescriptions(e){try{return await(window.electronAPI?.prescriptions?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب وصفات المريض:",t),[]}}static async getPatientLabOrders(e){try{return await(window.electronAPI?.labOrders?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب طلبات المختبر للمريض:",t),[]}}static async getPatientTimeline(e){try{return await(window.electronAPI?.patientTimeline?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب الجدول الزمني للمريض:",t),[]}}static async getPatientTreatmentPlans(e){try{return await(window.electronAPI?.treatmentPlans?.getByPatient?.(e))||[]}catch(t){return console.error("خطأ في جلب خطط العلاج للمريض:",t),[]}}static calculatePatientStats(e){const{appointments:t,treatments:n,payments:a}=e,s=t.length,r=n.filter(e=>"completed"===e.treatment_status).length,i=n.filter(e=>"planned"===e.treatment_status||"in_progress"===e.treatment_status).length;let l=0,o=0;t.forEach(e=>{if(e.cost){const t=a.filter(t=>t.appointment_id===e.id).reduce((e,t)=>e+(t.amount||0),0);o+=e.cost,l+=t}});a.filter(e=>!e.appointment_id).forEach(e=>{l+=e.amount||0,e.total_amount_due&&(o+=e.total_amount_due)});const c=Math.max(0,o-l),d=t.filter(e=>"completed"===e.status).sort((e,t)=>new Date(t.start_time).getTime()-new Date(e.start_time).getTime())[0]?.start_time,m=t.filter(e=>"scheduled"===e.status&&new Date(e.start_time)>new Date).sort((e,t)=>new Date(e.start_time).getTime()-new Date(t.start_time).getTime())[0]?.start_time;return{totalAppointments:s,completedTreatments:r,pendingTreatments:i,totalPaid:l,remainingBalance:c,lastVisit:d,nextAppointment:m}}static async createTimelineEvent(e){try{return await(window.electronAPI?.patientTimeline?.create?.(e))||null}catch(t){return console.error("خطأ في إنشاء حدث الجدول الزمني:",t),null}}static async linkPrescriptionToTreatment(e,t){try{return!!(await(window.electronAPI?.prescriptions?.update?.(e,{tooth_treatment_id:t})))}catch(n){return console.error("خطأ في ربط الوصفة بالعلاج:",n),!1}}static async linkLabOrderToTreatment(e,t,n){try{const a={tooth_treatment_id:t};n&&(a.appointment_id=n);return!!(await(window.electronAPI?.labOrders?.update?.(e,a)))}catch(a){return console.error("خطأ في ربط طلب المختبر بالعلاج:",a),!1}}static async generatePatientReport(e){const t=await this.getPatientIntegratedData(e);if(!t)throw new Error("لا يمكن جلب بيانات المريض");return{patient:t.patient,summary:t.stats,treatmentHistory:t.treatments,appointmentHistory:t.appointments,financialSummary:{totalPaid:t.stats.totalPaid,remainingBalance:t.stats.remainingBalance,paymentHistory:t.payments},prescriptionHistory:t.prescriptions,labOrderHistory:t.labOrders,timeline:t.timeline,treatmentPlans:t.treatmentPlans,generatedAt:(new Date).toISOString()}}}function pf({patients:t,isLoading:n,onEdit:a,onDelete:s,onViewDetails:r,onViewPendingInvoice:i}){const[l,o]=re.useState(null),[c,d]=re.useState(null),[m,u]=re.useState(1),[p,h]=re.useState(10),{settings:x}=ta(),{toast:g}=Bl(),f=re.useMemo(()=>{let e=t;l&&c&&(e=[...t].sort((e,t)=>{let n=e[l],a=t[l];if(null==n&&null==a)return 0;if(null==n)return"asc"===c?1:-1;if(null==a)return"asc"===c?-1:1;if("patient_number"===l){const e="number"==typeof n?n:parseFloat(String(n))||0,t="number"==typeof a?a:parseFloat(String(a))||0;return e<t?"asc"===c?-1:1:e>t?"asc"===c?1:-1:0}return n=String(n).toLowerCase(),a=String(a).toLowerCase(),n<a?"asc"===c?-1:1:n>a?"asc"===c?1:-1:0}));const n=(m-1)*p,a=n+p;return{patients:e.slice(n,a),totalPages:Math.ceil(e.length/p),totalCount:e.length}},[t,l,c,m,p]),v=t=>l!==t?e.jsx(Ga,{className:"w-4 h-4 opacity-50"}):"asc"===c?e.jsx(Wa,{className:"w-4 h-4"}):"desc"===c?e.jsx(Ua,{className:"w-4 h-4"}):e.jsx(Ga,{className:"w-4 h-4 opacity-50"}),y=({field:t,children:n})=>e.jsx(Uc,{className:"cursor-pointer hover:bg-muted/50 select-none text-center",onClick:()=>(e=>{l===e?"asc"===c?d("desc"):"desc"===c?(o(null),d(null)):d("asc"):(o(e),d("asc"))})(t),children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[e.jsx("span",{children:n}),v(t)]})});if(n)return e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-center",children:"#"}),e.jsx(Uc,{className:"text-center",children:"الاسم الكامل للمريض"}),e.jsx(Uc,{className:"text-center",children:"رقم المريض"}),e.jsx(Uc,{className:"text-center",children:"الجنس"}),e.jsx(Uc,{className:"text-center",children:"العمر"}),e.jsx(Uc,{className:"text-center",children:"رقم الهاتف"}),e.jsx(Uc,{className:"text-center",children:"حالة المريض"}),e.jsx(Uc,{className:"text-center",children:"تاريخ الإضافة"}),e.jsx(Uc,{className:"text-center",children:"الاجراءات"})]})}),e.jsx(Yc,{children:[...Array(5)].map((t,n)=>e.jsxs(qc,{children:[e.jsx(Hc,{className:"text-center w-12",children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded mx-auto w-6"})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded mx-auto w-32"})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded mx-auto w-16"})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded mx-auto w-12"})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded mx-auto w-14"})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded mx-auto w-24"})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded mx-auto w-20"})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded mx-auto w-18"})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded mx-auto w-24"})})]},n))})]})});if(0===t.length)return e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-center w-12 max-w-12 min-w-12",children:e.jsx("span",{className:"arabic-enhanced font-medium text-xs",children:"#"})}),e.jsx(y,{field:"full_name",children:"الاسم الكامل للمريض"}),e.jsx(y,{field:"patient_number",children:"رقم المريض"}),e.jsx(y,{field:"gender",children:"الجنس"}),e.jsx(y,{field:"age",children:"العمر"}),e.jsx(y,{field:"phone",children:"رقم الهاتف"}),e.jsx(y,{field:"patient_condition",children:"حالة المريض"}),e.jsx(y,{field:"date_added",children:"تاريخ الإضافة"}),e.jsx(Uc,{className:"text-center",children:"الاجراءات"})]})}),e.jsx(Yc,{children:e.jsx(qc,{children:e.jsx(Hc,{colSpan:9,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(yr,{className:"w-12 h-12 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد مرضى"})]})})})})]})});const{patients:b,totalPages:j,totalCount:w}=f,N=(m-1)*p,_=e=>{u(e)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{className:"bg-muted/50",children:[e.jsx(Uc,{className:"text-center w-12 max-w-12 min-w-12",children:e.jsx("span",{className:"arabic-enhanced font-medium text-xs",children:"#"})}),e.jsx(y,{field:"full_name",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الاسم الكامل للمريض"})}),e.jsx(y,{field:"patient_number",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"رقم المريض"})}),e.jsx(y,{field:"gender",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الجنس"})}),e.jsx(y,{field:"age",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"العمر"})}),e.jsx(y,{field:"phone",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"رقم الهاتف"})}),e.jsx(y,{field:"patient_condition",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"حالة المريض"})}),e.jsx(y,{field:"date_added",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"تاريخ الإضافة"})}),e.jsx(Uc,{className:"text-center",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الاجراءات"})})]})}),e.jsx(Yc,{children:b.map((t,n)=>e.jsxs(qc,{className:"hover:bg-muted/50",children:[e.jsx(Hc,{className:"font-medium text-center w-12 max-w-12 min-w-12 text-xs",children:N+n+1}),e.jsx(Hc,{className:"font-medium text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:t.full_name.charAt(0)}),e.jsx("span",{children:t.full_name})]})}),e.jsx(Hc,{className:"text-center",children:t.patient_number?e.jsx("span",{className:"text-sm arabic-enhanced font-medium",children:t.patient_number}):e.jsx("span",{className:"text-muted-foreground text-sm arabic-enhanced",children:"-"})}),e.jsx(Hc,{className:"text-center",children:e.jsx(oc,{variant:"male"===t.gender?"default":"secondary",children:"male"===t.gender?"ذكر":"أنثى"})}),e.jsxs(Hc,{className:"text-center",children:[t.age," سنة"]}),e.jsx(Hc,{className:"min-w-[120px] text-center table-cell-wrap-truncate-sm",children:t.phone?e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("button",{onClick:async()=>{const e=`https://api.whatsapp.com/send/?phone=${t.phone}`;try{if(window.electronAPI&&window.electronAPI.system&&window.electronAPI.system.openExternal)return void(await window.electronAPI.system.openExternal(e))}catch(n){console.log("Method 1 failed:",n)}try{if(window.electronAPI)return void(await(window.electronAPI.shell?.openExternal?.(e)))}catch(n){console.log("Method 2 failed:",n)}window.open(e,"_blank","noopener,noreferrer")},className:"text-sm arabic-enhanced text-green-600 hover:text-green-800 hover:underline cursor-pointer transition-colors bg-transparent border-none p-0 flex items-center gap-1",title:"فتح محادثة واتساب",children:[t.phone,e.jsx(Os,{className:"w-3 h-3 text-green-600"})]})}):e.jsx("span",{className:"text-muted-foreground text-sm arabic-enhanced",children:"غير محدد"})}),e.jsx(Hc,{className:"min-w-[150px] text-center",children:e.jsx(oc,{variant:"outline",className:"max-w-[150px] truncate arabic-enhanced",title:t.patient_condition,children:t.patient_condition})}),e.jsx(Hc,{className:"text-center",children:e.jsx("span",{className:"text-sm arabic-enhanced",children:In(t.date_added)})}),e.jsx(Hc,{className:"w-auto text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-view h-8 px-2 min-w-0",onClick:()=>r(t),title:"عرض تفاصيل المريض",children:[e.jsx(ys,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs arabic-enhanced hidden sm:inline ml-1",children:"عرض"})]}),e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-edit h-8 px-2 min-w-0",onClick:()=>a(t),title:"تعديل بيانات المريض",children:[e.jsx(Us,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs arabic-enhanced hidden sm:inline ml-1",children:"تعديل"})]}),e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-delete text-red-600 hover:text-red-700 hover:bg-red-50 h-8 px-2 min-w-0",onClick:()=>s(t.id),title:"حذف المريض",children:[e.jsx(dr,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs arabic-enhanced hidden sm:inline ml-1",children:"حذف"})]}),e.jsxs(lf,{children:[e.jsx(of,{asChild:!0,children:e.jsx(Lr,{variant:"ghost",size:"sm",className:"h-8 px-2 min-w-0",title:"المزيد من الخيارات",children:e.jsx(zs,{className:"w-3 h-3"})})}),e.jsxs(cf,{align:"end",className:"patient-actions-dropdown",children:[e.jsxs(df,{onClick:()=>(async e=>{try{g({title:"جاري إعداد الطباعة...",description:"يتم تجميع بيانات المريض وإعداد الطباعة المباشرة"});const t=await uf.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");const n=yh.createPatientRecordHTMLForPrint(t,x),a=window.open("","_blank");if(!a)throw new Error("لا يمكن فتح نافذة الطباعة");a.document.write(n),a.document.close(),a.onload=()=>{a.focus(),a.print(),a.close()},g({title:"تم إعداد الطباعة",description:`تم إعداد طباعة سجل المريض ${e.full_name}`})}catch(t){console.error("Error printing patient record:",t),g({title:"خطأ في الطباعة",description:"فشل في إعداد طباعة سجل المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}})(t),className:"dropdown-item",children:[e.jsx(Qs,{className:"w-4 h-4"}),e.jsx("span",{className:"arabic-enhanced",children:"طباعة مباشرة"})]}),e.jsxs(df,{onClick:()=>(async e=>{try{g({title:"جاري إعداد التقرير...",description:"يتم تجميع بيانات المريض وإعداد التقرير للتصدير"});const t=await uf.getPatientIntegratedData(e.id);if(!t)throw new Error("لا يمكن جلب بيانات المريض");await yh.exportIndividualPatientRecord(t,x),g({title:"تم إنشاء التقرير بنجاح",description:`تم إنشاء سجل المريض ${e.full_name} وحفظه كملف PDF`})}catch(t){console.error("Error exporting patient record:",t),g({title:"خطأ في إنشاء التقرير",description:"فشل في إنشاء سجل المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}})(t),className:"dropdown-item",children:[e.jsx(fs,{className:"w-4 h-4"}),e.jsx("span",{className:"arabic-enhanced",children:"تصدير سجل المريض"})]}),e.jsx(mf,{}),i&&e.jsxs(df,{onClick:()=>i(t),className:"dropdown-item",children:[e.jsx(bs,{className:"w-4 h-4"}),e.jsx("span",{className:"arabic-enhanced",children:"فاتورة المعلقات"})]})]})]})]})})]},t.id))})]})})}),w>0&&e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:e.jsxs("p",{className:"text-sm text-muted-foreground arabic-enhanced",children:["عرض ",(m-1)*p+1," إلى ",Math.min(m*p,w)," من ",w," مريض"]})}),e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(Nl,{value:`${p}`,onValueChange:e=>{h(parseInt(e)),u(1)},children:[e.jsx(Sl,{className:"h-8 w-[70px]",children:e.jsx(kl,{placeholder:p})}),e.jsx(Dl,{side:"top",children:[10,20,30,50,100].map(t=>e.jsx(Al,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",m," من ",j]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>_(1),disabled:1===m,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(cs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>_(m-1),disabled:1===m,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(is,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>_(m+1),disabled:m===j,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(rs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>_(j),disabled:m===j,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(os,{className:"h-4 w-4"})]})]})]})]})]})}function hf(e,t,n){const a=n.filter(t=>t.appointment_id===e),s=a.reduce((e,t)=>e+t.amount,0),r=Math.max(0,t-s),i=function(e,t,n){const a=function(e,t){return e?t.filter(t=>t.appointment_id===e&&("partial"===t.status||"completed"===t.status)).reduce((e,t)=>e+t.amount,0):0}(e,n);return a>=t?"completed":a>0?"partial":"pending"}(e,t,n);return{appointmentPayments:a,totalPaid:s,remainingBalance:r,status:i,appointmentCost:t,paymentCount:a.length}}const xf=de()(xt((e,t)=>({medications:[],selectedMedication:null,isLoading:!1,error:null,searchQuery:"",filteredMedications:[],loadMedications:async()=>{e({isLoading:!0,error:null});try{const n=await(window.electronAPI?.medications?.getAll())||[];e({medications:n,filteredMedications:n,isLoading:!1}),t().filterMedications()}catch(n){console.error("Error loading medications:",n),e({error:n instanceof Error?n.message:"Failed to load medications",isLoading:!1})}},createMedication:async n=>{e({isLoading:!0,error:null});try{const a=await(window.electronAPI?.medications?.create(n));if(a){const n=[...t().medications,a];e({medications:n,filteredMedications:n,isLoading:!1}),t().filterMedications()}}catch(a){throw console.error("Error creating medication:",a),e({error:a instanceof Error?a.message:"Failed to create medication",isLoading:!1}),a}},updateMedication:async(n,a)=>{e({isLoading:!0,error:null});try{const s=await(window.electronAPI?.medications?.update(n,a));if(s){const a=t().medications.map(e=>e.id===n?{...e,...s}:e);e({medications:a,filteredMedications:a,isLoading:!1}),t().filterMedications()}}catch(s){throw console.error("Error updating medication:",s),e({error:s instanceof Error?s.message:"Failed to update medication",isLoading:!1}),s}},deleteMedication:async n=>{e({isLoading:!0,error:null});try{if(await(window.electronAPI?.medications?.delete(n))){const a=t().medications.filter(e=>e.id!==n);e({medications:a,filteredMedications:a,selectedMedication:t().selectedMedication?.id===n?null:t().selectedMedication,isLoading:!1}),t().filterMedications()}}catch(a){throw console.error("Error deleting medication:",a),e({error:a instanceof Error?a.message:"Failed to delete medication",isLoading:!1}),a}},setSelectedMedication:t=>{e({selectedMedication:t})},setSearchQuery:n=>{e({searchQuery:n}),t().filterMedications()},filterMedications:()=>{const{medications:n,searchQuery:a}=t();if(!a.trim())return void e({filteredMedications:n});const s=n.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())||e.instructions&&e.instructions.toLowerCase().includes(a.toLowerCase()));e({filteredMedications:s})},clearError:()=>{e({error:null})}}),{name:"medication-store"}));function gf({open:t,onOpenChange:n,editingPrescription:a,preSelectedPatientId:s}){const{createPrescription:r,updatePrescription:i,isLoading:l}=pa(),{medications:o,loadMedications:c}=xf(),{patients:d,loadPatients:m}=bt(),{appointments:u,loadAppointments:p}=Jn(),[h,x]=re.useState({patient_id:"",appointment_id:"",prescription_date:(new Date).toISOString().split("T")[0],notes:""}),[g,f]=re.useState([]),[v,y]=re.useState({});re.useEffect(()=>{t&&(c(),m(),p())},[t,c,m,p]),re.useEffect(()=>{if(t){if(a&&a.id){x({patient_id:a.patient_id||"",appointment_id:a.appointment_id||"",prescription_date:a.prescription_date||(new Date).toISOString().split("T")[0],notes:a.notes||""});const e=a.medications?.map(e=>({medication_id:e.medication_id,dose:e.dose||"",medication_name:e.medication_name}))||[];f(e)}else x({patient_id:s||"",appointment_id:"",prescription_date:(new Date).toISOString().split("T")[0],notes:""}),f([]);y({})}},[t,a]);const b=u.filter(e=>e.patient_id===h.patient_id),j=(e,t)=>{x(n=>({...n,[e]:t})),"patient_id"===e&&x(e=>({...e,appointment_id:""})),v[e]&&y(t=>({...t,[e]:""}))},w=()=>{f(e=>[...e,{medication_id:"",dose:""}])},N=(e,t,n)=>{f(a=>a.map((a,s)=>{if(s===e){const e={...a,[t]:n};if("medication_id"===t){const t=o.find(e=>e.id===n);e.medication_name=t?.name}return e}return a}));const a=[`medication_${e}`,`dose_${e}`];y(e=>{const t={...e};return a.forEach(e=>delete t[e]),t})},_=()=>{l||n(!1)};return e.jsx(Sr,{open:t,onOpenChange:_,children:e.jsxs(Dr,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center gap-2 text-right",children:[e.jsx(bs,{className:"w-5 h-5 text-green-600"}),a&&a.id?"تعديل الوصفة الطبية":"إنشاء وصفة طبية جديدة"]}),e.jsx(Fr,{className:"text-right",children:a&&a.id?"قم بتعديل معلومات الوصفة الطبية أدناه":"أدخل معلومات الوصفة الطبية الجديدة أدناه"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return h.patient_id||(e.patient_id="يجب اختيار مريض"),h.prescription_date||(e.prescription_date="تاريخ الوصفة مطلوب"),0===g.length&&(e.medications="يجب إضافة دواء واحد على الأقل"),g.forEach((t,n)=>{t.medication_id||(e[`medication_${n}`]="يجب اختيار دواء"),t.dose.trim()||(e[`dose_${n}`]="الجرعة مطلوبة")}),y(e),0===Object.keys(e).length})())try{const e={patient_id:h.patient_id,appointment_id:h.appointment_id||void 0,prescription_date:h.prescription_date,notes:h.notes.trim()||void 0,medications:g.map(e=>({medication_id:e.medication_id,dose:e.dose.trim()}))};a&&a.id?(await i(a.id,e),Kc.success("تم تحديث الوصفة الطبية بنجاح")):(await r(e),Kc.success("تم إنشاء الوصفة الطبية بنجاح")),n(!1)}catch(t){console.error("Error saving prescription:",t),Kc.error(a&&a.id?"فشل في تحديث الوصفة الطبية":"فشل في إنشاء الوصفة الطبية")}},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"patient_id",className:"text-right block",children:["المريض ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Nl,{value:h.patient_id,onValueChange:e=>j("patient_id",e),children:[e.jsx(Sl,{className:"text-right bg-background border-input text-foreground "+(v.patient_id?"border-red-500":""),dir:"rtl",children:e.jsx(kl,{placeholder:"اختر مريض",className:"text-muted-foreground"})}),e.jsx(Dl,{children:d.map(t=>e.jsx(Al,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yr,{className:"w-4 h-4"}),t.full_name]})},t.id))})]}),v.patient_id&&e.jsx("p",{className:"text-sm text-red-500 text-right",children:v.patient_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"appointment_id",className:"text-right block",children:"الموعد (اختياري)"}),e.jsxs(Nl,{value:h.appointment_id,onValueChange:e=>j("appointment_id",e),disabled:!h.patient_id,children:[e.jsx(Sl,{className:"text-right bg-background border-input text-foreground",dir:"rtl",children:e.jsx(kl,{placeholder:h.patient_id?"اختر موعد":"اختر مريض أولاً",className:"text-muted-foreground"})}),e.jsx(Dl,{children:b.map(t=>e.jsx(Al,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4"}),t.title]})},t.id))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"prescription_date",className:"text-right block",children:["تاريخ الوصفة ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Ir,{id:"prescription_date",type:"date",value:h.prescription_date,onChange:e=>j("prescription_date",e.target.value),className:"text-right "+(v.prescription_date?"border-red-500":""),dir:"rtl",disabled:l}),v.prescription_date&&e.jsx("p",{className:"text-sm text-red-500 text-right",children:v.prescription_date})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Yr,{className:"text-right text-lg font-medium",children:["الأدوية ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Lr,{type:"button",variant:"outline",size:"sm",onClick:w,disabled:l,children:[e.jsx(Zs,{className:"w-4 h-4 ml-2"}),"إضافة دواء"]})]}),v.medications&&e.jsx("p",{className:"text-sm text-red-500 text-right",children:v.medications}),e.jsxs("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:[g.map((t,n)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:["دواء ",n+1]}),g.length>1&&e.jsx(Lr,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{f(t=>t.filter((t,n)=>n!==e))})(n),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(dr,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"text-right block text-sm",children:["اسم الدواء ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Nl,{value:t.medication_id,onValueChange:e=>N(n,"medication_id",e),children:[e.jsx(Sl,{className:"text-right bg-background border-input text-foreground "+(v[`medication_${n}`]?"border-red-500":""),dir:"rtl",children:e.jsx(kl,{placeholder:"اختر دواء",className:"text-muted-foreground"})}),e.jsx(Dl,{children:o.map(t=>e.jsx(Al,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4"}),t.name]})},t.id))})]}),v[`medication_${n}`]&&e.jsx("p",{className:"text-sm text-red-500 text-right",children:v[`medication_${n}`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"text-right block text-sm",children:["الجرعة ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Ir,{value:t.dose,onChange:e=>N(n,"dose",e.target.value),placeholder:"مثال: قرص واحد كل 8 ساعات",className:"text-right "+(v[`dose_${n}`]?"border-red-500":""),dir:"rtl",disabled:l}),v[`dose_${n}`]&&e.jsx("p",{className:"text-sm text-red-500 text-right",children:v[`dose_${n}`]})]})]}),t.medication_id&&(()=>{const n=o.find(e=>e.id===t.medication_id);return n?.instructions?e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-sm",children:[e.jsx("span",{className:"font-medium text-blue-800",children:"تعليمات الدواء: "}),e.jsx("span",{className:"text-blue-700",children:n.instructions})]}):null})()]},n)),0===g.length&&e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-muted-foreground/25 rounded-lg",children:[e.jsx(Ws,{className:"w-12 h-12 mx-auto mb-2 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"لم يتم إضافة أي أدوية بعد"}),e.jsxs(Lr,{type:"button",variant:"outline",size:"sm",onClick:w,className:"mt-2",children:[e.jsx(Zs,{className:"w-4 h-4 ml-2"}),"إضافة دواء"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"notes",className:"text-right block",children:"ملاحظات إضافية"}),e.jsx(wl,{id:"notes",value:h.notes,onChange:e=>j("notes",e.target.value),placeholder:"أدخل أي ملاحظات إضافية للوصفة الطبية (اختياري)",className:"text-right min-h-[80px]",dir:"rtl",disabled:l})]}),e.jsxs(Tr,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsxs(Lr,{type:"button",variant:"outline",onClick:_,disabled:l,children:[e.jsx(_r,{className:"w-4 h-4 ml-2"}),"إلغاء"]}),e.jsx(Lr,{type:"submit",disabled:l,className:"bg-green-600 hover:bg-green-700 text-white",children:l?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحفظ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(er,{className:"w-4 h-4 ml-2"}),a?"تحديث الوصفة":"إنشاء الوصفة"]})})]})]})]})})}const ff=re.forwardRef(({checked:t=!1,onCheckedChange:n,disabled:a=!1,className:s,id:r,...i},l)=>{const o=()=>{!a&&n&&n(!t)};return e.jsx("button",{ref:l,id:r,type:"button",role:"switch","aria-checked":t,disabled:a,onClick:o,onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),o())},className:En("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",t?"bg-primary":"bg-input",s),...i,children:e.jsx("span",{className:En("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",t?"translate-x-5":"translate-x-0")})})});ff.displayName="Switch";class vf{static calculateDateRange(e){const t=new Date,n=t.toISOString().split("T")[0];switch(e.date_range){case"last_month":return{from:new Date(t.getFullYear(),t.getMonth()-1,t.getDate()).toISOString().split("T")[0],to:n};case"last_3_months":return{from:new Date(t.getFullYear(),t.getMonth()-3,t.getDate()).toISOString().split("T")[0],to:n};case"last_6_months":return{from:new Date(t.getFullYear(),t.getMonth()-6,t.getDate()).toISOString().split("T")[0],to:n};case"last_year":return{from:new Date(t.getFullYear()-1,t.getMonth(),t.getDate()).toISOString().split("T")[0],to:n};case"custom":return{from:e.custom_start_date||n,to:e.custom_end_date||n};default:return{from:n,to:n}}}static filterPaymentsByDate(e,t){return e.filter(e=>{const n=e.payment_date;return n>=t.from&&n<=t.to})}static async getPatientPendingPayments(e,t,n,a=[],s=[]){try{const r=this.calculateDateRange(t),i=a||[],l=s||[],o=(n||[]).filter(t=>t.patient_id===e&&"pending"===t.status),c=this.filterPaymentsByDate(o,r),d=[];for(const e of c){const t=e.appointment_id?i.find(t=>t.id===e.appointment_id):void 0,n=e.tooth_treatment_id?l.find(t=>t.id===e.tooth_treatment_id):void 0,a=t?l.filter(e=>e.appointment_id===t.id):[],s=n||(1===a.length?a[0]:void 0),r=n?[n]:a,o=e.amount||0;let c,m=o,u=0,p=0;if(e.tooth_treatment_id?(u=e.treatment_total_cost||0,p=e.treatment_remaining_balance||0,m=p>0?p:u):e.appointment_id?(u=e.appointment_total_cost||e.total_amount_due||0,p=e.appointment_remaining_balance||e.remaining_balance||0,m=p>0?p:u):(u=e.total_amount_due||0,p=e.remaining_balance||0,0===o&&u>0?m=u:(0===o&&p>0||p>0)&&(m=p)),s?.treatment_type){if(c=ka(s.treatment_type),c===s.treatment_type){c={pediatric_pulp_treatment:"معالجة لبية",pulp_therapy:"مداولة لبية",filling_metal:"حشو معدني",filling_cosmetic:"حشو تجميلي",crown_ceramic:"تاج خزفي",extraction_simple:"قلع بسيط"}[s.treatment_type]||s.treatment_type}}else r.length>0&&(c=r.map(e=>{let t=ka(e.treatment_type);if(t===e.treatment_type){t={pediatric_pulp_treatment:"معالجة لبية",pulp_therapy:"مداولة لبية",filling_metal:"حشو معدني",filling_cosmetic:"حشو تجميلي",crown_ceramic:"تاج خزفي",extraction_simple:"قلع بسيط"}[e.treatment_type]||e.treatment_type}return t}).join(", "));let h=e.description;if(h&&(h=h.replace(/\[علاج:[^\]]+\]/g,"").trim(),h=h.replace(/^\s*-\s*/,"").trim(),!h&&c&&(h=c)),!c&&h){const e={pediatric_pulp_treatment:"معالجة لبية","معالجة لبية":"معالجة لبية","علاج عصب":"علاج عصب","حشو":"حشو","تاج":"تاج","قلع":"قلع"};for(const[t,n]of Object.entries(e))if(h.includes(t)){c=n;break}}let x=e.notes;x&&(x=x.replace(/\[علاج:[^\]]+\]/g,"").trim(),x=x.replace(/^\s*-\s*/,"").trim());const g={id:e.id,patient_id:e.patient_id,appointment_id:e.appointment_id,tooth_treatment_id:e.tooth_treatment_id,appointment_date:t?.start_time?.split("T")[0],appointment_title:t?.title,treatment_type:c,tooth_number:s?.tooth_number,tooth_name:s?.tooth_name,amount:this.roundToTwoDecimals(m),description:h,payment_date:e.payment_date,notes:x,discount_amount:this.roundToTwoDecimals(e.discount_amount||0),tax_amount:this.roundToTwoDecimals(e.tax_amount||0),total_amount:this.roundToTwoDecimals(e.total_amount||m),treatment_total_cost:e.treatment_total_cost,treatment_remaining_balance:e.treatment_remaining_balance,appointment_total_cost:e.appointment_total_cost,appointment_remaining_balance:e.appointment_remaining_balance};d.push(g)}return d.sort((e,t)=>new Date(e.payment_date).getTime()-new Date(t.payment_date).getTime())}catch(r){throw console.error("خطأ في جلب المدفوعات المعلقة:",r),new Error("فشل في جلب المدفوعات المعلقة")}}static calculatePendingPaymentsSummary(e,t,n,a,s){const r=this.roundToTwoDecimals(n.reduce((e,t)=>e+t.amount,0));let i=0;a.apply_discount&&a.discount_value>0&&(i="percentage"===a.discount_type?this.roundToTwoDecimals(r*a.discount_value/100):this.roundToTwoDecimals(Math.min(a.discount_value,r)));const l=this.roundToTwoDecimals(r-i);let o=0;a.include_tax&&a.tax_rate>0&&(o=this.roundToTwoDecimals(l*a.tax_rate/100));const c=this.roundToTwoDecimals(l+o);return{patient_id:e,patient_name:t,total_pending_amount:r,total_items:n.length,items:n,subtotal:r,total_discount:i,total_tax:o,final_total:c,date_range:s}}static roundToTwoDecimals(e){return Math.round(100*(e+Number.EPSILON))/100}static generateInvoiceNumber(){const e=new Date;return`INV-${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}-${String(e.getHours()).padStart(2,"0")+String(e.getMinutes()).padStart(2,"0")}-${Math.floor(1e3*Math.random()).toString().padStart(3,"0")}`}static createComprehensiveInvoiceData(e,t,n,a){return{invoice_number:this.generateInvoiceNumber(),invoice_date:(new Date).toISOString().split("T")[0],patient:e,summary:t,settings:n,clinic_info:a,generated_at:(new Date).toISOString()}}static validateFinancialData(e){const t=this.roundToTwoDecimals(e.items.reduce((e,t)=>e+t.amount,0));if(Math.abs(t-e.subtotal)>.01)return console.error("خطأ في حساب المجموع الفرعي"),!1;const n=this.roundToTwoDecimals(e.subtotal-e.total_discount+e.total_tax);return!(Math.abs(n-e.final_total)>.01)||(console.error("خطأ في حساب المجموع النهائي"),!1)}}function yf({patient:t,open:n,onOpenChange:a}){const{toast:s}=Bl(),{payments:r,updatePayment:i}=ca(),{appointments:l}=Jn(),{toothTreatments:o,loadToothTreatments:c,loadToothTreatmentsByPatient:d}=cc(),{settings:m}=ta(),[u,p]=re.useState(!1),[h,x]=re.useState(null),[g,f]=re.useState(null);re.useState(!1);const[v,y]=re.useState({date_range:"last_3_months"}),[b,j]=re.useState({apply_discount:!1,discount_type:"percentage",discount_value:0,discount_reason:"",include_tax:!1,tax_rate:0,include_clinic_logo:!0,include_patient_details:!0,include_payment_terms:!0,payment_terms_text:"",footer_notes:"شكراً لثقتكم بنا"}),[w,N]=re.useState({printerType:"80mm",includeQR:!0,includeBarcode:!0,includeLogo:!0,colorMode:"color",qrType:"text"}),[_,k]=re.useState(!1),[S,C]=re.useState(""),[$,D]=re.useState(""),E=re.useRef(null),T=()=>{if(!h||!t)return"";const e=A(),n=t.full_name||"غير محدد",a=t.phone||"غير محدد",s=t.id.toString().padStart(4,"0"),r=In((new Date).toISOString().split("T")[0]),i=m?.clinic_name||"عيادة الأسنان",l=m?.doctor_name||"الطبيب",o=m?.clinic_phone||"غير محدد",c=m?.clinic_address||"غير محدد",d=Mn(h.subtotal),u=h.total_discount>0?Mn(h.total_discount):"0",p=h.total_tax>0?Mn(h.total_tax):"0",x=Mn(h.final_total),g=h.items.length;return`🏥 ${i}\n👨‍⚕️ د. ${l}\n📞 ${o}\n📍 ${c}\n\n📋 فاتورة المدفوعات المعلقة\n🔢 رقم الفاتورة: ${e}\n📅 تاريخ الإصدار: ${r}\n📅 فترة الفاتورة: ${`${In(h.date_range.from)} - ${In(h.date_range.to)}`}\n\n👤 بيانات المريض:\n🆔 رقم المريض: ${s}\n👤 الاسم: ${n}\n📞 الهاتف: ${a}\n\n📋 تفاصيل العناصر (${g} عنصر):\n${h.items.slice(0,3).map((e,t)=>`${t+1}. ${e.appointment_title||e.treatment_type||e.description} - ${Mn(e.amount)}${e.tooth_name?` (🦷 ${e.tooth_name})`:""}`).join("\n")}${h.items.length>3?`\n... و ${h.items.length-3} عنصر إضافي`:""}\n\n💰 ملخص المبالغ:\nالمجموع الفرعي: ${d}\nالخصم: ${u}\nالضريبة: ${p}\n━━━━━━━━━━━━━━━━━━━━\nالمجموع النهائي: ${x}\n\n${b.discount_reason?`💸 سبب الخصم: ${b.discount_reason}\n`:""}${b.notes?`📝 ملاحظات: ${b.notes}\n`:""}\n🙏 شكراً لثقتكم بنا\n⏰ تم الإنشاء: ${(new Date).toLocaleString("ar-EG")}`},A=()=>{if(!h||!t)return"";const e=Date.now().toString();return`INV${t.id.toString().padStart(4,"0")}${h.items.length.toString().padStart(2,"0")}${Math.round(h.final_total).toString().padStart(6,"0")}${e.slice(-4)}`};re.useEffect(()=>{n&&t&&Promise.all([c(),d(t.id)]).then(()=>{F()}).catch(e=>{console.error("خطأ في تحميل البيانات:",e),F()})},[n,t,v]),re.useEffect(()=>{h&&t&&((async()=>{if(w.includeQR&&h&&t)try{const e=T();if(console.log("QR Code Data:",e),!e)return void console.error("QR Code: لا توجد بيانات للتوليد");const t=await at.toDataURL(e,{width:"a4"===w.printerType?120:80,margin:1,color:{dark:"#000000",light:"#FFFFFF"}});console.log("QR Code تم توليده بنجاح:",t.substring(0,50)+"..."),C(t)}catch(e){console.error("خطأ في توليد QR Code:",e)}else console.log("QR Code: شروط التوليد غير مكتملة",{includeQR:w.includeQR,pendingSummary:!!h,patient:!!t})})(),(async()=>{if(w.includeBarcode&&h)try{const e=document.createElement("canvas"),t=A();if(console.log("Barcode Data:",t),!t)return void console.error("Barcode: لا توجد بيانات للتوليد");st(e,t,{format:"CODE128",width:"a4"===w.printerType?2:1,height:"a4"===w.printerType?50:30,displayValue:!0,fontSize:"a4"===w.printerType?12:8,margin:5});const n=e.toDataURL();console.log("Barcode تم توليده بنجاح:",n.substring(0,50)+"..."),D(n)}catch(e){console.error("خطأ في توليد الباركود:",e)}else console.log("Barcode: شروط التوليد غير مكتملة",{includeBarcode:w.includeBarcode,pendingSummary:!!h})})())},[h,w.includeQR,w.includeBarcode,w.printerType]),re.useEffect(()=>{h&&t&&P()},[b]);const F=async()=>{if(t){p(!0);try{const e={payments:!!r&&r.length>0,appointments:!!l&&l.length>0,toothTreatments:!!o&&o.length>0};console.log("حالة البيانات:",e),r&&l&&o||console.warn("بعض البيانات المطلوبة غير متوفرة:",{payments:!!r,appointments:!!l,toothTreatments:!!o});const n=await vf.getPatientPendingPayments(t.id,v,r||[],l||[],o||[]),a=vf.calculateDateRange(v),s=vf.calculatePendingPaymentsSummary(t.id,t.full_name,n,b,a);if(!vf.validateFinancialData(s))throw new Error("خطأ في حساب البيانات المالية");x(s);const i=vf.createComprehensiveInvoiceData(t,s,b,m);f(i)}catch(e){console.error("خطأ في تحميل المدفوعات المعلقة:",e),s({title:"خطأ",description:"فشل في تحميل المدفوعات المعلقة",variant:"destructive"})}finally{p(!1)}}},P=()=>{if(!h||!t)return;const e=vf.calculateDateRange(v),n=vf.calculatePendingPaymentsSummary(t.id,t.full_name,h.items,b,e);x(n),g&&f({...g,summary:n,settings:b})},R=(e,t)=>{y(n=>({...n,[e]:t})),setTimeout(()=>{F()},100)},O=(e,t)=>{j(n=>({...n,[e]:t}))},M=async()=>{if(g)try{p(!0),await yh.exportComprehensivePendingInvoice(g),s({title:"تم بنجاح",description:"تم تصدير الفاتورة كملف PDF",variant:"default"})}catch(e){console.error("خطأ في تصدير PDF:",e),s({title:"خطأ",description:"فشل في تصدير الفاتورة كـ PDF",variant:"destructive"})}finally{p(!1)}else s({title:"خطأ",description:"لا توجد بيانات فاتورة للتصدير",variant:"destructive"})};return t?e.jsx(Sr,{open:n,onOpenChange:a,children:e.jsxs(Dr,{className:"max-w-[95vw] max-h-[95vh] p-0",children:[e.jsx(Er,{className:"p-4 border-b",children:e.jsxs(Ar,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"w-5 h-5"}),"فاتورة المدفوعات المعلقة الشاملة"]}),e.jsx(oc,{variant:"outline",className:"text-sm",children:t.full_name})]})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 h-[calc(95vh-100px)]",children:[e.jsxs("div",{className:"col-span-3 space-y-3",children:[e.jsx(nc,{className:"p-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"text-xs font-medium flex items-center gap-1",children:[e.jsx(js,{className:"w-3 h-3"}),"فلتر التاريخ"]}),e.jsxs(Nl,{value:v.date_range,onValueChange:e=>R("date_range",e),children:[e.jsx(Sl,{className:"h-8 text-xs",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"last_month",children:"آخر شهر"}),e.jsx(Al,{value:"last_3_months",children:"آخر 3 أشهر"}),e.jsx(Al,{value:"last_6_months",children:"آخر 6 أشهر"}),e.jsx(Al,{value:"last_year",children:"آخر سنة"}),e.jsx(Al,{value:"custom",children:"تاريخ مخصص"})]})]}),"custom"===v.date_range&&e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:[e.jsx(Yr,{className:"text-xs",children:"من"}),e.jsx(Ir,{type:"date",className:"h-8 text-xs",value:v.custom_start_date||"",onChange:e=>R("custom_start_date",e.target.value)})]}),e.jsxs("div",{children:[e.jsx(Yr,{className:"text-xs",children:"إلى"}),e.jsx(Ir,{type:"date",className:"h-8 text-xs",value:v.custom_end_date||"",onChange:e=>R("custom_end_date",e.target.value)})]})]})]})}),e.jsx(nc,{className:"p-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"text-xs font-medium flex items-center gap-1",children:[e.jsx(Xa,{className:"w-3 h-3"}),"الخصومات والضرائب"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Yr,{className:"text-xs",children:"تطبيق خصم"}),e.jsx(ff,{checked:b.apply_discount,onCheckedChange:e=>O("apply_discount",e)})]}),b.apply_discount&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:[e.jsx(Yr,{className:"text-xs",children:"نوع الخصم"}),e.jsxs(Nl,{value:b.discount_type,onValueChange:e=>O("discount_type",e),children:[e.jsx(Sl,{className:"h-8 text-xs",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"percentage",children:"نسبة مئوية"}),e.jsx(Al,{value:"fixed",children:"مبلغ ثابت"})]})]})]}),e.jsxs("div",{children:[e.jsxs(Yr,{className:"text-xs",children:["قيمة الخصم ","percentage"===b.discount_type?"(%)":"(مبلغ)"]}),e.jsx(Ir,{type:"number",min:"0",step:"0.1",className:"h-8 text-xs",value:b.discount_value,onChange:e=>{const t=e.target.value;O("discount_value",""===t?0:parseFloat(t)||0)},onBlur:e=>{const t=parseFloat(e.target.value)||0;O("discount_value",t)}})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{className:"text-xs",children:"سبب الخصم"}),e.jsx(Ir,{className:"h-8 text-xs",value:b.discount_reason||"",onChange:e=>O("discount_reason",e.target.value),placeholder:"اختياري"})]})]}),e.jsx(Wh,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Yr,{className:"text-xs",children:"تضمين ضريبة"}),e.jsx(ff,{checked:b.include_tax,onCheckedChange:e=>O("include_tax",e)})]}),b.include_tax&&e.jsxs("div",{children:[e.jsx(Yr,{className:"text-xs",children:"معدل الضريبة (%)"}),e.jsx(Ir,{type:"number",min:"0",max:"100",step:"0.1",className:"h-8 text-xs",value:b.tax_rate,onChange:e=>{const t=e.target.value;O("tax_rate",""===t?0:parseFloat(t)||0)},onBlur:e=>{const t=parseFloat(e.target.value)||0;O("tax_rate",t)}})]})]})}),e.jsx(nc,{className:"p-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Yr,{className:"text-xs font-medium flex items-center gap-1",children:[e.jsx(nr,{className:"w-3 h-3"}),"إعدادات الطباعة"]}),e.jsxs(Lr,{variant:"ghost",size:"sm",onClick:()=>k(!_),className:"text-xs h-6 px-2",children:[e.jsx(ys,{className:"w-3 h-3 ml-1"}),_?"إخفاء":"معاينة"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Yr,{className:"text-xs",children:"نوع الطابعة"}),e.jsxs(Nl,{value:w.printerType,onValueChange:e=>N(t=>({...t,printerType:e})),children:[e.jsx(Sl,{className:"h-8 text-xs",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"58mm",children:"حرارية 58mm"}),e.jsx(Al,{value:"80mm",children:"حرارية 80mm"}),e.jsx(Al,{value:"a4",children:"عادية A4"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Yr,{className:"text-xs",children:"نمط الألوان"}),e.jsxs(Nl,{value:w.colorMode,onValueChange:e=>N(t=>({...t,colorMode:e})),children:[e.jsx(Sl,{className:"h-8 text-xs",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"color",children:"ملون"}),e.jsx(Al,{value:"bw",children:"أبيض وأسود"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("input",{type:"checkbox",id:"includeLogo",checked:w.includeLogo,onChange:e=>N(t=>({...t,includeLogo:e.target.checked})),className:"rounded border-gray-300"}),e.jsx(Yr,{htmlFor:"includeLogo",className:"text-xs",children:"تضمين الشعار"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("input",{type:"checkbox",id:"includeQR",checked:w.includeQR,onChange:e=>N(t=>({...t,includeQR:e.target.checked})),className:"rounded border-gray-300"}),e.jsx(Yr,{htmlFor:"includeQR",className:"text-xs",children:"QR Code"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("input",{type:"checkbox",id:"includeBarcode",checked:w.includeBarcode,onChange:e=>N(t=>({...t,includeBarcode:e.target.checked})),className:"rounded border-gray-300"}),e.jsx(Yr,{htmlFor:"includeBarcode",className:"text-xs",children:"تضمين الباركود"})]})]}),_&&(w.includeQR||w.includeBarcode)&&e.jsxs("div",{className:"mt-3 p-2 border rounded bg-muted/20",children:[e.jsx(Yr,{className:"text-xs font-medium",children:"معاينة:"}),e.jsxs("div",{className:"flex justify-center gap-4 mt-2",children:[w.includeQR&&e.jsxs("div",{className:"text-center",children:[S?e.jsx("img",{src:S,alt:"QR Code",className:"w-16 h-16 mx-auto border"}):e.jsx("div",{className:"w-16 h-16 mx-auto border flex items-center justify-center bg-gray-100",children:e.jsx("span",{className:"text-xs",children:"QR"})}),e.jsx("p",{className:"text-xs mt-1",children:"QR Code"})]}),w.includeBarcode&&e.jsxs("div",{className:"text-center",children:[$?e.jsx("img",{src:$,alt:"Barcode",className:"h-8 mx-auto border",style:{width:"auto"}}):e.jsx("div",{className:"w-20 h-8 mx-auto border flex items-center justify-center bg-gray-100",children:e.jsx("span",{className:"text-xs",children:"|||"})}),e.jsx("p",{className:"text-xs mt-1",children:"باركود"})]})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Lr,{onClick:async()=>{if(h&&t)try{p(!0);const e=h.items.filter(e=>!e.id.startsWith("unpaid-")).map(async e=>{const t=r.find(t=>t.id===e.id);if(!t)return;let n=0,a={status:"completed",payment_date:(new Date).toISOString().split("T")[0],notes:`تم التأكيد عبر الفاتورة الشاملة - ${(new Date).toLocaleDateString("ar-SA")}`};return t.tooth_treatment_id?(n=t.treatment_total_cost||e.amount||0,a={...a,amount:n,treatment_total_paid:n,treatment_remaining_balance:0}):t.appointment_id?(n=t.appointment_total_cost||t.total_amount_due||e.amount||0,a={...a,amount:n,appointment_total_paid:n,appointment_remaining_balance:0,amount_paid:n,remaining_balance:0}):(n=t.total_amount_due||t.remaining_balance||e.amount||0,a={...a,amount:n,amount_paid:n,remaining_balance:0}),i(e.id,a)});await Promise.all(e),s({title:"تم بنجاح",description:`تم تأكيد ${e.length} دفعة كمكتملة وتحديث المبالغ المالية`,variant:"default"}),await F(),x(null),f(null),setTimeout(async()=>{try{await M()}catch(e){console.error("خطأ في التصدير التلقائي للـ PDF:",e)}},1e3)}catch(e){console.error("خطأ في تحديث المدفوعات:",e),s({title:"خطأ",description:"فشل في تحديث المدفوعات",variant:"destructive"})}finally{p(!1)}},disabled:u||!h||0===h.items.length,className:"w-full h-8 text-xs",variant:"default",children:[e.jsx(ns,{className:"w-3 h-3 mr-1"}),"تأكيد دفع الكل"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs(Lr,{onClick:async()=>{if(!h||!t)return;console.log("بدء الطباعة الحرارية..."),console.log("إعدادات الطباعة:",w),console.log("بيانات المريض:",t.full_name),console.log("ملخص المدفوعات:",h.final_total);let e=S,n=$;if(w.includeQR)try{const t=T();console.log("QR Code Data:",t),t&&(e=await at.toDataURL(t,{width:"a4"===w.printerType?120:80,margin:1,color:{dark:"#000000",light:"#FFFFFF"}}),console.log("QR Code تم توليده للطباعة:",e.substring(0,50)+"..."))}catch(s){console.error("خطأ في توليد QR Code للطباعة:",s)}if(w.includeBarcode)try{const e=document.createElement("canvas"),t=A();console.log("Barcode Data:",t),t&&(st(e,t,{format:"CODE128",width:"a4"===w.printerType?2:1,height:"a4"===w.printerType?50:30,displayValue:!0,fontSize:"a4"===w.printerType?12:8,margin:5}),n=e.toDataURL(),console.log("Barcode تم توليده للطباعة:",n.substring(0,50)+"..."))}catch(s){console.error("خطأ في توليد الباركود للطباعة:",s)}console.log("QR Code للطباعة:",e?"موجود":"غير موجود"),console.log("Barcode للطباعة:",n?"موجود":"غير موجود");const a=window.open("","_blank");if(a){const s=`INV-${Date.now().toString().slice(-6)}`,r=In((new Date).toISOString().split("T")[0]),i="a4"===w.printerType?"210mm":"58mm"===w.printerType?"58mm":"80mm",l="a4"===w.printerType?"200mm":"58mm"===w.printerType?"54mm":"76mm",o=`\n        <html>\n          <head>\n            <title>فاتورة المدفوعات المعلقة - ${s}</title>\n            <meta charset="UTF-8">\n            <style>\n              @page {\n                size: ${i} auto;\n                margin: 0;\n              }\n              body {\n                font-family: 'Courier New', monospace;\n                direction: rtl;\n                margin: 0;\n                padding: 2mm;\n                font-size: ${"a4"===w.printerType?"12px":"10px"};\n                line-height: 1.2;\n                color: #000;\n                background: white;\n                width: ${l};\n              }\n              .receipt {\n                width: 100%;\n                font-size: 10px;\n              }\n              .header {\n                text-align: center;\n                margin-bottom: 4px;\n                border-bottom: 1px solid #000;\n                padding-bottom: 2px;\n              }\n              .clinic-name {\n                font-size: 12px;\n                font-weight: bold;\n                margin-bottom: 1px;\n              }\n              .doctor-name {\n                font-size: 10px;\n                font-weight: bold;\n              }\n              .contact-info {\n                font-size: 8px;\n                margin: 1px 0;\n              }\n              .receipt-info {\n                margin: 3px 0;\n                font-size: 9px;\n              }\n              .patient-info {\n                margin: 3px 0;\n                padding: 2px 0;\n                border-top: 1px dashed #000;\n                border-bottom: 1px dashed #000;\n              }\n              .items {\n                margin: 3px 0;\n              }\n              .item {\n                margin: 2px 0;\n                padding: 1px 0;\n                border-bottom: 1px dotted #ccc;\n              }\n              .item-header {\n                font-weight: bold;\n                font-size: 9px;\n              }\n              .item-details {\n                font-size: 8px;\n                color: #666;\n                margin: 1px 0;\n              }\n              .item-amount {\n                text-align: left;\n                font-weight: bold;\n              }\n              .totals {\n                margin: 3px 0;\n                border-top: 1px solid #000;\n                padding-top: 2px;\n              }\n              .total-line {\n                display: flex;\n                justify-content: space-between;\n                margin: 1px 0;\n              }\n              .final-total {\n                font-weight: bold;\n                font-size: 11px;\n                border-top: 1px solid #000;\n                padding-top: 2px;\n                margin-top: 2px;\n              }\n              .footer {\n                text-align: center;\n                margin-top: 4px;\n                padding-top: 2px;\n                border-top: 1px dashed #000;\n                font-size: 8px;\n              }\n              .dashed-line {\n                border-top: 1px dashed #000;\n                margin: 2px 0;\n              }\n            </style>\n          </head>\n          <body>\n            <div class="receipt">\n              <div class="header">\n                ${w.includeLogo&&m?.clinic_logo?`\n                  <div style="text-align: center; margin-bottom: 5px;">\n                    <img src="${m.clinic_logo}" alt="شعار العيادة" style="width: ${"a4"===w.printerType?"60px":"40px"}; height: ${"a4"===w.printerType?"60px":"40px"}; border-radius: 50%; border: 1px solid #000;" />\n                  </div>\n                `:""}\n                <div class="clinic-name">${m?.clinic_name||"عيادة الأسنان"}</div>\n                <div class="doctor-name">د. ${m?.doctor_name||"اسم الطبيب"}</div>\n                <div class="contact-info">${m?.clinic_phone||"رقم الهاتف"}</div>\n                <div class="contact-info">${m?.clinic_address||"العنوان"}</div>\n              </div>\n\n              <div class="receipt-info">\n                <div><strong>فاتورة المدفوعات المعلقة</strong></div>\n                <div>رقم الفاتورة: ${s}</div>\n                <div>التاريخ: ${r}</div>\n              </div>\n\n              <div class="patient-info">\n                <div><strong>بيانات المريض:</strong></div>\n                <div>الاسم: ${t.full_name}</div>\n                <div>الهاتف: ${t.phone||"غير محدد"}</div>\n              </div>\n\n              <div class="items">\n                <div><strong>تفاصيل المدفوعات المعلقة:</strong></div>\n                ${h.items.map((e,t)=>`\n                  <div class="item">\n                    <div class="item-header">\n                      ${t+1}. ${e.appointment_title||e.treatment_type||e.description}\n                    </div>\n                    <div class="item-details">\n                      ${e.payment_date?`📅 تاريخ الدفعة: ${In(e.payment_date)}`:""}\n                      ${e.appointment_date?`<br>📅 تاريخ الموعد: ${In(e.appointment_date)}`:""}\n                      ${e.treatment_type?`<br>🔧 نوع العلاج: ${e.treatment_type}`:""}\n                      ${e.tooth_name?`<br>🦷 ${e.tooth_name} (${e.tooth_number})`:""}\n                      ${e.doctor_name?`<br>👨‍⚕️ الطبيب: ${e.doctor_name}`:""}\n                      ${e.notes?`<br>📝 ملاحظات: ${e.notes}`:""}\n                      ${e.payment_method?`<br>💳 طريقة الدفع: ${e.payment_method}`:""}\n                      ${e.discount_amount&&e.discount_amount>0?`<br><span style="color: #dc2626;">💰 خصم: ${Mn(e.discount_amount)}</span>`:""}\n                    </div>\n                    <div class="item-amount">${Mn(e.amount)}</div>\n                  </div>\n                `).join("")}\n              </div>\n\n              \x3c!-- تفاصيل إضافية للفاتورة --\x3e\n              <div class="invoice-details" style="margin: 10px 0; padding: 5px 0; border-top: 1px dashed #000;">\n                <div style="font-size: 9px; color: #666;">\n                  <div>📊 إجمالي العناصر: ${h.items.length}</div>\n                  <div>📅 فترة الفاتورة: ${In(h.date_range.from)} - ${In(h.date_range.to)}</div>\n                  ${b.discount_reason?`<div>💸 سبب الخصم: ${b.discount_reason}</div>`:""}\n                  ${b.notes?`<div>📝 ملاحظات: ${b.notes}</div>`:""}\n                </div>\n              </div>\n\n              <div class="totals">\n                <div class="total-line">\n                  <span>المجموع الفرعي:</span>\n                  <span>${Mn(h.subtotal)}</span>\n                </div>\n                ${h.total_discount>0?`\n                  <div class="total-line">\n                    <span>الخصم:</span>\n                    <span>-${Mn(h.total_discount)}</span>\n                  </div>\n                `:""}\n                ${h.total_tax>0?`\n                  <div class="total-line">\n                    <span>الضريبة:</span>\n                    <span>+${Mn(h.total_tax)}</span>\n                  </div>\n                `:""}\n                <div class="total-line final-total">\n                  <span>المجموع النهائي:</span>\n                  <span>${Mn(h.final_total)}</span>\n                </div>\n              </div>\n\n              ${w.includeQR?`\n                <div style="text-align: center; margin: 10px 0; border-top: 1px dashed #000; padding-top: 5px;">\n                  ${e?`\n                    <img src="${e}" alt="QR Code" style="width: ${"a4"===w.printerType?"80px":"60px"}; height: ${"a4"===w.printerType?"80px":"60px"}; margin: 0 auto;" />\n                    <div style="font-size: 8px; color: #666; margin-top: 2px;">امسح للتحقق من الفاتورة الكاملة</div>\n                    <div style="font-size: 7px; color: #999; margin-top: 1px;">\n                      يحتوي على: تفاصيل العيادة | بيانات المريض | ${h.items.length} عنصر | المبلغ الإجمالي\n                    </div>\n                    <div style="font-size: 7px; color: #999; margin-top: 1px;">\n                      رقم الفاتورة: ${A()}\n                    </div>\n                  `:`\n                    <div style="border: 1px solid #000; width: ${"a4"===w.printerType?"80px":"60px"}; height: ${"a4"===w.printerType?"80px":"60px"}; margin: 0 auto; display: flex; align-items: center; justify-content: center;">\n                      <div style="font-size: 8px; text-align: center;">QR Code<br/>غير متوفر</div>\n                    </div>\n                  `}\n                </div>\n              `:""}\n\n              ${w.includeBarcode?`\n                <div style="text-align: center; margin: 5px 0;">\n                  ${n?`\n                    <img src="${n}" alt="باركود الفاتورة" style="width: ${"a4"===w.printerType?"120px":"100px"}; height: ${"a4"===w.printerType?"30px":"20px"}; margin: 0 auto;" />\n                    <div style="font-size: 8px; color: #666; margin-top: 2px;">${A()}</div>\n                    <div style="font-size: 7px; color: #999; margin-top: 1px;">\n                      المريض: ${t.id.toString().padStart(4,"0")} | العناصر: ${h.items.length.toString().padStart(2,"0")} | المبلغ: ${Math.round(h.final_total).toString().padStart(6,"0")}\n                    </div>\n                  `:`\n                    <div style="border: 1px solid #000; width: ${"a4"===w.printerType?"120px":"100px"}; height: ${"a4"===w.printerType?"30px":"20px"}; margin: 0 auto; display: flex; align-items: center; justify-content: center;">\n                      <div style="font-size: 8px;">باركود غير متوفر</div>\n                    </div>\n                  `}\n                </div>\n              `:""}\n\n              <div class="footer">\n                <div>شكراً لثقتكم بنا</div>\n                <div class="dashed-line"></div>\n                <div>تم الطباعة: ${(new Date).toLocaleString("ar-EG")}</div>\n              </div>\n            </div>\n          </body>\n        </html>\n      `;a.document.write(o),a.document.close(),a.onload=()=>{setTimeout(()=>{a.print()},1e3)},setTimeout(()=>{a.print()},2e3)}},disabled:!h,variant:"outline",className:"h-8 text-xs",children:[e.jsx(Qs,{className:"w-3 h-3 mr-1"}),"طباعة حرارية"]}),e.jsxs(Lr,{onClick:async()=>{if(!h||!t)return;let e=t.phone||"";if(e=e.replace(/\D/g,""),!e)return void s({title:"خطأ",description:"رقم هاتف المريض غير متوفر",variant:"destructive"});e.startsWith("963")||(e="963"+e);const n=m?.clinic_name||"عيادة الأسنان",a=m?.doctor_name||"الطبيب",r=`INV-${Date.now().toString().slice(-6)}`,i=In((new Date).toISOString().split("T")[0]);let l=`🏥 *${n}*\n`;l+=`👨‍⚕️ د. ${a}\n\n`,l+="📋 *فاتورة المدفوعات المعلقة*\n",l+=`🔢 رقم الفاتورة: ${r}\n`,l+=`📅 التاريخ: ${i}\n\n`,l+="👤 *بيانات المريض:*\n",l+=`الاسم: ${t.full_name}\n\n`,l+="💰 *تفاصيل المدفوعات المعلقة:*\n",h.items.forEach((e,t)=>{l+=`\n${t+1}. ${e.appointment_title||e.treatment_type||e.description}\n`,e.payment_date&&(l+=`   📅 تاريخ الدفعة: ${In(e.payment_date)}\n`),e.appointment_date&&(l+=`   📅 تاريخ الموعد: ${In(e.appointment_date)}\n`),e.treatment_type&&(l+=`   🔧 ${e.treatment_type}\n`),e.tooth_name&&(l+=`   🦷 ${e.tooth_name} (${e.tooth_number})\n`),l+=`   💵 ${Mn(e.amount)}\n`}),l+="\n📊 *ملخص المبالغ:*\n",l+=`المجموع الفرعي: ${Mn(h.subtotal)}\n`,h.total_discount>0&&(l+=`الخصم: -${Mn(h.total_discount)}\n`),h.total_tax>0&&(l+=`الضريبة: +${Mn(h.total_tax)}\n`),l+=`*المجموع النهائي: ${Mn(h.final_total)}*\n\n`,l+="🙏 شكراً لثقتكم بنا";const o=`https://wa.me/${e}?text=${encodeURIComponent(l)}`;try{if(window.electronAPI&&window.electronAPI.system&&window.electronAPI.system.openExternal)return await window.electronAPI.system.openExternal(o),void s({title:"تم بنجاح",description:"تم فتح الواتساب خارجياً لإرسال الفاتورة",variant:"default"})}catch(c){console.log("Method 1 failed:",c)}try{if(window.electronAPI)return await(window.electronAPI.shell?.openExternal?.(o)),void s({title:"تم بنجاح",description:"تم فتح الواتساب خارجياً لإرسال الفاتورة",variant:"default"})}catch(c){console.log("Method 2 failed:",c)}window.open(o,"_blank","noopener,noreferrer"),s({title:"تم بنجاح",description:"تم فتح الواتساب في المتصفح لإرسال الفاتورة",variant:"default"})},disabled:!h,variant:"outline",className:"h-8 text-xs",children:[e.jsx(Os,{className:"w-3 h-3 mr-1"}),"واتساب"]})]}),e.jsxs(Lr,{onClick:M,disabled:!h,variant:"outline",className:"w-full h-8 text-xs",children:[e.jsx(fs,{className:"w-3 h-3 mr-1"}),"تصدير PDF"]})]})]}),e.jsx("div",{className:"col-span-9 overflow-y-auto",children:u?e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"جاري تحميل المدفوعات المعلقة..."}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"يرجى الانتظار"})]})}):h?e.jsxs("div",{ref:E,className:"space-y-4 p-4",children:[e.jsxs("div",{className:"text-center border-b pb-3",children:[e.jsx("h2",{className:"text-xl font-bold",children:"فاتورة المدفوعات المعلقة الشاملة"}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsxs("span",{children:["رقم الفاتورة: ",g?.invoice_number]}),e.jsxs("span",{children:["تاريخ الإصدار: ",In(g?.invoice_date||"")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"معلومات المريض"}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"الاسم:"})," ",t.full_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"الهاتف:"})," ",t.phone]}),t.email&&e.jsxs("p",{children:[e.jsx("strong",{children:"الإيميل:"})," ",t.email]})]})]}),e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"معلومات العيادة"}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"اسم العيادة:"})," ",m.clinic_name]}),m.clinic_phone&&e.jsxs("p",{children:[e.jsx("strong",{children:"الهاتف:"})," ",m.clinic_phone]}),m.clinic_address&&e.jsxs("p",{children:[e.jsx("strong",{children:"العنوان:"})," ",m.clinic_address]})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",children:"تفاصيل المدفوعات المعلقة الشاملة"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(oc,{variant:"secondary",className:"text-xs",children:[h.total_items," عنصر"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[In(h.date_range.from)," - ",In(h.date_range.to)]})]})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:h.items.map((t,n)=>{let a="عام",s="💰",r="دفعة معلقة",i=t.description;return i&&(i=i.replace(/\[علاج:[^\]]+\]/g,"").trim(),i=i.replace(/^\s*-\s*/,"").trim()),t.tooth_treatment_id?(a="علاج",s="🦷",r=t.treatment_type||i||"علاج سن"):t.appointment_id?(a="موعد",s="📅",r=t.appointment_title||i||"موعد طبي"):r=i||"دفعة معلقة",e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded text-xs",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"font-medium text-xs",children:[n+1,"."]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs(oc,{variant:"علاج"===a?"default":"موعد"===a?"secondary":"outline",className:"text-xs px-1 py-0",children:[s," ",a]}),e.jsx("p",{className:"font-medium text-sm",children:r})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 space-y-0.5",children:[t.payment_date&&e.jsxs("p",{children:["📅 تاريخ الدفعة: ",In(t.payment_date)]}),t.appointment_date&&e.jsxs("p",{children:["📅 تاريخ الموعد: ",In(t.appointment_date)]}),t.tooth_name&&e.jsxs("p",{children:["🦷 ",t.tooth_name," (سن #",t.tooth_number,")"]}),t.treatment_type&&"علاج"===a&&e.jsxs("p",{children:["🔧 نوع العلاج: ",t.treatment_type]}),t.doctor_name&&e.jsxs("p",{children:["👨‍⚕️ الطبيب: ",t.doctor_name]}),t.notes&&e.jsxs("p",{children:["📝 ملاحظات: ",t.notes]})]})]})]})}),e.jsxs("div",{className:"text-left ml-2",children:[e.jsx("p",{className:"font-bold text-sm",children:Mn(t.amount)}),t.discount_amount&&t.discount_amount>0&&e.jsxs("p",{className:"text-xs text-red-600",children:["خصم: ",Mn(t.discount_amount)]}),"علاج"===a&&t.treatment_remaining_balance&&t.treatment_remaining_balance>0&&e.jsxs("p",{className:"text-xs text-orange-600",children:["متبقي: ",Mn(t.treatment_remaining_balance)]})]})]},t.id)})})]}),e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("h3",{className:"text-sm font-medium mb-3 flex items-center gap-1",children:[e.jsx(gs,{className:"w-4 h-4"}),"ملخص المبالغ"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"المجموع الفرعي:"}),e.jsx("span",{className:"font-medium",children:Mn(h.subtotal)})]}),h.total_discount>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsxs("span",{children:["الخصم (","percentage"===b.discount_type?`${b.discount_value}%`:"مبلغ ثابت","):"]}),e.jsxs("span",{className:"font-medium",children:["-",Mn(h.total_discount)]})]}),h.total_tax>0&&e.jsxs("div",{className:"flex justify-between text-blue-600",children:[e.jsxs("span",{children:["الضريبة (",b.tax_rate,"%):"]}),e.jsxs("span",{className:"font-medium",children:["+",Mn(h.total_tax)]})]}),e.jsx(Wh,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"المجموع النهائي:"}),e.jsx("span",{className:"text-primary",children:Mn(h.final_total)})]})]})]}),b.footer_notes&&e.jsx("div",{className:"border rounded-lg p-3",children:e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:b.footer_notes})})]}):e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsxs("div",{className:"text-center",children:[e.jsx(qa,{className:"w-12 h-12 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground mb-2",children:"لا توجد مدفوعات معلقة للمريض"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"جرب تغيير فلتر التاريخ أو تفعيل خيارات إضافية"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("p",{children:'• تأكد من وجود مدفوعات بحالة "معلق" للمريض'}),e.jsx("p",{children:"• جرب توسيع نطاق التاريخ"}),e.jsx("p",{children:'• فعل خيار "المواعيد غير المدفوعة" أو "العلاجات غير المدفوعة"'})]})]})})})]})]})}):null}function bf({patient:t,open:n,onOpenChange:a,onEdit:s,onNavigateToTreatments:r,onNavigateToPayments:i}){const[l,o]=re.useState("info"),[c,d]=re.useState([]),[m,u]=re.useState([]),[p,h]=re.useState([]),[x,g]=re.useState([]),[f,v]=re.useState([]),[y,b]=re.useState(!1),[j,w]=re.useState(!1),[N,_]=re.useState(!1),[k,S]=re.useState(!1),[C,$]=re.useState(!1),[D,E]=re.useState(!1),[T,A]=re.useState(!1),[F,P]=re.useState(!1),{appointments:R}=Jn(),{payments:O}=ca(),{toothTreatments:M,loadToothTreatmentsByPatient:L}=cc(),{toast:I}=Bl(),{settings:z}=ta(),{refreshTreatmentNames:B}=Ma();if(re.useEffect(()=>{if(t&&n){b(!0);const e=R.filter(e=>e.patient_id===t.id);d(e),b(!1),w(!0);const n=O.filter(e=>e.patient_id===t.id);u(n),w(!1),_(!0),L(t.id).then(()=>{const{toothTreatments:e}=cc.getState(),n=e.filter(e=>e.patient_id===t.id);h(n),_(!1),B()}).catch(()=>{_(!1)}),S(!0),window.electronAPI?.prescriptions?.getByPatient?.(t.id).then(e=>{g(e||[]),S(!1)}).catch(e=>{console.error("Error loading prescriptions:",e),S(!1)}),window.electronAPI?.labOrders?.getByPatient?.(t.id).then(e=>{v(e||[])}).catch(()=>{console.error("خطأ في تحميل طلبات المختبر")})}},[t,n,R,O,L]),!t)return null;const V=()=>{t&&r&&(a(!1),r("dental-treatments"),localStorage.setItem("selectedPatientForTreatment",JSON.stringify({selectedPatientId:t.id,patientName:t.full_name,showAddTreatmentGuidance:!0})))};return e.jsxs(Sr,{open:n,onOpenChange:a,children:[e.jsxs(Dr,{className:"max-w-4xl max-h-[90vh] overflow-hidden",dir:"rtl",children:[e.jsx(Er,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs(Ar,{className:"text-xl arabic-enhanced text-right",children:["تفاصيل المريض - ",t.full_name]}),e.jsx(Fr,{className:"arabic-enhanced text-right",children:"معلومات شاملة عن المريض وسجلاته الطبية"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{if(t)try{I({title:"جاري إعداد التقرير...",description:"يتم تجميع بيانات المريض وإعداد التقرير للطباعة"});const e=await uf.getPatientIntegratedData(t.id);if(!e)throw new Error("لا يمكن جلب بيانات المريض");await yh.exportIndividualPatientRecord(e,z),I({title:"تم إنشاء التقرير بنجاح",description:`تم إنشاء سجل المريض ${t.full_name} وحفظه كملف PDF`})}catch(e){console.error("Error printing patient record:",e),I({title:"خطأ في إنشاء التقرير",description:"فشل في إنشاء سجل المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},className:"flex items-center gap-2 text-green-600 hover:text-green-700 hover:bg-green-50",children:[e.jsx(Qs,{className:"w-4 h-4"}),"طباعة السجل"]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:()=>P(!0),className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(bs,{className:"w-4 h-4"}),"فاتورة المعلقات"]}),s&&e.jsxs(Lr,{variant:"outline",size:"sm",onClick:()=>s(t),className:"flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4"}),"تعديل"]})]})]})}),e.jsxs(Ud,{value:l,onValueChange:o,className:"flex-1 overflow-hidden",dir:"rtl",children:[e.jsxs(Hd,{className:"grid w-full grid-cols-5 rtl-tabs",dir:"rtl",children:[e.jsxs(Gd,{value:"info",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[e.jsx(yr,{className:"w-4 h-4"}),"معلومات المريض"]}),e.jsxs(Gd,{value:"treatments",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[e.jsx(Va,{className:"w-4 h-4"}),"العلاجات (",p.length,")"]}),e.jsxs(Gd,{value:"appointments",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[e.jsx(es,{className:"w-4 h-4"}),"المواعيد (",c.length,")"]}),e.jsxs(Gd,{value:"payments",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[e.jsx(gs,{className:"w-4 h-4"}),"المدفوعات (",m.length,")"]}),e.jsxs(Gd,{value:"prescriptions",className:"arabic-enhanced flex items-center justify-center gap-2 flex-row-reverse",children:[e.jsx(bs,{className:"w-4 h-4"}),"الوصفات (",x.length,")"]})]}),e.jsxs("div",{className:"mt-4 overflow-y-auto max-h-[calc(90vh-200px)] dialog-rtl",dir:"rtl",children:[e.jsx(Wd,{value:"info",className:"space-y-4 dialog-rtl",dir:"rtl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",dir:"rtl",children:[e.jsxs(nc,{className:"card-rtl",children:[e.jsx(ac,{className:"card-header",children:e.jsxs(sc,{className:"flex items-center gap-2 text-right",children:[e.jsx(yr,{className:"w-5 h-5"}),"المعلومات الأساسية"]})}),e.jsxs(ic,{className:"space-y-3 card-content",dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(oc,{variant:"outline",children:["#",t.serial_number]}),e.jsx("span",{className:"text-muted-foreground",children:"#:"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:t.full_name}),e.jsx("span",{className:"text-muted-foreground",children:"الاسم الكامل:"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(oc,{variant:"male"===t.gender?"default":"secondary",children:"male"===t.gender?"ذكر":"أنثى"}),e.jsx("span",{className:"text-muted-foreground",children:"الجنس:"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[t.age," سنة"]}),e.jsx("span",{className:"text-muted-foreground",children:"العمر:"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:In(t.date_added||t.created_at)}),e.jsx("span",{className:"text-muted-foreground",children:"تاريخ الإضافة:"})]})]})]}),e.jsxs(nc,{className:"card-rtl",children:[e.jsx(ac,{className:"card-header",children:e.jsxs(sc,{className:"flex items-center gap-2 text-right",children:[e.jsx(Hs,{className:"w-5 h-5"}),"معلومات الاتصال"]})}),e.jsxs(ic,{className:"space-y-3 card-content",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[t.phone?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t.phone}),e.jsx(Hs,{className:"w-4 h-4 text-muted-foreground"})]}):e.jsx("span",{className:"text-muted-foreground",children:"غير محدد"}),e.jsx("span",{className:"text-muted-foreground",children:"رقم الهاتف:"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[t.email?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:t.email}),e.jsx(Ps,{className:"w-4 h-4 text-muted-foreground"})]}):e.jsx("span",{className:"text-muted-foreground",children:"غير محدد"}),e.jsx("span",{className:"text-muted-foreground",children:"البريد الإلكتروني:"})]}),e.jsxs("div",{className:"flex items-start justify-between",children:[t.address?e.jsxs("div",{className:"flex items-start gap-2 max-w-[200px]",children:[e.jsx("span",{className:"text-sm text-right",children:t.address}),e.jsx(Rs,{className:"w-4 h-4 text-muted-foreground mt-0.5"})]}):e.jsx("span",{className:"text-muted-foreground",children:"غير محدد"}),e.jsx("span",{className:"text-muted-foreground",children:"العنوان:"})]})]})]}),e.jsxs(nc,{className:"md:col-span-2 card-rtl",children:[e.jsx(ac,{className:"card-header",children:e.jsxs(sc,{className:"flex items-center gap-2 text-right",children:[e.jsx(_s,{className:"w-5 h-5"}),"المعلومات الطبية"]})}),e.jsxs(ic,{className:"space-y-4 card-content",dir:"rtl",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-right",children:[e.jsx(bs,{className:"w-4 h-4"}),"حالة المريض"]}),e.jsx("p",{className:"text-sm bg-muted p-3 rounded-md text-right",children:t.patient_condition})]}),t.allergies&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-orange-600 dark:text-orange-400 text-right",children:[e.jsx(qa,{className:"w-4 h-4"}),"الحساسية"]}),e.jsx("div",{className:"text-sm bg-orange-50 dark:bg-yellow-900 border border-orange-200 dark:border-yellow-600 p-3 rounded-md text-orange-900 dark:text-yellow-100 text-right",children:t.allergies})]}),t.medical_conditions&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-right",children:[e.jsx(_s,{className:"w-4 h-4"}),"الحالات الطبية"]}),e.jsx("p",{className:"text-sm bg-muted p-3 rounded-md text-right",children:t.medical_conditions})]}),t.notes&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-right",children:[e.jsx(bs,{className:"w-4 h-4"}),"ملاحظات إضافية"]}),e.jsx("p",{className:"text-sm bg-muted p-3 rounded-md text-right",children:t.notes})]})]})]})]})}),e.jsxs(Wd,{value:"treatments",className:"space-y-4 dialog-rtl",dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-medium",children:"العلاجات السنية"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Lr,{onClick:async()=>{if(t)try{I({title:"جاري إعداد تقرير العلاجات...",description:"يتم تجميع بيانات علاجات المريض وإعداد التقرير للطباعة"});const e=await uf.getPatientIntegratedData(t.id);if(!e)throw new Error("لا يمكن جلب بيانات المريض");await yh.exportPatientTreatments(e,z),I({title:"تم إنشاء تقرير العلاجات بنجاح",description:`تم إنشاء تقرير علاجات المريض ${t.full_name} وحفظه كملف PDF`})}catch(e){console.error("Error printing patient treatments:",e),I({title:"خطأ في إنشاء تقرير العلاجات",description:"فشل في إنشاء تقرير علاجات المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Qs,{className:"w-4 h-4"}),"طباعة العلاجات"]}),e.jsxs(Lr,{onClick:V,className:"flex items-center gap-2",size:"sm",children:[e.jsx(Zs,{className:"w-4 h-4"}),"إضافة علاج"]})]})]}),N?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"loading-spinner"})}):0===p.length?e.jsx(nc,{className:"card-rtl",children:e.jsx(ic,{className:"pt-6 card-content",dir:"rtl",children:e.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[e.jsx(Va,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد علاجات"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم تسجيل أي علاجات سنية لهذا المريض بعد"}),e.jsxs(Lr,{onClick:V,className:"flex items-center gap-2",size:"sm",children:[e.jsx(Zs,{className:"w-4 h-4"}),"إضافة أول علاج"]})]})})}):e.jsxs(nc,{className:"card-rtl",children:[e.jsx(ac,{className:"card-header",children:e.jsxs(sc,{className:"flex items-center gap-2 text-foreground text-right",children:[e.jsx(Va,{className:"w-5 h-5"}),"جدول العلاجات"]})}),e.jsxs(ic,{className:"card-content",dir:"rtl",children:[e.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"رقم السن"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"اسم السن"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"العلاج الحالي"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التكلفة"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"الحالة"})]})}),e.jsx("tbody",{className:"bg-background divide-y divide-border",children:p.map((t,n)=>{const a=(e=>{const t=Ca.find(t=>t.value===e);if(t){const n={planned:"outline",in_progress:"secondary",completed:"default",cancelled:"destructive"};return{label:t.label,variant:n[e]||"outline"}}return{label:e,variant:"outline"}})(t.treatment_status);return e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:n+1}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:t.tooth_number}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:t.tooth_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-foreground",children:ka(t.treatment_type)||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:t.cost?e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:Mn(t.cost)}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(oc,{variant:a.variant,children:a.label})})]},t.id)})})]})}),p.some(e=>e.notes)&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"تفاصيل إضافية:"}),p.map(t=>t.notes&&e.jsxs("div",{className:"p-3 bg-muted/30 rounded border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-medium text-foreground",children:["السن رقم ",t.tooth_number," - ",t.tooth_name]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:In(t.created_at)})]}),t.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"ملاحظات: "}),e.jsx("span",{className:"text-xs text-foreground",children:t.notes})]})]},`details-${t.id}`))]})]})]})]}),e.jsxs(Wd,{value:"appointments",className:"space-y-4 dialog-rtl",dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-medium",children:"المواعيد"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Lr,{onClick:async()=>{if(t)try{I({title:"جاري إعداد تقرير المواعيد...",description:"يتم تجميع بيانات مواعيد المريض وإعداد التقرير للطباعة"});const e=await uf.getPatientIntegratedData(t.id);if(!e)throw new Error("لا يمكن جلب بيانات المريض");await yh.exportPatientAppointments(e,z),I({title:"تم إنشاء تقرير المواعيد بنجاح",description:`تم إنشاء تقرير مواعيد المريض ${t.full_name} وحفظه كملف PDF`})}catch(e){console.error("Error printing patient appointments:",e),I({title:"خطأ في إنشاء تقرير المواعيد",description:"فشل في إنشاء تقرير مواعيد المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Qs,{className:"w-4 h-4"}),"طباعة المواعيد"]}),e.jsxs(Lr,{onClick:()=>{$(!0)},className:"flex items-center gap-2",size:"sm",children:[e.jsx(Zs,{className:"w-4 h-4"}),"إضافة موعد"]})]})]}),y?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"loading-spinner"})}):0===c.length?e.jsx(nc,{className:"card-rtl",children:e.jsx(ic,{className:"pt-6 card-content",dir:"rtl",children:e.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[e.jsx(es,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد مواعيد"}),e.jsx("p",{className:"text-muted-foreground",children:"لم يتم تحديد أي مواعيد لهذا المريض بعد"})]})})}):e.jsxs(nc,{className:"card-rtl",children:[e.jsx(ac,{className:"card-header",children:e.jsxs(sc,{className:"flex items-center gap-2 text-foreground text-right",children:[e.jsx(es,{className:"w-5 h-5"}),"جدول المواعيد"]})}),e.jsxs(ic,{className:"card-content",dir:"rtl",children:[e.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التاريخ"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"الوقت"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التكلفة"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"الحالة"})]})}),e.jsx("tbody",{className:"bg-background divide-y divide-border",children:c.map((t,n)=>{const a=(e=>({scheduled:{label:"مجدول",variant:"default"},completed:{label:"مكتمل",variant:"default"},cancelled:{label:"ملغي",variant:"destructive"},no_show:{label:"لم يحضر",variant:"secondary"}}[e]||{label:e,variant:"outline"}))(t.status);return e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:n+1}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:t.title}),e.jsx("td",{className:"px-4 py-3 text-sm text-foreground",children:In(t.start_time)}),e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:new Date(t.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:t.cost?e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:Mn(t.cost)}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(oc,{variant:a.variant,children:a.label})})]},t.id)})})]})}),c.some(e=>e.description)&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"تفاصيل إضافية:"}),c.map(t=>t.description&&e.jsxs("div",{className:"p-3 bg-muted/30 rounded border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-foreground",children:t.title}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[In(t.start_time)," - ",new Date(t.start_time).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"الوصف: "}),e.jsx("span",{className:"text-xs text-foreground",children:t.description})]})]},`desc-${t.id}`))]})]})]})]}),e.jsxs(Wd,{value:"payments",className:"space-y-4 dialog-rtl",dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-medium",children:"المدفوعات"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Lr,{onClick:async()=>{if(t)try{I({title:"جاري إعداد تقرير المدفوعات...",description:"يتم تجميع بيانات مدفوعات المريض وإعداد التقرير للطباعة"});const e=await uf.getPatientIntegratedData(t.id);if(!e)throw new Error("لا يمكن جلب بيانات المريض");await yh.exportPatientPayments(e,z),I({title:"تم إنشاء تقرير المدفوعات بنجاح",description:`تم إنشاء تقرير مدفوعات المريض ${t.full_name} وحفظه كملف PDF`})}catch(e){console.error("Error printing patient payments:",e),I({title:"خطأ في إنشاء تقرير المدفوعات",description:"فشل في إنشاء تقرير مدفوعات المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Qs,{className:"w-4 h-4"}),"طباعة المدفوعات"]}),e.jsxs(Lr,{onClick:()=>{t&&i?(a(!1),i("payments"),localStorage.setItem("selectedPatientForPayment",JSON.stringify({selectedPatientId:t.id,patientName:t.full_name,openAddDialog:!0}))):E(!0)},className:"flex items-center gap-2",size:"sm",children:[e.jsx(Zs,{className:"w-4 h-4"}),"إضافة دفعة"]})]})]}),j?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"loading-spinner"})}):0===m.length?e.jsx(nc,{className:"card-rtl",children:e.jsx(ic,{className:"pt-6 card-content",dir:"rtl",children:e.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[e.jsx(gs,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد مدفوعات"}),e.jsx("p",{className:"text-muted-foreground",children:"لم يتم تسجيل أي مدفوعات لهذا المريض بعد"})]})})}):e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[(()=>{!function(e,t,n){const a=t.filter(t=>t.patient_id===e),s=n.filter(t=>t.patient_id===e);let r=0,i=0;s.forEach(e=>{if(e.cost){const t=hf(e.id,e.cost,a);i+=e.cost,r+=t.totalPaid}}),a.filter(e=>!e.appointment_id&&("partial"===e.status||"completed"===e.status)).forEach(e=>{r+=e.amount,e.total_amount_due&&(i+=e.total_amount_due)});let l=0;s.forEach(e=>{if(e.cost){const t=a.filter(t=>t.appointment_id===e.id&&"partial"===t.status);if(t.length>0){const n=t.reduce((e,t)=>e+t.amount,0);l+=Math.max(0,e.cost-n)}}}),a.filter(e=>!e.appointment_id&&"partial"===e.status).forEach(e=>{e.total_amount_due&&e.amount&&(l+=Math.max(0,e.total_amount_due-e.amount))});const o=a.filter(e=>e.tooth_treatment_id&&"partial"===e.status),c={};o.forEach(e=>{c[e.tooth_treatment_id]||(c[e.tooth_treatment_id]=[]),c[e.tooth_treatment_id].push(e)}),Object.values(c).forEach(e=>{const t=e.reduce((e,t)=>e+t.amount,0),n=e[0].treatment_total_cost||0;n>0&&(l+=Math.max(0,n-t))}),s.length,a.length,s.filter(e=>!!e.cost&&"completed"===hf(e.id,e.cost,a).status).length}(t.id,O,R);const n=m.filter(e=>e.tooth_treatment_id),a=m.filter(e=>e.appointment_id&&!e.tooth_treatment_id),s=m.filter(e=>!e.appointment_id&&!e.tooth_treatment_id),r=n.reduce((e,t)=>e+(t.treatment_total_cost||0),0),i=n.reduce((e,t)=>e+t.amount,0),l=n.reduce((e,t)=>e+(t.treatment_remaining_balance||0),0),o=a.reduce((e,t)=>e+(t.appointment_total_cost||0),0),c=a.reduce((e,t)=>e+t.amount,0),d=a.reduce((e,t)=>e+(t.appointment_remaining_balance||0),0),u=s.reduce((e,t)=>e+(t.total_amount_due||0),0),p=s.reduce((e,t)=>e+t.amount,0),h=s.reduce((e,t)=>e+(t.remaining_balance||0),0),x=r+o+u,g=i+c+p,f=l+d+h,v=m.filter(e=>"pending"===e.status),y=m.filter(e=>"partial"===e.status),b=m.filter(e=>"completed"===e.status);return e.jsxs(nc,{className:"bg-gradient-to-r from-primary/5 to-primary/10 border-border card-rtl",children:[e.jsx(ac,{className:"card-header",children:e.jsxs(sc,{className:"flex items-center gap-2 text-primary text-right",children:[e.jsx(gs,{className:"w-5 h-5"}),"ملخص المدفوعات الشامل"]})}),e.jsx(ic,{className:"card-content",dir:"rtl",children:e.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"البيان"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"المبلغ"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-muted-foreground",children:"التفاصيل"})]})}),e.jsxs("tbody",{className:"bg-background divide-y divide-border",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:"الإجمالي المطلوب"}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-blue-600 dark:text-blue-400",children:Mn(x)}),e.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["علاجات: ",Mn(r)," | مواعيد: ",Mn(o)," | عام: ",Mn(u)]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:"المبلغ المدفوع"}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-green-600 dark:text-green-400",children:Mn(g)}),e.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["علاجات: ",Mn(i)," | مواعيد: ",Mn(c)," | عام: ",Mn(p)]})]}),e.jsxs("tr",{className:"bg-muted/50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-foreground",children:"المبلغ المتبقي"}),e.jsxs("td",{className:"px-4 py-3 text-sm font-bold",children:[e.jsx("span",{className:f>0?"text-destructive":"text-green-600 dark:text-green-400",children:Mn(f)}),0===f&&e.jsx("span",{className:"mr-2 text-xs text-green-600 dark:text-green-400",children:"✓ مكتمل"})]}),e.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["علاجات: ",Mn(l)," | مواعيد: ",Mn(d)," | عام: ",Mn(h)]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:"حالات الدفع"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(oc,{variant:"secondary",className:"text-xs",children:["مكتمل: ",b.length]}),e.jsxs(oc,{variant:"outline",className:"text-xs",children:["جزئي: ",y.length]}),e.jsxs(oc,{variant:"destructive",className:"text-xs",children:["معلق: ",v.length]})]})}),e.jsxs("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:["إجمالي المدفوعات: ",m.length]})]})]})]})})})]})})(),e.jsxs(nc,{className:"card-rtl",children:[e.jsx(ac,{className:"card-header",children:e.jsxs(sc,{className:"flex items-center gap-2 text-foreground text-right",children:[e.jsx(gs,{className:"w-5 h-5"}),"تفاصيل المدفوعات الشاملة"]})}),e.jsxs(ic,{className:"card-content",dir:"rtl",children:[e.jsx("div",{className:"overflow-hidden rounded-lg border border-border",dir:"rtl",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"#"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"النوع"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"التفاصيل"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"تاريخ الدفع"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"المبلغ المدفوع"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"الإجمالي المطلوب"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"المتبقي"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"طريقة الدفع"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-muted-foreground",children:"الحالة"})]})}),e.jsx("tbody",{className:"bg-background divide-y divide-border",children:m.map((t,n)=>{const a=(e=>({completed:{label:"مكتمل",variant:"default"},partial:{label:"جزئي",variant:"outline"},pending:{label:"معلق",variant:"secondary"}}[e]||{label:e,variant:"outline"}))(t.status);let s="عام",r=t.description||"دفعة عامة",i=t.total_amount_due||0,l=t.remaining_balance||0;t.description&&(r=t.description.replace(/\[علاج:[^\]]+\]/g,"").trim(),r=r.replace(/^\s*-\s*/,"").trim());let o=t.notes;if(o&&(o=o.replace(/\[علاج:[^\]]+\]/g,"").trim(),o=o.replace(/^\s*-\s*/,"").trim()),t.tooth_treatment_id){s="علاج";const e=t.tooth_treatment?.treatment_type?ka(t.tooth_treatment.treatment_type):"علاج سن";r&&"دفعة عامة"!==r||(r=e),t.tooth_treatment?.tooth_name&&(r+=` - ${t.tooth_treatment.tooth_name}`),i=t.treatment_total_cost||0,l=t.treatment_remaining_balance||0}else t.appointment_id&&(s="موعد",r=t.appointment?.title||r||"موعد طبي",i=t.appointment_total_cost||t.total_amount_due||0,l=t.appointment_remaining_balance||t.remaining_balance||0);return e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-3 py-2 text-xs text-foreground",children:n+1}),e.jsx("td",{className:"px-3 py-2 text-xs",children:e.jsx(oc,{variant:"علاج"===s?"default":"موعد"===s?"secondary":"outline",className:"text-xs",children:s})}),e.jsxs("td",{className:"px-3 py-2 text-xs text-foreground max-w-32",children:[e.jsx("div",{className:"truncate",title:r,children:r}),t.tooth_treatment?.tooth_number&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["سن #",t.tooth_treatment.tooth_number]})]}),e.jsx("td",{className:"px-3 py-2 text-xs text-foreground",children:In(t.payment_date)}),e.jsx("td",{className:"px-3 py-2 text-xs font-bold text-green-600 dark:text-green-400",children:Mn(t.amount)}),e.jsx("td",{className:"px-3 py-2 text-xs text-foreground",children:i>0?Mn(i):"-"}),e.jsx("td",{className:"px-3 py-2 text-xs font-medium",children:void 0!==l?e.jsx("span",{className:l>0?"text-destructive":"text-green-600 dark:text-green-400",children:Mn(l)}):"-"}),e.jsx("td",{className:"px-3 py-2 text-xs text-muted-foreground",children:"cash"===t.payment_method?"نقداً":"bank_transfer"===t.payment_method?"تحويل بنكي":t.payment_method}),e.jsx("td",{className:"px-3 py-2 text-xs",children:e.jsx(oc,{variant:a.variant,className:"text-xs",children:a.label})})]},t.id)})})]})}),m.some(e=>e.description||e.receipt_number)&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"تفاصيل إضافية:"}),m.map(t=>(t.description||t.receipt_number)&&e.jsxs("div",{className:"p-3 bg-muted/30 rounded border border-border",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"text-xs text-muted-foreground",children:[In(t.payment_date)," - ",Mn(t.amount)]})}),t.description&&e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"الوصف: "}),e.jsx("span",{className:"text-xs text-foreground",children:t.description.replace(/\[علاج:[^\]]+\]/g,"").trim().replace(/^\s*-\s*/,"").trim()})]}),t.receipt_number&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"رقم الإيصال: "}),e.jsx("span",{className:"text-xs text-foreground",children:t.receipt_number})]})]},`details-${t.id}`))]})]})]})]})]}),e.jsxs(Wd,{value:"prescriptions",className:"space-y-4 dialog-rtl",dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",dir:"rtl",children:[e.jsx("h3",{className:"text-lg font-medium",children:"الوصفات الطبية"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Lr,{onClick:async()=>{if(t)try{I({title:"جاري إعداد تقرير الوصفات...",description:"يتم تجميع بيانات وصفات المريض وإعداد التقرير للطباعة"});const e=await uf.getPatientIntegratedData(t.id);if(!e)throw new Error("لا يمكن جلب بيانات المريض");await yh.exportPatientPrescriptions(e,z),I({title:"تم إنشاء تقرير الوصفات بنجاح",description:`تم إنشاء تقرير وصفات المريض ${t.full_name} وحفظه كملف PDF`})}catch(e){console.error("Error printing patient prescriptions:",e),I({title:"خطأ في إنشاء تقرير الوصفات",description:"فشل في إنشاء تقرير وصفات المريض. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Qs,{className:"w-4 h-4"}),"طباعة الوصفات"]}),e.jsxs(Lr,{onClick:()=>{A(!0)},className:"flex items-center gap-2",size:"sm",children:[e.jsx(Zs,{className:"w-4 h-4"}),"إضافة وصفة"]})]})]}),k?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"loading-spinner"})}):0===x.length?e.jsx(nc,{className:"card-rtl",children:e.jsx(ic,{className:"pt-6 card-content",dir:"rtl",children:e.jsxs("div",{className:"text-center py-8",dir:"rtl",children:[e.jsx(bs,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد وصفات طبية"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم إنشاء أي وصفات طبية لهذا المريض بعد"})]})})}):e.jsx("div",{className:"space-y-4",dir:"rtl",children:x.map(t=>e.jsx(nc,{className:"card-rtl",children:e.jsxs(ic,{className:"pt-4 card-content",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"وصفة طبية"})]}),e.jsx(oc,{variant:"outline",children:In(t.prescription_date)})]}),t.tooth_treatment&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"مرتبطة بعلاج: "}),e.jsxs("span",{className:"text-sm font-medium",children:["السن رقم ",t.tooth_treatment.tooth_number," - ",t.tooth_treatment.treatment_type]})]}),t.notes&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:t.notes}),t.medications&&t.medications.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"الأدوية:"}),t.medications.map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/30 rounded",children:[e.jsx("span",{className:"text-sm",children:t.medication_name}),t.dose&&e.jsx("span",{className:"text-sm text-muted-foreground",children:t.dose})]},n))]})]})},t.id))})]})]})]})]}),e.jsx(tc,{isOpen:C,onClose:()=>$(!1),onSave:async e=>{try{const{createAppointment:n}=Jn.getState();await n(e),$(!1);const a=R.filter(e=>e.patient_id===t.id);d(a),I({title:"تم بنجاح",description:"تم إضافة الموعد بنجاح"})}catch(n){console.error("Error saving appointment:",n),I({title:"خطأ",description:"فشل في إضافة الموعد",variant:"destructive"})}},patients:[t],treatments:[],initialData:void 0,preSelectedPatientId:t.id}),e.jsx(dc,{open:D,onOpenChange:E,preSelectedPatientId:t.id}),e.jsx(gf,{open:T,onOpenChange:e=>{A(e),e||(S(!0),window.electronAPI?.prescriptions?.getByPatient?.(t.id).then(e=>{g(e||[]),S(!1)}).catch(e=>{console.error("Error reloading prescriptions:",e),S(!1)}))},preSelectedPatientId:t.id}),e.jsx(yf,{patient:t,open:F,onOpenChange:P})]})}function jf({isOpen:t,patient:n,onClose:a,onSave:s}){const{patients:r}=bt(),{toast:i}=Bl(),[l,o]=re.useState({serial_number:"",full_name:"",gender:"male",age:0,patient_number:void 0,patient_condition:"",allergies:"",medical_conditions:"",email:"",address:"",notes:"",phone:"",date_added:""});re.useEffect(()=>{if(n){const e=e=>{if(!e)return"";return new Date(e).toISOString().slice(0,16)};o({serial_number:n.serial_number||"",full_name:n.full_name||"",gender:n.gender||"male",age:n.age||0,patient_number:n.patient_number,patient_condition:n.patient_condition||"",allergies:n.allergies||"",medical_conditions:n.medical_conditions||"",email:n.email||"",address:n.address||"",notes:n.notes||"",phone:n.phone||"",date_added:e(n.date_added||n.created_at||"")})}},[n]);const c=e=>{o({...l,[e.target.name]:e.target.value})};return n?e.jsx(Sr,{open:t,onOpenChange:a,children:e.jsxs(Dr,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsx(Ar,{children:"تعديل بيانات المريض"}),e.jsx(Fr,{children:"قم بتعديل معلومات المريض أدناه. الحقول المميزة بـ * مطلوبة."})]}),e.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),n){if(l.patient_number){const e=r.find(e=>e.patient_number===l.patient_number&&e.id!==n.id);if(e)return void i({title:"خطأ في رقم المريض",description:`يوجد مريض آخر برقم ${l.patient_number} (${e.full_name}). يرجى اختيار رقم مختلف.`,variant:"destructive"})}s(n.id,l),a()}},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"الحقول المطلوبة"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"الاسم الكامل *"}),e.jsx(Ir,{type:"text",name:"full_name",value:l.full_name,onChange:c,required:!0,placeholder:"أدخل الاسم الكامل"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"الجنس *"}),e.jsxs(Nl,{value:l.gender,onValueChange:e=>o({...l,gender:e}),children:[e.jsx(Sl,{className:"bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر الجنس",className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"male",children:"ذكر"}),e.jsx(Al,{value:"female",children:"أنثى"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"العمر *"}),e.jsx(Ir,{type:"number",min:"1",max:"120",name:"age",value:l.age,onChange:c,required:!0,placeholder:"أدخل العمر"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"تاريخ الإضافة *"}),e.jsx(Ir,{type:"datetime-local",name:"date_added",value:l.date_added,onChange:c,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"رقم المريض"}),e.jsx(Ir,{type:"number",min:"1",name:"patient_number",value:l.patient_number||"",onChange:e=>{const t=""===e.target.value?void 0:parseInt(e.target.value);o(e=>({...e,patient_number:t}))},placeholder:"أدخل رقم المريض"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"رقم تعريفي للمريض (اختياري، يقبل الأعداد الصحيحة الموجبة فقط)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"رقم الهاتف"}),e.jsx(Ir,{type:"tel",name:"phone",value:l.phone,onChange:c,placeholder:"963987654321"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"يرجى إدخال رقم الهاتف مع رمز الدولة بدون + أو 00 (مثل: 963987654321)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"الحقول الاختيارية"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"حالة المريض / التشخيص"}),e.jsx(wl,{name:"patient_condition",value:l.patient_condition,onChange:c,placeholder:"أدخل وصف الحالة الطبية أو التشخيص",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"الحساسية"}),e.jsx(Ir,{type:"text",name:"allergies",value:l.allergies,onChange:c,placeholder:"أدخل معلومات الحساسية المعروفة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"الحالات الطبية / الأمراض"}),e.jsx(wl,{name:"medical_conditions",value:l.medical_conditions,onChange:c,placeholder:"أدخل الحالات الطبية أو الأمراض المزمنة",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"البريد الإلكتروني"}),e.jsx(Ir,{type:"email",name:"email",value:l.email,onChange:c,placeholder:"أدخل البريد الإلكتروني"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"العنوان"}),e.jsx(Ir,{type:"text",name:"address",value:l.address,onChange:c,placeholder:"أدخل العنوان الكامل"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:"text-sm font-medium",children:"ملاحظات / تعليقات"}),e.jsx(wl,{name:"notes",value:l.notes,onChange:c,placeholder:"أدخل أي ملاحظات أو تعليقات إضافية",rows:3})]})]}),e.jsxs(Tr,{className:"flex justify-end space-x-4 space-x-reverse",children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:a,children:"إلغاء"}),e.jsx(Lr,{type:"submit",children:"حفظ التغييرات"})]})]})]})}):null}function wf({onNavigateToTreatments:t,onNavigateToPayments:n}){ua();const{filteredPatients:a,selectedPatient:s,isLoading:r,error:i,searchQuery:l,setSearchQuery:o,setSelectedPatient:c,deletePatient:d,updatePatient:m,clearError:u,loadPatients:p}=bt(),{loadAppointments:h}=Jn(),{loadPayments:x}=ca(),{toast:g}=Bl(),[f,v]=re.useState(!1),[y,b]=re.useState(!1),[j,w]=re.useState(!1),[N,_]=re.useState(!1),[k,S]=re.useState(null),[C,$]=re.useState(null),[D,E]=re.useState(null),[T,A]=re.useState(!1),[F,P]=re.useState(null),[R,O]=re.useState(!1),[M,L]=re.useState("all"),[I,z]=re.useState("all"),[B,V]=re.useState({start:"",end:""});re.useEffect(()=>{p(),h(),x()},[p,h,x]),re.useEffect(()=>{const e=localStorage.getItem("selectedPatientForDetails");if(e)try{const{patient:t,openDetailsModal:n}=JSON.parse(e);n&&t&&(S(t),b(!0),localStorage.removeItem("selectedPatientForDetails"))}catch(t){console.error("Error parsing search result data:",t),localStorage.removeItem("selectedPatientForDetails")}},[]);const Y=e=>{$(e),w(!0)},q=ie.useMemo(()=>{let e=[...a];if("all"!==M&&(e=e.filter(e=>e.gender===M)),"all"!==I&&(e=e.filter(e=>{if(!e.date_of_birth)return"unknown"===I;const t=function(e){const t=new Date,n=new Date(e);let a=t.getFullYear()-n.getFullYear();const s=t.getMonth()-n.getMonth();return(s<0||0===s&&t.getDate()<n.getDate())&&a--,a}(e.date_of_birth);switch(I){case"child":return t<18;case"adult":return t>=18&&t<60;case"senior":return t>=60;case"unknown":return!1;default:return!0}})),B.start&&B.end){const t=new Date(B.start),n=new Date(B.end);n.setHours(23,59,59,999),e=e.filter(e=>{if(!e.date_added)return!1;const a=new Date(e.date_added);return a>=t&&a<=n})}return e},[a,M,I,B]);return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-destructive mb-4",children:i}),e.jsx(Lr,{onClick:u,children:"Try Again"})]})}):e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-heading-1 text-foreground arabic-enhanced",children:"إدارة المرضى"}),e.jsx("p",{className:"text-body text-muted-foreground mt-2 arabic-enhanced",children:"إدارة معلومات المرضى وسجلاتهم الطبية"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",onClick:async()=>{if(0!==q.length)try{await Zc.exportPatientsToExcel(q),Kc.exportSuccess(`تم تصدير ${q.length} مريض بنجاح إلى ملف Excel مع التنسيق الجميل!`)}catch(e){console.error("Error exporting patients:",e),Kc.exportError("فشل في تصدير بيانات المرضى")}else Kc.noDataToExport("لا توجد بيانات مرضى للتصدير")},children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير"]}),e.jsxs(Lr,{onClick:()=>v(!0),children:[e.jsx(Zs,{className:"w-4 h-4 ml-2"}),"إضافة مريض جديد"]})]})]}),e.jsx(nc,{children:e.jsx(ic,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-4",dir:"rtl",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(tr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{placeholder:"البحث بالاسم أو الهاتف أو البريد الإلكتروني أو رقم المريض...",value:l,onChange:e=>o(e.target.value),className:"pr-10 text-right",dir:"rtl"})]}),e.jsx(Cc,{open:R,onOpenChange:O,children:e.jsx($c,{asChild:!0,children:e.jsxs(Lr,{variant:"outline",size:"sm",children:[e.jsx(js,{className:"w-4 h-4 mr-2"}),"تصفية",("all"!==M||"all"!==I||B.start||B.end)&&e.jsx("span",{className:"mr-2 w-2 h-2 bg-primary rounded-full"})]})})}),(l||"all"!==M||"all"!==I||B.start||B.end)&&e.jsxs(Lr,{variant:"ghost",size:"sm",onClick:()=>{o(""),L("all"),z("all"),V({start:"",end:""}),O(!1)},children:[e.jsx(_r,{className:"w-4 h-4 mr-2"}),"مسح الكل"]})]}),e.jsx(Cc,{open:R,onOpenChange:O,children:e.jsx(Dc,{className:"space-y-4",dir:"rtl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-muted/50 rounded-lg",dir:"rtl",children:[e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"الجنس"}),e.jsxs(Nl,{value:M,onValueChange:L,dir:"rtl",children:[e.jsx(Sl,{className:"text-right",children:e.jsx(kl,{placeholder:"جميع الأجناس"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الأجناس"}),e.jsx(Al,{value:"male",children:"ذكر"}),e.jsx(Al,{value:"female",children:"أنثى"})]})]})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"الفئة العمرية"}),e.jsxs(Nl,{value:I,onValueChange:z,dir:"rtl",children:[e.jsx(Sl,{className:"text-right",children:e.jsx(kl,{placeholder:"جميع الأعمار"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الأعمار"}),e.jsx(Al,{value:"child",children:"أطفال (أقل من 18)"}),e.jsx(Al,{value:"adult",children:"بالغين (18-59)"}),e.jsx(Al,{value:"senior",children:"كبار السن (60+)"}),e.jsx(Al,{value:"unknown",children:"غير محدد"})]})]})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"تاريخ الإضافة"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ir,{type:"date",placeholder:"من تاريخ",value:B.start,onChange:e=>V(t=>({...t,start:e.target.value})),className:"text-right",dir:"rtl"}),e.jsx(Ir,{type:"date",placeholder:"إلى تاريخ",value:B.end,onChange:e=>V(t=>({...t,end:e.target.value})),className:"text-right",dir:"rtl"})]})]})]})})})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsx(pf,{patients:q,isLoading:r,onEdit:Y,onDelete:async e=>{P(e),A(!0)},onViewDetails:e=>{S(e),b(!0)},onViewPendingInvoice:e=>{E(e),_(!0)}})}),e.jsx(Vl,{open:f,onOpenChange:v}),e.jsx(bf,{patient:k,open:y,onOpenChange:b,onEdit:Y,onNavigateToTreatments:t,onNavigateToPayments:n}),e.jsx(jf,{isOpen:j,patient:C,onClose:()=>{w(!1),$(null)},onSave:async(e,t)=>{try{await m(e,t),w(!1),$(null),g({title:"نجح",description:"تم تحديث بيانات المريض بنجاح"})}catch(n){console.error("Error updating patient:",n),g({title:"خطأ",description:"فشل في تحديث بيانات المريض. يرجى المحاولة مرة أخرى",variant:"destructive"})}}}),e.jsx(yf,{patient:D,open:N,onOpenChange:e=>{_(e),e||E(null)}}),e.jsx(go,{open:T,onOpenChange:A,children:e.jsxs(yo,{dir:"rtl",children:[e.jsxs(bo,{children:[e.jsxs(wo,{className:"flex items-center gap-2",children:[e.jsx(dr,{className:"w-5 h-5 text-destructive"}),"تأكيد حذف المريض"]}),e.jsxs(No,{children:["هل أنت متأكد من حذف هذا المريض؟ سيتم حذف جميع البيانات المرتبطة به بما في ذلك المواعيد والمدفوعات.",e.jsx("br",{}),e.jsx("strong",{className:"text-destructive",children:"تحذير: لا يمكن التراجع عن هذا الإجراء!"})]})]}),e.jsxs(jo,{className:"flex-row-reverse",children:[e.jsxs(_o,{onClick:async()=>{if(F)try{await d(F),Kc.deleteSuccess("تم حذف المريض بنجاح")}catch(e){Kc.deleteError("فشل في حذف المريض")}finally{A(!1),P(null)}},className:"bg-destructive hover:bg-destructive/90",children:[e.jsx(dr,{className:"w-4 h-4 ml-2"}),"تأكيد الحذف"]}),e.jsx(ko,{children:"إلغاء"})]})]})})]})}function Nf(e){var t=function(e,t){if("object"!=lt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=lt(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==lt(t)?t:t+""}function _f(e,t,n){return(t=Nf(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function Sf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kf(Object(n),!0).forEach(function(t){_f(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kf(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Cf(e,t){if(null==e)return{};var n,a,s=Ce(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function $f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Df(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,Nf(a.key),a)}}function Ef(e,t,n){return t&&Df(e.prototype,t),n&&Df(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tf(e){return Tf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Tf(e)}function Af(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Af=function(){return!!e})()}function Ff(e,t,n){return t=Tf(t),function(e,t){if(t&&("object"==lt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return $e(e)}(e,Af()?Reflect.construct(t,n||[],Tf(e).constructor):t.apply(e,n))}function Pf(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&De(e,t)}function Rf(e){if(Array.isArray(e))return e}function Of(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function Mf(e,t){if(e){if("string"==typeof e)return Of(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Of(e,t):void 0}}function Lf(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function If(e,t){return Rf(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,s,r,i,l=[],o=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;o=!1}else for(;!(o=(a=r.call(n)).done)&&(l.push(a.value),l.length!==t);o=!0);}catch(e){c=!0,s=e}finally{try{if(!o&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw s}}return l}}(e,t)||Mf(e,t)||Lf()}function zf(e){var t,n,a="";if("string"==typeof e||"number"==typeof e)a+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=zf(e[t]))&&(a&&(a+=" "),a+=n);else for(t in e)e[t]&&(a&&(a+=" "),a+=t);return a}function Bf(){for(var e,t,n=0,a="";n<arguments.length;)(e=arguments[n++])&&(t=zf(e))&&(a&&(a+=" "),a+=t);return a}var Vf=function(e,t,n,a,s,r,i,l){if(!e){var o;if(void 0===t)o=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,a,s,r,i,l],d=0;(o=new Error(t.replace(/%s/g,function(){return c[d++]}))).name="Invariant Violation"}throw o.framesToPop=1,o}};const Yf=le(Vf);var qf=function(){};function Uf(e,t){return void 0!==e[t]}function Hf(e){return"default"+e.charAt(0).toUpperCase()+e.substr(1)}function Gf(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!=e&&this.setState(e)}function Wf(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!=n?n:null}.bind(this))}function Kf(e,t){try{var n=this.props,a=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,a)}finally{this.props=n,this.state=a}}Gf.__suppressDeprecationWarning=!0,Wf.__suppressDeprecationWarning=!0,Kf.__suppressDeprecationWarning=!0;var Zf="milliseconds",Qf="seconds",Xf="minutes",Jf="hours",ev="day",tv="week",nv="month",av="year",sv="decade",rv="century",iv={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,day:864e5,week:6048e5},lv={month:1,year:12,decade:120,century:1200};function ov(e){return e%4==0&&e%100!=0||e%400==0?29:28}function cv(e,t,n){switch(e=new Date(e),n){case Zf:case Qf:case Xf:case Jf:case ev:case tv:return function(e,t){var n=new Date(+e+t);return function(e,t){var n=e.getTimezoneOffset(),a=t.getTimezoneOffset();return new Date(+t+(a-n)*iv.minutes)}(e,n)}(e,t*iv[n]);case nv:case av:case sv:case rv:return function(e,t){var n=e.getFullYear(),a=e.getMonth(),s=e.getDate(),r=12*n+a+t,i=Math.trunc(r/12),l=r%12,o=Math.min(s,function(e){return[31,ov(e),31,30,31,30,31,31,30,31,30,31]}(i)[l]),c=new Date(e);return c.setFullYear(i),c.setDate(1),c.setMonth(l),c.setDate(o),c}(e,t*lv[n])}throw new TypeError('Invalid units: "'+n+'"')}function dv(e,t,n){return cv(e,-t,n)}function mv(e,t,n){switch(e=new Date(e),t){case rv:case sv:case av:e=$v(e,0);case nv:e=Cv(e,1);case tv:case ev:e=kv(e,0);case Jf:e=_v(e,0);case Xf:e=Nv(e,0);case Qf:e=wv(e,0)}return t===sv&&(e=dv(e,Dv(e)%10,"year")),t===rv&&(e=dv(e,Dv(e)%100,"year")),t===tv&&(e=Ev(e,0,n)),e}function uv(e,t,n){switch(e=mv(e=new Date(e),t,n),t){case rv:case sv:case av:case nv:case tv:(e=dv(e=cv(e,1,t),1,ev)).setHours(23,59,59,999);break;case ev:e.setHours(23,59,59,999);break;case Jf:case Xf:case Qf:e=dv(e=cv(e,1,t),1,Zf)}return e}var pv=Av(function(e,t){return e===t}),hv=Av(function(e,t){return e!==t}),xv=Av(function(e,t){return e>t}),gv=Av(function(e,t){return e>=t}),fv=Av(function(e,t){return e<t}),vv=Av(function(e,t){return e<=t});function yv(){return new Date(Math.min.apply(Math,arguments))}function bv(){return new Date(Math.max.apply(Math,arguments))}function jv(e,t,n,a){return a=a||"day",(!t||gv(e,t,a))&&(!n||vv(e,n,a))}var wv=Tv("Milliseconds"),Nv=Tv("Seconds"),_v=Tv("Minutes"),kv=Tv("Hours"),Sv=Tv("Day"),Cv=Tv("Date"),$v=Tv("Month"),Dv=Tv("FullYear");function Ev(e,t,n){var a=(Sv(e)+7-(n||0))%7;return void 0===t?a:cv(e,t-a,ev)}function Tv(e){var t=function(e){switch(e){case"Milliseconds":return 36e5;case"Seconds":return 3600;case"Minutes":return 60;case"Hours":return 1;default:return null}}(e);return function(n,a){if(void 0===a)return n["get"+e]();var s=new Date(n);return s["set"+e](a),t&&s["get"+e]()!=a&&("Hours"===e||a>=t&&s.getHours()-n.getHours()<Math.floor(a/t))&&s["set"+e](a+t),s}}function Av(e){return function(t,n,a){return e(+mv(t,a),+mv(n,a))}}const Fv=Object.freeze(Object.defineProperty({__proto__:null,add:cv,century:function(e,t){return void 0===t?Dv(mv(e,rv)):cv(e,t+100,av)},date:Cv,day:Sv,decade:function(e,t){return void 0===t?Dv(mv(e,sv)):cv(e,t+10,av)},diff:function(e,t,n,a){var s,r,i;switch(n){case Zf:case Qf:case Xf:case Jf:case ev:case tv:s=t.getTime()-e.getTime();break;case nv:case av:case sv:case rv:s=12*(Dv(t)-Dv(e))+$v(t)-$v(e);break;default:throw new TypeError('Invalid units: "'+n+'"')}switch(n){case Zf:r=1;break;case Qf:r=1e3;break;case Xf:r=6e4;break;case Jf:r=36e5;break;case ev:r=864e5;break;case tv:r=6048e5;break;case nv:r=1;break;case av:r=12;break;case sv:r=120;break;case rv:r=1200;break;default:throw new TypeError('Invalid units: "'+n+'"')}return i=s/r,a?i:Math.round(i)},endOf:uv,eq:pv,gt:xv,gte:gv,hours:kv,inRange:jv,lt:fv,lte:vv,max:bv,milliseconds:wv,min:yv,minutes:_v,month:$v,neq:hv,seconds:Nv,startOf:mv,subtract:dv,weekday:Ev,year:Dv},Symbol.toStringTag,{value:"Module"}));function Pv(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Rv(e){return function(e){if(Array.isArray(e))return Of(e)}(e)||Pv(e)||Mf(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ov=Ae,Mv=Fe,Lv=Pe,Iv=Math.ceil,zv=Math.max;var Bv=function(e,t,n){t=(n?Mv(e,t,n):void 0===t)?1:zv(Lv(t),0);var a=null==e?0:e.length;if(!a||t<1)return[];for(var s=0,r=0,i=Array(Iv(a/t));s<a;)i[r++]=Ov(e,s,s+=t);return i};const Vv=le(Bv);function Yv(e){return e&&e.ownerDocument||document}function qv(e,t){return function(e){var t=Yv(e);return t&&t.defaultView||window}(e).getComputedStyle(e,t)}var Uv=/([A-Z])/g;var Hv=/^ms-/;function Gv(e){return function(e){return e.replace(Uv,"-$1").toLowerCase()}(e).replace(Hv,"-ms-")}var Wv=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function Kv(e,t){var n="",a="";if("string"==typeof t)return e.style.getPropertyValue(Gv(t))||qv(e).getPropertyValue(Gv(t));Object.keys(t).forEach(function(s){var r=t[s];r||0===r?!function(e){return!(!e||!Wv.test(e))}(s)?n+=Gv(s)+": "+r+";":a+=s+"("+r+") ":e.style.removeProperty(Gv(s))}),a&&(n+="transform: "+a+";"),e.style.cssText+=";"+n}function Zv(e,t){return e.contains?e.contains(t):e.compareDocumentPosition?e===t||!!(16&e.compareDocumentPosition(t)):void 0}function Qv(e){return"window"in e&&e.window===e?e:"nodeType"in(t=e)&&t.nodeType===document.DOCUMENT_NODE&&e.defaultView||!1;var t}function Xv(e){var t="pageXOffset"===e?"scrollLeft":"scrollTop";return function(n,a){var s=Qv(n);if(void 0===a)return s?s[e]:n[t];s?s.scrollTo(s[e],a):n[t]=a}}const Jv=Xv("pageXOffset"),ey=Xv("pageYOffset");function ty(e){var t=Yv(e),n={top:0,left:0,height:0,width:0},a=t&&t.documentElement;return a&&Zv(a,e)?(void 0!==e.getBoundingClientRect&&(n=e.getBoundingClientRect()),n={top:n.top+ey(a)-(a.clientTop||0),left:n.left+Jv(a)-(a.clientLeft||0),width:n.width,height:n.height}):n}var ny=function(e){return!!e&&"offsetParent"in e};function ay(e,t){var n,a={top:0,left:0};if("fixed"===Kv(e,"position"))n=e.getBoundingClientRect();else{var s=t||function(e){for(var t=Yv(e),n=e&&e.offsetParent;ny(n)&&"HTML"!==n.nodeName&&"static"===Kv(n,"position");)n=n.offsetParent;return n||t.documentElement}(e);n=ty(e),"html"!==function(e){return e.nodeName&&e.nodeName.toLowerCase()}(s)&&(a=ty(s));var r=String(Kv(s,"borderTopWidth")||0);a.top+=parseInt(r,10)-ey(s)||0;var i=String(Kv(s,"borderLeftWidth")||0);a.left+=parseInt(i,10)-Jv(s)||0}var l=String(Kv(e,"marginTop")||0),o=String(Kv(e,"marginLeft")||0);return Te({},n,{top:n.top-a.top-(parseInt(l,10)||0),left:n.left-a.left-(parseInt(o,10)||0)})}const sy=!("undefined"==typeof window||!window.document||!window.document.createElement);var ry=(new Date).getTime();var iy="clearTimeout",ly=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-ry)),a=setTimeout(e,n);return ry=t,a},oy=function(e,t){return e+(e?t[0].toUpperCase()+t.substr(1):t)+"AnimationFrame"};sy&&["","webkit","moz","o","ms"].some(function(e){var t=oy(e,"request");return t in window&&(iy=oy(e,"cancel"),ly=function(e){return window[t](e)}),!!ly});var cy,dy=function(e){"function"==typeof window[iy]&&window[iy](e)},my=ly;function uy(e,t){if(!cy){var n=document.body,a=n.matches||n.matchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector;cy=function(e,t){return a.call(e,t)}}return cy(e,t)}var py=Function.prototype.bind.call(Function.prototype.call,[].slice);var hy=!1,xy=!1;try{var gy={get passive(){return hy=!0},get once(){return xy=hy=!0}};sy&&(window.addEventListener("test",gy,gy),window.removeEventListener("test",gy,!0))}catch(XE){}function fy(e){const t=function(e){const t=re.useRef(e);return re.useEffect(()=>{t.current=e},[e]),t}(e);return re.useCallback(function(...e){return t.current&&t.current(...e)},[t])}function vy(){return re.useState(null)}function yy(e){const t=function(){const e=re.useRef(!0),t=re.useRef(()=>e.current);return re.useEffect(()=>(e.current=!0,()=>{e.current=!1}),[]),t.current}();return[e[0],re.useCallback(n=>{if(t())return e[1](n)},[t,e[1]])]}var by="top",jy="bottom",wy="right",Ny="left",_y="auto",ky=[by,jy,wy,Ny],Sy="start",Cy="end",$y="viewport",Dy="popper",Ey=ky.reduce(function(e,t){return e.concat([t+"-"+Sy,t+"-"+Cy])},[]),Ty=[].concat(ky,[_y]).reduce(function(e,t){return e.concat([t,t+"-"+Sy,t+"-"+Cy])},[]),Ay=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Fy(e){return e.split("-")[0]}function Py(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Ry(e){return e instanceof Py(e).Element||e instanceof Element}function Oy(e){return e instanceof Py(e).HTMLElement||e instanceof HTMLElement}function My(e){return"undefined"!=typeof ShadowRoot&&(e instanceof Py(e).ShadowRoot||e instanceof ShadowRoot)}var Ly=Math.max,Iy=Math.min,zy=Math.round;function By(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Vy(){return!/^((?!chrome|android).)*safari/i.test(By())}function Yy(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var a=e.getBoundingClientRect(),s=1,r=1;t&&Oy(e)&&(s=e.offsetWidth>0&&zy(a.width)/e.offsetWidth||1,r=e.offsetHeight>0&&zy(a.height)/e.offsetHeight||1);var i=(Ry(e)?Py(e):window).visualViewport,l=!Vy()&&n,o=(a.left+(l&&i?i.offsetLeft:0))/s,c=(a.top+(l&&i?i.offsetTop:0))/r,d=a.width/s,m=a.height/r;return{width:d,height:m,top:c,right:o+d,bottom:c+m,left:o,x:o,y:c}}function qy(e){var t=Yy(e),n=e.offsetWidth,a=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:a}}function Uy(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&My(n)){var a=t;do{if(a&&e.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Hy(e){return e?(e.nodeName||"").toLowerCase():null}function Gy(e){return Py(e).getComputedStyle(e)}function Wy(e){return["table","td","th"].indexOf(Hy(e))>=0}function Ky(e){return((Ry(e)?e.ownerDocument:e.document)||window.document).documentElement}function Zy(e){return"html"===Hy(e)?e:e.assignedSlot||e.parentNode||(My(e)?e.host:null)||Ky(e)}function Qy(e){return Oy(e)&&"fixed"!==Gy(e).position?e.offsetParent:null}function Xy(e){for(var t=Py(e),n=Qy(e);n&&Wy(n)&&"static"===Gy(n).position;)n=Qy(n);return n&&("html"===Hy(n)||"body"===Hy(n)&&"static"===Gy(n).position)?t:n||function(e){var t=/firefox/i.test(By());if(/Trident/i.test(By())&&Oy(e)&&"fixed"===Gy(e).position)return null;var n=Zy(e);for(My(n)&&(n=n.host);Oy(n)&&["html","body"].indexOf(Hy(n))<0;){var a=Gy(n);if("none"!==a.transform||"none"!==a.perspective||"paint"===a.contain||-1!==["transform","perspective"].indexOf(a.willChange)||t&&"filter"===a.willChange||t&&a.filter&&"none"!==a.filter)return n;n=n.parentNode}return null}(e)||t}function Jy(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function eb(e,t,n){return Ly(e,Iy(t,n))}function tb(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function nb(e,t){return t.reduce(function(t,n){return t[n]=e,t},{})}const ab={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,a=e.name,s=e.options,r=n.elements.arrow,i=n.modifiersData.popperOffsets,l=Fy(n.placement),o=Jy(l),c=[Ny,wy].indexOf(l)>=0?"height":"width";if(r&&i){var d=function(e,t){return tb("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:nb(e,ky))}(s.padding,n),m=qy(r),u="y"===o?by:Ny,p="y"===o?jy:wy,h=n.rects.reference[c]+n.rects.reference[o]-i[o]-n.rects.popper[c],x=i[o]-n.rects.reference[o],g=Xy(r),f=g?"y"===o?g.clientHeight||0:g.clientWidth||0:0,v=h/2-x/2,y=d[u],b=f-m[c]-d[p],j=f/2-m[c]/2+v,w=eb(y,j,b),N=o;n.modifiersData[a]=((t={})[N]=w,t.centerOffset=w-j,t)}},effect:function(e){var t=e.state,n=e.options.element,a=void 0===n?"[data-popper-arrow]":n;null!=a&&("string"!=typeof a||(a=t.elements.popper.querySelector(a)))&&Uy(t.elements.popper,a)&&(t.elements.arrow=a)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function sb(e){return e.split("-")[1]}var rb={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ib(e){var t,n=e.popper,a=e.popperRect,s=e.placement,r=e.variation,i=e.offsets,l=e.position,o=e.gpuAcceleration,c=e.adaptive,d=e.roundOffsets,m=e.isFixed,u=i.x,p=void 0===u?0:u,h=i.y,x=void 0===h?0:h,g="function"==typeof d?d({x:p,y:x}):{x:p,y:x};p=g.x,x=g.y;var f=i.hasOwnProperty("x"),v=i.hasOwnProperty("y"),y=Ny,b=by,j=window;if(c){var w=Xy(n),N="clientHeight",_="clientWidth";if(w===Py(n)&&"static"!==Gy(w=Ky(n)).position&&"absolute"===l&&(N="scrollHeight",_="scrollWidth"),s===by||(s===Ny||s===wy)&&r===Cy)b=jy,x-=(m&&w===j&&j.visualViewport?j.visualViewport.height:w[N])-a.height,x*=o?1:-1;if(s===Ny||(s===by||s===jy)&&r===Cy)y=wy,p-=(m&&w===j&&j.visualViewport?j.visualViewport.width:w[_])-a.width,p*=o?1:-1}var k,S=Object.assign({position:l},c&&rb),C=!0===d?function(e,t){var n=e.x,a=e.y,s=t.devicePixelRatio||1;return{x:zy(n*s)/s||0,y:zy(a*s)/s||0}}({x:p,y:x},Py(n)):{x:p,y:x};return p=C.x,x=C.y,o?Object.assign({},S,((k={})[b]=v?"0":"",k[y]=f?"0":"",k.transform=(j.devicePixelRatio||1)<=1?"translate("+p+"px, "+x+"px)":"translate3d("+p+"px, "+x+"px, 0)",k)):Object.assign({},S,((t={})[b]=v?x+"px":"",t[y]=f?p+"px":"",t.transform="",t))}const lb={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,a=n.gpuAcceleration,s=void 0===a||a,r=n.adaptive,i=void 0===r||r,l=n.roundOffsets,o=void 0===l||l,c={placement:Fy(t.placement),variation:sb(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,ib(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:i,roundOffsets:o})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,ib(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:o})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var ob={passive:!0};const cb={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,a=e.options,s=a.scroll,r=void 0===s||s,i=a.resize,l=void 0===i||i,o=Py(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return r&&c.forEach(function(e){e.addEventListener("scroll",n.update,ob)}),l&&o.addEventListener("resize",n.update,ob),function(){r&&c.forEach(function(e){e.removeEventListener("scroll",n.update,ob)}),l&&o.removeEventListener("resize",n.update,ob)}},data:{}};var db={left:"right",right:"left",bottom:"top",top:"bottom"};function mb(e){return e.replace(/left|right|bottom|top/g,function(e){return db[e]})}var ub={start:"end",end:"start"};function pb(e){return e.replace(/start|end/g,function(e){return ub[e]})}function hb(e){var t=Py(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function xb(e){return Yy(Ky(e)).left+hb(e).scrollLeft}function gb(e){var t=Gy(e),n=t.overflow,a=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+s+a)}function fb(e){return["html","body","#document"].indexOf(Hy(e))>=0?e.ownerDocument.body:Oy(e)&&gb(e)?e:fb(Zy(e))}function vb(e,t){var n;void 0===t&&(t=[]);var a=fb(e),s=a===(null==(n=e.ownerDocument)?void 0:n.body),r=Py(a),i=s?[r].concat(r.visualViewport||[],gb(a)?a:[]):a,l=t.concat(i);return s?l:l.concat(vb(Zy(i)))}function yb(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function bb(e,t,n){return t===$y?yb(function(e,t){var n=Py(e),a=Ky(e),s=n.visualViewport,r=a.clientWidth,i=a.clientHeight,l=0,o=0;if(s){r=s.width,i=s.height;var c=Vy();(c||!c&&"fixed"===t)&&(l=s.offsetLeft,o=s.offsetTop)}return{width:r,height:i,x:l+xb(e),y:o}}(e,n)):Ry(t)?function(e,t){var n=Yy(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):yb(function(e){var t,n=Ky(e),a=hb(e),s=null==(t=e.ownerDocument)?void 0:t.body,r=Ly(n.scrollWidth,n.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),i=Ly(n.scrollHeight,n.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),l=-a.scrollLeft+xb(e),o=-a.scrollTop;return"rtl"===Gy(s||n).direction&&(l+=Ly(n.clientWidth,s?s.clientWidth:0)-r),{width:r,height:i,x:l,y:o}}(Ky(e)))}function jb(e,t,n,a){var s="clippingParents"===t?function(e){var t=vb(Zy(e)),n=["absolute","fixed"].indexOf(Gy(e).position)>=0&&Oy(e)?Xy(e):e;return Ry(n)?t.filter(function(e){return Ry(e)&&Uy(e,n)&&"body"!==Hy(e)}):[]}(e):[].concat(t),r=[].concat(s,[n]),i=r[0],l=r.reduce(function(t,n){var s=bb(e,n,a);return t.top=Ly(s.top,t.top),t.right=Iy(s.right,t.right),t.bottom=Iy(s.bottom,t.bottom),t.left=Ly(s.left,t.left),t},bb(e,i,a));return l.width=l.right-l.left,l.height=l.bottom-l.top,l.x=l.left,l.y=l.top,l}function wb(e){var t,n=e.reference,a=e.element,s=e.placement,r=s?Fy(s):null,i=s?sb(s):null,l=n.x+n.width/2-a.width/2,o=n.y+n.height/2-a.height/2;switch(r){case by:t={x:l,y:n.y-a.height};break;case jy:t={x:l,y:n.y+n.height};break;case wy:t={x:n.x+n.width,y:o};break;case Ny:t={x:n.x-a.width,y:o};break;default:t={x:n.x,y:n.y}}var c=r?Jy(r):null;if(null!=c){var d="y"===c?"height":"width";switch(i){case Sy:t[c]=t[c]-(n[d]/2-a[d]/2);break;case Cy:t[c]=t[c]+(n[d]/2-a[d]/2)}}return t}function Nb(e,t){void 0===t&&(t={});var n=t,a=n.placement,s=void 0===a?e.placement:a,r=n.strategy,i=void 0===r?e.strategy:r,l=n.boundary,o=void 0===l?"clippingParents":l,c=n.rootBoundary,d=void 0===c?$y:c,m=n.elementContext,u=void 0===m?Dy:m,p=n.altBoundary,h=void 0!==p&&p,x=n.padding,g=void 0===x?0:x,f=tb("number"!=typeof g?g:nb(g,ky)),v=u===Dy?"reference":Dy,y=e.rects.popper,b=e.elements[h?v:u],j=jb(Ry(b)?b:b.contextElement||Ky(e.elements.popper),o,d,i),w=Yy(e.elements.reference),N=wb({reference:w,element:y,strategy:"absolute",placement:s}),_=yb(Object.assign({},y,N)),k=u===Dy?_:w,S={top:j.top-k.top+f.top,bottom:k.bottom-j.bottom+f.bottom,left:j.left-k.left+f.left,right:k.right-j.right+f.right},C=e.modifiersData.offset;if(u===Dy&&C){var $=C[s];Object.keys(S).forEach(function(e){var t=[wy,jy].indexOf(e)>=0?1:-1,n=[by,jy].indexOf(e)>=0?"y":"x";S[e]+=$[n]*t})}return S}function _b(e,t){void 0===t&&(t={});var n=t,a=n.placement,s=n.boundary,r=n.rootBoundary,i=n.padding,l=n.flipVariations,o=n.allowedAutoPlacements,c=void 0===o?Ty:o,d=sb(a),m=d?l?Ey:Ey.filter(function(e){return sb(e)===d}):ky,u=m.filter(function(e){return c.indexOf(e)>=0});0===u.length&&(u=m);var p=u.reduce(function(t,n){return t[n]=Nb(e,{placement:n,boundary:s,rootBoundary:r,padding:i})[Fy(n)],t},{});return Object.keys(p).sort(function(e,t){return p[e]-p[t]})}const kb={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,a=e.name;if(!t.modifiersData[a]._skip){for(var s=n.mainAxis,r=void 0===s||s,i=n.altAxis,l=void 0===i||i,o=n.fallbackPlacements,c=n.padding,d=n.boundary,m=n.rootBoundary,u=n.altBoundary,p=n.flipVariations,h=void 0===p||p,x=n.allowedAutoPlacements,g=t.options.placement,f=Fy(g),v=o||(f===g||!h?[mb(g)]:function(e){if(Fy(e)===_y)return[];var t=mb(e);return[pb(e),t,pb(t)]}(g)),y=[g].concat(v).reduce(function(e,n){return e.concat(Fy(n)===_y?_b(t,{placement:n,boundary:d,rootBoundary:m,padding:c,flipVariations:h,allowedAutoPlacements:x}):n)},[]),b=t.rects.reference,j=t.rects.popper,w=new Map,N=!0,_=y[0],k=0;k<y.length;k++){var S=y[k],C=Fy(S),$=sb(S)===Sy,D=[by,jy].indexOf(C)>=0,E=D?"width":"height",T=Nb(t,{placement:S,boundary:d,rootBoundary:m,altBoundary:u,padding:c}),A=D?$?wy:Ny:$?jy:by;b[E]>j[E]&&(A=mb(A));var F=mb(A),P=[];if(r&&P.push(T[C]<=0),l&&P.push(T[A]<=0,T[F]<=0),P.every(function(e){return e})){_=S,N=!1;break}w.set(S,P)}if(N)for(var R=function(e){var t=y.find(function(t){var n=w.get(t);if(n)return n.slice(0,e).every(function(e){return e})});if(t)return _=t,"break"},O=h?3:1;O>0;O--){if("break"===R(O))break}t.placement!==_&&(t.modifiersData[a]._skip=!0,t.placement=_,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Sb(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function Cb(e){return[by,wy,jy,Ny].some(function(t){return e[t]>=0})}const $b={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,a=e.name,s=n.offset,r=void 0===s?[0,0]:s,i=Ty.reduce(function(e,n){return e[n]=function(e,t,n){var a=Fy(e),s=[Ny,by].indexOf(a)>=0?-1:1,r="function"==typeof n?n(Object.assign({},t,{placement:e})):n,i=r[0],l=r[1];return i=i||0,l=(l||0)*s,[Ny,wy].indexOf(a)>=0?{x:l,y:i}:{x:i,y:l}}(n,t.rects,r),e},{}),l=i[t.placement],o=l.x,c=l.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=o,t.modifiersData.popperOffsets.y+=c),t.modifiersData[a]=i}};const Db={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,a=e.name,s=n.mainAxis,r=void 0===s||s,i=n.altAxis,l=void 0!==i&&i,o=n.boundary,c=n.rootBoundary,d=n.altBoundary,m=n.padding,u=n.tether,p=void 0===u||u,h=n.tetherOffset,x=void 0===h?0:h,g=Nb(t,{boundary:o,rootBoundary:c,padding:m,altBoundary:d}),f=Fy(t.placement),v=sb(t.placement),y=!v,b=Jy(f),j="x"===b?"y":"x",w=t.modifiersData.popperOffsets,N=t.rects.reference,_=t.rects.popper,k="function"==typeof x?x(Object.assign({},t.rects,{placement:t.placement})):x,S="number"==typeof k?{mainAxis:k,altAxis:k}:Object.assign({mainAxis:0,altAxis:0},k),C=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,$={x:0,y:0};if(w){if(r){var D,E="y"===b?by:Ny,T="y"===b?jy:wy,A="y"===b?"height":"width",F=w[b],P=F+g[E],R=F-g[T],O=p?-_[A]/2:0,M=v===Sy?N[A]:_[A],L=v===Sy?-_[A]:-N[A],I=t.elements.arrow,z=p&&I?qy(I):{width:0,height:0},B=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},V=B[E],Y=B[T],q=eb(0,N[A],z[A]),U=y?N[A]/2-O-q-V-S.mainAxis:M-q-V-S.mainAxis,H=y?-N[A]/2+O+q+Y+S.mainAxis:L+q+Y+S.mainAxis,G=t.elements.arrow&&Xy(t.elements.arrow),W=G?"y"===b?G.clientTop||0:G.clientLeft||0:0,K=null!=(D=null==C?void 0:C[b])?D:0,Z=F+H-K,Q=eb(p?Iy(P,F+U-K-W):P,F,p?Ly(R,Z):R);w[b]=Q,$[b]=Q-F}if(l){var X,J="x"===b?by:Ny,ee="x"===b?jy:wy,te=w[j],ne="y"===j?"height":"width",ae=te+g[J],se=te-g[ee],re=-1!==[by,Ny].indexOf(f),ie=null!=(X=null==C?void 0:C[j])?X:0,le=re?ae:te-N[ne]-_[ne]-ie+S.altAxis,oe=re?te+N[ne]+_[ne]-ie-S.altAxis:se,ce=p&&re?function(e,t,n){var a=eb(e,t,n);return a>n?n:a}(le,te,oe):eb(p?le:ae,te,p?oe:se);w[j]=ce,$[j]=ce-te}t.modifiersData[a]=$}},requiresIfExists:["offset"]};function Eb(e,t,n){void 0===n&&(n=!1);var a,s,r=Oy(t),i=Oy(t)&&function(e){var t=e.getBoundingClientRect(),n=zy(t.width)/e.offsetWidth||1,a=zy(t.height)/e.offsetHeight||1;return 1!==n||1!==a}(t),l=Ky(t),o=Yy(e,i,n),c={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(r||!r&&!n)&&(("body"!==Hy(t)||gb(l))&&(c=(a=t)!==Py(a)&&Oy(a)?{scrollLeft:(s=a).scrollLeft,scrollTop:s.scrollTop}:hb(a)),Oy(t)?((d=Yy(t,!0)).x+=t.clientLeft,d.y+=t.clientTop):l&&(d.x=xb(l))),{x:o.left+c.scrollLeft-d.x,y:o.top+c.scrollTop-d.y,width:o.width,height:o.height}}function Tb(e){var t=new Map,n=new Set,a=[];function s(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){if(!n.has(e)){var a=t.get(e);a&&s(a)}}),a.push(e)}return e.forEach(function(e){t.set(e.name,e)}),e.forEach(function(e){n.has(e.name)||s(e)}),a}var Ab={placement:"bottom",modifiers:[],strategy:"absolute"};function Fb(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some(function(e){return!(e&&"function"==typeof e.getBoundingClientRect)})}var Pb=function(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,a=void 0===n?[]:n,s=t.defaultOptions,r=void 0===s?Ab:s;return function(e,t,n){void 0===n&&(n=r);var s,i,l={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ab,r),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},o=[],c=!1,d={state:l,setOptions:function(n){var s="function"==typeof n?n(l.options):n;m(),l.options=Object.assign({},r,l.options,s),l.scrollParents={reference:Ry(e)?vb(e):e.contextElement?vb(e.contextElement):[],popper:vb(t)};var i,c,u=function(e){var t=Tb(e);return Ay.reduce(function(e,n){return e.concat(t.filter(function(e){return e.phase===n}))},[])}((i=[].concat(a,l.options.modifiers),c=i.reduce(function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e},{}),Object.keys(c).map(function(e){return c[e]})));return l.orderedModifiers=u.filter(function(e){return e.enabled}),l.orderedModifiers.forEach(function(e){var t=e.name,n=e.options,a=void 0===n?{}:n,s=e.effect;if("function"==typeof s){var r=s({state:l,name:t,instance:d,options:a}),i=function(){};o.push(r||i)}}),d.update()},forceUpdate:function(){if(!c){var e=l.elements,t=e.reference,n=e.popper;if(Fb(t,n)){l.rects={reference:Eb(t,Xy(n),"fixed"===l.options.strategy),popper:qy(n)},l.reset=!1,l.placement=l.options.placement,l.orderedModifiers.forEach(function(e){return l.modifiersData[e.name]=Object.assign({},e.data)});for(var a=0;a<l.orderedModifiers.length;a++)if(!0!==l.reset){var s=l.orderedModifiers[a],r=s.fn,i=s.options,o=void 0===i?{}:i,m=s.name;"function"==typeof r&&(l=r({state:l,options:o,name:m,instance:d})||l)}else l.reset=!1,a=-1}}},update:(s=function(){return new Promise(function(e){d.forceUpdate(),e(l)})},function(){return i||(i=new Promise(function(e){Promise.resolve().then(function(){i=void 0,e(s())})})),i}),destroy:function(){m(),c=!0}};if(!Fb(e,t))return d;function m(){o.forEach(function(e){return e()}),o=[]}return d.setOptions(n).then(function(e){!c&&n.onFirstUpdate&&n.onFirstUpdate(e)}),d}}({defaultModifiers:[{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,a=t.rects.reference,s=t.rects.popper,r=t.modifiersData.preventOverflow,i=Nb(t,{elementContext:"reference"}),l=Nb(t,{altBoundary:!0}),o=Sb(i,a),c=Sb(l,s,r),d=Cb(o),m=Cb(c);t.modifiersData[n]={referenceClippingOffsets:o,popperEscapeOffsets:c,isReferenceHidden:d,hasPopperEscaped:m},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":m})}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=wb({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},lb,cb,$b,kb,Db,ab]}),Rb=function(e){return{position:e,top:"0",left:"0",opacity:"0",pointerEvents:"none"}},Ob={name:"applyStyles",enabled:!1},Mb={name:"ariaDescribedBy",enabled:!0,phase:"afterWrite",effect:function(e){var t=e.state;return function(){var e=t.elements,n=e.reference,a=e.popper;if("removeAttribute"in n){var s=(n.getAttribute("aria-describedby")||"").split(",").filter(function(e){return e.trim()!==a.id});s.length?n.setAttribute("aria-describedby",s.join(",")):n.removeAttribute("aria-describedby")}}},fn:function(e){var t,n=e.state.elements,a=n.popper,s=n.reference,r=null==(t=a.getAttribute("role"))?void 0:t.toLowerCase();if(a.id&&"tooltip"===r&&"setAttribute"in s){var i=s.getAttribute("aria-describedby");if(i&&-1!==i.split(",").indexOf(a.id))return;s.setAttribute("aria-describedby",i?i+","+a.id:a.id)}}},Lb=[];function Ib(e,t,n,a){return function(e,t,n,a){if(a&&"boolean"!=typeof a&&!xy){var s=a.once,r=a.capture,i=n;!xy&&s&&(i=n.__once||function e(a){this.removeEventListener(t,e,r),n.call(this,a)},n.__once=i),e.addEventListener(t,i,hy?a:r)}e.addEventListener(t,n,a)}(e,t,n,a),function(){!function(e,t,n,a){var s=a&&"boolean"!=typeof a?a.capture:a;e.removeEventListener(t,n,s),n.__once&&e.removeEventListener(t,n.__once,s)}(e,t,n,a)}}const zb=le(function(){});const Bb=function(e){return Yv(function(e){return e&&"setState"in e?oe.findDOMNode(e):null!=e?e:null}(e))};var Vb=function(){};var Yb,qb=function(e){return e&&("current"in e?e.current:e)};function Ub(e){return void 0===e&&(e={}),Array.isArray(e)?e:Object.keys(e).map(function(t){return e[t].name=t,e[t]})}function Hb(e){var t,n,a,s,r=e.enabled,i=e.enableEvents,l=e.placement,o=e.flip,c=e.offset,d=e.fixed,m=e.containerPadding,u=e.arrowElement,p=e.popperConfig,h=void 0===p?{}:p,x=function(e){var t={};return Array.isArray(e)?(null==e||e.forEach(function(e){t[e.name]=e}),t):e||t}(h.modifiers);return Te({},h,{placement:l,enabled:r,strategy:d?"fixed":h.strategy,modifiers:Ub(Te({},x,{eventListeners:{enabled:i},preventOverflow:Te({},x.preventOverflow,{options:m?Te({padding:m},null==(t=x.preventOverflow)?void 0:t.options):null==(n=x.preventOverflow)?void 0:n.options}),offset:{options:Te({offset:c},null==(a=x.offset)?void 0:a.options)},arrow:Te({},x.arrow,{enabled:!!u,options:Te({},null==(s=x.arrow)?void 0:s.options,{element:u})}),flip:Te({enabled:!!o},x.flip)}))})}function Gb(e){if((!Yb&&0!==Yb||e)&&sy){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),Yb=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return Yb}var Wb=function(e){var t;return"undefined"==typeof document?null:null==e?Yv().body:("function"==typeof e&&(e=e()),e&&"current"in e&&(e=e.current),null!=(t=e)&&t.nodeType&&e||null)};function Kb(e,t){var n=re.useState(function(){return Wb(e)}),a=n[0],s=n[1];if(!a){var r=Wb(e);r&&s(r)}return re.useEffect(function(){t&&a&&t(a)},[t,a]),re.useEffect(function(){var t=Wb(e);t!==a&&s(t)},[e,a]),a}const Zb=e=>e&&"function"!=typeof e?t=>{e.current=t}:e;function Qb(e,t){return re.useMemo(()=>function(e,t){const n=Zb(e),a=Zb(t);return e=>{n&&n(e),a&&a(e)}}(e,t),[e,t])}var Xb=ie.forwardRef(function(e,t){var n=e.flip,a=e.offset,s=e.placement,r=e.containerPadding,i=void 0===r?5:r,l=e.popperConfig,o=void 0===l?{}:l,c=e.transition,d=vy(),m=d[0],u=d[1],p=vy(),h=p[0],x=p[1],g=Qb(u,t),f=Kb(e.container),v=Kb(e.target),y=re.useState(!e.show),b=y[0],j=y[1],w=function(e,t,n){var a=void 0===n?{}:n,s=a.enabled,r=void 0===s||s,i=a.placement,l=void 0===i?"bottom":i,o=a.strategy,c=void 0===o?"absolute":o,d=a.modifiers,m=void 0===d?Lb:d,u=Ce(a,["enabled","placement","strategy","modifiers"]),p=re.useRef(),h=re.useCallback(function(){var e;null==(e=p.current)||e.update()},[]),x=re.useCallback(function(){var e;null==(e=p.current)||e.forceUpdate()},[]),g=yy(re.useState({placement:l,update:h,forceUpdate:x,attributes:{},styles:{popper:Rb(c),arrow:{}}})),f=g[0],v=g[1],y=re.useMemo(function(){return{name:"updateStateModifier",enabled:!0,phase:"write",requires:["computeStyles"],fn:function(e){var t=e.state,n={},a={};Object.keys(t.elements).forEach(function(e){n[e]=t.styles[e],a[e]=t.attributes[e]}),v({state:t,styles:n,attributes:a,update:h,forceUpdate:x,placement:t.placement})}}},[h,x,v]);return re.useEffect(function(){p.current&&r&&p.current.setOptions({placement:l,strategy:c,modifiers:[].concat(m,[y,Ob])})},[c,l,y,r]),re.useEffect(function(){if(r&&null!=e&&null!=t)return p.current=Pb(e,t,Te({},u,{placement:l,strategy:c,modifiers:[].concat(m,[Mb,y])})),function(){null!=p.current&&(p.current.destroy(),p.current=void 0,v(function(e){return Te({},e,{attributes:{},styles:{popper:Rb(c)}})}))}},[r,e,t]),f}(v,m,Hb({placement:s,enableEvents:!!e.show,containerPadding:i||5,flip:n,offset:a,arrowElement:h,popperConfig:o})),N=w.styles,_=w.attributes,k=Ce(w,["styles","attributes"]);e.show?b&&j(!1):e.transition||b||j(!0);var S,C,$,D,E,T,A,F,P,R,O,M,L=e.show||c&&!b;if(S=m,C=e.onHide,$={disabled:!e.rootClose||e.rootCloseDisabled,clickTrigger:e.rootCloseEvent},E=(D=void 0===$?{}:$).disabled,T=D.clickTrigger,A=void 0===T?"click":T,F=re.useRef(!1),P=C||Vb,R=re.useCallback(function(e){var t,n,a=qb(S);zb(!!a,"RootClose captured a close event but does not have a ref to compare it to. useRootClose(), should be passed a ref that resolves to a DOM node"),F.current=!(a&&(n=e,!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey))&&function(e){return 0===e.button}(e)&&!Zv(a,null!=(t=null==e.composedPath?void 0:e.composedPath()[0])?t:e.target))},[S]),O=fy(function(e){F.current||P(e)}),M=fy(function(e){27===e.keyCode&&P(e)}),re.useEffect(function(){if(!E&&null!=S){var e=window.event,t=Bb(qb(S)),n=Ib(t,A,R,!0),a=Ib(t,A,function(t){t!==e?O(t):e=void 0}),s=Ib(t,"keyup",function(t){t!==e?M(t):e=void 0}),r=[];return"ontouchstart"in t.documentElement&&(r=[].slice.call(t.body.children).map(function(e){return Ib(e,"mousemove",Vb)})),function(){n(),a(),s(),r.forEach(function(e){return e()})}}},[S,E,A,R,O,M]),!L)return null;var I=e.children(Te({},k,{show:!!e.show,props:Te({},_.popper,{style:N.popper,ref:g}),arrowProps:Te({},_.arrow,{style:N.arrow,ref:x})}));if(c){var z=e.onExit,B=e.onExiting,V=e.onEnter,Y=e.onEntering,q=e.onEntered;I=ie.createElement(c,{in:e.show,appear:!0,onExit:z,onExiting:B,onExited:function(){j(!0),e.onExited&&e.onExited.apply(e,arguments)},onEnter:V,onEntering:Y,onEntered:q},I)}return f?oe.createPortal(I,f):null});Xb.displayName="Overlay",Xb.propTypes={show:Re.bool,placement:Re.oneOf(Ty),target:Re.any,container:Re.any,flip:Re.bool,children:Re.func.isRequired,containerPadding:Re.number,popperConfig:Re.object,rootClose:Re.bool,rootCloseEvent:Re.oneOf(["click","mousedown"]),rootCloseDisabled:Re.bool,onHide:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var s;return e.rootClose?(s=Re.func).isRequired.apply(s,[e].concat(n)):Re.func.apply(Re,[e].concat(n))},transition:Re.elementType,onEnter:Re.func,onEntering:Re.func,onEntered:Re.func,onExit:Re.func,onExiting:Re.func,onExited:Re.func};const Jb=Xb;function ej(e,t){var n=Qv(e);return n?n.innerHeight:t?e.clientHeight:ty(e).height}function tj(e,t,n){e.closest&&!n&&e.closest(t);var a=e;do{if(uy(a,t))return a;a=a.parentElement}while(a&&a!==n&&a.nodeType===document.ELEMENT_NODE);return null}var nj=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function aj(e,t){return e===t||!(!nj(e)||!nj(t))}function sj(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!aj(e[n],t[n]))return!1;return!0}function rj(e,t){void 0===t&&(t=sj);var n=null;function a(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];if(n&&n.lastThis===this&&t(a,n.lastArgs))return n.lastResult;var r=e.apply(this,a);return n={lastResult:r,lastArgs:a,lastThis:this},r}return a.clear=function(){n=null},a}function ij(e,t){var n=Qv(e);return n?n.innerWidth:t?e.clientWidth:ty(e).width}function lj(e){return Rf(e)||Pv(e)||Mf(e)||Lf()}var oj=Oe,cj=Me,dj=Fe,mj=Le,uj=Object.prototype,pj=uj.hasOwnProperty;const hj=le(oj(function(e,t){e=Object(e);var n=-1,a=t.length,s=a>2?t[2]:void 0;for(s&&dj(t[0],t[1],s)&&(a=1);++n<a;)for(var r=t[n],i=mj(r),l=-1,o=i.length;++l<o;){var c=i[l],d=e[c];(void 0===d||cj(d,uj[c])&&!pj.call(e,c))&&(e[c]=r[c])}return e}));var xj=Ie,gj=ze,fj=Be,vj=Ve,yj=Ye,bj=We,jj=qe,wj=Ue,Nj=He,_j=Ge;const kj=le(function(e,t,n){var a=bj(e),s=a||jj(e)||_j(e);if(t=vj(t),null==n){var r=e&&e.constructor;n=s?a?new r:[]:Nj(e)&&wj(r)?gj(yj(e)):{}}return(s?xj:fj)(e,function(e,a,s){return t(n,e,a,s)}),n});!function(){var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g}();function Sj(e){return e.children}var Cj="PREV",$j="NEXT",Dj="TODAY",Ej="DATE",Tj={MONTH:"month",WEEK:"week",WORK_WEEK:"work_week",DAY:"day",AGENDA:"agenda"},Aj=Object.keys(Tj).map(function(e){return Tj[e]});Re.oneOfType([Re.string,Re.func]),Re.any,Re.func,Re.oneOfType([Re.arrayOf(Re.oneOf(Aj)),Re.objectOf(function(e,t){if(-1!==Aj.indexOf(t)&&"boolean"==typeof e[t])return null;for(var n=arguments.length,a=new Array(n>2?n-2:0),s=2;s<n;s++)a[s-2]=arguments[s];return Re.elementType.apply(Re,[e,t].concat(a))})]),Re.oneOfType([Re.oneOf(["overlap","no-overlap"]),Re.func]);var Fj={seconds:1e3,minutes:6e4,hours:36e5,day:864e5};function Pj(e,t){var n=mv(e,"month");return mv(n,"week",t.startOfWeek())}function Rj(e,t){var n=uv(e,"month");return uv(n,"week",t.startOfWeek())}function Oj(e,t){for(var n=Pj(e,t),a=Rj(e,t),s=[];vv(n,a,"day");)s.push(n),n=cv(n,1,"day");return s}function Mj(e,t){var n=mv(e,t);return pv(n,e)?n:cv(n,1,t)}function Lj(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"day",a=e,s=[];vv(a,t,n);)s.push(a),a=cv(a,1,n);return s}function Ij(e,t){return null==t&&null==e?null:(null==t&&(t=new Date),null==e&&(e=new Date),e=mv(e,"day"),e=kv(e,kv(t)),e=_v(e,_v(t)),e=Nv(e,Nv(t)),wv(e,wv(t)))}function zj(e){return 0===kv(e)&&0===_v(e)&&0===Nv(e)&&0===wv(e)}function Bj(e,t,n){return n&&"milliseconds"!==n?Math.round(Math.abs(+mv(e,n)/Fj[n]-+mv(t,n)/Fj[n])):Math.abs(+e-+t)}var Vj=Re.oneOfType([Re.string,Re.func]);function Yj(e,t,n,a,s){var r="function"==typeof a?a(n,s,e):t.call(e,n,a,s);return Yf(null==r||"string"==typeof r,"`localizer format(..)` must return a string, null, or undefined"),r}function qj(e,t,n){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,t+n,0,0)}function Uj(e,t){return e.getTimezoneOffset()-t.getTimezoneOffset()}function Hj(e,t){return Bj(e,t,"minutes")+Uj(e,t)}function Gj(e){var t=mv(e,"day");return Bj(t,e,"minutes")+Uj(t,e)}function Wj(e,t){return fv(e,t,"day")}function Kj(e,t,n){return pv(e,t,"minutes")?gv(t,n,"minutes"):xv(t,n,"minutes")}function Zj(e,t){return function(e,t,n,a){return"day"===n&&(n="date"),Math.abs(Fv[n](e,void 0,a)-Fv[n](t,void 0,a))}(e,t,"day")}function Qj(e){var t=e.evtA,n=t.start,a=t.end,s=t.allDay,r=e.evtB,i=r.start,l=r.end,o=r.allDay,c=+mv(n,"day")-+mv(i,"day"),d=Zj(n,a),m=Zj(i,l);return c||m-d||!!o-!!s||+n-+i||+a-+l}function Xj(e){var t=e.event,n=t.start,a=t.end,s=e.range,r=s.start,i=s.end,l=mv(n,"day"),o=vv(l,i,"day"),c=hv(l,a,"minutes")?xv(a,r,"minutes"):gv(a,r,"minutes");return o&&c}function Jj(e,t){return pv(e,t,"day")}function ew(e,t){return zj(e)&&zj(t)}var tw=Ef(function e(t){var n=this;$f(this,e),Yf("function"==typeof t.format,"date localizer `format(..)` must be a function"),Yf("function"==typeof t.firstOfWeek,"date localizer `firstOfWeek(..)` must be a function"),this.propType=t.propType||Vj,this.formats=t.formats,this.format=function(){for(var e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return Yj.apply(void 0,[n,t.format].concat(a))},this.startOfWeek=t.firstOfWeek,this.merge=t.merge||Ij,this.inRange=t.inRange||jv,this.lt=t.lt||fv,this.lte=t.lte||vv,this.gt=t.gt||xv,this.gte=t.gte||gv,this.eq=t.eq||pv,this.neq=t.neq||hv,this.startOf=t.startOf||mv,this.endOf=t.endOf||uv,this.add=t.add||cv,this.range=t.range||Lj,this.diff=t.diff||Bj,this.ceil=t.ceil||Mj,this.min=t.min||yv,this.max=t.max||bv,this.minutes=t.minutes||_v,this.daySpan=t.daySpan||Zj,this.firstVisibleDay=t.firstVisibleDay||Pj,this.lastVisibleDay=t.lastVisibleDay||Rj,this.visibleDays=t.visibleDays||Oj,this.getSlotDate=t.getSlotDate||qj,this.getTimezoneOffset=t.getTimezoneOffset||function(e){return e.getTimezoneOffset()},this.getDstOffset=t.getDstOffset||Uj,this.getTotalMin=t.getTotalMin||Hj,this.getMinutesFromMidnight=t.getMinutesFromMidnight||Gj,this.continuesPrior=t.continuesPrior||Wj,this.continuesAfter=t.continuesAfter||Kj,this.sortEvents=t.sortEvents||Qj,this.inEventRange=t.inEventRange||Xj,this.isSameDate=t.isSameDate||Jj,this.startAndEndAreDateOnly=t.startAndEndAreDateOnly||ew,this.segmentOffset=t.browserTZOffset?t.browserTZOffset():0});function nw(e,t,n,a){var s=Sf(Sf({},e.formats),n);return Sf(Sf({},e),{},{messages:a,startOfWeek:function(){return e.startOfWeek(t)},format:function(n,a){return e.format(n,s[a]||a,t)}})}var aw=function(){function e(){var t;$f(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Ff(this,e,[].concat(a))).navigate=function(e){t.props.onNavigate(e)},t.view=function(e){t.props.onView(e)},t}return Pf(e,ie.Component),Ef(e,[{key:"render",value:function(){var e=this.props,t=e.localizer.messages,n=e.label;return ie.createElement("div",{className:"rbc-toolbar"},ie.createElement("span",{className:"rbc-btn-group"},ie.createElement("button",{type:"button",onClick:this.navigate.bind(null,Dj)},t.today),ie.createElement("button",{type:"button",onClick:this.navigate.bind(null,Cj)},t.previous),ie.createElement("button",{type:"button",onClick:this.navigate.bind(null,$j)},t.next)),ie.createElement("span",{className:"rbc-toolbar-label"},n),ie.createElement("span",{className:"rbc-btn-group"},this.viewNamesGroup(t)))}},{key:"viewNamesGroup",value:function(e){var t=this,n=this.props.views,a=this.props.view;if(n.length>1)return n.map(function(n){return ie.createElement("button",{type:"button",key:n,className:Bf({"rbc-active":a===n}),onClick:t.view.bind(null,n)},e[n])})}}])}();function sw(e,t){e&&e.apply(null,[].concat(t))}var rw={date:"Date",time:"Time",event:"Event",allDay:"All Day",week:"Week",work_week:"Work Week",day:"Day",month:"Month",previous:"Back",next:"Next",yesterday:"Yesterday",tomorrow:"Tomorrow",today:"Today",agenda:"Agenda",noEventsInRange:"There are no events in this range.",showMore:function(e){return"+".concat(e," more")}};var iw=["style","className","event","selected","isAllDay","onSelect","onDoubleClick","onKeyPress","localizer","continuesPrior","continuesAfter","accessors","getters","children","components","slotStart","slotEnd"],lw=function(){function e(){return $f(this,e),Ff(this,e,arguments)}return Pf(e,ie.Component),Ef(e,[{key:"render",value:function(){var e=this.props,t=e.style,n=e.className,a=e.event,s=e.selected,r=e.isAllDay,i=e.onSelect,l=e.onDoubleClick,o=e.onKeyPress,c=e.localizer,d=e.continuesPrior,m=e.continuesAfter,u=e.accessors,p=e.getters,h=e.children,x=e.components,g=x.event,f=x.eventWrapper,v=e.slotStart,y=e.slotEnd,b=Cf(e,iw);delete b.resizable;var j=u.title(a),w=u.tooltip(a),N=u.end(a),_=u.start(a),k=u.allDay(a),S=r||k||c.diff(_,c.ceil(N,"day"),"day")>1,C=p.eventProp(a,_,N,s),$=ie.createElement("div",{className:"rbc-event-content",title:w||void 0},g?ie.createElement(g,{event:a,continuesPrior:d,continuesAfter:m,title:j,isAllDay:k,localizer:c,slotStart:v,slotEnd:y}):j);return ie.createElement(f,Object.assign({},this.props,{type:"date"}),ie.createElement("div",Object.assign({},b,{style:Sf(Sf({},C.style),t),className:Bf("rbc-event",n,C.className,{"rbc-selected":s,"rbc-event-allday":S,"rbc-event-continues-prior":d,"rbc-event-continues-after":m}),onClick:function(e){return i&&i(a,e)},onDoubleClick:function(e){return l&&l(a,e)},onKeyDown:function(e){return o&&o(a,e)}}),"function"==typeof h?h($):$))}}])}();function ow(e,t){return!(!e||null==t)&&Ke(e,t)}function cw(e,t){return(e.right-e.left)/t}function dw(e,t,n,a){var s=cw(e,a);return n?a-1-Math.floor((t-e.left)/s):Math.floor((t-e.left)/s)}function mw(e){var t,n,a,s=e.containerRef,r=e.accessors,i=e.getters,l=e.selected,o=e.components,c=e.localizer,d=e.position,m=e.show,u=e.events,p=e.slotStart,h=e.slotEnd,x=e.onSelect,g=e.onDoubleClick,f=e.onKeyPress,v=e.handleDragStart,y=e.popperRef,b=e.target,j=e.offset;n=(t={ref:y,callback:m}).ref,a=t.callback,re.useEffect(function(){var e=function(e){n.current&&!n.current.contains(e.target)&&a()};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}},[n,a]),re.useLayoutEffect(function(){var e=function(e){var t=e.target,n=e.offset,a=e.container,s=e.box,r=ty(t),i=r.top,l=r.left,o=r.width,c=r.height,d=ty(a),m=d.top,u=d.left,p=d.width,h=d.height,x=ty(s),g=x.width,f=x.height,v=m+h,y=u+p,b=i+f,j=l+g,w=n.x,N=n.y;return{topOffset:b>v?i-f-N:i+N+c,leftOffset:j>y?l+w-g+o:l+w}}({target:b,offset:j,container:s.current,box:y.current}),t=e.topOffset,n=e.leftOffset;y.current.style.top="".concat(t,"px"),y.current.style.left="".concat(n,"px")},[j.x,j.y,b]);var w=d.width,N={minWidth:w+w/2};return ie.createElement("div",{style:N,className:"rbc-overlay",ref:y},ie.createElement("div",{className:"rbc-overlay-header"},c.format(p,"dayHeaderFormat")),u.map(function(e,t){return ie.createElement(lw,{key:t,type:"popup",localizer:c,event:e,getters:i,onSelect:x,accessors:r,components:o,onDoubleClick:g,onKeyPress:f,continuesPrior:c.lt(r.end(e),p,"day"),continuesAfter:c.gte(r.start(e),h,"day"),slotStart:p,slotEnd:h,selected:ow(e,l),draggable:!0,onDragStart:function(){return v(e)},onDragEnd:function(){return m()}})}))}var uw=ie.forwardRef(function(e,t){return ie.createElement(mw,Object.assign({},e,{popperRef:t}))});function pw(e){var t=e.containerRef,n=e.popupOffset,a=void 0===n?5:n,s=e.overlay,r=e.accessors,i=e.localizer,l=e.components,o=e.getters,c=e.selected,d=e.handleSelectEvent,m=e.handleDoubleClickEvent,u=e.handleKeyPressEvent,p=e.handleDragStart,h=e.onHide,x=e.overlayDisplay,g=re.useRef(null);if(!s.position)return null;var f=a;isNaN(a)||(f={x:a,y:a});var v=s.position,y=s.events,b=s.date,j=s.end;return ie.createElement(Jb,{rootClose:!0,flip:!0,show:!0,placement:"bottom",onHide:h,target:s.target},function(e){var n=e.props;return ie.createElement(uw,Object.assign({},n,{containerRef:t,ref:g,target:s.target,offset:f,accessors:r,getters:o,selected:c,components:l,localizer:i,position:v,show:x,events:y,slotStart:b,slotEnd:j,onSelect:d,onDoubleClick:m,onKeyPress:u,handleDragStart:p}))})}uw.propTypes={accessors:Re.object.isRequired,getters:Re.object.isRequired,selected:Re.object,components:Re.object.isRequired,localizer:Re.object.isRequired,position:Re.object.isRequired,show:Re.func.isRequired,events:Re.array.isRequired,slotStart:Re.instanceOf(Date).isRequired,slotEnd:Re.instanceOf(Date),onSelect:Re.func,onDoubleClick:Re.func,onKeyPress:Re.func,handleDragStart:Re.func,style:Re.object,offset:Re.shape({x:Re.number,y:Re.number})};var hw=ie.forwardRef(function(e,t){return ie.createElement(pw,Object.assign({},e,{containerRef:t}))});function xw(e,t){return Ib(arguments.length>2&&void 0!==arguments[2]?arguments[2]:document,e,t,{passive:!1})}function gw(e,t){return!!function(e,t){var n=t.clientX,a=t.clientY;return tj(document.elementFromPoint(n,a),".rbc-event",e)}(e,t)}function fw(e,t){return!!function(e,t){var n=t.clientX,a=t.clientY;return tj(document.elementFromPoint(n,a),".rbc-show-more",e)}(e,t)}function vw(e){var t=e;return e.touches&&e.touches.length&&(t=e.touches[0]),{clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY}}hw.propTypes={popupOffset:Re.oneOfType([Re.number,Re.shape({x:Re.number,y:Re.number})]),overlay:Re.shape({position:Re.object,events:Re.array,date:Re.instanceOf(Date),end:Re.instanceOf(Date)}),accessors:Re.object.isRequired,localizer:Re.object.isRequired,components:Re.object.isRequired,getters:Re.object.isRequired,selected:Re.object,handleSelectEvent:Re.func,handleDoubleClickEvent:Re.func,handleKeyPressEvent:Re.func,handleDragStart:Re.func,onHide:Re.func,overlayDisplay:Re.func};var yw=function(){return Ef(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.global;var a=n.longPressThreshold,s=void 0===a?250:a,r=n.validContainers,i=void 0===r?[]:r;$f(this,e),this._initialEvent=null,this.selecting=!1,this.isDetached=!1,this.container=t,this.globalMouse=!t||globalThis,this.longPressThreshold=s,this.validContainers=i,this._listeners=Object.create(null),this._handleInitialEvent=this._handleInitialEvent.bind(this),this._handleMoveEvent=this._handleMoveEvent.bind(this),this._handleTerminatingEvent=this._handleTerminatingEvent.bind(this),this._keyListener=this._keyListener.bind(this),this._dropFromOutsideListener=this._dropFromOutsideListener.bind(this),this._dragOverFromOutsideListener=this._dragOverFromOutsideListener.bind(this),this._removeTouchMoveWindowListener=xw("touchmove",function(){},window),this._removeKeyDownListener=xw("keydown",this._keyListener),this._removeKeyUpListener=xw("keyup",this._keyListener),this._removeDropFromOutsideListener=xw("drop",this._dropFromOutsideListener),this._removeDragOverFromOutsideListener=xw("dragover",this._dragOverFromOutsideListener),this._addInitialEventListener()},[{key:"on",value:function(e,t){var n=this._listeners[e]||(this._listeners[e]=[]);return n.push(t),{remove:function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}}}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var s;return(this._listeners[e]||[]).forEach(function(e){void 0===s&&(s=e.apply(void 0,n))}),s}},{key:"teardown",value:function(){this._initialEvent=null,this._initialEventData=null,this._selectRect=null,this.selecting=!1,this._lastClickData=null,this.isDetached=!0,this._listeners=Object.create(null),this._removeTouchMoveWindowListener&&this._removeTouchMoveWindowListener(),this._removeInitialEventListener&&this._removeInitialEventListener(),this._removeEndListener&&this._removeEndListener(),this._onEscListener&&this._onEscListener(),this._removeMoveListener&&this._removeMoveListener(),this._removeKeyUpListener&&this._removeKeyUpListener(),this._removeKeyDownListener&&this._removeKeyDownListener(),this._removeDropFromOutsideListener&&this._removeDropFromOutsideListener(),this._removeDragOverFromOutsideListener&&this._removeDragOverFromOutsideListener()}},{key:"isSelected",value:function(e){var t=this._selectRect;return!(!t||!this.selecting)&&bw(t,jw(e))}},{key:"filter",value:function(e){return this._selectRect&&this.selecting?e.filter(this.isSelected,this):[]}},{key:"_addLongPressListener",value:function(e,t){var n=this,a=null,s=null,r=null,i=function(t){a=setTimeout(function(){o(),e(t)},n.longPressThreshold),s=xw("touchmove",function(){return o()}),r=xw("touchend",function(){return o()})},l=xw("touchstart",i),o=function(){a&&clearTimeout(a),s&&s(),r&&r(),a=null,s=null,r=null};return t&&i(t),function(){o(),l()}}},{key:"_addInitialEventListener",value:function(){var e=this,t=xw("mousedown",function(t){e._removeInitialEventListener(),e._handleInitialEvent(t),e._removeInitialEventListener=xw("mousedown",e._handleInitialEvent)}),n=xw("touchstart",function(t){e._removeInitialEventListener(),e._removeInitialEventListener=e._addLongPressListener(e._handleInitialEvent,t)});this._removeInitialEventListener=function(){t(),n()}}},{key:"_dropFromOutsideListener",value:function(e){var t=vw(e),n=t.pageX,a=t.pageY,s=t.clientX,r=t.clientY;this.emit("dropFromOutside",{x:n,y:a,clientX:s,clientY:r}),e.preventDefault()}},{key:"_dragOverFromOutsideListener",value:function(e){var t=vw(e),n=t.pageX,a=t.pageY,s=t.clientX,r=t.clientY;this.emit("dragOverFromOutside",{x:n,y:a,clientX:s,clientY:r}),e.preventDefault()}},{key:"_handleInitialEvent",value:function(e){if(this._initialEvent=e,!this.isDetached){var t,n=vw(e),a=n.clientX,s=n.clientY,r=n.pageX,i=n.pageY,l=this.container();if(3!==e.which&&2!==e.button&&(c=a,d=s,!(o=l)||Zv(o,document.elementFromPoint(c,d)))){var o,c,d;if(!this.globalMouse&&l&&!Zv(l,e.target)){var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;"object"!==lt(e)&&(e={top:e,left:e,right:e,bottom:e});return e}(0),u=m.top,p=m.left,h=m.bottom,x=m.right;if(!bw({top:(t=jw(l)).top-u,left:t.left-p,bottom:t.bottom+h,right:t.right+x},{top:i,left:r}))return}if(!1!==this.emit("beforeSelect",this._initialEventData={isTouch:/^touch/.test(e.type),x:r,y:i,clientX:a,clientY:s}))switch(e.type){case"mousedown":this._removeEndListener=xw("mouseup",this._handleTerminatingEvent),this._onEscListener=xw("keydown",this._handleTerminatingEvent),this._removeMoveListener=xw("mousemove",this._handleMoveEvent);break;case"touchstart":this._handleMoveEvent(e),this._removeEndListener=xw("touchend",this._handleTerminatingEvent),this._removeMoveListener=xw("touchmove",this._handleMoveEvent)}}}}},{key:"_isWithinValidContainer",value:function(e){var t=e.target,n=this.validContainers;return!(n&&n.length&&t)||n.some(function(e){return!!t.closest(e)})}},{key:"_handleTerminatingEvent",value:function(e){var t=this.selecting,n=this._selectRect;if(!t&&e.type.includes("key")&&(e=this._initialEvent),this.selecting=!1,this._removeEndListener&&this._removeEndListener(),this._removeMoveListener&&this._removeMoveListener(),this._selectRect=null,this._initialEvent=null,this._initialEventData=null,e){var a=!this.container||Zv(this.container(),e.target),s=this._isWithinValidContainer(e);return"Escape"!==e.key&&s?!t&&a?this._handleClickEvent(e):t?this.emit("select",n):this.emit("reset"):this.emit("reset")}}},{key:"_handleClickEvent",value:function(e){var t=vw(e),n=t.pageX,a=t.pageY,s=t.clientX,r=t.clientY,i=(new Date).getTime();return this._lastClickData&&i-this._lastClickData.timestamp<250?(this._lastClickData=null,this.emit("doubleClick",{x:n,y:a,clientX:s,clientY:r})):(this._lastClickData={timestamp:i},this.emit("click",{x:n,y:a,clientX:s,clientY:r}))}},{key:"_handleMoveEvent",value:function(e){if(null!==this._initialEventData&&!this.isDetached){var t=this._initialEventData,n=t.x,a=t.y,s=vw(e),r=s.pageX,i=s.pageY,l=Math.abs(n-r),o=Math.abs(a-i),c=Math.min(r,n),d=Math.min(i,a),m=this.selecting,u=this.isClick(r,i);(!u||m||l||o)&&(m||u||this.emit("selectStart",this._initialEventData),u||(this.selecting=!0,this._selectRect={top:d,left:c,x:r,y:i,right:c+l,bottom:d+o},this.emit("selecting",this._selectRect)),e.preventDefault())}}},{key:"_keyListener",value:function(e){this.ctrl=e.metaKey||e.ctrlKey}},{key:"isClick",value:function(e,t){var n=this._initialEventData,a=n.x,s=n.y;return!n.isTouch&&Math.abs(e-a)<=5&&Math.abs(t-s)<=5}}])}();function bw(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=jw(e),s=a.top,r=a.left,i=a.right,l=void 0===i?r:i,o=a.bottom,c=void 0===o?s:o,d=jw(t),m=d.top,u=d.left,p=d.right,h=void 0===p?u:p,x=d.bottom;return!(c-n<m||s+n>(void 0===x?m:x)||l-n<u||r+n>h)}function jw(e){if(!e.getBoundingClientRect)return e;var t=e.getBoundingClientRect(),n=t.left+ww("left"),a=t.top+ww("top");return{top:a,left:n,right:(e.offsetWidth||0)+n,bottom:(e.offsetHeight||0)+a}}function ww(e){return"left"===e?window.pageXOffset||document.body.scrollLeft||0:"top"===e?window.pageYOffset||document.body.scrollTop||0:void 0}var Nw=function(){function e(t,n){var a;return $f(this,e),(a=Ff(this,e,[t,n])).state={selecting:!1},a.containerRef=re.createRef(),a}return Pf(e,ie.Component),Ef(e,[{key:"componentDidMount",value:function(){this.props.selectable&&this._selectable()}},{key:"componentWillUnmount",value:function(){this._teardownSelectable()}},{key:"componentDidUpdate",value:function(e){!e.selectable&&this.props.selectable&&this._selectable(),e.selectable&&!this.props.selectable&&this._teardownSelectable()}},{key:"render",value:function(){var e=this.props,t=e.range,n=e.getNow,a=e.getters,s=e.date,r=e.components.dateCellWrapper,i=e.localizer,l=this.state,o=l.selecting,c=l.startIdx,d=l.endIdx,m=n();return ie.createElement("div",{className:"rbc-row-bg",ref:this.containerRef},t.map(function(e,n){var l=o&&n>=c&&n<=d,u=a.dayProp(e),p=u.className,h=u.style;return ie.createElement(r,{key:n,value:e,range:t},ie.createElement("div",{style:h,className:Bf("rbc-day-bg",p,l&&"rbc-selected-cell",i.isSameDate(e,m)&&"rbc-today",s&&i.neq(s,e,"month")&&"rbc-off-range-bg")}))}))}},{key:"_selectable",value:function(){var e=this,t=this.containerRef.current,n=this._selector=new yw(this.props.container,{longPressThreshold:this.props.longPressThreshold}),a=function(n,a){if(!gw(t,n)&&!fw(t,n)){var s=jw(t),r=e.props,i=r.range,l=r.rtl;if(c=s,m=(d=n).x,(u=d.y)>=c.top&&u<=c.bottom&&m>=c.left&&m<=c.right){var o=dw(s,n.x,l,i.length);e._selectSlot({startIdx:o,endIdx:o,action:a,box:n})}}var c,d,m,u;e._initial={},e.setState({selecting:!1})};n.on("selecting",function(a){var s=e.props,r=s.range,i=s.rtl,l=-1,o=-1;if(e.state.selecting||(sw(e.props.onSelectStart,[a]),e._initial={x:a.x,y:a.y}),n.isSelected(t)){var c=jw(t),d=function(e,t,n,a,s){var r=-1,i=-1,l=a-1,o=cw(t,a),c=dw(t,n.x,s,a),d=t.top<n.y&&t.bottom>n.y,m=t.top<e.y&&t.bottom>e.y,u=e.y>t.bottom,p=t.top>e.y;return n.top<t.top&&n.bottom>t.bottom&&(r=0,i=l),d&&(p?(r=0,i=c):u&&(r=c,i=l)),m&&(r=i=s?l-Math.floor((e.x-t.left)/o):Math.floor((e.x-t.left)/o),d?c<r?r=c:i=c:e.y<n.y?i=l:r=0),{startIdx:r,endIdx:i}}(e._initial,c,a,r.length,i);l=d.startIdx,o=d.endIdx}e.setState({selecting:!0,startIdx:l,endIdx:o})}),n.on("beforeSelect",function(t){if("ignoreEvents"===e.props.selectable)return!gw(e.containerRef.current,t)}),n.on("click",function(e){return a(e,"click")}),n.on("doubleClick",function(e){return a(e,"doubleClick")}),n.on("select",function(t){e._selectSlot(Sf(Sf({},e.state),{},{action:"select",bounds:t})),e._initial={},e.setState({selecting:!1}),sw(e.props.onSelectEnd,[e.state])})}},{key:"_teardownSelectable",value:function(){this._selector&&(this._selector.teardown(),this._selector=null)}},{key:"_selectSlot",value:function(e){var t=e.endIdx,n=e.startIdx,a=e.action,s=e.bounds,r=e.box;-1!==t&&-1!==n&&this.props.onSelectSlot&&this.props.onSelectSlot({start:n,end:t,action:a,bounds:s,box:r,resourceId:this.props.resourceId})}}])}(),_w=(Re.object.isRequired,Re.object,Re.bool,Re.object.isRequired,Re.object.isRequired,Re.object.isRequired,Re.object.isRequired,Re.func,Re.func,Re.func,{segments:[],selected:{}}),kw=function(e,t){var n=e.selected;e.isAllDay;var a=e.accessors,s=e.getters,r=e.onSelect,i=e.onDoubleClick,l=e.onKeyPress,o=e.localizer,c=e.slotMetrics,d=e.components,m=e.resizable,u=c.continuesPrior(t),p=c.continuesAfter(t);return ie.createElement(lw,{event:t,getters:s,localizer:o,accessors:a,components:d,onSelect:r,onDoubleClick:i,onKeyPress:l,continuesPrior:u,continuesAfter:p,slotStart:c.first,slotEnd:c.last,selected:ow(t,n),resizable:m})},Sw=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ",s=Math.abs(t)/e*100+"%";return ie.createElement("div",{key:n,className:"rbc-row-segment",style:{WebkitFlexBasis:s,flexBasis:s,maxWidth:s}},a)},Cw=function(){function e(){return $f(this,e),Ff(this,e,arguments)}return Pf(e,ie.Component),Ef(e,[{key:"render",value:function(){var e=this,t=this.props,n=t.segments,a=t.slotMetrics.slots,s=t.className,r=1;return ie.createElement("div",{className:Bf(s,"rbc-row")},n.reduce(function(t,n,s){var i=n.event,l=n.left,o=n.right,c=n.span,d="_lvl_"+s,m=l-r,u=kw(e.props,i);return m&&t.push(Sw(a,m,"".concat(d,"_gap"))),t.push(Sw(a,c,d,u)),r=o+1,t},[]))}}])}();function $w(e){var t=e.dateRange,n=e.unit,a=void 0===n?"day":n,s=e.localizer;return{first:t[0],last:s.add(t[t.length-1],1,a)}}function Dw(e){var t,n,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=[],i=[];for(t=0;t<e.length;t++){for(a=e[t],n=0;n<r.length&&Tw(a,r[n]);n++);n>=s?i.push(a):(r[n]||(r[n]=[])).push(a)}for(t=0;t<r.length;t++)r[t].sort(function(e,t){return e.left-t.left});return{levels:r,extra:i}}function Ew(e,t,n,a,s){var r={start:a.start(e),end:a.end(e)},i={start:t,end:n};return s.inEventRange({event:r,range:i})}function Tw(e,t){return t.some(function(t){return t.left<=e.right&&t.right>=e.left})}function Aw(e,t,n,a){var s={start:n.start(e),end:n.end(e),allDay:n.allDay(e)},r={start:n.start(t),end:n.end(t),allDay:n.allDay(t)};return a.sortEvents({evtA:s,evtB:r})}Cw.defaultProps=Sf({},_w);var Fw=function(e,t){return e.left<=t&&e.right>=t},Pw=function(e,t){return e.filter(function(e){return Fw(e,t)}).map(function(e){return e.event})},Rw=function(){function e(){return $f(this,e),Ff(this,e,arguments)}return Pf(e,ie.Component),Ef(e,[{key:"render",value:function(){for(var e=this.props,t=e.segments,n=e.slotMetrics.slots,a=Dw(t).levels[0],s=1,r=1,i=[];s<=n;){var l="_lvl_"+s,o=a.filter(function(e){return Fw(e,s)})[0]||{},c=o.event,d=o.left,m=o.right,u=o.span;if(c){var p=Math.max(0,d-r);if(this.canRenderSlotEvent(d,u)){var h=kw(this.props,c);p&&i.push(Sw(n,p,l+"_gap")),i.push(Sw(n,u,l,h)),r=s=m+1}else p&&i.push(Sw(n,p,l+"_gap")),i.push(Sw(n,1,l,this.renderShowMore(t,s))),r=s+=1}else{if(this.getHiddenEventsForSlot(t,s).length>0){var x=s-r;x&&i.push(Sw(n,x,l+"_gap")),i.push(Sw(n,1,l,this.renderShowMore(t,s))),r=s+=1;continue}s++}}return ie.createElement("div",{className:"rbc-row"},i)}},{key:"getHiddenEventsForSlot",value:function(e,t){var n=Pw(e,t),a=Dw(e).levels[0].filter(function(e){return Fw(e,t)}).map(function(e){return e.event});return n.filter(function(e){return!a.some(function(t){return t===e})})}},{key:"canRenderSlotEvent",value:function(e,t){var n=this.props.segments;return Ze(e,e+t).every(function(e){return 1===Pw(n,e).length})}},{key:"renderShowMore",value:function(e,t){var n=this,a=this.props,s=a.localizer,r=a.slotMetrics,i=a.components,l=r.getEventsForSlot(t),o=Pw(e,t),c=o.length;if(null!=i&&i.showMore){var d=i.showMore,m=r.getDateForSlot(t-1);return!!c&&ie.createElement(d,{localizer:s,slotDate:m,slot:t,count:c,events:l,remainingEvents:o})}return!!c&&ie.createElement("button",{type:"button",key:"sm_"+t,className:Bf("rbc-button-link","rbc-show-more"),onClick:function(e){return n.showMore(t,e)}},s.messages.showMore(c,o,l))}},{key:"showMore",value:function(e,t){t.preventDefault(),t.stopPropagation(),this.props.onShowMore(e,t.target)}}])}();Rw.defaultProps=Sf({},_w);var Ow=function(e){var t=e.children;return ie.createElement("div",{className:"rbc-row-content-scroll-container"},t)},Mw=function(e,t){return e[0].range===t[0].range&&e[0].events===t[0].events};function Lw(){return rj(function(e){for(var t=e.range,n=e.events,a=e.maxRows,s=e.minRows,r=e.accessors,i=e.localizer,l=$w({dateRange:t,localizer:i}),o=l.first,c=l.last,d=n.map(function(e){return function(e,t,n,a){var s=$w({dateRange:t,localizer:a}),r=s.first,i=s.last,l=a.diff(r,i,"day"),o=a.max(a.startOf(n.start(e),"day"),r),c=a.min(a.ceil(n.end(e),"day"),i),d=tt(t,function(e){return a.isSameDate(e,o)}),m=a.diff(o,c,"day");return m=Math.min(m,l),{event:e,span:m=Math.max(m-a.segmentOffset,1),left:d+1,right:Math.max(d+m,1)}}(e,t,r,i)}),m=Dw(d,Math.max(a-1,1)),u=m.levels,p=m.extra,h=p.length>0?s-1:s;u.length<h;)u.push([]);return{first:o,last:c,levels:u,extra:p,range:t,slots:t.length,clone:function(t){return Lw()(Sf(Sf({},e),t))},getDateForSlot:function(e){return t[e]},getSlotForDate:function(e){return t.find(function(t){return i.isSameDate(t,e)})},getEventsForSlot:function(e){return d.filter(function(t){return function(e,t){return e.left<=t&&e.right>=t}(t,e)}).map(function(e){return e.event})},continuesPrior:function(e){return i.continuesPrior(r.start(e),o)},continuesAfter:function(e){var t=r.start(e),n=r.end(e);return i.continuesAfter(t,n,c)}}},Mw)}var Iw=function(){function e(){var t;$f(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Ff(this,e,[].concat(a))).handleSelectSlot=function(e){var n=t.props,a=n.range;(0,n.onSelectSlot)(a.slice(e.start,e.end+1),e)},t.handleShowMore=function(e,n){var a,s,r,i=t.props,l=i.range,o=i.onShowMore,c=t.slotMetrics(t.props),d=(a=t.containerRef.current,s=".rbc-row-bg",py(a.querySelectorAll(s)))[0];d&&(r=d.children[e-1]),o(c.getEventsForSlot(e),l[e-1],r,e,n)},t.getContainer=function(){var e=t.props.container;return e?e():t.containerRef.current},t.renderHeadingCell=function(e,n){var a=t.props,s=a.renderHeader,r=a.getNow,i=a.localizer;return s({date:e,key:"header_".concat(n),className:Bf("rbc-date-cell",i.isSameDate(e,r())&&"rbc-now")})},t.renderDummy=function(){var e=t.props,n=e.className,a=e.range,s=e.renderHeader,r=e.showAllEvents;return ie.createElement("div",{className:n,ref:t.containerRef},ie.createElement("div",{className:Bf("rbc-row-content",r&&"rbc-row-content-scrollable")},s&&ie.createElement("div",{className:"rbc-row",ref:t.headingRowRef},a.map(t.renderHeadingCell)),ie.createElement("div",{className:"rbc-row",ref:t.eventRowRef},ie.createElement("div",{className:"rbc-row-segment"},ie.createElement("div",{className:"rbc-event"},ie.createElement("div",{className:"rbc-event-content"}," "))))))},t.containerRef=re.createRef(),t.headingRowRef=re.createRef(),t.eventRowRef=re.createRef(),t.slotMetrics=Lw(),t}return Pf(e,ie.Component),Ef(e,[{key:"getRowLimit",value:function(){var e,t=ej(this.eventRowRef.current),n=null!==(e=this.headingRowRef)&&void 0!==e&&e.current?ej(this.headingRowRef.current):0,a=ej(this.containerRef.current)-n;return Math.max(Math.floor(a/t),1)}},{key:"render",value:function(){var e=this.props,t=e.date,n=e.rtl,a=e.range,s=e.className,r=e.selected,i=e.selectable,l=e.renderForMeasure,o=e.accessors,c=e.getters,d=e.components,m=e.getNow,u=e.renderHeader,p=e.onSelect,h=e.localizer,x=e.onSelectStart,g=e.onSelectEnd,f=e.onDoubleClick,v=e.onKeyPress,y=e.resourceId,b=e.longPressThreshold,j=e.isAllDay,w=e.resizable,N=e.showAllEvents;if(l)return this.renderDummy();var _=this.slotMetrics(this.props),k=_.levels,S=_.extra,C=N?Ow:Sj,$=d.weekWrapper,D={selected:r,accessors:o,getters:c,localizer:h,components:d,onSelect:p,onDoubleClick:f,onKeyPress:v,resourceId:y,slotMetrics:_,resizable:w};return ie.createElement("div",{className:s,role:"rowgroup",ref:this.containerRef},ie.createElement(Nw,{localizer:h,date:t,getNow:m,rtl:n,range:a,selectable:i,container:this.getContainer,getters:c,onSelectStart:x,onSelectEnd:g,onSelectSlot:this.handleSelectSlot,components:d,longPressThreshold:b,resourceId:y}),ie.createElement("div",{className:Bf("rbc-row-content",N&&"rbc-row-content-scrollable"),role:"row"},u&&ie.createElement("div",{className:"rbc-row ",ref:this.headingRowRef},a.map(this.renderHeadingCell)),ie.createElement(C,null,ie.createElement($,Object.assign({isAllDay:j},D,{rtl:this.props.rtl}),k.map(function(e,t){return ie.createElement(Cw,Object.assign({key:t,segments:e},D))}),!!S.length&&ie.createElement(Rw,Object.assign({segments:S,onShowMore:this.handleShowMore},D))))))}}])}();Iw.defaultProps={minRows:0,maxRows:1/0};var zw=function(e){var t=e.label;return ie.createElement("span",{role:"columnheader","aria-sort":"none"},t)},Bw=function(e){var t=e.label,n=e.drilldownView,a=e.onDrillDown;return n?ie.createElement("button",{type:"button",className:"rbc-button-link",onClick:a},t):ie.createElement("span",null,t)},Vw=["date","className"],Yw=function(){function e(){var t;$f(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Ff(this,e,[].concat(a))).getContainer=function(){return t.containerRef.current},t.renderWeek=function(e,n){var a=t.props,s=a.events,r=a.components,i=a.selectable,l=a.getNow,o=a.selected,c=a.date,d=a.localizer,m=a.longPressThreshold,u=a.accessors,p=a.getters,h=a.showAllEvents,x=t.state,g=x.needLimitMeasure,f=x.rowLimit,v=function(e,t,n,a,s){return e.filter(function(e){return Ew(e,t,n,a,s)})}(Rv(s),e[0],e[e.length-1],u,d),y=function(e,t,n){var a=Rv(e),s=[],r=[];a.forEach(function(e){var a=t.start(e),i=t.end(e);n.daySpan(a,i)>1?s.push(e):r.push(e)});var i=s.sort(function(e,a){return Aw(e,a,t,n)}),l=r.sort(function(e,a){return Aw(e,a,t,n)});return[].concat(Rv(i),Rv(l))}(v,u,d);return ie.createElement(Iw,{key:n,ref:0===n?t.slotRowRef:void 0,container:t.getContainer,className:"rbc-month-row",getNow:l,date:c,range:e,events:y,maxRows:h?1/0:f,selected:o,selectable:i,components:r,accessors:u,getters:p,localizer:d,renderHeader:t.readerDateHeading,renderForMeasure:g,onShowMore:t.handleShowMore,onSelect:t.handleSelectEvent,onDoubleClick:t.handleDoubleClickEvent,onKeyPress:t.handleKeyPressEvent,onSelectSlot:t.handleSelectSlot,longPressThreshold:m,rtl:t.props.rtl,resizable:t.props.resizable,showAllEvents:h})},t.readerDateHeading=function(e){var n=e.date,a=e.className,s=Cf(e,Vw),r=t.props,i=r.date,l=r.getDrilldownView,o=r.localizer,c=o.neq(i,n,"month"),d=o.isSameDate(n,i),m=l(n),u=o.format(n,"dateFormat"),p=t.props.components.dateHeader||Bw;return ie.createElement("div",Object.assign({},s,{className:Bf(a,c&&"rbc-off-range",d&&"rbc-current"),role:"cell"}),ie.createElement(p,{label:u,date:n,drilldownView:m,isOffRange:c,onDrillDown:function(e){return t.handleHeadingClick(n,m,e)}}))},t.handleSelectSlot=function(e,n){t._pendingSelection=t._pendingSelection.concat(e),clearTimeout(t._selectTimer),t._selectTimer=setTimeout(function(){return t.selectDates(n)})},t.handleHeadingClick=function(e,n,a){a.preventDefault(),t.clearSelection(),sw(t.props.onDrillDown,[e,n])},t.handleSelectEvent=function(){t.clearSelection();for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];sw(t.props.onSelectEvent,n)},t.handleDoubleClickEvent=function(){t.clearSelection();for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];sw(t.props.onDoubleClickEvent,n)},t.handleKeyPressEvent=function(){t.clearSelection();for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];sw(t.props.onKeyPressEvent,n)},t.handleShowMore=function(e,n,a,s,r){var i=t.props,l=i.popup,o=i.onDrillDown,c=i.onShowMore,d=i.getDrilldownView,m=i.doShowMoreDrillDown;if(t.clearSelection(),l){var u=ay(a,t.containerRef.current);t.setState({overlay:{date:n,events:e,position:u,target:r}})}else m&&sw(o,[n,d(n)||Tj.DAY]);sw(c,[e,n,s])},t.overlayDisplay=function(){t.setState({overlay:null})},t.state={rowLimit:5,needLimitMeasure:!0,date:null},t.containerRef=re.createRef(),t.slotRowRef=re.createRef(),t._bgRows=[],t._pendingSelection=[],t}return Pf(e,ie.Component),Ef(e,[{key:"componentDidMount",value:function(){var e,t=this;this.state.needLimitMeasure&&this.measureRowLimit(this.props),window.addEventListener("resize",this._resizeListener=function(){e||my(function(){e=!1,t.setState({needLimitMeasure:!0})})},!1)}},{key:"componentDidUpdate",value:function(){this.state.needLimitMeasure&&this.measureRowLimit(this.props)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._resizeListener,!1)}},{key:"render",value:function(){var e=this.props,t=e.date,n=e.localizer,a=e.className,s=n.visibleDays(t,n),r=Vv(s,7);return this._weekCount=r.length,ie.createElement("div",{className:Bf("rbc-month-view",a),role:"table","aria-label":"Month View",ref:this.containerRef},ie.createElement("div",{className:"rbc-row rbc-month-header",role:"row"},this.renderHeaders(r[0])),r.map(this.renderWeek),this.props.popup&&this.renderOverlay())}},{key:"renderHeaders",value:function(e){var t=this.props,n=t.localizer,a=t.components,s=e[0],r=e[e.length-1],i=a.header||zw;return n.range(s,r,"day").map(function(e,t){return ie.createElement("div",{key:"header_"+t,className:"rbc-header"},ie.createElement(i,{date:e,localizer:n,label:n.format(e,"weekdayFormat")}))})}},{key:"renderOverlay",value:function(){var e,t,n=this,a=null!==(e=null===(t=this.state)||void 0===t?void 0:t.overlay)&&void 0!==e?e:{},s=this.props,r=s.accessors,i=s.localizer,l=s.components,o=s.getters,c=s.selected,d=s.popupOffset,m=s.handleDragStart;return ie.createElement(hw,{overlay:a,accessors:r,localizer:i,components:l,getters:o,selected:c,popupOffset:d,ref:this.containerRef,handleKeyPressEvent:this.handleKeyPressEvent,handleSelectEvent:this.handleSelectEvent,handleDoubleClickEvent:this.handleDoubleClickEvent,handleDragStart:m,show:!!a.position,overlayDisplay:this.overlayDisplay,onHide:function(){return n.setState({overlay:null})}})}},{key:"measureRowLimit",value:function(){this.setState({needLimitMeasure:!1,rowLimit:this.slotRowRef.current.getRowLimit()})}},{key:"selectDates",value:function(e){var t=this._pendingSelection.slice();this._pendingSelection=[],t.sort(function(e,t){return+e-+t});var n=new Date(t[0]),a=new Date(t[t.length-1]);a.setDate(t[t.length-1].getDate()+1),sw(this.props.onSelectSlot,{slots:t,start:n,end:a,action:e.action,bounds:e.bounds,box:e.box})}},{key:"clearSelection",value:function(){clearTimeout(this._selectTimer),this._pendingSelection=[]}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.date;return{date:n,needLimitMeasure:e.localizer.neq(n,t.date,"month")}}}])}();Yw.range=function(e,t){var n=t.localizer;return{start:n.firstVisibleDay(e,n),end:n.lastVisibleDay(e,n)}},Yw.navigate=function(e,t,n){var a=n.localizer;switch(t){case Cj:return a.add(e,-1,"month");case $j:return a.add(e,1,"month");default:return e}},Yw.title=function(e,t){return t.localizer.format(e,"monthHeaderFormat")};var qw=function(e){var t=e.min,n=e.max,a=e.step,s=e.slots,r=e.localizer;return"".concat(+r.startOf(t,"minutes"))+"".concat(+r.startOf(n,"minutes"))+"".concat(a,"-").concat(s)};function Uw(e){for(var t=e.min,n=e.max,a=e.step,s=e.timeslots,r=e.localizer,i=qw({start:t,end:n,step:a,timeslots:s,localizer:r}),l=1+r.getTotalMin(t,n),o=r.getMinutesFromMidnight(t),c=Math.ceil((l-1)/(a*s)),d=c*s,m=new Array(c),u=new Array(d),p=0;p<c;p++){m[p]=new Array(s);for(var h=0;h<s;h++){var x=p*s+h,g=x*a;u[x]=m[p][h]=r.getSlotDate(t,o,g)}}var f=u.length*a;function v(e){var n=r.diff(t,e,"minutes")+r.getDstOffset(t,e);return Math.min(n,l)}return u.push(r.getSlotDate(t,o,f)),{groups:m,update:function(e){return qw(e)!==i?Uw(e):this},dateIsInGroup:function(e,t){var a=m[t+1];return r.inRange(e,m[t][0],a?a[0]:n,"minutes")},nextSlot:function(e){var t=u[Math.min(u.findIndex(function(t){return t===e||r.eq(t,e)})+1,u.length-1)];return r.eq(t,e)&&(t=r.add(e,a,"minutes")),t},closestSlotToPosition:function(e){var t=Math.min(u.length-1,Math.max(0,Math.floor(e*d)));return u[t]},closestSlotFromPoint:function(e,t){var n=Math.abs(t.top-t.bottom);return this.closestSlotToPosition((e.y-t.top)/n)},closestSlotFromDate:function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r.lt(e,t,"minutes"))return u[0];if(r.gt(e,n,"minutes"))return u[u.length-1];var i=r.diff(t,e,"minutes");return u[(i-i%a)/a+s]},startsBeforeDay:function(e){return r.lt(e,t,"day")},startsAfterDay:function(e){return r.gt(e,n,"day")},startsBefore:function(e){return r.lt(r.merge(t,e),t,"minutes")},startsAfter:function(e){return r.gt(r.merge(n,e),n,"minutes")},getRange:function(e,s,i,l){i||(e=r.min(n,r.max(t,e))),l||(s=r.min(n,r.max(t,s)));var o=v(e),c=v(s),m=c>a*d&&!r.eq(n,s)?(o-a)/(a*d)*100:o/(a*d)*100;return{top:m,height:c/(a*d)*100-m,start:v(e),startDate:e,end:v(s),endDate:s}},getCurrentTimePosition:function(e){return v(e)/(a*d)*100}}}var Hw=function(){return Ef(function e(t,n){var a=n.accessors,s=n.slotMetrics;$f(this,e);var r=s.getRange(a.start(t),a.end(t)),i=r.start,l=r.startDate,o=r.end,c=r.endDate,d=r.top,m=r.height;this.start=i,this.end=o,this.startMs=+l,this.endMs=+c,this.top=d,this.height=m,this.data=t},[{key:"_width",get:function(){if(this.rows){var e=this.rows.reduce(function(e,t){return Math.max(e,t.leaves.length+1)},0)+1;return 100/e}return this.leaves?(100-this.container._width)/(this.leaves.length+1):this.row._width}},{key:"width",get:function(){var e=this._width,t=Math.min(100,1.7*this._width);if(this.rows)return t;if(this.leaves)return this.leaves.length>0?t:e;var n=this.row.leaves;return n.indexOf(this)===n.length-1?e:t}},{key:"xOffset",get:function(){if(this.rows)return 0;if(this.leaves)return this.container._width;var e=this.row,t=e.leaves,n=e.xOffset,a=e._width;return n+(t.indexOf(this)+1)*a}}])}();function Gw(e,t,n){return Math.abs(t.start-e.start)<n||t.start>e.start&&t.start<e.end}function Ww(e){for(var t=e.events,n=e.minimumStartDifference,a=e.slotMetrics,s=e.accessors,r=function(e){for(var t=nt(e,["startMs",function(e){return-e.endMs}]),n=[];t.length>0;){var a=t.shift();n.push(a);for(var s=0;s<t.length;s++){var r=t[s];if(!(a.endMs>r.startMs)){if(s>0){var i=t.splice(s,1)[0];n.push(i)}break}}}return n}(t.map(function(e){return new Hw(e,{slotMetrics:a,accessors:s})})),i=[],l=function(){var e=r[o],t=i.find(function(t){return t.end>e.start||Math.abs(e.start-t.start)<n});if(!t)return e.rows=[],i.push(e),1;e.container=t;for(var a=null,s=t.rows.length-1;!a&&s>=0;s--)Gw(t.rows[s],e,n)&&(a=t.rows[s]);a?(a.leaves.push(e),e.row=a):(e.leaves=[],t.rows.push(e))},o=0;o<r.length;o++)l();return r.map(function(e){return{event:e.data,style:{top:e.top,height:e.height,width:e.width,xOffset:Math.max(0,e.xOffset)}}})}function Kw(e,t,n){for(var a=0;a<e.friends.length;++a)if(!(n.indexOf(e.friends[a])>-1)){t=t>e.friends[a].idx?t:e.friends[a].idx,n.push(e.friends[a]);var s=Kw(e.friends[a],t,n);t=t>s?t:s}return t}var Zw={overlap:Ww,"no-overlap":function(e){var t=Ww({events:e.events,minimumStartDifference:e.minimumStartDifference,slotMetrics:e.slotMetrics,accessors:e.accessors});t.sort(function(e,t){return e=e.style,t=t.style,e.top!==t.top?e.top>t.top?1:-1:e.height!==t.height?e.top+e.height<t.top+t.height?1:-1:0});for(var n=0;n<t.length;++n)t[n].friends=[],delete t[n].style.left,delete t[n].style.left,delete t[n].idx,delete t[n].size;for(var a=0;a<t.length-1;++a)for(var s=t[a],r=s.style.top,i=s.style.top+s.style.height,l=a+1;l<t.length;++l){var o=t[l],c=o.style.top,d=o.style.top+o.style.height;(c>=r&&d<=i||d>r&&d<=i||c>=r&&c<i)&&(s.friends.push(o),o.friends.push(s))}for(var m=0;m<t.length;++m){for(var u=t[m],p=[],h=0;h<100;++h)p.push(1);for(var x=0;x<u.friends.length;++x)void 0!==u.friends[x].idx&&(p[u.friends[x].idx]=0);u.idx=p.indexOf(1)}for(var g=0;g<t.length;++g){var f;if(!t[g].size){var v=[];f=100/(Kw(t[g],0,v)+1),t[g].size=f;for(var y=0;y<v.length;++y)v[y].size=f}}for(var b=0;b<t.length;++b){var j=t[b];j.style.left=j.idx*j.size;for(var w=0,N=0;N<j.friends.length;++N){var _=j.friends[N].idx;w=w>_?w:_}w<=j.idx&&(j.size=100-j.idx*j.size);var k=0===j.idx?0:3;j.style.width="calc(".concat(j.size,"% - ").concat(k,"px)"),j.style.height="calc(".concat(j.style.height,"% - 2px)"),j.style.xOffset="calc(".concat(j.style.left,"% + ").concat(k,"px)")}return t}};var Qw=function(){function e(){return $f(this,e),Ff(this,e,arguments)}return Pf(e,re.Component),Ef(e,[{key:"render",value:function(){var e=this.props,t=e.renderSlot,n=e.resource,a=e.group,s=e.getters,r=e.components,i=(void 0===r?{}:r).timeSlotWrapper,l=void 0===i?Sj:i,o=s?s.slotGroupProp(a):{};return ie.createElement("div",Object.assign({className:"rbc-timeslot-group"},o),a.map(function(e,a){var r=s?s.slotProp(e,n):{};return ie.createElement(l,{key:a,value:e,resource:n},ie.createElement("div",Object.assign({},r,{className:Bf("rbc-time-slot",r.className)}),t&&t(e,a)))}))}}])}();function Xw(e){return"string"==typeof e?e:e+"%"}function Jw(e){var t=e.style,n=e.className,a=e.event,s=e.accessors,r=e.rtl,i=e.selected,l=e.label,o=e.continuesPrior,c=e.continuesAfter,d=e.getters,m=e.onClick,u=e.onDoubleClick,p=e.isBackgroundEvent,h=e.onKeyPress,x=e.components,g=x.event,f=x.eventWrapper,v=s.title(a),y=s.tooltip(a),b=s.end(a),j=s.start(a),w=d.eventProp(a,j,b,i),N=[ie.createElement("div",{key:"1",className:"rbc-event-label"},l),ie.createElement("div",{key:"2",className:"rbc-event-content"},g?ie.createElement(g,{event:a,title:v}):v)],_=t.height,k=t.top,S=t.width,C=t.xOffset,$=Sf(Sf({},w.style),{},_f({top:Xw(k),height:Xw(_),width:Xw(S)},r?"right":"left",Xw(C)));return ie.createElement(f,Object.assign({type:"time"},e),ie.createElement("div",{role:"button",tabIndex:0,onClick:m,onDoubleClick:u,style:$,onKeyDown:h,title:y?("string"==typeof l?l+": ":"")+y:void 0,className:Bf(p?"rbc-background-event":"rbc-event",n,w.className,{"rbc-selected":i,"rbc-event-continues-earlier":o,"rbc-event-continues-later":c})},N))}var eN=function(e){var t=e.children,n=e.className,a=e.style,s=e.innerRef;return ie.createElement("div",{className:n,style:a,ref:s},t)},tN=ie.forwardRef(function(e,t){return ie.createElement(eN,Object.assign({},e,{innerRef:t}))}),nN=["dayProp"],aN=["eventContainerWrapper","timeIndicatorWrapper"],sN=function(){function e(){var t;$f(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Ff(this,e,[].concat(a))).state={selecting:!1,timeIndicatorPosition:null},t.intervalTriggered=!1,t.renderEvents=function(e){var n=e.events,a=e.isBackgroundEvent,s=t.props,r=s.rtl,i=s.selected,l=s.accessors,o=s.localizer,c=s.getters,d=s.components,m=s.step,u=s.timeslots,p=s.dayLayoutAlgorithm,h=s.resizable,x=t.slotMetrics,g=o.messages,f=function(e){e.events,e.minimumStartDifference,e.slotMetrics,e.accessors;var t=e.dayLayoutAlgorithm,n=t;return t in Zw&&(n=Zw[t]),function(e){return!!(e&&e.constructor&&e.call&&e.apply)}(n)?n.apply(this,arguments):[]}({events:n,accessors:l,slotMetrics:x,minimumStartDifference:Math.ceil(m*u/2),dayLayoutAlgorithm:p});return f.map(function(e,n){var s,m,u=e.event,p=e.style,f=l.end(u),v=l.start(u),y=null!==(s=l.eventId(u))&&void 0!==s?s:"evt_"+n,b="eventTimeRangeFormat",j=x.startsBeforeDay(v),w=x.startsAfterDay(f);j?b="eventTimeRangeEndFormat":w&&(b="eventTimeRangeStartFormat"),m=j&&w?g.allDay:o.format({start:v,end:f},b);var N=j||x.startsBefore(v),_=w||x.startsAfter(f);return ie.createElement(Jw,{style:p,event:u,label:m,key:y,getters:c,rtl:r,components:d,continuesPrior:N,continuesAfter:_,accessors:l,resource:t.props.resource,selected:ow(u,i),onClick:function(e){return t._select(Sf(Sf(Sf({},u),t.props.resource&&{sourceResource:t.props.resource}),a&&{isBackgroundEvent:!0}),e)},onDoubleClick:function(e){return t._doubleClick(u,e)},isBackgroundEvent:a,onKeyPress:function(e){return t._keyPress(u,e)},resizable:h})})},t._selectable=function(){var e=t.containerRef.current,n=t.props,a=n.longPressThreshold,s=n.localizer,r=t._selector=new yw(function(){return e},{longPressThreshold:a}),i=function(e){var n=t.props.onSelecting,a=t.state||{},r=l(e),i=r.startDate,o=r.endDate;n&&(s.eq(a.startDate,i,"minutes")&&s.eq(a.endDate,o,"minutes")||!1===n({start:i,end:o,resourceId:t.props.resource}))||t.state.start===r.start&&t.state.end===r.end&&t.state.selecting===r.selecting||t.setState(r)},l=function(n){var a=t.slotMetrics.closestSlotFromPoint(n,jw(e));t.state.selecting||(t._initialSlot=a);var r=t._initialSlot;s.lte(r,a)?a=t.slotMetrics.nextSlot(a):s.gt(r,a)&&(r=t.slotMetrics.nextSlot(r));var i=t.slotMetrics.getRange(s.min(r,a),s.max(r,a));return Sf(Sf({},i),{},{selecting:!0,top:"".concat(i.top,"%"),height:"".concat(i.height,"%")})},o=function(e,n){if(!gw(t.containerRef.current,e)){var a=l(e),s=a.startDate,r=a.endDate;t._selectSlot({startDate:s,endDate:r,action:n,box:e})}t.setState({selecting:!1})};r.on("selecting",i),r.on("selectStart",i),r.on("beforeSelect",function(e){if("ignoreEvents"===t.props.selectable)return!gw(t.containerRef.current,e)}),r.on("click",function(e){return o(e,"click")}),r.on("doubleClick",function(e){return o(e,"doubleClick")}),r.on("select",function(e){t.state.selecting&&(t._selectSlot(Sf(Sf({},t.state),{},{action:"select",bounds:e})),t.setState({selecting:!1}))}),r.on("reset",function(){t.state.selecting&&t.setState({selecting:!1})})},t._teardownSelectable=function(){t._selector&&(t._selector.teardown(),t._selector=null)},t._selectSlot=function(e){for(var n=e.startDate,a=e.endDate,s=e.action,r=e.bounds,i=e.box,l=n,o=[];t.props.localizer.lte(l,a);)o.push(l),l=new Date(+l+60*t.props.step*1e3);sw(t.props.onSelectSlot,{slots:o,start:n,end:a,resourceId:t.props.resource,action:s,bounds:r,box:i})},t._select=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];sw(t.props.onSelectEvent,n)},t._doubleClick=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];sw(t.props.onDoubleClickEvent,n)},t._keyPress=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];sw(t.props.onKeyPressEvent,n)},t.slotMetrics=Uw(t.props),t.containerRef=re.createRef(),t}return Pf(e,ie.Component),Ef(e,[{key:"componentDidMount",value:function(){this.props.selectable&&this._selectable(),this.props.isNow&&this.setTimeIndicatorPositionUpdateInterval()}},{key:"componentWillUnmount",value:function(){this._teardownSelectable(),this.clearTimeIndicatorInterval()}},{key:"componentDidUpdate",value:function(e,t){this.props.selectable&&!e.selectable&&this._selectable(),!this.props.selectable&&e.selectable&&this._teardownSelectable();var n=this.props,a=n.getNow,s=n.isNow,r=n.localizer,i=n.date,l=n.min,o=n.max,c=r.neq(e.getNow(),a(),"minutes");if(e.isNow!==s||c){if(this.clearTimeIndicatorInterval(),s){var d=!c&&r.eq(e.date,i,"minutes")&&t.timeIndicatorPosition===this.state.timeIndicatorPosition;this.setTimeIndicatorPositionUpdateInterval(d)}}else s&&(r.neq(e.min,l,"minutes")||r.neq(e.max,o,"minutes"))&&this.positionTimeIndicator()}},{key:"setTimeIndicatorPositionUpdateInterval",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.intervalTriggered||t||this.positionTimeIndicator(),this._timeIndicatorTimeout=window.setTimeout(function(){e.intervalTriggered=!0,e.positionTimeIndicator(),e.setTimeIndicatorPositionUpdateInterval()},6e4)}},{key:"clearTimeIndicatorInterval",value:function(){this.intervalTriggered=!1,window.clearTimeout(this._timeIndicatorTimeout)}},{key:"positionTimeIndicator",value:function(){var e=this.props,t=e.min,n=e.max,a=(0,e.getNow)();if(a>=t&&a<=n){var s=this.slotMetrics.getCurrentTimePosition(a);this.intervalTriggered=!0,this.setState({timeIndicatorPosition:s})}else this.clearTimeIndicatorInterval()}},{key:"render",value:function(){var e=this.props,t=e.date,n=e.max,a=e.rtl,s=e.isNow,r=e.resource,i=e.accessors,l=e.localizer,o=e.getters,c=o.dayProp,d=Cf(o,nN),m=e.components,u=m.eventContainerWrapper,p=m.timeIndicatorWrapper,h=Cf(m,aN);this.slotMetrics=this.slotMetrics.update(this.props);var x=this.slotMetrics,g=this.state,f=g.selecting,v=g.top,y=g.height,b={start:g.startDate,end:g.endDate},j=c(n,r),w=j.className,N=j.style,_={className:"rbc-current-time-indicator",style:{top:"".concat(this.state.timeIndicatorPosition,"%")}},k=h.dayColumnWrapper||tN;return ie.createElement(k,{ref:this.containerRef,date:t,style:N,className:Bf(w,"rbc-day-slot","rbc-time-column",s&&"rbc-now",s&&"rbc-today",f&&"rbc-slot-selecting"),slotMetrics:x,resource:r},x.groups.map(function(e,t){return ie.createElement(Qw,{key:t,group:e,resource:r,getters:d,components:h})}),ie.createElement(u,{localizer:l,resource:r,accessors:i,getters:d,components:h,slotMetrics:x},ie.createElement("div",{className:Bf("rbc-events-container",a&&"rtl")},this.renderEvents({events:this.props.backgroundEvents,isBackgroundEvent:!0}),this.renderEvents({events:this.props.events}))),f&&ie.createElement("div",{className:"rbc-slot-selection",style:{top:v,height:y}},ie.createElement("span",null,l.format(b,"selectRangeFormat"))),s&&this.intervalTriggered&&ie.createElement(p,_,ie.createElement("div",_)))}}])}();sN.defaultProps={dragThroughEvents:!0,timeslots:2};var rN=function(e){var t=e.label;return ie.createElement(ie.Fragment,null,t)},iN=function(){function e(){var t;$f(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Ff(this,e,[].concat(a))).handleHeaderClick=function(e,n,a){a.preventDefault(),sw(t.props.onDrillDown,[e,n])},t.renderRow=function(e){var n=t.props,a=n.events,s=n.rtl,r=n.selectable,i=n.getNow,l=n.range,o=n.getters,c=n.localizer,d=n.accessors,m=n.components,u=n.resizable,p=d.resourceId(e),h=e?a.filter(function(e){return d.resource(e)===p}):a;return ie.createElement(Iw,{isAllDay:!0,rtl:s,getNow:i,minRows:2,maxRows:t.props.allDayMaxRows+1,range:l,events:h,resourceId:p,className:"rbc-allday-cell",selectable:r,selected:t.props.selected,components:m,accessors:d,getters:o,localizer:c,onSelect:t.props.onSelectEvent,onShowMore:t.props.onShowMore,onDoubleClick:t.props.onDoubleClickEvent,onKeyPress:t.props.onKeyPressEvent,onSelectSlot:t.props.onSelectSlot,longPressThreshold:t.props.longPressThreshold,resizable:u})},t}return Pf(e,ie.Component),Ef(e,[{key:"renderHeaderCells",value:function(e){var t=this,n=this.props,a=n.localizer,s=n.getDrilldownView,r=n.getNow,i=n.getters.dayProp,l=n.components.header,o=void 0===l?zw:l,c=r();return e.map(function(e,n){var r=s(e),l=a.format(e,"dayFormat"),d=i(e),m=d.className,u=d.style,p=ie.createElement(o,{date:e,label:l,localizer:a});return ie.createElement("div",{key:n,style:u,className:Bf("rbc-header",m,a.isSameDate(e,c)&&"rbc-today")},r?ie.createElement("button",{type:"button",className:"rbc-button-link",onClick:function(n){return t.handleHeaderClick(e,r,n)}},p):ie.createElement("span",null,p))})}},{key:"render",value:function(){var e=this,t=this.props,n=t.width,a=t.rtl,s=t.resources,r=t.range,i=t.events,l=t.getNow,o=t.accessors,c=t.selectable,d=t.components,m=t.getters,u=t.scrollRef,p=t.localizer,h=t.isOverflowing,x=t.components,g=x.timeGutterHeader,f=x.resourceHeader,v=void 0===f?rN:f,y=t.resizable,b={};h&&(b[a?"marginLeft":"marginRight"]="".concat(Gb()-1,"px"));var j=s.groupEvents(i);return ie.createElement("div",{style:b,ref:u,className:Bf("rbc-time-header",h&&"rbc-overflowing")},ie.createElement("div",{className:"rbc-label rbc-time-header-gutter",style:{width:n,minWidth:n,maxWidth:n}},g&&ie.createElement(g,null)),s.map(function(t,n){var s=If(t,2),i=s[0],u=s[1];return ie.createElement("div",{className:"rbc-time-header-content",key:i||n},u&&ie.createElement("div",{className:"rbc-row rbc-row-resource",key:"resource_".concat(n)},ie.createElement("div",{className:"rbc-header"},ie.createElement(v,{index:n,label:o.resourceTitle(u),resource:u}))),ie.createElement("div",{className:"rbc-row rbc-time-header-cell".concat(r.length<=1?" rbc-time-header-cell-single-day":"")},e.renderHeaderCells(r)),ie.createElement(Iw,{isAllDay:!0,rtl:a,getNow:l,minRows:2,maxRows:e.props.allDayMaxRows+1,range:r,events:j.get(i)||[],resourceId:u&&i,className:"rbc-allday-cell",selectable:c,selected:e.props.selected,components:d,accessors:o,getters:m,localizer:p,onSelect:e.props.onSelectEvent,onShowMore:e.props.onShowMore,onDoubleClick:e.props.onDoubleClickEvent,onKeyDown:e.props.onKeyPressEvent,onSelectSlot:e.props.onSelectSlot,longPressThreshold:e.props.longPressThreshold,resizable:y}))}))}}])}(),lN=function(){function e(){var t;$f(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Ff(this,e,[].concat(a))).handleHeaderClick=function(e,n,a){a.preventDefault(),sw(t.props.onDrillDown,[e,n])},t}return Pf(e,ie.Component),Ef(e,[{key:"renderHeaderCells",value:function(e){var t=this,n=this.props,a=n.localizer,s=n.getDrilldownView,r=n.getNow,i=n.getters.dayProp,l=n.components,o=l.header,c=void 0===o?zw:o,d=l.resourceHeader,m=void 0===d?rN:d,u=n.resources,p=n.accessors,h=n.events,x=n.rtl,g=n.selectable,f=n.components,v=n.getters,y=n.resizable,b=r(),j=u.groupEvents(h);return e.map(function(n,l){var o=s(n),d=a.format(n,"dayFormat"),h=i(n),w=h.className,N=h.style,_=ie.createElement(c,{date:n,label:d,localizer:a});return ie.createElement("div",{key:l,className:"rbc-time-header-content rbc-resource-grouping"},ie.createElement("div",{className:"rbc-row rbc-time-header-cell".concat(e.length<=1?" rbc-time-header-cell-single-day":"")},ie.createElement("div",{style:N,className:Bf("rbc-header",w,a.isSameDate(n,b)&&"rbc-today")},o?ie.createElement("button",{type:"button",className:"rbc-button-link",onClick:function(e){return t.handleHeaderClick(n,o,e)}},_):ie.createElement("span",null,_))),ie.createElement("div",{className:"rbc-row"},u.map(function(e,t){var s=If(e,2),r=s[0],i=s[1];return ie.createElement("div",{key:"resource_".concat(r,"_").concat(t),className:Bf("rbc-header",w,a.isSameDate(n,b)&&"rbc-today")},ie.createElement(m,{index:t,label:p.resourceTitle(i),resource:i}))})),ie.createElement("div",{className:"rbc-row rbc-m-b-negative-3 rbc-h-full"},u.map(function(e,s){var i=If(e,2),l=i[0],o=i[1],c=(j.get(l)||[]).filter(function(e){return a.isSameDate(e.start,n)||a.isSameDate(e.end,n)});return ie.createElement(Iw,{key:"resource_".concat(l,"_").concat(s),isAllDay:!0,rtl:x,getNow:r,minRows:2,maxRows:t.props.allDayMaxRows+1,range:[n],events:c,resourceId:o&&l,className:"rbc-allday-cell",selectable:g,selected:t.props.selected,components:f,accessors:p,getters:v,localizer:a,onSelect:t.props.onSelectEvent,onShowMore:t.props.onShowMore,onDoubleClick:t.props.onDoubleClickEvent,onKeyDown:t.props.onKeyPressEvent,onSelectSlot:t.props.onSelectSlot,longPressThreshold:t.props.longPressThreshold,resizable:y})})))})}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.rtl,a=e.range,s=e.scrollRef,r=e.isOverflowing,i=e.components.timeGutterHeader,l={};return r&&(l[n?"marginLeft":"marginRight"]="".concat(Gb()-1,"px")),ie.createElement("div",{style:l,ref:s,className:Bf("rbc-time-header",r&&"rbc-overflowing")},ie.createElement("div",{className:"rbc-label rbc-time-header-gutter",style:{width:t,minWidth:t,maxWidth:t}},i&&ie.createElement(i,null)),this.renderHeaderCells(a))}}])}();var oN=function(e){var t=e.min,n=e.max,a=e.timeslots,s=e.step,r=e.localizer,i=e.getNow,l=e.resource,o=e.components,c=e.getters,d=e.gutterRef,m=o.timeGutterWrapper,u=re.useMemo(function(){return function(e){var t=e.min,n=e.max,a=e.localizer;return a.getTimezoneOffset(t)!==a.getTimezoneOffset(n)?{start:a.add(t,-1,"day"),end:a.add(n,-1,"day")}:{start:t,end:n}}({min:t,max:n,localizer:r})},[null==t?void 0:t.toISOString(),null==n?void 0:n.toISOString(),r]),p=u.start,h=u.end,x=If(re.useState(Uw({min:p,max:h,timeslots:a,step:s,localizer:r})),2),g=x[0],f=x[1];re.useEffect(function(){g&&f(g.update({min:p,max:h,timeslots:a,step:s,localizer:r}))},[null==p?void 0:p.toISOString(),null==h?void 0:h.toISOString(),a,s]);var v=re.useCallback(function(e,t){if(t)return null;var n=g.dateIsInGroup(i(),t);return ie.createElement("span",{className:Bf("rbc-label",n&&"rbc-now")},r.format(e,"timeGutterFormat"))},[g,r,i]);return ie.createElement(m,{slotMetrics:g},ie.createElement("div",{className:"rbc-time-gutter rbc-time-column",ref:d},g.groups.map(function(e,t){return ie.createElement(Qw,{key:t,group:e,resource:l,components:o,renderSlot:v,getters:c})})))},cN=ie.forwardRef(function(e,t){return ie.createElement(oN,Object.assign({gutterRef:t},e))}),dN={};var mN=function(){function e(t){var n;return $f(this,e),(n=Ff(this,e,[t])).handleScroll=function(e){n.scrollRef.current&&(n.scrollRef.current.scrollLeft=e.target.scrollLeft)},n.handleResize=function(){dy(n.rafHandle),n.rafHandle=my(n.checkOverflow)},n.handleKeyPressEvent=function(){n.clearSelection();for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];sw(n.props.onKeyPressEvent,t)},n.handleSelectEvent=function(){n.clearSelection();for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];sw(n.props.onSelectEvent,t)},n.handleDoubleClickEvent=function(){n.clearSelection();for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];sw(n.props.onDoubleClickEvent,t)},n.handleShowMore=function(e,t,a,s,r){var i=n.props,l=i.popup,o=i.onDrillDown,c=i.onShowMore,d=i.getDrilldownView,m=i.doShowMoreDrillDown;if(n.clearSelection(),l){var u=ay(a,n.containerRef.current);n.setState({overlay:{date:t,events:e,position:Sf(Sf({},u),{},{width:"200px"}),target:r}})}else m&&sw(o,[t,d(t)||Tj.DAY]);sw(c,[e,t,s])},n.handleSelectAllDaySlot=function(e,t){var a=n.props.onSelectSlot,s=new Date(e[0]),r=new Date(e[e.length-1]);r.setDate(e[e.length-1].getDate()+1),sw(a,{slots:e,start:s,end:r,action:t.action,resourceId:t.resourceId})},n.overlayDisplay=function(){n.setState({overlay:null})},n.checkOverflow=function(){if(!n._updatingOverflow){var e=n.contentRef.current;if(null!=e&&e.scrollHeight){var t=e.scrollHeight>e.clientHeight;n.state.isOverflowing!==t&&(n._updatingOverflow=!0,n.setState({isOverflowing:t},function(){n._updatingOverflow=!1}))}}},n.memoizedResources=rj(function(e,t){return function(e,t){return{map:function(n){return e?e.map(function(e,a){return n([t.resourceId(e),e],a)}):[n([dN,null],0)]},groupEvents:function(n){var a=new Map;return e?(n.forEach(function(e){var n=t.resource(e)||dN;if(Array.isArray(n))n.forEach(function(t){var n=a.get(t)||[];n.push(e),a.set(t,n)});else{var s=a.get(n)||[];s.push(e),a.set(n,s)}}),a):(a.set(dN,n),a)}}}(e,t)}),n.state={gutterWidth:void 0,isOverflowing:null},n.scrollRef=ie.createRef(),n.contentRef=ie.createRef(),n.containerRef=ie.createRef(),n._scrollRatio=null,n.gutterRef=re.createRef(),n}return Pf(e,re.Component),Ef(e,[{key:"getSnapshotBeforeUpdate",value:function(){return this.checkOverflow(),null}},{key:"componentDidMount",value:function(){null==this.props.width&&this.measureGutter(),this.calculateScroll(),this.applyScroll(),window.addEventListener("resize",this.handleResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),dy(this.rafHandle),this.measureGutterAnimationFrameRequest&&window.cancelAnimationFrame(this.measureGutterAnimationFrameRequest)}},{key:"componentDidUpdate",value:function(){this.applyScroll()}},{key:"renderDayColumn",value:function(e,t,n,a,s,r,i,l,o,c){var d=this.props,m=d.min,u=d.max,p=(a.get(t)||[]).filter(function(t){return r.inRange(e,i.start(t),i.end(t),"day")}),h=(s.get(t)||[]).filter(function(t){return r.inRange(e,i.start(t),i.end(t),"day")});return ie.createElement(sN,Object.assign({},this.props,{localizer:r,min:r.merge(e,m),max:r.merge(e,u),resource:n&&t,components:l,isNow:r.isSameDate(e,c),key:"".concat(t,"-").concat(e),date:e,events:p,backgroundEvents:h,dayLayoutAlgorithm:o}))}},{key:"renderResourcesFirst",value:function(e,t,n,a,s,r,i,l,o){var c=this;return t.map(function(t){var d=If(t,2),m=d[0],u=d[1];return e.map(function(e){return c.renderDayColumn(e,m,u,n,a,s,r,l,o,i)})})}},{key:"renderRangeFirst",value:function(e,t,n,a,s,r,i,l,o){var c=this;return e.map(function(e){return ie.createElement("div",{style:{display:"flex",minHeight:"100%",flex:1},key:e},t.map(function(t){var d=If(t,2),m=d[0],u=d[1];return ie.createElement("div",{style:{flex:1},key:r.resourceId(u)},c.renderDayColumn(e,m,u,n,a,s,r,l,o,i))}))})}},{key:"renderEvents",value:function(e,t,n,a){var s=this.props,r=s.accessors,i=s.localizer,l=s.resourceGroupingLayout,o=s.components,c=s.dayLayoutAlgorithm,d=this.memoizedResources(this.props.resources,r),m=d.groupEvents(t),u=d.groupEvents(n);return l?this.renderRangeFirst(e,d,m,u,i,r,a,o,c):this.renderResourcesFirst(e,d,m,u,i,r,a,o,c)}},{key:"render",value:function(){var e,t=this.props,n=t.events,a=t.backgroundEvents,s=t.range,r=t.width,i=t.rtl,l=t.selected,o=t.getNow,c=t.resources,d=t.components,m=t.accessors,u=t.getters,p=t.localizer,h=t.min,x=t.max,g=t.showMultiDayTimes,f=t.longPressThreshold,v=t.resizable,y=t.resourceGroupingLayout;r=r||this.state.gutterWidth;var b=s[0],j=s[s.length-1];this.slots=s.length;var w=[],N=[],_=[];n.forEach(function(e){if(Ew(e,b,j,m,p)){var t=m.start(e),n=m.end(e);m.allDay(e)||p.startAndEndAreDateOnly(t,n)||!g&&!p.isSameDate(t,n)?w.push(e):N.push(e)}}),a.forEach(function(e){Ew(e,b,j,m,p)&&_.push(e)}),w.sort(function(e,t){return Aw(e,t,m,p)});var k={range:s,events:w,width:r,rtl:i,getNow:o,localizer:p,selected:l,allDayMaxRows:this.props.showAllEvents?1/0:null!==(e=this.props.allDayMaxRows)&&void 0!==e?e:1/0,resources:this.memoizedResources(c,m),selectable:this.props.selectable,accessors:m,getters:u,components:d,scrollRef:this.scrollRef,isOverflowing:this.state.isOverflowing,longPressThreshold:f,onSelectSlot:this.handleSelectAllDaySlot,onSelectEvent:this.handleSelectEvent,onShowMore:this.handleShowMore,onDoubleClickEvent:this.props.onDoubleClickEvent,onKeyPressEvent:this.props.onKeyPressEvent,onDrillDown:this.props.onDrillDown,getDrilldownView:this.props.getDrilldownView,resizable:v};return ie.createElement("div",{className:Bf("rbc-time-view",c&&"rbc-time-view-resources"),ref:this.containerRef},c&&c.length>1&&y?ie.createElement(lN,k):ie.createElement(iN,k),this.props.popup&&this.renderOverlay(),ie.createElement("div",{ref:this.contentRef,className:"rbc-time-content",onScroll:this.handleScroll},ie.createElement(cN,{date:b,ref:this.gutterRef,localizer:p,min:p.merge(b,h),max:p.merge(b,x),step:this.props.step,getNow:this.props.getNow,timeslots:this.props.timeslots,components:d,className:"rbc-time-gutter",getters:u}),this.renderEvents(s,N,_,o())))}},{key:"renderOverlay",value:function(){var e,t,n=this,a=null!==(e=null===(t=this.state)||void 0===t?void 0:t.overlay)&&void 0!==e?e:{},s=this.props,r=s.accessors,i=s.localizer,l=s.components,o=s.getters,c=s.selected,d=s.popupOffset,m=s.handleDragStart;return ie.createElement(hw,{overlay:a,accessors:r,localizer:i,components:l,getters:o,selected:c,popupOffset:d,ref:this.containerRef,handleKeyPressEvent:this.handleKeyPressEvent,handleSelectEvent:this.handleSelectEvent,handleDoubleClickEvent:this.handleDoubleClickEvent,handleDragStart:m,show:!!a.position,overlayDisplay:this.overlayDisplay,onHide:function(){return n.setState({overlay:null})}})}},{key:"clearSelection",value:function(){clearTimeout(this._selectTimer),this._pendingSelection=[]}},{key:"measureGutter",value:function(){var e=this;this.measureGutterAnimationFrameRequest&&window.cancelAnimationFrame(this.measureGutterAnimationFrameRequest),this.measureGutterAnimationFrameRequest=window.requestAnimationFrame(function(){var t,n=null!==(t=e.gutterRef)&&void 0!==t&&t.current?ij(e.gutterRef.current):void 0;n&&e.state.gutterWidth!==n&&e.setState({gutterWidth:n})})}},{key:"applyScroll",value:function(){if(null!=this._scrollRatio&&!0===this.props.enableAutoScroll){var e=this.contentRef.current;e.scrollTop=e.scrollHeight*this._scrollRatio,this._scrollRatio=null}}},{key:"calculateScroll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=e.min,n=e.max,a=e.scrollToTime,s=e.localizer,r=s.diff(s.merge(a,t),a,"milliseconds"),i=s.diff(t,n,"milliseconds");this._scrollRatio=r/i}}])}();mN.defaultProps={step:30,timeslots:2,resourceGroupingLayout:!1};var uN=["date","localizer","min","max","scrollToTime","enableAutoScroll"],pN=function(){function e(){return $f(this,e),Ff(this,e,arguments)}return Pf(e,ie.Component),Ef(e,[{key:"render",value:function(){var t=this.props,n=t.date,a=t.localizer,s=t.min,r=void 0===s?a.startOf(new Date,"day"):s,i=t.max,l=void 0===i?a.endOf(new Date,"day"):i,o=t.scrollToTime,c=void 0===o?a.startOf(new Date,"day"):o,d=t.enableAutoScroll,m=void 0===d||d,u=Cf(t,uN),p=e.range(n,{localizer:a});return ie.createElement(mN,Object.assign({},u,{range:p,eventOffset:10,localizer:a,min:r,max:l,scrollToTime:c,enableAutoScroll:m}))}}])}();pN.range=function(e,t){return[t.localizer.startOf(e,"day")]},pN.navigate=function(e,t,n){var a=n.localizer;switch(t){case Cj:return a.add(e,-1,"day");case $j:return a.add(e,1,"day");default:return e}},pN.title=function(e,t){return t.localizer.format(e,"dayHeaderFormat")};var hN=["date","localizer","min","max","scrollToTime","enableAutoScroll"],xN=function(){function e(){return $f(this,e),Ff(this,e,arguments)}return Pf(e,ie.Component),Ef(e,[{key:"render",value:function(){var t=this.props,n=t.date,a=t.localizer,s=t.min,r=void 0===s?a.startOf(new Date,"day"):s,i=t.max,l=void 0===i?a.endOf(new Date,"day"):i,o=t.scrollToTime,c=void 0===o?a.startOf(new Date,"day"):o,d=t.enableAutoScroll,m=void 0===d||d,u=Cf(t,hN),p=e.range(n,this.props);return ie.createElement(mN,Object.assign({},u,{range:p,eventOffset:15,localizer:a,min:r,max:l,scrollToTime:c,enableAutoScroll:m}))}}])}();xN.defaultProps=mN.defaultProps,xN.navigate=function(e,t,n){var a=n.localizer;switch(t){case Cj:return a.add(e,-1,"week");case $j:return a.add(e,1,"week");default:return e}},xN.range=function(e,t){var n=t.localizer,a=n.startOfWeek(),s=n.startOf(e,"week",a),r=n.endOf(e,"week",a);return n.range(s,r)},xN.title=function(e,t){var n=t.localizer,a=lj(xN.range(e,{localizer:n})),s=a[0],r=a.slice(1);return n.format({start:s,end:r.pop()},"dayRangeHeaderFormat")};var gN=["date","localizer","min","max","scrollToTime","enableAutoScroll"];function fN(e,t){return xN.range(e,t).filter(function(e){return-1===[6,0].indexOf(e.getDay())})}var vN=function(){function e(){return $f(this,e),Ff(this,e,arguments)}return Pf(e,ie.Component),Ef(e,[{key:"render",value:function(){var e=this.props,t=e.date,n=e.localizer,a=e.min,s=void 0===a?n.startOf(new Date,"day"):a,r=e.max,i=void 0===r?n.endOf(new Date,"day"):r,l=e.scrollToTime,o=void 0===l?n.startOf(new Date,"day"):l,c=e.enableAutoScroll,d=void 0===c||c,m=Cf(e,gN),u=fN(t,this.props);return ie.createElement(mN,Object.assign({},m,{range:u,eventOffset:15,localizer:n,min:s,max:i,scrollToTime:o,enableAutoScroll:d}))}}])}();vN.defaultProps=mN.defaultProps,vN.range=fN,vN.navigate=xN.navigate,vN.title=function(e,t){var n=t.localizer,a=lj(fN(e,{localizer:n})),s=a[0],r=a.slice(1);return n.format({start:s,end:r.pop()},"dayRangeHeaderFormat")};function yN(e){var t=e.accessors,n=e.components,a=e.date,s=e.events,r=e.getters,i=e.length,l=void 0===i?30:i,o=e.localizer,c=e.onDoubleClickEvent,d=e.onSelectEvent,m=e.selected,u=re.useRef(null),p=re.useRef(null),h=re.useRef(null),x=re.useRef(null),g=re.useRef(null);re.useEffect(function(){v()});var f=function(e,a){var s="",r=n.time,i=o.messages.allDay,l=t.end(a),c=t.start(a);return t.allDay(a)||(o.eq(c,l)?i=o.format(c,"agendaTimeFormat"):o.isSameDate(c,l)?i=o.format({start:c,end:l},"agendaTimeRangeFormat"):o.isSameDate(e,c)?i=o.format(c,"agendaTimeFormat"):o.isSameDate(e,l)&&(i=o.format(l,"agendaTimeFormat"))),o.gt(e,c,"day")&&(s="rbc-continues-prior"),o.lt(e,l,"day")&&(s+=" rbc-continues-after"),ie.createElement("span",{className:s.trim()},r?ie.createElement(r,{event:a,day:e,label:i}):i)},v=function(){if(g.current){var e=u.current,t=g.current.firstChild;if(t){var n=x.current.scrollHeight>x.current.clientHeight,a=[],s=a;a=[ij(t.children[0]),ij(t.children[1])],s[0]===a[0]&&s[1]===a[1]||(p.current.style.width=a[0]+"px",h.current.style.width=a[1]+"px"),n?(Xe(e,"rbc-header-overflowing"),e.style.marginRight=Gb()+"px"):Je(e,"rbc-header-overflowing")}}},y=o.messages,b=o.add(a,l,"day"),j=o.range(a,b,"day");return(s=s.filter(function(e){return Ew(e,o.startOf(a,"day"),o.endOf(b,"day"),t,o)})).sort(function(e,n){return+t.start(e)-+t.start(n)}),ie.createElement("div",{className:"rbc-agenda-view"},0!==s.length?ie.createElement(ie.Fragment,null,ie.createElement("table",{ref:u,className:"rbc-agenda-table"},ie.createElement("thead",null,ie.createElement("tr",null,ie.createElement("th",{className:"rbc-header",ref:p},y.date),ie.createElement("th",{className:"rbc-header",ref:h},y.time),ie.createElement("th",{className:"rbc-header"},y.event)))),ie.createElement("div",{className:"rbc-agenda-content",ref:x},ie.createElement("table",{className:"rbc-agenda-table"},ie.createElement("tbody",{ref:g},j.map(function(e,a){return function(e,a,s){var i=n.event,l=n.date;return a=a.filter(function(n){return Ew(n,o.startOf(e,"day"),o.endOf(e,"day"),t,o)}),a.map(function(n,u){var p=t.title(n),h=t.end(n),x=t.start(n),g=r.eventProp(n,x,h,ow(n,m)),v=0===u&&o.format(e,"agendaDateFormat"),y=0===u&&ie.createElement("td",{rowSpan:a.length,className:"rbc-agenda-date-cell"},l?ie.createElement(l,{day:e,label:v}):v);return ie.createElement("tr",{key:s+"_"+u,className:g.className,style:g.style},y,ie.createElement("td",{className:"rbc-agenda-time-cell"},f(e,n)),ie.createElement("td",{className:"rbc-agenda-event-cell",onClick:function(e){return d&&d(n,e)},onDoubleClick:function(e){return c&&c(n,e)}},i?ie.createElement(i,{event:n,title:p}):p))},[])}(e,s,a)}))))):ie.createElement("span",{className:"rbc-agenda-empty"},y.noEventsInRange))}yN.range=function(e,t){var n=t.length,a=void 0===n?30:n;return{start:e,end:t.localizer.add(e,a,"day")}},yN.navigate=function(e,t,n){var a=n.length,s=void 0===a?30:a,r=n.localizer;switch(t){case Cj:return r.add(e,-s,"day");case $j:return r.add(e,s,"day");default:return e}},yN.title=function(e,t){var n=t.length,a=void 0===n?30:n,s=t.localizer,r=s.add(e,a,"day");return s.format({start:e,end:r},"agendaHeaderFormat")};var bN=_f(_f(_f(_f(_f({},Tj.MONTH,Yw),Tj.WEEK,xN),Tj.WORK_WEEK,vN),Tj.DAY,pN),Tj.AGENDA,yN),jN=["action","date","today"];var wN=function(e){return function(t){return function(e,t){var n=null;return"function"==typeof t?n=t(e):"string"==typeof t&&"object"===lt(e)&&null!=e&&t in e&&(n=e[t]),n}(t,e)}},NN=["view","date","getNow","onNavigate"],_N=["view","toolbar","events","backgroundEvents","resourceGroupingLayout","style","className","elementProps","date","getNow","length","showMultiDayTimes","onShowMore","doShowMoreDrillDown","components","formats","messages","culture"];function kN(e){if(Array.isArray(e))return e;for(var t=[],n=0,a=Object.entries(e);n<a.length;n++){var s=If(a[n],2),r=s[0];s[1]&&t.push(r)}return t}var SN=function(){function e(){var t;$f(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=Ff(this,e,[].concat(a))).getViews=function(){var e=t.props.views;return Array.isArray(e)?kj(e,function(e,t){return e[t]=bN[t]},{}):"object"===lt(e)?et(e,function(e,t){return!0===e?bN[t]:e}):bN},t.getView=function(){return t.getViews()[t.props.view]},t.getDrilldownView=function(e){var n=t.props,a=n.view,s=n.drilldownView,r=n.getDrilldownView;return r?r(e,a,Object.keys(t.getViews())):s},t.handleRangeChange=function(e,n,a){var s=t.props,r=s.onRangeChange,i=s.localizer;r&&n.range&&r(n.range(e,{localizer:i}),a)},t.handleNavigate=function(e,n){var a=t.props,s=a.view,r=a.date,i=a.getNow,l=a.onNavigate,o=Cf(a,NN),c=t.getView(),d=i();r=function(e,t){var n=t.action,a=t.date,s=t.today,r=Cf(t,jN);switch(e="string"==typeof e?bN[e]:e,n){case Dj:a=s||new Date;break;case Ej:break;default:Yf(e&&"function"==typeof e.navigate,"Calendar View components must implement a static `.navigate(date, action)` method.s"),a=e.navigate(a,n,r)}return a}(c,Sf(Sf({},o),{},{action:e,date:n||r||d,today:d})),l(r,s,e),t.handleRangeChange(r,c)},t.handleViewChange=function(e){e!==t.props.view&&function(e,t){return-1!==kN(t.views).indexOf(e)}(e,t.props)&&t.props.onView(e);var n=t.getViews();t.handleRangeChange(t.props.date||t.props.getNow(),n[e],e)},t.handleSelectEvent=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];sw(t.props.onSelectEvent,n)},t.handleDoubleClickEvent=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];sw(t.props.onDoubleClickEvent,n)},t.handleKeyPressEvent=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];sw(t.props.onKeyPressEvent,n)},t.handleSelectSlot=function(e){sw(t.props.onSelectSlot,e)},t.handleDrillDown=function(e,n){var a=t.props.onDrillDown;a?a(e,n,t.drilldownView):(n&&t.handleViewChange(n),t.handleNavigate(Ej,e))},t.state={context:e.getContext(t.props)},t}return Pf(e,ie.Component),Ef(e,[{key:"render",value:function(){var e=this.props,t=e.view,n=e.toolbar,a=e.events,s=e.backgroundEvents,r=e.resourceGroupingLayout,i=e.style,l=e.className,o=e.elementProps,c=e.date,d=e.getNow,m=e.length,u=e.showMultiDayTimes,p=e.onShowMore,h=e.doShowMoreDrillDown;e.components,e.formats,e.messages,e.culture;var x=Cf(e,_N);c=c||d();var g=this.getView(),f=this.state.context,v=f.accessors,y=f.components,b=f.getters,j=f.localizer,w=f.viewNames,N=y.toolbar||aw,_=g.title(c,{localizer:j,length:m});return ie.createElement("div",Object.assign({},o,{className:Bf(l,"rbc-calendar",x.rtl&&"rbc-rtl"),style:i}),n&&ie.createElement(N,{date:c,view:t,views:w,label:_,onView:this.handleViewChange,onNavigate:this.handleNavigate,localizer:j}),ie.createElement(g,Object.assign({},x,{events:a,backgroundEvents:s,date:c,getNow:d,length:m,localizer:j,getters:b,components:y,accessors:v,showMultiDayTimes:u,getDrilldownView:this.getDrilldownView,onNavigate:this.handleNavigate,onDrillDown:this.handleDrillDown,onSelectEvent:this.handleSelectEvent,onDoubleClickEvent:this.handleDoubleClickEvent,onKeyPressEvent:this.handleKeyPressEvent,onSelectSlot:this.handleSelectSlot,onShowMore:p,doShowMoreDrillDown:h,resourceGroupingLayout:r})))}}],[{key:"getDerivedStateFromProps",value:function(t){return{context:e.getContext(t)}}},{key:"getContext",value:function(e){var t=e.startAccessor,n=e.endAccessor,a=e.allDayAccessor,s=e.tooltipAccessor,r=e.titleAccessor,i=e.resourceAccessor,l=e.resourceIdAccessor,o=e.resourceTitleAccessor,c=e.eventIdAccessor,d=e.eventPropGetter,m=e.backgroundEventPropGetter,u=e.slotPropGetter,p=e.slotGroupPropGetter,h=e.dayPropGetter,x=e.view,g=e.views,f=e.localizer,v=e.culture,y=e.messages,b=void 0===y?{}:y,j=e.components,w=void 0===j?{}:j,N=e.formats,_=void 0===N?{}:N,k=kN(g);return{viewNames:k,localizer:nw(f,v,_,function(e){return Sf(Sf({},rw),e)}(b)),getters:{eventProp:function(){return d&&d.apply(void 0,arguments)||{}},backgroundEventProp:function(){return m&&m.apply(void 0,arguments)||{}},slotProp:function(){return u&&u.apply(void 0,arguments)||{}},slotGroupProp:function(){return p&&p.apply(void 0,arguments)||{}},dayProp:function(){return h&&h.apply(void 0,arguments)||{}}},components:hj(w[x]||{},Qe(w,k),{eventWrapper:Sj,backgroundEventWrapper:Sj,eventContainerWrapper:Sj,dateCellWrapper:Sj,weekWrapper:Sj,timeSlotWrapper:Sj,timeGutterWrapper:Sj,timeIndicatorWrapper:Sj}),accessors:{start:wN(t),end:wN(n),allDay:wN(a),tooltip:wN(s),title:wN(r),resource:wN(i),resourceId:wN(l),resourceTitle:wN(o),eventId:wN(c)}}}}])}();SN.defaultProps={events:[],backgroundEvents:[],elementProps:{},popup:!1,toolbar:!0,view:Tj.MONTH,views:[Tj.MONTH,Tj.WEEK,Tj.DAY,Tj.AGENDA],step:30,length:30,allDayMaxRows:1/0,doShowMoreDrillDown:!0,drilldownView:Tj.DAY,titleAccessor:"title",tooltipAccessor:"title",allDayAccessor:"allDay",startAccessor:"start",endAccessor:"end",resourceAccessor:"resourceId",resourceIdAccessor:"id",resourceTitleAccessor:"title",eventIdAccessor:"id",longPressThreshold:250,getNow:function(){return new Date},dayLayoutAlgorithm:"overlap"};var CN,$N,DN=function e(t,n,a){void 0===a&&(a=[]);var s,r=t.displayName||t.name||"Component",i=!!(s=t)&&("function"!=typeof s||s.prototype&&s.prototype.isReactComponent),l=Object.keys(n),o=l.map(Hf);!i&&a.length&&Yf(!1);var c=function(e){function s(){for(var t,s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];(t=e.call.apply(e,[this].concat(r))||this).handlers=Object.create(null),l.forEach(function(e){var a=n[e];t.handlers[a]=function(n){if(t.props[a]){var s;t._notifying=!0;for(var r=arguments.length,i=new Array(r>1?r-1:0),l=1;l<r;l++)i[l-1]=arguments[l];(s=t.props)[a].apply(s,[n].concat(i)),t._notifying=!1}t.unmounted||t.setState(function(t){var a,s=t.values;return{values:Te(Object.create(null),s,(a={},a[e]=n,a))}})}}),a.length&&(t.attachRef=function(e){t.inner=e});var o=Object.create(null);return l.forEach(function(e){o[e]=t.props[Hf(e)]}),t.state={values:o,prevProps:{}},t}Ee(s,e);var r=s.prototype;return r.shouldComponentUpdate=function(){return!this._notifying},s.getDerivedStateFromProps=function(e,t){var n=t.values,a=t.prevProps,s={values:Te(Object.create(null),n),prevProps:{}};return l.forEach(function(t){s.prevProps[t]=e[t],!Uf(e,t)&&Uf(a,t)&&(s.values[t]=e[Hf(t)])}),s},r.componentWillUnmount=function(){this.unmounted=!0},r.render=function(){var e=this,n=this.props,a=n.innerRef,s=Ce(n,["innerRef"]);o.forEach(function(e){delete s[e]});var r={};return l.forEach(function(t){var n=e.props[t];r[t]=void 0!==n?n:e.state.values[t]}),ie.createElement(t,Te({},s,r,this.handlers,{ref:a||this.attachRef}))},s}(ie.Component);!function(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!=typeof e.getDerivedStateFromProps&&"function"!=typeof t.getSnapshotBeforeUpdate)return e;var n=null,a=null,s=null;if("function"==typeof t.componentWillMount?n="componentWillMount":"function"==typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"==typeof t.componentWillReceiveProps?a="componentWillReceiveProps":"function"==typeof t.UNSAFE_componentWillReceiveProps&&(a="UNSAFE_componentWillReceiveProps"),"function"==typeof t.componentWillUpdate?s="componentWillUpdate":"function"==typeof t.UNSAFE_componentWillUpdate&&(s="UNSAFE_componentWillUpdate"),null!==n||null!==a||null!==s){var r=e.displayName||e.name,i="function"==typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+r+" uses "+i+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==a?"\n  "+a:"")+(null!==s?"\n  "+s:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"==typeof e.getDerivedStateFromProps&&(t.componentWillMount=Gf,t.componentWillReceiveProps=Wf),"function"==typeof t.getSnapshotBeforeUpdate){if("function"!=typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=Kf;var l=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var a=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;l.call(this,e,t,a)}}}(c),c.displayName="Uncontrolled("+r+")",c.propTypes=Te({innerRef:function(){}},function(e){var t={};return Object.keys(e).forEach(function(e){t[Hf(e)]=qf}),t}(n)),a.forEach(function(e){c.prototype[e]=function(){var t;return(t=this.inner)[e].apply(t,arguments)}});var d=c;return ie.forwardRef&&((d=ie.forwardRef(function(e,t){return ie.createElement(c,Te({},e,{innerRef:t,__source:{fileName:"/Users/jquense/src/uncontrollable/src/uncontrollable.js",lineNumber:128},__self:this}))})).propTypes=c.propTypes),d.ControlledComponent=t,d.deferControlTo=function(t,a,s){return void 0===a&&(a={}),e(t,Te({},n,a),s)},d}(SN,{view:"onView",date:"onNavigate",selected:"onSelectEvent"}),EN=function(e,t,n){var a=e.start,s=e.end;return n.format(a,"LT",t)+" – "+n.format(s,"LT",t)},TN={dateFormat:"DD",dayFormat:"DD ddd",weekdayFormat:"ddd",selectRangeFormat:EN,eventTimeRangeFormat:EN,eventTimeRangeStartFormat:function(e,t,n){var a=e.start;return n.format(a,"LT",t)+" – "},eventTimeRangeEndFormat:function(e,t,n){var a=e.end;return" – "+n.format(a,"LT",t)},timeGutterFormat:"LT",monthHeaderFormat:"MMMM YYYY",dayHeaderFormat:"dddd MMM DD",dayRangeHeaderFormat:function(e,t,n){var a=e.start,s=e.end;return n.format(a,"MMMM DD",t)+" – "+n.format(s,n.eq(a,s,"month")?"DD":"MMMM DD",t)},agendaHeaderFormat:function(e,t,n){var a=e.start,s=e.end;return n.format(a,"L",t)+" – "+n.format(s,"L",t)},agendaDateFormat:"ddd MMM DD",agendaTimeFormat:"LT",agendaTimeRangeFormat:EN};function AN(e){var t=e?e.toLowerCase():e;return"FullYear"===t?t="year":t||(t=void 0),t}function FN(){return CN.apply(null,arguments)}function PN(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function RN(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function ON(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function MN(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(ON(e,t))return!1;return!0}function LN(e){return void 0===e}function IN(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function zN(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function BN(e,t){var n,a=[],s=e.length;for(n=0;n<s;++n)a.push(t(e[n],n));return a}function VN(e,t){for(var n in t)ON(t,n)&&(e[n]=t[n]);return ON(t,"toString")&&(e.toString=t.toString),ON(t,"valueOf")&&(e.valueOf=t.valueOf),e}function YN(e,t,n,a){return dS(e,t,n,a,!0).utc()}function qN(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function UN(e){var t=null,n=!1,a=e._d&&!isNaN(e._d.getTime());return a&&(t=qN(e),n=$N.call(t.parsedDateParts,function(e){return null!=e}),a=t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n),e._strict&&(a=a&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour)),null!=Object.isFrozen&&Object.isFrozen(e)?a:(e._isValid=a,e._isValid)}function HN(e){var t=YN(NaN);return null!=e?VN(qN(t),e):qN(t).userInvalidated=!0,t}$N=Array.prototype.some?Array.prototype.some:function(e){var t,n=Object(this),a=n.length>>>0;for(t=0;t<a;t++)if(t in n&&e.call(this,n[t],t,n))return!0;return!1};var GN=FN.momentProperties=[],WN=!1;function KN(e,t){var n,a,s,r=GN.length;if(LN(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),LN(t._i)||(e._i=t._i),LN(t._f)||(e._f=t._f),LN(t._l)||(e._l=t._l),LN(t._strict)||(e._strict=t._strict),LN(t._tzm)||(e._tzm=t._tzm),LN(t._isUTC)||(e._isUTC=t._isUTC),LN(t._offset)||(e._offset=t._offset),LN(t._pf)||(e._pf=qN(t)),LN(t._locale)||(e._locale=t._locale),r>0)for(n=0;n<r;n++)LN(s=t[a=GN[n]])||(e[a]=s);return e}function ZN(e){KN(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===WN&&(WN=!0,FN.updateOffset(this),WN=!1)}function QN(e){return e instanceof ZN||null!=e&&null!=e._isAMomentObject}function XN(e){!1===FN.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function JN(e,t){var n=!0;return VN(function(){if(null!=FN.deprecationHandler&&FN.deprecationHandler(null,e),n){var a,s,r,i=[],l=arguments.length;for(s=0;s<l;s++){if(a="","object"==typeof arguments[s]){for(r in a+="\n["+s+"] ",arguments[0])ON(arguments[0],r)&&(a+=r+": "+arguments[0][r]+", ");a=a.slice(0,-2)}else a=arguments[s];i.push(a)}XN(e+"\nArguments: "+Array.prototype.slice.call(i).join("")+"\n"+(new Error).stack),n=!1}return t.apply(this,arguments)},t)}var e_,t_={};function n_(e,t){null!=FN.deprecationHandler&&FN.deprecationHandler(e,t),t_[e]||(XN(t),t_[e]=!0)}function a_(e){return"undefined"!=typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function s_(e,t){var n,a=VN({},e);for(n in t)ON(t,n)&&(RN(e[n])&&RN(t[n])?(a[n]={},VN(a[n],e[n]),VN(a[n],t[n])):null!=t[n]?a[n]=t[n]:delete a[n]);for(n in e)ON(e,n)&&!ON(t,n)&&RN(e[n])&&(a[n]=VN({},a[n]));return a}function r_(e){null!=e&&this.set(e)}FN.suppressDeprecationWarnings=!1,FN.deprecationHandler=null,e_=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)ON(e,t)&&n.push(t);return n};function i_(e,t,n){var a=""+Math.abs(e),s=t-a.length;return(e>=0?n?"+":"":"-")+Math.pow(10,Math.max(0,s)).toString().substr(1)+a}var l_=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,o_=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,c_={},d_={};function m_(e,t,n,a){var s=a;"string"==typeof a&&(s=function(){return this[a]()}),e&&(d_[e]=s),t&&(d_[t[0]]=function(){return i_(s.apply(this,arguments),t[1],t[2])}),n&&(d_[n]=function(){return this.localeData().ordinal(s.apply(this,arguments),e)})}function u_(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function p_(e,t){return e.isValid()?(t=h_(t,e.localeData()),c_[t]=c_[t]||function(e){var t,n,a=e.match(l_);for(t=0,n=a.length;t<n;t++)d_[a[t]]?a[t]=d_[a[t]]:a[t]=u_(a[t]);return function(t){var s,r="";for(s=0;s<n;s++)r+=a_(a[s])?a[s].call(t,e):a[s];return r}}(t),c_[t](e)):e.localeData().invalidDate()}function h_(e,t){var n=5;function a(e){return t.longDateFormat(e)||e}for(o_.lastIndex=0;n>=0&&o_.test(e);)e=e.replace(o_,a),o_.lastIndex=0,n-=1;return e}var x_={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function g_(e){return"string"==typeof e?x_[e]||x_[e.toLowerCase()]:void 0}function f_(e){var t,n,a={};for(n in e)ON(e,n)&&(t=g_(n))&&(a[t]=e[n]);return a}var v_={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};var y_,b_=/\d/,j_=/\d\d/,w_=/\d{3}/,N_=/\d{4}/,__=/[+-]?\d{6}/,k_=/\d\d?/,S_=/\d\d\d\d?/,C_=/\d\d\d\d\d\d?/,$_=/\d{1,3}/,D_=/\d{1,4}/,E_=/[+-]?\d{1,6}/,T_=/\d+/,A_=/[+-]?\d+/,F_=/Z|[+-]\d\d:?\d\d/gi,P_=/Z|[+-]\d\d(?::?\d\d)?/gi,R_=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,O_=/^[1-9]\d?/,M_=/^([1-9]\d|\d)/;function L_(e,t,n){y_[e]=a_(t)?t:function(e,a){return e&&n?n:t}}function I_(e,t){return ON(y_,e)?y_[e](t._strict,t._locale):new RegExp(function(e){return z_(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,a,s){return t||n||a||s}))}(e))}function z_(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function B_(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function V_(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=B_(t)),n}y_={};var Y_={};function q_(e,t){var n,a,s=t;for("string"==typeof e&&(e=[e]),IN(t)&&(s=function(e,n){n[t]=V_(e)}),a=e.length,n=0;n<a;n++)Y_[e[n]]=s}function U_(e,t){q_(e,function(e,n,a,s){a._w=a._w||{},t(e,a._w,a,s)})}function H_(e,t,n){null!=t&&ON(Y_,e)&&Y_[e](t,n._a,n,e)}function G_(e){return e%4==0&&e%100!=0||e%400==0}var W_=0,K_=1,Z_=2,Q_=3,X_=4,J_=5,ek=6,tk=7,nk=8;function ak(e){return G_(e)?366:365}m_("Y",0,0,function(){var e=this.year();return e<=9999?i_(e,4):"+"+e}),m_(0,["YY",2],0,function(){return this.year()%100}),m_(0,["YYYY",4],0,"year"),m_(0,["YYYYY",5],0,"year"),m_(0,["YYYYYY",6,!0],0,"year"),L_("Y",A_),L_("YY",k_,j_),L_("YYYY",D_,N_),L_("YYYYY",E_,__),L_("YYYYYY",E_,__),q_(["YYYYY","YYYYYY"],W_),q_("YYYY",function(e,t){t[W_]=2===e.length?FN.parseTwoDigitYear(e):V_(e)}),q_("YY",function(e,t){t[W_]=FN.parseTwoDigitYear(e)}),q_("Y",function(e,t){t[W_]=parseInt(e,10)}),FN.parseTwoDigitYear=function(e){return V_(e)+(V_(e)>68?1900:2e3)};var sk,rk=ik("FullYear",!0);function ik(e,t){return function(n){return null!=n?(ok(this,e,n),FN.updateOffset(this,t),this):lk(this,e)}}function lk(e,t){if(!e.isValid())return NaN;var n=e._d,a=e._isUTC;switch(t){case"Milliseconds":return a?n.getUTCMilliseconds():n.getMilliseconds();case"Seconds":return a?n.getUTCSeconds():n.getSeconds();case"Minutes":return a?n.getUTCMinutes():n.getMinutes();case"Hours":return a?n.getUTCHours():n.getHours();case"Date":return a?n.getUTCDate():n.getDate();case"Day":return a?n.getUTCDay():n.getDay();case"Month":return a?n.getUTCMonth():n.getMonth();case"FullYear":return a?n.getUTCFullYear():n.getFullYear();default:return NaN}}function ok(e,t,n){var a,s,r,i,l;if(e.isValid()&&!isNaN(n)){switch(a=e._d,s=e._isUTC,t){case"Milliseconds":return void(s?a.setUTCMilliseconds(n):a.setMilliseconds(n));case"Seconds":return void(s?a.setUTCSeconds(n):a.setSeconds(n));case"Minutes":return void(s?a.setUTCMinutes(n):a.setMinutes(n));case"Hours":return void(s?a.setUTCHours(n):a.setHours(n));case"Date":return void(s?a.setUTCDate(n):a.setDate(n));case"FullYear":break;default:return}r=n,i=e.month(),l=29!==(l=e.date())||1!==i||G_(r)?l:28,s?a.setUTCFullYear(r,i,l):a.setFullYear(r,i,l)}}function ck(e,t){if(isNaN(e)||isNaN(t))return NaN;var n=function(e,t){return(e%t+t)%t}(t,12);return e+=(t-n)/12,1===n?G_(e)?29:28:31-n%7%2}sk=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},m_("M",["MM",2],"Mo",function(){return this.month()+1}),m_("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),m_("MMMM",0,0,function(e){return this.localeData().months(this,e)}),L_("M",k_,O_),L_("MM",k_,j_),L_("MMM",function(e,t){return t.monthsShortRegex(e)}),L_("MMMM",function(e,t){return t.monthsRegex(e)}),q_(["M","MM"],function(e,t){t[K_]=V_(e)-1}),q_(["MMM","MMMM"],function(e,t,n,a){var s=n._locale.monthsParse(e,a,n._strict);null!=s?t[K_]=s:qN(n).invalidMonth=e});var dk="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),mk="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),uk=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,pk=R_,hk=R_;function xk(e,t,n){var a,s,r,i=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],a=0;a<12;++a)r=YN([2e3,a]),this._shortMonthsParse[a]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[a]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(s=sk.call(this._shortMonthsParse,i))?s:null:-1!==(s=sk.call(this._longMonthsParse,i))?s:null:"MMM"===t?-1!==(s=sk.call(this._shortMonthsParse,i))||-1!==(s=sk.call(this._longMonthsParse,i))?s:null:-1!==(s=sk.call(this._longMonthsParse,i))||-1!==(s=sk.call(this._shortMonthsParse,i))?s:null}function gk(e,t){if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=V_(t);else if(!IN(t=e.localeData().monthsParse(t)))return e;var n=t,a=e.date();return a=a<29?a:Math.min(a,ck(e.year(),n)),e._isUTC?e._d.setUTCMonth(n,a):e._d.setMonth(n,a),e}function fk(e){return null!=e?(gk(this,e),FN.updateOffset(this,!0),this):lk(this,"Month")}function vk(){function e(e,t){return t.length-e.length}var t,n,a,s,r=[],i=[],l=[];for(t=0;t<12;t++)n=YN([2e3,t]),a=z_(this.monthsShort(n,"")),s=z_(this.months(n,"")),r.push(a),i.push(s),l.push(s),l.push(a);r.sort(e),i.sort(e),l.sort(e),this._monthsRegex=new RegExp("^("+l.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+r.join("|")+")","i")}function yk(e,t,n,a,s,r,i){var l;return e<100&&e>=0?(l=new Date(e+400,t,n,a,s,r,i),isFinite(l.getFullYear())&&l.setFullYear(e)):l=new Date(e,t,n,a,s,r,i),l}function bk(e){var t,n;return e<100&&e>=0?((n=Array.prototype.slice.call(arguments))[0]=e+400,t=new Date(Date.UTC.apply(null,n)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function jk(e,t,n){var a=7+t-n;return-((7+bk(e,0,a).getUTCDay()-t)%7)+a-1}function wk(e,t,n,a,s){var r,i,l=1+7*(t-1)+(7+n-a)%7+jk(e,a,s);return l<=0?i=ak(r=e-1)+l:l>ak(e)?(r=e+1,i=l-ak(e)):(r=e,i=l),{year:r,dayOfYear:i}}function Nk(e,t,n){var a,s,r=jk(e.year(),t,n),i=Math.floor((e.dayOfYear()-r-1)/7)+1;return i<1?a=i+_k(s=e.year()-1,t,n):i>_k(e.year(),t,n)?(a=i-_k(e.year(),t,n),s=e.year()+1):(s=e.year(),a=i),{week:a,year:s}}function _k(e,t,n){var a=jk(e,t,n),s=jk(e+1,t,n);return(ak(e)-a+s)/7}m_("w",["ww",2],"wo","week"),m_("W",["WW",2],"Wo","isoWeek"),L_("w",k_,O_),L_("ww",k_,j_),L_("W",k_,O_),L_("WW",k_,j_),U_(["w","ww","W","WW"],function(e,t,n,a){t[a.substr(0,1)]=V_(e)});function kk(e,t){return e.slice(t,7).concat(e.slice(0,t))}m_("d",0,"do","day"),m_("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),m_("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),m_("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),m_("e",0,0,"weekday"),m_("E",0,0,"isoWeekday"),L_("d",k_),L_("e",k_),L_("E",k_),L_("dd",function(e,t){return t.weekdaysMinRegex(e)}),L_("ddd",function(e,t){return t.weekdaysShortRegex(e)}),L_("dddd",function(e,t){return t.weekdaysRegex(e)}),U_(["dd","ddd","dddd"],function(e,t,n,a){var s=n._locale.weekdaysParse(e,a,n._strict);null!=s?t.d=s:qN(n).invalidWeekday=e}),U_(["d","e","E"],function(e,t,n,a){t[a]=V_(e)});var Sk="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Ck="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),$k="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Dk=R_,Ek=R_,Tk=R_;function Ak(e,t,n){var a,s,r,i=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],a=0;a<7;++a)r=YN([2e3,1]).day(a),this._minWeekdaysParse[a]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[a]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[a]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(s=sk.call(this._weekdaysParse,i))?s:null:"ddd"===t?-1!==(s=sk.call(this._shortWeekdaysParse,i))?s:null:-1!==(s=sk.call(this._minWeekdaysParse,i))?s:null:"dddd"===t?-1!==(s=sk.call(this._weekdaysParse,i))||-1!==(s=sk.call(this._shortWeekdaysParse,i))||-1!==(s=sk.call(this._minWeekdaysParse,i))?s:null:"ddd"===t?-1!==(s=sk.call(this._shortWeekdaysParse,i))||-1!==(s=sk.call(this._weekdaysParse,i))||-1!==(s=sk.call(this._minWeekdaysParse,i))?s:null:-1!==(s=sk.call(this._minWeekdaysParse,i))||-1!==(s=sk.call(this._weekdaysParse,i))||-1!==(s=sk.call(this._shortWeekdaysParse,i))?s:null}function Fk(){function e(e,t){return t.length-e.length}var t,n,a,s,r,i=[],l=[],o=[],c=[];for(t=0;t<7;t++)n=YN([2e3,1]).day(t),a=z_(this.weekdaysMin(n,"")),s=z_(this.weekdaysShort(n,"")),r=z_(this.weekdays(n,"")),i.push(a),l.push(s),o.push(r),c.push(a),c.push(s),c.push(r);i.sort(e),l.sort(e),o.sort(e),c.sort(e),this._weekdaysRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+i.join("|")+")","i")}function Pk(){return this.hours()%12||12}function Rk(e,t){m_(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Ok(e,t){return t._meridiemParse}m_("H",["HH",2],0,"hour"),m_("h",["hh",2],0,Pk),m_("k",["kk",2],0,function(){return this.hours()||24}),m_("hmm",0,0,function(){return""+Pk.apply(this)+i_(this.minutes(),2)}),m_("hmmss",0,0,function(){return""+Pk.apply(this)+i_(this.minutes(),2)+i_(this.seconds(),2)}),m_("Hmm",0,0,function(){return""+this.hours()+i_(this.minutes(),2)}),m_("Hmmss",0,0,function(){return""+this.hours()+i_(this.minutes(),2)+i_(this.seconds(),2)}),Rk("a",!0),Rk("A",!1),L_("a",Ok),L_("A",Ok),L_("H",k_,M_),L_("h",k_,O_),L_("k",k_,O_),L_("HH",k_,j_),L_("hh",k_,j_),L_("kk",k_,j_),L_("hmm",S_),L_("hmmss",C_),L_("Hmm",S_),L_("Hmmss",C_),q_(["H","HH"],Q_),q_(["k","kk"],function(e,t,n){var a=V_(e);t[Q_]=24===a?0:a}),q_(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),q_(["h","hh"],function(e,t,n){t[Q_]=V_(e),qN(n).bigHour=!0}),q_("hmm",function(e,t,n){var a=e.length-2;t[Q_]=V_(e.substr(0,a)),t[X_]=V_(e.substr(a)),qN(n).bigHour=!0}),q_("hmmss",function(e,t,n){var a=e.length-4,s=e.length-2;t[Q_]=V_(e.substr(0,a)),t[X_]=V_(e.substr(a,2)),t[J_]=V_(e.substr(s)),qN(n).bigHour=!0}),q_("Hmm",function(e,t,n){var a=e.length-2;t[Q_]=V_(e.substr(0,a)),t[X_]=V_(e.substr(a))}),q_("Hmmss",function(e,t,n){var a=e.length-4,s=e.length-2;t[Q_]=V_(e.substr(0,a)),t[X_]=V_(e.substr(a,2)),t[J_]=V_(e.substr(s))});var Mk=ik("Hours",!0);var Lk,Ik={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:dk,monthsShort:mk,week:{dow:0,doy:6},weekdays:Sk,weekdaysMin:$k,weekdaysShort:Ck,meridiemParse:/[ap]\.?m?\.?/i},zk={},Bk={};function Vk(e,t){var n,a=Math.min(e.length,t.length);for(n=0;n<a;n+=1)if(e[n]!==t[n])return n;return a}function Yk(e){return e?e.toLowerCase().replace("_","-"):e}function qk(e){var t=null;if(void 0===zk[e]&&"undefined"!=typeof module&&module&&module.exports&&function(e){return!(!e||!e.match("^[^/\\\\]*$"))}(e))try{t=Lk._abbr,require("./locale/"+e),Uk(t)}catch(XE){zk[e]=null}return zk[e]}function Uk(e,t){var n;return e&&((n=LN(t)?Gk(e):Hk(e,t))?Lk=n:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),Lk._abbr}function Hk(e,t){if(null!==t){var n,a=Ik;if(t.abbr=e,null!=zk[e])n_("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),a=zk[e]._config;else if(null!=t.parentLocale)if(null!=zk[t.parentLocale])a=zk[t.parentLocale]._config;else{if(null==(n=qk(t.parentLocale)))return Bk[t.parentLocale]||(Bk[t.parentLocale]=[]),Bk[t.parentLocale].push({name:e,config:t}),null;a=n._config}return zk[e]=new r_(s_(a,t)),Bk[e]&&Bk[e].forEach(function(e){Hk(e.name,e.config)}),Uk(e),zk[e]}return delete zk[e],null}function Gk(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Lk;if(!PN(e)){if(t=qk(e))return t;e=[e]}return function(e){for(var t,n,a,s,r=0;r<e.length;){for(t=(s=Yk(e[r]).split("-")).length,n=(n=Yk(e[r+1]))?n.split("-"):null;t>0;){if(a=qk(s.slice(0,t).join("-")))return a;if(n&&n.length>=t&&Vk(s,n)>=t-1)break;t--}r++}return Lk}(e)}function Wk(e){var t,n=e._a;return n&&-2===qN(e).overflow&&(t=n[K_]<0||n[K_]>11?K_:n[Z_]<1||n[Z_]>ck(n[W_],n[K_])?Z_:n[Q_]<0||n[Q_]>24||24===n[Q_]&&(0!==n[X_]||0!==n[J_]||0!==n[ek])?Q_:n[X_]<0||n[X_]>59?X_:n[J_]<0||n[J_]>59?J_:n[ek]<0||n[ek]>999?ek:-1,qN(e)._overflowDayOfYear&&(t<W_||t>Z_)&&(t=Z_),qN(e)._overflowWeeks&&-1===t&&(t=tk),qN(e)._overflowWeekday&&-1===t&&(t=nk),qN(e).overflow=t),e}var Kk=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Zk=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Qk=/Z|[+-]\d\d(?::?\d\d)?/,Xk=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],Jk=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],eS=/^\/?Date\((-?\d+)/i,tS=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,nS={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function aS(e){var t,n,a,s,r,i,l=e._i,o=Kk.exec(l)||Zk.exec(l),c=Xk.length,d=Jk.length;if(o){for(qN(e).iso=!0,t=0,n=c;t<n;t++)if(Xk[t][1].exec(o[1])){s=Xk[t][0],a=!1!==Xk[t][2];break}if(null==s)return void(e._isValid=!1);if(o[3]){for(t=0,n=d;t<n;t++)if(Jk[t][1].exec(o[3])){r=(o[2]||" ")+Jk[t][0];break}if(null==r)return void(e._isValid=!1)}if(!a&&null!=r)return void(e._isValid=!1);if(o[4]){if(!Qk.exec(o[4]))return void(e._isValid=!1);i="Z"}e._f=s+(r||"")+(i||""),oS(e)}else e._isValid=!1}function sS(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}function rS(e){var t,n,a,s,r,i,l,o,c=tS.exec(function(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}(e._i));if(c){if(n=c[4],a=c[3],s=c[2],r=c[5],i=c[6],l=c[7],o=[sS(n),mk.indexOf(a),parseInt(s,10),parseInt(r,10),parseInt(i,10)],l&&o.push(parseInt(l,10)),t=o,!function(e,t,n){return!e||Ck.indexOf(e)===new Date(t[0],t[1],t[2]).getDay()||(qN(n).weekdayMismatch=!0,n._isValid=!1,!1)}(c[1],t,e))return;e._a=t,e._tzm=function(e,t,n){if(e)return nS[e];if(t)return 0;var a=parseInt(n,10),s=a%100;return(a-s)/100*60+s}(c[8],c[9],c[10]),e._d=bk.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),qN(e).rfc2822=!0}else e._isValid=!1}function iS(e,t,n){return null!=e?e:null!=t?t:n}function lS(e){var t,n,a,s,r,i=[];if(!e._d){for(a=function(e){var t=new Date(FN.now());return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}(e),e._w&&null==e._a[Z_]&&null==e._a[K_]&&function(e){var t,n,a,s,r,i,l,o,c;t=e._w,null!=t.GG||null!=t.W||null!=t.E?(r=1,i=4,n=iS(t.GG,e._a[W_],Nk(mS(),1,4).year),a=iS(t.W,1),((s=iS(t.E,1))<1||s>7)&&(o=!0)):(r=e._locale._week.dow,i=e._locale._week.doy,c=Nk(mS(),r,i),n=iS(t.gg,e._a[W_],c.year),a=iS(t.w,c.week),null!=t.d?((s=t.d)<0||s>6)&&(o=!0):null!=t.e?(s=t.e+r,(t.e<0||t.e>6)&&(o=!0)):s=r);a<1||a>_k(n,r,i)?qN(e)._overflowWeeks=!0:null!=o?qN(e)._overflowWeekday=!0:(l=wk(n,a,s,r,i),e._a[W_]=l.year,e._dayOfYear=l.dayOfYear)}(e),null!=e._dayOfYear&&(r=iS(e._a[W_],a[W_]),(e._dayOfYear>ak(r)||0===e._dayOfYear)&&(qN(e)._overflowDayOfYear=!0),n=bk(r,0,e._dayOfYear),e._a[K_]=n.getUTCMonth(),e._a[Z_]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=i[t]=a[t];for(;t<7;t++)e._a[t]=i[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[Q_]&&0===e._a[X_]&&0===e._a[J_]&&0===e._a[ek]&&(e._nextDay=!0,e._a[Q_]=0),e._d=(e._useUTC?bk:yk).apply(null,i),s=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[Q_]=24),e._w&&void 0!==e._w.d&&e._w.d!==s&&(qN(e).weekdayMismatch=!0)}}function oS(e){if(e._f!==FN.ISO_8601)if(e._f!==FN.RFC_2822){e._a=[],qN(e).empty=!0;var t,n,a,s,r,i,l,o=""+e._i,c=o.length,d=0;for(l=(a=h_(e._f,e._locale).match(l_)||[]).length,t=0;t<l;t++)s=a[t],(n=(o.match(I_(s,e))||[])[0])&&((r=o.substr(0,o.indexOf(n))).length>0&&qN(e).unusedInput.push(r),o=o.slice(o.indexOf(n)+n.length),d+=n.length),d_[s]?(n?qN(e).empty=!1:qN(e).unusedTokens.push(s),H_(s,n,e)):e._strict&&!n&&qN(e).unusedTokens.push(s);qN(e).charsLeftOver=c-d,o.length>0&&qN(e).unusedInput.push(o),e._a[Q_]<=12&&!0===qN(e).bigHour&&e._a[Q_]>0&&(qN(e).bigHour=void 0),qN(e).parsedDateParts=e._a.slice(0),qN(e).meridiem=e._meridiem,e._a[Q_]=function(e,t,n){var a;if(null==n)return t;return null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?((a=e.isPM(n))&&t<12&&(t+=12),a||12!==t||(t=0),t):t}(e._locale,e._a[Q_],e._meridiem),null!==(i=qN(e).era)&&(e._a[W_]=e._locale.erasConvertYear(i,e._a[W_])),lS(e),Wk(e)}else rS(e);else aS(e)}function cS(e){var t=e._i,n=e._f;return e._locale=e._locale||Gk(e._l),null===t||void 0===n&&""===t?HN({nullInput:!0}):("string"==typeof t&&(e._i=t=e._locale.preparse(t)),QN(t)?new ZN(Wk(t)):(zN(t)?e._d=t:PN(n)?function(e){var t,n,a,s,r,i,l=!1,o=e._f.length;if(0===o)return qN(e).invalidFormat=!0,void(e._d=new Date(NaN));for(s=0;s<o;s++)r=0,i=!1,t=KN({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[s],oS(t),UN(t)&&(i=!0),r+=qN(t).charsLeftOver,r+=10*qN(t).unusedTokens.length,qN(t).score=r,l?r<a&&(a=r,n=t):(null==a||r<a||i)&&(a=r,n=t,i&&(l=!0));VN(e,n||t)}(e):n?oS(e):function(e){var t=e._i;LN(t)?e._d=new Date(FN.now()):zN(t)?e._d=new Date(t.valueOf()):"string"==typeof t?function(e){var t=eS.exec(e._i);null===t?(aS(e),!1===e._isValid&&(delete e._isValid,rS(e),!1===e._isValid&&(delete e._isValid,e._strict?e._isValid=!1:FN.createFromInputFallback(e)))):e._d=new Date(+t[1])}(e):PN(t)?(e._a=BN(t.slice(0),function(e){return parseInt(e,10)}),lS(e)):RN(t)?function(e){if(!e._d){var t=f_(e._i),n=void 0===t.day?t.date:t.day;e._a=BN([t.year,t.month,n,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),lS(e)}}(e):IN(t)?e._d=new Date(t):FN.createFromInputFallback(e)}(e),UN(e)||(e._d=null),e))}function dS(e,t,n,a,s){var r={};return!0!==t&&!1!==t||(a=t,t=void 0),!0!==n&&!1!==n||(a=n,n=void 0),(RN(e)&&MN(e)||PN(e)&&0===e.length)&&(e=void 0),r._isAMomentObject=!0,r._useUTC=r._isUTC=s,r._l=n,r._i=e,r._f=t,r._strict=a,function(e){var t=new ZN(Wk(cS(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}(r)}function mS(e,t,n,a){return dS(e,t,n,a,!1)}FN.createFromInputFallback=JN("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),FN.ISO_8601=function(){},FN.RFC_2822=function(){};var uS=JN("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=mS.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:HN()}),pS=JN("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=mS.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:HN()});function hS(e,t){var n,a;if(1===t.length&&PN(t[0])&&(t=t[0]),!t.length)return mS();for(n=t[0],a=1;a<t.length;++a)t[a].isValid()&&!t[a][e](n)||(n=t[a]);return n}var xS=["year","quarter","month","week","day","hour","minute","second","millisecond"];function gS(e){var t=f_(e),n=t.year||0,a=t.quarter||0,s=t.month||0,r=t.week||t.isoWeek||0,i=t.day||0,l=t.hour||0,o=t.minute||0,c=t.second||0,d=t.millisecond||0;this._isValid=function(e){var t,n,a=!1,s=xS.length;for(t in e)if(ON(e,t)&&(-1===sk.call(xS,t)||null!=e[t]&&isNaN(e[t])))return!1;for(n=0;n<s;++n)if(e[xS[n]]){if(a)return!1;parseFloat(e[xS[n]])!==V_(e[xS[n]])&&(a=!0)}return!0}(t),this._milliseconds=+d+1e3*c+6e4*o+1e3*l*60*60,this._days=+i+7*r,this._months=+s+3*a+12*n,this._data={},this._locale=Gk(),this._bubble()}function fS(e){return e instanceof gS}function vS(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function yS(e,t){m_(e,0,0,function(){var e=this.utcOffset(),n="+";return e<0&&(e=-e,n="-"),n+i_(~~(e/60),2)+t+i_(~~e%60,2)})}yS("Z",":"),yS("ZZ",""),L_("Z",P_),L_("ZZ",P_),q_(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=jS(P_,e)});var bS=/([\+\-]|\d\d)/gi;function jS(e,t){var n,a,s=(t||"").match(e);return null===s?null:0===(a=60*(n=((s[s.length-1]||[])+"").match(bS)||["-",0,0])[1]+V_(n[2]))?0:"+"===n[0]?a:-a}function wS(e,t){var n,a;return t._isUTC?(n=t.clone(),a=(QN(e)||zN(e)?e.valueOf():mS(e).valueOf())-n.valueOf(),n._d.setTime(n._d.valueOf()+a),FN.updateOffset(n,!1),n):mS(e).local()}function NS(e){return-Math.round(e._d.getTimezoneOffset())}function _S(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}FN.updateOffset=function(){};var kS=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,SS=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function CS(e,t){var n,a,s,r=e,i=null;return fS(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:IN(e)||!isNaN(+e)?(r={},t?r[t]=+e:r.milliseconds=+e):(i=kS.exec(e))?(n="-"===i[1]?-1:1,r={y:0,d:V_(i[Z_])*n,h:V_(i[Q_])*n,m:V_(i[X_])*n,s:V_(i[J_])*n,ms:V_(vS(1e3*i[ek]))*n}):(i=SS.exec(e))?(n="-"===i[1]?-1:1,r={y:$S(i[2],n),M:$S(i[3],n),w:$S(i[4],n),d:$S(i[5],n),h:$S(i[6],n),m:$S(i[7],n),s:$S(i[8],n)}):null==r?r={}:"object"==typeof r&&("from"in r||"to"in r)&&(s=function(e,t){var n;if(!e.isValid()||!t.isValid())return{milliseconds:0,months:0};t=wS(t,e),e.isBefore(t)?n=DS(e,t):((n=DS(t,e)).milliseconds=-n.milliseconds,n.months=-n.months);return n}(mS(r.from),mS(r.to)),(r={}).ms=s.milliseconds,r.M=s.months),a=new gS(r),fS(e)&&ON(e,"_locale")&&(a._locale=e._locale),fS(e)&&ON(e,"_isValid")&&(a._isValid=e._isValid),a}function $S(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function DS(e,t){var n={};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function ES(e,t){return function(n,a){var s;return null===a||isNaN(+a)||(n_(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),s=n,n=a,a=s),TS(this,CS(n,a),e),this}}function TS(e,t,n,a){var s=t._milliseconds,r=vS(t._days),i=vS(t._months);e.isValid()&&(a=null==a||a,i&&gk(e,lk(e,"Month")+i*n),r&&ok(e,"Date",lk(e,"Date")+r*n),s&&e._d.setTime(e._d.valueOf()+s*n),a&&FN.updateOffset(e,r||i))}CS.fn=gS.prototype,CS.invalid=function(){return CS(NaN)};var AS=ES(1,"add"),FS=ES(-1,"subtract");function PS(e){return"string"==typeof e||e instanceof String}function RS(e){return QN(e)||zN(e)||PS(e)||IN(e)||function(e){var t=PN(e),n=!1;t&&(n=0===e.filter(function(t){return!IN(t)&&PS(e)}).length);return t&&n}(e)||function(e){var t,n,a=RN(e)&&!MN(e),s=!1,r=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],i=r.length;for(t=0;t<i;t+=1)n=r[t],s=s||ON(e,n);return a&&s}(e)||null==e}function OS(e,t){if(e.date()<t.date())return-OS(t,e);var n=12*(t.year()-e.year())+(t.month()-e.month()),a=e.clone().add(n,"months");return-(n+(t-a<0?(t-a)/(a-e.clone().add(n-1,"months")):(t-a)/(e.clone().add(n+1,"months")-a)))||0}function MS(e){var t;return void 0===e?this._locale._abbr:(null!=(t=Gk(e))&&(this._locale=t),this)}FN.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",FN.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var LS=JN("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function IS(){return this._locale}var zS=1e3,BS=6e4,VS=36e5,YS=126227808e5;function qS(e,t){return(e%t+t)%t}function US(e,t,n){return e<100&&e>=0?new Date(e+400,t,n)-YS:new Date(e,t,n).valueOf()}function HS(e,t,n){return e<100&&e>=0?Date.UTC(e+400,t,n)-YS:Date.UTC(e,t,n)}function GS(e,t){return t.erasAbbrRegex(e)}function WS(){var e,t,n,a,s,r=[],i=[],l=[],o=[],c=this.eras();for(e=0,t=c.length;e<t;++e)n=z_(c[e].name),a=z_(c[e].abbr),s=z_(c[e].narrow),i.push(n),r.push(a),l.push(s),o.push(n),o.push(a),o.push(s);this._erasRegex=new RegExp("^("+o.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+i.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+r.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+l.join("|")+")","i")}function KS(e,t){m_(0,[e,e.length],0,t)}function ZS(e,t,n,a,s){var r;return null==e?Nk(this,a,s).year:(t>(r=_k(e,a,s))&&(t=r),QS.call(this,e,t,n,a,s))}function QS(e,t,n,a,s){var r=wk(e,t,n,a,s),i=bk(r.year,0,r.dayOfYear);return this.year(i.getUTCFullYear()),this.month(i.getUTCMonth()),this.date(i.getUTCDate()),this}m_("N",0,0,"eraAbbr"),m_("NN",0,0,"eraAbbr"),m_("NNN",0,0,"eraAbbr"),m_("NNNN",0,0,"eraName"),m_("NNNNN",0,0,"eraNarrow"),m_("y",["y",1],"yo","eraYear"),m_("y",["yy",2],0,"eraYear"),m_("y",["yyy",3],0,"eraYear"),m_("y",["yyyy",4],0,"eraYear"),L_("N",GS),L_("NN",GS),L_("NNN",GS),L_("NNNN",function(e,t){return t.erasNameRegex(e)}),L_("NNNNN",function(e,t){return t.erasNarrowRegex(e)}),q_(["N","NN","NNN","NNNN","NNNNN"],function(e,t,n,a){var s=n._locale.erasParse(e,a,n._strict);s?qN(n).era=s:qN(n).invalidEra=e}),L_("y",T_),L_("yy",T_),L_("yyy",T_),L_("yyyy",T_),L_("yo",function(e,t){return t._eraYearOrdinalRegex||T_}),q_(["y","yy","yyy","yyyy"],W_),q_(["yo"],function(e,t,n,a){var s;n._locale._eraYearOrdinalRegex&&(s=e.match(n._locale._eraYearOrdinalRegex)),n._locale.eraYearOrdinalParse?t[W_]=n._locale.eraYearOrdinalParse(e,s):t[W_]=parseInt(e,10)}),m_(0,["gg",2],0,function(){return this.weekYear()%100}),m_(0,["GG",2],0,function(){return this.isoWeekYear()%100}),KS("gggg","weekYear"),KS("ggggg","weekYear"),KS("GGGG","isoWeekYear"),KS("GGGGG","isoWeekYear"),L_("G",A_),L_("g",A_),L_("GG",k_,j_),L_("gg",k_,j_),L_("GGGG",D_,N_),L_("gggg",D_,N_),L_("GGGGG",E_,__),L_("ggggg",E_,__),U_(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,a){t[a.substr(0,2)]=V_(e)}),U_(["gg","GG"],function(e,t,n,a){t[a]=FN.parseTwoDigitYear(e)}),m_("Q",0,"Qo","quarter"),L_("Q",b_),q_("Q",function(e,t){t[K_]=3*(V_(e)-1)}),m_("D",["DD",2],"Do","date"),L_("D",k_,O_),L_("DD",k_,j_),L_("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),q_(["D","DD"],Z_),q_("Do",function(e,t){t[Z_]=V_(e.match(k_)[0])});var XS=ik("Date",!0);m_("DDD",["DDDD",3],"DDDo","dayOfYear"),L_("DDD",$_),L_("DDDD",w_),q_(["DDD","DDDD"],function(e,t,n){n._dayOfYear=V_(e)}),m_("m",["mm",2],0,"minute"),L_("m",k_,M_),L_("mm",k_,j_),q_(["m","mm"],X_);var JS=ik("Minutes",!1);m_("s",["ss",2],0,"second"),L_("s",k_,M_),L_("ss",k_,j_),q_(["s","ss"],J_);var eC,tC,nC=ik("Seconds",!1);for(m_("S",0,0,function(){return~~(this.millisecond()/100)}),m_(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),m_(0,["SSS",3],0,"millisecond"),m_(0,["SSSS",4],0,function(){return 10*this.millisecond()}),m_(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),m_(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),m_(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),m_(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),m_(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),L_("S",$_,b_),L_("SS",$_,j_),L_("SSS",$_,w_),eC="SSSS";eC.length<=9;eC+="S")L_(eC,T_);function aC(e,t){t[ek]=V_(1e3*("0."+e))}for(eC="S";eC.length<=9;eC+="S")q_(eC,aC);tC=ik("Milliseconds",!1),m_("z",0,0,"zoneAbbr"),m_("zz",0,0,"zoneName");var sC=ZN.prototype;function rC(e){return e}sC.add=AS,sC.calendar=function(e,t){1===arguments.length&&(arguments[0]?RS(arguments[0])?(e=arguments[0],t=void 0):function(e){var t,n=RN(e)&&!MN(e),a=!1,s=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"];for(t=0;t<s.length;t+=1)a=a||ON(e,s[t]);return n&&a}(arguments[0])&&(t=arguments[0],e=void 0):(e=void 0,t=void 0));var n=e||mS(),a=wS(n,this).startOf("day"),s=FN.calendarFormat(this,a)||"sameElse",r=t&&(a_(t[s])?t[s].call(this,n):t[s]);return this.format(r||this.localeData().calendar(s,this,mS(n)))},sC.clone=function(){return new ZN(this)},sC.diff=function(e,t,n){var a,s,r;if(!this.isValid())return NaN;if(!(a=wS(e,this)).isValid())return NaN;switch(s=6e4*(a.utcOffset()-this.utcOffset()),t=g_(t)){case"year":r=OS(this,a)/12;break;case"month":r=OS(this,a);break;case"quarter":r=OS(this,a)/3;break;case"second":r=(this-a)/1e3;break;case"minute":r=(this-a)/6e4;break;case"hour":r=(this-a)/36e5;break;case"day":r=(this-a-s)/864e5;break;case"week":r=(this-a-s)/6048e5;break;default:r=this-a}return n?r:B_(r)},sC.endOf=function(e){var t,n;if(void 0===(e=g_(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?HS:US,e){case"year":t=n(this.year()+1,0,1)-1;break;case"quarter":t=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=n(this.year(),this.month()+1,1)-1;break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=n(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=VS-qS(t+(this._isUTC?0:this.utcOffset()*BS),VS)-1;break;case"minute":t=this._d.valueOf(),t+=BS-qS(t,BS)-1;break;case"second":t=this._d.valueOf(),t+=zS-qS(t,zS)-1}return this._d.setTime(t),FN.updateOffset(this,!0),this},sC.format=function(e){e||(e=this.isUtc()?FN.defaultFormatUtc:FN.defaultFormat);var t=p_(this,e);return this.localeData().postformat(t)},sC.from=function(e,t){return this.isValid()&&(QN(e)&&e.isValid()||mS(e).isValid())?CS({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},sC.fromNow=function(e){return this.from(mS(),e)},sC.to=function(e,t){return this.isValid()&&(QN(e)&&e.isValid()||mS(e).isValid())?CS({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},sC.toNow=function(e){return this.to(mS(),e)},sC.get=function(e){return a_(this[e=g_(e)])?this[e]():this},sC.invalidAt=function(){return qN(this).overflow},sC.isAfter=function(e,t){var n=QN(e)?e:mS(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=g_(t)||"millisecond")?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},sC.isBefore=function(e,t){var n=QN(e)?e:mS(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=g_(t)||"millisecond")?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},sC.isBetween=function(e,t,n,a){var s=QN(e)?e:mS(e),r=QN(t)?t:mS(t);return!!(this.isValid()&&s.isValid()&&r.isValid())&&(("("===(a=a||"()")[0]?this.isAfter(s,n):!this.isBefore(s,n))&&(")"===a[1]?this.isBefore(r,n):!this.isAfter(r,n)))},sC.isSame=function(e,t){var n,a=QN(e)?e:mS(e);return!(!this.isValid()||!a.isValid())&&("millisecond"===(t=g_(t)||"millisecond")?this.valueOf()===a.valueOf():(n=a.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},sC.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},sC.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},sC.isValid=function(){return UN(this)},sC.lang=LS,sC.locale=MS,sC.localeData=IS,sC.max=pS,sC.min=uS,sC.parsingFlags=function(){return VN({},qN(this))},sC.set=function(e,t){if("object"==typeof e){var n,a=function(e){var t,n=[];for(t in e)ON(e,t)&&n.push({unit:t,priority:v_[t]});return n.sort(function(e,t){return e.priority-t.priority}),n}(e=f_(e)),s=a.length;for(n=0;n<s;n++)this[a[n].unit](e[a[n].unit])}else if(a_(this[e=g_(e)]))return this[e](t);return this},sC.startOf=function(e){var t,n;if(void 0===(e=g_(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?HS:US,e){case"year":t=n(this.year(),0,1);break;case"quarter":t=n(this.year(),this.month()-this.month()%3,1);break;case"month":t=n(this.year(),this.month(),1);break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=n(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=qS(t+(this._isUTC?0:this.utcOffset()*BS),VS);break;case"minute":t=this._d.valueOf(),t-=qS(t,BS);break;case"second":t=this._d.valueOf(),t-=qS(t,zS)}return this._d.setTime(t),FN.updateOffset(this,!0),this},sC.subtract=FS,sC.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},sC.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},sC.toDate=function(){return new Date(this.valueOf())},sC.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||n.year()>9999?p_(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):a_(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",p_(n,"Z")):p_(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},sC.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e,t,n,a="moment",s="";return this.isLocal()||(a=0===this.utcOffset()?"moment.utc":"moment.parseZone",s="Z"),e="["+a+'("]',t=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",n=s+'[")]',this.format(e+t+"-MM-DD[T]HH:mm:ss.SSS"+n)},"undefined"!=typeof Symbol&&null!=Symbol.for&&(sC[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),sC.toJSON=function(){return this.isValid()?this.toISOString():null},sC.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},sC.unix=function(){return Math.floor(this.valueOf()/1e3)},sC.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},sC.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},sC.eraName=function(){var e,t,n,a=this.localeData().eras();for(e=0,t=a.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),a[e].since<=n&&n<=a[e].until)return a[e].name;if(a[e].until<=n&&n<=a[e].since)return a[e].name}return""},sC.eraNarrow=function(){var e,t,n,a=this.localeData().eras();for(e=0,t=a.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),a[e].since<=n&&n<=a[e].until)return a[e].narrow;if(a[e].until<=n&&n<=a[e].since)return a[e].narrow}return""},sC.eraAbbr=function(){var e,t,n,a=this.localeData().eras();for(e=0,t=a.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),a[e].since<=n&&n<=a[e].until)return a[e].abbr;if(a[e].until<=n&&n<=a[e].since)return a[e].abbr}return""},sC.eraYear=function(){var e,t,n,a,s=this.localeData().eras();for(e=0,t=s.length;e<t;++e)if(n=s[e].since<=s[e].until?1:-1,a=this.clone().startOf("day").valueOf(),s[e].since<=a&&a<=s[e].until||s[e].until<=a&&a<=s[e].since)return(this.year()-FN(s[e].since).year())*n+s[e].offset;return this.year()},sC.year=rk,sC.isLeapYear=function(){return G_(this.year())},sC.weekYear=function(e){return ZS.call(this,e,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)},sC.isoWeekYear=function(e){return ZS.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},sC.quarter=sC.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},sC.month=fk,sC.daysInMonth=function(){return ck(this.year(),this.month())},sC.week=sC.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},sC.isoWeek=sC.isoWeeks=function(e){var t=Nk(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},sC.weeksInYear=function(){var e=this.localeData()._week;return _k(this.year(),e.dow,e.doy)},sC.weeksInWeekYear=function(){var e=this.localeData()._week;return _k(this.weekYear(),e.dow,e.doy)},sC.isoWeeksInYear=function(){return _k(this.year(),1,4)},sC.isoWeeksInISOWeekYear=function(){return _k(this.isoWeekYear(),1,4)},sC.date=XS,sC.day=sC.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t=lk(this,"Day");return null!=e?(e=function(e,t){return"string"!=typeof e?e:isNaN(e)?"number"==typeof(e=t.weekdaysParse(e))?e:null:parseInt(e,10)}(e,this.localeData()),this.add(e-t,"d")):t},sC.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},sC.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=function(e,t){return"string"==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7},sC.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},sC.hour=sC.hours=Mk,sC.minute=sC.minutes=JS,sC.second=sC.seconds=nC,sC.millisecond=sC.milliseconds=tC,sC.utcOffset=function(e,t,n){var a,s=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=jS(P_,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(a=NS(this)),this._offset=e,this._isUTC=!0,null!=a&&this.add(a,"m"),s!==e&&(!t||this._changeInProgress?TS(this,CS(e-s,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,FN.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?s:NS(this)},sC.utc=function(e){return this.utcOffset(0,e)},sC.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(NS(this),"m")),this},sC.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=jS(F_,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},sC.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?mS(e).utcOffset():0,(this.utcOffset()-e)%60==0)},sC.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},sC.isLocal=function(){return!!this.isValid()&&!this._isUTC},sC.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},sC.isUtc=_S,sC.isUTC=_S,sC.zoneAbbr=function(){return this._isUTC?"UTC":""},sC.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},sC.dates=JN("dates accessor is deprecated. Use date instead.",XS),sC.months=JN("months accessor is deprecated. Use month instead",fk),sC.years=JN("years accessor is deprecated. Use year instead",rk),sC.zone=JN("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),sC.isDSTShifted=JN("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!LN(this._isDSTShifted))return this._isDSTShifted;var e,t={};return KN(t,this),(t=cS(t))._a?(e=t._isUTC?YN(t._a):mS(t._a),this._isDSTShifted=this.isValid()&&function(e,t,n){var a,s=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0;for(a=0;a<s;a++)(n&&e[a]!==t[a]||!n&&V_(e[a])!==V_(t[a]))&&i++;return i+r}(t._a,e.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted});var iC=r_.prototype;function lC(e,t,n,a){var s=Gk(),r=YN().set(a,t);return s[n](r,e)}function oC(e,t,n){if(IN(e)&&(t=e,e=void 0),e=e||"",null!=t)return lC(e,t,n,"month");var a,s=[];for(a=0;a<12;a++)s[a]=lC(e,a,n,"month");return s}function cC(e,t,n,a){"boolean"==typeof e?(IN(t)&&(n=t,t=void 0),t=t||""):(n=t=e,e=!1,IN(t)&&(n=t,t=void 0),t=t||"");var s,r=Gk(),i=e?r._week.dow:0,l=[];if(null!=n)return lC(t,(n+i)%7,a,"day");for(s=0;s<7;s++)l[s]=lC(t,(s+i)%7,a,"day");return l}iC.calendar=function(e,t,n){var a=this._calendar[e]||this._calendar.sameElse;return a_(a)?a.call(t,n):a},iC.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.match(l_).map(function(e){return"MMMM"===e||"MM"===e||"DD"===e||"dddd"===e?e.slice(1):e}).join(""),this._longDateFormat[e])},iC.invalidDate=function(){return this._invalidDate},iC.ordinal=function(e){return this._ordinal.replace("%d",e)},iC.preparse=rC,iC.postformat=rC,iC.relativeTime=function(e,t,n,a){var s=this._relativeTime[n];return a_(s)?s(e,t,n,a):s.replace(/%d/i,e)},iC.pastFuture=function(e,t){var n=this._relativeTime[e>0?"future":"past"];return a_(n)?n(t):n.replace(/%s/i,t)},iC.set=function(e){var t,n;for(n in e)ON(e,n)&&(a_(t=e[n])?this[n]=t:this["_"+n]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},iC.eras=function(e,t){var n,a,s,r=this._eras||Gk("en")._eras;for(n=0,a=r.length;n<a;++n){if("string"==typeof r[n].since)s=FN(r[n].since).startOf("day"),r[n].since=s.valueOf();switch(typeof r[n].until){case"undefined":r[n].until=1/0;break;case"string":s=FN(r[n].until).startOf("day").valueOf(),r[n].until=s.valueOf()}}return r},iC.erasParse=function(e,t,n){var a,s,r,i,l,o=this.eras();for(e=e.toUpperCase(),a=0,s=o.length;a<s;++a)if(r=o[a].name.toUpperCase(),i=o[a].abbr.toUpperCase(),l=o[a].narrow.toUpperCase(),n)switch(t){case"N":case"NN":case"NNN":if(i===e)return o[a];break;case"NNNN":if(r===e)return o[a];break;case"NNNNN":if(l===e)return o[a]}else if([r,i,l].indexOf(e)>=0)return o[a]},iC.erasConvertYear=function(e,t){var n=e.since<=e.until?1:-1;return void 0===t?FN(e.since).year():FN(e.since).year()+(t-e.offset)*n},iC.erasAbbrRegex=function(e){return ON(this,"_erasAbbrRegex")||WS.call(this),e?this._erasAbbrRegex:this._erasRegex},iC.erasNameRegex=function(e){return ON(this,"_erasNameRegex")||WS.call(this),e?this._erasNameRegex:this._erasRegex},iC.erasNarrowRegex=function(e){return ON(this,"_erasNarrowRegex")||WS.call(this),e?this._erasNarrowRegex:this._erasRegex},iC.months=function(e,t){return e?PN(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||uk).test(t)?"format":"standalone"][e.month()]:PN(this._months)?this._months:this._months.standalone},iC.monthsShort=function(e,t){return e?PN(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[uk.test(t)?"format":"standalone"][e.month()]:PN(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},iC.monthsParse=function(e,t,n){var a,s,r;if(this._monthsParseExact)return xk.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),a=0;a<12;a++){if(s=YN([2e3,a]),n&&!this._longMonthsParse[a]&&(this._longMonthsParse[a]=new RegExp("^"+this.months(s,"").replace(".","")+"$","i"),this._shortMonthsParse[a]=new RegExp("^"+this.monthsShort(s,"").replace(".","")+"$","i")),n||this._monthsParse[a]||(r="^"+this.months(s,"")+"|^"+this.monthsShort(s,""),this._monthsParse[a]=new RegExp(r.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[a].test(e))return a;if(n&&"MMM"===t&&this._shortMonthsParse[a].test(e))return a;if(!n&&this._monthsParse[a].test(e))return a}},iC.monthsRegex=function(e){return this._monthsParseExact?(ON(this,"_monthsRegex")||vk.call(this),e?this._monthsStrictRegex:this._monthsRegex):(ON(this,"_monthsRegex")||(this._monthsRegex=hk),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},iC.monthsShortRegex=function(e){return this._monthsParseExact?(ON(this,"_monthsRegex")||vk.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(ON(this,"_monthsShortRegex")||(this._monthsShortRegex=pk),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},iC.week=function(e){return Nk(e,this._week.dow,this._week.doy).week},iC.firstDayOfYear=function(){return this._week.doy},iC.firstDayOfWeek=function(){return this._week.dow},iC.weekdays=function(e,t){var n=PN(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(t)?"format":"standalone"];return!0===e?kk(n,this._week.dow):e?n[e.day()]:n},iC.weekdaysMin=function(e){return!0===e?kk(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},iC.weekdaysShort=function(e){return!0===e?kk(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},iC.weekdaysParse=function(e,t,n){var a,s,r;if(this._weekdaysParseExact)return Ak.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),a=0;a<7;a++){if(s=YN([2e3,1]).day(a),n&&!this._fullWeekdaysParse[a]&&(this._fullWeekdaysParse[a]=new RegExp("^"+this.weekdays(s,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[a]=new RegExp("^"+this.weekdaysShort(s,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[a]=new RegExp("^"+this.weekdaysMin(s,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[a]||(r="^"+this.weekdays(s,"")+"|^"+this.weekdaysShort(s,"")+"|^"+this.weekdaysMin(s,""),this._weekdaysParse[a]=new RegExp(r.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[a].test(e))return a;if(n&&"ddd"===t&&this._shortWeekdaysParse[a].test(e))return a;if(n&&"dd"===t&&this._minWeekdaysParse[a].test(e))return a;if(!n&&this._weekdaysParse[a].test(e))return a}},iC.weekdaysRegex=function(e){return this._weekdaysParseExact?(ON(this,"_weekdaysRegex")||Fk.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(ON(this,"_weekdaysRegex")||(this._weekdaysRegex=Dk),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},iC.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(ON(this,"_weekdaysRegex")||Fk.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(ON(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Ek),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},iC.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(ON(this,"_weekdaysRegex")||Fk.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(ON(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Tk),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},iC.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},iC.meridiem=function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},Uk("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===V_(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),FN.lang=JN("moment.lang is deprecated. Use moment.locale instead.",Uk),FN.langData=JN("moment.langData is deprecated. Use moment.localeData instead.",Gk);var dC=Math.abs;function mC(e,t,n,a){var s=CS(t,n);return e._milliseconds+=a*s._milliseconds,e._days+=a*s._days,e._months+=a*s._months,e._bubble()}function uC(e){return e<0?Math.floor(e):Math.ceil(e)}function pC(e){return 4800*e/146097}function hC(e){return 146097*e/4800}function xC(e){return function(){return this.as(e)}}var gC=xC("ms"),fC=xC("s"),vC=xC("m"),yC=xC("h"),bC=xC("d"),jC=xC("w"),wC=xC("M"),NC=xC("Q"),_C=xC("y"),kC=gC;function SC(e){return function(){return this.isValid()?this._data[e]:NaN}}var CC=SC("milliseconds"),$C=SC("seconds"),DC=SC("minutes"),EC=SC("hours"),TC=SC("days"),AC=SC("months"),FC=SC("years");var PC=Math.round,RC={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function OC(e,t,n,a,s){return s.relativeTime(t||1,!!n,e,a)}var MC=Math.abs;function LC(e){return(e>0)-(e<0)||+e}function IC(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n,a,s,r,i,l,o=MC(this._milliseconds)/1e3,c=MC(this._days),d=MC(this._months),m=this.asSeconds();return m?(e=B_(o/60),t=B_(e/60),o%=60,e%=60,n=B_(d/12),d%=12,a=o?o.toFixed(3).replace(/\.?0+$/,""):"",s=m<0?"-":"",r=LC(this._months)!==LC(m)?"-":"",i=LC(this._days)!==LC(m)?"-":"",l=LC(this._milliseconds)!==LC(m)?"-":"",s+"P"+(n?r+n+"Y":"")+(d?r+d+"M":"")+(c?i+c+"D":"")+(t||e||o?"T":"")+(t?l+t+"H":"")+(e?l+e+"M":"")+(o?l+a+"S":"")):"P0D"}var zC=gS.prototype;function BC({appointments:t,patients:n,isLoading:a,onEdit:s,onDelete:r,onViewPatient:i,onSelectAppointment:l}){Bl();const[o,c]=re.useState("start_time"),[d,m]=re.useState("desc"),[u,p]=re.useState(1),[h,x]=re.useState(10),[g,f]=re.useState(""),[v,y]=re.useState("all"),b=re.useMemo(()=>{const e=new Map;return n.forEach(t=>{e.set(t.id,t)}),e},[n]),j=re.useMemo(()=>{console.log("📋 AppointmentTable: Processing appointments:",t.length),t.length>0&&console.log("📋 AppointmentTable: First appointment sample:",t[0]);let e=t.map(e=>{const t={...e,patient:e.patient||b.get(e.patient_id),patient_name:e.patient_name||e.patient?.full_name||b.get(e.patient_id)?.full_name||"مريض غير معروف"};return"مريض غير معروف"===e.patient_name&&console.log("⚠️ AppointmentTable: Unknown patient for appointment:",{id:e.id,patient_id:e.patient_id,patient_name:e.patient_name,patient:e.patient,patientFromMap:b.get(e.patient_id)}),t});if(g.trim()){const t=g.toLowerCase();e=e.filter(e=>e.patient_name.toLowerCase().includes(t)||e.title.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t))}return"all"!==v&&(e=e.filter(e=>e.status===v)),e},[t,b,g,v]),w=re.useMemo(()=>[...j].sort((e,t)=>{let n,a;switch(o){case"patient_name":n=e.patient_name.toLowerCase(),a=t.patient_name.toLowerCase();break;case"start_time":n=new Date(e.start_time),a=new Date(t.start_time);break;case"end_time":n=new Date(e.end_time),a=new Date(t.end_time);break;case"status":n=e.status,a=t.status;break;case"title":n=e.title.toLowerCase(),a=t.title.toLowerCase();break;default:return 0}return n<a?"asc"===d?-1:1:n>a?"asc"===d?1:-1:0}),[j,o,d]),N=w.length,_=Math.ceil(N/h),k=(u-1)*h,S=w.slice(k,k+h),C=e=>{p(e)};ie.useEffect(()=>{p(1)},[g,v]);const $=({field:t,children:n,className:a})=>e.jsx(Uc,{className:`cursor-pointer hover:bg-muted/50 select-none text-center ${a||""}`,onClick:()=>(e=>{o===e?m("asc"===d?"desc":"asc"):(c(e),m("asc"))})(t),children:e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[n,o===t?"asc"===d?e.jsx(Wa,{className:"w-4 h-4"}):e.jsx(Ua,{className:"w-4 h-4"}):e.jsx(Ga,{className:"w-4 h-4 opacity-50"})]})}),D=e=>{switch(e){case"scheduled":return"مجدول";case"completed":return"مكتمل";case"cancelled":return"ملغي";case"no_show":return"لم يحضر";default:return e}};return a?e.jsx("div",{className:"border rounded-lg",dir:"rtl",children:e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{className:"bg-muted/50",children:[e.jsx(Uc,{className:"text-center",children:"#"}),e.jsx(Uc,{className:"text-center",children:"اسم المريض"}),e.jsx(Uc,{className:"text-center",children:"تاريخ ووقت البداية"}),e.jsx(Uc,{className:"text-center",children:"تاريخ ووقت النهاية"}),e.jsx(Uc,{className:"text-center",children:"حالة الموعد"}),e.jsx(Uc,{className:"text-center",children:"الاجراءات"})]})}),e.jsx(Yc,{children:e.jsx(qc,{children:e.jsx(Hc,{colSpan:6,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("p",{className:"text-muted-foreground arabic-enhanced",children:"جاري تحميل المواعيد..."})]})})})})]})}):0===t.length?e.jsx("div",{className:"border rounded-lg",dir:"rtl",children:e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{className:"bg-muted/50",children:[e.jsx(Uc,{className:"text-center",children:"#"}),e.jsx(Uc,{className:"text-center",children:"اسم المريض"}),e.jsx(Uc,{className:"text-center",children:"تاريخ ووقت البداية"}),e.jsx(Uc,{className:"text-center",children:"تاريخ ووقت النهاية"}),e.jsx(Uc,{className:"text-center",children:"حالة الموعد"}),e.jsx(Uc,{className:"text-center",children:"الاجراءات"})]})}),e.jsx(Yc,{children:e.jsx(qc,{children:e.jsx(Hc,{colSpan:6,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(es,{className:"w-12 h-12 text-muted-foreground opacity-50"}),e.jsx("p",{className:"text-muted-foreground arabic-enhanced",children:"لا توجد مواعيد"})]})})})})]})}):e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(tr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{placeholder:"البحث في المواعيد...",value:g,onChange:e=>f(e.target.value),className:"pl-10 arabic-enhanced text-right"})]}),e.jsxs(Nl,{value:v,onValueChange:y,children:[e.jsxs(Sl,{className:"w-[180px]",children:[e.jsx(js,{className:"w-4 h-4 mr-2"}),e.jsx(kl,{placeholder:"تصفية حسب الحالة"})]}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الحالات"}),e.jsx(Al,{value:"scheduled",children:"مجدول"}),e.jsx(Al,{value:"completed",children:"مكتمل"}),e.jsx(Al,{value:"cancelled",children:"ملغي"}),e.jsx(Al,{value:"no_show",children:"لم يحضر"})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground arabic-enhanced",children:["إجمالي المواعيد: ",j.length]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Bc,{className:"table-center-all w-full",children:[e.jsx(Vc,{children:e.jsxs(qc,{className:"bg-muted/50",children:[e.jsx(Uc,{className:"text-center min-w-[80px]",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"#"})}),e.jsx($,{field:"patient_name",className:"min-w-[180px]",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"اسم المريض"})}),e.jsx($,{field:"start_time",className:"min-w-[140px]",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"تاريخ ووقت البداية"})}),e.jsx($,{field:"end_time",className:"min-w-[140px]",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"تاريخ ووقت النهاية"})}),e.jsx($,{field:"status",className:"min-w-[100px]",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"حالة الموعد"})}),e.jsx(Uc,{className:"text-center min-w-[200px]",children:e.jsx("span",{className:"arabic-enhanced font-medium",children:"الاجراءات"})})]})}),e.jsx(Yc,{children:S.map((t,n)=>e.jsxs(qc,{className:"hover:bg-muted/50 cursor-pointer",onClick:()=>l?.(t),children:[e.jsx(Hc,{className:"font-medium text-center",children:k+n+1}),e.jsx(Hc,{className:"font-medium text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium flex-shrink-0",children:t.patient_name.charAt(0)}),e.jsx("span",{className:"arabic-enhanced",title:t.patient_name,children:t.patient_name})]})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"text-sm font-medium arabic-enhanced",children:zn(t.start_time)})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"text-sm font-medium arabic-enhanced",children:zn(t.end_time)})}),e.jsx(Hc,{className:"text-center",children:e.jsx(oc,{variant:"outline",className:`${qn(t.status)} arabic-enhanced text-xs whitespace-nowrap`,children:D(t.status)})}),e.jsx(Hc,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1 flex-wrap",children:[e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:e=>{e.preventDefault(),e.stopPropagation(),s(t)},children:[e.jsx(Us,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:e=>{e.preventDefault(),e.stopPropagation(),r(t.id)},children:[e.jsx(dr,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]}),(t.patient||b.get(t.patient_id))&&e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-view",onClick:e=>{e.preventDefault(),e.stopPropagation();const n=t.patient||b.get(t.patient_id);n&&i(n)},children:[e.jsx(ys,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"عرض المريض"})]})]})})]},t.id))})]})})}),N>0&&e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("p",{className:"text-sm text-muted-foreground arabic-enhanced",children:["عرض ",(u-1)*h+1," إلى ",Math.min(u*h,N)," من ",N," موعد"]})}),e.jsxs("div",{className:"flex items-center gap-6 lg:gap-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(Nl,{value:`${h}`,onValueChange:e=>{x(parseInt(e)),p(1)},children:[e.jsx(Sl,{className:"h-8 w-[70px]",children:e.jsx(kl,{placeholder:h})}),e.jsx(Dl,{side:"top",children:[10,20,30,50,100].map(t=>e.jsx(Al,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",u," من ",_]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(1),disabled:1===u,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(os,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(u-1),disabled:1===u,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(rs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(u+1),disabled:u===_,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(is,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(_),disabled:u===_,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(cs,{className:"h-4 w-4"})]})]})]})]})]})}function VC({isOpen:t,appointment:n,patient:a,onClose:s,onConfirm:r,isLoading:i=!1}){return n?e.jsx(Sr,{open:t,onOpenChange:s,children:e.jsxs(Dr,{className:"sm:max-w-[425px]",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center gap-2 text-destructive arabic-enhanced",children:[e.jsx(qa,{className:"w-5 h-5"}),"تأكيد حذف الموعد"]}),e.jsx(Fr,{className:"text-right arabic-enhanced",children:"هل أنت متأكد من أنك تريد حذف هذا الموعد؟ لا يمكن التراجع عن هذا الإجراء."})]}),e.jsx("div",{className:"py-4 space-y-4",children:e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium arabic-enhanced",children:"تفاصيل الموعد:"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yr,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"arabic-enhanced",children:["المريض: ",a?.full_name||"غير معروف"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:["التاريخ والوقت: ",zn(n.start_time)]})]}),n.title&&e.jsxs("div",{className:"arabic-enhanced",children:[e.jsx("span",{className:"font-medium",children:"العنوان: "}),e.jsx("span",{children:n.title})]}),n.description&&e.jsxs("div",{className:"arabic-enhanced",children:[e.jsx("span",{className:"font-medium",children:"الوصف: "}),e.jsx("span",{children:n.description})]})]})]})}),e.jsxs(Tr,{className:"flex gap-2",children:[e.jsx(Lr,{variant:"outline",onClick:s,disabled:i,className:"arabic-enhanced",children:"إلغاء"}),e.jsx(Lr,{variant:"destructive",onClick:r,disabled:i,className:"arabic-enhanced",children:i?"جاري الحذف...":"حذف الموعد"})]})]})}):null}zC.isValid=function(){return this._isValid},zC.abs=function(){var e=this._data;return this._milliseconds=dC(this._milliseconds),this._days=dC(this._days),this._months=dC(this._months),e.milliseconds=dC(e.milliseconds),e.seconds=dC(e.seconds),e.minutes=dC(e.minutes),e.hours=dC(e.hours),e.months=dC(e.months),e.years=dC(e.years),this},zC.add=function(e,t){return mC(this,e,t,1)},zC.subtract=function(e,t){return mC(this,e,t,-1)},zC.as=function(e){if(!this.isValid())return NaN;var t,n,a=this._milliseconds;if("month"===(e=g_(e))||"quarter"===e||"year"===e)switch(t=this._days+a/864e5,n=this._months+pC(t),e){case"month":return n;case"quarter":return n/3;case"year":return n/12}else switch(t=this._days+Math.round(hC(this._months)),e){case"week":return t/7+a/6048e5;case"day":return t+a/864e5;case"hour":return 24*t+a/36e5;case"minute":return 1440*t+a/6e4;case"second":return 86400*t+a/1e3;case"millisecond":return Math.floor(864e5*t)+a;default:throw new Error("Unknown unit "+e)}},zC.asMilliseconds=gC,zC.asSeconds=fC,zC.asMinutes=vC,zC.asHours=yC,zC.asDays=bC,zC.asWeeks=jC,zC.asMonths=wC,zC.asQuarters=NC,zC.asYears=_C,zC.valueOf=kC,zC._bubble=function(){var e,t,n,a,s,r=this._milliseconds,i=this._days,l=this._months,o=this._data;return r>=0&&i>=0&&l>=0||r<=0&&i<=0&&l<=0||(r+=864e5*uC(hC(l)+i),i=0,l=0),o.milliseconds=r%1e3,e=B_(r/1e3),o.seconds=e%60,t=B_(e/60),o.minutes=t%60,n=B_(t/60),o.hours=n%24,i+=B_(n/24),l+=s=B_(pC(i)),i-=uC(hC(s)),a=B_(l/12),l%=12,o.days=i,o.months=l,o.years=a,this},zC.clone=function(){return CS(this)},zC.get=function(e){return e=g_(e),this.isValid()?this[e+"s"]():NaN},zC.milliseconds=CC,zC.seconds=$C,zC.minutes=DC,zC.hours=EC,zC.days=TC,zC.weeks=function(){return B_(this.days()/7)},zC.months=AC,zC.years=FC,zC.humanize=function(e,t){if(!this.isValid())return this.localeData().invalidDate();var n,a,s=!1,r=RC;return"object"==typeof e&&(t=e,e=!1),"boolean"==typeof e&&(s=e),"object"==typeof t&&(r=Object.assign({},RC,t),null!=t.s&&null==t.ss&&(r.ss=t.s-1)),a=function(e,t,n,a){var s=CS(e).abs(),r=PC(s.as("s")),i=PC(s.as("m")),l=PC(s.as("h")),o=PC(s.as("d")),c=PC(s.as("M")),d=PC(s.as("w")),m=PC(s.as("y")),u=r<=n.ss&&["s",r]||r<n.s&&["ss",r]||i<=1&&["m"]||i<n.m&&["mm",i]||l<=1&&["h"]||l<n.h&&["hh",l]||o<=1&&["d"]||o<n.d&&["dd",o];return null!=n.w&&(u=u||d<=1&&["w"]||d<n.w&&["ww",d]),(u=u||c<=1&&["M"]||c<n.M&&["MM",c]||m<=1&&["y"]||["yy",m])[2]=t,u[3]=+e>0,u[4]=a,OC.apply(null,u)}(this,!s,r,n=this.localeData()),s&&(a=n.pastFuture(+this,a)),n.postformat(a)},zC.toISOString=IC,zC.toString=IC,zC.toJSON=IC,zC.locale=MS,zC.localeData=IS,zC.toIsoString=JN("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",IC),zC.lang=LS,m_("X",0,0,"unix"),m_("x",0,0,"valueOf"),L_("x",A_),L_("X",/[+-]?\d+(\.\d{1,3})?/),q_("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e))}),q_("x",function(e,t,n){n._d=new Date(V_(e))}),
//! moment.js
FN.version="2.30.1",CN=mS,FN.fn=sC,FN.min=function(){return hS("isBefore",[].slice.call(arguments,0))},FN.max=function(){return hS("isAfter",[].slice.call(arguments,0))},FN.now=function(){return Date.now?Date.now():+new Date},FN.utc=YN,FN.unix=function(e){return mS(1e3*e)},FN.months=function(e,t){return oC(e,t,"months")},FN.isDate=zN,FN.locale=Uk,FN.invalid=HN,FN.duration=CS,FN.isMoment=QN,FN.weekdays=function(e,t,n){return cC(e,t,n,"weekdays")},FN.parseZone=function(){return mS.apply(null,arguments).parseZone()},FN.localeData=Gk,FN.isDuration=fS,FN.monthsShort=function(e,t){return oC(e,t,"monthsShort")},FN.weekdaysMin=function(e,t,n){return cC(e,t,n,"weekdaysMin")},FN.defineLocale=Hk,FN.updateLocale=function(e,t){if(null!=t){var n,a,s=Ik;null!=zk[e]&&null!=zk[e].parentLocale?zk[e].set(s_(zk[e]._config,t)):(null!=(a=qk(e))&&(s=a._config),t=s_(s,t),null==a&&(t.abbr=e),(n=new r_(t)).parentLocale=zk[e],zk[e]=n),Uk(e)}else null!=zk[e]&&(null!=zk[e].parentLocale?(zk[e]=zk[e].parentLocale,e===Uk()&&Uk(e)):null!=zk[e]&&delete zk[e]);return zk[e]},FN.locales=function(){return e_(zk)},FN.weekdaysShort=function(e,t,n){return cC(e,t,n,"weekdaysShort")},FN.normalizeUnits=g_,FN.relativeTimeRounding=function(e){return void 0===e?PC:"function"==typeof e&&(PC=e,!0)},FN.relativeTimeThreshold=function(e,t){return void 0!==RC[e]&&(void 0===t?RC[e]:(RC[e]=t,"s"===e&&(RC.ss=t-1),!0))},FN.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},FN.prototype=sC,FN.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};FN.locale("ar",Dn),FN.updateLocale("ar",Dn);const YC=function(e){function t(t,n){var a,s,r=e(t).local(),i=e(n).local();if(!e.tz)return r.toDate().getTimezoneOffset()-i.toDate().getTimezoneOffset();var l=null!==(a=null==r||null===(s=r._z)||void 0===s?void 0:s.name)&&void 0!==a?a:e.tz.guess();return e.tz.zone(l).utcOffset(+r)-e.tz.zone(l).utcOffset(+i)}function n(t,n,a){var s=AN(a);return[s?e(t).startOf(s):e(t),s?e(n).startOf(s):e(n),s]}function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=AN(arguments.length>1?arguments[1]:void 0);return n?e(t).startOf(n).toDate():e(t).toDate()}function s(e,t,a){var s=If(n(e,t,a),3),r=s[0],i=s[1],l=s[2];return r.isSame(i,l)}function r(e,t,a){var s=If(n(e,t,a),3),r=s[0],i=s[1],l=s[2];return r.isSameOrBefore(i,l)}function i(t,n,a){var s=AN(a);return e(t).add(n,s).toDate()}function l(t,n){var a=AN(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"day"),s=e(t);return e(n).diff(s,a)}function o(t){return e(t).startOf("month").startOf("week").toDate()}function c(t){return e(t).endOf("month").endOf("week").toDate()}function d(t,n){var a=e(t),s=e(n);return e.duration(s.diff(a)).days()}return new tw({formats:TN,firstOfWeek:function(t){var n=t?e.localeData(t):e.localeData();return n?n.firstDayOfWeek():0},firstVisibleDay:o,lastVisibleDay:c,visibleDays:function(e){for(var t=o(e),n=c(e),a=[];r(t,n);)a.push(t),t=i(t,1,"d");return a},format:function(t,n,a){return function(e,t){return t?e.locale(t):e}(e(t),a).format(n)},lt:function(e,t,a){var s=If(n(e,t,a),3),r=s[0],i=s[1],l=s[2];return r.isBefore(i,l)},lte:r,gt:function(e,t,a){var s=If(n(e,t,a),3),r=s[0],i=s[1],l=s[2];return r.isAfter(i,l)},gte:function(e,t,a){var s=If(n(e,t,a),3),r=s[0],i=s[1],l=s[2];return r.isSameOrBefore(i,l)},eq:s,neq:function(e,t,n){return!s(e,t,n)},merge:function(t,n){if(!t&&!n)return null;var a=e(n).format("HH:mm:ss"),s=e(t).startOf("day").format("MM/DD/YYYY");return e("".concat(s," ").concat(a),"MM/DD/YYYY HH:mm:ss").toDate()},inRange:function(t,n,a){var s=AN(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"day"),r=e(t),i=e(n),l=e(a);return r.isBetween(i,l,s,"[]")},startOf:a,endOf:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=AN(arguments.length>1?arguments[1]:void 0);return n?e(t).endOf(n).toDate():e(t).toDate()},range:function(t,n){for(var a=AN(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"day"),s=e(t).toDate(),l=[];r(s,n);)l.push(s),s=i(s,1,a);return l},add:i,diff:l,ceil:function(e,t){var n=AN(t),r=a(e,n);return s(r,e)?r:i(r,1,n)},min:function(t,n){var a=e(t),s=e(n);return e.min(a,s).toDate()},max:function(t,n){var a=e(t),s=e(n);return e.max(a,s).toDate()},minutes:function(t){return e(t).minutes()},getSlotDate:function(t,n,a){return e(t).startOf("day").minute(n+a).toDate()},getTimezoneOffset:function(t){return e(t).toDate().getTimezoneOffset()},getDstOffset:t,getTotalMin:function(e,t){return l(e,t,"minutes")},getMinutesFromMidnight:function(n){var a=e(n).startOf("day");return e(n).diff(a,"minutes")+function(n){return t(e(n).startOf("day"),n)}(n)},continuesPrior:function(t,n){var a=e(t),s=e(n);return a.isBefore(s,"day")},continuesAfter:function(t,n,a){var s=e(n),r=e(a);return s.isSameOrAfter(r,"minutes")},sortEvents:function(e){var t=e.evtA,n=t.start,s=t.end,r=t.allDay,i=e.evtB,l=i.start,o=i.end,c=i.allDay,m=+a(n,"day")-+a(l,"day"),u=d(n,s),p=d(l,o);return m||p-u||!!c-!!r||+n-+l||+s-+o},inEventRange:function(t){var n=t.event,a=n.start,s=n.end,r=t.range,i=r.start,l=r.end,o=e(a).startOf("day"),c=e(s),d=e(i),m=e(l),u=o.isSameOrBefore(m,"day"),p=!o.isSame(c,"minutes")?c.isAfter(d,"minutes"):c.isSameOrAfter(d,"minutes");return u&&p},isSameDate:function(t,n){var a=e(t),s=e(n);return a.isSame(s,"day")},daySpan:d,browserTZOffset:function(){var t=new Date,n=/-/.test(t.toString())?"-":"",a=t.getTimezoneOffset(),s=Number("".concat(n).concat(Math.abs(a)));return e().utcOffset()>s?1:0}})}
//! moment.js
//! version : 2.30.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
(FN),qC=e=>{switch(e){case"scheduled":return"مجدول";case"completed":return"مكتمل";case"cancelled":return"ملغي";case"no_show":return"لم يحضر";default:return e}};function UC(){ua(),ha();const{appointments:t,calendarEvents:n,selectedAppointment:a,calendarView:s,selectedDate:r,setSelectedAppointment:i,setCalendarView:l,setSelectedDate:o,loadAppointments:c,deleteAppointment:d,updateAppointment:m,createAppointment:u}=Jn(),{patients:p,loadPatients:h}=bt(),{toast:x}=Bl(),[g,f]=re.useState(!1),[v,y]=re.useState(!1),[b,j]=re.useState(null),[w,N]=re.useState(!1),[_,k]=re.useState(!1),[S,C]=re.useState(null),[$,D]=re.useState(null),[E,T]=re.useState(""),[A,F]=re.useState(!1),[P,R]=re.useState("all"),[O,M]=re.useState("all"),[L,I]=re.useState({start:"",end:""});re.useEffect(()=>{c(),h()},[c,h]),re.useEffect(()=>{const e=localStorage.getItem("selectedAppointmentForDetails");if(e)try{const{appointment:t,openDetailsModal:n}=JSON.parse(e);n&&t&&(i(t),f(!0),localStorage.removeItem("selectedAppointmentForDetails"))}catch(t){console.error("Error parsing search result data:",t),localStorage.removeItem("selectedAppointmentForDetails")}},[]);const z=ie.useMemo(()=>{let e=[...t];if(E.trim()){const t=E.toLowerCase();e=e.filter(e=>{const n=e.patient?.full_name?.toLowerCase()||"",a=e.title?.toLowerCase()||"",s=e.description?.toLowerCase()||"";return n.includes(t)||a.includes(t)||s.includes(t)})}if("all"!==P&&(e=e.filter(e=>e.status===P)),"all"!==O&&(e=e.filter(e=>e.patient_id===O)),L.start&&L.end){const t=new Date(L.start),n=new Date(L.end);n.setHours(23,59,59,999),e=e.filter(e=>{const a=new Date(e.start_time);return a>=t&&a<=n})}return e},[t,E,P,O,L]),B=re.useCallback(e=>{i(e.resource)},[i]),V=re.useCallback(e=>{console.log("Selected slot:",e);const t=e.start||new Date,n=t.toTimeString().slice(0,5);D({date:t,time:n}),i(null),f(!0)},[]),Y=re.useCallback(e=>{o(e)},[o]),q=re.useCallback(e=>{l(e)},[l]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-heading-1 text-foreground arabic-enhanced",children:"إدارة المواعيد"}),e.jsx("p",{className:"text-body text-muted-foreground mt-2 arabic-enhanced",children:"جدولة ومتابعة مواعيد المرضى"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",onClick:async()=>{if(0!==z.length)try{await Zc.exportAppointmentsToExcel(z),Kc.exportSuccess(`تم تصدير ${z.length} موعد بنجاح إلى ملف Excel مع التنسيق الجميل!`)}catch(e){console.error("Error exporting appointments:",e),Kc.exportError("فشل في تصدير بيانات المواعيد")}else Kc.noDataToExport("لا توجد بيانات مواعيد للتصدير")},children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير"]}),e.jsxs(Lr,{onClick:()=>{i(null),f(!0)},children:[e.jsx(Zs,{className:"w-4 h-4 mr-2"}),"موعد جديد"]})]})]}),e.jsx(nc,{children:e.jsx(ic,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-4",dir:"rtl",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(tr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{placeholder:"البحث في المواعيد (اسم المريض، العنوان، الوصف)...",value:E,onChange:e=>T(e.target.value),className:"pr-10 text-right",dir:"rtl"})]}),e.jsx(Cc,{open:A,onOpenChange:F,children:e.jsx($c,{asChild:!0,children:e.jsxs(Lr,{variant:"outline",size:"sm",children:[e.jsx(js,{className:"w-4 h-4 mr-2"}),"تصفية",("all"!==P||"all"!==O||L.start||L.end)&&e.jsx("span",{className:"mr-2 w-2 h-2 bg-primary rounded-full"})]})})}),(E||"all"!==P||"all"!==O||L.start||L.end)&&e.jsxs(Lr,{variant:"ghost",size:"sm",onClick:()=>{T(""),R("all"),M("all"),I({start:"",end:""}),F(!1)},children:[e.jsx(_r,{className:"w-4 h-4 mr-2"}),"مسح الكل"]})]}),e.jsx(Cc,{open:A,onOpenChange:F,children:e.jsx(Dc,{className:"space-y-4",dir:"rtl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-muted/50 rounded-lg",dir:"rtl",children:[e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"حالة الموعد"}),e.jsxs(Nl,{value:P,onValueChange:R,dir:"rtl",children:[e.jsx(Sl,{className:"text-right",children:e.jsx(kl,{placeholder:"جميع الحالات"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الحالات"}),e.jsx(Al,{value:"scheduled",children:"مجدول"}),e.jsx(Al,{value:"completed",children:"مكتمل"}),e.jsx(Al,{value:"cancelled",children:"ملغي"}),e.jsx(Al,{value:"no_show",children:"لم يحضر"})]})]})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"المريض"}),e.jsxs(Nl,{value:O,onValueChange:M,dir:"rtl",children:[e.jsx(Sl,{className:"text-right",children:e.jsx(kl,{placeholder:"جميع المرضى"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع المرضى"}),p.map(t=>e.jsx(Al,{value:t.id,children:t.full_name},t.id))]})]})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"من تاريخ"}),e.jsx(Ir,{type:"date",value:L.start,onChange:e=>I(t=>({...t,start:e.target.value})),className:"text-right",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"إلى تاريخ"}),e.jsx(Ir,{type:"date",value:L.end,onChange:e=>I(t=>({...t,end:e.target.value})),className:"text-right",dir:"rtl"})]})]})})})]})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"w-full",children:e.jsxs(Ud,{defaultValue:"table",className:"w-full",children:[e.jsxs(Hd,{className:"grid w-full grid-cols-2",children:[e.jsxs(Gd,{value:"calendar",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(es,{className:"w-4 h-4"}),e.jsx("span",{className:"arabic-enhanced",children:"عرض التقويم"})]}),e.jsxs(Gd,{value:"table",className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(or,{className:"w-4 h-4"}),e.jsx("span",{className:"arabic-enhanced",children:"عرض الجدول"})]})]}),e.jsx(Wd,{value:"calendar",className:"mt-6",children:e.jsx(nc,{children:e.jsx(ic,{className:"p-6",children:e.jsxs("div",{style:{height:"600px"},children:[e.jsx("style",{children:"\n                      .rbc-event {\n                        border-radius: 6px !important;\n                        border: none !important;\n                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;\n                      }\n                      .rbc-event:hover {\n                        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15) !important;\n                        transform: translateY(-1px);\n                        transition: all 0.2s ease;\n                      }\n                      .rbc-event-content {\n                        padding: 2px 4px !important;\n                      }\n                      .rbc-month-view .rbc-event {\n                        margin: 1px !important;\n                      }\n                      .rbc-agenda-view .rbc-event {\n                        border-radius: 4px !important;\n                      }\n                    "}),e.jsx(DN,{localizer:YC,events:n,startAccessor:"start",endAccessor:"end",view:s,onView:q,date:r,onNavigate:Y,onSelectEvent:B,onSelectSlot:V,selectable:!0,eventPropGetter:e=>{const t=e.resource;let n="#3174ad";switch(t?.status){case"completed":n="#10b981";break;case"cancelled":n="#ef4444";break;case"no_show":n="#6b7280";break;default:n="#3b82f6"}return{style:{backgroundColor:n,borderRadius:"6px",opacity:.9,color:"white",border:"0px",display:"block",fontSize:"12px",fontWeight:"500",padding:"2px 6px",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},components:{toolbar:({label:t,onNavigate:n,onView:a})=>e.jsxs("div",{className:"flex items-center justify-between mb-4 p-4 bg-card rounded-lg border",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lr,{variant:"outline",size:"sm",onClick:()=>n("NEXT"),children:e.jsx(is,{className:"w-4 h-4"})}),e.jsx(Lr,{variant:"outline",size:"sm",onClick:()=>n("TODAY"),className:"arabic-enhanced",children:"اليوم"}),e.jsx(Lr,{variant:"outline",size:"sm",onClick:()=>n("PREV"),children:e.jsx(rs,{className:"w-4 h-4"})})]}),e.jsx("h2",{className:"text-lg font-semibold arabic-enhanced",children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lr,{variant:"month"===s?"default":"outline",size:"sm",onClick:()=>a("month"),className:"arabic-enhanced",children:"شهر"}),e.jsx(Lr,{variant:"week"===s?"default":"outline",size:"sm",onClick:()=>a("week"),className:"arabic-enhanced",children:"أسبوع"}),e.jsx(Lr,{variant:"day"===s?"default":"outline",size:"sm",onClick:()=>a("day"),className:"arabic-enhanced",children:"يوم"}),e.jsx(Lr,{variant:"agenda"===s?"default":"outline",size:"sm",onClick:()=>a("agenda"),className:"arabic-enhanced",children:"جدول أعمال"})]})]}),event:({event:t})=>{const n=t.resource,a=n?.patient?.full_name||n?.patient_name||n?.patient_name||"مريض غير معروف",s="مريض محذوف"===a,r=new Date(n?.start_time||t.start).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1});return e.jsxs("div",{className:"w-full h-full flex flex-col justify-center items-center text-center p-1",dir:"rtl",children:[e.jsxs("div",{className:"font-medium text-xs truncate w-full flex items-center justify-center gap-1 "+(s?"opacity-60":""),title:`${a} - ${qC(n?.status||"scheduled")}`,children:[e.jsx("span",{className:"text-xs",children:(e=>{switch(e){case"completed":return"✓";case"cancelled":return"✗";case"no_show":return"⚠";default:return"●"}})(n?.status||"scheduled")}),e.jsx("span",{className:"truncate",children:a})]}),e.jsx("div",{className:"text-xs opacity-90",title:r,children:r})]})}},step:30,timeslots:2,min:new Date(2024,0,1,8,0),max:new Date(2024,0,1,18,0)})]})})})}),e.jsx(Wd,{value:"table",className:"mt-6",children:e.jsx(BC,{appointments:z,patients:p,isLoading:w,onEdit:e=>{i(e),f(!0)},onDelete:e=>{j(e),y(!0)},onViewPatient:e=>{console.log("View patient:",e),C(e),k(!0)},onSelectAppointment:e=>{i(e)}})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[a&&e.jsxs(nc,{children:[e.jsx(ac,{className:"pb-3",children:e.jsx(sc,{className:"text-lg arabic-enhanced",children:"تفاصيل الموعد"})}),e.jsxs(ic,{className:"space-y-3",dir:"rtl",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium mb-1 arabic-enhanced text-sm",children:a.title}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-xs gap-2",children:[e.jsx(us,{className:"w-3 h-3 text-muted-foreground"}),e.jsx("span",{children:zn(a.start_time)})]}),e.jsxs("div",{className:"flex items-center text-xs gap-2",children:[e.jsx(yr,{className:"w-3 h-3 text-muted-foreground"}),e.jsx("span",{className:"arabic-enhanced",children:a.patient?.full_name})]})]})]}),e.jsx("div",{className:"flex flex-col gap-2 ml-3",children:e.jsx(oc,{className:`${qn(a.status)} text-xs`,children:qC(a.status)})})]}),(a.description||a.treatment||a.cost)&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 pt-2 border-t",children:[a.description&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium arabic-enhanced",children:"الوصف: "}),e.jsx("span",{className:"text-xs text-muted-foreground arabic-enhanced",children:a.description})]}),a.treatment&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium arabic-enhanced",children:"العلاج: "}),e.jsx("span",{className:"text-xs text-muted-foreground arabic-enhanced",children:a.treatment.name})]}),a.cost&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium arabic-enhanced",children:"التكلفة: "}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.cost," $"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(Lr,{className:"flex-1 arabic-enhanced",size:"sm",onClick:()=>{f(!0)},children:"تعديل"}),e.jsx(Lr,{variant:"outline",className:"flex-1 arabic-enhanced",size:"sm",disabled:w||"completed"===a?.status,onClick:async()=>{if(a){N(!0);try{await m(a.id,{status:"completed"});const e={...a,status:"completed"};i(e),x({title:"نجح",description:"تم تحديد الموعد كمكتمل",variant:"default"})}catch(e){console.error("Error updating appointment:",e),x({title:"خطأ",description:"حدث خطأ أثناء تحديث الموعد",variant:"destructive"})}finally{N(!1)}}},children:w?"جاري...":"completed"===a?.status?"مكتمل ✓":"مكتمل"})]})]})]}),e.jsxs(nc,{children:[e.jsxs(ac,{className:"pb-3",children:[e.jsx(sc,{className:"text-lg arabic-enhanced",children:"جدول اليوم"}),e.jsx(rc,{className:"text-sm arabic-enhanced",children:In(new Date)})]}),e.jsx(ic,{dir:"rtl",children:e.jsxs("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:[z.filter(e=>(new Date).toDateString()===new Date(e.start_time).toDateString()).slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border cursor-pointer hover:bg-muted/50 gap-2",onClick:()=>i(t),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium arabic-enhanced truncate",title:t.patient?.full_name||t.patient_name||"مريض غير معروف",children:t.patient?.full_name||t.patient_name||"مريض غير معروف"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Bn(t.start_time)})]}),e.jsx(oc,{variant:"outline",className:`${qn(t.status)} whitespace-nowrap flex-shrink-0 text-xs`,children:qC(t.status)})]},t.id)),0===t.filter(e=>(new Date).toDateString()===new Date(e.start_time).toDateString()).length&&e.jsx("p",{className:"text-xs text-muted-foreground text-center py-4 arabic-enhanced",children:"لا توجد مواعيد اليوم"})]})})]}),e.jsxs(nc,{children:[e.jsxs(ac,{className:"pb-3",children:[e.jsx(sc,{className:"text-lg arabic-enhanced",children:"جدول الغد"}),e.jsx(rc,{className:"text-sm arabic-enhanced",children:In(new Date(Date.now()+864e5))})]}),e.jsx(ic,{dir:"rtl",children:e.jsxs("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:[z.filter(e=>new Date(Date.now()+864e5).toDateString()===new Date(e.start_time).toDateString()).slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border cursor-pointer hover:bg-muted/50 gap-2",onClick:()=>i(t),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium arabic-enhanced truncate",title:t.patient?.full_name||t.patient_name||"مريض غير معروف",children:t.patient?.full_name||t.patient_name||"مريض غير معروف"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Bn(t.start_time)})]}),e.jsx(oc,{variant:"outline",className:`${qn(t.status)} whitespace-nowrap flex-shrink-0 text-xs`,children:qC(t.status)})]},t.id)),0===t.filter(e=>new Date(Date.now()+864e5).toDateString()===new Date(e.start_time).toDateString()).length&&e.jsx("p",{className:"text-xs text-muted-foreground text-center py-4 arabic-enhanced",children:"لا توجد مواعيد غداً"})]})})]})]})]}),e.jsx(tc,{isOpen:g,onClose:()=>{f(!1),D(null)},onSave:async e=>{try{a?(console.log("🔄 Updating appointment:",{id:a.id,data:e}),await m(a.id,e),console.log("✅ Appointment updated successfully"),x({title:"نجح",description:"تم تحديث الموعد بنجاح",variant:"default"})):(console.log("➕ Creating new appointment:",e),await u(e),console.log("✅ Appointment created successfully"),x({title:"نجح",description:"تم إضافة الموعد بنجاح",variant:"default"})),f(!1),i(null),D(null)}catch(t){console.error("❌ Error saving appointment:",t),x({title:"خطأ",description:"حدث خطأ أثناء حفظ الموعد",variant:"destructive"})}},patients:p,treatments:[],selectedDate:$?.date,selectedTime:$?.time,initialData:a}),e.jsx(VC,{isOpen:v,appointment:b&&t.find(e=>e.id===b)||null,patient:b&&p.find(e=>e.id===t.find(e=>e.id===b)?.patient_id)||null,onClose:()=>{y(!1),j(null)},onConfirm:async()=>{if(b){N(!0);try{await d(b),x({title:"نجح",description:"تم حذف الموعد بنجاح",variant:"default"}),y(!1),j(null)}catch(e){console.error("Error deleting appointment:",e),x({title:"خطأ",description:"حدث خطأ أثناء حذف الموعد",variant:"destructive"})}finally{N(!1)}}},isLoading:w}),e.jsx(bf,{open:_,patient:S,onOpenChange:e=>{k(e),e||C(null)}})]})}const HC=de()(xt((e,t)=>({labs:[],selectedLab:null,isLoading:!1,error:null,searchQuery:"",filteredLabs:[],loadLabs:async()=>{e({isLoading:!0,error:null});try{const t=await(window.electronAPI?.labs?.getAll())||[];e({labs:t,filteredLabs:t,isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Failed to load labs",isLoading:!1})}},createLab:async n=>{console.log("🔍 [DEBUG] labStore.createLab() called with data:",n),e({isLoading:!0,error:null});try{console.log("📡 [DEBUG] Calling window.electronAPI.labs.create...");const a=await(window.electronAPI?.labs?.create(n));if(console.log("📨 [DEBUG] Received response from electronAPI:",a),a){const{labs:n}=t();console.log("📊 [DEBUG] Current labs count before adding:",n.length);const s=[...n,a];console.log("📊 [DEBUG] Updated labs count after adding:",s.length),e({labs:s,isLoading:!1}),console.log("✅ [DEBUG] Store state updated successfully"),t().filterLabs(),console.log("✅ [DEBUG] Labs filtered successfully")}else console.warn("⚠️ [DEBUG] No lab returned from electronAPI")}catch(a){throw console.error("❌ [DEBUG] Error in labStore.createLab:",a),e({error:a instanceof Error?a.message:"Failed to create lab",isLoading:!1}),a}},updateLab:async(n,a)=>{e({isLoading:!0,error:null});try{const s=await(window.electronAPI?.labs?.update(n,a));if(s){const{labs:a}=t(),r=a.map(e=>e.id===n?s:e);e({labs:r,selectedLab:t().selectedLab?.id===n?s:t().selectedLab,isLoading:!1}),t().filterLabs()}}catch(s){throw console.error("Error updating lab:",s),e({error:s instanceof Error?s.message:"Failed to update lab",isLoading:!1}),s}},deleteLab:async n=>{e({isLoading:!0,error:null});try{if(await(window.electronAPI?.labs?.delete(n))){const{labs:a}=t(),s=a.filter(e=>e.id!==n);e({labs:s,selectedLab:t().selectedLab?.id===n?null:t().selectedLab,isLoading:!1}),t().filterLabs()}}catch(a){throw console.error("Error deleting lab:",a),e({error:a instanceof Error?a.message:"Failed to delete lab",isLoading:!1}),a}},setSelectedLab:t=>e({selectedLab:t}),setSearchQuery:n=>{e({searchQuery:n}),t().filterLabs()},filterLabs:()=>{const{labs:n,searchQuery:a}=t();if(!a.trim())return void e({filteredLabs:n});const s=n.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())||e.contact_info&&e.contact_info.toLowerCase().includes(a.toLowerCase())||e.address&&e.address.toLowerCase().includes(a.toLowerCase()));e({filteredLabs:s})},clearError:()=>e({error:null})}),{name:"lab-store"}));function GC({labs:t,onEdit:n,onDelete:a,searchQuery:s}){const{isLoading:r}=HC(),{getOrdersByLab:i}=ph(),[l,o]=re.useState(1),[c,d]=re.useState(10),m=t.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())||e.contact_info&&e.contact_info.toLowerCase().includes(s.toLowerCase())||e.address&&e.address.toLowerCase().includes(s.toLowerCase())),u=m.length,p=Math.ceil(u/c),h=(l-1)*c,x=m.slice(h,h+c),g=e=>{o(e)};return r?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل المختبرات..."})]})}):0===m.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Qa,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:s?"لا توجد نتائج":"لا توجد مختبرات"}),e.jsx("p",{className:"text-muted-foreground",children:s?`لم يتم العثور على مختبرات تطابق "${s}"`:"لم يتم إضافة أي مختبرات بعد"})]}):e.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-center",children:"#"}),e.jsx(Uc,{className:"text-center",children:"اسم المختبر"}),e.jsx(Uc,{className:"text-center",children:"معلومات الاتصال"}),e.jsx(Uc,{className:"text-center",children:"العنوان"}),e.jsx(Uc,{className:"text-center",children:"عدد الطلبات"}),e.jsx(Uc,{className:"text-center",children:"تاريخ الإضافة"}),e.jsx(Uc,{className:"text-center w-[100px]",children:"الإجراءات"})]})}),e.jsx(Yc,{children:x.map((t,s)=>{return e.jsxs(qc,{className:"hover:bg-muted/50",children:[e.jsx(Hc,{className:"font-medium text-center",children:h+s+1}),e.jsx(Hc,{className:"font-medium text-center table-cell-wrap-truncate-md",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[t.name,e.jsx(Qa,{className:"h-4 w-4 text-blue-600"})]})}),e.jsx(Hc,{className:"text-center table-cell-wrap-truncate-sm",children:t.contact_info?e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("button",{onClick:async()=>{const e=`https://api.whatsapp.com/send/?phone=${t.contact_info?.replace(/[^\d]/g,"")||""}`;try{if(window.electronAPI&&window.electronAPI.system&&window.electronAPI.system.openExternal)return void(await window.electronAPI.system.openExternal(e))}catch(n){console.log("Method 1 failed:",n)}try{if(window.electronAPI)return void(await(window.electronAPI.shell?.openExternal?.(e)))}catch(n){console.log("Method 2 failed:",n)}window.open(e,"_blank","noopener,noreferrer")},className:"text-sm text-green-600 hover:text-green-700 hover:underline transition-colors cursor-pointer flex items-center gap-1",children:[t.contact_info,e.jsx(Os,{className:"h-3 w-3"})]})}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"غير محدد"})}),e.jsx(Hc,{className:"text-center",children:t.address?e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("span",{className:"text-sm",children:t.address}),e.jsx(Rs,{className:"h-4 w-4 text-orange-600"})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"غير محدد"})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs(oc,{variant:"secondary",className:"flex items-center gap-1 w-fit",children:[(r=t.id,i(r).length),e.jsx(cr,{className:"h-3 w-3"})]})})}),e.jsx(Hc,{className:"text-sm text-muted-foreground text-center",children:In(t.created_at)}),e.jsx(Hc,{className:"min-w-[140px] text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:()=>(e=>{n(e)})(t),children:[e.jsx(Us,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:()=>(e=>{const t=i(e.id);t.length>0?Kc.warning(`لا يمكن حذف المختبر "${e.name}" لأنه يحتوي على ${t.length} طلب`):a(e)})(t),children:[e.jsx(dr,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]})]})})]},t.id);var r})})]}),p>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(Nl,{value:`${c}`,onValueChange:e=>{d(parseInt(e)),o(1)},children:[e.jsx(Sl,{className:"h-8 w-[70px]",children:e.jsx(kl,{placeholder:c})}),e.jsx(Dl,{side:"top",children:[5,10,20,30,50].map(t=>e.jsx(Al,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",l," من ",p]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>g(1),disabled:1===l,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(cs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>g(l-1),disabled:1===l,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(is,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>g(l+1),disabled:l===p,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(rs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>g(p),disabled:l===p,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(os,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-muted-foreground arabic-enhanced",children:["عرض ",h+1," إلى ",Math.min(h+c,u)," من ",u," نتيجة"]})]})]})}function WC({open:t,onOpenChange:n,editingLab:a}){const{createLab:s,updateLab:r,isLoading:i}=HC(),[l,o]=re.useState({name:"",contact_info:"",address:""}),[c,d]=re.useState({});re.useEffect(()=>{t&&(o(a?{name:a.name||"",contact_info:a.contact_info||"",address:a.address||""}:{name:"",contact_info:"",address:""}),d({}))},[t,a]);const m=(e,t)=>{o(n=>({...n,[e]:t})),c[e]&&d(t=>({...t,[e]:""}))};return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsxs(Er,{className:"text-right",dir:"rtl",children:[e.jsxs(Ar,{className:"flex items-center gap-2 justify-end text-right",children:[e.jsx("span",{children:a?"تعديل المختبر":"إضافة مختبر جديد"}),e.jsx(Qa,{className:"h-5 w-5 text-blue-600"})]}),e.jsx(Fr,{className:"text-right",children:a?"قم بتعديل معلومات المختبر أدناه":"أدخل معلومات المختبر الجديد أدناه"})]}),e.jsxs("form",{onSubmit:async e=>{if(console.log("🔍 [DEBUG] AddLabDialog.handleSubmit() called"),e.preventDefault(),console.log("📝 [DEBUG] Form data before validation:",l),(()=>{const e={};return l.name.trim()?l.name.trim().length<2&&(e.name="اسم المختبر يجب أن يكون على الأقل حرفين"):e.name="اسم المختبر مطلوب",l.contact_info&&l.contact_info.trim().length<5&&(e.contact_info="معلومات الاتصال يجب أن تكون على الأقل 5 أحرف"),l.address&&l.address.trim().length<5&&(e.address="العنوان يجب أن يكون على الأقل 5 أحرف"),d(e),0===Object.keys(e).length})()){console.log("✅ [DEBUG] Form validation passed");try{const e={name:l.name.trim(),contact_info:l.contact_info.trim()||void 0,address:l.address.trim()||void 0};console.log("📤 [DEBUG] Prepared lab data for submission:",e),a?(console.log("🔄 [DEBUG] Updating existing lab with ID:",a.id),await r(a.id,e),Kc.success("تم تحديث المختبر بنجاح")):(console.log("➕ [DEBUG] Creating new lab"),await s(e),console.log("✅ [DEBUG] Lab created successfully"),Kc.success("تم إضافة المختبر بنجاح")),console.log("🚪 [DEBUG] Closing dialog"),n(!1)}catch(t){console.error("❌ [DEBUG] Error in AddLabDialog.handleSubmit:",t),console.error("❌ [DEBUG] Error stack:",t.stack),Kc.error(a?"فشل في تحديث المختبر":"فشل في إضافة المختبر")}}else console.log("❌ [DEBUG] Form validation failed")},className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"name",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Qa,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"اسم المختبر *"})]}),e.jsx(Ir,{id:"name",value:l.name,onChange:e=>m("name",e.target.value),placeholder:"أدخل اسم المختبر",className:"text-right "+(c.name?"border-destructive":""),disabled:i,dir:"rtl"}),c.name&&e.jsx("p",{className:"text-sm text-destructive text-right",children:c.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"contact_info",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Hs,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"معلومات الاتصال"})]}),e.jsx(Ir,{id:"contact_info",value:l.contact_info,onChange:e=>m("contact_info",e.target.value),placeholder:"رقم الهاتف أو البريد الإلكتروني",className:"text-right "+(c.contact_info?"border-destructive":""),disabled:i,dir:"rtl"}),c.contact_info&&e.jsx("p",{className:"text-sm text-destructive text-right",children:c.contact_info})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"address",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Rs,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{children:"العنوان"})]}),e.jsx(wl,{id:"address",value:l.address,onChange:e=>m("address",e.target.value),placeholder:"عنوان المختبر",className:"text-right "+(c.address?"border-destructive":""),disabled:i,rows:3,dir:"rtl"}),c.address&&e.jsx("p",{className:"text-sm text-destructive text-right",children:c.address})]}),e.jsxs(Tr,{className:"flex flex-row-reverse gap-2 pt-4",dir:"rtl",children:[e.jsx(Lr,{type:"submit",disabled:i,className:"min-w-[100px]",children:i?e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"w-4 h-4 ml-2 animate-spin"}),a?"جاري التحديث...":"جاري الإضافة..."]}):a?"تحديث":"إضافة"}),e.jsx(Lr,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:i,children:"إلغاء"})]})]})]})})}function KC({open:t,onOpenChange:n,lab:a}){const{deleteLab:s,isLoading:r}=HC(),{getOrdersByLab:i}=ph();if(!a)return null;const l=i(a.id),o=l.length>0;return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsxs(Er,{dir:"rtl",children:[e.jsxs(Ar,{className:"flex items-center gap-2 text-destructive text-right",children:[e.jsx(qa,{className:"h-5 w-5"}),"تأكيد حذف المختبر"]}),e.jsx(Fr,{className:"text-right",children:"هذا الإجراء لا يمكن التراجع عنه. سيتم حذف المختبر نهائياً من النظام."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qa,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:"اسم المختبر:"}),e.jsx("span",{children:a.name})]}),a.contact_info&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"معلومات الاتصال:"}),e.jsx("span",{className:"text-sm",children:a.contact_info})]}),a.address&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"العنوان:"}),e.jsx("span",{className:"text-sm",children:a.address})]})]}),o&&e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-destructive mb-2",children:[e.jsx(qa,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"تحذير مهم"})]}),e.jsx("p",{className:"text-sm text-destructive mb-3",children:"هذا المختبر يحتوي على طلبات مرتبطة به. حذف المختبر سيؤدي إلى حذف جميع الطلبات المرتبطة به أيضاً."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{className:"text-sm font-medium",children:"عدد الطلبات المرتبطة:"}),e.jsxs(oc,{variant:"destructive",className:"text-xs",children:[l.length," طلب"]})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"هل أنت متأكد من رغبتك في حذف هذا المختبر؟"}),o&&e.jsxs("span",{className:"block mt-1",children:["سيتم حذف جميع الطلبات المرتبطة بهذا المختبر (",l.length," طلب)."]})]})})]}),e.jsxs(Tr,{className:"gap-2",dir:"rtl",children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:r,children:"إلغاء"}),e.jsx(Lr,{type:"button",variant:"destructive",onClick:async()=>{try{await s(a.id),Kc.success(`تم حذف المختبر "${a.name}" بنجاح`),n(!1)}catch(e){console.error("Error deleting lab:",e),Kc.error("فشل في حذف المختبر")}},disabled:r,className:"min-w-[100px]",children:r?e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري الحذف..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qa,{className:"w-4 h-4 ml-2"}),"حذف نهائياً"]})})]})]})})}function ZC({labOrders:t,onEdit:n,onDelete:a,onView:s}){const{isLoading:r}=ph(),{labs:i}=HC(),[l,o]=re.useState(1),[c,d]=re.useState(10),m=(e,t)=>{if(t?.name)return t.name;const n=i.find(t=>t.id===e);return n?n.name:`مختبر غير محدد (${e.substring(0,8)}...)`},u=t=>{switch(t){case"معلق":return e.jsxs(oc,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(us,{className:"w-3 h-3 mr-1"}),"معلق"]});case"مكتمل":return e.jsxs(oc,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(ns,{className:"w-3 h-3 mr-1"}),"مكتمل"]});case"ملغي":return e.jsxs(oc,{variant:"destructive",children:[e.jsx(Nr,{className:"w-3 h-3 mr-1"}),"ملغي"]});default:return e.jsx(oc,{variant:"outline",children:t})}},p=(t,n=0)=>{const a=t-n,s=t>0?Math.round(n/t*100):0;return a<=0?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(oc,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"مدفوع بالكامل"}),e.jsx("span",{className:"text-xs text-green-600",children:"100%"})]}):n>0?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(oc,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"مدفوع جزئياً"}),e.jsxs("span",{className:"text-xs text-yellow-600",children:[s,"%"]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(oc,{variant:"secondary",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:"غير مدفوع"}),e.jsx("span",{className:"text-xs text-red-600",children:"0%"})]})},h=t.length,x=Math.ceil(h/c),g=(l-1)*c,f=t.slice(g,g+c),v=e=>{o(e)};return r?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل طلبات المختبرات..."})]})}):0===t.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(cr,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"لا توجد طلبات مختبرات"}),e.jsx("p",{className:"text-muted-foreground",children:"لم يتم إضافة أي طلبات مختبرات بعد"})]}):e.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-center w-[60px]",children:"رقم"}),e.jsx(Uc,{className:"text-center",children:"اسم المختبر"}),e.jsx(Uc,{className:"text-center",children:"اسم الخدمة"}),e.jsx(Uc,{className:"text-center",children:"التكلفة"}),e.jsx(Uc,{className:"text-center",children:"المدفوع"}),e.jsx(Uc,{className:"text-center",children:"تاريخ الطلب"}),e.jsx(Uc,{className:"text-center",children:"الحالة"}),e.jsx(Uc,{className:"text-center",children:"حالة الدفع"}),e.jsx(Uc,{className:"text-center w-[120px]",children:"الإجراءات"})]})}),e.jsx(Yc,{children:f.map((t,r)=>e.jsxs(qc,{className:"hover:bg-muted/50",children:[e.jsx(Hc,{className:"font-medium text-center",children:g+r+1}),e.jsx(Hc,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("span",{className:"font-medium",children:m(t.lab_id,t.lab)}),m(t.lab_id,t.lab).includes("مختبر غير محدد")&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"المختبر قد يكون محذوفاً"})]}),e.jsx(Qa,{className:"h-4 w-4 text-blue-600"})]})}),e.jsx(Hc,{className:"text-center",children:e.jsx("span",{children:t.service_name})}),e.jsx(Hc,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("span",{className:"font-semibold",children:Mn(t.cost)}),e.jsx(gs,{className:"h-4 w-4 text-green-600"})]})}),e.jsxs(Hc,{className:"text-center",children:[e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("span",{className:"font-semibold text-blue-600",children:Mn(t.paid_amount||0)}),e.jsx(hs,{className:"h-4 w-4 text-blue-600"})]}),t.remaining_balance&&t.remaining_balance>0&&e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:["متبقي: ",Mn(t.remaining_balance)]})]}),e.jsx(Hc,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("span",{className:"text-sm",children:In(t.order_date)}),e.jsx(es,{className:"h-4 w-4 text-gray-600"})]})}),e.jsx(Hc,{className:"text-center",children:u(t.status)}),e.jsx(Hc,{className:"text-center",children:p(t.cost,t.paid_amount)}),e.jsx(Hc,{className:"min-w-[180px] text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[s&&e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-view",onClick:()=>s(t),children:[e.jsx(ys,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"عرض"})]}),e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-edit",onClick:()=>n(t),children:[e.jsx(Us,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"تعديل"})]}),e.jsxs(Lr,{variant:"ghost",size:"sm",className:"action-btn-delete",onClick:()=>a(t),children:[e.jsx(dr,{className:"w-4 h-4 ml-1"}),e.jsx("span",{className:"text-xs arabic-enhanced",children:"حذف"})]})]})})]},t.id))})]}),x>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(Nl,{value:`${c}`,onValueChange:e=>{d(parseInt(e)),o(1)},children:[e.jsx(Sl,{className:"h-8 w-[70px]",children:e.jsx(kl,{placeholder:c})}),e.jsx(Dl,{side:"top",children:[5,10,20,30,50].map(t=>e.jsx(Al,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",l," من ",x]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>v(1),disabled:1===l,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(cs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>v(l-1),disabled:1===l,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(is,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>v(l+1),disabled:l===x,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(rs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>v(x),disabled:l===x,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(os,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-muted-foreground arabic-enhanced",children:["عرض ",g+1," إلى ",Math.min(g+c,h)," من ",h," نتيجة"]})]})]})}function QC({open:t,onOpenChange:n,editingOrder:a}){const{labs:s}=HC(),{patients:r}=bt(),{createLabOrder:i,updateLabOrder:l,isLoading:o}=ph(),[c,d]=re.useState({lab_id:"",patient_id:"",appointment_id:"",tooth_treatment_id:"",tooth_number:"",service_name:"",cost:"",order_date:"",expected_delivery_date:"",actual_delivery_date:"",status:"معلق",notes:"",paid_amount:"",priority:"1",lab_instructions:"",material_type:"",color_shade:""}),[m,u]=re.useState({});re.useEffect(()=>{if(t){if(a)d({lab_id:a.lab_id||"",patient_id:a.patient_id||"none",appointment_id:a.appointment_id||"",tooth_treatment_id:a.tooth_treatment_id||"",tooth_number:a.tooth_number?.toString()||"",service_name:a.service_name||"",cost:a.cost?.toString()||"",order_date:a.order_date||"",expected_delivery_date:a.expected_delivery_date||"",actual_delivery_date:a.actual_delivery_date||"",status:a.status||"معلق",notes:a.notes||"",paid_amount:a.paid_amount?.toString()||"0",priority:a.priority?.toString()||"1",lab_instructions:a.lab_instructions||"",material_type:a.material_type||"",color_shade:a.color_shade||""});else{const e=(new Date).toISOString().split("T")[0];d({lab_id:"",patient_id:"none",appointment_id:"",tooth_treatment_id:"",tooth_number:"",service_name:"",cost:"",order_date:e,expected_delivery_date:"",actual_delivery_date:"",status:"معلق",notes:"",paid_amount:"0",priority:"1",lab_instructions:"",material_type:"",color_shade:""})}u({})}},[t,a]);const p=(e,t)=>{d(n=>({...n,[e]:t})),m[e]&&u(t=>({...t,[e]:""}))};return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{className:"text-right",dir:"rtl",children:[e.jsxs(Ar,{className:"flex items-center gap-2 justify-end text-right",children:[e.jsx("span",{children:a?"تعديل طلب المختبر":"إضافة طلب مختبر جديد"}),e.jsx(Ms,{className:"h-5 w-5 text-purple-600"})]}),e.jsx(Fr,{className:"text-right",children:a?"قم بتعديل معلومات طلب المختبر أدناه":"أدخل معلومات طلب المختبر الجديد أدناه"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};if(c.lab_id||(e.lab_id="يجب اختيار المختبر"),c.service_name.trim()?c.service_name.trim().length<2&&(e.service_name="اسم الخدمة يجب أن يكون على الأقل حرفين"):e.service_name="اسم الخدمة/التحليل مطلوب",c.cost.trim()){const t=parseFloat(c.cost);(isNaN(t)||t<=0)&&(e.cost="التكلفة يجب أن تكون رقم موجب")}else e.cost="التكلفة مطلوبة";if(c.order_date||(e.order_date="تاريخ الطلب مطلوب"),c.paid_amount.trim()){const t=parseFloat(c.paid_amount),n=parseFloat(c.cost);isNaN(t)||t<0?e.paid_amount="المبلغ المدفوع يجب أن يكون رقم غير سالب":!isNaN(n)&&t>n&&(e.paid_amount="المبلغ المدفوع لا يمكن أن يكون أكبر من التكلفة الإجمالية")}return u(e),0===Object.keys(e).length})())try{const e=parseFloat(c.cost),t=parseFloat(c.paid_amount)||0,s=e-t,r={lab_id:c.lab_id,patient_id:"none"===c.patient_id?void 0:c.patient_id||void 0,appointment_id:c.appointment_id||void 0,tooth_treatment_id:c.tooth_treatment_id||void 0,tooth_number:c.tooth_number?parseInt(c.tooth_number):void 0,service_name:c.service_name.trim(),cost:e,order_date:c.order_date,expected_delivery_date:c.expected_delivery_date||void 0,actual_delivery_date:c.actual_delivery_date||void 0,status:c.status,notes:c.notes.trim()||void 0,paid_amount:t,remaining_balance:s,priority:parseInt(c.priority)||1,lab_instructions:c.lab_instructions.trim()||void 0,material_type:c.material_type.trim()||void 0,color_shade:c.color_shade.trim()||void 0};a?(await l(a.id,r),Kc.success("تم تحديث طلب المختبر بنجاح")):(await i(r),Kc.success("تم إضافة طلب المختبر بنجاح")),n(!1)}catch(t){console.error("Error saving lab order:",t),Kc.error(a?"فشل في تحديث طلب المختبر":"فشل في إضافة طلب المختبر")}},className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"lab_id",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Qa,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"المختبر *"})]}),e.jsxs(Nl,{value:c.lab_id,onValueChange:e=>p("lab_id",e),disabled:o,dir:"rtl",children:[e.jsx(Sl,{className:"text-right bg-background border-input text-foreground "+(m.lab_id?"border-destructive":""),children:e.jsx(kl,{placeholder:"اختر المختبر",className:"text-muted-foreground"})}),e.jsx(Dl,{children:s.map(t=>e.jsx(Al,{value:t.id,children:t.name},t.id))})]}),m.lab_id&&e.jsx("p",{className:"text-sm text-destructive text-right",children:m.lab_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"patient_id",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(yr,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"المريض (اختياري)"})]}),e.jsxs(Nl,{value:c.patient_id,onValueChange:e=>p("patient_id",e),disabled:o,dir:"rtl",children:[e.jsx(Sl,{className:"text-right bg-background border-input text-foreground",children:e.jsx(kl,{placeholder:"اختر المريض (اختياري)",className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"none",children:"بدون مريض محدد"}),r.map(t=>e.jsx(Al,{value:t.id,children:t.full_name},t.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"service_name",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Ms,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{children:"اسم الخدمة *"})]}),e.jsx(Ir,{id:"service_name",value:c.service_name,onChange:e=>p("service_name",e.target.value),placeholder:"مثال: تحليل دم شامل، أشعة بانوراما، إلخ",className:"text-right "+(m.service_name?"border-destructive":""),disabled:o,dir:"rtl"}),m.service_name&&e.jsx("p",{className:"text-sm text-destructive text-right",children:m.service_name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"cost",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(gs,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"التكلفة *"})]}),e.jsx(Ir,{id:"cost",type:"number",step:"0.1",min:"0",value:c.cost,onChange:e=>p("cost",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;p("cost",t.toString())},placeholder:"0.00",className:"text-right "+(m.cost?"border-destructive":""),disabled:o,dir:"rtl"}),m.cost&&e.jsx("p",{className:"text-sm text-destructive text-right",children:m.cost})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"paid_amount",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(hs,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"المبلغ المدفوع"})]}),e.jsx(Ir,{id:"paid_amount",type:"number",step:"0.1",min:"0",value:c.paid_amount,onChange:e=>p("paid_amount",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;p("paid_amount",t.toString())},placeholder:"0.00",className:"text-right "+(m.paid_amount?"border-destructive":""),disabled:o,dir:"rtl"}),m.paid_amount&&e.jsx("p",{className:"text-sm text-destructive text-right",children:m.paid_amount})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Xa,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{children:"المبلغ المتبقي"})]}),e.jsx("div",{className:"h-10 px-3 py-2 border rounded-md bg-muted flex items-center justify-end",children:e.jsx("span",{className:"text-sm font-medium",children:Mn((parseFloat(c.cost)||0)-(parseFloat(c.paid_amount)||0))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"order_date",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(es,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"تاريخ الطلب *"})]}),e.jsx(Ir,{id:"order_date",type:"date",value:c.order_date,onChange:e=>p("order_date",e.target.value),className:"text-right "+(m.order_date?"border-destructive":""),disabled:o,dir:"rtl"}),m.order_date&&e.jsx("p",{className:"text-sm text-destructive text-right",children:m.order_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"status",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Ms,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{children:"الحالة *"})]}),e.jsxs(Nl,{value:c.status,onValueChange:e=>p("status",e),disabled:o,dir:"rtl",children:[e.jsx(Sl,{className:"text-right bg-background border-input text-foreground",children:e.jsx(kl,{className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"معلق",children:"معلق"}),e.jsx(Al,{value:"مكتمل",children:"مكتمل"}),e.jsx(Al,{value:"ملغي",children:"ملغي"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"expected_delivery_date",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(es,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{children:"تاريخ التسليم المتوقع"})]}),e.jsx(Ir,{id:"expected_delivery_date",type:"date",value:c.expected_delivery_date,onChange:e=>p("expected_delivery_date",e.target.value),className:"text-right",disabled:o,dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"actual_delivery_date",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(es,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"تاريخ التسليم الفعلي"})]}),e.jsx(Ir,{id:"actual_delivery_date",type:"date",value:c.actual_delivery_date,onChange:e=>p("actual_delivery_date",e.target.value),className:"text-right",disabled:o,dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"priority",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Xa,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{children:"الأولوية"})]}),e.jsxs(Nl,{value:c.priority,onValueChange:e=>p("priority",e),disabled:o,dir:"rtl",children:[e.jsx(Sl,{className:"text-right bg-background border-input text-foreground",children:e.jsx(kl,{className:"text-muted-foreground"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"1",children:"عالية (1)"}),e.jsx(Al,{value:"2",children:"متوسطة (2)"}),e.jsx(Al,{value:"3",children:"منخفضة (3)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"material_type",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Qa,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{children:"نوع المادة"})]}),e.jsx(Ir,{id:"material_type",value:c.material_type,onChange:e=>p("material_type",e.target.value),placeholder:"مثال: زيركونيا، بورسلين، أكريل",className:"text-right",disabled:o,dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"color_shade",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(Ms,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"درجة اللون"})]}),e.jsx(Ir,{id:"color_shade",value:c.color_shade,onChange:e=>p("color_shade",e.target.value),placeholder:"مثال: A1، B2، C3",className:"text-right",disabled:o,dir:"rtl"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"lab_instructions",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(bs,{className:"h-4 w-4 text-indigo-600"}),e.jsx("span",{children:"تعليمات للمختبر"})]}),e.jsx(wl,{id:"lab_instructions",value:c.lab_instructions,onChange:e=>p("lab_instructions",e.target.value),placeholder:"تعليمات خاصة للمختبر...",className:"text-right min-h-[80px] resize-none",disabled:o,dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"notes",className:"flex items-center gap-2 justify-start text-right font-medium",dir:"rtl",children:[e.jsx(bs,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{children:"ملاحظات"})]}),e.jsx(wl,{id:"notes",value:c.notes,onChange:e=>p("notes",e.target.value),placeholder:"أي ملاحظات إضافية حول الطلب...",disabled:o,rows:3,className:"text-right",dir:"rtl"})]}),e.jsxs(Tr,{className:"flex flex-row-reverse gap-2 pt-4",dir:"rtl",children:[e.jsx(Lr,{type:"submit",disabled:o,className:"min-w-[100px]",children:o?e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"w-4 h-4 ml-2 animate-spin"}),a?"جاري التحديث...":"جاري الإضافة..."]}):a?"تحديث":"إضافة"}),e.jsx(Lr,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:o,children:"إلغاء"})]})]})]})})}function XC({open:t,onOpenChange:n,labOrder:a}){const{deleteLabOrder:s,isLoading:r}=ph();if(!a)return null;return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsxs(Er,{dir:"rtl",children:[e.jsxs(Ar,{className:"flex items-center gap-2 text-destructive text-right",children:[e.jsx(qa,{className:"h-5 w-5"}),"تأكيد حذف طلب المختبر"]}),e.jsx(Fr,{className:"text-right",children:"هذا الإجراء لا يمكن التراجع عنه. سيتم حذف طلب المختبر نهائياً من النظام."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qa,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:"المختبر:"}),e.jsx("span",{children:a.lab?.name||"غير محدد"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"font-semibold",children:"اسم الخدمة:"}),e.jsx("span",{children:a.service_name})]}),a.patient&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yr,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-semibold",children:"المريض:"}),e.jsx("span",{children:a.patient.full_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-semibold",children:"التكلفة:"}),e.jsx("span",{className:"font-bold",children:Mn(a.cost)})]}),a.paid_amount&&a.paid_amount>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:"المبلغ المدفوع:"}),e.jsx("span",{className:"font-bold",children:Mn(a.paid_amount)})]}),a.remaining_balance&&a.remaining_balance>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"font-semibold",children:"المبلغ المتبقي:"}),e.jsx("span",{className:"font-bold text-red-600",children:Mn(a.remaining_balance)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-semibold",children:"تاريخ الطلب:"}),e.jsx("span",{children:In(a.order_date)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"الحالة:"}),(t=>{switch(t){case"معلق":return e.jsx(oc,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"معلق"});case"مكتمل":return e.jsx(oc,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"مكتمل"});case"ملغي":return e.jsx(oc,{variant:"destructive",children:"ملغي"});default:return e.jsx(oc,{variant:"outline",children:t})}})(a.status)]}),a.notes&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"font-semibold",children:"الملاحظات:"}),e.jsx("p",{className:"text-sm text-muted-foreground bg-background p-2 rounded border",children:a.notes})]})]}),a.paid_amount&&a.paid_amount>0&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800 dark:text-yellow-200 mb-2",children:[e.jsx(qa,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"تحذير"})]}),e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:["هذا الطلب يحتوي على مدفوعات بقيمة ",Mn(a.paid_amount),". حذف الطلب لن يؤثر على سجلات المدفوعات الأخرى في النظام."]})]}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-200",children:[e.jsx("strong",{children:"هل أنت متأكد من رغبتك في حذف طلب المختبر هذا؟"}),e.jsx("span",{className:"block mt-1",children:"سيتم حذف جميع المعلومات المرتبطة بهذا الطلب نهائياً."})]})})]}),e.jsxs(Tr,{className:"gap-2",dir:"rtl",children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:r,children:"إلغاء"}),e.jsx(Lr,{type:"button",variant:"destructive",onClick:async()=>{try{await s(a.id),Kc.success("تم حذف طلب المختبر بنجاح"),n(!1)}catch(e){console.error("Error deleting lab order:",e),Kc.error("فشل في حذف طلب المختبر")}},disabled:r,className:"min-w-[100px]",children:r?e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"w-4 h-4 ml-2 animate-spin"}),"جاري الحذف..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qa,{className:"w-4 h-4 ml-2"}),"حذف نهائياً"]})})]})]})})}function JC(){const{labs:t,loadLabs:n,isLoading:a}=HC(),{labOrders:s,filteredLabOrders:r,totalOrders:i,totalCost:l,totalPaid:o,totalRemaining:c,pendingOrders:d,completedOrders:m,cancelledOrders:u,loadLabOrders:p,setSearchQuery:h,setStatusFilter:x,setLabFilter:g,setDateRangeFilter:f,clearFilters:v,isLoading:y}=ph(),{patients:b,loadPatients:j}=bt(),w=Tc({data:s,dateField:"order_date",initialFilter:{preset:"all",startDate:"",endDate:""}}),[N,_]=re.useState(""),[k,S]=re.useState("all"),[C,$]=re.useState("all"),[D,E]=re.useState({start:"",end:""}),[T,A]=re.useState(!1),[F,P]=re.useState(!1),[R,O]=re.useState(!1),[M,L]=re.useState(!1),[I,z]=re.useState(!1),[B,V]=re.useState(null),[Y,q]=re.useState(null),[U,H]=re.useState(null),[G,W]=re.useState(null),[K,Z]=re.useState("orders");ua(),re.useEffect(()=>{(async()=>{try{await n(),await p(),await j()}catch(e){console.error("Error loading data:",e)}})()},[n,p,j]),re.useEffect(()=>{"orders"===K&&h(N)},[N,K,h]),re.useEffect(()=>{x(k)},[k,x]),re.useEffect(()=>{g(C)},[C,g]),re.useEffect(()=>{f(D)},[D,f]);return e.jsxs("div",{className:"space-y-6 p-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",dir:"rtl",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"إدارة المختبرات"}),e.jsx("p",{className:"text-muted-foreground",children:"إدارة المختبرات وطلبات التحاليل والفحوصات"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{try{await Promise.all([n(),p(),j()]),Kc.success("تم تحديث البيانات بنجاح")}catch(e){Kc.error("فشل في تحديث البيانات")}},disabled:a||y,children:[e.jsx(Js,{className:"w-4 h-4 mr-2 "+(a||y?"animate-spin":"")}),"تحديث"]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:async()=>{try{let e="";if("orders"===K){e=["رقم الطلب","اسم المختبر","اسم الخدمة/التحليل","اسم المريض","التكلفة","المبلغ المدفوع","المبلغ المتبقي","تاريخ الطلب","الحالة","الملاحظات"].join(",")+"\n",r.forEach((t,n)=>{const a=[n+1,`"${t.lab?.name||"غير محدد"}"`,`"${t.service_name}"`,`"${t.patient?.full_name||"غير محدد"}"`,t.cost,t.paid_amount||0,t.remaining_balance||0,In(t.order_date),`"${t.status}"`,`"${t.notes||""}"`];e+=a.join(",")+"\n"})}else{e=["اسم المختبر","معلومات الاتصال","العنوان","عدد الطلبات","تاريخ الإضافة"].join(",")+"\n",t.forEach(t=>{const n=s.filter(e=>e.lab_id===t.id).length,a=[`"${t.name}"`,`"${t.contact_info||""}"`,`"${t.address||""}"`,n,In(t.created_at)];e+=a.join(",")+"\n"})}"orders"===K?await Zc.exportLabsToExcel(t,r):await Zc.exportLabsToExcel(t,s),Kc.success("تم تصدير البيانات بنجاح إلى ملف Excel مع التنسيق الجميل")}catch(e){console.error("Export error:",e),Kc.error("فشل في تصدير البيانات")}},children:[e.jsx(fs,{className:"w-4 h-4 mr-2"}),"تصدير اكسل"]})]})]}),e.jsx(Ec,{value:w.timeFilter,onChange:w.handleFilterChange,onClear:w.resetFilter,title:"فلترة زمنية - طلبات المختبرات",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",dir:"rtl",children:[e.jsxs(nc,{className:pc("blue"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?"إجمالي الطلبات":"الطلبات المفلترة"}),e.jsx(Ms,{className:`h-4 w-4 ${hc("blue")}`})]}),e.jsxs(ic,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?s.length:w.filteredData.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?"طلبات إجمالية":"طلبات في الفترة المحددة"}),w.trend&&e.jsx("div",{className:"text-xs flex items-center mt-1 "+(w.trend.isPositive?"text-green-600":"text-red-600"),children:e.jsxs("span",{children:[Math.abs(w.trend.changePercent),"% من الفترة السابقة"]})})]})]}),e.jsxs(nc,{className:pc("green"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?"إجمالي التكلفة":"التكلفة المفلترة"}),e.jsx(gs,{className:`h-4 w-4 ${hc("green")}`})]}),e.jsxs(ic,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:Mn("all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?l:w.filteredData.reduce((e,t)=>e+(t.cost||0),0))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?"تكلفة جميع الطلبات":"تكلفة الطلبات في الفترة المحددة"}),w.trend&&e.jsx("div",{className:"text-xs flex items-center mt-1 "+(w.trend.isPositive?"text-green-600":"text-red-600"),children:e.jsxs("span",{children:[Math.abs(w.trend.changePercent),"% من الفترة السابقة"]})})]})]}),e.jsxs(nc,{className:pc("purple"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?"إجمالي الدفعات":"الدفعات المفلترة"}),e.jsx(ns,{className:`h-4 w-4 ${hc("purple")}`})]}),e.jsxs(ic,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:Mn("all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?o:w.filteredData.reduce((e,t)=>e+(t.paid_amount||0),0))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?"جميع الدفعات المسجلة":"دفعات في الفترة المحددة"})]})]}),e.jsxs(nc,{className:pc("orange"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?"الدفعات المتبقية":"المتبقية المفلترة"}),e.jsx(qa,{className:`h-4 w-4 ${hc("orange")}`})]}),e.jsxs(ic,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:Mn("all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?c:w.filteredData.reduce((e,t)=>e+(t.remaining_balance||0),0))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{const e="all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?s.filter(e=>(e.remaining_balance||0)>0).length:w.filteredData.filter(e=>(e.remaining_balance||0)>0).length;return`${e} طلب غير مكتمل الدفع`})()})]})]}),e.jsxs(nc,{className:pc("yellow"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?"طلبات معلقة":"طلبات معلقة مفلترة"}),e.jsx(us,{className:`h-4 w-4 ${hc("yellow")}`})]}),e.jsxs(ic,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?d:w.filteredData.filter(e=>"معلق"===e.status).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?"في انتظار الإنجاز":"معلقة في الفترة المحددة"})]})]}),e.jsxs(nc,{className:pc("emerald"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",dir:"rtl",children:[e.jsx(sc,{className:"text-sm font-medium text-muted-foreground text-right",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?"طلبات مكتملة":"طلبات مكتملة مفلترة"}),e.jsx(ns,{className:`h-4 w-4 ${hc("emerald")}`})]}),e.jsxs(ic,{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?m:w.filteredData.filter(e=>"مكتمل"===e.status).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"all"===w.timeFilter.preset||!w.timeFilter.startDate&&!w.timeFilter.endDate?"تم إنجازها بنجاح":"مكتملة في الفترة المحددة"})]})]})]}),e.jsxs(Ud,{value:K,onValueChange:Z,className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",dir:"rtl",children:[e.jsxs(Hd,{className:"grid w-fit grid-cols-2",children:[e.jsxs(Gd,{value:"orders",className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"w-4 h-4"}),"طلبات المختبرات"]}),e.jsxs(Gd,{value:"labs",className:"flex items-center gap-2",children:[e.jsx(Qa,{className:"w-4 h-4"}),"إدارة المختبرات"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:["orders"===K&&e.jsxs(Lr,{onClick:()=>{H(null),O(!0)},children:[e.jsx(Zs,{className:"w-4 h-4 mr-2"}),"طلب جديد"]}),"labs"===K&&e.jsxs(Lr,{onClick:()=>{V(null),P(!0)},children:[e.jsx(Zs,{className:"w-4 h-4 mr-2"}),"مختبر جديد"]})]})]}),e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-4",dir:"rtl",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(tr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{placeholder:"orders"===K?"البحث في طلبات المختبرات...":"البحث في المختبرات...",value:N,onChange:e=>_(e.target.value),className:"pr-10 text-right",dir:"rtl"})]}),"orders"===K&&e.jsx(Cc,{open:T,onOpenChange:A,children:e.jsx($c,{asChild:!0,children:e.jsxs(Lr,{variant:"outline",size:"sm",children:[e.jsx(js,{className:"w-4 h-4 mr-2"}),"تصفية",e.jsx(ss,{className:"w-4 h-4 ml-2 transition-transform "+(T?"rotate-180":"")})]})})}),(k||C||D.start||D.end)&&e.jsxs(Lr,{variant:"outline",size:"sm",onClick:()=>{_(""),S("all"),$("all"),E({start:"",end:""}),v()},children:[e.jsx(_r,{className:"w-4 h-4 mr-2"}),"مسح التصفية"]})]}),"orders"===K&&e.jsx(Cc,{open:T,onOpenChange:A,children:e.jsx(Dc,{className:"space-y-4",dir:"rtl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-muted/50 rounded-lg",dir:"rtl",children:[e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"الحالة"}),e.jsxs(Nl,{value:k,onValueChange:S,dir:"rtl",children:[e.jsx(Sl,{className:"text-right",children:e.jsx(kl,{placeholder:"جميع الحالات"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الحالات"}),e.jsx(Al,{value:"معلق",children:"معلق"}),e.jsx(Al,{value:"مكتمل",children:"مكتمل"}),e.jsx(Al,{value:"ملغي",children:"ملغي"})]})]})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"المختبر"}),e.jsxs(Nl,{value:C,onValueChange:$,dir:"rtl",children:[e.jsx(Sl,{className:"text-right",children:e.jsx(kl,{placeholder:"جميع المختبرات"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع المختبرات"}),t.map(t=>e.jsx(Al,{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"من تاريخ"}),e.jsx(Ir,{type:"date",value:D.start,onChange:e=>E(t=>({...t,start:e.target.value})),className:"text-right",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx("label",{className:"text-sm font-medium",children:"إلى تاريخ"}),e.jsx(Ir,{type:"date",value:D.end,onChange:e=>E(t=>({...t,end:e.target.value})),className:"text-right",dir:"rtl"})]})]})})})]}),e.jsx(Wd,{value:"orders",className:"space-y-4",dir:"rtl",children:e.jsxs(nc,{children:[e.jsxs(ac,{dir:"rtl",children:[e.jsxs(sc,{className:"flex items-center gap-2 text-right",children:[e.jsx(Ms,{className:"w-5 h-5"}),"طلبات المختبرات"]}),e.jsx(rc,{className:"text-right",children:"إدارة جميع طلبات التحاليل والفحوصات المرسلة للمختبرات"})]}),e.jsx(ic,{children:e.jsx(ZC,{labOrders:r,onEdit:e=>{H(e),O(!0)},onDelete:e=>{W(e),z(!0)}})})]})}),e.jsx(Wd,{value:"labs",className:"space-y-4",dir:"rtl",children:e.jsxs(nc,{children:[e.jsxs(ac,{dir:"rtl",children:[e.jsxs(sc,{className:"flex items-center gap-2 text-right",children:[e.jsx(Qa,{className:"w-5 h-5"}),"إدارة المختبرات"]}),e.jsx(rc,{className:"text-right",children:"إدارة معلومات المختبرات المتعاونة"})]}),e.jsx(ic,{children:e.jsx(GC,{labs:t,onEdit:e=>{V(e),P(!0)},onDelete:e=>{q(e),L(!0)},searchQuery:N})})]})})]}),e.jsx(WC,{open:F,onOpenChange:()=>{P(!1),V(null)},editingLab:B}),e.jsx(KC,{open:M,onOpenChange:()=>{L(!1),q(null)},lab:Y}),e.jsx(QC,{open:R,onOpenChange:()=>{O(!1),H(null)},editingOrder:U}),e.jsx(XC,{open:I,onOpenChange:()=>{z(!1),W(null)},labOrder:G})]})}function e$({medications:t,onEdit:n,onDelete:a,searchQuery:s}){const{isLoading:r}=xf(),[i,l]=re.useState(1),[o,c]=re.useState(10),d=t.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())||e.instructions&&e.instructions.toLowerCase().includes(s.toLowerCase())),m=d.length,u=Math.ceil(m/o),p=(i-1)*o,h=d.slice(p,p+o),x=e=>{l(e)};return r?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل الأدوية..."})]})}):0===d.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ws,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد أدوية"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s?"لم يتم العثور على أدوية تطابق البحث":"لم يتم إضافة أي أدوية بعد"}),!s&&e.jsxs(Lr,{onClick:()=>n({}),children:[e.jsx(Ws,{className:"w-4 h-4 ml-2"}),"إضافة دواء جديد"]})]}):e.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-center",children:"#"}),e.jsx(Uc,{className:"text-center",children:"اسم الدواء"}),e.jsx(Uc,{className:"text-center",children:"التعليمات"}),e.jsx(Uc,{className:"text-center",children:"تاريخ الإضافة"}),e.jsx(Uc,{className:"text-center w-[100px]",children:"الإجراءات"})]})}),e.jsx(Yc,{children:h.map((t,s)=>e.jsxs(qc,{className:"hover:bg-muted/50",children:[e.jsx(Hc,{className:"font-medium text-center",children:p+s+1}),e.jsx(Hc,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:t.name})]})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"max-w-xs mx-auto",children:t.instructions?e.jsx("div",{className:"text-sm text-muted-foreground",title:t.instructions,children:t.instructions}):e.jsx("span",{className:"text-muted-foreground italic",children:"لا توجد تعليمات"})})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"text-sm",children:In(t.created_at)})}),e.jsx(Hc,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>(e=>{n(e)})(t),className:"action-btn-edit action-btn-icon",title:"تعديل الدواء",children:e.jsx(Us,{className:"w-4 h-4"})}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>(e=>{a(e)})(t),className:"action-btn-delete action-btn-icon",title:"حذف الدواء",children:e.jsx(dr,{className:"w-4 h-4"})})]})})]},t.id))})]}),u>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(Nl,{value:`${o}`,onValueChange:e=>{c(parseInt(e)),l(1)},children:[e.jsx(Sl,{className:"h-8 w-[70px]",children:e.jsx(kl,{placeholder:o})}),e.jsx(Dl,{side:"top",children:[5,10,20,30,50].map(t=>e.jsx(Al,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",i," من ",u]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>x(1),disabled:1===i,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(cs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>x(i-1),disabled:1===i,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(is,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>x(i+1),disabled:i===u,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(rs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>x(u),disabled:i===u,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(os,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-muted-foreground arabic-enhanced",children:["عرض ",p+1," إلى ",Math.min(p+o,m)," من ",m," نتيجة"]})]}),e.jsx("div",{className:"border-t bg-muted/30 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["إجمالي الأدوية: ",d.length]}),s&&e.jsxs("span",{children:["نتائج البحث: ",d.length," من ",t.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4"}),e.jsx("span",{children:"قاعدة بيانات الأدوية"})]})]})})]})}function t$({open:t,onOpenChange:n,editingMedication:a}){const{createMedication:s,updateMedication:r,isLoading:i}=xf(),[l,o]=re.useState({name:"",instructions:""}),[c,d]=re.useState({});re.useEffect(()=>{t&&(o(a?{name:a.name||"",instructions:a.instructions||""}:{name:"",instructions:""}),d({}))},[t,a]);const m=(e,t)=>{o(n=>({...n,[e]:t})),c[e]&&d(t=>({...t,[e]:""}))},u=()=>{i||n(!1)};return e.jsx(Sr,{open:t,onOpenChange:u,children:e.jsxs(Dr,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center gap-2 text-right",children:[e.jsx(Ws,{className:"w-5 h-5 text-blue-600"}),a?"تعديل الدواء":"إضافة دواء جديد"]}),e.jsx(Fr,{className:"text-right",children:a?"قم بتعديل معلومات الدواء أدناه":"أدخل معلومات الدواء الجديد أدناه"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return l.name.trim()?l.name.trim().length<2&&(e.name="اسم الدواء يجب أن يكون على الأقل حرفين"):e.name="اسم الدواء مطلوب",d(e),0===Object.keys(e).length})())try{const e={name:l.name.trim(),instructions:l.instructions.trim()||void 0};a&&a.id?(await r(a.id,e),Kc.success("تم تحديث الدواء بنجاح")):(await s(e),Kc.success("تم إضافة الدواء بنجاح")),n(!1)}catch(t){console.error("Error saving medication:",t),Kc.error(a?"فشل في تحديث الدواء":"فشل في إضافة الدواء")}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"name",className:"text-right block",children:["اسم الدواء ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Ir,{id:"name",value:l.name,onChange:e=>m("name",e.target.value),placeholder:"أدخل اسم الدواء",className:"text-right "+(c.name?"border-red-500":""),dir:"rtl",disabled:i}),c.name&&e.jsx("p",{className:"text-sm text-red-500 text-right",children:c.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"instructions",className:"text-right block",children:"تعليمات الاستخدام"}),e.jsx(wl,{id:"instructions",value:l.instructions,onChange:e=>m("instructions",e.target.value),placeholder:"أدخل تعليمات استخدام الدواء (اختياري)",className:"text-right min-h-[100px]",dir:"rtl",disabled:i}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"مثال: قرص واحد كل 8 ساعات بعد الأكل"})]})]}),e.jsxs(Tr,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsxs(Lr,{type:"button",variant:"outline",onClick:u,disabled:i,children:[e.jsx(_r,{className:"w-4 h-4 ml-2"}),"إلغاء"]}),e.jsx(Lr,{type:"submit",disabled:i,className:"bg-blue-600 hover:bg-blue-700 text-white",children:i?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحفظ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(er,{className:"w-4 h-4 ml-2"}),a?"تحديث":"إضافة"]})})]})]})]})})}function n$({open:t,onOpenChange:n,medication:a}){const{deleteMedication:s,isLoading:r}=xf();return a?e.jsx(go,{open:t,onOpenChange:()=>{r||n(!1)},children:e.jsxs(yo,{dir:"rtl",className:"sm:max-w-[425px]",children:[e.jsxs(bo,{children:[e.jsxs(wo,{className:"flex items-center gap-2 text-right",children:[e.jsx(qa,{className:"w-5 h-5 text-red-600"}),"تأكيد حذف الدواء"]}),e.jsxs(No,{className:"text-right space-y-2",children:[e.jsx("div",{children:"هل أنت متأكد من أنك تريد حذف الدواء التالي؟"}),e.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(dr,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-medium",children:a.name})]}),a.instructions&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["التعليمات: ",a.instructions]})]}),e.jsx("div",{className:"text-red-600 font-medium",children:"⚠️ تحذير: هذا الإجراء لا يمكن التراجع عنه"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"سيتم حذف الدواء نهائياً من النظام. إذا كان هذا الدواء مرتبط بوصفات طبية موجودة، فقد يؤثر ذلك على سجلات المرضى."})]})]}),e.jsxs(jo,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsx(ko,{disabled:r,children:"إلغاء"}),e.jsx(_o,{onClick:async()=>{if(a)try{await s(a.id),Kc.success("تم حذف الدواء بنجاح"),n(!1)}catch(e){console.error("Error deleting medication:",e),Kc.error("فشل في حذف الدواء")}},disabled:r,className:"bg-red-600 hover:bg-red-700 text-white",children:r?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحذف..."]}):e.jsxs(e.Fragment,{children:[e.jsx(dr,{className:"w-4 h-4 ml-2"}),"حذف نهائي"]})})]})]})}):null}var[a$,s$]=k("Tooltip",[z]),r$=z(),i$="TooltipProvider",l$=700,o$="tooltip.open",[c$,d$]=a$(i$),m$=t=>{const{__scopeTooltip:n,delayDuration:a=l$,skipDelayDuration:s=300,disableHoverableContent:r=!1,children:i}=t,l=re.useRef(!0),o=re.useRef(!1),c=re.useRef(0);return re.useEffect(()=>{const e=c.current;return()=>window.clearTimeout(e)},[]),e.jsx(c$,{scope:n,isOpenDelayedRef:l,delayDuration:a,onOpen:re.useCallback(()=>{window.clearTimeout(c.current),l.current=!1},[]),onClose:re.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>l.current=!0,s)},[s]),isPointerInTransitRef:o,onPointerInTransitChange:re.useCallback(e=>{o.current=e},[]),disableHoverableContent:r,children:i})};m$.displayName=i$;var u$="Tooltip",[p$,h$]=a$(u$),x$=t=>{const{__scopeTooltip:n,children:a,open:s,defaultOpen:r,onOpenChange:i,disableHoverableContent:l,delayDuration:o}=t,c=d$(u$,t.__scopeTooltip),d=r$(n),[m,u]=re.useState(null),p=R(),h=re.useRef(0),x=l??c.disableHoverableContent,g=o??c.delayDuration,f=re.useRef(!1),[v,y]=P({prop:s,defaultProp:r??!1,onChange:e=>{e?(c.onOpen(),document.dispatchEvent(new CustomEvent(o$))):c.onClose(),i?.(e)},caller:u$}),b=re.useMemo(()=>v?f.current?"delayed-open":"instant-open":"closed",[v]),j=re.useCallback(()=>{window.clearTimeout(h.current),h.current=0,f.current=!1,y(!0)},[y]),w=re.useCallback(()=>{window.clearTimeout(h.current),h.current=0,y(!1)},[y]),N=re.useCallback(()=>{window.clearTimeout(h.current),h.current=window.setTimeout(()=>{f.current=!0,y(!0),h.current=0},g)},[g,y]);return re.useEffect(()=>()=>{h.current&&(window.clearTimeout(h.current),h.current=0)},[]),e.jsx(J,{...d,children:e.jsx(p$,{scope:n,contentId:p,open:v,stateAttribute:b,trigger:m,onTriggerChange:u,onTriggerEnter:re.useCallback(()=>{c.isOpenDelayedRef.current?N():j()},[c.isOpenDelayedRef,N,j]),onTriggerLeave:re.useCallback(()=>{x?w():(window.clearTimeout(h.current),h.current=0)},[w,x]),onOpen:j,onClose:w,disableHoverableContent:x,children:a})})};x$.displayName=u$;var g$="TooltipTrigger",f$=re.forwardRef((t,n)=>{const{__scopeTooltip:a,...s}=t,r=h$(g$,a),i=d$(g$,a),l=r$(a),o=re.useRef(null),d=$(n,o,r.onTriggerChange),m=re.useRef(!1),u=re.useRef(!1),p=re.useCallback(()=>m.current=!1,[]);return re.useEffect(()=>()=>document.removeEventListener("pointerup",p),[p]),e.jsx(B,{asChild:!0,...l,children:e.jsx(c.button,{"aria-describedby":r.open?r.contentId:void 0,"data-state":r.stateAttribute,...s,ref:d,onPointerMove:E(t.onPointerMove,e=>{"touch"!==e.pointerType&&(u.current||i.isPointerInTransitRef.current||(r.onTriggerEnter(),u.current=!0))}),onPointerLeave:E(t.onPointerLeave,()=>{r.onTriggerLeave(),u.current=!1}),onPointerDown:E(t.onPointerDown,()=>{r.open&&r.onClose(),m.current=!0,document.addEventListener("pointerup",p,{once:!0})}),onFocus:E(t.onFocus,()=>{m.current||r.onOpen()}),onBlur:E(t.onBlur,r.onClose),onClick:E(t.onClick,r.onClose)})})});f$.displayName=g$;var v$="TooltipPortal",[y$,b$]=a$(v$,{forceMount:void 0}),j$=t=>{const{__scopeTooltip:n,forceMount:a,children:s,container:r}=t,i=h$(v$,n);return e.jsx(y$,{scope:n,forceMount:a,children:e.jsx(O,{present:a||i.open,children:e.jsx(Q,{asChild:!0,container:r,children:s})})})};j$.displayName=v$;var w$="TooltipContent",N$=re.forwardRef((t,n)=>{const a=b$(w$,t.__scopeTooltip),{forceMount:s=a.forceMount,side:r="top",...i}=t,l=h$(w$,t.__scopeTooltip);return e.jsx(O,{present:s||l.open,children:l.disableHoverableContent?e.jsx($$,{side:r,...i,ref:n}):e.jsx(_$,{side:r,...i,ref:n})})}),_$=re.forwardRef((t,n)=>{const a=h$(w$,t.__scopeTooltip),s=d$(w$,t.__scopeTooltip),r=re.useRef(null),i=$(n,r),[l,o]=re.useState(null),{trigger:c,onClose:d}=a,m=r.current,{onPointerInTransitChange:u}=s,p=re.useCallback(()=>{o(null),u(!1)},[u]),h=re.useCallback((e,t)=>{const n=e.currentTarget,a={x:e.clientX,y:e.clientY},s=function(e,t){const n=Math.abs(t.top-e.y),a=Math.abs(t.bottom-e.y),s=Math.abs(t.right-e.x),r=Math.abs(t.left-e.x);switch(Math.min(n,a,s,r)){case r:return"left";case s:return"right";case n:return"top";case a:return"bottom";default:throw new Error("unreachable")}}(a,n.getBoundingClientRect()),r=function(e,t,n=5){const a=[];switch(t){case"top":a.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":a.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":a.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":a.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n})}return a}(a,s),i=function(e){const{top:t,right:n,bottom:a,left:s}=e;return[{x:s,y:t},{x:n,y:t},{x:n,y:a},{x:s,y:a}]}(t.getBoundingClientRect()),l=function(e){const t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),function(e){if(e.length<=1)return e.slice();const t=[];for(let a=0;a<e.length;a++){const n=e[a];for(;t.length>=2;){const e=t[t.length-1],a=t[t.length-2];if(!((e.x-a.x)*(n.y-a.y)>=(e.y-a.y)*(n.x-a.x)))break;t.pop()}t.push(n)}t.pop();const n=[];for(let a=e.length-1;a>=0;a--){const t=e[a];for(;n.length>=2;){const e=n[n.length-1],a=n[n.length-2];if(!((e.x-a.x)*(t.y-a.y)>=(e.y-a.y)*(t.x-a.x)))break;n.pop()}n.push(t)}return n.pop(),1===t.length&&1===n.length&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}(t)}([...r,...i]);o(l),u(!0)},[u]);return re.useEffect(()=>()=>p(),[p]),re.useEffect(()=>{if(c&&m){const e=e=>h(e,m),t=e=>h(e,c);return c.addEventListener("pointerleave",e),m.addEventListener("pointerleave",t),()=>{c.removeEventListener("pointerleave",e),m.removeEventListener("pointerleave",t)}}},[c,m,h,p]),re.useEffect(()=>{if(l){const e=e=>{const t=e.target,n={x:e.clientX,y:e.clientY},a=c?.contains(t)||m?.contains(t),s=!function(e,t){const{x:n,y:a}=e;let s=!1;for(let r=0,i=t.length-1;r<t.length;i=r++){const e=t[r],l=t[i],o=e.x,c=e.y,d=l.x,m=l.y;c>a!=m>a&&n<(d-o)*(a-c)/(m-c)+o&&(s=!s)}return s}(n,l);a?p():s&&(p(),d())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[c,m,l,d,p]),e.jsx($$,{...t,ref:i})}),[k$,S$]=a$(u$,{isInside:!1}),C$=T("TooltipContent"),$$=re.forwardRef((t,n)=>{const{__scopeTooltip:a,children:s,"aria-label":r,onEscapeKeyDown:i,onPointerDownOutside:l,...o}=t,c=h$(w$,a),d=r$(a),{onClose:m}=c;return re.useEffect(()=>(document.addEventListener(o$,m),()=>document.removeEventListener(o$,m)),[m]),re.useEffect(()=>{if(c.trigger){const e=e=>{const t=e.target;t?.contains(c.trigger)&&m()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[c.trigger,m]),e.jsx(U,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:l,onFocusOutside:e=>e.preventDefault(),onDismiss:m,children:e.jsxs(H,{"data-state":c.stateAttribute,...d,...o,ref:n,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(C$,{children:s}),e.jsx(k$,{scope:a,isInside:!0,children:e.jsx(ee,{id:c.contentId,role:"tooltip",children:r||s})})]})})});N$.displayName=w$;var D$="TooltipArrow";re.forwardRef((t,n)=>{const{__scopeTooltip:a,...s}=t,r=r$(a);return S$(D$,a).isInside?null:e.jsx(G,{...r,...s,ref:n})}).displayName=D$;var E$=j$,T$=N$;const A$=m$,F$=x$,P$=f$,R$=re.forwardRef(({className:t,sideOffset:n=4,...a},s)=>e.jsx(E$,{children:e.jsx(T$,{ref:s,sideOffset:n,className:En("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...a})}));function O$({open:t,onOpenChange:n,prescription:a}){const{settings:s,loadSettings:r}=ta(),i=Rc(),l=Oc(),o=Mc();Lc();const c=re.useRef(null);re.useEffect(()=>{t&&!s&&r()},[t,s,r]);const[d,m]=re.useState({printerType:"80mm",includeQR:!0,includeBarcode:!0,includeLogo:!0,colorMode:"color",qrType:"text"}),[u,p]=re.useState(!0),[h,x]=re.useState(""),[g,f]=re.useState(""),v=async()=>{try{const e=(()=>{const e=`PRX-${a.id.slice(-6)}`,t=a.patient?.full_name||"غير محدد",n=In(a.prescription_date),s=a.medications?.length||0;return`🏥 ${i}\n${l?`👨‍⚕️ د. ${l}`:""}\n📋 وصفة طبية رقم: ${e}\n👤 المريض: ${t}\n📅 التاريخ: ${n}\n💊 عدد الأدوية: ${s}\n${a.medications?.map((e,t)=>`${t+1}. ${e.medication_name} - ${e.dose}`).join("\n")||""}\n${a.notes?`📝 ملاحظات: ${a.notes}`:""}\n\nشكراً لثقتكم بنا 🙏`})(),t=await at.toDataURL(e,{width:150,margin:1,color:{dark:"#000000",light:"#FFFFFF"}});x(t)}catch(e){console.error("Error generating QR code:",e)}};re.useEffect(()=>{t&&(d.includeQR&&v(),d.includeBarcode&&(()=>{try{const e=document.createElement("canvas"),t=y();st(e,t,{format:"CODE128",width:2,height:40,displayValue:!1,margin:0}),f(e.toDataURL())}catch(e){console.error("Error generating barcode:",e)}})())},[t,d.includeQR,d.includeBarcode,a,s]);const y=()=>`PRX${new Date(a.prescription_date).getTime().toString().slice(-8)}${a.patient_id.slice(-4)}${(a.medications?.length||0).toString().padStart(2,"0")}`,b=()=>{if(c.current){const e=window.open("","_blank");if(e){const t="color"===d.colorMode,n="a4"===d.printerType?"210mm":d.printerType;e.document.write(`\n          <html>\n            <head>\n              <title>وصفة طبية - ${a.id.slice(-6)}</title>\n              <style>\n                body {\n                  font-family: 'Arial', 'Tahoma', sans-serif;\n                  direction: rtl;\n                  margin: 0;\n                  padding: 0;\n                  font-size: ${"a4"===d.printerType?"14px":"12px"};\n                  line-height: 1.4;\n                  color: #000;\n                  background: white;\n                }\n\n                .receipt {\n                  width: ${"a4"===n?"100%":n};\n                  max-width: ${"a4"===n?"210mm":n};\n                  margin: 0 auto;\n                  background: white;\n                  font-size: ${"a4"===d.printerType?"12px":"11px"};\n                  padding: ${"a4"===d.printerType?"20px":"0"};\n                }\n\n                .header {\n                  text-align: center;\n                  margin-bottom: 15px;\n                  border-bottom: 2px solid #000;\n                  padding-bottom: 10px;\n                }\n\n                .clinic-logo {\n                  width: ${"a4"===d.printerType?"60px":"45px"};\n                  height: ${"a4"===d.printerType?"60px":"45px"};\n                  margin: 0 auto 6px;\n                  border-radius: 50%;\n                  overflow: hidden;\n                  border: 2px solid #e0e0e0;\n                  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n                  flex-shrink: 0;\n                }\n\n                .clinic-logo img {\n                  width: 100%;\n                  height: 100%;\n                  object-fit: cover;\n                  border-radius: 50%;\n                  max-width: ${"a4"===d.printerType?"60px":"45px"};\n                  max-height: ${"a4"===d.printerType?"60px":"45px"};\n                }\n\n                .clinic-name {\n                  font-size: ${"a4"===d.printerType?"18px":"16px"};\n                  font-weight: bold;\n                  margin-bottom: 5px;\n                  color: ${t?"#2563eb":"#000"};\n                }\n\n                .doctor-name {\n                  font-size: ${"a4"===d.printerType?"14px":"12px"};\n                  font-weight: bold;\n                  margin-bottom: 3px;\n                  color: ${t?"#059669":"#000"};\n                }\n\n                .prescription-title {\n                  font-size: ${"a4"===d.printerType?"16px":"14px"};\n                  font-weight: bold;\n                  margin: 10px 0;\n                  text-decoration: underline;\n                  color: ${t?"#dc2626":"#000"};\n                }\n\n                .section {\n                  margin: 10px 0;\n                  padding: 5px 0;\n                }\n\n                .patient-info {\n                  border: 2px solid #000;\n                  padding: 10px;\n                  margin: 10px 0;\n                  background: ${t?"#f8fafc":"white"};\n                }\n\n                .medications-list {\n                  border: 2px solid #000;\n                  padding: 10px;\n                  margin: 10px 0;\n                  background: ${t?"#fefce8":"white"};\n                }\n\n                .medication-item {\n                  margin: 8px 0;\n                  padding: 5px 0;\n                  border-bottom: 1px dotted #666;\n                }\n\n                .medication-item:last-child {\n                  border-bottom: none;\n                }\n\n                .medication-name {\n                  font-weight: bold;\n                  font-size: ${"a4"===d.printerType?"13px":"11px"};\n                  color: ${t?"#1e40af":"#000"};\n                }\n\n                .medication-dose {\n                  font-size: ${"a4"===d.printerType?"11px":"10px"};\n                  color: #333;\n                  margin-top: 2px;\n                }\n\n                .separator {\n                  text-align: center;\n                  margin: 10px 0;\n                  font-size: 12px;\n                }\n\n                .footer {\n                  text-align: center;\n                  margin-top: 15px;\n                  padding-top: 10px;\n                  border-top: 1px solid #000;\n                  font-size: ${"a4"===d.printerType?"10px":"9px"};\n                }\n\n                .bottom-section {\n                  display: flex;\n                  justify-content: space-between;\n                  align-items: flex-start;\n                  margin: 15px 0;\n                  gap: 20px;\n                  flex-wrap: wrap;\n                }\n\n                .qr-section, .barcode-section {\n                  text-align: center;\n                  margin: 10px 0;\n                  flex: 1;\n                  min-width: 100px;\n                }\n\n                .signature-section {\n                  flex: 1;\n                  min-width: 120px;\n                  text-align: center;\n                }\n\n                .signature-line {\n                  width: ${"a4"===d.printerType?"120px":"100px"};\n                  height: 1px;\n                  border-bottom: 1px solid #333;\n                  margin: 0 auto 4px;\n                }\n\n                .signature-label {\n                  font-size: ${"a4"===d.printerType?"11px":"9px"};\n                  color: #666;\n                  margin-bottom: 6px;\n                }\n\n                .stamp-area {\n                  width: ${"a4"===d.printerType?"90px":"70px"};\n                  height: ${"a4"===d.printerType?"70px":"55px"};\n                  border: 2px dashed #999;\n                  border-radius: 50%;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  margin: 0 auto;\n                  background: rgba(0,0,0,0.02);\n                }\n\n                .stamp-placeholder {\n                  font-size: ${"a4"===d.printerType?"10px":"8px"};\n                  color: #999;\n                  text-align: center;\n                  line-height: 1.2;\n                }\n\n                .notes {\n                  border: 2px solid #000;\n                  padding: 10px;\n                  margin: 10px 0;\n                  font-style: italic;\n                  background: ${t?"#fef3c7":"white"};\n                }\n\n                @media print {\n                  body { margin: 0; }\n                  .receipt { box-shadow: none; }\n                }\n\n                @media screen {\n                  body {\n                    padding: 20px;\n                    background: #f5f5f5;\n                  }\n\n                  .receipt {\n                    max-width: ${"a4"===d.printerType?"600px":"320px"};\n                    box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n                    border-radius: 12px;\n                    overflow: hidden;\n                    background: white;\n                    margin: 0 auto;\n                  }\n                }\n              </style>\n            </head>\n            <body>\n              ${c.current.innerHTML}\n            </body>\n          </html>\n        `),e.document.close(),e.print()}}};return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center gap-2 text-right",children:[e.jsx(bs,{className:"w-5 h-5 text-green-600"}),"طباعة الوصفة الطبية"]}),e.jsxs(Fr,{className:"text-right",children:["معاينة وطباعة الوصفة الطبية للمريض ",a.patient?.full_name]})]}),e.jsxs("div",{className:"border-t bg-muted/30 p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center",children:[e.jsx(nr,{className:"w-4 h-4 ml-2"}),"إعدادات الطباعة"]}),e.jsxs(Lr,{variant:"ghost",size:"sm",onClick:()=>p(!u),className:"text-xs",children:[e.jsx(ys,{className:"w-3 h-3 ml-1"}),u?"إخفاء المعاينة":"معاينة"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"نوع الطابعة"}),e.jsxs(Nl,{value:d.printerType,onValueChange:e=>m(t=>({...t,printerType:e})),children:[e.jsx(Sl,{className:"h-8 text-xs",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"58mm",children:"حرارية 58mm"}),e.jsx(Al,{value:"80mm",children:"حرارية 80mm"}),e.jsx(Al,{value:"a4",children:"عادية A4"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"نمط الألوان"}),e.jsxs(Nl,{value:d.colorMode,onValueChange:e=>m(t=>({...t,colorMode:e})),children:[e.jsx(Sl,{className:"h-8 text-xs",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"color",children:"ملون"}),e.jsx(Al,{value:"bw",children:"أبيض وأسود"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("input",{type:"checkbox",id:"includeLogo",checked:d.includeLogo,onChange:e=>m(t=>({...t,includeLogo:e.target.checked})),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"includeLogo",className:"text-xs font-medium",children:"تضمين الشعار"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("input",{type:"checkbox",id:"includeQR",checked:d.includeQR,onChange:e=>m(t=>({...t,includeQR:e.target.checked})),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"includeQR",className:"text-xs font-medium",children:"QR Code"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("input",{type:"checkbox",id:"includeBarcode",checked:d.includeBarcode,onChange:e=>m(t=>({...t,includeBarcode:e.target.checked})),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"includeBarcode",className:"text-xs font-medium",children:"تضمين الباركود"})]})]}),u&&e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50 max-h-96 overflow-y-auto",children:e.jsxs("div",{ref:c,className:"receipt bg-white p-4 mx-auto",style:{maxWidth:"a4"===d.printerType?"600px":"320px",fontFamily:"Arial, Tahoma, sans-serif",direction:"rtl"},children:[e.jsxs("div",{className:"header text-center mb-4 pb-3 border-b-2 border-black",children:[d.includeLogo&&o&&""!==o.trim()&&e.jsx("div",{className:"clinic-logo mb-3",style:{width:"a4"===d.printerType?"60px":"45px",height:"a4"===d.printerType?"60px":"45px",margin:"0 auto 8px",borderRadius:"50%",overflow:"hidden",border:"2px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",flexShrink:0},children:e.jsx("img",{src:o,alt:"شعار العيادة",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%",maxWidth:"a4"===d.printerType?"60px":"45px",maxHeight:"a4"===d.printerType?"60px":"45px"},onError:e=>{console.log("Prescription logo failed to load:",o),e.currentTarget.style.display="none"}})}),i&&e.jsx("div",{className:"clinic-name text-lg font-bold mb-2 text-blue-600",children:i}),l&&e.jsxs("div",{className:"doctor-name text-sm font-bold mb-1 text-green-600",children:["د. ",l]}),e.jsx("div",{className:"prescription-title text-base font-bold mt-3 text-red-600 underline",children:"وصفة طبية"})]}),e.jsxs("div",{className:"section mb-3",children:[e.jsxs("div",{className:"text-sm text-center",children:[e.jsx("strong",{children:"رقم الوصفة:"})," PRX-",a.id.slice(-6)]}),e.jsxs("div",{className:"text-sm text-center",children:[e.jsx("strong",{children:"التاريخ:"})," ",In(a.prescription_date)]})]}),e.jsxs("div",{className:"patient-info border-2 border-black p-3 mb-3 bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(yr,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-bold",children:"معلومات المريض"})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"الاسم:"})," ",a.patient?.full_name||"غير محدد"]}),a.appointment&&e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"الموعد:"})," ",a.appointment.title]})]}),e.jsxs("div",{className:"medications-list border-2 border-black p-3 mb-3 bg-yellow-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ws,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"font-bold",children:["الأدوية الموصوفة (",a.medications?.length||0,")"]})]}),a.medications&&a.medications.length>0?a.medications.map((t,n)=>e.jsxs("div",{className:"medication-item mb-2 pb-2 border-b border-dotted border-gray-400 last:border-b-0",children:[e.jsxs("div",{className:"medication-name font-bold text-blue-800",children:[n+1,". ",t.medication_name]}),t.dose&&e.jsxs("div",{className:"medication-dose text-sm text-gray-600 mt-1",children:["الجرعة: ",t.dose]})]},n)):e.jsx("div",{className:"text-sm text-gray-500 italic",children:"لا توجد أدوية موصوفة"})]}),a.notes&&e.jsxs("div",{className:"notes border-2 border-black p-3 mb-3 bg-yellow-100",children:[e.jsx("div",{className:"font-bold mb-2",children:"ملاحظات الطبيب:"}),e.jsx("div",{className:"text-sm italic",children:a.notes})]}),e.jsxs("div",{className:"bottom-section flex justify-between items-start mb-4 gap-4 flex-wrap",children:[d.includeQR&&e.jsxs("div",{className:"qr-section text-center flex-1 min-w-[100px]",children:[h?e.jsx("img",{src:h,alt:"رمز QR للوصفة الطبية",style:{width:"a4"===d.printerType?"100px":"80px",height:"a4"===d.printerType?"100px":"80px",margin:"0 auto"}}):e.jsx("div",{className:"qr-placeholder bg-gray-200 p-4 text-sm",children:"رمز QR"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"امسح الرمز لعرض تفاصيل الوصفة"})]}),e.jsxs("div",{className:"signature-section text-center flex-1 min-w-[120px]",children:[e.jsxs("div",{className:"signature-box mb-3",children:[e.jsx("div",{className:"signature-line mx-auto mb-2",style:{width:"a4"===d.printerType?"120px":"100px",height:"1px",borderBottom:"1px solid #333"}}),e.jsx("div",{className:"signature-label text-gray-600 mb-3",style:{fontSize:"a4"===d.printerType?"11px":"9px"},children:"توقيع الطبيب"})]}),e.jsx("div",{className:"stamp-box",children:e.jsx("div",{className:"stamp-area border-2 border-dashed border-gray-400 rounded-full flex items-center justify-center mx-auto bg-gray-50",style:{width:"a4"===d.printerType?"90px":"70px",height:"a4"===d.printerType?"70px":"55px"},children:e.jsx("div",{className:"stamp-placeholder text-gray-500 text-center leading-tight",style:{fontSize:"a4"===d.printerType?"10px":"8px"},children:"ختم العيادة"})})})]})]}),d.includeBarcode&&e.jsxs("div",{className:"barcode-section text-center mb-3",children:[g?e.jsx("img",{src:g,alt:"باركود الوصفة الطبية",style:{width:"a4"===d.printerType?"120px":"100px",height:"a4"===d.printerType?"30px":"20px",margin:"0 auto"}}):e.jsx("div",{className:"barcode-placeholder bg-gray-200 p-2 text-xs",children:y()}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:y()})]}),e.jsxs("div",{className:"footer text-center mt-4 pt-3 border-t border-black text-xs",children:[e.jsx("div",{className:"mb-1",children:"شكراً لثقتكم بنا"}),e.jsxs("div",{children:["تاريخ الطباعة: ",In((new Date).toISOString())]}),i&&e.jsx("div",{className:"mt-1 font-bold",children:i})]})]})}),e.jsxs(Tr,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsx(Lr,{variant:"outline",onClick:()=>n(!1),children:"إغلاق"}),e.jsxs(Lr,{variant:"outline",onClick:()=>{b()},children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تحميل PDF"]}),e.jsxs(Lr,{variant:"outline",onClick:()=>{if(c.current){const e=window.open("","_blank");e&&(e.document.write(`\n          <html>\n            <head>\n              <title>وصفة طبية - ${a.id.slice(-6)}</title>\n              <style>\n                @page {\n                  size: 80mm auto;\n                  margin: 0;\n                }\n                body {\n                  font-family: 'Arial', 'Tahoma', sans-serif;\n                  direction: rtl;\n                  margin: 0;\n                  padding: 2mm;\n                  font-size: 11px;\n                  line-height: 1.3;\n                  color: #000;\n                  background: white;\n                  width: 76mm;\n                }\n                .receipt {\n                  width: 100%;\n                  font-size: 11px;\n                }\n                .header {\n                  text-align: center;\n                  margin-bottom: 6px;\n                  border-bottom: 2px solid #000;\n                  padding-bottom: 4px;\n                }\n                .clinic-logo {\n                  width: 40px;\n                  height: 40px;\n                  margin: 0 auto 3px;\n                  border-radius: 50%;\n                  overflow: hidden;\n                  border: 1px solid #000;\n                  flex-shrink: 0;\n                }\n                .clinic-logo img {\n                  width: 100%;\n                  height: 100%;\n                  object-fit: cover;\n                  border-radius: 50%;\n                  max-width: 40px;\n                  max-height: 40px;\n                }\n                .clinic-name {\n                  font-size: 14px;\n                  font-weight: bold;\n                  margin-bottom: 2px;\n                }\n                .doctor-name {\n                  font-size: 11px;\n                  font-weight: bold;\n                  margin-bottom: 1px;\n                }\n                .prescription-title {\n                  font-size: 12px;\n                  font-weight: bold;\n                  margin: 4px 0;\n                  text-decoration: underline;\n                }\n                .section {\n                  margin: 4px 0;\n                  padding: 2px 0;\n                }\n                .patient-info {\n                  border: 1px solid #000;\n                  padding: 3px;\n                  margin: 4px 0;\n                }\n                .medications-list {\n                  border: 1px solid #000;\n                  padding: 3px;\n                  margin: 4px 0;\n                }\n                .medication-item {\n                  margin: 2px 0;\n                  padding: 2px 0;\n                  border-bottom: 1px dotted #666;\n                }\n                .medication-item:last-child {\n                  border-bottom: none;\n                }\n                .medication-name {\n                  font-weight: bold;\n                  font-size: 11px;\n                }\n                .medication-dose {\n                  font-size: 10px;\n                  color: #333;\n                  margin-top: 1px;\n                }\n                .separator {\n                  text-align: center;\n                  margin: 4px 0;\n                  font-size: 10px;\n                }\n                .footer {\n                  text-align: center;\n                  margin-top: 6px;\n                  padding-top: 4px;\n                  border-top: 1px solid #000;\n                  font-size: 9px;\n                }\n                .bottom-section {\n                  display: flex;\n                  justify-content: space-between;\n                  align-items: flex-start;\n                  margin: 6px 0;\n                  gap: 8px;\n                  flex-wrap: wrap;\n                }\n                .qr-section, .barcode-section {\n                  text-align: center;\n                  margin: 4px 0;\n                  flex: 1;\n                  min-width: 60px;\n                }\n                .signature-section {\n                  flex: 1;\n                  min-width: 80px;\n                  text-align: center;\n                }\n                .signature-line {\n                  width: 60px;\n                  height: 1px;\n                  border-bottom: 1px solid #000;\n                  margin: 0 auto 2px;\n                }\n                .signature-label {\n                  font-size: 7px;\n                  margin-bottom: 3px;\n                }\n                .stamp-area {\n                  width: 45px;\n                  height: 35px;\n                  border: 1px dashed #000;\n                  border-radius: 50%;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  margin: 0 auto;\n                  background: rgba(0,0,0,0.02);\n                }\n                .stamp-placeholder {\n                  font-size: 6px;\n                  text-align: center;\n                  line-height: 1.1;\n                }\n                .notes {\n                  border: 1px solid #000;\n                  padding: 3px;\n                  margin: 4px 0;\n                  font-style: italic;\n                }\n              </style>\n            </head>\n            <body>\n              ${c.current.innerHTML}\n            </body>\n          </html>\n        `),e.document.close(),e.print())}},className:"bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-200",children:[e.jsx(Qs,{className:"w-4 h-4 ml-2"}),"طباعة حرارية"]}),e.jsxs(Lr,{onClick:b,className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(Qs,{className:"w-4 h-4 ml-2"}),"طباعة ذكية"]})]})]})})}function M$({open:t,onOpenChange:n,prescription:a,onEdit:s,onPrint:r}){if(!a)return null;return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center gap-2 text-right",children:[e.jsx(bs,{className:"w-5 h-5 text-green-600"}),"تفاصيل الوصفة الطبية"]}),e.jsxs(Fr,{className:"text-right",children:["عرض تفاصيل الوصفة الطبية للمريض ",a.patient?.full_name]})]}),e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs(nc,{children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"flex items-center gap-2 text-right text-lg",children:[e.jsx(bs,{className:"w-5 h-5 text-green-600"}),"معلومات الوصفة"]})}),e.jsx(ic,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"رقم الوصفة:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(oc,{variant:"outline",className:"font-mono",children:["PRX-",a.id.slice(-6)]}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>{const e=`PRX-${a.id.slice(-6)}`;navigator.clipboard.writeText(e)},className:"h-6 w-6 p-0",title:"نسخ رقم الوصفة",children:e.jsx(ps,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"تاريخ الوصفة:"}),e.jsx("span",{className:"text-sm font-medium",children:In(a.prescription_date)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"تاريخ الإنشاء:"}),e.jsx("span",{className:"text-sm",children:In(a.created_at)})]}),a.updated_at!==a.created_at&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"آخر تحديث:"}),e.jsx("span",{className:"text-sm",children:In(a.updated_at)})]})]})]})})]}),e.jsxs(nc,{children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"flex items-center gap-2 text-right text-lg",children:[e.jsx(yr,{className:"w-5 h-5 text-blue-600"}),"معلومات المريض"]})}),e.jsx(ic,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(yr,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"اسم المريض:"}),e.jsx("span",{className:"font-medium text-lg",children:a.patient?.full_name||"غير محدد"})]}),a.appointment&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(es,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"الموعد المرتبط:"}),e.jsx(oc,{variant:"secondary",className:"font-medium",children:a.appointment.title})]})]})})]}),e.jsxs(nc,{children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"flex items-center gap-2 text-right text-lg",children:[e.jsx(Ws,{className:"w-5 h-5 text-orange-600"}),"الأدوية الموصوفة (",a.medications?.length||0,")"]})}),e.jsx(ic,{children:a.medications&&a.medications.length>0?e.jsx("div",{className:"space-y-3",children:a.medications.map((t,n)=>e.jsx("div",{className:"border rounded-lg p-4 bg-gradient-to-r from-orange-50 to-yellow-50 dark:from-orange-950/20 dark:to-yellow-950/20",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oc,{variant:"outline",className:"w-8 h-8 rounded-full flex items-center justify-center p-0 font-bold",children:n+1}),e.jsx("h4",{className:"font-bold text-lg text-orange-800 dark:text-orange-200",children:t.medication_name})]}),t.dose&&e.jsxs("div",{className:"flex items-center gap-2 mr-10",children:[e.jsx(Ws,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"الجرعة:"}),e.jsx("span",{className:"font-medium text-orange-700 dark:text-orange-300",children:t.dose})]}),t.medication_instructions&&e.jsx("div",{className:"mr-10 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-md border-r-4 border-blue-400",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ir,{className:"w-4 h-4 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"تعليمات الاستخدام:"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:t.medication_instructions})]})]})})]})})},n))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ws,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"لا توجد أدوية موصوفة في هذه الوصفة"})]})})]}),a.notes&&e.jsxs(nc,{children:[e.jsx(ac,{className:"pb-3",children:e.jsxs(sc,{className:"flex items-center gap-2 text-right text-lg",children:[e.jsx(bs,{className:"w-5 h-5 text-purple-600"}),"ملاحظات الطبيب"]})}),e.jsx(ic,{children:e.jsx("div",{className:"p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg border-r-4 border-purple-400",children:e.jsx("p",{className:"text-purple-800 dark:text-purple-200 leading-relaxed",children:a.notes})})})]})]}),e.jsxs(Tr,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",onClick:()=>n(!1),children:[e.jsx(_r,{className:"w-4 h-4 ml-2"}),"إغلاق"]}),r&&e.jsxs(Lr,{variant:"outline",onClick:()=>{r&&r(a)},children:[e.jsx(Qs,{className:"w-4 h-4 ml-2"}),"طباعة"]}),s&&e.jsxs(Lr,{onClick:()=>{s&&(s(a),n(!1))},className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(Us,{className:"w-4 h-4 ml-2"}),"تعديل الوصفة"]})]})]})})}function L$({prescriptions:t,onEdit:n,onDelete:a}){const{isLoading:s}=pa(),[r,i]=re.useState(1),[l,o]=re.useState(10),[c,d]=re.useState(!1),[m,u]=re.useState(null),[p,h]=re.useState(!1),[x,g]=re.useState(null),f=e=>{u(e),d(!0)},v=t.length,y=Math.ceil(v/l),b=(r-1)*l,j=t.slice(b,b+l),w=e=>{i(e)};return s?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري تحميل الوصفات الطبية..."})]})}):0===t.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(bs,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد وصفات طبية"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم إنشاء أي وصفات طبية بعد"}),e.jsxs(Lr,{onClick:()=>n(null),children:[e.jsx(bs,{className:"w-4 h-4 ml-2"}),"إنشاء وصفة طبية جديدة"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-center w-[60px]",children:"رقم"}),e.jsx(Uc,{className:"text-center",children:"اسم المريض"}),e.jsx(Uc,{className:"text-center",children:"الموعد"}),e.jsx(Uc,{className:"text-center",children:"عدد الأدوية"}),e.jsx(Uc,{className:"text-center",children:"تاريخ الوصفة"}),e.jsx(Uc,{className:"text-center",children:"ملاحظات"}),e.jsx(Uc,{className:"text-center w-[120px]",children:"الإجراءات"})]})}),e.jsx(Yc,{children:j.map((t,s)=>e.jsxs(qc,{className:"hover:bg-muted/50",children:[e.jsx(Hc,{className:"font-medium text-center",children:b+s+1}),e.jsx(Hc,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(yr,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:t.patient?.full_name||"غير محدد"})]})}),e.jsx(Hc,{className:"text-center",children:t.appointment?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:t.appointment.title})]}):e.jsx("span",{className:"text-muted-foreground italic",children:"لا يوجد موعد"})}),e.jsx(Hc,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4 text-purple-600"}),e.jsxs(oc,{variant:"secondary",children:[t.medications?.length||0," دواء"]})]})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"text-sm",children:In(t.prescription_date)})}),e.jsx(Hc,{className:"text-center",children:e.jsx("div",{className:"max-w-xs mx-auto",children:t.notes?e.jsx(A$,{children:e.jsxs(F$,{children:[e.jsx(P$,{asChild:!0,children:e.jsx("div",{className:"text-sm text-muted-foreground cursor-help",children:t.notes})}),e.jsx(R$,{children:e.jsx("p",{className:"max-w-xs",children:t.notes})})]})}):e.jsx("span",{className:"text-muted-foreground italic",children:"لا توجد ملاحظات"})})}),e.jsx(Hc,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>(e=>{g(e),h(!0)})(t),className:"action-btn-view action-btn-icon",title:"عرض التفاصيل",children:e.jsx(ys,{className:"w-4 h-4"})}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>f(t),className:"action-btn-print action-btn-icon",title:"طباعة الوصفة",children:e.jsx(Qs,{className:"w-4 h-4"})}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>(e=>{n(e)})(t),className:"action-btn-warning action-btn-icon",title:"تعديل الوصفة",children:e.jsx(Us,{className:"w-4 h-4"})}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>(e=>{a(e)})(t),className:"action-btn-delete action-btn-icon",title:"حذف الوصفة",children:e.jsx(dr,{className:"w-4 h-4"})})]})})]},t.id))})]}),y>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(Nl,{value:`${l}`,onValueChange:e=>{o(parseInt(e)),i(1)},children:[e.jsx(Sl,{className:"h-8 w-[70px]",children:e.jsx(kl,{placeholder:l})}),e.jsx(Dl,{side:"top",children:[5,10,20,30,50].map(t=>e.jsx(Al,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",r," من ",y]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>w(1),disabled:1===r,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(cs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>w(r-1),disabled:1===r,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(is,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>w(r+1),disabled:r===y,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(rs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>w(y),disabled:r===y,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(os,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-muted-foreground arabic-enhanced",children:["عرض ",b+1," إلى ",Math.min(b+l,v)," من ",v," نتيجة"]})]}),e.jsx("div",{className:"border-t bg-muted/30 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["إجمالي الوصفات: ",t.length]}),e.jsxs("span",{children:["إجمالي الأدوية: ",t.reduce((e,t)=>e+(t.medications?.length||0),0)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"w-4 h-4"}),e.jsx("span",{children:"سجل الوصفات الطبية"})]})]})})]}),m&&e.jsx(O$,{open:c,onOpenChange:d,prescription:m}),x&&e.jsx(M$,{open:p,onOpenChange:h,prescription:x,onEdit:e=>{h(!1),n(e)},onPrint:e=>{h(!1),f(e)}})]})}function I$({open:t,onOpenChange:n,prescription:a}){const{deletePrescription:s,isLoading:r}=pa();return a?e.jsx(go,{open:t,onOpenChange:()=>{r||n(!1)},children:e.jsxs(yo,{dir:"rtl",className:"sm:max-w-[500px]",children:[e.jsxs(bo,{children:[e.jsxs(wo,{className:"flex items-center gap-2 text-right",children:[e.jsx(qa,{className:"w-5 h-5 text-red-600"}),"تأكيد حذف الوصفة الطبية"]}),e.jsxs(No,{className:"text-right space-y-4",children:[e.jsx("div",{children:"هل أنت متأكد من أنك تريد حذف الوصفة الطبية التالية؟"}),e.jsxs("div",{className:"bg-muted p-4 rounded-md space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(bs,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-medium",children:"تفاصيل الوصفة الطبية"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yr,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"المريض: "}),a.patient?.full_name||"غير محدد"]})]}),a.appointment&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"الموعد: "}),a.appointment.title]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"تاريخ الوصفة: "}),In(a.prescription_date)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4 text-orange-600"}),e.jsxs("span",{className:"text-sm font-medium",children:["الأدوية (",a.medications?.length||0,"):"]})]}),a.medications&&a.medications.length>0?e.jsx("div",{className:"space-y-1 mr-6",children:a.medications.map((t,n)=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded border",children:[e.jsx("div",{className:"font-medium",children:t.medication_name}),t.dose&&e.jsxs("div",{className:"text-muted-foreground text-xs",children:["الجرعة: ",t.dose]})]},n))}):e.jsx("div",{className:"text-sm text-muted-foreground mr-6",children:"لا توجد أدوية مرفقة"})]}),a.notes&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"الملاحظات:"}),e.jsx("div",{className:"text-sm text-muted-foreground bg-white p-2 rounded border",children:a.notes})]})]}),e.jsx("div",{className:"text-red-600 font-medium",children:"⚠️ تحذير: هذا الإجراء لا يمكن التراجع عنه"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"سيتم حذف الوصفة الطبية نهائياً من النظام مع جميع الأدوية المرفقة بها. هذا قد يؤثر على السجل الطبي للمريض."})]})]}),e.jsxs(jo,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsx(ko,{disabled:r,children:"إلغاء"}),e.jsx(_o,{onClick:async()=>{if(a)try{await s(a.id),Kc.success("تم حذف الوصفة الطبية بنجاح"),n(!1)}catch(e){console.error("Error deleting prescription:",e),Kc.error("فشل في حذف الوصفة الطبية")}},disabled:r,className:"bg-red-600 hover:bg-red-700 text-white",children:r?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحذف..."]}):e.jsxs(e.Fragment,{children:[e.jsx(dr,{className:"w-4 h-4 ml-2"}),"حذف نهائي"]})})]})]})}):null}function z$(){const{medications:t,loadMedications:n,isLoading:a}=xf(),{prescriptions:s,filteredPrescriptions:r,totalPrescriptions:i,recentPrescriptions:l,loadPrescriptions:o,setSearchQuery:c,setPatientFilter:d,setDateRangeFilter:m,clearFilters:u,isLoading:p}=pa(),{patients:h,loadPatients:x}=bt(),g=Tc({data:s,dateField:"prescription_date",initialFilter:{preset:"all",startDate:"",endDate:""}}),[f,v]=re.useState("prescriptions"),[y,b]=re.useState(""),[j,w]=re.useState(!1),[N,_]=re.useState(!1),[k,S]=re.useState(!1),[C,$]=re.useState(null),[D,E]=re.useState(null),[T,A]=re.useState(!1),[F,P]=re.useState(!1),[R,O]=re.useState(null),[M,L]=re.useState(null),[I,z]=re.useState("all"),[B,V]=re.useState({start:"",end:""});ua(),re.useEffect(()=>{n(),o(),x()},[n,o,x]);const Y=(e,t)=>{const n={...B,[e]:t};V(n),m(n)};return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",dir:"rtl",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground text-right",children:"الأدوية والوصفات الطبية"}),e.jsx("p",{className:"text-muted-foreground mt-2 text-right",children:"إدارة الأدوية والوصفات الطبية للمرضى"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Lr,{variant:"outline",onClick:async()=>{try{await Promise.all([n(),o(),x()]),Kc.success("تم تحديث البيانات بنجاح")}catch(e){Kc.error("فشل في تحديث البيانات")}},disabled:a||p,children:[e.jsx(Js,{className:"w-4 h-4 ml-2 "+(a||p?"animate-spin":"")}),"تحديث"]}),e.jsxs(Lr,{onClick:"medications"===f?()=>{$(null),_(!0)}:()=>{O(null),A(!0)},children:[e.jsx(Zs,{className:"w-4 h-4 ml-2"}),"medications"===f?"إضافة دواء":"إضافة وصفة طبية"]})]})]}),e.jsx(Ec,{value:g.timeFilter,onChange:g.handleFilterChange,onClear:g.resetFilter,title:"فلترة زمنية - الوصفات الطبية",defaultOpen:!1}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",dir:"rtl",children:[e.jsxs(nc,{className:pc("blue"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-right",children:"إجمالي الأدوية"}),e.jsx(Ws,{className:hc("blue")})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-right",children:t.length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"الأدوية المتاحة في النظام"})]})]}),e.jsxs(nc,{className:pc("green"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-right",children:"all"===g.timeFilter.preset||!g.timeFilter.startDate&&!g.timeFilter.endDate?"إجمالي الوصفات":"الوصفات المفلترة"}),e.jsx(bs,{className:hc("green")})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-right",children:"all"===g.timeFilter.preset||!g.timeFilter.startDate&&!g.timeFilter.endDate?s.length:g.filteredData.length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"all"===g.timeFilter.preset||!g.timeFilter.startDate&&!g.timeFilter.endDate?"وصفات إجمالية":"وصفات في الفترة المحددة"}),g.trend&&e.jsx("div",{className:"text-xs flex items-center mt-1 "+(g.trend.isPositive?"text-green-600":"text-red-600"),children:e.jsxs("span",{children:[Math.abs(g.trend.changePercent),"% من الفترة السابقة"]})})]})]}),e.jsxs(nc,{className:pc("purple"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-right",children:"الوصفات الحديثة"}),e.jsx(us,{className:hc("purple")})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-right",children:l}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"آخر 30 يوماً"})]})]}),e.jsxs(nc,{className:pc("yellow"),children:[e.jsxs(ac,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(sc,{className:"text-sm font-medium text-right",children:"المرضى النشطون"}),e.jsx(ns,{className:hc("yellow")})]}),e.jsxs(ic,{children:[e.jsx("div",{className:"text-2xl font-bold text-right",children:h.length}),e.jsx("p",{className:"text-xs text-muted-foreground text-right",children:"المرضى المسجلون"})]})]})]}),e.jsxs(nc,{children:[e.jsx(ac,{dir:"rtl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(sc,{className:"text-right",children:"البحث والفلاتر"}),e.jsx(rc,{className:"text-right",children:"البحث في الأدوية والوصفات الطبية"})]}),e.jsxs(Lr,{variant:"outline",onClick:()=>w(!j),children:[e.jsx(js,{className:"w-4 h-4 ml-2"}),j?"إخفاء الفلاتر":"إظهار الفلاتر",e.jsx(ss,{className:"w-4 h-4 mr-2 transition-transform "+(j?"rotate-180":"")})]})]})}),e.jsx(ic,{children:e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"relative",children:[e.jsx(tr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{placeholder:"medications"===f?"البحث في الأدوية...":"البحث في الوصفات الطبية...",value:y,onChange:e=>{b(e.target.value),"prescriptions"===f&&c(e.target.value)},className:"pr-10 text-right",dir:"rtl"}),y&&e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>{b(""),"prescriptions"===f&&c("")},className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",children:e.jsx(_r,{className:"w-3 h-3"})})]}),"prescriptions"===f&&e.jsx(Cc,{open:j,onOpenChange:w,children:e.jsxs(Dc,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-right block mb-2",children:"فلترة حسب المريض"}),e.jsxs(Nl,{value:I,onValueChange:e=>{z(e),d(e)},children:[e.jsx(Sl,{className:"text-right",dir:"rtl",children:e.jsx(kl,{placeholder:"اختر مريض"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع المرضى"}),h.map(t=>e.jsx(Al,{value:t.id,children:t.full_name},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-right block mb-2",children:"من تاريخ"}),e.jsx(Ir,{type:"date",value:B.start,onChange:e=>Y("start",e.target.value),className:"text-right",dir:"rtl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-right block mb-2",children:"إلى تاريخ"}),e.jsx(Ir,{type:"date",value:B.end,onChange:e=>Y("end",e.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(Lr,{variant:"outline",onClick:()=>{z("all"),V({start:"",end:""}),c(""),u()},children:[e.jsx(_r,{className:"w-4 h-4 ml-2"}),"مسح الفلاتر"]})})]})})]})})]}),e.jsxs(Ud,{value:f,onValueChange:v,className:"space-y-4",dir:"rtl",children:[e.jsx("div",{className:"flex items-center justify-between",dir:"rtl",children:e.jsxs(Hd,{className:"grid w-fit grid-cols-2",children:[e.jsxs(Gd,{value:"prescriptions",className:"flex items-center gap-2",children:[e.jsx(bs,{className:"w-4 h-4"}),"الوصفات الطبية"]}),e.jsxs(Gd,{value:"medications",className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4"}),"إدارة الأدوية"]})]})}),e.jsx(Wd,{value:"prescriptions",className:"space-y-4",dir:"rtl",children:e.jsxs(nc,{children:[e.jsxs(ac,{dir:"rtl",children:[e.jsxs(sc,{className:"flex items-center gap-2 text-right",children:[e.jsx(bs,{className:"w-5 h-5"}),"الوصفات الطبية"]}),e.jsx(rc,{className:"text-right",children:"إدارة جميع الوصفات الطبية للمرضى"})]}),e.jsx(ic,{children:e.jsx(L$,{prescriptions:r,onEdit:e=>{O(e),A(!0)},onDelete:e=>{L(e),P(!0)}})})]})}),e.jsx(Wd,{value:"medications",className:"space-y-4",dir:"rtl",children:e.jsxs(nc,{children:[e.jsxs(ac,{dir:"rtl",children:[e.jsxs(sc,{className:"flex items-center gap-2 text-right",children:[e.jsx(Ws,{className:"w-5 h-5"}),"إدارة الأدوية"]}),e.jsx(rc,{className:"text-right",children:"إدارة معلومات الأدوية المتاحة"})]}),e.jsx(ic,{children:e.jsx(e$,{medications:t,onEdit:e=>{$(e),_(!0)},onDelete:e=>{E(e),S(!0)},searchQuery:y})})]})})]}),e.jsx(t$,{open:N,onOpenChange:()=>{_(!1),$(null)},editingMedication:C}),e.jsx(n$,{open:k,onOpenChange:()=>{S(!1),E(null)},medication:D}),e.jsx(gf,{open:T,onOpenChange:()=>{A(!1),O(null)},editingPrescription:R}),e.jsx(I$,{open:F,onOpenChange:()=>{P(!1),L(null)},prescription:M})]})}R$.displayName=T$.displayName;const B$=re.forwardRef(({id:t,checked:n=!1,onCheckedChange:a,disabled:s=!1,className:r="",...i},l)=>e.jsxs("div",{className:"relative inline-flex items-center",children:[e.jsx("input",{ref:l,id:t,type:"checkbox",checked:n,onChange:e=>{a&&a(e.target.checked)},disabled:s,className:"sr-only",...i}),e.jsx("div",{className:`\n            w-5 h-5 border-2 rounded-md cursor-pointer transition-all duration-200 shadow-sm\n            ${n?"bg-blue-600 border-blue-600 text-white shadow-blue-200":"bg-white border-gray-400 hover:border-blue-400 hover:shadow-md"}\n            ${s?"opacity-50 cursor-not-allowed":""}\n            flex items-center justify-center\n            ${r}\n          `,onClick:()=>!s&&a&&a(!n),children:n&&e.jsx(as,{className:"w-4 h-4 text-white font-bold"})})]}));function V$({patientId:t,onToothClick:n,selectedTooth:a,selectedTeeth:s=[],isMultiSelectMode:r=!1,className:i,isPrimaryTeeth:l=!1,onPrimaryTeethChange:o}){const{toothTreatments:c,toothTreatmentImages:d,loadToothTreatmentsByPatient:m,loadToothTreatmentImagesByTooth:u,loadAllToothTreatmentImagesByPatient:p}=cc();sa();const[h,x]=re.useState(null),[g,f]=re.useState(!1),[v,y]=re.useState(0),b=o?l:g,j=o||f;re.useEffect(()=>{t&&(m(t),p(t))},[t,m,p]);const w=async()=>{t&&(await Promise.all([m(t),p(t)]),y(e=>e+1))};re.useEffect(()=>{"undefined"!=typeof window&&(window.forceToothColorUpdate=w().triggerToothColorUpdate=()=>{window.dispatchEvent(new CustomEvent("tooth-color-update",{detail:{type:"manual-trigger",timestamp:Date.now()}}))})},[t]),re.useEffect(()=>{},[d]),re.useEffect(()=>{y(e=>e+1)},[c]),re.useEffect(()=>{const e=()=>{y(e=>e+1)},t=async e=>{await w()};return window.addEventListener("treatment-updated",e),window.addEventListener("treatment-changed",e),window.addEventListener("tooth-color-update",t),window.addEventListener("treatments-loaded",e),()=>{window.removeEventListener("treatment-updated",e),window.removeEventListener("treatment-changed",e),window.removeEventListener("tooth-color-update",t),window.removeEventListener("treatments-loaded",e)}},[t]);const N=b?ya:va,_=N.filter(e=>"upper"===e.position),k=N.filter(e=>"lower"===e.position),S=e=>{const n=c.filter(n=>n.patient_id===t&&n.tooth_number===e).sort((e,t)=>e.priority-t.priority);return n},C=r=>{const i=ba(r,b),l=(e=>{const t=S(e),n=t.length,a=t.filter(e=>"completed"===e.treatment_status).length,s=t.filter(e=>"in_progress"===e.treatment_status).length,r=t.filter(e=>"planned"===e.treatment_status).length;return{total:n,completed:a,inProgress:s,planned:r,treatments:t}})(r),o=(e=>{const t=S(e);if(0===t.length)return"#22c55e";const n=t.every(e=>"completed"===e.treatment_status);if(n)return"#22c55e";const a=t.find(e=>"in_progress"===e.treatment_status)||t.find(e=>"planned"===e.treatment_status)||t[0];return a?.treatment_color||"#22c55e"})(r),c=(e=>t?d.filter(n=>n.tooth_number===e&&n.patient_id===t).length:0)(r),m=a===r,u=s.includes(r),p=h===r;return i?e.jsxs(F$,{children:[e.jsx(P$,{asChild:!0,children:e.jsxs(Lr,{variant:"outline",className:En("relative h-16 w-16 p-1 transition-all duration-200 border-2 overflow-hidden","flex flex-col items-center justify-center text-xs font-medium",m&&"ring-2 ring-blue-500 ring-offset-2",u&&"ring-2 ring-orange-500 ring-offset-2 border-orange-400",p&&"scale-105 shadow-lg"),style:{borderColor:o,color:"#000000",textShadow:"0 0 2px rgba(255,255,255,0.8)"},onClick:e=>{const t=e.ctrlKey||e.metaKey;n(r,t)},onMouseEnter:()=>x(r),onMouseLeave:()=>x(null),children:[e.jsx("div",{className:"absolute inset-0",children:0===l.total?e.jsx("div",{className:"w-full h-full",style:{backgroundColor:m?o:p?o+"40":o+"20"}}):1===l.total?(()=>{const t="completed"===l.treatments[0].treatment_status?o:l.treatments[0].treatment_color;return e.jsx("div",{className:"w-full h-full",style:{backgroundColor:t,opacity:m?.95:p?.85:"completed"===l.treatments[0].treatment_status?.8:"in_progress"===l.treatments[0].treatment_status?.75:.7}})})():2===l.total?(()=>{const e=l.treatments.every(e=>"completed"===e.treatment_status);return e})()?e.jsx("div",{className:"w-full h-full",style:{backgroundColor:o,opacity:m?.95:p?.85:.8}}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 border-b-2 border-white/50",style:{backgroundColor:"completed"===l.treatments[0].treatment_status?o:l.treatments[0].treatment_color,opacity:m?.95:p?.85:"completed"===l.treatments[0].treatment_status?.8:"in_progress"===l.treatments[0].treatment_status?.75:.7}}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1/2",style:{backgroundColor:"completed"===l.treatments[1].treatment_status?o:l.treatments[1].treatment_color,opacity:m?.95:p?.85:"completed"===l.treatments[1].treatment_status?.8:"in_progress"===l.treatments[1].treatment_status?.75:.7}})]}):3===l.total?l.treatments.every(e=>"completed"===e.treatment_status)?e.jsx("div",{className:"w-full h-full",style:{backgroundColor:o,opacity:m?.95:p?.85:.8}}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 border-b-2 border-white/50",style:{backgroundColor:"completed"===l.treatments[0].treatment_status?o:l.treatments[0].treatment_color,opacity:m?.95:p?.85:"completed"===l.treatments[0].treatment_status?.8:"in_progress"===l.treatments[0].treatment_status?.75:.7}}),e.jsx("div",{className:"absolute bottom-0 left-0 w-1/2 h-1/2 border-r-2 border-white/50",style:{backgroundColor:"completed"===l.treatments[1].treatment_status?o:l.treatments[1].treatment_color,opacity:m?.95:p?.85:"completed"===l.treatments[1].treatment_status?.8:"in_progress"===l.treatments[1].treatment_status?.75:.7}}),e.jsx("div",{className:"absolute bottom-0 right-0 w-1/2 h-1/2",style:{backgroundColor:"completed"===l.treatments[2].treatment_status?o:l.treatments[2].treatment_color,opacity:m?.95:p?.85:"completed"===l.treatments[2].treatment_status?.8:"in_progress"===l.treatments[2].treatment_status?.75:.7}})]}):l.treatments.every(e=>"completed"===e.treatment_status)?e.jsx("div",{className:"w-full h-full",style:{backgroundColor:o,opacity:m?.95:p?.85:.8}}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-0 left-0 w-1/2 h-1/2 border-r-2 border-b-2 border-white/50",style:{backgroundColor:"completed"===l.treatments[0].treatment_status?o:l.treatments[0].treatment_color,opacity:m?.95:p?.85:"completed"===l.treatments[0].treatment_status?.8:"in_progress"===l.treatments[0].treatment_status?.75:.7}}),e.jsx("div",{className:"absolute top-0 right-0 w-1/2 h-1/2 border-b-2 border-white/50",style:{backgroundColor:"completed"===l.treatments[1].treatment_status?o:l.treatments[1].treatment_color,opacity:m?.95:p?.85:"completed"===l.treatments[1].treatment_status?.8:"in_progress"===l.treatments[1].treatment_status?.75:.7}}),e.jsx("div",{className:"absolute bottom-0 left-0 w-1/2 h-1/2 border-r-2 border-white/50",style:{backgroundColor:"completed"===l.treatments[2].treatment_status?o:l.treatments[2].treatment_color,opacity:m?.95:p?.85:"completed"===l.treatments[2].treatment_status?.8:"in_progress"===l.treatments[2].treatment_status?.75:.7}}),e.jsx("div",{className:"absolute bottom-0 right-0 w-1/2 h-1/2",style:{backgroundColor:"completed"===l.treatments[3].treatment_status?o:l.treatments[3].treatment_color,opacity:m?.95:p?.85:"completed"===l.treatments[3].treatment_status?.8:"in_progress"===l.treatments[3].treatment_status?.75:.7}})]})}),e.jsx("div",{className:"relative z-10 text-xs font-bold mb-1 px-1 rounded",style:{backgroundColor:"rgba(255,255,255,0.95)",color:"#000000",textShadow:"none"},children:r}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"w-6 h-6 rounded-sm border-2 border-white flex items-center justify-center text-xs font-bold",style:{backgroundColor:l.total>0?"rgba(255,255,255,0.95)":"rgba(255,255,255,0.7)",color:l.total>0?"#1f2937":"#6b7280",textShadow:"none"},children:l.total>0?l.total:"✓"})}),c>0&&e.jsx("div",{className:"absolute -top-2 -left-2 z-20",children:e.jsx("div",{className:(c>9?"w-7 h-6 px-1":"w-6 h-6")+" rounded-full border-2 border-white bg-blue-600 flex items-center justify-center text-white font-bold shadow-lg transition-transform duration-200 hover:scale-110",style:{fontSize:c>9?"10px":"12px",fontWeight:"800",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.4), 0 2px 4px rgba(0,0,0,0.3)",background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",minWidth:"24px"},children:c>99?"99+":c})}),l.inProgress>0&&e.jsx("div",{className:"absolute -bottom-1 -left-1 z-20",children:e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full border border-white"})})]})}),e.jsx(R$,{side:"top",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"font-semibold",children:["السن رقم ",r," - ",i.arabicName]}),l.total>0?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Es,{className:"w-3 h-3"}),e.jsxs("span",{children:[l.total," علاج مسجل"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.completed>0&&e.jsxs(oc,{variant:"secondary",className:"text-xs bg-green-100 text-green-800",children:[e.jsx(ns,{className:"w-2 h-2 ml-1"}),l.completed," مكتمل"]}),l.inProgress>0&&e.jsxs(oc,{variant:"secondary",className:"text-xs bg-yellow-100 text-yellow-800",children:[e.jsx(Va,{className:"w-2 h-2 ml-1"}),l.inProgress," قيد التنفيذ"]}),l.planned>0&&e.jsxs(oc,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-800",children:[e.jsx(us,{className:"w-2 h-2 ml-1"}),l.planned," مخطط"]})]}),e.jsxs("div",{className:"space-y-1 mt-2",children:[l.treatments.slice(0,3).map((t,n)=>e.jsxs("div",{className:"text-xs flex items-center gap-2 p-1 rounded bg-gray-50 dark:bg-gray-700",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full border border-white/50",style:{backgroundColor:t.treatment_color,opacity:"completed"===t.treatment_status?1:"in_progress"===t.treatment_status?.8:.6}}),e.jsxs("span",{className:"font-medium text-blue-600",children:["#",t.priority]}),e.jsx("span",{className:"flex-1",children:_a(t.treatment_type)?.label||t.treatment_type}),e.jsx(oc,{variant:"outline",className:"text-xs px-1 py-0",style:{borderColor:t.treatment_color,color:t.treatment_color},children:Ca.find(e=>e.value===t.treatment_status)?.label})]},t.id)),l.total>3&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center",children:["و ",l.total-3," علاج آخر... انقر لعرض الكل"]})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"لا توجد علاجات مسجلة"}),c>0&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-1 rounded",children:["📷 ",c," صورة"]})]})})]},r):null};return e.jsx(A$,{children:e.jsxs(nc,{className:En("w-full",i),id:"dental-chart-section",children:[e.jsx(ac,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"w-5 h-5 text-blue-600"}),"مخطط الأسنان التفاعلي"]}),e.jsx(rc,{children:"انقر على أي سن لعرض وإدارة العلاجات المتعددة"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Yr,{htmlFor:"teeth-type",className:"text-sm font-medium",children:"أسنان لبنية"}),e.jsx(B$,{id:"teeth-type",checked:b,onCheckedChange:j})]})]})}),e.jsxs(ic,{className:"space-y-6 bg-card dark:bg-card",children:[e.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-4",children:wa.slice(0,6).map(t=>e.jsxs(oc,{variant:"secondary",className:"text-xs",style:{backgroundColor:t.color+"20",color:t.color,borderColor:t.color+"40"},children:[e.jsx("span",{className:"ml-1",children:t.icon}),t.label]},t.value))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-center text-sm font-medium text-muted-foreground",children:b?"الفك العلوي اللبني":"الفك العلوي"}),e.jsx("div",{className:"grid gap-1 justify-center "+(b?"grid-cols-10":"grid-cols-16"),children:_.map(e=>C(e.number))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-center text-sm font-medium text-muted-foreground",children:b?"الفك السفلي اللبني":"الفك السفلي"}),e.jsx("div",{className:"grid gap-1 justify-center "+(b?"grid-cols-10":"grid-cols-16"),children:k.map(e=>C(e.number))})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"انقر على أي سن لعرض تفاصيل العلاج وإدارة العلاجات المتعددة"}),e.jsxs("div",{className:"flex justify-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs",children:"#"}),e.jsx("span",{children:"عدد العلاجات"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsx("span",{children:"قيد التنفيذ"})]})]})]})]})]},`dental-chart-${v}`)})}B$.displayName="Checkbox";const Y$=[{value:"drilling",label:"حفر السن",description:"فتح السن والوصول للعصب"},{value:"nerve_extraction",label:"سحب العصب",description:"إزالة العصب المصاب"},{value:"canal_cleaning",label:"تنظيف القنوات",description:"تنظيف وتطهير قنوات الجذر"},{value:"canal_shaping",label:"تشكيل القنوات",description:"توسيع وتشكيل قنوات الجذر"},{value:"medication",label:"وضع الدواء",description:"وضع مضاد حيوي داخل القنوات"},{value:"filling",label:"حشو القنوات",description:"حشو نهائي لقنوات الجذر"},{value:"crown_prep",label:"تحضير للتاج",description:"تحضير السن لوضع التاج"},{value:"final_restoration",label:"الترميم النهائي",description:"وضع الحشوة أو التاج النهائي"}],q$=[{value:"cavity_prep",label:"تحضير التجويف",description:"إزالة التسوس وتحضير السن"},{value:"base_placement",label:"وضع القاعدة",description:"وضع مادة القاعدة الواقية"},{value:"filling_placement",label:"وضع الحشوة",description:"وضع مادة الحشو"},{value:"polishing",label:"تلميع",description:"تلميع وتنعيم الحشوة"},{value:"bite_adjustment",label:"تعديل العضة",description:"تعديل ارتفاع الحشوة"}],U$=[{value:"tooth_prep",label:"تحضير السن",description:"برد وتشكيل السن"},{value:"impression",label:"أخذ الطبعة",description:"أخذ طبعة للسن المحضر"},{value:"temp_crown",label:"تاج مؤقت",description:"وضع تاج مؤقت"},{value:"try_in",label:"تجربة التاج",description:"تجربة التاج النهائي"},{value:"cementation",label:"تثبيت التاج",description:"تثبيت التاج بالإسمنت"},{value:"final_adjustment",label:"التعديل النهائي",description:"تعديل العضة والتلميع"},{value:"initial_impression",label:"الطبعة الأولية",description:"أخذ طبعة أولية للفكين"},{value:"final_impression",label:"الطبعة النهائية",description:"أخذ طبعة نهائية دقيقة"},{value:"bite_registration",label:"تسجيل العضة",description:"تحديد العلاقة بين الفكين"},{value:"try_in_wax",label:"تجربة الشمع",description:"تجربة الأسنان على الشمع"},{value:"denture_delivery",label:"تسليم الجهاز",description:"تسليم الجهاز المتحرك النهائي"},{value:"denture_adjustment",label:"تعديل الجهاز",description:"تعديل وضبط الجهاز المتحرك"},{value:"follow_up_denture",label:"متابعة الجهاز",description:"فحص ومتابعة الجهاز المتحرك"},{value:"implant_impression",label:"طبعة الزرعة",description:"أخذ طبعة للزرعة المدفونة"},{value:"abutment_placement",label:"وضع الدعامة",description:"تركيب دعامة فوق الزرعة"},{value:"implant_crown_try",label:"تجربة تاج الزرعة",description:"تجربة التاج فوق الزرعة"},{value:"implant_crown_delivery",label:"تسليم تاج الزرعة",description:"تثبيت التاج النهائي فوق الزرعة"},{value:"post_space_prep",label:"تحضير مجرى الوتد",description:"تحضير مجرى الوتد في الجذر"},{value:"post_impression",label:"طبعة الوتد",description:"أخذ طبعة لمجرى الوتد"},{value:"post_try_in",label:"تجربة الوتد",description:"تجربة القلب والوتد"},{value:"post_cementation",label:"تثبيت الوتد",description:"تثبيت القلب والوتد بالإسمنت"},{value:"veneer_prep",label:"تحضير الفينير",description:"برد طفيف للسطح الأمامي"},{value:"veneer_impression",label:"طبعة الفينير",description:"أخذ طبعة للأسنان المحضرة"},{value:"veneer_try_in",label:"تجربة الفينير",description:"تجربة قشور الفينير"},{value:"veneer_bonding",label:"لصق الفينير",description:"لصق قشور الفينير نهائياً"}],H$=[{value:"consultation",label:"استشارة",description:"فحص وتقييم الحالة"},{value:"anesthesia",label:"تخدير",description:"تخدير موضعي"},{value:"extraction",label:"القلع",description:"قلع السن"},{value:"suturing",label:"خياطة",description:"خياطة الجرح إذا لزم"},{value:"follow_up",label:"متابعة",description:"فحص الشفاء"},{value:"suture_removal",label:"إزالة الخيوط",description:"إزالة الخيوط الجراحية"}],G$=[{value:"scaling",label:"تنظيف فوق اللثة",description:"إزالة الجير فوق خط اللثة"},{value:"root_planing",label:"تنظيف تحت اللثة",description:"تنظيف الجذور تحت اللثة"},{value:"polishing",label:"تلميع",description:"تلميع الأسنان"},{value:"fluoride",label:"فلورايد",description:"تطبيق الفلورايد"},{value:"maintenance",label:"صيانة دورية",description:"تنظيف دوري للمتابعة"}],W$=[{value:"examination",label:"فحص",description:"فحص أسنان الطفل"},{value:"cleaning",label:"تنظيف",description:"تنظيف أسنان الطفل"},{value:"fluoride_treatment",label:"علاج بالفلورايد",description:"تطبيق الفلورايد الوقائي"},{value:"sealant",label:"مادة سادة",description:"وضع مادة سادة للشقوق"},{value:"pulp_treatment",label:"علاج العصب",description:"علاج عصب سن لبني"},{value:"space_maintainer",label:"حافظ مسافة",description:"وضع جهاز حافظ المسافة"}],K$=[{value:"consultation",label:"استشارة تجميلية",description:"تقييم الحالة التجميلية"},{value:"teeth_whitening",label:"تبييض الأسنان",description:"جلسة تبييض"},{value:"veneer_prep",label:"تحضير للقشرة",description:"تحضير السن للقشرة التجميلية"},{value:"veneer_placement",label:"وضع القشرة",description:"تثبيت القشرة التجميلية"},{value:"polishing",label:"تلميع تجميلي",description:"تلميع وتنعيم نهائي"}];function Z$({session:t,isEditing:n,availableSessionTypes:a,onEdit:s,onCancelEdit:r,onSave:i,onDelete:l,getStatusBadgeColor:o,getStatusText:c,isDarkMode:d}){const[m,u]=re.useState({session_type:t.session_type,session_title:t.session_title,session_description:t.session_description,session_date:t.session_date,session_status:t.session_status,duration_minutes:t.duration_minutes,notes:t.notes}),p=()=>{i(m)},h=()=>{u({session_type:t.session_type,session_title:t.session_title,session_description:t.session_description,session_date:t.session_date,session_status:t.session_status,duration_minutes:t.duration_minutes,cost:t.cost,notes:t.notes}),r()};return n?e.jsx(nc,{className:En("border-2 transition-all duration-200",d?"border-yellow-600 bg-yellow-900/20":"border-yellow-400 bg-yellow-50"),children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium text-foreground",children:["تعديل الجلسة #",t.session_number]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Lr,{size:"sm",variant:"outline",onClick:h,children:[e.jsx(_r,{className:"w-4 h-4 ml-1"}),"إلغاء"]}),e.jsxs(Lr,{size:"sm",onClick:p,children:[e.jsx(er,{className:"w-4 h-4 ml-1"}),"حفظ"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"edit_session_type",children:"نوع الجلسة"}),e.jsxs(Nl,{value:m.session_type||"",onValueChange:e=>{const t=a.find(t=>t.value===e);u(n=>({...n,session_type:e,session_title:t?.label||n.session_title}))},children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر نوع الجلسة"})}),e.jsx(Dl,{children:a.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.label}),t.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:t.description})]})},t.value))})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"edit_session_title",children:"عنوان الجلسة"}),e.jsx(Ir,{id:"edit_session_title",value:m.session_title||"",onChange:e=>u(t=>({...t,session_title:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"edit_session_date",children:"تاريخ الجلسة"}),e.jsx(Ir,{id:"edit_session_date",type:"date",value:m.session_date||"",onChange:e=>u(t=>({...t,session_date:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"edit_session_status",children:"حالة الجلسة"}),e.jsxs(Nl,{value:m.session_status||"",onValueChange:e=>u(t=>({...t,session_status:e})),children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر حالة الجلسة"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"planned",children:"مخططة"}),e.jsx(Al,{value:"completed",children:"مكتملة"}),e.jsx(Al,{value:"cancelled",children:"ملغية"})]})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"edit_duration",children:"مدة الجلسة (دقيقة)"}),e.jsx(Ir,{id:"edit_duration",type:"number",value:m.duration_minutes||30,onChange:e=>u(t=>({...t,duration_minutes:parseInt(e.target.value)||30}))})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"edit_session_description",children:"وصف الجلسة"}),e.jsx(wl,{id:"edit_session_description",value:m.session_description||"",onChange:e=>u(t=>({...t,session_description:e.target.value})),rows:3})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"edit_notes",children:"ملاحظات"}),e.jsx(wl,{id:"edit_notes",value:m.notes||"",onChange:e=>u(t=>({...t,notes:e.target.value})),rows:2})]})]})})}):e.jsx(nc,{className:En("transition-all duration-200 hover:shadow-md",d?"bg-gray-800/50 hover:bg-gray-800/70":"bg-white hover:bg-gray-50"),children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:En("flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold",d?"bg-blue-600 text-white":"bg-blue-100 text-blue-800"),children:t.session_number}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:t.session_title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.find(e=>e.value===t.session_type)?.label||t.session_type})]}),e.jsx(oc,{className:o(t.session_status),children:c(t.session_status)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(es,{className:"w-4 h-4"}),(e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return"--";const n=t.getDate(),a=t.getMonth()+1,s=t.getFullYear(),r=n.toString().padStart(2,"0");return`${r}/${a.toString().padStart(2,"0")}/${s}`}catch(t){return console.warn("Error formatting date:",t),"--"}})(t.session_date)]}),t.duration_minutes&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(us,{className:"w-4 h-4"}),t.duration_minutes," دقيقة"]}),t.cost&&t.cost>0&&e.jsxs("div",{className:"font-medium text-green-600",children:["$",t.cost]})]}),t.session_description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.session_description}),t.notes&&e.jsxs("div",{className:En("text-xs p-2 rounded border-r-4",d?"bg-gray-700/50 border-gray-600 text-gray-300":"bg-gray-50 border-gray-300 text-gray-600"),children:[e.jsx("strong",{children:"ملاحظات:"})," ",t.notes]})]}),e.jsxs("div",{className:"flex gap-1 ml-4",children:[e.jsx(Lr,{size:"sm",variant:"ghost",onClick:s,className:"h-8 w-8 p-0",children:e.jsx(Us,{className:"w-4 h-4"})}),e.jsx(Lr,{size:"sm",variant:"ghost",onClick:l,className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(dr,{className:"w-4 h-4"})})]})]})})})}function Q$({treatment:t,sessions:n,onAddSession:a,onUpdateSession:s,onDeleteSession:r}){const{isDarkMode:i}=sa(),[l,o]=re.useState(!1),[c,d]=re.useState(null),[m,u]=re.useState({tooth_treatment_id:t.id,session_date:(new Date).toISOString().split("T")[0],session_status:"planned",duration_minutes:30}),p=(e=>{switch(e.toLowerCase()){case"علاج العصب":case"endodontic":return Y$;case"ترميمي/تحفظي":case"restorative":return q$;case"تركيبات":case"prosthetic":return U$;case"جراحي":case"surgical":return H$;case"لثة":case"periodontal":return G$;case"أطفال":case"pediatric":return W$;case"تجميلي":case"cosmetic":return K$;default:return[{value:"consultation",label:"استشارة",description:"استشارة وفحص"},{value:"treatment",label:"علاج",description:"جلسة علاج"},{value:"follow_up",label:"متابعة",description:"جلسة متابعة"}]}})(t.treatment_category),h=e=>{switch(e){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"planned":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},x=e=>{switch(e){case"completed":return"مكتملة";case"planned":return"مخططة";case"cancelled":return"ملغية";default:return e}};return e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["جلسات العلاج (",n.length,")"]}),e.jsxs(Lr,{onClick:()=>o(!0),size:"sm",className:En("action-btn-sessions sessions-selected","bg-blue-600 hover:bg-blue-700 text-white"),children:[e.jsx(Zs,{className:"w-4 h-4 ml-2"}),"إضافة جلسة"]})]}),e.jsx("div",{className:"space-y-3",children:n.map(t=>e.jsx(Z$,{session:t,isEditing:c===t.id,availableSessionTypes:p,onEdit:()=>d(t.id),onCancelEdit:()=>d(null),onSave:e=>(async(e,t)=>{try{await s(e,t),d(null),Kc.success("تم تحديث الجلسة بنجاح")}catch(n){Kc.error("فشل في تحديث الجلسة")}})(t.id,e),onDelete:()=>(async e=>{if(window.confirm("هل أنت متأكد من حذف هذه الجلسة؟"))try{await r(e),Kc.success("تم حذف الجلسة بنجاح")}catch(t){Kc.error("فشل في حذف الجلسة")}})(t.id),getStatusBadgeColor:h,getStatusText:x,isDarkMode:i},t.id))}),l&&e.jsxs(nc,{className:En("border-2 border-dashed transition-all duration-200",i?"border-blue-600 bg-gray-800/50":"border-blue-300 bg-blue-50/50"),children:[e.jsx(ac,{children:e.jsx(sc,{className:"text-lg text-foreground",children:"إضافة جلسة جديدة"})}),e.jsxs(ic,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"session_type",children:"نوع الجلسة *"}),e.jsxs(Nl,{value:m.session_type||"",onValueChange:e=>{const t=p.find(t=>t.value===e);u(n=>({...n,session_type:e,session_title:t?.label||""}))},children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر نوع الجلسة"})}),e.jsx(Dl,{children:p.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.label}),t.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:t.description})]})},t.value))})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"session_title",children:"عنوان الجلسة *"}),e.jsx(Ir,{id:"session_title",value:m.session_title||"",onChange:e=>u(t=>({...t,session_title:e.target.value})),placeholder:"عنوان الجلسة"})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"session_date",children:"تاريخ الجلسة *"}),e.jsx(Ir,{id:"session_date",type:"date",value:m.session_date||"",onChange:e=>u(t=>({...t,session_date:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"duration_minutes",children:"مدة الجلسة (دقيقة)"}),e.jsx(Ir,{id:"duration_minutes",type:"number",value:m.duration_minutes||30,onChange:e=>u(t=>({...t,duration_minutes:parseInt(e.target.value)||30})),placeholder:"30"})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"session_description",children:"وصف الجلسة"}),e.jsx(wl,{id:"session_description",value:m.session_description||"",onChange:e=>u(t=>({...t,session_description:e.target.value})),placeholder:"وصف ما تم عمله في الجلسة...",rows:3})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(Lr,{variant:"outline",onClick:()=>{o(!1),u({tooth_treatment_id:t.id,session_date:(new Date).toISOString().split("T")[0],session_status:"planned",duration_minutes:30})},children:[e.jsx(_r,{className:"w-4 h-4 ml-2"}),"إلغاء"]}),e.jsxs(Lr,{onClick:async()=>{if(m.session_type&&m.session_title&&m.session_date)try{await a(m),u({tooth_treatment_id:t.id,session_date:(new Date).toISOString().split("T")[0],session_status:"planned",duration_minutes:30,cost:0}),o(!1),Kc.success("تم إضافة الجلسة بنجاح")}catch(e){Kc.error("فشل في إضافة الجلسة")}else Kc.error("يرجى ملء جميع الحقول المطلوبة")},children:[e.jsx(er,{className:"w-4 h-4 ml-2"}),"حفظ الجلسة"]})]})]})]}),0===n.length&&!l&&e.jsx(nc,{className:En("text-center py-8",i?"bg-gray-800/50":"bg-gray-50"),children:e.jsxs(ic,{children:[e.jsx(es,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"لا توجد جلسات مسجلة لهذا العلاج"}),e.jsxs(Lr,{onClick:()=>o(!0),className:"mt-4 action-btn-sessions sessions-outline",variant:"outline",children:[e.jsx(Zs,{className:"w-4 h-4 ml-2"}),"إضافة أول جلسة"]})]})})]})}function X$({patientId:t,toothNumber:n,toothName:a,treatments:s,onAddTreatment:r,onUpdateTreatment:i,onDeleteTreatment:l,onReorderTreatments:o,onSessionStatsUpdate:c,onTreatmentUpdate:d}){const{isDarkMode:m}=sa(),{createPayment:u,updatePayment:p,getPaymentsByPatient:h}=ca(),{patients:x}=bt(),{labs:g,loadLabs:f}=HC(),{createLabOrder:v,updateLabOrder:y,deleteLabOrder:b,getLabOrdersByTreatment:j}=ph(),[w,N]=re.useState(!1),[_,k]=re.useState(null),[S,C]=re.useState(""),[$,D]=re.useState(!1),[E,T]=re.useState(null),[A,F]=re.useState(""),[P,R]=re.useState(0);re.useState(""),re.useState(0);const[O,M]=re.useState({patient_id:t,tooth_number:n,tooth_name:a,treatment_status:"planned",cost:0,start_date:(new Date).toISOString().split("T")[0]}),[L,I]=re.useState({}),[z,B]=re.useState(null);re.useEffect(()=>{f()},[f]);const V=[...s].sort((e,t)=>e.priority-t.priority),Y=t=>{switch(t){case"planned":return e.jsx(us,{className:"w-4 h-4 text-blue-500"});case"in_progress":return e.jsx(Ks,{className:"w-4 h-4 text-yellow-500"});case"completed":return e.jsx(ns,{className:"w-4 h-4 text-green-500"});case"cancelled":return e.jsx(Nr,{className:"w-4 h-4 text-gray-500"});default:return e.jsx(Ya,{className:"w-4 h-4 text-gray-400"})}},q=e=>{const t=Ca.find(t=>t.value===e);return t?.color||"#6b7280"},U=async(e,t)=>{try{console.log("🦷 MultipleToothTreatments: Updating treatment:",e,t),await i(e,t),console.log("🦷 MultipleToothTreatments: onUpdateTreatment completed"),k(null),d?.(),console.log("🦷 MultipleToothTreatments: Treatment updated successfully"),Kc.success("تم تحديث العلاج بنجاح")}catch(n){console.error("🦷 MultipleToothTreatments: Error updating treatment:",n),n&&"object"==typeof n&&"message"in n&&console.error("🦷 MultipleToothTreatments: Error message:",n.message),Kc.error("فشل في تحديث العلاج")}},H=S?Na(S):ja,G=(e=>{if("التعويضات"!==S)return e;const t={crowns:e.filter(e=>e.value.includes("crown")&&!e.value.includes("implant")),bridges:e.filter(e=>e.value.includes("bridge")),dentures:e.filter(e=>e.value.includes("denture")),implants:e.filter(e=>e.value.includes("implant")),posts:e.filter(e=>e.value.includes("post")||e.value.includes("core")),veneers:e.filter(e=>e.value.includes("veneer"))};return{groups:t,isGrouped:!0}})(H),W=async e=>{try{const t=await window.electronAPI.treatmentSessions.getByTreatment(e);I(n=>({...n,[e]:t}))}catch(t){console.error("Error loading treatment sessions:",t),Kc.error("فشل في تحميل جلسات العلاج")}};return re.useEffect(()=>{z&&W(z)},[z]),e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["علاجات السن رقم ",n]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a})]}),e.jsxs(Lr,{onClick:()=>N(!0),className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(Zs,{className:"w-4 h-4 ml-2"}),"إضافة علاج"]})]}),e.jsx("div",{className:"space-y-3",children:0===V.length?e.jsx(nc,{children:e.jsx(ic,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"لا توجد علاجات مسجلة لهذا السن"})})}):V.map((t,n)=>{return e.jsxs(nc,{className:"relative",children:[e.jsx(ac,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:["#",t.priority]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(0===e)return;const t=[...V],n=t[e];t[e]=t[e-1],t[e-1]=n;const a=t.map(e=>e.id);await o(a)})(n),disabled:0===n,className:"h-6 w-6 p-0",children:e.jsx(Wa,{className:"w-3 h-3"})}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(e===V.length-1)return;const t=[...V],n=t[e];t[e]=t[e+1],t[e+1]=n;const a=t.map(e=>e.id);await o(a)})(n),disabled:n===V.length-1,className:"h-6 w-6 p-0",children:e.jsx(Ua,{className:"w-3 h-3"})})]})]}),e.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-white",style:{backgroundColor:t.treatment_color}}),e.jsxs("div",{children:[e.jsx(sc,{className:"text-base",children:_a(t.treatment_type)?.label||t.treatment_type}),e.jsx(rc,{children:(a=t.treatment_category,wa.find(e=>e.value===a))?.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(oc,{variant:"secondary",style:{backgroundColor:q(t.treatment_status)+"20",color:q(t.treatment_status)},children:[Y(t.treatment_status),e.jsx("span",{className:"mr-1",children:Ca.find(e=>e.value===t.treatment_status)?.label})]}),e.jsxs(Lr,{variant:z===t.id?"default":"outline",size:"sm",onClick:()=>B(z===t.id?null:t.id),className:En("action-btn-sessions gap-1.5",z===t.id?"sessions-selected bg-blue-600 hover:bg-blue-700 text-white shadow-md":"sessions-outline border-blue-200 text-blue-700 dark:border-blue-700 dark:text-blue-300"),title:"إدارة جلسات العلاج",children:[e.jsx(es,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"الجلسات"})]}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>k(t.id),children:e.jsx(Us,{className:"w-4 h-4"})}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>(async e=>{T(e),D(!0)})(t.id),className:"text-red-600 hover:text-red-700",children:e.jsx(dr,{className:"w-4 h-4"})})]})]})}),e.jsxs(ic,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[t.cost&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:["$",t.cost]})]}),t.start_date&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:In(t.start_date)})]}),t.completion_date&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:In(t.completion_date)})]})]}),t.notes&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2 p-2 bg-muted rounded",children:t.notes})]})]},t.id);var a})}),_&&e.jsxs(nc,{className:En("border-2 shadow-lg !border-solid",m?"!border-orange-800/50 bg-orange-950/20 shadow-orange-900/20":"!border-orange-200 bg-orange-50/50 shadow-orange-100/50"),children:[e.jsx(ac,{className:En("border-b",m?"border-orange-800/30":"border-orange-200/50"),children:e.jsx(sc,{className:En("text-lg",m?"text-orange-200":"text-orange-900"),children:"تعديل العلاج"})}),e.jsx(ic,{className:"space-y-4",children:(()=>{const t=s.find(e=>e.id===_);return t?e.jsx(J$,{treatment:t,onSave:U,onCancel:()=>k(null)}):null})()})]}),z&&e.jsxs(nc,{className:En("border-2 shadow-lg",m?"border-blue-800/50 bg-blue-950/20 shadow-blue-900/20":"border-blue-200 bg-blue-50/50 shadow-blue-100/50"),children:[e.jsxs(ac,{className:En("border-b",m?"border-blue-800/30":"border-blue-200/50"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(sc,{className:En("text-lg",m?"text-blue-200":"text-blue-900"),children:"إدارة جلسات العلاج"}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>B(null),children:e.jsx(_r,{className:"w-4 h-4"})})]}),e.jsx(rc,{children:(()=>{const e=s.find(e=>e.id===z);return e?`${_a(e.treatment_type)?.label||e.treatment_type}`:""})()})]}),e.jsx(ic,{className:"p-6",children:(()=>{const t=s.find(e=>e.id===z);return t?e.jsx(Q$,{treatment:t,sessions:L[z]||[],onAddSession:e=>(async(e,t)=>{try{await window.electronAPI.treatmentSessions.create(t),await W(e),c?.(),Kc.success("تم إضافة الجلسة بنجاح")}catch(n){console.error("Error adding session:",n),Kc.error("فشل في إضافة الجلسة")}})(z,e),onUpdateSession:(e,t)=>(async(e,t,n)=>{try{await window.electronAPI.treatmentSessions.update(t,n),await W(e),c?.(),Kc.success("تم تحديث الجلسة بنجاح")}catch(a){console.error("Error updating session:",a),Kc.error("فشل في تحديث الجلسة")}})(z,e,t),onDeleteSession:e=>(async(e,t)=>{try{await window.electronAPI.treatmentSessions.delete(t),await W(e),c?.(),Kc.success("تم حذف الجلسة بنجاح")}catch(n){console.error("Error deleting session:",n),Kc.error("فشل في حذف الجلسة")}})(z,e)}):null})()})]}),w&&e.jsxs(nc,{className:En("border-2 shadow-lg",m?"border-blue-800/50 bg-blue-950/20 shadow-blue-900/20":"border-blue-200 bg-blue-50/50 shadow-blue-100/50"),children:[e.jsx(ac,{className:En("border-b",m?"border-blue-800/30":"border-blue-200/50"),children:e.jsx(sc,{className:En("text-lg",m?"text-blue-200":"text-blue-900"),children:"إضافة علاج جديد"})}),e.jsxs(ic,{className:En("space-y-4 p-6",m?"bg-blue-950/10":"bg-blue-50/30"),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:En("font-medium",m?"text-blue-200":"text-blue-800"),children:"تصنيف العلاج"}),e.jsxs(Nl,{value:S,onValueChange:e=>{C(e),M(t=>({...t,treatment_category:e}))},children:[e.jsx(Sl,{className:En("border-2 transition-colors",m?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500"),children:e.jsx(kl,{placeholder:"اختر التصنيف"})}),e.jsx(Dl,{children:wa.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t.icon}),e.jsx("span",{children:t.label})]})},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:En("font-medium",m?"text-blue-200":"text-blue-800"),children:"نوع العلاج"}),e.jsxs(Nl,{value:O.treatment_type||"",onValueChange:e=>M(t=>({...t,treatment_type:e})),disabled:!S,children:[e.jsx(Sl,{className:En("border-2 transition-colors",!S&&"opacity-50 cursor-not-allowed",m?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500"),children:e.jsx(kl,{placeholder:"اختر نوع العلاج"})}),e.jsx(Dl,{className:"max-h-80",children:"التعويضات"===S&&G.isGrouped?e.jsxs(e.Fragment,{children:[G.groups.crowns.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-purple-600 dark:text-purple-400",children:"👑 التيجان"}),G.groups.crowns.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value)),e.jsx(Tl,{})]}),G.groups.bridges.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-orange-600 dark:text-orange-400",children:"🌉 الجسور"}),G.groups.bridges.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value)),e.jsx(Tl,{})]}),G.groups.dentures.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-blue-600 dark:text-blue-400",children:"🦷 الأجهزة المتحركة"}),G.groups.dentures.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value)),e.jsx(Tl,{})]}),G.groups.implants.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:"🔩 تعويضات الزرعات"}),G.groups.implants.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value)),e.jsx(Tl,{})]}),G.groups.posts.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:"🔧 القلوب والأوتاد"}),G.groups.posts.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value)),e.jsx(Tl,{})]}),G.groups.veneers.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-pink-600 dark:text-pink-400",children:"✨ الفينير"}),G.groups.veneers.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value))]})]}):H.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:En("font-medium",m?"text-blue-200":"text-blue-800"),children:"حالة العلاج"}),e.jsxs(Nl,{value:O.treatment_status||"planned",onValueChange:e=>{M(t=>({...t,treatment_status:e})),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("tooth-color-update",{detail:{type:"status-preview-new",newStatus:e,timestamp:Date.now()}}))},children:[e.jsx(Sl,{className:En("border-2 transition-colors",m?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500"),children:e.jsx(kl,{})}),e.jsx(Dl,{children:Ca.map(t=>e.jsx(Al,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:En("font-medium",m?"text-blue-200":"text-blue-800"),children:"التكلفة ($)"}),e.jsx(Ir,{type:"number",min:"0",step:"0.1",value:O.cost||"",onChange:e=>{const t=e.target.value;M(e=>({...e,cost:""===t?0:parseFloat(t)||0}))},onBlur:e=>{const t=parseFloat(e.target.value)||0;M(e=>({...e,cost:t}))},placeholder:"0.00",className:En("border-2 transition-colors",m?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500")}),O.cost&&O.cost>0&&e.jsx("p",{className:En("text-xs",m?"text-blue-300":"text-blue-600"),children:"💡 سيتم إنشاء دفعة معلقة في جدول المدفوعات"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:En("font-medium",m?"text-blue-200":"text-blue-800"),children:"تاريخ العلاج"}),e.jsx(Ir,{type:"date",value:O.start_date||"",onChange:e=>M(t=>({...t,start_date:e.target.value})),className:En("border-2 transition-colors",m?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500")})]})]}),"التعويضات"===S&&e.jsxs("div",{className:En("grid grid-cols-1 md:grid-cols-2 gap-4 p-5 rounded-xl border-2 shadow-sm transition-all duration-200",m?"bg-gradient-to-br from-purple-950/40 to-purple-900/30 border-purple-700/50 shadow-purple-900/20":"bg-gradient-to-br from-purple-50 to-purple-100/60 border-purple-300/70 shadow-purple-200/30"),children:[e.jsx("div",{className:"md:col-span-2 mb-3",children:e.jsxs("div",{className:En("flex items-center gap-3 text-sm font-semibold",m?"text-purple-200":"text-purple-800"),children:[e.jsx("div",{className:En("w-8 h-8 rounded-lg flex items-center justify-center text-lg",m?"bg-purple-800/50 text-purple-200":"bg-purple-200/80 text-purple-800"),children:"🏭"}),e.jsx("span",{children:"إعدادات المخبر"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Yr,{className:En("font-medium flex items-center gap-2 text-sm",m?"text-purple-100":"text-purple-900"),children:"🏭 اختيار المخبر"}),e.jsxs(Nl,{value:A,onValueChange:F,children:[e.jsx(Sl,{className:En("border-2 transition-all duration-200 h-11",m?"border-purple-700/50 bg-purple-950/40 hover:border-purple-600 focus:border-purple-500 text-purple-100":"border-purple-300/70 bg-white hover:border-purple-400 focus:border-purple-500 text-purple-900"),children:e.jsx(kl,{placeholder:"اختر المخبر"})}),e.jsx(Dl,{className:En(m?"bg-purple-950 border-purple-700":"bg-white border-purple-200"),children:g.map(t=>e.jsx(Al,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"🏭"}),e.jsx("span",{children:t.name})]})},t.id))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Yr,{className:En("font-medium flex items-center gap-2 text-sm",m?"text-purple-100":"text-purple-900"),children:"💰 تكلفة المخبر ($)"}),e.jsx(Ir,{type:"number",min:"0",step:"0.1",value:P||"",onChange:e=>{const t=e.target.value;R(""===t?0:parseFloat(t)||0)},onBlur:e=>{const t=parseFloat(e.target.value)||0;R(t)},placeholder:"0.00",className:En("border-2 transition-all duration-200 h-11",m?"border-purple-700/50 bg-purple-950/40 hover:border-purple-600 focus:border-purple-500 text-purple-100 placeholder:text-purple-400":"border-purple-300/70 bg-white hover:border-purple-400 focus:border-purple-500 text-purple-900 placeholder:text-purple-500")}),P>0&&e.jsxs("div",{className:En("flex items-center gap-2 p-2 rounded-lg text-xs",m?"bg-purple-900/30 text-purple-200 border border-purple-700/30":"bg-purple-100/60 text-purple-700 border border-purple-200/50"),children:[e.jsx("span",{className:"text-sm",children:"🏭"}),e.jsx("span",{children:"سيتم إنشاء طلب مخبر تلقائياً"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:En("font-medium",m?"text-blue-200":"text-blue-800"),children:"ملاحظات"}),e.jsx(wl,{value:O.notes||"",onChange:e=>M(t=>({...t,notes:e.target.value})),placeholder:"أدخل أي ملاحظات إضافية...",rows:3,className:En("border-2 transition-colors resize-none",m?"border-blue-800/50 bg-blue-950/30 hover:border-blue-700 focus:border-blue-600":"border-blue-200 bg-white hover:border-blue-300 focus:border-blue-500")})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-blue-200/50 dark:border-blue-800/30",children:[e.jsxs(Lr,{variant:"outline",onClick:()=>{N(!1),C(""),M({patient_id:t,tooth_number:n,tooth_name:a,treatment_status:"planned",cost:0,start_date:(new Date).toISOString().split("T")[0]})},className:En("border-2 transition-all duration-200",m?"border-gray-600 text-gray-300 hover:border-gray-500 hover:bg-gray-800":"border-gray-300 text-gray-700 hover:border-gray-400 hover:bg-gray-50"),children:[e.jsx(_r,{className:"w-4 h-4 ml-2"}),"إلغاء"]}),e.jsxs(Lr,{onClick:async()=>{if(!O.treatment_type||!O.treatment_category)return void Kc.error("يرجى اختيار نوع العلاج والتصنيف");if("التعويضات"===O.treatment_category&&P>0&&!A)return void Kc.error("يرجى اختيار المختبر عند إدخال تكلفة المختبر للتعويضات");let e=null;try{console.log("🚀 [DEBUG] Starting treatment creation process:",{treatmentType:O.treatment_type,category:O.treatment_category,cost:O.cost,isProsthetic:"التعويضات"===O.treatment_category,hasLabData:!!A&&P>0});const l={...O,treatment_color:_a(O.treatment_type)?.color||"#22c55e"},o=await r(l);if(!o)throw new Error("فشل في إنشاء العلاج");if(e=o.id,console.log("✅ [DEBUG] Treatment created successfully:",e),O.cost&&O.cost>0){console.log("💰 [DEBUG] Creating payment for treatment:",e);try{await(async e=>{if(console.log("💰 [DEBUG] createPendingPaymentForTreatment called:",{treatmentId:e,cost:O.cost,patientId:t}),!e)throw console.error("❌ [DEBUG] Cannot create payment - missing treatment ID"),new Error("معرف العلاج مطلوب لإنشاء الدفعة");if(!O.cost||O.cost<=0)console.log("⚠️ [DEBUG] Skipping payment creation - no cost specified");else try{const s=x.find(e=>e.id===t);if(!s)throw new Error("لم يتم العثور على بيانات المريض");const r=_a(O.treatment_type),i=`علاج ${r?.label||O.treatment_type} - سن ${a||n}`,l={patient_id:t,tooth_treatment_id:e,amount:0,payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:i,status:"pending",notes:`دفعة معلقة للمريض: ${s.full_name} - السن: ${a} - العلاج: ${r?.label||O.treatment_type}`,total_amount_due:O.cost,amount_paid:0,remaining_balance:O.cost,treatment_total_cost:O.cost,treatment_total_paid:0,treatment_remaining_balance:O.cost};console.log("💰 [DEBUG] Creating payment with data:",l),await u(l),console.log("✅ [DEBUG] Payment created successfully for treatment:",e),Kc.success("تم إنشاء دفعة معلقة في جدول المدفوعات")}catch(s){console.error("❌ [DEBUG] Payment creation failed:",s);const e=s instanceof Error?s.message:"خطأ غير معروف";throw Kc.error(`فشل في إنشاء الدفعة المعلقة: ${e}`),s}})(e),console.log("✅ [DEBUG] Payment created successfully for treatment:",e)}catch(s){console.error("❌ [DEBUG] Payment creation failed:",s),Kc.warning("تم إنشاء العلاج ولكن فشل في إنشاء الدفعة")}}if("التعويضات"===O.treatment_category&&A&&P>0)try{await(async e=>{if(!e)throw new Error("معرف العلاج مطلوب لإنشاء طلب المختبر");if(A&&!(P<=0))try{const s=x.find(e=>e.id===t),r=_a(O.treatment_type);if(!s)throw new Error("لم يتم العثور على بيانات المريض");const i={lab_id:A,patient_id:t,tooth_treatment_id:e,tooth_number:n,service_name:`${r?.label||"علاج تعويضات"} - السن ${n}`,cost:P,order_date:(new Date).toISOString().split("T")[0],status:"معلق",notes:`طلب مخبر للمريض: ${s.full_name} - السن: ${a} - العلاج: ${r?.label||O.treatment_type}`,paid_amount:0,remaining_balance:P};await v(i),j(e).length>0?Kc.success("تم إنشاء طلب المختبر وربطه بالعلاج بنجاح"):Kc.warning("تم إنشاء طلب المختبر ولكن قد تحتاج لإعادة تحميل الصفحة للتحقق من الربط")}catch(s){console.error("❌ [DEBUG] Lab order creation failed:",s);const e=s instanceof Error?s.message:"خطأ غير معروف";throw Kc.error(`فشل في إنشاء طلب المختبر: ${e}`),s}})(e)}catch(i){Kc.warning("تم إنشاء العلاج والدفعة ولكن فشل في إنشاء طلب المختبر")}M({patient_id:t,tooth_number:n,tooth_name:a,treatment_status:"planned",cost:0,start_date:(new Date).toISOString().split("T")[0]}),C(""),F(""),R(0),N(!1),Kc.success("تم إضافة العلاج بنجاح مع جميع المكونات المطلوبة")}catch(l){Kc.error("فشل في إضافة العلاج - يرجى المحاولة مرة أخرى")}},className:En("transition-all duration-200 shadow-lg",m?"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-900/30":"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-500/30"),children:[e.jsx(er,{className:"w-4 h-4 ml-2"}),"حفظ العلاج"]})]})]})]}),e.jsx(go,{open:$,onOpenChange:D,children:e.jsxs(yo,{className:"max-w-md",dir:"rtl",children:[e.jsx(bo,{children:e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(qa,{className:"w-8 h-8 text-destructive"})}),e.jsxs("div",{children:[e.jsx(wo,{children:"هل أنت متأكد من حذف هذا العلاج؟"}),e.jsx(No,{children:"هذا الإجراء لا يمكن التراجع عنه. سيتم حذف العلاج وجميع البيانات المرتبطة به نهائياً."})]})]})}),E&&(()=>{const t=s.find(e=>e.id===E);return t?e.jsxs("div",{className:"my-4",children:[e.jsxs("div",{className:"bg-muted/50 border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(dr,{className:"w-5 h-5 text-destructive"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:_a(t.treatment_type)?.label||t.treatment_type}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["السن: ",a," (#",n,")"]})]})]}),t.notes&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"الملاحظات:"})," ",t.notes]})]}),e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 mt-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(qa,{className:"w-5 h-5 text-destructive mt-0.5 ml-2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-destructive",children:"تحذير مهم"}),e.jsx("p",{className:"text-sm text-destructive/80 mt-1",children:"سيتم حذف جميع البيانات المرتبطة بهذا العلاج بما في ذلك:"}),e.jsxs("ul",{className:"text-sm text-destructive/80 mt-2 list-disc list-inside",children:[e.jsx("li",{children:"جلسات العلاج المسجلة"}),e.jsx("li",{children:"المدفوعات المرتبطة"}),e.jsx("li",{children:"طلبات المختبر (إن وجدت)"}),e.jsx("li",{children:"الصور والملفات المرفقة"})]})]})]})})]}):null})(),e.jsxs(jo,{className:"flex justify-end space-x-3 space-x-reverse",children:[e.jsx(ko,{children:"إلغاء"}),e.jsxs(_o,{onClick:async()=>{if(E)try{await l(E),Kc.success("تم حذف العلاج بنجاح"),D(!1),T(null)}catch(e){Kc.error("فشل في حذف العلاج")}},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[e.jsx(dr,{className:"w-4 h-4 ml-2"}),"تأكيد الحذف"]})]})]})})]})}function J$({treatment:t,onSave:n,onCancel:a}){const{isDarkMode:s}=sa(),{createPayment:r,updatePayment:i,getPaymentsByPatient:l}=ca(),{patients:o}=bt(),{labs:c,loadLabs:d}=HC(),{createLabOrder:m,getLabOrdersByTreatment:u,updateLabOrder:p,deleteLabOrder:h,loadLabOrders:x}=ph(),[g,f]=re.useState({treatment_type:t.treatment_type,treatment_category:t.treatment_category,treatment_status:t.treatment_status,cost:t.cost,start_date:t.start_date,completion_date:t.completion_date,notes:t.notes}),[v,y]=re.useState(t.treatment_category||""),[b]=re.useState(t.cost||0),[j,w]=re.useState(""),[N,_]=re.useState(0),[k,S]=re.useState(!1);re.useState(!1);const C=async e=>{try{const a=await(window.electronAPI?.labOrders?.getAll())||[],s=a.find(t=>t.tooth_treatment_id===e);if(s)return s;const r=a.find(e=>!e.tooth_treatment_id&&e.patient_id===t.patient_id);if(r)try{return await p(r.id,{tooth_treatment_id:e,tooth_number:t.tooth_number}),{...r,tooth_treatment_id:e}}catch(n){return r}return null}catch(a){return null}},$=async()=>{if("التعويضات"===t.treatment_category){const e=await C(t.id);e?(w(e.lab_id||""),_(e.cost||0),Kc.success("تم إعادة تحميل بيانات المختبر")):(w(""),_(0),Kc.info("لا يوجد طلب مختبر لهذا العلاج"))}else Kc.info("هذا العلاج ليس من فئة التعويضات")};re.useEffect(()=>{(async()=>{try{if(S(!1),await d(),y(t.treatment_category||""),"التعويضات"===t.treatment_category){const e=await C(t.id);e?(w(e.lab_id||""),_(e.cost||0)):(w(""),_(0))}else w(""),_(0);S(!0)}catch(e){w(""),_(0),S(!0)}})()},[t.id,t.treatment_category,d]),re.useEffect(()=>{"التعويضات"!==v&&(w(""),_(0))},[v]),re.useEffect(()=>{console.log("🔍 Lab values changed:",{selectedLab:j,labCost:N,isLabDataLoaded:k,treatmentId:t.id,category:t.treatment_category})},[j,N,k,t.id,t.treatment_category]);const D=v?Na(v):[],E=(e=>{if("التعويضات"!==v)return e;const t={crowns:e.filter(e=>e.value.includes("crown")&&!e.value.includes("implant")),bridges:e.filter(e=>e.value.includes("bridge")),dentures:e.filter(e=>e.value.includes("denture")),implants:e.filter(e=>e.value.includes("implant")),posts:e.filter(e=>e.value.includes("post")||e.value.includes("core")),veneers:e.filter(e=>e.value.includes("veneer"))};return{groups:t,isGrouped:!0}})(D);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"تصنيف العلاج"}),e.jsxs(Nl,{value:v,onValueChange:e=>{y(e),f(t=>({...t,treatment_category:e}))},children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر التصنيف"})}),e.jsx(Dl,{children:wa.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t.icon}),e.jsx("span",{children:t.label})]})},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"نوع العلاج"}),e.jsxs(Nl,{value:g.treatment_type||"",onValueChange:e=>f(t=>({...t,treatment_type:e})),disabled:!v,children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر نوع العلاج"})}),e.jsx(Dl,{className:"max-h-80",children:"التعويضات"===v&&E.isGrouped?e.jsxs(e.Fragment,{children:[E.groups.crowns.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-purple-600 dark:text-purple-400",children:"👑 التيجان"}),E.groups.crowns.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value)),e.jsx(Tl,{})]}),E.groups.bridges.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-orange-600 dark:text-orange-400",children:"🌉 الجسور"}),E.groups.bridges.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value)),e.jsx(Tl,{})]}),E.groups.dentures.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-blue-600 dark:text-blue-400",children:"🦷 الأجهزة المتحركة"}),E.groups.dentures.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value)),e.jsx(Tl,{})]}),E.groups.implants.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:"🔩 تعويضات الزرعات"}),E.groups.implants.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value)),e.jsx(Tl,{})]}),E.groups.posts.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:"🔧 القلوب والأوتاد"}),E.groups.posts.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value)),e.jsx(Tl,{})]}),E.groups.veneers.length>0&&e.jsxs(_l,{children:[e.jsx(El,{className:"flex items-center gap-2 text-pink-600 dark:text-pink-400",children:"✨ الفينير"}),E.groups.veneers.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value))]})]}):D.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"حالة العلاج"}),e.jsxs(Nl,{value:g.treatment_status||"planned",onValueChange:e=>{f(t=>({...t,treatment_status:e,completion_date:"completed"!==e||t.completion_date?t.completion_date:(new Date).toISOString().split("T")[0]})),"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("tooth-color-update",{detail:{type:"status-preview",treatmentId:t.id,newStatus:e,timestamp:Date.now()}}))},children:[e.jsx(Sl,{children:e.jsx(kl,{})}),e.jsx(Dl,{children:Ca.map(t=>e.jsx(Al,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{className:En("font-medium",s?"text-orange-200":"text-orange-800"),children:"التكلفة ($)"}),e.jsx(Ir,{type:"number",min:"0",step:"0.1",value:g.cost||"",onChange:e=>{e.stopPropagation();const t=e.target.value;f(e=>({...e,cost:""===t?0:parseFloat(t)||0}))},onBlur:e=>{e.stopPropagation();const t=parseFloat(e.target.value)||0;f(e=>({...e,cost:t}))},onInput:e=>{e.stopPropagation(),e.nativeEvent&&e.nativeEvent.stopImmediatePropagation&&e.nativeEvent.stopImmediatePropagation()},onKeyDown:e=>{if("Escape"===e.key)return e.preventDefault(),void f(e=>({...e,cost:0}));["Backspace","Delete","Tab","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","."].includes(e.key)||e.key>="0"&&e.key<="9"||e.ctrlKey&&["a","c","v","x","z"].includes(e.key.toLowerCase())||e.preventDefault()},onFocus:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation()},placeholder:"0.00","data-prevent-shortcuts":"true",className:En("border-2 transition-colors",s?"border-orange-800/50 bg-orange-950/30 hover:border-orange-700 focus:border-orange-600":"border-orange-200 bg-white hover:border-orange-300 focus:border-orange-500")}),g.cost&&g.cost>0&&g.cost!==b&&e.jsx("p",{className:En("text-xs",s?"text-orange-300":"text-orange-600"),children:"💡 سيتم إنشاء دفعة معلقة عند تعديل التكلفة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"تاريخ العلاج"}),e.jsx(Ir,{type:"date",value:g.start_date||"",onChange:e=>f(t=>({...t,start_date:e.target.value})),onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key)return e.preventDefault(),void e.stopPropagation()},onFocus:e=>e.stopPropagation(),onClick:e=>e.stopPropagation(),"data-prevent-shortcuts":"true"})]})]}),("التعويضات"===v||"التعويضات"===t.treatment_category)&&e.jsxs("div",{className:En("grid grid-cols-1 md:grid-cols-2 gap-4 p-5 rounded-xl border-2 shadow-sm transition-all duration-200",s?"bg-gradient-to-br from-purple-950/30 to-purple-900/20 border-purple-700/40 shadow-purple-900/10":"bg-gradient-to-br from-purple-50 to-purple-100/50 border-purple-300/60 shadow-purple-200/20"),children:[e.jsx("div",{className:"md:col-span-2 mb-2",children:e.jsxs("div",{className:En("flex items-center gap-3 text-sm font-semibold",s?"text-purple-200":"text-purple-800"),children:[e.jsx("div",{className:En("w-8 h-8 rounded-lg flex items-center justify-center text-lg",s?"bg-purple-800/40 text-purple-200":"bg-purple-200/60 text-purple-700"),children:"🏭"}),e.jsx("span",{children:"معلومات المخبر"}),e.jsx("button",{type:"button",onClick:$,className:En("text-xs px-2 py-1 rounded hover:scale-105 transition-all",s?"bg-purple-700/50 text-purple-200 hover:bg-purple-600/50":"bg-purple-200 text-purple-700 hover:bg-purple-300"),title:"إعادة تحميل بيانات المخبر وربط الطلبات غير المرتبطة",children:"🔄"}),e.jsx("button",{type:"button",onClick:async()=>{await linkUnlinkedLabOrder(t.id)?await $():Kc.info("لا توجد طلبات مخبر غير مرتبطة لهذا المريض")},className:En("text-xs px-2 py-1 rounded hover:scale-105 transition-all",s?"bg-blue-700/50 text-blue-200 hover:bg-blue-600/50":"bg-blue-200 text-blue-700 hover:bg-blue-300"),title:"ربط طلبات المخبر غير المرتبطة",children:"🔗"}),e.jsx("div",{className:En("h-px flex-1 ml-2",s?"bg-purple-700/30":"bg-purple-300/50")})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(Yr,{className:En("font-medium flex items-center gap-2 text-sm",s?"text-purple-100":"text-purple-900"),children:["🏭 اختيار المخبر",!k&&e.jsx("span",{className:"text-xs animate-pulse",children:"⏳ جاري التحميل..."})]}),e.jsxs(Nl,{value:j,onValueChange:w,children:[e.jsx(Sl,{className:En("border-2 transition-all duration-200 h-11",s?"border-purple-700/50 bg-purple-950/40 hover:border-purple-600 focus:border-purple-500 text-purple-100":"border-purple-300/70 bg-white hover:border-purple-400 focus:border-purple-500 text-purple-900"),children:e.jsx(kl,{placeholder:"اختر المخبر"})}),e.jsx(Dl,{className:En(s?"bg-purple-950 border-purple-700":"bg-white border-purple-200"),children:c.map(t=>e.jsx(Al,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"🏭"}),e.jsx("span",{children:t.name})]})},t.id))})]},`lab-select-${t.id}-${j}`)]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Yr,{className:En("font-medium flex items-center gap-2 text-sm",s?"text-purple-100":"text-purple-900"),children:"💰 تكلفة المخبر ($)"}),e.jsx(Ir,{type:"number",min:"0",step:"0.1",value:N||"",onChange:e=>{e.stopPropagation();const t=e.target.value;_(""===t?0:parseFloat(t)||0)},onBlur:e=>{e.stopPropagation();const t=parseFloat(e.target.value)||0;_(t)},onInput:e=>{e.stopPropagation(),e.nativeEvent&&e.nativeEvent.stopImmediatePropagation&&e.nativeEvent.stopImmediatePropagation()},onKeyDown:e=>{if("Escape"===e.key)return e.preventDefault(),void _(0);["Backspace","Delete","Tab","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","."].includes(e.key)||e.key>="0"&&e.key<="9"||e.ctrlKey&&["a","c","v","x","z"].includes(e.key.toLowerCase())||e.preventDefault()},placeholder:"0.00",className:En("border-2 transition-all duration-200 h-11",s?"border-purple-700/50 bg-purple-950/40 hover:border-purple-600 focus:border-purple-500 text-purple-100 placeholder:text-purple-400":"border-purple-300/70 bg-white hover:border-purple-400 focus:border-purple-500 text-purple-900 placeholder:text-purple-500")},`lab-cost-${t.id}-${N}`),N>0&&e.jsxs("div",{className:En("flex items-center gap-2 text-xs p-2 rounded-lg",s?"bg-purple-800/30 text-purple-200 border border-purple-700/30":"bg-purple-100/70 text-purple-700 border border-purple-200/50"),children:[e.jsx("span",{className:"text-sm",children:"✨"}),e.jsx("span",{children:"سيتم تحديث طلب المخبر تلقائياً"})]})]})]}),"completed"===g.treatment_status&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"تاريخ الإنجاز"}),e.jsx(Ir,{type:"date",value:g.completion_date||"",onChange:e=>f(t=>({...t,completion_date:e.target.value})),onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key)return e.preventDefault(),void e.stopPropagation()},onFocus:e=>e.stopPropagation(),onClick:e=>e.stopPropagation(),"data-prevent-shortcuts":"true"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"ملاحظات"}),e.jsx(wl,{value:g.notes||"",onChange:e=>f(t=>({...t,notes:e.target.value})),placeholder:"أدخل أي ملاحظات إضافية...",rows:3,onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key)return e.preventDefault(),void e.stopPropagation()},onFocus:e=>e.stopPropagation(),onClick:e=>e.stopPropagation(),"data-prevent-shortcuts":"true"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(Lr,{variant:"outline",onClick:a,children:[e.jsx(_r,{className:"w-4 h-4 ml-2"}),"إلغاء"]}),e.jsxs(Lr,{onClick:async()=>{if(g.treatment_type)if("التعويضات"===v&&N>0&&!j)Kc.error("يرجى اختيار المخبر عند إدخال تكلفة المخبر");else try{const s={...g,treatment_color:_a(g.treatment_type)?.color||t.treatment_color};await n(t.id,s);const c=g.cost||0;if(c!==(b||0)&&await(async()=>{try{if(!o.find(e=>e.id===t.patient_id))return void Kc.error("لم يتم العثور على بيانات المريض");const e=l(t.patient_id).filter(e=>e.tooth_treatment_id===t.id),n=_a(g.treatment_type),a=`علاج ${n?.label||g.treatment_type} - سن ${t.tooth_name||t.tooth_number}`;if(e.length>0){const n=e.reduce((e,t)=>e+t.amount,0),s=g.cost||0,r=Math.max(0,s-n);let l;l=s<=0||r<=0&&n>0?"completed":n>0?"partial":"pending";for(const o of e){const e={tooth_treatment_id:t.id,description:a,notes:`دفعة لعلاج سن ${t.tooth_name||t.tooth_number} (تم تعديل التكلفة)`,total_amount_due:s,remaining_balance:r,treatment_total_cost:s,treatment_total_paid:n,treatment_remaining_balance:r,status:l};await i(o.id,e)}Kc.success("تم تحديث المدفوعات المرتبطة بالعلاج")}else if((g.cost||0)>0){const e={patient_id:t.patient_id,tooth_treatment_id:t.id,amount:0,payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:a,status:"pending",notes:`دفعة معلقة لعلاج سن ${t.tooth_name||t.tooth_number} (تم تعديل التكلفة)`,total_amount_due:g.cost||0,amount_paid:0,remaining_balance:g.cost||0,treatment_total_cost:g.cost||0,treatment_total_paid:0,treatment_remaining_balance:g.cost||0};await r(e),Kc.success("تم إنشاء دفعة معلقة في جدول المدفوعات")}}catch(e){console.error("خطأ في تحديث المدفوعات:",e),Kc.error("فشل في تحديث المدفوعات")}})(),"التعويضات"===v)if(N>0&&j){const n=await C(t.id),a=_a(g.treatment_type),s=`${a?.label||g.treatment_type||"علاج تعويضات"} - السن ${t.tooth_number}`;if(n)try{await p(n.id,{lab_id:j,cost:N,service_name:s,remaining_balance:N-(n.paid_amount||0)}),Kc.success("تم تحديث طلب المختبر بنجاح")}catch(e){Kc.error("فشل في تحديث طلب المختبر")}else try{await m({lab_id:j,patient_id:t.patient_id,tooth_treatment_id:t.id,tooth_number:t.tooth_number,service_name:s,cost:N,order_date:(new Date).toISOString().split("T")[0],status:"معلق",paid_amount:0,remaining_balance:N}),Kc.success("تم إنشاء طلب المختبر بنجاح")}catch(e){Kc.error("فشل في إنشاء طلب المختبر")}}else{const n=await C(t.id);if(n)try{await h(n.id),Kc.info("تم حذف طلب المختبر")}catch(e){Kc.error("فشل في حذف طلب المختبر")}}else{const n=await C(t.id);if(n)try{await h(n.id),Kc.info("تم حذف طلب المختبر لتغيير تصنيف العلاج")}catch(e){Kc.error("فشل في حذف طلب المختبر")}}a()}catch(e){console.error("Error updating treatment:",e),Kc.error("فشل في حفظ التغييرات")}else Kc.error("يرجى اختيار نوع العلاج")},className:"bg-orange-600 hover:bg-orange-700",children:[e.jsx(er,{className:"w-4 h-4 ml-2"}),"حفظ التغييرات"]})]})]})}const eD=({imagePath:t,alt:n="Dental image",className:a="",onLoad:s,onError:r})=>{const{isDarkMode:i}=sa(),[l,o]=re.useState(null),[c,d]=re.useState(!0),[m,u]=re.useState(!1);return re.useEffect(()=>{let e=!0;return(async()=>{if(!t)return u(!0),void d(!1);try{if(d(!0),u(!1),window.electronAPI&&window.electronAPI.files&&window.electronAPI.files.getDentalImage){console.log("Loading dental image:",t);const n=await window.electronAPI.files.getDentalImage(t);e&&(o(n),d(!1),s?.())}else console.warn("Electron API not available for image loading"),e&&(u(!0),d(!1),r?.())}catch(n){console.error("Error loading dental image:",n),e&&(u(!0),d(!1),r?.())}})(),()=>{e=!1}},[t,s,r]),c?e.jsx("div",{className:En("flex items-center justify-center",i?"bg-gray-800":"bg-gray-100",a),children:e.jsx("div",{className:"animate-pulse",children:e.jsx(Ss,{className:En("w-6 h-6",i?"text-gray-500":"text-gray-400")})})}):m||!l?e.jsx("div",{className:En("flex items-center justify-center",i?"bg-gray-800":"bg-gray-100",a),children:e.jsxs("div",{className:En("text-center",i?"text-gray-500":"text-gray-400"),children:[e.jsx(Ss,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("div",{className:"text-xs",children:"فشل في تحميل الصورة"})]})}):e.jsx("img",{src:l,alt:n,className:a,onLoad:s,onError:()=>{u(!0),r?.()}})};function tD({open:t,onOpenChange:n,patientId:a,toothNumber:s,isPrimaryTeeth:r=!1,onSessionStatsUpdate:i,onTreatmentUpdate:l}){const{patients:o}=bt(),{toothTreatments:c,images:d,toothTreatmentImages:m,loadToothTreatmentsByTooth:u,loadImagesByTreatment:p,loadToothTreatmentImagesByTooth:h,loadAllToothTreatmentImagesByPatient:x,createToothTreatment:g,updateToothTreatment:f,deleteToothTreatment:v,reorderToothTreatments:y,createToothTreatmentImage:b,deleteToothTreatmentImage:j,clearImages:w,clearToothTreatmentImages:N}=cc(),{isDarkMode:_}=sa(),[k,S]=re.useState(!1),[C,$]=re.useState("treatments"),[D,E]=re.useState([]),[T,A]=re.useState(""),[F,P]=re.useState(!1),[R,O]=re.useState(""),M=o.find(e=>e.id===a),L=s?ba(s,r):null,I=(c||[]).filter(e=>e.patient_id===a&&e.tooth_number===s);re.useEffect(()=>{t&&a&&s&&(u(a,s),h(a,s),w())},[t,a,s,u,h,w]),re.useEffect(()=>{const e=async()=>{t&&a&&s&&await u(a,s)};return window.addEventListener("tooth-color-update",e),()=>{window.removeEventListener("tooth-color-update",e)}},[t,a,s,u]);const z=e=>{window.electronAPI&&window.electronAPI.files&&window.electronAPI.files.openImagePreview?window.electronAPI.files.openImagePreview(e):window.open(`file://${e}`,"_blank")},B=e=>{const t=(m||[]).filter(t=>t.tooth_treatment_id===e&&t.tooth_number===s&&t.patient_id===a);return{beforeImages:t.filter(e=>"before"===e.image_type),afterImages:t.filter(e=>"after"===e.image_type)}},V=()=>I.filter(e=>{const{beforeImages:t,afterImages:n}=B(e.id);return t.length>0&&n.length>0}),Y=async(e,t)=>{try{if(window.electronAPI&&window.electronAPI.files&&window.electronAPI.files.uploadDentalImage){const n=await e.arrayBuffer(),r=Date.now(),i=e.name.split(".").pop()||"jpg",l=`${e.name.split(".")[0]}_${r}.${i}`,o=await window.electronAPI.files.uploadDentalImage(n,l,a,s||0,t,M?.full_name||"Unknown_Patient",L?.arabicName||`Tooth_${s}`);return console.log("Image uploaded successfully:",o),o}return console.warn("Electron API not available, using public/upload fallback"),await q(e,t)}catch(n){throw console.error("Error uploading image:",n),new Error("فشل في رفع الصورة")}},q=async(e,t)=>{try{const n=new FileReader;return new Promise((r,i)=>{n.onload=async()=>{try{const i=n.result;if(window.electronAPI&&window.electronAPI.files&&window.electronAPI.files.saveDentalImage){const n=Date.now(),l=e.name.split(".").pop()||"jpg",o=`${e.name.split(".")[0]}_${n}.${l}`,c=await window.electronAPI.files.saveDentalImage(i,o,a,s||0,t,M?.full_name||"Unknown_Patient",L?.arabicName||`Tooth_${s}`);console.log("Image saved via Electron API:",c),r(c)}else{const n=Date.now(),a=e.name.split(".").pop()||"jpg",i=(M?.full_name||"Unknown_Patient").replace(/[^a-zA-Z0-9\u0600-\u06FF\s]/g,"").replace(/\s+/g,"_"),l=((L?.arabicName||`Tooth_${s}`).replace(/[^a-zA-Z0-9\u0600-\u06FF\s]/g,"").replace(/\s+/g,"_"),`${e.name.split(".")[0]}_${n}.${a}`),o=`dental_images/${i}/${t||"other"}/${l}`;console.log("Using fallback path:",o),r(o)}}catch(l){console.error("Error in saveImageToPublicUpload:",l),i(l)}},n.onerror=()=>{console.error("Error reading file"),i(new Error("فشل في قراءة الملف"))},n.readAsDataURL(e)})}catch(n){throw console.error("Error in saveImageToPublicUpload:",n),new Error("فشل في حفظ الصورة")}},U=async e=>{if(window.confirm("هل أنت متأكد من حذف هذه الصورة؟"))try{S(!0),await j(e),await x(a),Kc.success("تم حذف الصورة بنجاح")}catch(t){Kc.error("فشل في حذف الصورة"),console.error("Error deleting image:",t)}finally{S(!1)}};if(!L)return null;const H=(()=>{const e=I.length,t=I.filter(e=>"completed"===e.treatment_status).length,n=I.filter(e=>"in_progress"===e.treatment_status).length,a=I.filter(e=>"planned"===e.treatment_status).length,s=I.filter(e=>"cancelled"===e.treatment_status).length;return{total:e,completed:t,inProgress:n,planned:a,cancelled:s}})();return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center gap-3 text-right",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg border-2 border-white shadow-md flex items-center justify-center",style:{backgroundColor:(()=>{if(0===I.length)return"#22c55e";const e=I.every(e=>"completed"===e.treatment_status);if(e)return"#22c55e";const t=[...I].sort((e,t)=>e.priority-t.priority),n=t.find(e=>"in_progress"===e.treatment_status)||t.find(e=>"planned"===e.treatment_status)||t[0];return n?.treatment_color||"#22c55e"})()},children:e.jsx("span",{className:"text-white font-bold text-sm",children:s})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold",children:["تفاصيل السن رقم ",s]}),e.jsx("p",{className:"text-base text-muted-foreground",children:L.arabicName})]}),H.total>0&&e.jsxs(oc,{variant:"secondary",className:"mr-auto",children:[e.jsx(Es,{className:"w-4 h-4 ml-1"}),H.total," علاج"]})]}),e.jsxs(Fr,{className:"text-right",children:["المريض: ",M?.full_name]}),H.total>0&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[H.completed>0&&e.jsxs(oc,{variant:"secondary",className:"bg-green-100 text-green-800",children:[e.jsx(ns,{className:"w-3 h-3 ml-1"}),H.completed," مكتمل"]}),H.inProgress>0&&e.jsxs(oc,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:[e.jsx(Va,{className:"w-3 h-3 ml-1"}),H.inProgress," قيد التنفيذ"]}),H.planned>0&&e.jsxs(oc,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:[e.jsx(us,{className:"w-3 h-3 ml-1"}),H.planned," مخطط"]}),H.cancelled>0&&e.jsxs(oc,{variant:"secondary",className:"bg-gray-100 text-gray-800",children:[e.jsx(Ya,{className:"w-3 h-3 ml-1"}),H.cancelled," ملغي"]})]})]}),e.jsxs(Ud,{value:C,onValueChange:$,className:"w-full",dir:"rtl",children:[e.jsxs(Hd,{className:"grid w-full grid-cols-3",children:[e.jsxs(Gd,{value:"treatments",className:"flex items-center gap-2",children:[e.jsx(rr,{className:"w-4 h-4"}),"العلاجات النشطة"]}),e.jsxs(Gd,{value:"completed",className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"العلاجات المكتملة (",H.completed,")"]}),e.jsxs(Gd,{value:"images",className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4"}),"الصور (",(m||[]).filter(e=>e.tooth_number===s&&e.patient_id===a).length,")"]})]}),e.jsx(Wd,{value:"treatments",className:"space-y-4",dir:"rtl",children:e.jsx(X$,{patientId:a,toothNumber:s,toothName:L.arabicName,treatments:I.filter(e=>"completed"!==e.treatment_status),onAddTreatment:async e=>{try{S(!0);const t=await g(e);return Kc.success("تم إضافة العلاج بنجاح"),l?.(),t}catch(t){return Kc.error("فشل في إضافة العلاج"),console.error("Error adding treatment:",t),null}finally{S(!1)}},onUpdateTreatment:async(e,t)=>{try{if(S(!0),console.log("🦷 Dialog: Updating treatment:",e,t),await f(e,t),console.log("🦷 Dialog: Treatment updated in store"),s)try{await u(a,s),console.log("🦷 Dialog: Tooth treatments reloaded")}catch(n){console.warn("🦷 Dialog: Failed to reload tooth treatments, but update was successful:",n)}return l?.(),console.log("🦷 Dialog: Treatment updated successfully"),Kc.success("تم تحديث العلاج بنجاح"),Promise.resolve()}catch(r){throw console.error("🦷 Dialog: Error updating treatment:",r),Kc.error("فشل في تحديث العلاج"),r}finally{S(!1)}},onDeleteTreatment:async e=>{try{S(!0),await v(e),Kc.success("تم حذف العلاج بنجاح"),l?.()}catch(t){Kc.error("فشل في حذف العلاج"),console.error("Error deleting treatment:",t)}finally{S(!1)}},onReorderTreatments:async e=>{if(s)try{S(!0);const t=c.filter(e=>e.patient_id===a&&e.tooth_number===s);console.log("Reordering treatments:",{patientId:a,toothNumber:s,treatmentIds:e,currentTreatments:t.map(e=>({id:e.id,priority:e.priority}))}),await y(a,s,e),await u(a,s),Kc.success("تم إعادة ترتيب العلاجات بنجاح")}catch(t){Kc.error("فشل في إعادة ترتيب العلاجات"),console.error("Error reordering treatments:",t),await u(a,s)}finally{S(!1)}},onSessionStatsUpdate:i,onTreatmentUpdate:l})}),e.jsx(Wd,{value:"completed",className:"space-y-4",dir:"rtl",children:e.jsxs(nc,{children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:En("w-5 h-5",_?"text-green-400":"text-green-600")}),"العلاجات المكتملة"]}),e.jsx(rc,{children:"جميع العلاجات التي تم إكمالها لهذا السن"})]}),e.jsx(ic,{children:0===I.filter(e=>"completed"===e.treatment_status).length?e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(ns,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد علاجات مكتملة لهذا السن"}),e.jsx("p",{className:"text-sm",children:"العلاجات المكتملة ستظهر هنا"})]}):e.jsx("div",{className:"space-y-3",children:I.filter(e=>"completed"===e.treatment_status).sort((e,t)=>e.priority-t.priority).map(t=>e.jsx(nc,{className:En("transition-all duration-200 hover:shadow-md",_?"border-green-700/50 bg-green-950/30 hover:bg-green-950/40":"border-green-200 bg-green-50 hover:bg-green-100/50"),children:e.jsxs(ic,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:En("w-4 h-4 rounded-full border",_?"border-white/30":"border-white/50"),style:{backgroundColor:t.treatment_color}}),e.jsxs("div",{children:[e.jsx("h4",{className:En("font-medium",_?"text-green-200":"text-green-800"),children:_a(t.treatment_type)?.label||t.treatment_type}),e.jsxs("p",{className:En("text-sm",_?"text-green-300":"text-green-600"),children:["الأولوية: ",t.priority]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs(oc,{variant:"secondary",className:En("transition-colors",_?"bg-green-900/50 text-green-200 border-green-700/50":"bg-green-100 text-green-800 border-green-200"),children:[e.jsx(ns,{className:"w-3 h-3 ml-1"}),"مكتمل"]}),t.completion_date&&e.jsxs("p",{className:En("text-xs mt-1",_?"text-green-300":"text-green-600"),children:["تاريخ الإكمال: ",(()=>{const e=new Date(t.completion_date);return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`})()]})]})]}),t.notes&&e.jsxs("div",{className:En("mt-3 p-3 rounded-lg text-sm transition-colors",_?"bg-green-900/30 text-green-200 border border-green-700/30":"bg-green-100 text-green-700 border border-green-200"),children:[e.jsx("strong",{children:"ملاحظات:"})," ",t.notes]}),t.cost&&e.jsx("div",{className:En("mt-3 p-3 rounded-lg text-sm font-medium transition-colors",_?"bg-blue-900/30 text-blue-200 border border-blue-700/30":"bg-blue-50 text-blue-700 border border-blue-200"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"التكلفة:"}),e.jsx(rh,{amount:t.cost,className:"font-semibold"})]})})]})},t.id))})})]})}),e.jsxs(Wd,{value:"images",className:"space-y-4",dir:"rtl",children:[e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(hr,{className:"w-5 h-5"}),"رفع صور جديدة"]})}),e.jsxs(ic,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"treatment-select",children:"ربط الصور بعلاج محدد (اختياري)"}),e.jsxs(Nl,{value:T,onValueChange:A,children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر علاج لربط الصور به (أو اتركه فارغاً)"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"none",children:"بدون ربط بعلاج محدد"}),(c||[]).filter(e=>e.patient_id===a&&e.tooth_number===s).map(t=>e.jsxs(Al,{value:t.id,children:[_a(t.treatment_type)?.label||t.treatment_type," - ","completed"===t.treatment_status?"مكتمل":"in_progress"===t.treatment_status?"قيد التنفيذ":"planned"===t.treatment_status?"مخطط":"ملغي"]},t.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"اختر نوع الصورة لرفعها"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:$a.map(t=>e.jsx(Lr,{variant:"outline",className:"image-type-button h-auto p-4 flex flex-col items-center gap-2 min-h-[80px] border-2 border-dashed hover:border-solid transition-all duration-200",asChild:!0,children:e.jsxs("label",{htmlFor:`image-upload-${t.value}`,className:"cursor-pointer w-full h-full flex flex-col items-center justify-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:t.label}),e.jsx("input",{id:`image-upload-${t.value}`,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:e=>((e,t)=>{const n=Array.from(e.target.files||[]).map(e=>({file:e,type:t,treatmentId:T&&"none"!==T?T:void 0}));E(e=>[...e,...n]),e.target.value=""})(e,t.value)})]})},t.value))})]}),D.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"الصور المحددة للرفع:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:D.map((t,n)=>e.jsxs("div",{className:"selected-image-preview relative group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(t.file),alt:`Preview ${n+1}`,className:"w-full h-24 object-cover rounded-lg border-2 border-dashed border-gray-300"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded-lg"}),e.jsx(Lr,{variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 w-6 h-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>(e=>{E(t=>t.filter((t,n)=>n!==e))})(n),children:e.jsx(_r,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"mt-1 text-xs text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("span",{children:$a.find(e=>e.value===t.type)?.icon}),e.jsx("span",{children:$a.find(e=>e.value===t.type)?.label})]}),t.treatmentId&&e.jsxs("div",{className:"text-blue-600 mt-1",children:["مربوط بعلاج: ",(()=>{const e=(c||[]).find(e=>e.id===t.treatmentId);return e?_a(e.treatment_type)?.label||e.treatment_type:"علاج"})()]})]})]},n))})]}),D.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"الصور المحددة للرفع:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:D.map((t,n)=>e.jsxs("div",{className:"relative",children:[e.jsxs(oc,{variant:"outline",className:"pr-6",children:[t.file.name," (",t.type,")",t.treatmentId&&e.jsxs("span",{className:"text-blue-600 ml-1",children:["- ",(()=>{const e=(c||[]).find(e=>e.id===t.treatmentId);return e?_a(e.treatment_type)?.label||e.treatment_type:"علاج"})()]})]}),e.jsx(Lr,{size:"sm",variant:"ghost",className:"absolute -top-1 -right-1 h-4 w-4 p-0",onClick:()=>E(e=>e.filter((e,t)=>t!==n)),children:e.jsx(_r,{className:"h-3 w-3"})})]},n))}),e.jsxs(Lr,{onClick:async()=>{if(0!==D.length)try{S(!0);for(const e of D){const t=await Y(e.file,e.type),n={tooth_treatment_id:e.treatmentId||null,patient_id:a,tooth_number:s,image_path:t,image_type:e.type,description:`${e.type} - السن رقم ${s}`,taken_date:(new Date).toISOString()};await b(n)}E([]),await x(a),Kc.success("تم حفظ الصور بنجاح")}catch(e){Kc.error("فشل في حفظ الصور"),console.error("Error saving images:",e)}finally{S(!1)}},disabled:k,className:"w-full",children:[e.jsx(hr,{className:"w-4 h-4 ml-2"}),"حفظ الصور (",D.length,")"]})]})]})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center gap-2 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"w-5 h-5"}),"الصور المحفوظة (",(m||[]).filter(e=>e.tooth_number===s&&e.patient_id===a).length,")"]}),V().length>0&&e.jsxs(Lr,{variant:"outline",size:"sm",onClick:()=>P(!F),className:"flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4"}),F?"إخفاء المقارنة":"مقارنة"]})]})}),e.jsxs(ic,{children:[F&&V().length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-green-50 dark:from-gray-900 dark:to-gray-800 rounded-lg border border-blue-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ws,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100",children:"مقارنة الصور"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 mb-4",children:[e.jsx(Yr,{htmlFor:"comparison-treatment",className:"text-sm font-medium text-gray-700 dark:text-gray-200 whitespace-nowrap",children:"اختر العلاج للمقارنة:"}),e.jsxs(Nl,{value:R,onValueChange:O,children:[e.jsx(Sl,{className:"w-full sm:w-64 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-500 text-gray-900 dark:text-gray-100",children:e.jsx(kl,{placeholder:"اختر العلاج..."})}),e.jsx(Dl,{className:"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-500",children:V().map(t=>e.jsx(Al,{value:t.id,className:"text-gray-900 dark:text-gray-100 dark:hover:bg-gray-600",children:_a(t.treatment_type)?.label||t.treatment_type},t.id))})]})]}),!R&&e.jsx("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx(ws,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"اختر علاجاً من القائمة أعلاه لعرض المقارنة"})]})}),R&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:(()=>{const{beforeImages:t,afterImages:n}=B(R);return I.find(e=>e.id===R),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-center text-green-700 dark:text-green-300 flex items-center justify-center gap-2 bg-green-100 dark:bg-green-900/50 py-2 px-4 rounded-lg",children:[e.jsx("span",{className:"w-3 h-3 bg-green-500 dark:bg-green-400 rounded-full shadow-sm"}),"قبل العلاج"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:t.map(t=>e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-lg border-2 border-green-300 dark:border-green-600 shadow-md hover:shadow-lg transition-shadow",children:[e.jsx(eD,{imagePath:t.image_path,alt:"قبل العلاج",className:"w-full h-48 object-cover"}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Lr,{variant:"secondary",size:"sm",className:"w-8 h-8 p-0 bg-black/80 hover:bg-black/95 text-white border-2 border-white/30 hover:border-white/80 rounded-full backdrop-blur-sm shadow-lg transition-all duration-300",onClick:()=>z(t.image_path),children:e.jsx(ys,{className:"w-4 h-4"})})})]}),t.taken_date&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 text-center mt-1 bg-white dark:bg-gray-700 rounded px-2 py-1 shadow-sm",children:new Date(t.taken_date).toLocaleDateString("en-GB")})]},t.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-center text-blue-700 dark:text-blue-300 flex items-center justify-center gap-2 bg-blue-100 dark:bg-blue-900/50 py-2 px-4 rounded-lg",children:[e.jsx("span",{className:"w-3 h-3 bg-blue-500 dark:bg-blue-400 rounded-full shadow-sm"}),"بعد العلاج"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:n.map(t=>e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-lg border-2 border-blue-300 dark:border-blue-600 shadow-md hover:shadow-lg transition-shadow",children:[e.jsx(eD,{imagePath:t.image_path,alt:"بعد العلاج",className:"w-full h-48 object-cover"}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Lr,{variant:"secondary",size:"sm",className:"w-8 h-8 p-0 bg-black/80 hover:bg-black/95 text-white border-2 border-white/30 hover:border-white/80 rounded-full backdrop-blur-sm shadow-lg transition-all duration-300",onClick:()=>z(t.image_path),children:e.jsx(ys,{className:"w-4 h-4"})})})]}),t.taken_date&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 text-center mt-1 bg-white dark:bg-gray-700 rounded px-2 py-1 shadow-sm",children:new Date(t.taken_date).toLocaleDateString("en-GB")})]},t.id))})]})]})})()}),R&&e.jsx("div",{className:"mt-4 p-3 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm",children:e.jsxs("p",{className:"text-sm text-center text-gray-700 dark:text-gray-200",children:[e.jsx("strong",{className:"text-gray-900 dark:text-white",children:"العلاج:"})," ",(()=>{const e=I.find(e=>e.id===R);return e?_a(e.treatment_type)?.label||e.treatment_type:""})()]})})]}),0===(m||[]).filter(e=>e.tooth_number===s&&e.patient_id===a).length?e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(ts,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لا توجد صور محفوظة لهذا السن"}),e.jsx("p",{className:"text-sm",children:"قم برفع صور جديدة باستخدام النموذج أعلاه"})]}):e.jsxs("div",{className:"space-y-6",children:[I.map(t=>{const n=(m||[]).filter(e=>e.tooth_treatment_id===t.id&&e.tooth_number===s&&e.patient_id===a);return 0===n.length?null:e.jsxs(nc,{className:"treatment-images-card border-2 border-blue-200 dark:border-blue-700",children:[e.jsx(ac,{className:"pb-3 bg-blue-50 dark:bg-blue-900/20",children:e.jsxs(sc,{className:"text-sm flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:_a(t.treatment_type)?.label||t.treatment_type}),e.jsxs(oc,{variant:"secondary",className:"mr-auto bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300",children:[n.length," صورة"]})]})}),e.jsx(ic,{className:"space-y-4",children:$a.map(t=>{const a=n.filter(e=>e.image_type===t.value);return 0===a.length?null:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"image-type-icon",children:t.icon}),e.jsx("span",{className:"image-type-label",children:t.label}),e.jsx(oc,{variant:"outline",className:"text-xs",children:a.length})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:a.map(n=>e.jsxs("div",{className:"saved-image-card group relative bg-card border border-border rounded-lg p-2 hover:shadow-lg transition-all duration-300",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-lg border border-border",children:[e.jsx(eD,{imagePath:n.image_path,alt:n.description||t.label,className:"w-full h-24 object-cover transition-transform group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all"}),e.jsxs("div",{className:"absolute top-2 right-2 flex flex-row items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[e.jsx(Lr,{variant:"secondary",size:"sm",className:"w-8 h-8 p-0 bg-black/80 hover:bg-black/95 text-white border-2 border-white/30 hover:border-white/80 rounded-full backdrop-blur-sm shadow-lg transition-all duration-300",onClick:()=>z(n.image_path),children:e.jsx(ys,{className:"w-4 h-4"})}),e.jsx(Lr,{variant:"destructive",size:"sm",className:"w-8 h-8 p-0 bg-red-500/90 hover:bg-red-500 dark:bg-red-600/90 dark:hover:bg-red-600 rounded-full shadow-lg transition-all duration-300",onClick:()=>U(n.id),children:e.jsx(dr,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"mt-2 space-y-1",children:n.taken_date&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 text-center bg-white dark:bg-gray-700 rounded px-2 py-1 shadow-sm",children:new Date(n.taken_date).toLocaleDateString("en-GB")})})]},n.id))})]},t.value)})})]},t.id)}),(()=>{const t=(m||[]).filter(e=>!e.tooth_treatment_id&&e.tooth_number===s&&e.patient_id===a);return 0===t.length?null:e.jsxs(nc,{className:"unassociated-images-card border-2 border-gray-200 dark:border-gray-600",children:[e.jsx(ac,{className:"pb-3 bg-gray-50 dark:bg-gray-800",children:e.jsxs(sc,{className:"text-sm flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-gray-500 rounded-full"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"صور غير مرتبطة بعلاج محدد"}),e.jsxs(oc,{variant:"secondary",className:"mr-auto",children:[t.length," صورة"]})]})}),e.jsx(ic,{className:"space-y-4",children:$a.map(n=>{const a=t.filter(e=>e.image_type===n.value);return 0===a.length?null:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"image-type-icon",children:n.icon}),e.jsx("span",{className:"image-type-label",children:n.label}),e.jsx(oc,{variant:"outline",className:"text-xs",children:a.length})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:a.map(t=>e.jsxs("div",{className:"saved-image-card group relative bg-card border border-border rounded-lg p-2 hover:shadow-lg transition-all duration-300",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-lg border border-border",children:[e.jsx(eD,{imagePath:t.image_path,alt:t.description||n.label,className:"w-full h-24 object-cover transition-transform group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all"}),e.jsxs("div",{className:"absolute top-2 right-2 flex flex-row items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[e.jsx(Lr,{variant:"secondary",size:"sm",className:"w-8 h-8 p-0 bg-black/80 hover:bg-black/95 text-white border-2 border-white/30 hover:border-white/80 rounded-full backdrop-blur-sm shadow-lg transition-all duration-300",onClick:()=>z(t.image_path),children:e.jsx(ys,{className:"w-4 h-4"})}),e.jsx(Lr,{variant:"destructive",size:"sm",className:"w-8 h-8 p-0 bg-red-500/90 hover:bg-red-500 dark:bg-red-600/90 dark:hover:bg-red-600 rounded-full shadow-lg transition-all duration-300",onClick:()=>U(t.id),children:e.jsx(dr,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"mt-2 space-y-1",children:t.taken_date&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 text-center bg-white dark:bg-gray-700 rounded px-2 py-1 shadow-sm",children:new Date(t.taken_date).toLocaleDateString("en-GB")})})]},t.id))})]},n.value)})})]})})()]})]})]})]})]})]})})}function nD({patients:t,selectedPatientId:n,onPatientSelect:a,getPatientTreatmentCount:s,getLastTreatmentDate:r,getPatientImagesCount:i,isLoading:l=!1,isCompact:o=!1}){const[c,d]=re.useState(null),[m,u]=re.useState(null),[p,h]=re.useState(1),[x,g]=re.useState(o?5:10),[f,v]=re.useState(!1),y=re.useMemo(()=>o&&n&&!f?t.filter(e=>e.id===n):t,[t,o,n,f]),b=re.useMemo(()=>{let e=y;c&&m&&(e=[...y].sort((e,t)=>{let n=e[c],a=t[c];return null==n&&null==a?0:null==n?"asc"===m?1:-1:null==a?"asc"===m?-1:1:(n=String(n).toLowerCase(),a=String(a).toLowerCase(),n<a?"asc"===m?-1:1:n>a?"asc"===m?1:-1:0)}));const t=(p-1)*x,n=t+x;return{patients:e.slice(t,n),totalPages:Math.ceil(e.length/x),totalCount:e.length}},[y,c,m,p,x]),j=t=>c!==t?e.jsx(Ga,{className:"w-4 h-4 opacity-50"}):"asc"===m?e.jsx(Wa,{className:"w-4 h-4"}):"desc"===m?e.jsx(Ua,{className:"w-4 h-4"}):e.jsx(Ga,{className:"w-4 h-4 opacity-50"}),w=({field:t,children:n})=>e.jsx(Uc,{className:"cursor-pointer hover:bg-muted/50 select-none text-center",onClick:()=>(e=>{c===e?"asc"===m?u("desc"):"desc"===m?(d(null),u(null)):u("asc"):(d(e),u("asc"))})(t),children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 space-x-reverse",children:[e.jsx("span",{children:n}),j(t)]})});if(l)return e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Bc,{className:"table-center-all",children:[e.jsx(Vc,{children:e.jsxs(qc,{className:"bg-muted/50",children:[e.jsx(Uc,{className:"text-center w-16",children:"#"}),e.jsx(Uc,{className:"text-center",children:"اسم المريض"}),e.jsx(Uc,{className:"text-center",children:"الجنس"}),e.jsx(Uc,{className:"text-center",children:"العمر"}),e.jsx(Uc,{className:"text-center",children:"رقم الهاتف"}),e.jsx(Uc,{className:"text-center",children:"عدد العلاجات"}),e.jsx(Uc,{className:"text-center",children:"آخر زيارة"}),e.jsx(Uc,{className:"text-center",children:"الإجراءات"})]})}),e.jsx(Yc,{children:[...Array(5)].map((t,n)=>e.jsx(qc,{children:[...Array(8)].map((t,n)=>e.jsx(Hc,{children:e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded"})},n))},n))})]})});if(0===t.length)return e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(yr,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"لا توجد مرضى مطابقين لبحثك"})]});const{patients:N,totalPages:_,totalCount:k}=b,S=(p-1)*x,C=e=>{h(e)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-muted/30 dark:bg-muted/50 px-4 py-2 border border-border rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["عرض ",N.length," من أصل ",k," مريض"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[n&&e.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:["المريض المحدد: ",t.find(e=>e.id===n)?.full_name]}),o&&n&&e.jsx(Lr,{variant:"outline",size:"sm",onClick:()=>v(!f),className:"text-xs",children:f?"إخفاء المرضى الآخرين":"عرض جميع المرضى"})]})]})}),e.jsx("div",{className:"border border-border rounded-b-lg overflow-hidden bg-card dark:bg-card",children:e.jsx("div",{className:"overflow-x-auto bg-card dark:bg-card",children:e.jsxs(Bc,{className:"table-center-all bg-card dark:bg-card",children:[e.jsx(Vc,{className:"bg-muted/50 dark:bg-muted/70",children:e.jsxs(qc,{className:"bg-muted/50 dark:bg-muted/70 border-b border-border hover:bg-muted/50 dark:hover:bg-muted/70",children:[e.jsx(Uc,{className:"text-center w-16 text-foreground",children:e.jsx("span",{className:"font-medium",children:"#"})}),e.jsx(w,{field:"full_name",children:e.jsx("span",{className:"font-medium",children:"اسم المريض"})}),e.jsx(w,{field:"gender",children:e.jsx("span",{className:"font-medium",children:"الجنس"})}),e.jsx(w,{field:"age",children:e.jsx("span",{className:"font-medium",children:"العمر"})}),e.jsx(w,{field:"phone",children:e.jsx("span",{className:"font-medium",children:"رقم الهاتف"})}),e.jsx(Uc,{className:"text-center text-foreground",children:e.jsx("span",{className:"font-medium",children:"عدد العلاجات"})}),e.jsx(Uc,{className:"text-center text-foreground",children:e.jsx("span",{className:"font-medium",children:"آخر زيارة"})}),e.jsx(Uc,{className:"text-center text-foreground",children:e.jsx("span",{className:"font-medium",children:"الإجراءات"})})]})}),e.jsx(Yc,{className:"bg-card dark:bg-card",children:N.map((t,l)=>e.jsxs(qc,{className:"hover:bg-muted/50 dark:hover:bg-muted/70 transition-colors border-b border-border "+(n===t.id?"bg-blue-100/30 dark:bg-blue-900/20 border-blue-300/50 dark:border-blue-600/50":"bg-card dark:bg-card"),children:[e.jsx(Hc,{className:"font-medium text-muted-foreground",children:S+l+1}),e.jsx(Hc,{className:"font-medium table-cell-wrap-truncate-md",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:t.full_name.charAt(0)}),e.jsx("span",{className:"text-foreground",children:t.full_name})]})}),e.jsx(Hc,{children:e.jsx(oc,{variant:"male"===t.gender?"default":"secondary",children:"male"===t.gender?"ذكر":"أنثى"})}),e.jsx(Hc,{children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(es,{className:"w-3 h-3 text-muted-foreground"}),e.jsxs("span",{className:"text-foreground",children:[t.age," سنة"]})]})}),e.jsx(Hc,{className:"table-cell-wrap-truncate-sm",children:t.phone?e.jsxs("a",{href:`https://wa.me/${t.phone?.replace(/\D/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 dark:text-green-400 hover:underline flex items-center justify-center gap-1",children:[e.jsx(Hs,{className:"w-3 h-3"}),t.phone]}):e.jsx("span",{className:"text-muted-foreground",children:"غير محدد"})}),e.jsx(Hc,{children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(oc,{variant:"outline",className:"bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-600",children:[e.jsx(Va,{className:"w-3 h-3 ml-1"}),s(t.id)," علاج"]}),i&&i(t.id)>0&&e.jsxs(oc,{variant:"outline",className:"bg-green-50 dark:bg-green-900 text-green-700 dark:text-green-300 border-green-200 dark:border-green-600",children:[e.jsx(ts,{className:"w-3 h-3 ml-1"}),i(t.id)," صورة"]})]})}),e.jsx(Hc,{children:r(t.id)?e.jsx("span",{className:"text-xs text-muted-foreground",children:In(r(t.id))}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"لا توجد زيارات"})}),e.jsx(Hc,{children:e.jsx(Lr,{size:"sm",variant:n===t.id?"default":"outline",onClick:()=>a(t.id),className:"text-xs "+(n===t.id?"bg-primary text-primary-foreground":"border-border hover:bg-muted"),children:n===t.id?"محدد":"اختيار"})})]},t.id))})]})})}),k>x&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-2 bg-background dark:bg-card border border-border rounded-lg",children:[e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["عرض ",(p-1)*x+1," إلى ",Math.min(p*x,k)," من ",k," مريض"]})}),e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"عدد الصفوف لكل صفحة"}),e.jsxs(Nl,{value:`${x}`,onValueChange:e=>{g(parseInt(e)),h(1)},children:[e.jsx(Sl,{className:"h-8 w-[70px] border-border",children:e.jsx(kl,{placeholder:x})}),e.jsx(Dl,{side:"top",children:[5,10,15,20].map(t=>e.jsx(Al,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium text-foreground",children:["صفحة ",p," من ",_]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(1),disabled:1===p,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(cs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(p-1),disabled:1===p,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(is,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>C(p+1),disabled:p===_,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(rs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>C(_),disabled:p===_,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(os,{className:"h-4 w-4"})]})]})]})]})]})}function aD({open:t,onOpenChange:n,patientId:a,selectedTeeth:s,onAddTreatments:r}){sa();const{labs:i,loadLabs:l}=HC(),{createPayment:o}=ca(),{createLabOrder:c}=ph(),{patients:d}=bt(),[m,u]=re.useState(""),[p,h]=re.useState(""),[x,g]=re.useState(0),[f,v]=re.useState(!1),[y,b]=re.useState({patient_id:a,treatment_status:"planned",cost:0,start_date:(new Date).toISOString().split("T")[0]});re.useEffect(()=>{t&&l()},[t,l]);const j=async(e,t)=>{if(console.log("💰 [DEBUG] createPendingPaymentForTreatment called:",{treatmentId:e,cost:y.cost,patientId:a,toothNumber:t}),!e)throw console.error("❌ [DEBUG] Cannot create payment - missing treatment ID"),new Error("معرف العلاج مطلوب لإنشاء الدفعة");if(!y.cost||y.cost<=0)console.log("⚠️ [DEBUG] Skipping payment creation - no cost specified");else try{const n=d.find(e=>e.id===a);if(!n)throw new Error("لم يتم العثور على بيانات المريض");const s=_a(y.treatment_type),r=`${s?.label||y.treatment_type} - السن ${t}`,i={patient_id:a,tooth_treatment_id:e,amount:0,payment_method:"cash",payment_date:(new Date).toISOString().split("T")[0],description:r,status:"pending",notes:`دفعة معلقة للمريض: ${n.full_name} - السن ${t} - العلاج: ${s?.label||y.treatment_type}`,total_amount_due:y.cost,amount_paid:0,remaining_balance:y.cost,treatment_total_cost:y.cost,treatment_total_paid:0,treatment_remaining_balance:y.cost};console.log("💰 [DEBUG] Creating payment with data:",i),await o(i),console.log("✅ [DEBUG] Payment created successfully for treatment:",e)}catch(n){console.error("❌ [DEBUG] Payment creation failed:",n);const e=n instanceof Error?n.message:"خطأ غير معروف";throw Kc.error(`فشل في إنشاء الدفعة المعلقة للسن ${t}: ${e}`),n}},w=async(e,t)=>{console.log("🧪 [DEBUG] createLabOrderForTreatment called:",{treatmentId:e,labCost:x,selectedLab:p,patientId:a,toothNumber:t});try{const n=d.find(e=>e.id===a),s=_a(y.treatment_type);if(!n)throw new Error("لم يتم العثور على بيانات المريض");const r={lab_id:p,patient_id:a,tooth_treatment_id:e,tooth_number:t,service_name:`${s?.label||"علاج تعويضات"} - السن ${t}`,cost:x,order_date:(new Date).toISOString().split("T")[0],status:"معلق",notes:`طلب مخبر للمريض: ${n.full_name} - السن ${t} - العلاج: ${s?.label||y.treatment_type}`,paid_amount:0,remaining_balance:x};await c(r),console.log("✅ [DEBUG] Lab order created successfully for treatment:",e)}catch(n){console.error("❌ [DEBUG] Lab order creation failed:",n);const e=n instanceof Error?n.message:"خطأ غير معروف";throw Kc.error(`فشل في إنشاء طلب المختبر للسن ${t}: ${e}`),n}},N=()=>{b({patient_id:a,treatment_status:"planned",cost:0,start_date:(new Date).toISOString().split("T")[0]}),u(""),h(""),g(0)},_=m?Na(m):[];return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Va,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),"إضافة علاج للأسنان المحددة"]}),e.jsxs(Fr,{children:["إضافة نفس العلاج لجميع الأسنان المحددة (",s.length," سن)"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(nc,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx(ac,{className:"pb-3",children:e.jsx(sc,{className:"text-sm text-blue-700 dark:text-blue-300",children:"الأسنان المحددة"})}),e.jsx(ic,{className:"pt-0",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.sort((e,t)=>e-t).map(t=>e.jsxs(oc,{variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",children:["السن ",t]},t))})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"تصنيف العلاج"}),e.jsxs(Nl,{value:m,onValueChange:e=>{u(e),b(t=>({...t,treatment_category:e,treatment_type:""}))},children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر تصنيف العلاج"})}),e.jsx(Dl,{children:wa.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t.icon}),e.jsx("span",{children:t.label})]})},t.value))})]})]}),m&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"نوع العلاج"}),e.jsxs(Nl,{value:y.treatment_type||"",onValueChange:e=>{const t=_a(e);b(n=>({...n,treatment_type:e,treatment_color:t?.color||"#22c55e"}))},children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر نوع العلاج"})}),e.jsx(Dl,{children:_.map(t=>e.jsx(Al,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{children:t.label})]})},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"التكلفة"}),e.jsx(Ir,{type:"number",min:"0",step:"0.01",value:y.cost||"",onChange:e=>b(t=>({...t,cost:parseFloat(e.target.value)||0})),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"تاريخ البدء"}),e.jsx(Ir,{type:"date",value:y.start_date||"",onChange:e=>b(t=>({...t,start_date:e.target.value}))})]})]}),"التعويضات"===y.treatment_category&&e.jsxs(nc,{className:"bg-purple-50 dark:bg-purple-950/20 border-purple-200 dark:border-purple-800",children:[e.jsx(ac,{className:"pb-3",children:e.jsx(sc,{className:"text-sm text-purple-700 dark:text-purple-300",children:"معلومات المختبر"})}),e.jsx(ic,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"المختبر"}),e.jsxs(Nl,{value:p,onValueChange:h,children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر المختبر"})}),e.jsx(Dl,{children:i.map(t=>e.jsx(Al,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"تكلفة المختبر"}),e.jsx(Ir,{type:"number",min:"0",step:"0.01",value:x||"",onChange:e=>g(parseFloat(e.target.value)||0),placeholder:"0.00"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{children:"ملاحظات"}),e.jsx(wl,{value:y.notes||"",onChange:e=>b(t=>({...t,notes:e.target.value})),placeholder:"ملاحظات إضافية...",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(Lr,{variant:"outline",onClick:()=>n(!1),disabled:f,children:"إلغاء"}),e.jsx(Lr,{onClick:async()=>{if(y.treatment_type&&y.treatment_category)if("التعويضات"===y.treatment_category&&x>0&&!p)Kc.error("يرجى اختيار المختبر عند إدخال تكلفة المختبر للتعويضات");else{v(!0);try{let l=0,o=0,c=0;for(const n of s)try{console.log(`🦷 [DEBUG] Processing tooth ${n}`);const s={...y,patient_id:a,tooth_number:n,tooth_name:`السن ${n}`,treatment_type:y.treatment_type,treatment_category:y.treatment_category,treatment_color:y.treatment_color||"#22c55e",treatment_status:y.treatment_status||"planned",cost:y.cost||0,start_date:y.start_date,notes:y.notes,priority:1},i=await r([s]);if(!(i&&i.length>0))throw new Error(`فشل في إنشاء العلاج للسن ${n}`);{const a=i[0].id;if(l++,console.log(`✅ [DEBUG] Treatment created successfully for tooth ${n}:`,a),y.cost&&y.cost>0){console.log(`💰 [DEBUG] Creating payment for tooth ${n}`);try{await j(a,n),o++,console.log(`✅ [DEBUG] Payment created successfully for tooth ${n}`)}catch(e){console.error(`❌ [DEBUG] Payment creation failed for tooth ${n}:`,e),Kc.warning(`تم إنشاء العلاج للسن ${n} ولكن فشل في إنشاء الدفعة`)}}if("التعويضات"===y.treatment_category&&p&&x>0){console.log(`🧪 [DEBUG] Creating lab order for tooth ${n}`);try{await w(a,n),c++,console.log(`✅ [DEBUG] Lab order created successfully for tooth ${n}`)}catch(t){console.error(`❌ [DEBUG] Lab order creation failed for tooth ${n}:`,t),Kc.warning(`تم إنشاء العلاج والدفعة للسن ${n} ولكن فشل في إنشاء طلب المختبر`)}}}}catch(i){console.error(`❌ [DEBUG] Failed to process tooth ${n}:`,i),Kc.error(`فشل في معالجة السن ${n}`)}if(l>0){let e=`تم إضافة العلاج بنجاح لـ ${l} سن`;o>0&&(e+=` مع ${o} دفعة معلقة`),c>0&&(e+=` و ${c} طلب مختبر`),Kc.success(e)}l===s.length?(N(),n(!1)):Kc.warning(`تم معالجة ${l} من أصل ${s.length} أسنان بنجاح`)}catch(l){console.error("Error adding multiple treatments:",l),Kc.error("فشل في إضافة العلاجات")}finally{v(!1)}}else Kc.error("يرجى اختيار نوع العلاج والتصنيف")},disabled:f||!y.treatment_type,className:"bg-blue-600 hover:bg-blue-700 text-white",children:f?"جاري الإضافة...":`إضافة العلاج لـ ${s.length} سن`})]})]})]})})}function sD(){Bl();const{patients:t,loadPatients:n}=bt(),{toothTreatments:a,toothTreatmentImages:s,loadToothTreatments:r,loadAllToothTreatmentImages:i,loadToothTreatmentsByPatient:l,loadAllToothTreatmentImagesByPatient:o,createToothTreatment:c}=cc(),{prescriptions:d,loadPrescriptions:m}=pa();ta();const[u,p]=re.useState(""),[h,x]=re.useState(null),[g,f]=re.useState([]),[v,y]=re.useState(!1),[b,j]=re.useState(!1),[w,N]=re.useState(!1),[_,k]=re.useState(!1),[S,C]=re.useState(null),[$,D]=re.useState(""),[E,T]=re.useState(!1),[A,F]=re.useState(!1),[P,R]=re.useState(!1),[O,M]=re.useState({});ua(),re.useEffect(()=>{n(),m(),r(),i()},[n,m,r,i]),re.useEffect(()=>{(()=>{try{const e=localStorage.getItem("selectedPatientForTreatment");if(e){const n=JSON.parse(e);console.log("Found pre-selected patient for treatment:",n);const a=n.selectedPatientId,s=n.patientName,r=n.showAddTreatmentGuidance;localStorage.removeItem("selectedPatientForTreatment");const i=async()=>{console.log("Attempting to select patient:",a),console.log("Available patients:",t.length),s&&(D(s),Kc.success(`تم تحديد المريض: ${s}`),r&&setTimeout(()=>{Kc.info("اختر السن المراد علاجه من الرسم البياني أدناه لإضافة علاج جديد",void 0,{duration:5e3})},1e3)),p(a),console.log("Patient selected:",a),l(a),loadImages();const e=await B(a);M(t=>({...t,[a]:e})),setTimeout(()=>{const e=document.getElementById("dental-chart-section");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},500)};t.length>0?i():setTimeout(i,200)}}catch(e){console.error("Error reading pre-selected patient for treatment:",e)}})()},[t.length]),re.useEffect(()=>{const e=localStorage.getItem("selectedTreatmentForDetails");if(e)try{const{treatment:t,patientId:n,openDetailsModal:a}=JSON.parse(e);a&&t&&n&&(p(n),l(n),B(n).then(e=>{M(t=>({...t,[n]:e}))}),x(t.tooth_number),j(!0),localStorage.removeItem("selectedTreatmentForDetails"))}catch(n){console.error("Error parsing search result data:",n),localStorage.removeItem("selectedTreatmentForDetails")}const t=localStorage.getItem("selectedPrescriptionForDetails");if(t)try{const{prescription:e,openDetailsModal:n}=JSON.parse(t);n&&e&&(C(e),k(!0),localStorage.removeItem("selectedPrescriptionForDetails"))}catch(n){console.error("Error parsing prescription search result data:",n),localStorage.removeItem("selectedPrescriptionForDetails")}},[]);const L=t.filter(e=>e.full_name.toLowerCase().includes($.toLowerCase())||e.phone?.includes($)||e.serial_number.includes($)),I=t.find(e=>e.id===u),z=d.filter(e=>e.patient_id===u),B=async e=>{try{const t=await window.electronAPI.toothTreatments.getByPatient(e);let n=[];for(const e of t){const t=await window.electronAPI.treatmentSessions.getByTreatment(e.id);n=[...n,...t]}return{total:n.length,completed:n.filter(e=>"completed"===e.session_status).length,planned:n.filter(e=>"planned"===e.session_status).length,cancelled:n.filter(e=>"cancelled"===e.session_status).length}}catch(t){return console.error("Error getting patient session stats:",t),{total:0,completed:0,planned:0,cancelled:0}}},V=async()=>{if(u){const e=await B(u);M(t=>({...t,[u]:e}))}},Y=e=>s.filter(t=>t.patient_id===e).length,q=e=>{y(!0),x(null),f(t=>{if(t.includes(e)){const n=t.filter(t=>t!==e);return 0===n.length&&y(!1),n}return[...t,e]})},U=()=>{f([]),y(!1)};return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(ir,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"}),"العلاجات السنية"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"إدارة شاملة للعلاجات السنية مع مخطط الأسنان التفاعلي"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(Lr,{onClick:async()=>{F(!0);try{if(await Promise.all([n(),m(),r(),i()]),u){await Promise.all([l(u),o(u)]);const e=await B(u);M(t=>({...t,[u]:e}))}Kc.success("تم تحديث البيانات بنجاح")}catch(e){Kc.error("حدث خطأ أثناء تحديث البيانات")}finally{F(!1)}},disabled:A,variant:"outline",children:[e.jsx(Js,{className:"w-4 h-4 ml-2 "+(A?"animate-spin":"")}),"تحديث البيانات"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(nc,{children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(yr,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي المرضى"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:t.length})]})]})})}),e.jsx(nc,{children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(Va,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي العلاجات"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a.length})]})]})})}),e.jsx(nc,{children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900 rounded-lg",children:e.jsx(ts,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إجمالي الصور"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:s.length})]})]})})}),e.jsx(nc,{children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900 rounded-lg",children:e.jsx(bs,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"الوصفات الطبية"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:d.length})]})]})})})]}),e.jsxs(nc,{children:[e.jsxs(ac,{children:[e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(yr,{className:"w-5 h-5"}),"اختيار المريض"]}),e.jsx(rc,{children:"ابحث واختر المريض لعرض مخطط الأسنان والعلاجات"})]}),e.jsxs(ic,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(tr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{placeholder:"البحث السريع: اسم المريض، رقم الهاتف، أو #...",value:$,onChange:e=>D(e.target.value),className:"pr-10",autoComplete:"off"}),$&&e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:e.jsxs(oc,{variant:"secondary",className:"text-xs",children:[L.length," نتيجة"]})})]}),e.jsx(nD,{patients:L,selectedPatientId:u,onPatientSelect:async e=>{if(p(e),x(null),f([]),y(!1),e){await l(e),o(e);const t=await B(e);M(n=>({...n,[e]:t})),setTimeout(()=>{const e=document.getElementById("dental-chart-section");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)}},getPatientTreatmentCount:e=>{const t=a.filter(t=>t.patient_id===e).length;return t},getLastTreatmentDate:e=>{const t=a.filter(t=>t.patient_id===e);if(0===t.length)return null;const n=t.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime());return n[0].created_at},getPatientImagesCount:Y,isLoading:A,isCompact:!!I}),I&&e.jsx(nc,{className:"bg-muted/30 dark:bg-muted/20 border-border",children:e.jsxs(ic,{className:"pt-4 bg-muted/30 dark:bg-muted/20",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yr,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"font-medium text-foreground",children:I.full_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"الجنس:"}),e.jsx(oc,{variant:"secondary",children:"male"===I.gender?"ذكر":"أنثى"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsxs("span",{className:"text-foreground",children:[I.age," سنة"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsx("a",{href:`https://wa.me/${I.phone?.replace(/\D/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 dark:text-green-400 hover:underline",children:I.phone})]})]}),(()=>{const t=(e=>{const t=a.filter(t=>t.patient_id===e);return{total:t.length,completed:t.filter(e=>"completed"===e.treatment_status).length,inProgress:t.filter(e=>"in_progress"===e.treatment_status).length,planned:t.filter(e=>"planned"===e.treatment_status).length}})(u),n=Y(u),s=O[u]||{total:0,completed:0,planned:0,cancelled:0};return e.jsxs("div",{className:"border-t border-border pt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"إحصائيات العلاجات"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(oc,{variant:"outline",className:"bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300",children:[e.jsx(Va,{className:"w-3 h-3 ml-1"}),t.total," إجمالي"]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(oc,{variant:"outline",className:"bg-green-50 dark:bg-green-900 text-green-700 dark:text-green-300",children:["✓ ",t.completed," مكتمل"]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(oc,{variant:"outline",className:"bg-orange-50 dark:bg-orange-900 text-orange-700 dark:text-orange-300",children:["⏳ ",t.inProgress," قيد التنفيذ"]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(oc,{variant:"outline",className:"bg-gray-50 dark:bg-gray-900 text-gray-700 dark:text-gray-300",children:["📋 ",t.planned," مخطط"]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(oc,{variant:"outline",className:"bg-purple-50 dark:bg-purple-900 text-purple-700 dark:text-purple-300",children:[e.jsx(ts,{className:"w-3 h-3 ml-1"}),n," صورة"]})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"إحصائيات الجلسات"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(oc,{variant:"outline",className:"bg-indigo-50 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300",children:[e.jsx(es,{className:"w-3 h-3 ml-1"}),s.total," إجمالي"]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(oc,{variant:"outline",className:"bg-emerald-50 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-300",children:["✅ ",s.completed," مكتملة"]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(oc,{variant:"outline",className:"bg-amber-50 dark:bg-amber-900 text-amber-700 dark:text-amber-300",children:["📅 ",s.planned," مخططة"]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(oc,{variant:"outline",className:"bg-red-50 dark:bg-red-900 text-red-700 dark:text-red-300",children:["❌ ",s.cancelled," ملغية"]})})]})]})]})})()]})})]})]}),I&&e.jsx(nc,{className:"mb-4",children:e.jsx(ic,{className:"p-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"نظام العلاجات المتعددة"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"النظام المحسن: يدعم عدة علاجات للسن الواحد مع الألوان العالمية"})]})})})}),I&&v&&g.length>0&&e.jsx(nc,{className:"bg-orange-50 dark:bg-orange-950/20 border-orange-200 dark:border-orange-800",children:e.jsx(ic,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500"}),e.jsxs("span",{className:"text-sm font-medium text-orange-700 dark:text-orange-300",children:["تم تحديد ",g.length," سن"]})]}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["الأسنان المحددة: ",g.sort((e,t)=>e-t).join(", ")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lr,{size:"sm",onClick:()=>{0!==g.length?N(!0):Kc.warning("يرجى تحديد أسنان أولاً")},className:"bg-orange-600 hover:bg-orange-700 text-white",children:"إضافة علاج للأسنان المحددة"}),e.jsx(Lr,{size:"sm",variant:"outline",onClick:U,className:"border-orange-300 text-orange-700 hover:bg-orange-100 dark:border-orange-700 dark:text-orange-300 dark:hover:bg-orange-900/20",children:"إلغاء التحديد"})]})]})})}),I&&!v&&e.jsx(nc,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:e.jsx(ic,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-700 dark:text-blue-300",children:[e.jsx(Cs,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:"نصيحة:"})," اضغط CTRL + النقر لتحديد عدة أسنان وإضافة نفس العلاج لها"]})]})})}),I&&e.jsx("div",{id:"dental-chart-section",children:e.jsx(V$,{patientId:u,onToothClick:(e,t=!1)=>{u?t?q(e):(f([]),y(!1),x(e),j(!0)):Kc.warning("يرجى اختيار مريض أولاً")},selectedTooth:h,selectedTeeth:g,isMultiSelectMode:v,isPrimaryTeeth:E,onPrimaryTeethChange:T})}),I&&z.length>0&&e.jsxs(nc,{className:"bg-card dark:bg-card border-border",children:[e.jsx(ac,{className:"bg-card dark:bg-card",children:e.jsxs(sc,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(bs,{className:"w-5 h-5"}),"الوصفات الطبية"]})}),e.jsx(ic,{className:"bg-card dark:bg-card",children:e.jsx("div",{className:"space-y-2",children:z.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:["وصفة طبية - ",In(t.prescription_date)]}),t.notes&&e.jsx("div",{className:"text-sm text-muted-foreground",children:t.notes})]}),e.jsxs(Lr,{variant:"outline",size:"sm",onClick:()=>(e=>{C(e),k(!0)})(t),children:[e.jsx(Qs,{className:"w-4 h-4 ml-2"}),"طباعة"]})]},t.id))})})]}),!I&&!P&&e.jsx(nc,{children:e.jsxs(ic,{className:"text-center py-12",children:[e.jsx(ir,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"اختر مريض لبدء العلاج"}),e.jsx("p",{className:"text-muted-foreground",children:"استخدم البحث أعلاه لاختيار مريض وعرض مخطط الأسنان التفاعلي"})]})}),e.jsx(tD,{open:b,onOpenChange:async e=>{j(e),!e&&u&&(l(u),o(u),await V())},patientId:u,toothNumber:h,isPrimaryTeeth:E,onSessionStatsUpdate:V,onTreatmentUpdate:async()=>{u&&(await Promise.all([l(u),o(u)]),x(e=>e),setTimeout(()=>{x(e=>e)},100))}}),S&&e.jsx(O$,{open:_,onOpenChange:k,prescription:S}),e.jsx(aD,{open:w,onOpenChange:N,patientId:u,selectedTeeth:g,onAddTreatments:async e=>{try{F(!0);const t=[];for(const n of e){const e=await c(n);e&&t.push(e)}return u&&await Promise.all([l(u),o(u)]),U(),t}catch(t){throw console.error("Error adding multiple treatments:",t),Kc.error("فشل في إضافة العلاجات"),t}finally{F(!1)}}})]})}const rD=({open:t,onOpenChange:n,editingNeed:a})=>{const{createNeed:s,updateNeed:r,isLoading:i,categories:l,suppliers:o,getNextSerialNumber:c}=uh(),{toast:d}=Bl(),[m,u]=re.useState({need_name:"",quantity:1,price:0,description:"",category:"",priority:"medium",status:"pending",supplier:"",notes:""}),[p,h]=re.useState({});re.useEffect(()=>{u(a?{need_name:a.need_name,quantity:a.quantity,price:a.price,description:a.description||"",category:a.category||"",priority:a.priority,status:a.status,supplier:a.supplier||"",notes:a.notes||""}:{need_name:"",quantity:1,price:0,description:"",category:"",priority:"medium",status:"pending",supplier:"",notes:""}),h({})},[a,t]);const x=(e,t)=>{u(n=>({...n,[e]:t})),p[e]&&h(t=>({...t,[e]:""}))};return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"sm:max-w-[600px]",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsx(Ar,{children:a?"تعديل الاحتياج":"إضافة احتياج جديد"}),e.jsx(Fr,{children:a?"قم بتعديل بيانات الاحتياج":"أدخل بيانات الاحتياج الجديد للعيادة"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return m.need_name.trim()||(e.need_name="اسم الاحتياج مطلوب"),m.quantity<=0&&(e.quantity="الكمية يجب أن تكون أكبر من صفر"),m.price<0&&(e.price="السعر لا يمكن أن يكون سالباً"),h(e),0===Object.keys(e).length})())try{if(a){const e={...m,serial_number:a.serial_number};await r(a.id,e),d({title:"تم التحديث بنجاح",description:"تم تحديث الاحتياج بنجاح"})}else{const e={...m,serial_number:c()};await s(e),d({title:"تم الإنشاء بنجاح",description:"تم إنشاء الاحتياج الجديد بنجاح"})}n(!1)}catch(t){d({title:"خطأ",description:"حدث خطأ أثناء حفظ الاحتياج",variant:"destructive"})}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"need_name",children:"اسم الاحتياج *"}),e.jsx(Ir,{id:"need_name",value:m.need_name,onChange:e=>x("need_name",e.target.value),placeholder:"أدخل اسم الاحتياج",className:p.need_name?"border-red-500":""}),p.need_name&&e.jsx("p",{className:"text-sm text-red-500",children:p.need_name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"quantity",children:"الكمية"}),e.jsx(Ir,{id:"quantity",type:"number",min:"1",value:m.quantity,onChange:e=>{const t=e.target.value;x("quantity",""===t?1:parseInt(t)||1)},onBlur:e=>{const t=parseInt(e.target.value)||1;x("quantity",t)},className:p.quantity?"border-red-500":""}),p.quantity&&e.jsx("p",{className:"text-sm text-red-500",children:p.quantity})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"price",children:"السعر"}),e.jsx(Ir,{id:"price",type:"number",min:"0",step:"0.1",value:m.price,onChange:e=>{const t=e.target.value;x("price",""===t?0:parseFloat(t)||0)},onBlur:e=>{const t=parseFloat(e.target.value)||0;x("price",t)},className:p.price?"border-red-500":""}),p.price&&e.jsx("p",{className:"text-sm text-red-500",children:p.price})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"category",children:"الفئة"}),e.jsxs(Nl,{value:m.category,onValueChange:e=>x("category",e),children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر الفئة"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"أدوات طبية",children:"أدوات طبية"}),e.jsx(Al,{value:"مواد استهلاكية",children:"مواد استهلاكية"}),e.jsx(Al,{value:"أجهزة",children:"أجهزة"}),e.jsx(Al,{value:"أثاث",children:"أثاث"}),e.jsx(Al,{value:"مواد تنظيف",children:"مواد تنظيف"}),e.jsx(Al,{value:"أخرى",children:"أخرى"}),l.filter(e=>!["أدوات طبية","مواد استهلاكية","أجهزة","أثاث","مواد تنظيف","أخرى"].includes(e)).map(t=>e.jsx(Al,{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"priority",children:"الأولوية"}),e.jsxs(Nl,{value:m.priority,onValueChange:e=>x("priority",e),children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر الأولوية"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"urgent",children:"عاجل"}),e.jsx(Al,{value:"high",children:"عالي"}),e.jsx(Al,{value:"medium",children:"متوسط"}),e.jsx(Al,{value:"low",children:"منخفض"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"status",children:"الحالة"}),e.jsxs(Nl,{value:m.status,onValueChange:e=>x("status",e),children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر الحالة"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"pending",children:"معلق"}),e.jsx(Al,{value:"ordered",children:"مطلوب"}),e.jsx(Al,{value:"received",children:"مستلم"}),e.jsx(Al,{value:"cancelled",children:"ملغي"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"supplier",children:"المورد"}),e.jsx(Ir,{id:"supplier",value:m.supplier,onChange:e=>x("supplier",e.target.value),placeholder:"اسم المورد (اختياري)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"description",children:"الوصف"}),e.jsx(wl,{id:"description",value:m.description,onChange:e=>x("description",e.target.value),placeholder:"وصف تفصيلي للاحتياج (اختياري)",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"notes",children:"ملاحظات"}),e.jsx(wl,{id:"notes",value:m.notes,onChange:e=>x("notes",e.target.value),placeholder:"ملاحظات إضافية (اختياري)",rows:2})]}),e.jsxs(Tr,{children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:()=>n(!1),children:"إلغاء"}),e.jsx(Lr,{type:"submit",disabled:i,children:i?"جاري الحفظ...":a?"تحديث":"إضافة"})]})]})]})})},iD=({open:t,onOpenChange:n,need:a})=>{const{deleteNeed:s,isLoading:r}=uh(),{toast:i}=Bl();return a?e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"sm:max-w-[425px]",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(qa,{className:"w-5 h-5"}),"تأكيد الحذف"]}),e.jsx(Fr,{children:"هل أنت متأكد من حذف هذا الاحتياج؟ لا يمكن التراجع عن هذا الإجراء."})]}),e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"#:"}),e.jsx("span",{children:a.serial_number})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"اسم الاحتياج:"}),e.jsx("span",{children:a.need_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"الكمية:"}),e.jsx("span",{children:a.quantity})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"السعر:"}),e.jsx("span",{children:Mn(a.price)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"الإجمالي:"}),e.jsx("span",{className:"font-bold",children:Mn(a.price*a.quantity)})]})]})}),e.jsxs(Tr,{children:[e.jsx(Lr,{variant:"outline",onClick:()=>n(!1),children:"إلغاء"}),e.jsx(Lr,{variant:"destructive",onClick:async()=>{if(a)try{await s(a.id),i({title:"تم الحذف بنجاح",description:"تم حذف الاحتياج بنجاح"}),n(!1)}catch(e){i({title:"خطأ",description:"حدث خطأ أثناء حذف الاحتياج",variant:"destructive"})}},disabled:r,children:r?"جاري الحذف...":"حذف"})]})]})}):null},lD=({needs:t,onEdit:n,onDelete:a,onReceiveAndDelete:s,isLoading:r=!1})=>{const[i,l]=re.useState(1),[o,c]=re.useState(10),d=t.length,m=Math.ceil(d/o),u=(i-1)*o,p=t.slice(u,u+o),h=e=>{l(e)},x=t=>{const n={pending:{label:"معلق",variant:"secondary",icon:us},ordered:{label:"مطلوب",variant:"default",icon:sr},received:{label:"مستلم",variant:"default",icon:ns},cancelled:{label:"ملغي",variant:"destructive",icon:qa}}[t];if(!n)return null;const a=n.icon;return e.jsxs(oc,{variant:n.variant,className:"flex items-center gap-1 w-fit",children:[e.jsx(a,{className:"w-3 h-3"}),n.label]})},g=t=>{const n={low:{label:"منخفض",variant:"secondary",color:"bg-gray-100 text-gray-800"},medium:{label:"متوسط",variant:"default",color:"bg-blue-100 text-blue-800"},high:{label:"عالي",variant:"default",color:"bg-orange-100 text-orange-800"},urgent:{label:"عاجل",variant:"destructive",color:"bg-red-100 text-red-800"}}[t];return n?e.jsx(oc,{variant:n.variant,className:`${n.color} w-fit`,children:n.label}):null};return r?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"جاري التحميل..."})]}):0===t.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Bs,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"لا توجد احتياجات"}),e.jsx("p",{className:"text-muted-foreground",children:"لم يتم العثور على أي احتياجات مطابقة للبحث"})]}):e.jsxs("div",{className:"rounded-md border",dir:"rtl",children:[e.jsxs(Bc,{children:[e.jsx(Vc,{children:e.jsxs(qc,{children:[e.jsx(Uc,{className:"text-center",children:"#"}),e.jsx(Uc,{className:"text-right",children:"اسم الاحتياج"}),e.jsx(Uc,{className:"text-right",children:"الكمية"}),e.jsx(Uc,{className:"text-right",children:"السعر"}),e.jsx(Uc,{className:"text-right",children:"الإجمالي"}),e.jsx(Uc,{className:"text-right",children:"الفئة"}),e.jsx(Uc,{className:"text-right",children:"الأولوية"}),e.jsx(Uc,{className:"text-right",children:"الحالة"}),e.jsx(Uc,{className:"text-right",children:"المورد"}),e.jsx(Uc,{className:"text-right",children:"الإجراءات"})]})}),e.jsx(Yc,{children:p.map((t,r)=>e.jsxs(qc,{className:"hover:bg-muted/50",children:[e.jsx(Hc,{className:"font-medium text-center",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:u+r+1})}),e.jsx(Hc,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.need_name}),t.description&&e.jsx("div",{className:"text-sm text-muted-foreground mt-1 max-w-xs truncate",children:t.description})]})}),e.jsx(Hc,{children:e.jsx("span",{className:"font-medium",children:t.quantity})}),e.jsx(Hc,{children:e.jsx("span",{className:"font-medium",children:Mn(t.price)})}),e.jsx(Hc,{children:e.jsx("span",{className:"font-bold text-primary",children:Mn(t.price*t.quantity)})}),e.jsx(Hc,{children:t.category&&e.jsx(oc,{variant:"outline",className:"w-fit",children:t.category})}),e.jsx(Hc,{children:g(t.priority)}),e.jsx(Hc,{children:x(t.status)}),e.jsx(Hc,{children:t.supplier&&e.jsx("span",{className:"text-sm",children:t.supplier})}),e.jsx(Hc,{children:e.jsxs("div",{className:"flex items-center gap-2",children:["received"!==t.status&&e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>s(t),className:"h-8 w-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",title:"تأكيد الاستلام وتحديث الحالة إلى مستلم",children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>n(t),className:"h-8 w-8 p-0",children:e.jsx(Us,{className:"h-4 w-4"})}),e.jsx(Lr,{variant:"ghost",size:"sm",onClick:()=>a(t),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(dr,{className:"h-4 w-4"})})]})})]},t.id))})]}),m>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد الصفوف لكل صفحة"}),e.jsxs(Nl,{value:`${o}`,onValueChange:e=>{c(parseInt(e)),l(1)},children:[e.jsx(Sl,{className:"h-8 w-[70px]",children:e.jsx(kl,{placeholder:o})}),e.jsx(Dl,{side:"top",children:[5,10,20,30,50].map(t=>e.jsx(Al,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",i," من ",m]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>h(1),disabled:1===i,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(cs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>h(i-1),disabled:1===i,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(is,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>h(i+1),disabled:i===m,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(rs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>h(m),disabled:i===m,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(os,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-muted-foreground arabic-enhanced",children:["عرض ",u+1," إلى ",Math.min(u+o,d)," من ",d," نتيجة"]})]})]})},oD=({searchQuery:t,onSearchChange:n,filters:a,onFilterChange:s,categories:r,suppliers:i,onClearFilters:l})=>{const o=t||a.category||a.priority||a.status;return e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(sc,{className:"flex items-center gap-2",children:[e.jsx(js,{className:"w-5 h-5"}),"البحث والتصفية"]}),o&&e.jsxs(Lr,{variant:"outline",size:"sm",onClick:l,className:"flex items-center gap-1",children:[e.jsx(_r,{className:"w-3 h-3"}),"مسح الفلاتر"]})]})}),e.jsxs(ic,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(tr,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ir,{placeholder:"البحث في الاحتياجات...",value:t,onChange:e=>n(e.target.value),className:"pr-10"})]}),e.jsxs(Nl,{value:a.category||"all",onValueChange:e=>s("category",e),children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"الفئة"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الفئات"}),e.jsx(Al,{value:"أدوات طبية",children:"أدوات طبية"}),e.jsx(Al,{value:"مواد استهلاكية",children:"مواد استهلاكية"}),e.jsx(Al,{value:"أجهزة",children:"أجهزة"}),e.jsx(Al,{value:"أثاث",children:"أثاث"}),e.jsx(Al,{value:"مواد تنظيف",children:"مواد تنظيف"}),e.jsx(Al,{value:"أخرى",children:"أخرى"}),r.filter(e=>!["أدوات طبية","مواد استهلاكية","أجهزة","أثاث","مواد تنظيف","أخرى"].includes(e)).map(t=>e.jsx(Al,{value:t,children:t},t))]})]}),e.jsxs(Nl,{value:a.priority||"all",onValueChange:e=>s("priority",e),children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"الأولوية"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الأولويات"}),e.jsx(Al,{value:"urgent",children:"عاجل"}),e.jsx(Al,{value:"high",children:"عالي"}),e.jsx(Al,{value:"medium",children:"متوسط"}),e.jsx(Al,{value:"low",children:"منخفض"})]})]}),e.jsxs(Nl,{value:a.status||"all",onValueChange:e=>s("status",e),children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"الحالة"})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"all",children:"جميع الحالات"}),e.jsx(Al,{value:"pending",children:"معلق"}),e.jsx(Al,{value:"ordered",children:"مطلوب"}),e.jsx(Al,{value:"received",children:"مستلم"}),e.jsx(Al,{value:"cancelled",children:"ملغي"})]})]})]}),o&&e.jsx("div",{className:"mt-4 p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["الفلاتر النشطة:",t&&e.jsxs("span",{className:"inline-block bg-primary/10 text-primary px-2 py-1 rounded mr-2 text-xs",children:['البحث: "',t,'"']}),a.category&&"all"!==a.category&&e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2 text-xs",children:["الفئة: ",a.category]}),a.priority&&"all"!==a.priority&&e.jsxs("span",{className:"inline-block bg-orange-100 text-orange-800 px-2 py-1 rounded mr-2 text-xs",children:["الأولوية: ",cD(a.priority)]}),a.status&&"all"!==a.status&&e.jsxs("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded mr-2 text-xs",children:["الحالة: ",dD(a.status)]})]})})]})]})},cD=e=>({low:"منخفض",medium:"متوسط",high:"عالي",urgent:"عاجل"}[e]||e),dD=e=>({pending:"معلق",ordered:"مطلوب",received:"مستلم",cancelled:"ملغي"}[e]||e),mD=()=>{const{needs:t,filteredNeeds:n,isLoading:a,error:s,searchQuery:r,filters:i,categories:l,suppliers:o,totalNeeds:c,totalValue:d,pendingCount:m,orderedCount:u,receivedCount:p,urgentCount:h,loadNeeds:x,deleteNeed:g,updateNeed:f,setSearchQuery:v,setFilters:y,clearError:b}=uh(),{toast:j}=Bl(),[w,N]=re.useState(!1),[_,k]=re.useState(!1),[S,C]=re.useState(null),[$,D]=re.useState(null);re.useEffect(()=>{x()},[x]);const E=({title:t,value:n,icon:a,color:s="blue"})=>e.jsx(nc,{className:pc(s),children:e.jsx(ic,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:t}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:n})]}),e.jsx("div",{className:`text-2xl ${hc(s)}`,children:a})]})})});return s?e.jsx("div",{className:"p-6",children:e.jsx(nc,{children:e.jsx(ic,{className:"pt-6",children:e.jsxs("div",{className:"text-center text-red-600",children:[e.jsxs("p",{children:["حدث خطأ: ",s]}),e.jsx(Lr,{onClick:b,className:"mt-2",children:"إعادة المحاولة"})]})})})}):e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(ms,{className:"w-8 h-8 text-primary"}),"احتياجات العيادة"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إدارة احتياجات ومتطلبات العيادة"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Lr,{variant:"outline",onClick:async()=>{if(0!==n.length)try{await Zc.exportClinicNeedsToCSV(n,`احتياجات_العيادة_${(new Date).toISOString().split("T")[0]}`),Kc.exportSuccess(`تم تصدير ${n.length} احتياج بنجاح إلى ملف Excel مع التنسيق الجميل!`)}catch(e){console.error("Error exporting clinic needs:",e),Kc.exportError("فشل في تصدير بيانات الاحتياجات")}else Kc.noDataToExport("لا توجد بيانات احتياجات للتصدير")},children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير"]}),e.jsxs(Lr,{onClick:()=>{C(null),N(!0)},className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"w-4 h-4"}),"إضافة احتياج جديد"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(E,{title:"إجمالي المواد",value:c,icon:e.jsx(Bs,{}),color:"blue"}),e.jsx(E,{title:"إجمالي السعر",value:Mn(d),icon:e.jsx(gs,{}),color:"green"}),e.jsx(E,{title:"معلق",value:m,icon:e.jsx(us,{}),color:"yellow"}),e.jsx(E,{title:"عاجل",value:h,icon:e.jsx(qa,{}),color:"red"})]}),e.jsx(oD,{searchQuery:r,onSearchChange:v,filters:i,onFilterChange:(e,t)=>{y({...i,[e]:"all"===t?void 0:t})},categories:l,suppliers:o,onClearFilters:()=>{v(""),y({})}}),e.jsxs(nc,{children:[e.jsxs(ac,{children:[e.jsx(sc,{children:"قائمة الاحتياجات"}),e.jsx(rc,{children:"عرض جميع احتياجات العيادة مع إمكانية التعديل والحذف"})]}),e.jsx(ic,{children:e.jsx(lD,{needs:n,onEdit:e=>{C(e),N(!0)},onDelete:e=>{D(e),k(!0)},onReceiveAndDelete:async e=>{try{const t={serial_number:e.serial_number,need_name:e.need_name,quantity:e.quantity,price:e.price,description:e.description,category:e.category,priority:e.priority,status:"received",supplier:e.supplier,notes:e.notes};await f(e.id,t),j({title:"تم تأكيد الاستلام",description:`تم تأكيد استلام "${e.need_name}" وتحديث حالته إلى مستلم`})}catch(t){j({title:"خطأ",description:"حدث خطأ أثناء تأكيد الاستلام",variant:"destructive"})}},isLoading:a})})]}),e.jsx(rD,{open:w,onOpenChange:()=>{N(!1),C(null)},editingNeed:S}),e.jsx(iD,{open:_,onOpenChange:()=>{k(!1),D(null)},need:$})]})},uD=({open:t,onOpenChange:n,editingExpense:a})=>{const{createExpense:s,updateExpense:r,isLoading:i,categories:l,vendors:o}=mh(),{currentCurrency:c,formatAmount:d,getCurrencySymbol:m}=oa(),{toast:u}=Bl(),[p,h]=re.useState({expense_name:"",amount:"",expense_type:"",category:"",description:"",payment_method:"",payment_date:"",due_date:"",is_recurring:!1,recurring_frequency:"",recurring_end_date:"",status:"pending",receipt_number:"",vendor:"",notes:""}),[x,g]=re.useState({});re.useEffect(()=>{h(a?{expense_name:a.expense_name||"",amount:a.amount?.toString()||"",expense_type:a.expense_type||"",category:a.category||"",description:a.description||"",payment_method:a.payment_method||"",payment_date:a.payment_date?.split("T")[0]||"",due_date:a.due_date?.split("T")[0]||"",is_recurring:a.is_recurring||!1,recurring_frequency:a.recurring_frequency||"",recurring_end_date:a.recurring_end_date?.split("T")[0]||"",status:a.status||"pending",receipt_number:a.receipt_number||"",vendor:a.vendor||"",notes:a.notes||""}:{expense_name:"",amount:"",expense_type:"",category:"",description:"",payment_method:"",payment_date:(new Date).toISOString().split("T")[0],due_date:"",is_recurring:!1,recurring_frequency:"",recurring_end_date:"",status:"pending",receipt_number:"",vendor:"",notes:""}),g({})},[a,t]);const f=(e,t)=>{h(n=>({...n,[e]:t})),x[e]&&g(t=>({...t,[e]:""}))};return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center gap-2",children:[e.jsx(Xs,{className:"w-5 h-5 text-primary"}),a?"تعديل المصروف":"إضافة مصروف جديد"]}),e.jsx(Fr,{children:a?"تعديل بيانات المصروف":"إضافة مصروف جديد للعيادة"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return p.expense_name.trim()||(e.expense_name="اسم المصروف مطلوب"),(!p.amount||parseFloat(p.amount)<=0)&&(e.amount="المبلغ مطلوب ويجب أن يكون أكبر من صفر"),p.expense_type||(e.expense_type="نوع المصروف مطلوب"),p.payment_method||(e.payment_method="طريقة الدفع مطلوبة"),p.payment_date||(e.payment_date="تاريخ الدفع مطلوب"),p.is_recurring&&!p.recurring_frequency&&(e.recurring_frequency="تكرار المصروف مطلوب للمصروفات المتكررة"),g(e),0===Object.keys(e).length})())try{const e={...p,amount:parseFloat(p.amount),payment_date:new Date(p.payment_date).toISOString(),due_date:p.due_date?new Date(p.due_date).toISOString():void 0,recurring_end_date:p.recurring_end_date?new Date(p.recurring_end_date).toISOString():void 0};a?(await r(a.id,e),u({title:"تم التحديث بنجاح",description:"تم تحديث المصروف بنجاح"})):(await s(e),u({title:"تم الإضافة بنجاح",description:"تم إضافة المصروف بنجاح"})),n(!1)}catch(t){u({title:"خطأ",description:a?"فشل في تحديث المصروف":"فشل في إضافة المصروف",variant:"destructive"})}},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"expense_name",children:"اسم المصروف *"}),e.jsx(Ir,{id:"expense_name",value:p.expense_name,onChange:e=>f("expense_name",e.target.value),placeholder:"مثال: راتب السكرتيرة",className:x.expense_name?"border-destructive":""}),x.expense_name&&e.jsx("p",{className:"text-sm text-destructive",children:x.expense_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Yr,{htmlFor:"amount",children:["المبلغ (",m(),") *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Ir,{id:"amount",type:"number",step:"0.1",min:"0",value:p.amount,onChange:e=>f("amount",e.target.value),onBlur:e=>{const t=parseFloat(e.target.value)||0;f("amount",t.toString())},placeholder:"0.00",className:"pl-10 "+(x.amount?"border-destructive":"")})]}),x.amount&&e.jsx("p",{className:"text-sm text-destructive",children:x.amount})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"expense_type",children:"نوع المصروف *"}),e.jsxs(Nl,{value:p.expense_type,onValueChange:e=>f("expense_type",e),children:[e.jsx(Sl,{className:x.expense_type?"border-destructive":"",children:e.jsx(kl,{placeholder:"اختر نوع المصروف"})}),e.jsx(Dl,{children:[{value:"salary",label:"راتب"},{value:"utilities",label:"مرافق (كهرباء، مياه، غاز)"},{value:"rent",label:"إيجار"},{value:"maintenance",label:"صيانة"},{value:"supplies",label:"مستلزمات"},{value:"insurance",label:"تأمين"},{value:"other",label:"أخرى"}].map(t=>e.jsx(Al,{value:t.value,children:t.label},t.value))})]}),x.expense_type&&e.jsx("p",{className:"text-sm text-destructive",children:x.expense_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"category",children:"الفئة"}),e.jsx(Ir,{id:"category",value:p.category,onChange:e=>f("category",e.target.value),placeholder:"مثال: مصروفات إدارية",list:"categories"}),e.jsx("datalist",{id:"categories",children:l.map(t=>e.jsx("option",{value:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"description",children:"الوصف"}),e.jsx(wl,{id:"description",value:p.description,onChange:e=>f("description",e.target.value),placeholder:"وصف تفصيلي للمصروف",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"payment_method",children:"طريقة الدفع *"}),e.jsxs(Nl,{value:p.payment_method,onValueChange:e=>f("payment_method",e),children:[e.jsx(Sl,{className:x.payment_method?"border-destructive":"",children:e.jsx(kl,{placeholder:"اختر طريقة الدفع"})}),e.jsx(Dl,{children:[{value:"cash",label:"نقدي"},{value:"bank_transfer",label:"تحويل بنكي"},{value:"check",label:"شيك"},{value:"credit_card",label:"بطاقة ائتمان"}].map(t=>e.jsx(Al,{value:t.value,children:t.label},t.value))})]}),x.payment_method&&e.jsx("p",{className:"text-sm text-destructive",children:x.payment_method})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"status",children:"الحالة"}),e.jsxs(Nl,{value:p.status,onValueChange:e=>f("status",e),children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر الحالة"})}),e.jsx(Dl,{children:[{value:"pending",label:"معلق"},{value:"paid",label:"مدفوع"},{value:"overdue",label:"متأخر"},{value:"cancelled",label:"ملغي"}].map(t=>e.jsx(Al,{value:t.value,children:t.label},t.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"payment_date",children:"تاريخ الدفع *"}),e.jsxs("div",{className:"relative",children:[e.jsx(es,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Ir,{id:"payment_date",type:"date",value:p.payment_date,onChange:e=>f("payment_date",e.target.value),className:"pl-10 "+(x.payment_date?"border-destructive":"")})]}),x.payment_date&&e.jsx("p",{className:"text-sm text-destructive",children:x.payment_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"due_date",children:"تاريخ الاستحقاق"}),e.jsxs("div",{className:"relative",children:[e.jsx(es,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Ir,{id:"due_date",type:"date",value:p.due_date,onChange:e=>f("due_date",e.target.value),className:"pl-10"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B$,{id:"is_recurring",checked:p.is_recurring,onCheckedChange:e=>f("is_recurring",e)}),e.jsx(Yr,{htmlFor:"is_recurring",children:"مصروف متكرر"})]}),p.is_recurring&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"recurring_frequency",children:"تكرار المصروف *"}),e.jsxs(Nl,{value:p.recurring_frequency,onValueChange:e=>f("recurring_frequency",e),children:[e.jsx(Sl,{className:x.recurring_frequency?"border-destructive":"",children:e.jsx(kl,{placeholder:"اختر التكرار"})}),e.jsx(Dl,{children:[{value:"daily",label:"يومي"},{value:"weekly",label:"أسبوعي"},{value:"monthly",label:"شهري"},{value:"quarterly",label:"ربع سنوي"},{value:"yearly",label:"سنوي"}].map(t=>e.jsx(Al,{value:t.value,children:t.label},t.value))})]}),x.recurring_frequency&&e.jsx("p",{className:"text-sm text-destructive",children:x.recurring_frequency})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"recurring_end_date",children:"تاريخ انتهاء التكرار"}),e.jsx(Ir,{id:"recurring_end_date",type:"date",value:p.recurring_end_date,onChange:e=>f("recurring_end_date",e.target.value)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"receipt_number",children:"رقم الإيصال"}),e.jsx(Ir,{id:"receipt_number",value:p.receipt_number,onChange:e=>f("receipt_number",e.target.value),placeholder:"رقم الإيصال أو الفاتورة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"vendor",children:"المورد/الجهة"}),e.jsx(Ir,{id:"vendor",value:p.vendor,onChange:e=>f("vendor",e.target.value),placeholder:"اسم المورد أو الجهة",list:"vendors"}),e.jsx("datalist",{id:"vendors",children:o.map(t=>e.jsx("option",{value:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Yr,{htmlFor:"notes",children:"ملاحظات"}),e.jsx(wl,{id:"notes",value:p.notes,onChange:e=>f("notes",e.target.value),placeholder:"ملاحظات إضافية",rows:3})]}),e.jsxs(Tr,{className:"gap-2",children:[e.jsx(Lr,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:i,children:"إلغاء"}),e.jsxs(Lr,{type:"submit",disabled:i,children:[i&&e.jsx(As,{className:"w-4 h-4 mr-2 animate-spin"}),a?"تحديث":"إضافة"]})]})]})]})})},pD=({open:t,onOpenChange:n,expense:a})=>{const{deleteExpense:s,isLoading:r}=mh();oa();const{toast:i}=Bl();if(!a)return null;return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"max-w-md",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(qa,{className:"w-5 h-5"}),"تأكيد حذف المصروف"]}),e.jsx(Fr,{children:"هل أنت متأكد من حذف هذا المصروف؟ لا يمكن التراجع عن هذا الإجراء."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xs,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-semibold text-foreground",children:a.expense_name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"المبلغ:"}),e.jsx("span",{className:"font-medium text-foreground mr-2",children:e.jsx(rh,{amount:a.amount})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"النوع:"}),e.jsx("span",{className:"font-medium text-foreground mr-2",children:(o=a.expense_type,{salary:"راتب",utilities:"مرافق",rent:"إيجار",maintenance:"صيانة",supplies:"مستلزمات",insurance:"تأمين",other:"أخرى"}[o]||o)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx("span",{className:"font-medium text-foreground mr-2",children:(l=a.status,{pending:"معلق",paid:"مدفوع",overdue:"متأخر",cancelled:"ملغي"}[l]||l)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"التاريخ:"}),e.jsx("span",{className:"font-medium text-foreground mr-2",children:new Date(a.payment_date).toLocaleDateString("ar-SA")})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground text-sm",children:"الوصف:"}),e.jsx("p",{className:"text-sm text-foreground mt-1",children:a.description})]}),a.vendor&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground text-sm",children:"المورد:"}),e.jsx("span",{className:"text-sm text-foreground mr-2",children:a.vendor})]}),a.receipt_number&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground text-sm",children:"رقم الإيصال:"}),e.jsx("span",{className:"text-sm text-foreground mr-2",children:a.receipt_number})]}),a.is_recurring&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded",children:"مصروف متكرر"}),a.recurring_frequency&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",a.recurring_frequency,")"]})]})]}),e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(qa,{className:"w-4 h-4 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-destructive mb-1",children:"تحذير:"}),e.jsx("p",{className:"text-destructive/80",children:"سيتم حذف هذا المصروف نهائياً من النظام. إذا كان هذا مصروف متكرر، فسيتم حذف جميع التكرارات المستقبلية أيضاً."})]})]})})]}),e.jsxs(Tr,{className:"gap-2",children:[e.jsx(Lr,{variant:"outline",onClick:()=>n(!1),disabled:r,children:"إلغاء"}),e.jsxs(Lr,{variant:"destructive",onClick:async()=>{if(a)try{await s(a.id),i({title:"تم الحذف بنجاح",description:"تم حذف المصروف بنجاح"}),n(!1)}catch(e){i({title:"خطأ في الحذف",description:"فشل في حذف المصروف. يرجى المحاولة مرة أخرى.",variant:"destructive"})}},disabled:r,children:[r&&e.jsx(As,{className:"w-4 h-4 mr-2 animate-spin"}),"حذف المصروف"]})]})]})});var l,o},hD=()=>{const{expenses:t,filteredExpenses:n,isLoading:a,error:s,searchQuery:r,filters:i,categories:l,vendors:o,expenseTypes:c,analytics:d,loadExpenses:m,deleteExpense:u,updateExpense:p,setSearchQuery:h,setFilters:x,clearError:g}=mh();oa();const{toast:f}=Bl(),[v,y]=re.useState(!1),[b,j]=re.useState(!1),[w,N]=re.useState(null),[_,k]=re.useState(null),[S,C]=re.useState(1),[$,D]=re.useState(10);re.useEffect(()=>{m()},[m]);const E=n.length,T=Math.ceil(E/$),A=(S-1)*$,F=n.slice(A,A+$),P=e=>{C(e)};return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(qa,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s}),e.jsx(Lr,{onClick:()=>{g(),m()},children:"إعادة المحاولة"})]})}):e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Xs,{className:"w-8 h-8 text-primary"}),"مصروفات العيادة"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إدارة المصروفات التشغيلية للعيادة"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Lr,{variant:"outline",onClick:async()=>{try{if(0===n.length)return void Kc.noDataToExport("لا توجد بيانات مصروفات للتصدير");await Zc.exportClinicExpensesToExcel(n),Kc.exportSuccess(`تم تصدير ${n.length} مصروف بنجاح إلى ملف Excel مع التنسيق الجميل!`)}catch(e){console.error("Error exporting clinic expenses:",e),Kc.exportError("فشل في تصدير بيانات المصروفات")}},disabled:0===n.length,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),"تصدير"]}),e.jsxs(Lr,{onClick:()=>y(!0),children:[e.jsx(Zs,{className:"w-4 h-4 ml-2"}),"إضافة مصروف"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(xD,{title:"إجمالي المصروفات",value:e.jsx(rh,{amount:d.totalAmount}),icon:e.jsx(gs,{}),color:"blue"}),e.jsx(xD,{title:"المدفوع",value:e.jsx(rh,{amount:d.paidAmount}),icon:e.jsx(hs,{}),color:"green"}),e.jsx(xD,{title:"المعلق",value:e.jsx(rh,{amount:d.pendingAmount}),icon:e.jsx(us,{}),color:"yellow"}),e.jsx(xD,{title:"المتأخر",value:e.jsx(rh,{amount:d.overdueAmount}),icon:e.jsx(qa,{}),color:"red"})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsx(sc,{children:"البحث والفلاتر"})}),e.jsx(ic,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"text",placeholder:"البحث في المصروفات...",value:r,onChange:e=>{h(e.target.value)},className:"flex-1 px-3 py-2 border border-border rounded-md bg-background text-foreground"}),e.jsx(Lr,{variant:"outline",onClick:()=>{x({status:"",expenseType:"",category:"",vendor:"",isRecurring:null,dateRange:{start:"",end:""}}),h("")},children:"مسح الفلاتر"})]})})]}),e.jsxs(nc,{children:[e.jsxs(ac,{children:[e.jsx(sc,{children:"قائمة المصروفات"}),e.jsx(rc,{children:"عرض جميع مصروفات العيادة مع إمكانية التعديل والحذف"})]}),e.jsx(ic,{children:a?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"text-muted-foreground",children:"جاري التحميل..."})}):0===n.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Xs,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"لا توجد مصروفات"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"لم يتم العثور على أي مصروفات. ابدأ بإضافة مصروف جديد."}),e.jsxs(Lr,{onClick:()=>y(!0),children:[e.jsx(Zs,{className:"w-4 h-4 ml-2"}),"إضافة مصروف جديد"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:F.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg bg-card",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:t.expense_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.expense_type," • ",t.status," • ",e.jsx(rh,{amount:t.amount})]}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:["pending"===t.status&&e.jsx(Lr,{size:"sm",variant:"outline",onClick:()=>(async e=>{try{await p(e.id,{status:"paid"}),f({title:"تم تحديث الحالة",description:"تم تحديث حالة المصروف إلى مدفوع بنجاح"})}catch(t){f({title:"خطأ",description:"فشل في تحديث حالة المصروف",variant:"destructive"})}})(t),children:"تحديد كمدفوع"}),e.jsx(Lr,{size:"sm",variant:"outline",onClick:()=>(e=>{N(e),y(!0)})(t),children:"تعديل"}),e.jsx(Lr,{size:"sm",variant:"destructive",onClick:()=>(e=>{k(e),j(!0)})(t),children:"حذف"})]})]},t.id))}),T>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4 mt-6 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-6 space-x-reverse lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("p",{className:"text-sm font-medium arabic-enhanced",children:"عدد العناصر لكل صفحة"}),e.jsxs(Nl,{value:`${$}`,onValueChange:e=>{D(parseInt(e)),C(1)},children:[e.jsx(Sl,{className:"h-8 w-[70px]",children:e.jsx(kl,{placeholder:$})}),e.jsx(Dl,{side:"top",children:[5,10,20,30,50].map(t=>e.jsx(Al,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium arabic-enhanced",children:["صفحة ",S," من ",T]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>P(1),disabled:1===S,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأولى"}),e.jsx(cs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>P(S-1),disabled:1===S,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة السابقة"}),e.jsx(is,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>P(S+1),disabled:S===T,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة التالية"}),e.jsx(rs,{className:"h-4 w-4"})]}),e.jsxs(Lr,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>P(T),disabled:S===T,children:[e.jsx("span",{className:"sr-only",children:"الذهاب إلى الصفحة الأخيرة"}),e.jsx(os,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse text-sm text-muted-foreground arabic-enhanced",children:["عرض ",A+1," إلى ",Math.min(A+$,E)," من ",E," نتيجة"]})]})]})})]}),e.jsx(uD,{open:v,onOpenChange:()=>{y(!1),N(null)},editingExpense:w}),e.jsx(pD,{open:b,onOpenChange:()=>{j(!1),k(null)},expense:_})]})},xD=({title:t,value:n,icon:a,color:s})=>{const r=pc(),i=hc();return e.jsx(nc,{className:r.card,children:e.jsx(ic,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:t}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:n})]}),e.jsx("div",{className:`${i.container} ${{blue:"text-blue-600 dark:text-blue-400",green:"text-green-600 dark:text-green-400",yellow:"text-yellow-600 dark:text-yellow-400",red:"text-red-600 dark:text-red-400"}[s]}`,children:a})]})})})};function gD({open:t,onOpenChange:n,estimateData:a}){const{settings:s}=ta(),{formatAmount:r}=oa();sa();const i=Rc(),l=Oc(),o=Mc(),{phone:c,email:d,address:m}=Lc(),u=re.useRef(null),[p,h]=re.useState(!1),x=`EST-${Date.now().toString().slice(-6)}`,g=(new Date).toISOString().split("T")[0],f="percentage"===a.discountType?a.subtotal*a.discount/100:a.discount;return e.jsx(Sr,{open:t,onOpenChange:n,children:e.jsxs(Dr,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsxs(Ar,{className:"flex items-center text-xl font-semibold",children:[e.jsx(bs,{className:"w-5 h-5 ml-2"}),"معاينة الفاتورة التقديرية"]}),e.jsx(Fr,{children:"معاينة الفاتورة قبل الطباعة أو التصدير"})]}),e.jsxs("div",{ref:u,className:"estimate-container bg-white text-black",style:{fontFamily:"Arial, sans-serif"},children:[e.jsxs("div",{className:"estimate-header bg-gradient-to-br from-blue-500 to-blue-700 text-white p-8 text-center",children:[e.jsx("div",{className:"estimate-title text-3xl font-bold mb-2",children:"فاتورة تقديرية"}),e.jsxs("div",{className:"estimate-number text-lg opacity-90",children:["رقم التقدير: ",x]})]}),e.jsxs("div",{className:"clinic-info bg-gray-50 p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[o&&""!==o.trim()&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:o,alt:"شعار العيادة",className:"w-16 h-16 rounded-lg object-cover border-2 border-gray-300 shadow-sm",onError:e=>{console.log("Estimate logo failed to load:",o),e.currentTarget.style.display="none"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"clinic-name text-xl font-bold text-gray-800 mb-1",children:i}),l&&e.jsxs("div",{className:"doctor-name text-lg text-gray-600",children:["د. ",l]})]})]}),e.jsxs("div",{className:"contact-info flex gap-6 flex-wrap text-sm text-gray-600",children:[c&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Hs,{className:"w-4 h-4"}),e.jsx("span",{children:c})]}),d&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"📧"}),e.jsx("span",{children:d})]}),m&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Rs,{className:"w-4 h-4"}),e.jsx("span",{children:m})]})]})]}),e.jsx("div",{className:"patient-info p-6 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"info-row flex justify-between mb-2",children:[e.jsx("span",{className:"info-label font-semibold text-gray-700",children:"اسم المريض:"}),e.jsx("span",{children:a.patientName||"غير محدد"})]}),a.patientPhone&&e.jsxs("div",{className:"info-row flex justify-between mb-2",children:[e.jsx("span",{className:"info-label font-semibold text-gray-700",children:"رقم الهاتف:"}),e.jsx("span",{children:a.patientPhone})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"info-row flex justify-between mb-2",children:[e.jsx("span",{className:"info-label font-semibold text-gray-700",children:"تاريخ التقدير:"}),e.jsx("span",{children:In(g)})]}),e.jsxs("div",{className:"info-row flex justify-between mb-2",children:[e.jsx("span",{className:"info-label font-semibold text-gray-700",children:"صالح حتى:"}),e.jsx("span",{children:In(a.validUntil)})]})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("table",{className:"items-table w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-right bg-gray-100 font-semibold text-gray-700 border-b border-gray-200",children:"#"}),e.jsx("th",{className:"p-3 text-right bg-gray-100 font-semibold text-gray-700 border-b border-gray-200",children:"العلاج"}),e.jsx("th",{className:"p-3 text-right bg-gray-100 font-semibold text-gray-700 border-b border-gray-200",children:"الكمية"}),e.jsx("th",{className:"p-3 text-right bg-gray-100 font-semibold text-gray-700 border-b border-gray-200",children:"السعر"}),e.jsx("th",{className:"p-3 text-right bg-gray-100 font-semibold text-gray-700 border-b border-gray-200",children:"المجموع"})]})}),e.jsx("tbody",{children:a.items.map((t,n)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 border-b border-gray-200",children:n+1}),e.jsx("td",{className:"p-3 border-b border-gray-200",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.treatmentName}),t.notes&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:t.notes})]})}),e.jsx("td",{className:"p-3 border-b border-gray-200",children:t.quantity}),e.jsx("td",{className:"p-3 border-b border-gray-200",children:r(t.unitPrice)}),e.jsx("td",{className:"p-3 border-b border-gray-200 font-medium",children:r(t.totalPrice)})]},t.id))})]})}),e.jsx("div",{className:"summary-section p-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-md mr-auto",children:[e.jsxs("div",{className:"summary-row flex justify-between mb-2",children:[e.jsx("span",{children:"المجموع الفرعي:"}),e.jsx("span",{children:r(a.subtotal)})]}),a.discount>0&&e.jsxs("div",{className:"summary-row flex justify-between mb-2 text-green-600",children:[e.jsx("span",{children:"الخصم:"}),e.jsxs("span",{children:["-",r(f)]})]}),a.tax>0&&e.jsxs("div",{className:"summary-row flex justify-between mb-2",children:[e.jsxs("span",{children:["الضريبة (",a.taxRate,"%):"]}),e.jsx("span",{children:r(a.tax)})]}),e.jsxs("div",{className:"summary-total flex justify-between text-lg font-bold text-gray-800 border-t-2 border-blue-500 pt-3 mt-3",children:[e.jsx("span",{children:"المجموع الكلي:"}),e.jsx("span",{children:r(a.total)})]})]})}),a.notes&&e.jsxs("div",{className:"notes-section p-6 bg-yellow-50 border-t border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"ملاحظات:"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:a.notes})]}),e.jsx("div",{className:"stamp-area m-6 p-6 border-2 border-dashed border-gray-300 text-center text-gray-500",children:s?.estimate_show_clinic_stamp&&o&&""!==o.trim()?e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("img",{src:o,alt:"ختم العيادة",className:"w-20 h-20 rounded-full object-cover border-2 border-gray-400 shadow-md opacity-60",onError:e=>{console.log("Stamp logo failed to load:",o),e.currentTarget.style.display="none"}}),e.jsx("div",{className:"text-sm",children:"ختم العيادة"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-lg font-medium mb-2",children:"مكان ختم العيادة"}),e.jsx("div",{className:"text-sm",children:"هذا التقدير صالح لمدة محددة ويخضع للتغيير حسب الحالة الفعلية"})]})}),e.jsxs("div",{className:"footer p-6 text-center bg-gray-800 text-white text-sm",children:[e.jsx("div",{children:"شكراً لثقتكم بنا"}),e.jsxs("div",{className:"mt-1",children:["تم إنشاء هذا التقدير في ",In(g)]})]})]}),e.jsxs(Tr,{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsx(Lr,{variant:"outline",onClick:()=>n(!1),children:"إغلاق"}),e.jsxs(Lr,{variant:"outline",onClick:async()=>{h(!0);try{const e=(await ot(()=>import("./pdf-26d284e9.js").then(e=>e.b),[],import.meta.url)).default,t=(await ot(()=>import("./pdf-26d284e9.js").then(e=>e.j),[],import.meta.url)).default;if(!u.current)return;const n=await e(u.current,{scale:1.5,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:u.current.scrollWidth,height:u.current.scrollHeight}),s=n.toDataURL("image/jpeg",.95),r=new t({orientation:"portrait",unit:"mm",format:"a4"}),i=r.internal.pageSize.getWidth(),l=r.internal.pageSize.getHeight(),o=i-20,c=n.height*o/n.width;let d=c,m=10;for(r.addImage(s,"JPEG",10,m,o,c),d-=l-20;d>=0;)m=d-c+10,r.addPage(),r.addImage(s,"JPEG",10,m,o,c),d-=l-20;const p=`فاتورة_تقديرية_${a.patientName||"مريض"}_${(new Date).toLocaleDateString("en-GB").replace(/\//g,"-")}.pdf`;r.save(p),Kc.success("تم تصدير الفاتورة بنجاح")}catch(e){console.error("Error exporting PDF:",e),Kc.error("فشل في تصدير الفاتورة")}finally{h(!1)}},disabled:p,children:[e.jsx(fs,{className:"w-4 h-4 ml-2"}),p?"جاري التصدير...":"تصدير PDF"]}),e.jsxs(Lr,{onClick:()=>{if(!u.current)return;const e=window.open("","_blank");if(e){const t=u.current.innerHTML;e.document.write(`\n        <!DOCTYPE html>\n        <html dir="rtl">\n        <head>\n          <meta charset="utf-8">\n          <title>فاتورة تقديرية - ${x}</title>\n          <style>\n            body {\n              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n              direction: rtl;\n              margin: 0;\n              padding: 20px;\n              background: white;\n              color: black;\n              font-size: 14px;\n              line-height: 1.6;\n            }\n            .estimate-container {\n              max-width: 800px;\n              margin: 0 auto;\n              background: white;\n              border: 1px solid #ddd;\n              border-radius: 8px;\n              overflow: hidden;\n            }\n            .estimate-header {\n              background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n              color: white;\n              padding: 30px;\n              text-align: center;\n            }\n            .estimate-title {\n              font-size: 28px;\n              font-weight: bold;\n              margin-bottom: 10px;\n            }\n            .estimate-number {\n              font-size: 16px;\n              opacity: 0.9;\n            }\n            .clinic-info {\n              background: #f8fafc;\n              padding: 20px;\n              border-bottom: 1px solid #e2e8f0;\n            }\n            .clinic-logo {\n              width: 60px;\n              height: 60px;\n              border-radius: 8px;\n              object-fit: cover;\n              border: 2px solid #e2e8f0;\n              box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n              margin-left: 15px;\n              float: right;\n            }\n            .clinic-name {\n              font-size: 20px;\n              font-weight: bold;\n              color: #1e293b;\n              margin-bottom: 5px;\n            }\n            .doctor-name {\n              font-size: 16px;\n              color: #64748b;\n              margin-bottom: 10px;\n            }\n            .contact-info {\n              display: flex;\n              gap: 20px;\n              flex-wrap: wrap;\n              font-size: 14px;\n              color: #64748b;\n            }\n            .patient-info {\n              padding: 20px;\n              background: #fefefe;\n              border-bottom: 1px solid #e2e8f0;\n            }\n            .info-row {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 8px;\n            }\n            .info-label {\n              font-weight: 600;\n              color: #374151;\n            }\n            .items-table {\n              width: 100%;\n              border-collapse: collapse;\n              margin: 20px 0;\n            }\n            .items-table th,\n            .items-table td {\n              padding: 12px;\n              text-align: right;\n              border-bottom: 1px solid #e2e8f0;\n            }\n            .items-table th {\n              background: #f1f5f9;\n              font-weight: 600;\n              color: #374151;\n            }\n            .items-table tbody tr:hover {\n              background: #f8fafc;\n            }\n            .summary-section {\n              padding: 20px;\n              background: #f8fafc;\n            }\n            .summary-row {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 8px;\n              padding: 4px 0;\n            }\n            .summary-total {\n              font-size: 18px;\n              font-weight: bold;\n              color: #1e293b;\n              border-top: 2px solid #3b82f6;\n              padding-top: 12px;\n              margin-top: 12px;\n            }\n            .notes-section {\n              padding: 20px;\n              background: #fffbeb;\n              border-top: 1px solid #e2e8f0;\n            }\n            .footer {\n              padding: 20px;\n              text-align: center;\n              background: #1e293b;\n              color: white;\n              font-size: 12px;\n            }\n            .stamp-area {\n              margin-top: 30px;\n              padding: 20px;\n              border: 2px dashed #cbd5e1;\n              text-align: center;\n              color: #64748b;\n            }\n            .stamp-logo {\n              width: 80px;\n              height: 80px;\n              border-radius: 50%;\n              object-fit: cover;\n              border: 2px solid #9ca3af;\n              box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n              opacity: 0.6;\n              margin: 0 auto 10px;\n            }\n            @media print {\n              body { margin: 0; padding: 0; }\n              .estimate-container { border: none; border-radius: 0; }\n            }\n          </style>\n        </head>\n        <body>\n          ${t}\n        </body>\n        </html>\n      `),e.document.close(),e.focus(),setTimeout(()=>{e.print(),e.close()},250)}},children:[e.jsx(Qs,{className:"w-4 h-4 ml-2"}),"طباعة"]})]})]})})}function fD(){const{settings:t,loadSettings:n}=ta(),{formatAmount:a}=oa();sa(),Rc(),Oc(),re.useEffect(()=>{t||n()},[t,n]);const[s,r]=re.useState({patientName:"",patientPhone:"",items:[],subtotal:0,discount:0,discountType:"percentage",tax:0,taxRate:t?.estimate_default_tax_rate||0,total:0,notes:t?.estimate_default_notes||"",validUntil:new Date(Date.now()+24*(t?.estimate_default_validity_days||30)*60*60*1e3).toISOString().split("T")[0]}),[i,l]=re.useState(!1),[o,c]=re.useState({treatmentType:"",treatmentName:"",quantity:1,unitPrice:0,notes:""}),[d,m]=re.useState(null),[u,p]=re.useState(!1),[h,x]=re.useState(!1);re.useEffect(()=>{const e=s.items.reduce((e,t)=>e+t.totalPrice,0),t="percentage"===s.discountType?e*s.discount/100:s.discount,n=e-t,a=n*s.taxRate/100,i=n+a;r(t=>({...t,subtotal:e,tax:a,total:i}))},[s.items,s.discount,s.discountType,s.taxRate]);return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"فاتورة تقديرية خارجية"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"إنشاء فاتورة تقديرية للمرضى دون ربطها بالنظام"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Lr,{variant:"outline",onClick:()=>x(!0),disabled:0===s.items.length,children:[e.jsx(ys,{className:"w-4 h-4 ml-2"}),"معاينة"]}),e.jsxs(Lr,{variant:"outline",onClick:()=>{r(e=>({...e,items:[],patientName:"",patientPhone:"",notes:""})),Kc.success("تم مسح جميع البيانات")},disabled:0===s.items.length,children:[e.jsx(dr,{className:"w-4 h-4 ml-2"}),"مسح الكل"]})]})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs(sc,{className:"flex items-center",children:[e.jsx(Xs,{className:"w-5 h-5 ml-2"}),"معلومات المريض"]})}),e.jsx(ic,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"patientName",children:"اسم المريض"}),e.jsx(Ir,{id:"patientName",value:s.patientName,onChange:e=>r(t=>({...t,patientName:e.target.value})),placeholder:"أدخل اسم المريض"})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"patientPhone",children:"رقم الهاتف (اختياري)"}),e.jsx(Ir,{id:"patientPhone",value:s.patientPhone,onChange:e=>r(t=>({...t,patientPhone:e.target.value})),placeholder:"أدخل رقم الهاتف"})]})]})})]}),e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(sc,{className:"flex items-center",children:[e.jsx(Xa,{className:"w-5 h-5 ml-2"}),"العلاجات المطلوبة"]}),e.jsxs(Lr,{onClick:()=>l(!0),children:[e.jsx(Zs,{className:"w-4 h-4 ml-2"}),"إضافة علاج"]})]})}),e.jsx(ic,{children:0===s.items.length?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(bs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"لم يتم إضافة أي علاجات بعد"}),e.jsx("p",{className:"text-sm",children:'اضغط على "إضافة علاج" لبدء إنشاء الفاتورة'})]}):e.jsx("div",{className:"space-y-4",children:s.items.map((t,n)=>e.jsx("div",{className:"border rounded-lg p-4 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oc,{variant:"outline",children:n+1}),e.jsx("h4",{className:"font-medium",children:t.treatmentName})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["الكمية: ",t.quantity," × ",a(t.unitPrice)," = ",a(t.totalPrice)]}),t.notes&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["ملاحظات: ",t.notes]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Lr,{variant:"outline",size:"sm",onClick:()=>{m(t),p(!0)},children:e.jsx(qs,{className:"w-4 h-4"})}),e.jsx(Lr,{variant:"outline",size:"sm",onClick:()=>{return e=t.id,r(t=>({...t,items:t.items.filter(t=>t.id!==e)})),void Kc.success("تم حذف العلاج");var e},children:e.jsx(dr,{className:"w-4 h-4"})})]})]})},t.id))})})]}),s.items.length>0&&e.jsxs(nc,{children:[e.jsx(ac,{children:e.jsx(sc,{children:"الحسابات"})}),e.jsxs(ic,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"discount",children:"خصم"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ir,{id:"discount",type:"number",value:s.discount,onChange:e=>r(t=>({...t,discount:Number(e.target.value)})),placeholder:"0"}),e.jsxs(Nl,{value:s.discountType,onValueChange:e=>r(t=>({...t,discountType:e})),children:[e.jsx(Sl,{className:"w-24",children:e.jsx(kl,{})}),e.jsxs(Dl,{children:[e.jsx(Al,{value:"percentage",children:"%"}),e.jsx(Al,{value:"fixed",children:"ثابت"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"taxRate",children:"ضريبة (%)"}),e.jsx(Ir,{id:"taxRate",type:"number",value:s.taxRate,onChange:e=>r(t=>({...t,taxRate:Number(e.target.value)})),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"validUntil",children:"صالح حتى"}),e.jsx(Ir,{id:"validUntil",type:"date",value:s.validUntil,onChange:e=>r(t=>({...t,validUntil:e.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"notes",children:"ملاحظات إضافية"}),e.jsx(wl,{id:"notes",value:s.notes,onChange:e=>r(t=>({...t,notes:e.target.value})),placeholder:"أي ملاحظات أو شروط إضافية...",rows:3})]}),e.jsx(Wh,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"المجموع الفرعي:"}),e.jsx("span",{children:a(s.subtotal)})]}),s.discount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"الخصم:"}),e.jsxs("span",{children:["-",a("percentage"===s.discountType?s.subtotal*s.discount/100:s.discount)]})]}),s.tax>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["الضريبة (",s.taxRate,"%):"]}),e.jsx("span",{children:a(s.tax)})]}),e.jsx(Wh,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"المجموع الكلي:"}),e.jsx("span",{children:a(s.total)})]})]}),e.jsx("div",{className:"flex gap-2 pt-4",children:e.jsxs(Lr,{onClick:()=>x(!0),disabled:0===s.items.length,className:"flex-1",children:[e.jsx(ys,{className:"w-4 h-4 ml-2"}),"معاينة وطباعة"]})})]})]}),e.jsx(Sr,{open:i,onOpenChange:l,children:e.jsxs(Dr,{className:"max-w-md",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsx(Ar,{children:"إضافة علاج جديد"}),e.jsx(Fr,{children:"أدخل تفاصيل العلاج المطلوب"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"treatmentType",children:"نوع العلاج"}),e.jsxs(Nl,{value:o.treatmentType,onValueChange:e=>{const t=ja.find(t=>t.value===e);c(n=>({...n,treatmentType:e,treatmentName:t?.label||""}))},children:[e.jsx(Sl,{children:e.jsx(kl,{placeholder:"اختر نوع العلاج"})}),e.jsx(Dl,{children:wa.map(t=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1 text-sm font-medium text-muted-foreground",children:t.label}),Na(t.value).map(t=>e.jsx(Al,{value:t.value,children:t.label},t.value))]},t.value))})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"treatmentName",children:"اسم العلاج"}),e.jsx(Ir,{id:"treatmentName",value:o.treatmentName,onChange:e=>c(t=>({...t,treatmentName:e.target.value})),placeholder:"أو أدخل اسم مخصص"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"quantity",children:"الكمية"}),e.jsx(Ir,{id:"quantity",type:"number",min:"1",value:o.quantity,onChange:e=>c(t=>({...t,quantity:Number(e.target.value)}))})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"unitPrice",children:"السعر"}),e.jsx(Ir,{id:"unitPrice",type:"number",min:"0",step:"0.01",value:o.unitPrice,onChange:e=>c(t=>({...t,unitPrice:Number(e.target.value)}))})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"itemNotes",children:"ملاحظات (اختياري)"}),e.jsx(wl,{id:"itemNotes",value:o.notes,onChange:e=>c(t=>({...t,notes:e.target.value})),placeholder:"أي ملاحظات خاصة بهذا العلاج...",rows:2})]})]}),e.jsxs(Tr,{children:[e.jsx(Lr,{variant:"outline",onClick:()=>l(!1),children:"إلغاء"}),e.jsx(Lr,{onClick:()=>{if(!o.treatmentType||!o.treatmentName||!o.unitPrice)return void Kc.error("يرجى ملء جميع الحقول المطلوبة");const e={id:Date.now().toString(),treatmentType:o.treatmentType,treatmentName:o.treatmentName,quantity:o.quantity||1,unitPrice:o.unitPrice,totalPrice:(o.quantity||1)*(o.unitPrice||0),notes:o.notes};r(t=>({...t,items:[...t.items,e]})),c({treatmentType:"",treatmentName:"",quantity:1,unitPrice:0,notes:""}),l(!1),Kc.success("تم إضافة العلاج بنجاح")},children:"إضافة"})]})]})}),e.jsx(Sr,{open:u,onOpenChange:p,children:e.jsxs(Dr,{className:"max-w-md",dir:"rtl",children:[e.jsxs(Er,{children:[e.jsx(Ar,{children:"تعديل العلاج"}),e.jsx(Fr,{children:"تعديل تفاصيل العلاج"})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"editTreatmentName",children:"اسم العلاج"}),e.jsx(Ir,{id:"editTreatmentName",value:d.treatmentName,onChange:e=>m(t=>t?{...t,treatmentName:e.target.value}:null)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"editQuantity",children:"الكمية"}),e.jsx(Ir,{id:"editQuantity",type:"number",min:"1",value:d.quantity,onChange:e=>m(t=>t?{...t,quantity:Number(e.target.value)}:null)})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"editUnitPrice",children:"السعر"}),e.jsx(Ir,{id:"editUnitPrice",type:"number",min:"0",step:"0.01",value:d.unitPrice,onChange:e=>m(t=>t?{...t,unitPrice:Number(e.target.value)}:null)})]})]}),e.jsxs("div",{children:[e.jsx(Yr,{htmlFor:"editItemNotes",children:"ملاحظات"}),e.jsx(wl,{id:"editItemNotes",value:d.notes||"",onChange:e=>m(t=>t?{...t,notes:e.target.value}:null),rows:2})]})]}),e.jsxs(Tr,{children:[e.jsx(Lr,{variant:"outline",onClick:()=>p(!1),children:"إلغاء"}),e.jsx(Lr,{onClick:()=>{d&&(r(e=>({...e,items:e.items.map(e=>e.id===d.id?{...d,totalPrice:d.quantity*d.unitPrice}:e)})),m(null),p(!1),Kc.success("تم تحديث العلاج بنجاح"))},children:"حفظ التغييرات"})]})]})}),e.jsx(gD,{open:h,onOpenChange:x,estimateData:s})]})}function vD({variant:t="ghost",size:n="icon",showLabel:a=!1}){const{isDarkMode:s,toggleDarkMode:r}=sa();return e.jsxs(Lr,{variant:t,size:n,onClick:r,className:"transition-all duration-200",title:s?"تبديل إلى الوضع الفاتح":"تبديل إلى الوضع المظلم",children:[s?e.jsx(lr,{className:"h-4 w-4"}):e.jsx(Is,{className:"h-4 w-4"}),a&&e.jsx("span",{className:"ml-2",children:s?"فاتح":"مظلم"})]})}const yD=l,bD=i,jD=re.forwardRef(({className:n,...a},s)=>e.jsx(t,{className:En("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...a,ref:s}));jD.displayName=t.displayName;const wD=Or("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),ND=re.forwardRef(({side:t="right",className:s,children:r,...i},l)=>e.jsxs(bD,{children:[e.jsx(jD,{}),e.jsxs(n,{ref:l,dir:"rtl",className:En(wD({side:t}),s),...i,children:[e.jsxs(a,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-all duration-200 hover:opacity-100 hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(_r,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"إغلاق"})]}),r]})]}));ND.displayName=n.displayName;const _D=({className:t,...n})=>e.jsx("div",{className:En("flex flex-col space-y-2 text-center sm:text-right",t),...n});_D.displayName="SheetHeader";const kD=re.forwardRef(({className:t,...n},a)=>e.jsx(s,{ref:a,className:En("text-lg font-semibold text-foreground",t),...n}));kD.displayName=s.displayName;const SD=re.forwardRef(({className:t,...n},a)=>e.jsx(r,{ref:a,className:En("text-sm text-muted-foreground",t),...n}));function CD({className:t,...n}){return e.jsx("div",{className:En("animate-pulse rounded-md bg-primary/10",t),...n})}SD.displayName=r.displayName;const $D=re.createContext(null);function DD(){const e=re.useContext($D);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const ED=re.forwardRef(({defaultOpen:t=!0,open:n,onOpenChange:a,className:s,style:r,children:i,...l},o)=>{const c=function(){const[e,t]=re.useState(void 0);return re.useEffect(()=>{const e=window.matchMedia("(max-width: 767px)"),n=()=>{t(window.innerWidth<768)};return e.addEventListener("change",n),t(window.innerWidth<768),()=>e.removeEventListener("change",n)},[]),!!e}(),[d,m]=re.useState(!1),[u,p]=re.useState(t),h=n??u,x=re.useCallback(e=>{const t="function"==typeof e?e(h):e;a?a(t):p(t),document.cookie=`sidebar_state=${t}; path=/; max-age=604800`},[a,h]),g=re.useCallback(()=>c?m(e=>!e):x(e=>!e),[c,x,m]);re.useEffect(()=>{const e=e=>{const t=e.target,n="INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||"number"===t.getAttribute("type")||t.closest('[data-prevent-shortcuts="true"]')||t.closest('[data-no-globalThis-shortcuts="true"]')||t.hasAttribute("data-prevent-shortcuts")||t.hasAttribute("data-no-globalThis-shortcuts");"b"!==e.key||n||e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),g())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[g]);const f=h?"expanded":"collapsed",v=re.useMemo(()=>({state:f,open:h,setOpen:x,isMobile:c,openMobile:d,setOpenMobile:m,toggleSidebar:g}),[f,h,x,c,d,m,g]);return e.jsx($D.Provider,{value:v,children:e.jsx(A$,{delayDuration:0,children:e.jsx("div",{style:{"--sidebar-width":"16rem","--sidebar-width-icon":"3rem",...r},className:En("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",s),ref:o,...l,children:i})})})});ED.displayName="SidebarProvider";const TD=re.forwardRef(({side:t="left",variant:n="sidebar",collapsible:a="offcanvas",className:s,children:r,...i},l)=>{const{isMobile:o,state:c,openMobile:d,setOpenMobile:m}=DD();return"none"===a?e.jsx("div",{className:En("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",s),ref:l,...i,children:r}):o?e.jsx(yD,{open:d,onOpenChange:m,...i,children:e.jsxs(ND,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":"18rem"},side:t,children:[e.jsxs(_D,{className:"sr-only",children:[e.jsx(kD,{children:"Sidebar"}),e.jsx(SD,{children:"Displays the mobile sidebar."})]}),e.jsx("div",{className:"flex h-full w-full flex-col",children:r})]})}):e.jsxs("div",{ref:l,className:"group peer hidden text-sidebar-foreground md:block","data-state":c,"data-collapsible":"collapsed"===c?a:"","data-variant":n,"data-side":t,children:[e.jsx("div",{className:En("relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180","floating"===n||"inset"===n?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),e.jsx("div",{className:En("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex","left"===t?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]","floating"===n||"inset"===n?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",s),...i,children:e.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:r})})]})});TD.displayName="Sidebar";const AD=re.forwardRef(({className:t,onClick:n,...a},s)=>{const{toggleSidebar:r}=DD();return e.jsxs(Lr,{ref:s,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:En("h-7 w-7",t),onClick:e=>{n?.(e),r()},...a,children:[e.jsx(Ys,{}),e.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});AD.displayName="SidebarTrigger";const FD=re.forwardRef(({className:t,...n},a)=>{const{toggleSidebar:s}=DD();return e.jsx("button",{ref:a,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:s,title:"Toggle Sidebar",className:En("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",t),...n})});FD.displayName="SidebarRail";const PD=re.forwardRef(({className:t,...n},a)=>e.jsx("main",{ref:a,className:En("relative flex w-full flex-1 flex-col bg-background","md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",t),...n}));PD.displayName="SidebarInset";re.forwardRef(({className:t,...n},a)=>e.jsx(Ir,{ref:a,"data-sidebar":"input",className:En("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",t),...n})).displayName="SidebarInput";const RD=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,"data-sidebar":"header",className:En("flex flex-col gap-2 p-2",t),...n}));RD.displayName="SidebarHeader";const OD=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,"data-sidebar":"footer",className:En("flex flex-col gap-2 p-2",t),...n}));OD.displayName="SidebarFooter";re.forwardRef(({className:t,...n},a)=>e.jsx(Wh,{ref:a,"data-sidebar":"separator",className:En("mx-2 w-auto bg-sidebar-border",t),...n})).displayName="SidebarSeparator";const MD=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,"data-sidebar":"content",className:En("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",t),...n}));MD.displayName="SidebarContent";const LD=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,"data-sidebar":"group",className:En("relative flex w-full min-w-0 flex-col p-2",t),...n}));LD.displayName="SidebarGroup";const ID=re.forwardRef(({className:t,asChild:n=!1,...a},s)=>{const r=n?o:"div";return e.jsx(r,{ref:s,"data-sidebar":"group-label",className:En("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",t),...a})});ID.displayName="SidebarGroupLabel";re.forwardRef(({className:t,asChild:n=!1,...a},s)=>{const r=n?o:"button";return e.jsx(r,{ref:s,"data-sidebar":"group-action",className:En("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",t),...a})}).displayName="SidebarGroupAction";const zD=re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,"data-sidebar":"group-content",className:En("w-full text-sm",t),...n}));zD.displayName="SidebarGroupContent";const BD=re.forwardRef(({className:t,...n},a)=>e.jsx("ul",{ref:a,"data-sidebar":"menu",className:En("flex w-full min-w-0 flex-col gap-1",t),...n}));BD.displayName="SidebarMenu";const VD=re.forwardRef(({className:t,...n},a)=>e.jsx("li",{ref:a,"data-sidebar":"menu-item",className:En("group/menu-item relative",t),...n}));VD.displayName="SidebarMenuItem";const YD=Or("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),qD=re.forwardRef(({asChild:t=!1,isActive:n=!1,variant:a="default",size:s="default",tooltip:r,className:i,...l},c)=>{const d=t?o:"button",{isMobile:m,state:u}=DD(),p=e.jsx(d,{ref:c,"data-sidebar":"menu-button","data-size":s,"data-active":n,className:En(YD({variant:a,size:s}),i),...l});return r?("string"==typeof r&&(r={children:r}),e.jsxs(F$,{children:[e.jsx(P$,{asChild:!0,children:p}),e.jsx(R$,{side:"right",align:"center",hidden:"collapsed"!==u||m,...r})]})):p});qD.displayName="SidebarMenuButton";re.forwardRef(({className:t,asChild:n=!1,showOnHover:a=!1,...s},r)=>{const i=n?o:"button";return e.jsx(i,{ref:r,"data-sidebar":"menu-action",className:En("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",a&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",t),...s})}).displayName="SidebarMenuAction";re.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,"data-sidebar":"menu-badge",className:En("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t),...n})).displayName="SidebarMenuBadge";re.forwardRef(({className:t,showIcon:n=!1,...a},s)=>{const r=re.useMemo(()=>`${Math.floor(40*Math.random())+50}%`,[]);return e.jsxs("div",{ref:s,"data-sidebar":"menu-skeleton",className:En("flex h-8 items-center gap-2 rounded-md px-2",t),...a,children:[n&&e.jsx(CD,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),e.jsx(CD,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":r}})]})}).displayName="SidebarMenuSkeleton";re.forwardRef(({className:t,...n},a)=>e.jsx("ul",{ref:a,"data-sidebar":"menu-sub",className:En("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",t),...n})).displayName="SidebarMenuSub";re.forwardRef(({...t},n)=>e.jsx("li",{ref:n,...t})).displayName="SidebarMenuSubItem";const UD=re.forwardRef(({asChild:t=!1,size:n="md",isActive:a,className:s,...r},i)=>{const l=t?o:"a";return e.jsx(l,{ref:i,"data-sidebar":"menu-sub-button","data-size":n,"data-active":a,className:En("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground","sm"===n&&"text-xs","md"===n&&"text-sm","group-data-[collapsible=icon]:hidden",s),...r})});UD.displayName="SidebarMenuSubButton";const HD=[{title:"لوحة التحكم",url:"dashboard",icon:Ts},{title:"المرضى",url:"patients",icon:br},{title:"المواعيد",url:"appointments",icon:es},{title:"المدفوعات",url:"payments",icon:hs},{title:"المخزون",url:"inventory",icon:Bs},{title:"المختبرات",url:"labs",icon:Ms},{title:"الأدوية والوصفات",url:"medications",icon:Ws},{title:"العلاجات السنية",url:"dental-treatments",icon:_s},{title:"احتياجات العيادة",url:"clinic-needs",icon:ms},{title:"مصروفات العيادة",url:"expenses",icon:Xs},{title:"التقارير",url:"reports",icon:Ka},{title:"فاتورة تقديرية ",url:"external-estimate",icon:bs},{title:"الإعدادات",url:"settings",icon:nr}];function GD({activeTab:t,onTabChange:n,...a}){ta();const s=Rc(),r=Oc(),i=Mc();return e.jsxs(TD,{collapsible:"offcanvas",side:"right",className:"border-l border-border/40 shadow-lg rtl-layout",...a,children:[e.jsx(RD,{className:"border-b border-border/40 bg-gradient-to-l from-background to-accent/10",children:e.jsx(BD,{children:e.jsx(VD,{children:e.jsx(qD,{size:"lg",asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-accent/30 transition-colors duration-200 flex-rtl",children:[e.jsx("div",{className:"flex aspect-square size-12 items-center justify-center rounded-lg bg-gradient-to-br from-sky-500 to-sky-600 text-white shadow-lg overflow-hidden",children:i&&""!==i.trim()?e.jsx("img",{src:i,alt:"شعار العيادة",className:"w-full h-full object-cover rounded-lg",onError:e=>{console.error("Sidebar header logo failed to load:",i),e.currentTarget.style.display="none";const t=e.currentTarget.parentElement;if(t){const e=document.createElement("div");e.innerHTML='<svg class="size-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',t.appendChild(e)}}}):e.jsx(ir,{className:"size-6"})}),e.jsxs("div",{className:"grid flex-1 text-right leading-tight",children:[e.jsx("span",{className:"truncate font-bold text-xl text-foreground",children:s}),e.jsx("span",{className:"truncate text-sm text-muted-foreground font-medium",children:"نظام إدارة العيادة"})]})]})})})})}),e.jsx(MD,{className:"px-3 py-3",children:e.jsxs(LD,{className:"space-y-1",children:[e.jsx(ID,{className:"text-sm font-bold text-muted-foreground uppercase tracking-wider px-2 py-2 text-right",children:"القائمة الرئيسية"}),e.jsx(zD,{children:e.jsx(BD,{className:"space-y-1 nav-rtl",children:HD.map(a=>e.jsx(VD,{children:e.jsxs(qD,{isActive:t===a.url,onClick:()=>n(a.url),className:"flex items-center gap-3 w-full text-right justify-start hover:bg-accent/50 transition-colors duration-200 py-2 px-3 text-base nav-item",children:[e.jsx(a.icon,{className:"size-5 text-sky-600 dark:text-sky-400 nav-icon"}),e.jsx("span",{className:"font-semibold text-sm",children:a.title})]})},a.title))})})]})}),e.jsx(OD,{className:"border-t border-border/40 bg-gradient-to-r from-background to-accent/10",children:e.jsx(BD,{children:e.jsx(VD,{children:e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg",children:[e.jsx("div",{className:"flex aspect-square size-8 items-center justify-center rounded-full bg-gradient-to-br from-sky-500 to-sky-600 text-white overflow-hidden",children:i&&""!==i.trim()?e.jsx("img",{src:i,alt:"شعار العيادة",className:"w-full h-full object-cover rounded-full",onError:e=>{console.error("Sidebar footer logo failed to load:",i),e.currentTarget.style.display="none";const t=e.currentTarget.parentElement;if(t){const e=document.createElement("div");e.innerHTML='<svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>',t.appendChild(e)}}}):e.jsx(fr,{className:"size-4"})}),e.jsxs("div",{className:"grid flex-1 text-right leading-tight",children:[e.jsxs("span",{className:"truncate font-semibold text-sm",children:["د. ",r]}),e.jsx("span",{className:"truncate text-xs text-muted-foreground",children:s})]})]})})})}),e.jsx(FD,{})]})}function WD(){const[t,n]=re.useState(new Date);re.useEffect(()=>{const e=setInterval(()=>{n(new Date)},1e3);return()=>clearInterval(e)},[]);return e.jsxs("div",{className:"flex items-center gap-2 font-mono",children:[e.jsx("span",{className:"text-xs",children:"📅"}),e.jsx("span",{children:(e=>{const t=e.getDate(),n=e.getMonth()+1,a=e.getFullYear(),s=e.getHours(),r=e.getMinutes(),i=e.getSeconds();return`${`${t.toString().padStart(2,"0")}/${n.toString().padStart(2,"0")}/${a}`} - ${`${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}`})(t)})]})}var KD="ToastProvider",[ZD,QD,XD]=M("Toast"),[JD,eE]=k("Toast",[XD]),[tE,nE]=JD(KD),aE=t=>{const{__scopeToast:n,label:a="Notification",duration:s=5e3,swipeDirection:r="right",swipeThreshold:i=50,children:l}=t,[o,c]=re.useState(null),[d,m]=re.useState(0),u=re.useRef(!1),p=re.useRef(!1);return a.trim()||console.error(`Invalid prop \`label\` supplied to \`${KD}\`. Expected non-empty \`string\`.`),e.jsx(ZD.Provider,{scope:n,children:e.jsx(tE,{scope:n,label:a,duration:s,swipeDirection:r,swipeThreshold:i,toastCount:d,viewport:o,onViewportChange:c,onToastAdd:re.useCallback(()=>m(e=>e+1),[]),onToastRemove:re.useCallback(()=>m(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:u,isClosePausedRef:p,children:l})})};aE.displayName=KD;var sE="ToastViewport",rE=["F8"],iE="toast.viewportPause",lE="toast.viewportResume",oE=re.forwardRef((t,n)=>{const{__scopeToast:a,hotkey:s=rE,label:r="Notifications ({hotkey})",...i}=t,l=nE(sE,a),o=QD(a),d=re.useRef(null),m=re.useRef(null),u=re.useRef(null),p=re.useRef(null),h=$(n,p,l.onViewportChange),x=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=l.toastCount>0;re.useEffect(()=>{const e=e=>{0!==s.length&&s.every(t=>e[t]||e.code===t)&&p.current?.focus()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]),re.useEffect(()=>{const e=d.current,t=p.current;if(g&&e&&t){const n=()=>{if(!l.isClosePausedRef.current){const e=new CustomEvent(iE);t.dispatchEvent(e),l.isClosePausedRef.current=!0}},a=()=>{if(l.isClosePausedRef.current){const e=new CustomEvent(lE);t.dispatchEvent(e),l.isClosePausedRef.current=!1}},s=t=>{!e.contains(t.relatedTarget)&&a()},r=()=>{e.contains(document.activeElement)||a()};return e.addEventListener("focusin",n),e.addEventListener("focusout",s),e.addEventListener("pointermove",n),e.addEventListener("pointerleave",r),window.addEventListener("blur",n),window.addEventListener("focus",a),()=>{e.removeEventListener("focusin",n),e.removeEventListener("focusout",s),e.removeEventListener("pointermove",n),e.removeEventListener("pointerleave",r),window.removeEventListener("blur",n),window.removeEventListener("focus",a)}}},[g,l.isClosePausedRef]);const f=re.useCallback(({tabbingDirection:e})=>{const t=o().map(t=>{const n=t.ref.current,a=[n,...CE(n)];return"forwards"===e?a:a.reverse()});return("forwards"===e?t.reverse():t).flat()},[o]);return re.useEffect(()=>{const e=p.current;if(e){const t=t=>{const n=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!n){const n=document.activeElement,a=t.shiftKey;if(t.target===e&&a)return void m.current?.focus();const s=f({tabbingDirection:a?"backwards":"forwards"}),r=s.findIndex(e=>e===n);$E(s.slice(r+1))?t.preventDefault():a?m.current?.focus():u.current?.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}},[o,f]),e.jsxs(te,{ref:d,role:"region","aria-label":r.replace("{hotkey}",x),tabIndex:-1,style:{pointerEvents:g?void 0:"none"},children:[g&&e.jsx(dE,{ref:m,onFocusFromOutsideViewport:()=>{$E(f({tabbingDirection:"forwards"}))}}),e.jsx(ZD.Slot,{scope:a,children:e.jsx(c.ol,{tabIndex:-1,...i,ref:h})}),g&&e.jsx(dE,{ref:u,onFocusFromOutsideViewport:()=>{$E(f({tabbingDirection:"backwards"}))}})]})});oE.displayName=sE;var cE="ToastFocusProxy",dE=re.forwardRef((t,n)=>{const{__scopeToast:a,onFocusFromOutsideViewport:s,...r}=t,i=nE(cE,a);return e.jsx(ne,{"aria-hidden":!0,tabIndex:0,...r,ref:n,style:{position:"fixed"},onFocus:e=>{const t=e.relatedTarget;!i.viewport?.contains(t)&&s()}})});dE.displayName=cE;var mE="Toast",uE=re.forwardRef((t,n)=>{const{forceMount:a,open:s,defaultOpen:r,onOpenChange:i,...l}=t,[o,c]=P({prop:s,defaultProp:r??!0,onChange:i,caller:mE});return e.jsx(O,{present:a||o,children:e.jsx(xE,{open:o,...l,ref:n,onClose:()=>c(!1),onPause:A(t.onPause),onResume:A(t.onResume),onSwipeStart:E(t.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:E(t.onSwipeMove,e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${n}px`)}),onSwipeCancel:E(t.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:E(t.onSwipeEnd,e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${n}px`),c(!1)})})})});uE.displayName=mE;var[pE,hE]=JD(mE,{onClose(){}}),xE=re.forwardRef((t,n)=>{const{__scopeToast:a,type:s="foreground",duration:r,open:i,onClose:l,onEscapeKeyDown:o,onPause:d,onResume:m,onSwipeStart:u,onSwipeMove:p,onSwipeCancel:h,onSwipeEnd:x,...g}=t,f=nE(mE,a),[v,y]=re.useState(null),b=$(n,e=>y(e)),j=re.useRef(null),w=re.useRef(null),N=r||f.duration,_=re.useRef(0),k=re.useRef(N),S=re.useRef(0),{onToastAdd:C,onToastRemove:D}=f,T=A(()=>{const e=v?.contains(document.activeElement);e&&f.viewport?.focus(),l()}),F=re.useCallback(e=>{e&&e!==1/0&&(window.clearTimeout(S.current),_.current=(new Date).getTime(),S.current=window.setTimeout(T,e))},[T]);re.useEffect(()=>{const e=f.viewport;if(e){const t=()=>{F(k.current),m?.()},n=()=>{const e=(new Date).getTime()-_.current;k.current=k.current-e,window.clearTimeout(S.current),d?.()};return e.addEventListener(iE,n),e.addEventListener(lE,t),()=>{e.removeEventListener(iE,n),e.removeEventListener(lE,t)}}},[f.viewport,N,d,m,F]),re.useEffect(()=>{i&&!f.isClosePausedRef.current&&F(N)},[i,N,f.isClosePausedRef,F]),re.useEffect(()=>(C(),()=>D()),[C,D]);const P=re.useMemo(()=>v?_E(v):null,[v]);return f.viewport?e.jsxs(e.Fragment,{children:[P&&e.jsx(gE,{__scopeToast:a,role:"status","aria-live":"foreground"===s?"assertive":"polite","aria-atomic":!0,children:P}),e.jsx(pE,{scope:a,onClose:T,children:se.createPortal(e.jsx(ZD.ItemSlot,{scope:a,children:e.jsx(ae,{asChild:!0,onEscapeKeyDown:E(o,()=>{f.isFocusedToastEscapeKeyDownRef.current||T(),f.isFocusedToastEscapeKeyDownRef.current=!1}),children:e.jsx(c.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":f.swipeDirection,...g,ref:b,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:E(t.onKeyDown,e=>{"Escape"===e.key&&(o?.(e.nativeEvent),e.nativeEvent.defaultPrevented||(f.isFocusedToastEscapeKeyDownRef.current=!0,T()))}),onPointerDown:E(t.onPointerDown,e=>{0===e.button&&(j.current={x:e.clientX,y:e.clientY})}),onPointerMove:E(t.onPointerMove,e=>{if(!j.current)return;const t=e.clientX-j.current.x,n=e.clientY-j.current.y,a=Boolean(w.current),s=["left","right"].includes(f.swipeDirection),r=["left","up"].includes(f.swipeDirection)?Math.min:Math.max,i=s?r(0,t):0,l=s?0:r(0,n),o="touch"===e.pointerType?10:2,c={x:i,y:l},d={originalEvent:e,delta:c};a?(w.current=c,kE("toast.swipeMove",p,d,{discrete:!1})):SE(c,f.swipeDirection,o)?(w.current=c,kE("toast.swipeStart",u,d,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>o||Math.abs(n)>o)&&(j.current=null)}),onPointerUp:E(t.onPointerUp,e=>{const t=w.current,n=e.target;if(n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),w.current=null,j.current=null,t){const n=e.currentTarget,a={originalEvent:e,delta:t};SE(t,f.swipeDirection,f.swipeThreshold)?kE("toast.swipeEnd",x,a,{discrete:!0}):kE("toast.swipeCancel",h,a,{discrete:!0}),n.addEventListener("click",e=>e.preventDefault(),{once:!0})}})})})}),f.viewport)})]}):null}),gE=t=>{const{__scopeToast:n,children:a,...s}=t,r=nE(mE,n),[i,l]=re.useState(!1),[o,c]=re.useState(!1);return function(e=()=>{}){const t=A(e);F(()=>{let e=0,n=0;return e=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(n)}},[t])}(()=>l(!0)),re.useEffect(()=>{const e=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(e)},[]),o?null:e.jsx(Q,{asChild:!0,children:e.jsx(ne,{...s,children:i&&e.jsxs(e.Fragment,{children:[r.label," ",a]})})})},fE=re.forwardRef((t,n)=>{const{__scopeToast:a,...s}=t;return e.jsx(c.div,{...s,ref:n})});fE.displayName="ToastTitle";var vE=re.forwardRef((t,n)=>{const{__scopeToast:a,...s}=t;return e.jsx(c.div,{...s,ref:n})});vE.displayName="ToastDescription";var yE="ToastAction",bE=re.forwardRef((t,n)=>{const{altText:a,...s}=t;return a.trim()?e.jsx(NE,{altText:a,asChild:!0,children:e.jsx(wE,{...s,ref:n})}):(console.error(`Invalid prop \`altText\` supplied to \`${yE}\`. Expected non-empty \`string\`.`),null)});bE.displayName=yE;var jE="ToastClose",wE=re.forwardRef((t,n)=>{const{__scopeToast:a,...s}=t,r=hE(jE,a);return e.jsx(NE,{asChild:!0,children:e.jsx(c.button,{type:"button",...s,ref:n,onClick:E(t.onClick,r.onClose)})})});wE.displayName=jE;var NE=re.forwardRef((t,n)=>{const{__scopeToast:a,altText:s,...r}=t;return e.jsx(c.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":s||void 0,...r,ref:n})});function _E(e){const t=[];return Array.from(e.childNodes).forEach(e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const n=e.ariaHidden||e.hidden||"none"===e.style.display,a=""===e.dataset.radixToastAnnounceExclude;if(!n)if(a){const n=e.dataset.radixToastAnnounceAlt;n&&t.push(n)}else t.push(..._E(e))}}),t}function kE(e,t,n,{discrete:a}){const s=n.originalEvent.currentTarget,r=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&s.addEventListener(e,t,{once:!0}),a?Z(s,r):s.dispatchEvent(r)}var SE=(e,t,n=0)=>{const a=Math.abs(e.x),s=Math.abs(e.y),r=a>s;return"left"===t||"right"===t?r&&a>n:!r&&s>n};function CE(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function $E(e){const t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}var DE=oE,EE=uE,TE=fE,AE=vE,FE=bE,PE=wE;const RE=aE,OE=re.forwardRef(({className:t,...n},a)=>e.jsx(DE,{ref:a,className:En("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:left-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...n}));OE.displayName=DE.displayName;const ME=Or("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 space-x-reverse overflow-hidden rounded-md border p-4 pl-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-left-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full dark:shadow-xl dark:shadow-black/20",{variants:{variant:{default:"border bg-background text-foreground dark:bg-card dark:border-border dark:text-card-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground dark:border-destructive dark:bg-destructive dark:text-destructive-foreground",success:"border-green-200 bg-green-50 text-green-800 dark:border-green-800 dark:bg-green-900/20 dark:text-green-400",warning:"border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-800 dark:bg-amber-900/20 dark:text-amber-400",info:"border-blue-200 bg-blue-50 text-blue-800 dark:border-blue-800 dark:bg-blue-900/20 dark:text-blue-400"}},defaultVariants:{variant:"default"}}),LE=re.forwardRef(({className:t,variant:n,...a},s)=>e.jsx(EE,{ref:s,dir:"rtl",className:En(ME({variant:n}),t),...a}));LE.displayName=EE.displayName;re.forwardRef(({className:t,...n},a)=>e.jsx(FE,{ref:a,className:En("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...n})).displayName=FE.displayName;const IE=re.forwardRef(({className:t,...n},a)=>e.jsx(PE,{ref:a,className:En("absolute left-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...n,children:e.jsx(_r,{className:"h-4 w-4"})}));IE.displayName=PE.displayName;const zE=re.forwardRef(({className:t,...n},a)=>e.jsx(TE,{ref:a,className:En("text-sm font-semibold [&+div]:text-xs",t),...n}));zE.displayName=TE.displayName;const BE=re.forwardRef(({className:t,...n},a)=>e.jsx(AE,{ref:a,className:En("text-sm opacity-90",t),...n}));function VE(){const{toasts:t}=Bl();return e.jsxs(RE,{children:[t.map(function({id:t,title:n,description:a,action:s,...r}){return e.jsxs(LE,{...r,children:[e.jsxs("div",{className:"grid gap-1",children:[n&&e.jsx(zE,{children:n}),a&&e.jsx(BE,{children:a})]}),s,e.jsx(IE,{})]},t)}),e.jsx(OE,{})]})}BE.displayName=AE.displayName;const YE=re.forwardRef(({...t},n)=>e.jsx("nav",{ref:n,"aria-label":"breadcrumb",...t}));YE.displayName="Breadcrumb";const qE=re.forwardRef(({className:t,...n},a)=>e.jsx("ol",{ref:a,className:En("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",t),...n}));qE.displayName="BreadcrumbList";const UE=re.forwardRef(({className:t,...n},a)=>e.jsx("li",{ref:a,className:En("inline-flex items-center gap-1.5",t),...n}));UE.displayName="BreadcrumbItem";const HE=re.forwardRef(({asChild:t,className:n,...a},s)=>{const r=t?o:"a";return e.jsx(r,{ref:s,className:En("transition-colors hover:text-foreground",n),...a})});HE.displayName="BreadcrumbLink";const GE=re.forwardRef(({className:t,...n},a)=>e.jsx("span",{ref:a,role:"link","aria-disabled":"true","aria-current":"page",className:En("font-normal text-foreground",t),...n}));GE.displayName="BreadcrumbPage";const WE=({children:t,className:n,...a})=>e.jsx("li",{role:"presentation","aria-hidden":"true",className:En("[&>svg]:size-3.5",n),...a,children:t??e.jsx(is,{})});WE.displayName="BreadcrumbSeparator";function KE(){sa();const{toast:t}=Bl(),{isAuthenticated:n,isLoading:a,passwordEnabled:s,login:r}=xa(),{isLicenseValid:i,isFirstRun:l,isLoading:o,error:c,machineInfo:d,activateLicense:m}=function(){const[e,t]=re.useState({isLicenseValid:!1,isFirstRun:!0,isLoading:!0,error:null,licenseData:null,machineInfo:null}),n=re.useCallback(async()=>{try{if(console.log("🔐 Checking license status..."),!window.electronAPI?.license?.checkStatus)throw new Error("License API not available");const e=await window.electronAPI.license.checkStatus();return console.log("🔐 License status result:",e),e}catch(e){return console.error("❌ Error checking license status:",e),{isValid:!1,error:"Failed to check license status",isFirstRun:!0}}},[]),a=re.useCallback(async()=>{try{if(console.log("🔐 Getting machine info..."),!window.electronAPI?.license?.getMachineInfo)throw new Error("License API not available");const e=await window.electronAPI.license.getMachineInfo();return console.log("🔐 Machine info result:",e),e}catch(e){return console.error("❌ Error getting machine info:",e),{hwid:"error",platform:"unknown",arch:"unknown",error:"Failed to get machine info"}}},[]),s=re.useCallback(async e=>{try{if(console.log("🔐 Activating license..."),!window.electronAPI?.license?.activate)throw new Error("License API not available");if(!e||"string"!=typeof e)throw new Error("Invalid license key provided");const t=await window.electronAPI.license.activate(e.trim());return console.log("🔐 License activation result:",t.success),t.success&&await l(),t}catch(t){return console.error("❌ Error activating license:",t),{success:!1,error:"Failed to activate license"}}},[]),r=re.useCallback(async()=>{try{if(console.log("🔐 Getting license info..."),!window.electronAPI?.license?.getLicenseInfo)throw new Error("License API not available");const e=await window.electronAPI.license.getLicenseInfo();return console.log("🔐 License info result:",e),e}catch(e){return console.error("❌ Error getting license info:",e),null}},[]),i=re.useCallback(async()=>{try{if(console.log("🔐 Clearing license data..."),!window.electronAPI?.license?.clearData)throw new Error("License API not available");const e=await window.electronAPI.license.clearData();return console.log("🔐 License clear result:",e.success),e.success&&await l(),e}catch(e){return console.error("❌ Error clearing license data:",e),{success:!1,error:"Failed to clear license data"}}},[]),l=re.useCallback(async()=>{t(e=>({...e,isLoading:!0,error:null}));try{const[e,s,i]=await Promise.all([n(),a(),r()]);t({isLicenseValid:e.isValid,isFirstRun:e.isFirstRun,isLoading:!1,error:e.error||s.error||null,licenseData:i,machineInfo:s}),console.log("🔐 License state updated:",{isValid:e.isValid,isFirstRun:e.isFirstRun,hasError:!(!e.error&&!s.error)})}catch(e){console.error("❌ Error refreshing license status:",e),t(e=>({...e,isLoading:!1,error:"Failed to refresh license status"}))}},[n,a,r]);re.useEffect(()=>{console.log("🔐 Initializing license hook..."),l()},[l]);const o=re.useCallback(e=>!(!e||"string"!=typeof e)&&/^[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}$/.test(e.trim().toUpperCase()),[]),c=re.useCallback(e=>{const t=e.replace(/[^A-Z0-9]/gi,"").toUpperCase(),n=[];for(let a=0;a<t.length;a+=5)n.push(t.slice(a,a+5));return n.slice(0,4).join("-")},[]);return{isLicenseValid:e.isLicenseValid,isFirstRun:e.isFirstRun,isLoading:e.isLoading,error:e.error,licenseData:e.licenseData,machineInfo:e.machineInfo,activateLicense:s,refreshLicenseStatus:l,clearLicenseData:i,getLicenseInfo:r,getMachineInfo:a,checkLicenseStatus:n,validateLicenseFormat:o,formatLicenseKey:c}}();ua(),Ma(),re.useEffect(()=>{const e=e=>{const t=e.target,n="INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||"number"===t.getAttribute("type")||t.closest('[data-prevent-shortcuts="true"]')||t.closest('[data-no-globalThis-shortcuts="true"]')||t.hasAttribute("data-prevent-shortcuts")||t.hasAttribute("data-no-globalThis-shortcuts");if(e.ctrlKey&&"F1"!==e.key)return;const a=e.altKey;if(n&&!a)return void console.log("🚫 App.tsx: Ignoring shortcut for typing element:",{key:e.key,tagName:t.tagName,hasPreventAttr:t.hasAttribute("data-prevent-shortcuts"),hasNoGlobalAttr:t.hasAttribute("data-no-globalThis-shortcuts")});const s=Ia(e);"0"===s.mappedKey?(s.preventDefault(),p("dashboard")):"1"===s.mappedKey?(s.preventDefault(),p("patients")):"2"===s.mappedKey?(s.preventDefault(),p("appointments")):"3"===s.mappedKey?(s.preventDefault(),p("payments")):"4"===s.mappedKey?(s.preventDefault(),p("inventory")):"5"===s.mappedKey?(s.preventDefault(),p("labs")):"6"===s.mappedKey?(s.preventDefault(),p("medications")):"7"===s.mappedKey?(s.preventDefault(),p("dental-treatments")):"8"===s.mappedKey?(s.preventDefault(),p("clinic-needs")):"9"===s.mappedKey&&(s.preventDefault(),p("reports")),"a"===s.mappedKey.toLowerCase()?(s.preventDefault(),console.log("🎯 Shortcut A/ش pressed - Opening Add Patient dialog"),x(!0)):"s"===s.mappedKey.toLowerCase()?(s.preventDefault(),console.log("🎯 Shortcut S/س pressed - Opening Add Appointment dialog"),j(!0)):"d"===s.mappedKey.toLowerCase()&&(s.preventDefault(),console.log("🎯 Shortcut D/ي pressed - Opening Add Payment dialog"),f(!0)),"r"===s.mappedKey.toLowerCase()&&(s.preventDefault(),console.log("🎯 Shortcut R/ق pressed - Refreshing page"),window.location.reload()),"f"===s.mappedKey.toLowerCase()&&(s.preventDefault(),console.log("🎯 Shortcut F/ب pressed - Opening search")),"F1"===e.key&&(e.preventDefault(),console.log("🎯 Opening Settings"),p("settings"))};if(n&&i)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[n,i]);const[u,p]=re.useState("dashboard"),[h,x]=re.useState(!1),[g,f]=re.useState(!1),[v,y]=re.useState(!1),[b,j]=re.useState(!1),[w,N]=re.useState(!1),[_,k]=re.useState(!1),[S,C]=re.useState(null);re.useState(""),re.useState("all");const $=(e,n="success")=>{t({title:"success"===n?"نجح":"خطأ",description:e,variant:"error"===n?"destructive":"default"})},{loadPatients:D,patients:E}=bt(),{appointments:T,isLoading:A,error:F,loadAppointments:P,createAppointment:R,updateAppointment:O,deleteAppointment:M}=Jn(),{loadSettings:L}=ta();ua(),ha(),re.useEffect(()=>{(async()=>{i&&n?(console.log("🚀 Initializing app with valid license and authentication"),await L(),D(),P()):console.log("⏳ Waiting for license validation and authentication before initializing app")})()},[i,n,D,P,L]);const I=async e=>{y(!0);try{return await r(e)}finally{y(!1)}},z=async e=>{try{console.log("🔐 Handling license activation...");const n=await m(e);return n.success?t({title:"نجح التفعيل",description:"تم تفعيل الترخيص بنجاح",variant:"default"}):t({title:"فشل التفعيل",description:n.error||"فشل في تفعيل الترخيص",variant:"destructive"}),n}catch(n){console.error("❌ License activation error:",n);const e="حدث خطأ أثناء تفعيل الترخيص";return t({title:"خطأ",description:e,variant:"destructive"}),{success:!1,error:e}}};if(o||a)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:o?"جاري التحقق من الترخيص...":"جاري التحميل..."})]})});if(!i||l)return e.jsx(Zr,{onActivate:z,isLoading:o,machineInfo:d||void 0});if(s&&!n)return e.jsx(Kr,{onLogin:I,isLoading:v});return e.jsxs(ED,{children:[e.jsx(GD,{activeTab:u,onTabChange:p}),e.jsxs(PD,{children:[e.jsxs("header",{className:"flex h-16 shrink-0 items-center gap-2 transition-[width,height] ease-linear group-has-[[data-collapsible=icon]]/sidebar-wrapper:h-12 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b border-border/40 rtl-layout",children:[e.jsx("div",{className:"flex items-center gap-2 px-4",children:e.jsx(YE,{children:e.jsxs(qE,{className:"flex-rtl",children:[e.jsx(UE,{className:"hidden md:block",children:e.jsx(HE,{href:"#",className:"text-muted-foreground hover:text-foreground transition-colors duration-200",children:"🦷 نظام إدارة العيادة السنية"})}),e.jsx(WE,{className:"hidden md:block"}),e.jsx(UE,{children:e.jsx(GE,{className:"font-semibold text-sky-600 dark:text-sky-400",children:{dashboard:"لوحة التحكم",patients:"المرضى",appointments:"المواعيد",payments:"المدفوعات",inventory:"المخزون",labs:"المختبرات",medications:"الأدوية والوصفات","dental-treatments":"العلاجات السنية","clinic-needs":"احتياجات العيادة",expenses:"مصروفات العيادة",reports:"التقارير","external-estimate":"فاتورة تقديرية خارجية",settings:"الإعدادات"}[u]||"لوحة التحكم"})})]})})}),e.jsxs("div",{className:"ml-auto-rtl flex items-center gap-3 px-4 space-x-3-rtl",children:[e.jsx(AD,{}),e.jsx(Wh,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(uc,{}),e.jsx(vD,{}),e.jsx("div",{className:"text-sm text-muted-foreground bg-accent/30 px-3 py-1 rounded-full",children:e.jsx(WD,{})})]})]}),e.jsx("div",{className:"flex flex-1 flex-col gap-4 p-10 pt-4 max-w-full overflow-hidden relative rtl-layout",children:e.jsx("div",{className:"w-full max-w-none content-wrapper",children:(()=>{switch(u){case"patients":return e.jsx(wf,{onNavigateToTreatments:p,onNavigateToPayments:p});case"appointments":return e.jsx(UC,{});case"payments":return e.jsx(Qc,{});case"inventory":return e.jsx(ih,{});case"labs":return e.jsx(JC,{});case"medications":return e.jsx(z$,{});case"dental-treatments":return e.jsx(sD,{});case"clinic-needs":return e.jsx(mD,{});case"expenses":return e.jsx(hD,{});case"reports":return e.jsx(Qh,{});case"external-estimate":return e.jsx(fD,{});case"settings":return e.jsx(od,{});default:return e.jsx(ox,{onNavigateToPatients:()=>p("patients"),onNavigateToAppointments:()=>p("appointments"),onNavigateToPayments:()=>p("payments"),onNavigateToTreatments:()=>p("dental-treatments"),onAddPatient:()=>x(!0),onAddAppointment:()=>j(!0),onAddPayment:()=>f(!0)})}})()})})]}),e.jsx(Vl,{open:h,onOpenChange:x}),e.jsx(tc,{isOpen:b,onClose:()=>j(!1),onSave:async e=>{try{await R(e),j(!1),$("تم إضافة الموعد الجديد بنجاح","success")}catch(t){console.error("Error creating appointment:",t),$("فشل في إضافة الموعد. يرجى المحاولة مرة أخرى","error")}},patients:E,treatments:[]}),w&&S&&e.jsx(tc,{isOpen:w,onClose:()=>{N(!1),C(null)},onSave:async e=>{try{await O(S.id,e),N(!1),C(null),$("تم تحديث الموعد بنجاح","success")}catch(t){console.error("Error updating appointment:",t),$("فشل في تحديث الموعد. يرجى المحاولة مرة أخرى","error")}},patients:E,treatments:[],initialData:S}),_&&S&&e.jsx(ec,{isOpen:_,patient:null,appointment:S,onClose:()=>{k(!1),C(null)},onConfirm:async()=>{if(S)try{await M(S.id),k(!1),C(null),$("تم حذف الموعد بنجاح","success")}catch(e){console.error("Error deleting appointment:",e),$("فشل في حذف الموعد. يرجى المحاولة مرة أخرى","error")}},isLoading:A}),e.jsx(dc,{open:g,onOpenChange:f}),e.jsx(VE,{})]})}function ZE(){return e.jsx(aa,{children:e.jsx(la,{children:e.jsx(KE,{})})})}console.log("🚀 Starting React application...");const QE=document.getElementById("root");if(!QE)throw console.error("❌ Root element not found!"),document.body.innerHTML='\n    <div style="\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100vh;\n      font-family: Arial, sans-serif;\n      background: #f5f5f5;\n      color: #333;\n      text-align: center;\n    ">\n      <div>\n        <h1>خطأ في التحميل</h1>\n        <p>لم يتم العثور على عنصر الجذر في الصفحة</p>\n        <p>يرجى إعادة تشغيل التطبيق</p>\n      </div>\n    </div>\n  ',new Error("Root element not found");console.log("✅ Root element found, creating React root...");try{const t=dt.createRoot(QE);console.log("✅ React root created successfully"),t.render(e.jsx(ie.StrictMode,{children:e.jsx(ZE,{})})),console.log("✅ React app rendered successfully")}catch(JE){console.error("❌ Failed to render React app:",JE),QE.innerHTML=`\n    <div style="\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100vh;\n      font-family: Arial, sans-serif;\n      background: #f5f5f5;\n      color: #333;\n      text-align: center;\n    ">\n      <div>\n        <h1>خطأ في تحميل التطبيق</h1>\n        <p>حدث خطأ أثناء تحميل التطبيق</p>\n        <p>يرجى إعادة تشغيل التطبيق أو الاتصال بالدعم الفني</p>\n        <details style="margin-top: 20px; text-align: left;">\n          <summary>تفاصيل الخطأ</summary>\n          <pre style="background: #fff; padding: 10px; border-radius: 4px; margin-top: 10px;">\n${JE.message}\n${JE.stack}\n          </pre>\n        </details>\n      </div>\n    </div>\n  `}export{_f as _};
//# sourceMappingURL=index-974ba20c.js.map
